<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>5486</ISSUENO>
  <ISSUEURL>https://github.com/nightscout/cgm-remote-monitor/issues/5486</ISSUEURL>
  <TITLE>Loop Pill data unavailable after 24 hours</TITLE>
  <DESCRIPTION>**Describe the bug** When scrubbing back in NS home screen graph, the Loop Pill shows no data and a warning symbol when you exceed 24 hours exactly from your current time. **To Reproduce** Steps to reproduce the behavior: 1. Go to lower NS mini-graph 2. Click on graph and scroll back 24 hours and 1 minute or more 3. The loop pill will not show any data and have a warning symbol in place of the data. **Expected behavior** The Loop pill should remain intact, with its data and over data available like it does in the 23 hours since your current time. **Screenshots** If applicable, add screenshots to help explain your problem. 24+ hours ![image](https://user-images.githubusercontent.com/46848705/73091533-7ad13d80-3e8f-11ea-8eed-4229e2643791.png) Less than 24 hours ![image](https://user-images.githubusercontent.com/46848705/73091548-81f84b80-3e8f-11ea-9b6f-698642737d77.png) **Your setup information** - What version of Nightscout (e.g. 13.0.2-dev) - What type of CGM, and how do you get your data there? ShareBridge - Is your issue specific to a browser (Firefox/Safari/Chrome?) or a device (Android phone, etc.)? No **Additional context** Running Loop Dev current as of 1/23/2020</DESCRIPTION>
  <REPONAME>cgm-remote-monitor</REPONAME>
  <TIMEDIFFERENCEDAYS>386</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>do not redirect to profile editor by default (#5671) In a default configuration, there is no treatment data. The code to redirect the UI to the profile editor is buried deep within the chart rendering code for basals. This plugin is only supposed to go into action when enabled via ENABLE=basal. This commit fixes first-use experience for the default configuration intended to draw real-time CGM traces and no basal information is expected. Since no basal information is expected unless plugin is enabled via ENABLE=basal, this allows skipping instead of redirecting to the profile editor.</MESSAGE>
    <SHA>db0e08c522dbfad3f55c649c17d0c9bf6dccb981</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fix Issue #5486 - Device Status Days Feature (#5651) * Device Status Days Feature * Edits per review from @sulkaharo</MESSAGE>
      <SHA>f3fab567c5e2d25da3d5a2f452c28b99cb016b0f</SHA>
      <PATCHEDFILES>
        <FILE>README.md</FILE>
        <FILE>env.js</FILE>
        <FILE>lib/data/dataloader.js</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>update (#4) * Logic correction * Fix tests failing in dev (#5127) * * Fix reporting test to match the new output * Fix number formatter to return the expected 0 when data is NaN * Remove excessive logging during test runs from cob plugin * Run all tests in one go * Fixes D3 invocations for tests. Note this also removes transition timers (most of which seemed to be timed so fast they actually had no effect as the timer was faster than what it takes to draw a frame in Nightscout) * Run tests independently * Try not running tap-set-exit * Remove tap-set-exit * Performance fixes (#5134) * Further fixes to profile data fetches, change the client to not create excessive amount of date objects * Sort entries once on load and then rely on the sorting to find out the largest and smallest value * Make the renderer reuse Date objects instead of instantiating a huge amount of dates all the time * Don't load retro data if not needed. Merge retro data faster if it's present. (#5141) * Updated Alexa template to comply with new requirements * Load data in one pass (#5142) * Fix layouting and load data in one go. Bonus points if you can fix the rendering for this * fix focus target lines and high and low lines * Remove debug logging. Change profile functions to clear the cache on new data, instead of calculating heavy hashes * Remove unused code * Fix tests * Have Travis run tests on Node 10 and 12, not 13 * D3 Upgrade Residual Cleanup (#5140) * fix forecast limit logic (cherry picked from commit e88ce7e5d1f5fb12c71ae67da4131ff1a50940c9) * fix minimum focus forecast time * make min forecast 30 min * fix forecast time max to client focusRangeMS instead of 30 min (#5143) * Fix initial forecast point display * Fix forecast time randomly resetting to 30 minutes for openaps users * Stop Focus Circles from Eating Entries (#5145) * stop focus circles from eating entries * fix forecastCircles remove * resolve possible key collision * Fixes a major bug where plugins were ran against a sandbox twice, causing issues with predictions. Fixes the look ahead timings. * Fix forecast behaviour (#5160) * stop focus circles from eating entries * fix forecastCircles remove * resolve possible key collision * Fixes a major bug where plugins were ran against a sandbox twice, causing issues with predictions. Fixes the look ahead timings. * Refactor of how prediction data is collected * Update node pushover library to fix crash in case Pushover service is down * adding list of supported APIs versions (GET /api/versions) * Fixed a few missing definitions * API3: add locking documents using isReadOnly flag * Translation improvements * Defined `translate()` in upbat plugin * Migrated titles to use translate() * Migrated static intent titles to use translate() * Misc fixes for tests (even though they didn't fail ) * API3: testing isReadOnly feature * API3: more readonly field name variants * Added instructions on how to update skills/agents * fix devicestatus retro merge (#5193) * Turkish language updates (#5192) * Turkish language updates * in to Languages Part Turkish added * in to Languages Part Turkish added * Fix falsely suspended timeago alarms (#5170) * Fix continuous suspension of the timeago alerts The default hearbeat-setting is 60 seconds, so the delta between two timeago-checks will always be &gt;15 seconds and the timeago-alarms will always be suspended (that's what Papertrail also shows). To fix this, make the delta-check heartbeat-setting-dependant and also simplify the code by using just 1 variable. * Add test that verifies the hibernation detection behaviour The real-world test would be to actually wait for a couple of minutes (with 2 * heartbeat of default settings) in the unit test, but this is not feasible, so just modify the heartbeat-setting to a lower value. I tested it by only running tests inside `tests/timeago.test.js` and by actually deploying this code and testing the alarms with Pushover and reading the logs in Papertrail. Before this change, I saw a 'Hibernation detected' log every minute. After this change, I didn't see it anymore, probably because the app wasn't actually hibernated (yet). * Take sulkaharo's feedback into account and differentiate between client and server (by introducing it in sandbox.js). On the client the behaviour is different from the server: &gt; On client, the issue is browsers stop the execution of JS if the window is not &gt; visible and the alarm is falsely triggered immediately when the execution is &gt; resumed, so we need to suspend the alarm for ~10 seconds after the execution has &gt; resumed to give the client time to update the data to prevent false alarms. While on the server, the default heartbeat from 60s needs to be taken into account to prevent the timeago alarm from falsely triggering. So detect hibernation there if the last check was more than 2 heartbeats ago. * Fix the tests by adding settings to the context, which is now required by timeago. Also, change the timeago test a bit so that it both succeeds when testing in isolation as when testing it along with the other tests. * Adding to #5121 (#5126) * changed gitter shield to discord * changed discord shield text to discord chat instead of just chat * changed gitter shield to discord * need to fix my md error * Update CONTRIBUTING.md Few more tweaks * Update CONTRIBUTING.md * Update CONTRIBUTING.md * Update README.md Change Discord URL to be an invite link instead of a direct link to the channel (which doesn't work if you're not already in it). * Extra info (delta and last measurement time) on clock view. (#5151) * Parametrized clock view * Parametrized clock view * Wording tweaks to go with #4810 (#4866) * mmol/L wording tweak in Readme * Various wording &amp; clarity tweaks in the Readme * Heroku template update to reflect mmol allowance tweak * Update README.md * Update minimum device requirements Ran some proper browser test suites, determined actual minimum specs for the main site. * GitHub actions build (#5168) * Run tests using GitHub Actions * Node 10 * Test CI fails * Use npm to run tests * Fix package json to run tests * Enable v3 TEST api for both development env and CI * Run CI on both Node 10 and 12 * Allow downgrading Mongo * Move the units configuration detection to a place where it's guaranteed to catch all invocations * Fix the check for environments without the units setting * Rename xdrip-js to xdripjs (#4959) * rename xdrip-js to xdripjs * update readme for xdrip-js name change * update from CGM to XDRIPJS label * change label from all caps to mixed case for xDripJS * change pill label back to CGM * Added customization step for Alexa skill updates * Language Update: added missing German Translations (#5172) * language Update devicestatus collection * language Update Admin-Tools * changed wording for admin authorization * typo corrected (admin auth) * language Updates for Admin Tools database cleanups * Don't use dynamic scale unless entries in database (#5195) * don't use dynamic scale unless have entries * fix report crash when no entries * set forecastTime correctly when no entries present * Language Matters: change &quot;Normal&quot; to &quot;In Range&quot; in glucose distribution reports * Added/updated TOC's * set auth dialog width to client width if smaller than default width * More hebrew translations * Added note regarding the use of the Alexa online simulator * fix focus scale hour format * trip open-top size to fit * fix clearing alarming when clearning CurrentSGV * do not set direction if not current * Handled 0 for pump reservoir * rollback npm-shrinkwrap.json * Fix for distributionpage bug that caused hour 23 to always be active even after uncheck * Russian translation update edit * Use default entries count instead of distributed number literals * Handle mmol to mgdl conversions with a constant reference (#5274) * Added sanity check for the bridge interval value (#4717) * Added sanity check for the bridge interval value, setting minimum allowed value to 30 seconds and maximum to 5 minutes. This is to avoid input of very low values which might overload the dexcom servers. * Added missin ';' * Fixed typoe in comment * Added test for default interval (not set in config) * Set lower limit to 1 second * Use auth tokens in api-secret (#5214) * Allow auth tokens to be passed in the api-secret header and used in the client in place of the API secret * Fix unit test * Fix admin test * Reload page when token is used as a secret * Fix dependency vulnerabilities * Added basal and bolus averages besides TDD and carbs (#4216) * Remove the leading 0 from the version, so we can comply to how version numbering should really work * Removed unsused var ic (#5288) * Use constants instead of number literals for http status codes (#5276) * Updated release name and number (#5280) * Allow use cgm-remote-monitor as npm package. (#4847) To use cgm-remote-monitor as npm package, the main attribute is required. * Add 4 hour option to view (#5289) * Revert &quot;change default back to 3HR&quot; This reverts commit e60ff3aa9d6c6cb18fe8b414d95cef09e76350b6. * shorten HR to H to avoid line-wrapping on mobile * try larger label font: 35 instead of 25 (vs. 40) * add comma * deviceInfo.recent null check * default back to 3, w/ 4 as an option * re-add H to single-digit hours * * Don't use cache manifest all all for development * Add 4 hours option to view and change the labelling to remove language issues * Have page scale the minor pill widths more gracefully * [Clock] Fix incorrect delta calculation (#5286) * Fix !delta check for delta == 0 * Fixed delta comparison * Hide unit suffix for SMBs issued by AndroidAPS (#4771) * Fix issues from `npm audit` * Read BG targets in using mmol when server is in mmol mode (#5291) * Read BG targets in using mmol when server is in mmol mode * Change the Heroku template to match the new logic * Deal with mmol targets being set using commas * Unbreak JSON serialization failing on the /properties API due to circular data reference * Bump version to 13.0.0 * Release ref update v2 (#5301) * Updated release name and number * Added missing version number * Added missing version number * Fix auth dialog sizing error (#5315) * Fix auth dialog sizing error (#5314) * Fix auth dialog sizing error * Fix Client Init After Auth (cherry picked from commit 1bf416c3bb964ed555850c3fc55977d69980b8e5) * update NS minor version * Release 13.0.1 (#5329) * Release ref update v2 (#5301) * Updated release name and number * Added missing version number * Added missing version number * Fix auth dialog sizing error (#5315) * Fix auth dialog sizing error (#5314) * Fix auth dialog sizing error * Fix Client Init After Auth (cherry picked from commit 1bf416c3bb964ed555850c3fc55977d69980b8e5) * update NS minor version * Bump version to 13.0.2-dev * fix some random test failures (#5341) * fix some random test failures * use typeof to test for existence * Added support for asking delta * Added time reference * Made delta reading more informative * Corrected time reference * Try shortening the response * Revert attempt * Updated templates and documentation * Minor improvement in response when delta is 0 * German translations improved and added (#5360) * Fix Alexa Launch and SessionEnded Requests (#5377) * Fix Alexa Launch Request * Allow LaunchRequest to handle intent if set, change shouldEndSession from string to bool * Fix SessionEndedRequest * Fix #5149 - discord link on CONTRIBUTING.md doesn't do anything (#5380) * Fix #5146 - display of treatment with only Fat and Protein set (#5381) * Basic report page style fixes and updates (#5387) * Add missing Polish translations and improve existing (#5382) * Add missing Polish translations and improve existing * Improve translations * Addressed virtual assistant usage with Authentication Roles (#5388) * Fix #5347 - Addressed auth roles * Unification * Fix timeago alarms (again). The changes to the rendered had an unintended consequence of triggering the timeago detection less frequently, causing the code to think the client has been hibernating, thus suppressing the alarms. The update changes the clock to be updated more frequently (this updating the hibernation detection), fixing the issue * Remove the server side test * Fix Graph Display Without Recent Devicestatus (#5409) * Update Russian (#5415) Corrected major and minor misprints and mistakes - particularly in variables, new translations added * Add server teardown ability (#5410) * adding teardown event to ctx.bus * adding teardown support for mmconnect and bridge plugins * Additional German Translations and corrections (#5405) * Cleaned up changed translations * Added Virtual Assistant Translations * Fix #5188 - move predictions to bundle and don't render chart on predictions offset change (#5395) * Fix #5188 - move predictions to bundle and don't render chart on predictions offset change * Fix predictions show for day to day * Move toolbar and authentication status to partial and include on each page (#5393) * Move authentication status to partial and include on each page * Move toolbar to partial Co-authored-by: Sulka Haro &lt;sulka@sulka.net&gt; * Virtual assistant code simplification (#5400) * Moved duplicate plugin code to single location, and small improvements * Defined _each() * Pr/5379 (#5441) * Release 13.0.1 (#5329) * Release ref update v2 (#5301) * Updated release name and number * Added missing version number * Added missing version number * Fix auth dialog sizing error (#5315) * Fix auth dialog sizing error (#5314) * Fix auth dialog sizing error * Fix Client Init After Auth (cherry picked from commit 1bf416c3bb964ed555850c3fc55977d69980b8e5) * update NS minor version * Added handlers and translations for CGM info * Defined translate() * Fixed sensor state reference * Improved wording for tx age response * Improved wording for session duration response * Updated documentation and templates * Updated README.md TOC and a reference to it * Added CGM battery info * Added unit reference to CGM battery levels * Added handlers and translations for CGM info * Defined translate() * Fixed sensor state reference * Improved wording for tx age response * Improved wording for session duration response * Updated documentation and templates * Updated README.md TOC and a reference to it * Added CGM battery info * Added unit reference to CGM battery levels * Updated API reference in Google Home template Co-authored-by: Caleb &lt;inventor96@users.noreply.github.com&gt; * Volunteer for Polish translations (#5396) * Api3 output renderers (#5425) * APIv3: adding framework for various output renderers * APIv3: adding xml output renderer * APIv3: adding csv output renderer * APIv3: documenting supported output renderers * APIv3: testing output renderers * Restore glucose distribution test (#5434) * Increase coverage of tests on units utility and clean up timeago test (#5435) * Increase coverage of tests on units utility * clean up timeago test * Refactor to encapsulate duplicated settings logic (#5426) * Encapsulate duplicate settings checks inside functions * Simplify settings::isAlarmEventEnabled() * Send coverage reports to Codacy (#5444) * Send coverage reports to Codacy * Action secrets may not be read from forks :( * Let's see if this fixes the path &amp; key passing * Ok one more try for the Actions env * Run tests and coverage separately * Try increasing the admintools test runtime for Node 10 * Run tests only once * Resolve unnecessary uses of eslint-ignore (#5436) * Resolve unnecessary disabling of no-undef eslint rule * Resolve unnecessary disabling of no-prototype-builtins eslint rule * Resolve unnecessary disabling of no-unused-vars eslint rule * Resolve unnecessary disabling of no-empty eslint rule * Fix eslint errors and add npm script for eslint (#5427) * re-enable auth check for device status routes * Resolve eslint errors * Add npm script for eslint * Correct regex for express extension middleware and add tests for expected behaviour * Resolve lint error in virtual assistant base * Update index.js * Update index.js * Remove redundant checks on entry ID (#5440) * Run CI Action for Pull Requests * Update DayToDay report for Loop Overrides (#5452) Add Loop override name/reason as text to the grey bar at the top of the graph. * Fix earlier merge error with predictions having moved to the report bundle * fix brushing loop (#5499) * Update README.md (#5480) Clarified that the &quot;bridge&quot; plugin is for Dexcom Share (&quot;Dexcom&quot; didn't appear at all in the read me), fixed a few typos, and added line 444 about the BRIDGE_SERVER variable. * Added period of days into headline of glucose distribution and percen… (#5428) * Added period of days into headline of glucose distribution and percentil chart report I make screencopies of the glucose distribution and percential chart report for my diabtes consultant and had to manually add the period of days to the report everytime because it was not shown in the report itself. I added the period of days this with a small number of lines of code and think this is helpful for other too. * removed comments as requested removed comments as requested * Camelcase for new variables reportPlugins, firstDay, lastDay, countDays * forget to save the change of reportPlugins in percentile.js * Move app caching to a service worker (#5504) * Move app caching to a webworker * Code cleanup * Code cleanup * Make Codacy happy * More parentheses * Added indexes to 'entries' and 'treatments' along with other updates (#5463) * Added compound indexes for treatments and entries collections. Updated ensureIndex to createIndex in mongo-strage.js as ensureIndex has been deprecated. Finally, updated testing/populate.js to be compatible with more recent versions of the node driver, as well as fixing a path issue. * Fixed missing end quote in lib/server/treatments.js. Changed all newly added double quotes to single quote to match style guide. * Removed indexes that referenced key600. * Fix: Round interporlated mg/dL value to an integer * Plugin to show database size (% of available space or in MiB) (#5496) * Database size plugin - pill that displays current mongoDB database size * Enabled dbsize by default * Fixed bug with dbsize not shownig when size is (rounded) 0% but real bytes &gt; 0 * Cleanup &amp; update to iconfont generation manual * Changed how warning/urgent levels are configured - from absolute MiB to percentage of DBSIZE_MAX * Trying to fix random fail of APIv3 tests (#5519) * APIv3: isolating documents from tests (not allowing clashes of calculated identifiers) * removing unused async keyword * client - mobile - Axis label font is scaled on small screens (#5512) On phones or other small screens, the axis labels (especially x axis) were previously an unreadable jumble of too-close letters * Split view (#5518) * Adds a 2, 3, 4 and 8 way split view option * Updated description * Generate the table on demand, so any number of sites from 1 to 8 generates a sensible layout * Update readme &amp; don't crash if a name is missing * Allow flagging specific settings to be not exposed the /properties and /status APIs (#5525) * Add more variables to the special list * [DEV][FIX] Fix dbsize plugin to make it hideable again (#5529) * [FIX] Making dbsize plugin default but hideable - removed its forced show state * Removed unused lodash dependency * Removed duplicate if statement (#5531) Removed the additional if statement checking for the loop specific developer team id. This since the exact same if statement existed just above it. * Update Dutch translations (#5532) * Fix settings test * Update version to 13.1.0 * Fix topbar collapse on small screens (#5562) * Fix top bar collapsing on small screens * Fix wide button array overflowing the button bar * Option to switch off bolus amount outputs (#5522) * Option to switch off bolus amount outputs (#5514) * Fixing issue with carb value not be output when set to &quot;none&quot; (#5514) * Adding additional output options (#5514) * Adding environment variable option for 'x U and Over' option. This option is BOLUS_RENDER_OVER with a default value of 1 and the value can be an integer or a float, e.g. 0.3, 1.5, 2, etc... * Adding change to change the font size depending on the bolus value. * Merge two &quot;all&quot; options to create an option that displays as SMB had. * Fix d3 portrait to landscape brush failure (#5638) * fix d3 portrait to landscape brush failure * fix client.renderer.test for highlighBrushPoints function prototype change * fix highlightBrush * move brush reset inside check for valid brush * Sanitize data from manual careportal entries so only fields with actual data are sent to the server (#5619) * do not redirect to profile editor by default (#5671) In a default configuration, there is no treatment data. The code to redirect the UI to the profile editor is buried deep within the chart rendering code for basals. This plugin is only supposed to go into action when enabled via ENABLE=basal. This commit fixes first-use experience for the default configuration intended to draw real-time CGM traces and no basal information is expected. Since no basal information is expected unless plugin is enabled via ENABLE=basal, this allows skipping instead of redirecting to the profile editor. * Fix Issue #5486 - Device Status Days Feature (#5651) * Device Status Days Feature * Edits per review from @sulkaharo * Configurable clock views (#5625) * Configurable clock views * Configurable clock views * Configurable clock views * Configurable clock views * Configurable clock views * Configurable clock views * Update README.md * Update README.md * Configurable clock views * Add remote bolus/carbs + otp entry for loop (#5598) Add a remote bolus entry field for users on Loop, along with support for an OTP field * Sometimes at the very start no profiles provided. (#5591) At the first start the nightscout is crashed if profile not full. * Fixes #4991 - Now selects basal profile based day by day (#5572) * Test profile settings * NPM Version change * Use console log * Use console log for client * Use console log for client.sbx * Use console log for client.ddata * Use console log for client again * revert * Added multi-profile reporting capabilities Co-authored-by: VIS TFS Admin &lt;liveid@visualsolution.co.uk&gt; * prepare hotfix for MMConnect/EU - 2020-06-28 Prepare to handle issue #5719. This patch adjusts dependencies to target a community edition fork of minimed-connect-to-nightscout. The new dependency targets information provided to begin addressing changes to Medtronic Carelink services starting late June 2020. * bump pointing at right tag * prepare hotfix for MMConnect/EU - 2020-06-28 Prepare to handle issue #5719. This patch adjusts dependencies to target a community edition fork of minimed-connect-to-nightscout. The new dependency targets information provided to begin addressing changes to Medtronic Carelink services starting late June 2020. * bump pointing at right tag * hotfix attempt 2 - carelink 2020 sso updates * hotfix 3 - attempt 3 at carelink 2020 sso updates * attempt 4 at hotfix for nightscout Based on more reliable version of minimed-connect-to-nightscout.... This is testing the hotfix. When it works, we will bump this one more time with the newly released version. * hotfix 5 - incorporates latest axios changes * Fix for boluscalc issue (#5729) Boluscalc fix &amp; remove integer validation from BG input field * npm install --save minimed-connect-to-nightscout@^1.4.0 * Change DISPLAY_UNITS to use readENV's default value and added several tests for DISPLAY_UNITS (#5708) readENV() was hard coding the default value of DISPLAY_UNITS, and ignoring the default value for no particular reason. Fixed that. Also, I added a full test suite for DISPLAY_UNITS environment settings to make sure that it works as intended. Finally, I've added the console log for the DISPLAY_UNITS since there's no particular reason why we log that setting and not others. * Fix audit errors, button order (#5694) * * Update packages giving npm audit errors * Fix Mongo test that broke after update (now uses async/await on getting the connection) * Restore original navigation bar button order * Disable Node 10 tests * Fix temporary target cancellation * Added documentation on the use of Alpha Testing (#5784) * Wip/bewest/mmconnect eu (#5731) * prepare hotfix for MMConnect/EU - 2020-06-28 Prepare to handle issue #5719. This patch adjusts dependencies to target a community edition fork of minimed-connect-to-nightscout. The new dependency targets information provided to begin addressing changes to Medtronic Carelink services starting late June 2020. * bump pointing at right tag * hotfix attempt 2 - carelink 2020 sso updates * hotfix 3 - attempt 3 at carelink 2020 sso updates * attempt 4 at hotfix for nightscout Based on more reliable version of minimed-connect-to-nightscout.... This is testing the hotfix. When it works, we will bump this one more time with the newly released version. Co-authored-by: Sulka Haro &lt;sulka@sulka.net&gt; * * Updated several packages to remove issues from NPM audit * Fix excess logging in settings.js * Removed heapdump package, which was causing issues for some users * * Limit the default number of profiles returned by the API to fix issues with users who are syncing a large amount of profiles from an APS. * Fix profile reporting * Upgrade Helmet to 4.0.0 * CSP and service worker improvements (#5856) * Add connectSrc for Safari compatibiity * Add new font URL for Google Fonts compatibility * Reload on re-registering the worker * Change Mongo version in github to fix builds * Serve the CSP to everyone * Split view CSP support (#5864) * Parse split view frames into frameAncestors * Re-enable CSP configuration (#5867) * Re-enable CSP configuration * Bump share2nightscout-bridge plugin Use latest update from share2nightscout bridge to make things easier. It contains an updated default for OUS users. * feat Add robots.txt to disallow site crawling * Fix dbsize for usage with Atlas (#5962) * Openaps performance improvement (#5945) * improve openaps plugin performance * more performance improvements (cherry picked from commit 076a2dd3b69093149994258eb0244ae61d68f44e) * correct setting notEnacted variable * remove unnecessary debug logging * Adapt to MongoDB Atlas (#5893) * Fix Issue #5763 - Change $.ajax to /api/v1/profile (#5704) * Bug fixes for Service Worker (#5970) * Fix service worker refresh for Firefox * Improve logging for service worker initialisation * Skip browser cache for service worker precaching * Prevent `Partial Content` responses in `fetch` by stripping `Range` header * Prevent calling `filter` on an undefined property when service worker cache is empty * Bug fixes for Service Worker * Fixes https://github.com/nightscout/cgm-remote-monitor/issues/5920 * Fixes https://github.com/nightscout/cgm-remote-monitor/issues/5943 * Update service-worker.js Removed the MP3 files from the preload to fix issues with webkit-based browsers Co-authored-by: p5nbTgip0r &lt;cb3f02c5@opayq.com&gt; Co-authored-by: Sulka Haro &lt;sulka@sulka.net&gt; * Optimize Nightscout database usage (#5947) * On periodic polls, only load delta for CGM data, treatments and device statuses * Serve basic CGM data API queries from in-memory cache. Increases the Nightscout memory footprint but should significantly reduce the Mongo load * Serve device status, CGM and treatment records from memory cache * Support count parameter in /profile * Bumping version to 14.0.0 given this is a relatively large update and we want people on Atlas to all migrate to this version * Remove logging statements * fix brushing recursion * Normalize treatments to support absolute doses from the amount field * Add Loop Carbs foodType, absorptionTime to Reports for ISSUE #5701 (#5702) * add carb foodType, absorptionTime to reports * Update README to point to new docs * Fix `Treatments` report for `mmol/L` users Fixed a typo to a client function name * Bump version to 14.0.1 * Bump dev to 14.0.2 * Serve Last-Modified header for the service worker to help with some browsers misdetecting caching * Cleaned old appcache references * * Remove unnecessary logging to help with Papertrail limits * Load more treatments and entries to fix caching issues (need to add better cache invalidation to really fix this) * When merging inserts and updates from the database, ensure we always use the new data over the old data * Bump treatment delta loading to four hours * One more increase to treatment load time to cover long overrides * * Bump version to 14.0.3 * Fix a bug in the REST API query for profiles * Bumped up the number of treatments loaded / day for reporting * Fix reports unit test * Bump treatments default limit default to 1000 objects for queries that include other query parameters * * Require created_at for Treatments on insert * Refactoring the cache: moved to another file and support flushing from bus events * Add support for CGM data and device statuses. Refactor dataloader to use the new model and reduce queries back down * Fix data order for REST API * * Add cache update events to websocket API * Remove the validation for created_at in REST API ;( * Remove excess logging * Bump version to .4 * Bump version to 14.0.5 and fix #6050 * Fix Pebble API detecting mmol units from settings * Make settings parsing whitespace tolerant * * Fix security test * Change boot and caching to expose Mongo connection errors * Don't report an error on every reconnect * Less intimidating error page on start, which also checks for api_secret * Add file missing from last commit * Fix tests * Remove require statement breaking deploys * Update --feature-request--.md * Update --bug-report.md * Update --individual-troubleshooting-help.md * Fix memory leak and cache update issues in 14.0.4 (#6133) * Fix a memory leak in 14.0.4 * Fix linter error in ddata.js * Move data retention periods to caching * Update _id of inserted entries and device status so merging to cache works correctly * Reset the data in ddata before updating * Fix typo on entry cache retention period * Have device status cache retention period follow configuration * Fix _id injection in treatments * Add error cat to error page * Fix MONGODB_URI reference in error message * Bump version to 14.0.6 * Support uploading device statuses in batches (#6147) * Support uploading device statuses in batches * Correctly report batch insertion results * Make empty cache detection a bit more aggressive to account for cache flush and data insert happening concurrently * Update README.md Explicitly link to the application template in Github Co-authored-by: inventor96 &lt;inventor96@gmail.com&gt; Co-authored-by: Sulka Haro &lt;sulka@sulka.net&gt; Co-authored-by: Jeremy Cunningham &lt;34543464+jpcunningh@users.noreply.github.com&gt; Co-authored-by: PetrOndrusek &lt;petr-ondrusek@seznam.cz&gt; Co-authored-by: Caleb &lt;inventor96@users.noreply.github.com&gt; Co-authored-by: Diabetlum &lt;44998140+diabetlum@users.noreply.github.com&gt; Co-authored-by: Willem Fibbe &lt;fibbers@gmail.com&gt; Co-authored-by: John Weston &lt;unsoluble@me.com&gt; Co-authored-by: ireneusz-ptak &lt;31506973+ireneusz-ptak@users.noreply.github.com&gt; Co-authored-by: Lukas Herzog &lt;git@lukasherzog.de&gt; Co-authored-by: Jeremy Cunningham &lt;jpcunningh@gmail.com&gt; Co-authored-by: Jake Bloom &lt;jake@steady.health&gt; Co-authored-by: David Jansson &lt;david.jansson81@gmail.com&gt; Co-authored-by: fedor apanasenko &lt;apanasef@gmail.com&gt; Co-authored-by: Jakob Sandberg &lt;jakobs@zillowgroup.com&gt; Co-authored-by: Jakob &lt;jakobsandberg95@gmail.com&gt; Co-authored-by: Asbjørn Aarrestad &lt;asbjorn@aarrestad.com&gt; Co-authored-by: lixgbg &lt;henrik.sjostrand@gmail.com&gt; Co-authored-by: Harmjan Greving &lt;harmjan@dynasign.nl&gt; Co-authored-by: Bluefox &lt;dogafox@gmail.com&gt; Co-authored-by: Cas Eliëns &lt;cas.eliens@gmail.com&gt; Co-authored-by: Tanja &lt;7403966+tanja3981@users.noreply.github.com&gt; Co-authored-by: Bartłomiej Szubert &lt;bartlomiejszubert@gmail.com&gt; Co-authored-by: Andrew Dixon &lt;andrew@andrewdixon.co.uk&gt; Co-authored-by: Petr Ondrusek &lt;34578008+PetrOndrusek@users.noreply.github.com&gt; Co-authored-by: Lukas Herzog &lt;mail@lukasherzog.de&gt; Co-authored-by: jonfawcett &lt;38429455+jonfawcett@users.noreply.github.com&gt; Co-authored-by: Jonas Hummelstrand &lt;jonas@hummelstrand.com&gt; Co-authored-by: peterleimbach &lt;peterleimbach@icloud.com&gt; Co-authored-by: Adam Harrison &lt;adamaharrison@gmail.com&gt; Co-authored-by: Dominik Dzienia &lt;dlvoy@users.noreply.github.com&gt; Co-authored-by: stephencmorton &lt;17858976+stephencmorton@users.noreply.github.com&gt; Co-authored-by: Simon Persson &lt;simon@akep.se&gt; Co-authored-by: Cas Eliëns &lt;cas.eliens@isaac.nl&gt; Co-authored-by: Ben West &lt;bewest@gmail.com&gt; Co-authored-by: Matthew &lt;mtfoley.mae@gmail.com&gt; Co-authored-by: josep1972 &lt;joseangelparedesd@gmail.com&gt; Co-authored-by: fromorbonia &lt;3193811+fromorbonia@users.noreply.github.com&gt; Co-authored-by: VIS TFS Admin &lt;liveid@visualsolution.co.uk&gt; Co-authored-by: joracine &lt;joracine@users.noreply.github.com&gt; Co-authored-by: Alexandre Viau &lt;alexandre@alexandreviau.net&gt; Co-authored-by: Lennart Goedhart &lt;lennart@omnibase.com.au&gt; Co-authored-by: p5nbTgip0r &lt;cb3f02c5@opayq.com&gt; Co-authored-by: kskandispersonal &lt;kskandis@live.com&gt;</MESSAGE>
      <SHA>103cfd422f37c61fce6eddb9051c3191594e1f1f</SHA>
      <PATCHEDFILES>
        <FILE>.eslintrc.js</FILE>
        <FILE>.github/ISSUE_TEMPLATE/--bug-report.md</FILE>
        <FILE>.github/ISSUE_TEMPLATE/--feature-request--.md</FILE>
        <FILE>.github/ISSUE_TEMPLATE/--individual-troubleshooting-help.md</FILE>
        <FILE>.github/workflows/main.yml</FILE>
        <FILE>.gitignore</FILE>
        <FILE>.travis.yml</FILE>
        <FILE>CONTRIBUTING.md</FILE>
        <FILE>Makefile</FILE>
        <FILE>README.md</FILE>
        <FILE>app.js</FILE>
        <FILE>app.json</FILE>
        <FILE>assets/fonts/Nightscout Plugin Icons.json</FILE>
        <FILE>assets/fonts/README.md</FILE>
        <FILE>azuredeploy.json</FILE>
        <FILE>bundle/bundle.reports.source.js</FILE>
        <FILE>bundle/bundle.source.js</FILE>
        <FILE>ci.test.env</FILE>
        <FILE>docs/plugins/add-virtual-assistant-support-to-plugin.md</FILE>
        <FILE>docs/plugins/alexa-plugin.md</FILE>
        <FILE>docs/plugins/alexa-templates/en-us.json</FILE>
        <FILE>docs/plugins/google-home-templates/en-us.zip</FILE>
        <FILE>docs/plugins/googlehome-plugin.md</FILE>
        <FILE>docs/plugins/interacting-with-virtual-assistants.md</FILE>
        <FILE>env.js</FILE>
        <FILE>lib/api/activity/index.js</FILE>
        <FILE>lib/api/alexa/index.js</FILE>
        <FILE>lib/api/const.json</FILE>
        <FILE>lib/api/devicestatus/index.js</FILE>
        <FILE>lib/api/entries/index.js</FILE>
        <FILE>lib/api/googlehome/index.js</FILE>
        <FILE>lib/api/index.js</FILE>
        <FILE>lib/api/notifications-api.js</FILE>
        <FILE>lib/api/notifications-v2.js</FILE>
        <FILE>lib/api/profile/index.js</FILE>
        <FILE>lib/api/properties.js</FILE>
        <FILE>lib/api/root.js</FILE>
        <FILE>lib/api/status.js</FILE>
        <FILE>lib/api/treatments/index.js</FILE>
        <FILE>lib/api/verifyauth.js</FILE>
        <FILE>lib/api3/const.json</FILE>
        <FILE>lib/api3/doc/formats.md</FILE>
        <FILE>lib/api3/doc/security.md</FILE>
        <FILE>lib/api3/doc/socket.md</FILE>
        <FILE>lib/api3/doc/tutorial.md</FILE>
        <FILE>lib/api3/generic/collection.js</FILE>
        <FILE>lib/api3/generic/create/insert.js</FILE>
        <FILE>lib/api3/generic/create/operation.js</FILE>
        <FILE>lib/api3/generic/create/validate.js</FILE>
        <FILE>lib/api3/generic/delete/operation.js</FILE>
        <FILE>lib/api3/generic/history/operation.js</FILE>
        <FILE>lib/api3/generic/patch/operation.js</FILE>
        <FILE>lib/api3/generic/patch/validate.js</FILE>
        <FILE>lib/api3/generic/read/operation.js</FILE>
        <FILE>lib/api3/generic/search/input.js</FILE>
        <FILE>lib/api3/generic/search/operation.js</FILE>
        <FILE>lib/api3/generic/setup.js</FILE>
        <FILE>lib/api3/generic/update/operation.js</FILE>
        <FILE>lib/api3/generic/update/replace.js</FILE>
        <FILE>lib/api3/generic/update/validate.js</FILE>
        <FILE>lib/api3/index.js</FILE>
        <FILE>lib/api3/security.js</FILE>
        <FILE>lib/api3/shared/dateTools.js</FILE>
        <FILE>lib/api3/shared/fieldsProjector.js</FILE>
        <FILE>lib/api3/shared/operationTools.js</FILE>
        <FILE>lib/api3/shared/renderer.js</FILE>
        <FILE>lib/api3/shared/storageTools.js</FILE>
        <FILE>lib/api3/shared/stringTools.js</FILE>
        <FILE>lib/api3/specific/lastModified.js</FILE>
        <FILE>lib/api3/specific/status.js</FILE>
        <FILE>lib/api3/specific/version.js</FILE>
        <FILE>lib/api3/storage/mongoCollection/find.js</FILE>
        <FILE>lib/api3/storage/mongoCollection/index.js</FILE>
        <FILE>lib/api3/storage/mongoCollection/modify.js</FILE>
        <FILE>lib/api3/storage/mongoCollection/utils.js</FILE>
        <FILE>lib/api3/storageSocket.js</FILE>
        <FILE>lib/api3/swagger.js</FILE>
        <FILE>lib/api3/swagger.yaml</FILE>
        <FILE>lib/authorization/index.js</FILE>
        <FILE>lib/authorization/storage.js</FILE>
        <FILE>lib/bus.js</FILE>
        <FILE>lib/client/browser-settings.js</FILE>
        <FILE>lib/client/browser-utils.js</FILE>
        <FILE>lib/client/careportal.js</FILE>
        <FILE>lib/client/chart.js</FILE>
        <FILE>lib/client/clock-client.js</FILE>
        <FILE>lib/client/d3locales.js</FILE>
        <FILE>lib/client/index.js</FILE>
        <FILE>lib/client/receiveddata.js</FILE>
        <FILE>lib/client/renderer.js</FILE>
        <FILE>lib/constants.json</FILE>
        <FILE>lib/data/calcdelta.js</FILE>
        <FILE>lib/data/dataloader.js</FILE>
        <FILE>lib/data/ddata.js</FILE>
        <FILE>lib/data/treatmenttocurve.js</FILE>
        <FILE>lib/hashauth.js</FILE>
        <FILE>lib/language.js</FILE>
        <FILE>lib/middleware/express-extension-to-accept.js</FILE>
        <FILE>lib/middleware/index.js</FILE>
        <FILE>lib/notifications.js</FILE>
        <FILE>lib/plugins/alexa.js</FILE>
        <FILE>lib/plugins/ar2.js</FILE>
        <FILE>lib/plugins/basalprofile.js</FILE>
        <FILE>lib/plugins/bridge.js</FILE>
        <FILE>lib/plugins/careportal.js</FILE>
        <FILE>lib/plugins/cob.js</FILE>
        <FILE>lib/plugins/dbsize.js</FILE>
        <FILE>lib/plugins/direction.js</FILE>
        <FILE>lib/plugins/googlehome.js</FILE>
        <FILE>lib/plugins/index.js</FILE>
        <FILE>lib/plugins/iob.js</FILE>
        <FILE>lib/plugins/loop.js</FILE>
        <FILE>lib/plugins/mmconnect.js</FILE>
        <FILE>lib/plugins/openaps.js</FILE>
        <FILE>lib/plugins/pluginbase.js</FILE>
        <FILE>lib/plugins/pump.js</FILE>
        <FILE>lib/plugins/rawbg.js</FILE>
        <FILE>lib/plugins/timeago.js</FILE>
        <FILE>lib/plugins/upbat.js</FILE>
        <FILE>lib/plugins/virtAsstBase.js</FILE>
        <FILE>lib/plugins/xdripjs.js</FILE>
        <FILE>lib/profilefunctions.js</FILE>
        <FILE>lib/report/predictions.js</FILE>
        <FILE>lib/report_plugins/calibrations.js</FILE>
        <FILE>lib/report_plugins/daytoday.js</FILE>
        <FILE>lib/report_plugins/glucosedistribution.js</FILE>
        <FILE>lib/report_plugins/loopalyzer.js</FILE>
        <FILE>lib/report_plugins/percentile.js</FILE>
        <FILE>lib/report_plugins/profiles.js</FILE>
        <FILE>lib/report_plugins/treatments.js</FILE>
        <FILE>lib/report_plugins/utils.js</FILE>
        <FILE>lib/report_plugins/weektoweek.js</FILE>
        <FILE>lib/sandbox.js</FILE>
        <FILE>lib/server/booterror.js</FILE>
        <FILE>lib/server/bootevent.js</FILE>
        <FILE>lib/server/cache.js</FILE>
        <FILE>lib/server/clocks.js</FILE>
        <FILE>lib/server/devicestatus.js</FILE>
        <FILE>lib/server/entries.js</FILE>
        <FILE>lib/server/loop.js</FILE>
        <FILE>lib/server/pebble.js</FILE>
        <FILE>lib/server/profile.js</FILE>
        <FILE>lib/server/pushnotify.js</FILE>
        <FILE>lib/server/treatments.js</FILE>
        <FILE>lib/server/websocket.js</FILE>
        <FILE>lib/settings.js</FILE>
        <FILE>lib/storage/mongo-storage.js</FILE>
        <FILE>lib/units.js</FILE>
        <FILE>lib/utils.js</FILE>
        <FILE>npm-shrinkwrap.json</FILE>
        <FILE>package.json</FILE>
        <FILE>server.js</FILE>
        <FILE>static/css/drawer.css</FILE>
        <FILE>static/css/main.css</FILE>
        <FILE>static/css/report.css</FILE>
        <FILE>static/css/translations.css</FILE>
        <FILE>static/images/browserstack-logo.png</FILE>
        <FILE>static/images/errorcat.jpg</FILE>
        <FILE>static/profile/js/profileeditor.js</FILE>
        <FILE>static/report/js/predictions.js</FILE>
        <FILE>static/report/js/report.js</FILE>
        <FILE>static/robots.txt</FILE>
        <FILE>swagger.json</FILE>
        <FILE>swagger.yaml</FILE>
        <FILE>test</FILE>
        <FILE>testing/populate.js</FILE>
        <FILE>tests/admintools.test.js</FILE>
        <FILE>tests/api.alexa.test.js</FILE>
        <FILE>tests/api.devicestatus.test.js</FILE>
        <FILE>tests/api.root.test.js</FILE>
        <FILE>tests/api.treatments.test.js</FILE>
        <FILE>tests/api.verifyauth.test.js</FILE>
        <FILE>tests/api3.basic.test.js</FILE>
        <FILE>tests/api3.create.test.js</FILE>
        <FILE>tests/api3.delete.test.js</FILE>
        <FILE>tests/api3.generic.workflow.test.js</FILE>
        <FILE>tests/api3.patch.test.js</FILE>
        <FILE>tests/api3.read.test.js</FILE>
        <FILE>tests/api3.renderer.test.js</FILE>
        <FILE>tests/api3.search.test.js</FILE>
        <FILE>tests/api3.security.test.js</FILE>
        <FILE>tests/api3.socket.test.js</FILE>
        <FILE>tests/api3.update.test.js</FILE>
        <FILE>tests/ar2.test.js</FILE>
        <FILE>tests/basalprofileplugin.test.js</FILE>
        <FILE>tests/bgnow.test.js</FILE>
        <FILE>tests/bridge.test.js</FILE>
        <FILE>tests/careportal.test.js</FILE>
        <FILE>tests/client.renderer.test.js</FILE>
        <FILE>tests/cob.test.js</FILE>
        <FILE>tests/dbsize.test.js</FILE>
        <FILE>tests/ddata.test.js</FILE>
        <FILE>tests/env.test.js</FILE>
        <FILE>tests/expressextensions.test.js</FILE>
        <FILE>tests/fail.test.js</FILE>
        <FILE>tests/fixtures/api/instance.js</FILE>
        <FILE>tests/fixtures/api3/authSubject.js</FILE>
        <FILE>tests/fixtures/api3/const.json</FILE>
        <FILE>tests/fixtures/api3/instance.js</FILE>
        <FILE>tests/fixtures/api3/localhost.crt</FILE>
        <FILE>tests/fixtures/api3/localhost.key</FILE>
        <FILE>tests/fixtures/api3/utils.js</FILE>
        <FILE>tests/iob.test.js</FILE>
        <FILE>tests/loop.test.js</FILE>
        <FILE>tests/mongo-storage.test.js</FILE>
        <FILE>tests/openaps.test.js</FILE>
        <FILE>tests/profile.test.js</FILE>
        <FILE>tests/profileeditor.test.js</FILE>
        <FILE>tests/pump.test.js</FILE>
        <FILE>tests/rawbg.test.js</FILE>
        <FILE>tests/reports.test.js</FILE>
        <FILE>tests/security.test.js</FILE>
        <FILE>tests/settings.test.js</FILE>
        <FILE>tests/timeago.test.js</FILE>
        <FILE>tests/units.test.js</FILE>
        <FILE>tests/upbat.test.js</FILE>
        <FILE>views/adminindex.html</FILE>
        <FILE>views/clockviews/bgclock.css</FILE>
        <FILE>views/clockviews/clock-color.css</FILE>
        <FILE>views/clockviews/clock-config.css</FILE>
        <FILE>views/clockviews/clock-config.html</FILE>
        <FILE>views/clockviews/clock-shared.css</FILE>
        <FILE>views/clockviews/clock.css</FILE>
        <FILE>views/clockviews/clock.html</FILE>
        <FILE>views/error.html</FILE>
        <FILE>views/foodindex.html</FILE>
        <FILE>views/frame.html</FILE>
        <FILE>views/index.html</FILE>
        <FILE>views/nightscout.appcache</FILE>
        <FILE>views/partials/authentication-status.ejs</FILE>
        <FILE>views/partials/toolbar.ejs</FILE>
        <FILE>views/profileindex.html</FILE>
        <FILE>views/reportindex.html</FILE>
        <FILE>views/service-worker.js</FILE>
        <FILE>views/translationsindex.html</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>M e r g e (#4) * Performance fixes (#5134) * Further fixes to profile data fetches, change the client to not create excessive amount of date objects * Sort entries once on load and then rely on the sorting to find out the largest and smallest value * Make the renderer reuse Date objects instead of instantiating a huge amount of dates all the time * Don't load retro data if not needed. Merge retro data faster if it's present. (#5141) * Updated Alexa template to comply with new requirements * Load data in one pass (#5142) * Fix layouting and load data in one go. Bonus points if you can fix the rendering for this * fix focus target lines and high and low lines * Remove debug logging. Change profile functions to clear the cache on new data, instead of calculating heavy hashes * Remove unused code * Fix tests * Have Travis run tests on Node 10 and 12, not 13 * D3 Upgrade Residual Cleanup (#5140) * fix forecast limit logic (cherry picked from commit e88ce7e5d1f5fb12c71ae67da4131ff1a50940c9) * fix minimum focus forecast time * make min forecast 30 min * fix forecast time max to client focusRangeMS instead of 30 min (#5143) * Fix initial forecast point display * Fix forecast time randomly resetting to 30 minutes for openaps users * Stop Focus Circles from Eating Entries (#5145) * stop focus circles from eating entries * fix forecastCircles remove * resolve possible key collision * Fixes a major bug where plugins were ran against a sandbox twice, causing issues with predictions. Fixes the look ahead timings. * Fix forecast behaviour (#5160) * stop focus circles from eating entries * fix forecastCircles remove * resolve possible key collision * Fixes a major bug where plugins were ran against a sandbox twice, causing issues with predictions. Fixes the look ahead timings. * Refactor of how prediction data is collected * Update node pushover library to fix crash in case Pushover service is down * adding list of supported APIs versions (GET /api/versions) * Fixed a few missing definitions * API3: add locking documents using isReadOnly flag * Translation improvements * Defined `translate()` in upbat plugin * Migrated titles to use translate() * Migrated static intent titles to use translate() * Misc fixes for tests (even though they didn't fail ) * API3: testing isReadOnly feature * API3: more readonly field name variants * Added instructions on how to update skills/agents * fix devicestatus retro merge (#5193) * Turkish language updates (#5192) * Turkish language updates * in to Languages Part Turkish added * in to Languages Part Turkish added * Fix falsely suspended timeago alarms (#5170) * Fix continuous suspension of the timeago alerts The default hearbeat-setting is 60 seconds, so the delta between two timeago-checks will always be &gt;15 seconds and the timeago-alarms will always be suspended (that's what Papertrail also shows). To fix this, make the delta-check heartbeat-setting-dependant and also simplify the code by using just 1 variable. * Add test that verifies the hibernation detection behaviour The real-world test would be to actually wait for a couple of minutes (with 2 * heartbeat of default settings) in the unit test, but this is not feasible, so just modify the heartbeat-setting to a lower value. I tested it by only running tests inside `tests/timeago.test.js` and by actually deploying this code and testing the alarms with Pushover and reading the logs in Papertrail. Before this change, I saw a 'Hibernation detected' log every minute. After this change, I didn't see it anymore, probably because the app wasn't actually hibernated (yet). * Take sulkaharo's feedback into account and differentiate between client and server (by introducing it in sandbox.js). On the client the behaviour is different from the server: &gt; On client, the issue is browsers stop the execution of JS if the window is not &gt; visible and the alarm is falsely triggered immediately when the execution is &gt; resumed, so we need to suspend the alarm for ~10 seconds after the execution has &gt; resumed to give the client time to update the data to prevent false alarms. While on the server, the default heartbeat from 60s needs to be taken into account to prevent the timeago alarm from falsely triggering. So detect hibernation there if the last check was more than 2 heartbeats ago. * Fix the tests by adding settings to the context, which is now required by timeago. Also, change the timeago test a bit so that it both succeeds when testing in isolation as when testing it along with the other tests. * Adding to #5121 (#5126) * changed gitter shield to discord * changed discord shield text to discord chat instead of just chat * changed gitter shield to discord * need to fix my md error * Update CONTRIBUTING.md Few more tweaks * Update CONTRIBUTING.md * Update CONTRIBUTING.md * Update README.md Change Discord URL to be an invite link instead of a direct link to the channel (which doesn't work if you're not already in it). * Extra info (delta and last measurement time) on clock view. (#5151) * Parametrized clock view * Parametrized clock view * Wording tweaks to go with #4810 (#4866) * mmol/L wording tweak in Readme * Various wording &amp; clarity tweaks in the Readme * Heroku template update to reflect mmol allowance tweak * Update README.md * Update minimum device requirements Ran some proper browser test suites, determined actual minimum specs for the main site. * GitHub actions build (#5168) * Run tests using GitHub Actions * Node 10 * Test CI fails * Use npm to run tests * Fix package json to run tests * Enable v3 TEST api for both development env and CI * Run CI on both Node 10 and 12 * Allow downgrading Mongo * Move the units configuration detection to a place where it's guaranteed to catch all invocations * Fix the check for environments without the units setting * Rename xdrip-js to xdripjs (#4959) * rename xdrip-js to xdripjs * update readme for xdrip-js name change * update from CGM to XDRIPJS label * change label from all caps to mixed case for xDripJS * change pill label back to CGM * Added customization step for Alexa skill updates * Language Update: added missing German Translations (#5172) * language Update devicestatus collection * language Update Admin-Tools * changed wording for admin authorization * typo corrected (admin auth) * language Updates for Admin Tools database cleanups * Don't use dynamic scale unless entries in database (#5195) * don't use dynamic scale unless have entries * fix report crash when no entries * set forecastTime correctly when no entries present * Language Matters: change &quot;Normal&quot; to &quot;In Range&quot; in glucose distribution reports * Added/updated TOC's * set auth dialog width to client width if smaller than default width * More hebrew translations * Added note regarding the use of the Alexa online simulator * fix focus scale hour format * trip open-top size to fit * fix clearing alarming when clearning CurrentSGV * do not set direction if not current * Handled 0 for pump reservoir * rollback npm-shrinkwrap.json * Fix for distributionpage bug that caused hour 23 to always be active even after uncheck * Russian translation update edit * Use default entries count instead of distributed number literals * Handle mmol to mgdl conversions with a constant reference (#5274) * Added sanity check for the bridge interval value (#4717) * Added sanity check for the bridge interval value, setting minimum allowed value to 30 seconds and maximum to 5 minutes. This is to avoid input of very low values which might overload the dexcom servers. * Added missin ';' * Fixed typoe in comment * Added test for default interval (not set in config) * Set lower limit to 1 second * Use auth tokens in api-secret (#5214) * Allow auth tokens to be passed in the api-secret header and used in the client in place of the API secret * Fix unit test * Fix admin test * Reload page when token is used as a secret * Fix dependency vulnerabilities * Added basal and bolus averages besides TDD and carbs (#4216) * Remove the leading 0 from the version, so we can comply to how version numbering should really work * Removed unsused var ic (#5288) * Use constants instead of number literals for http status codes (#5276) * Updated release name and number (#5280) * Allow use cgm-remote-monitor as npm package. (#4847) To use cgm-remote-monitor as npm package, the main attribute is required. * Add 4 hour option to view (#5289) * Revert &quot;change default back to 3HR&quot; This reverts commit e60ff3aa9d6c6cb18fe8b414d95cef09e76350b6. * shorten HR to H to avoid line-wrapping on mobile * try larger label font: 35 instead of 25 (vs. 40) * add comma * deviceInfo.recent null check * default back to 3, w/ 4 as an option * re-add H to single-digit hours * * Don't use cache manifest all all for development * Add 4 hours option to view and change the labelling to remove language issues * Have page scale the minor pill widths more gracefully * [Clock] Fix incorrect delta calculation (#5286) * Fix !delta check for delta == 0 * Fixed delta comparison * Hide unit suffix for SMBs issued by AndroidAPS (#4771) * Fix issues from `npm audit` * Read BG targets in using mmol when server is in mmol mode (#5291) * Read BG targets in using mmol when server is in mmol mode * Change the Heroku template to match the new logic * Deal with mmol targets being set using commas * Unbreak JSON serialization failing on the /properties API due to circular data reference * Bump version to 13.0.0 * Release ref update v2 (#5301) * Updated release name and number * Added missing version number * Added missing version number * Fix auth dialog sizing error (#5315) * Fix auth dialog sizing error (#5314) * Fix auth dialog sizing error * Fix Client Init After Auth (cherry picked from commit 1bf416c3bb964ed555850c3fc55977d69980b8e5) * update NS minor version * Release 13.0.1 (#5329) * Release ref update v2 (#5301) * Updated release name and number * Added missing version number * Added missing version number * Fix auth dialog sizing error (#5315) * Fix auth dialog sizing error (#5314) * Fix auth dialog sizing error * Fix Client Init After Auth (cherry picked from commit 1bf416c3bb964ed555850c3fc55977d69980b8e5) * update NS minor version * Bump version to 13.0.2-dev * fix some random test failures (#5341) * fix some random test failures * use typeof to test for existence * Added support for asking delta * Added time reference * Made delta reading more informative * Corrected time reference * Try shortening the response * Revert attempt * Updated templates and documentation * Minor improvement in response when delta is 0 * German translations improved and added (#5360) * Fix Alexa Launch and SessionEnded Requests (#5377) * Fix Alexa Launch Request * Allow LaunchRequest to handle intent if set, change shouldEndSession from string to bool * Fix SessionEndedRequest * Fix #5149 - discord link on CONTRIBUTING.md doesn't do anything (#5380) * Fix #5146 - display of treatment with only Fat and Protein set (#5381) * Basic report page style fixes and updates (#5387) * Add missing Polish translations and improve existing (#5382) * Add missing Polish translations and improve existing * Improve translations * Addressed virtual assistant usage with Authentication Roles (#5388) * Fix #5347 - Addressed auth roles * Unification * Fix timeago alarms (again). The changes to the rendered had an unintended consequence of triggering the timeago detection less frequently, causing the code to think the client has been hibernating, thus suppressing the alarms. The update changes the clock to be updated more frequently (this updating the hibernation detection), fixing the issue * Remove the server side test * Fix Graph Display Without Recent Devicestatus (#5409) * Update Russian (#5415) Corrected major and minor misprints and mistakes - particularly in variables, new translations added * Add server teardown ability (#5410) * adding teardown event to ctx.bus * adding teardown support for mmconnect and bridge plugins * Additional German Translations and corrections (#5405) * Cleaned up changed translations * Added Virtual Assistant Translations * Fix #5188 - move predictions to bundle and don't render chart on predictions offset change (#5395) * Fix #5188 - move predictions to bundle and don't render chart on predictions offset change * Fix predictions show for day to day * Move toolbar and authentication status to partial and include on each page (#5393) * Move authentication status to partial and include on each page * Move toolbar to partial Co-authored-by: Sulka Haro &lt;sulka@sulka.net&gt; * Virtual assistant code simplification (#5400) * Moved duplicate plugin code to single location, and small improvements * Defined _each() * Pr/5379 (#5441) * Release 13.0.1 (#5329) * Release ref update v2 (#5301) * Updated release name and number * Added missing version number * Added missing version number * Fix auth dialog sizing error (#5315) * Fix auth dialog sizing error (#5314) * Fix auth dialog sizing error * Fix Client Init After Auth (cherry picked from commit 1bf416c3bb964ed555850c3fc55977d69980b8e5) * update NS minor version * Added handlers and translations for CGM info * Defined translate() * Fixed sensor state reference * Improved wording for tx age response * Improved wording for session duration response * Updated documentation and templates * Updated README.md TOC and a reference to it * Added CGM battery info * Added unit reference to CGM battery levels * Added handlers and translations for CGM info * Defined translate() * Fixed sensor state reference * Improved wording for tx age response * Improved wording for session duration response * Updated documentation and templates * Updated README.md TOC and a reference to it * Added CGM battery info * Added unit reference to CGM battery levels * Updated API reference in Google Home template Co-authored-by: Caleb &lt;inventor96@users.noreply.github.com&gt; * Volunteer for Polish translations (#5396) * Api3 output renderers (#5425) * APIv3: adding framework for various output renderers * APIv3: adding xml output renderer * APIv3: adding csv output renderer * APIv3: documenting supported output renderers * APIv3: testing output renderers * Restore glucose distribution test (#5434) * Increase coverage of tests on units utility and clean up timeago test (#5435) * Increase coverage of tests on units utility * clean up timeago test * Refactor to encapsulate duplicated settings logic (#5426) * Encapsulate duplicate settings checks inside functions * Simplify settings::isAlarmEventEnabled() * Send coverage reports to Codacy (#5444) * Send coverage reports to Codacy * Action secrets may not be read from forks :( * Let's see if this fixes the path &amp; key passing * Ok one more try for the Actions env * Run tests and coverage separately * Try increasing the admintools test runtime for Node 10 * Run tests only once * Resolve unnecessary uses of eslint-ignore (#5436) * Resolve unnecessary disabling of no-undef eslint rule * Resolve unnecessary disabling of no-prototype-builtins eslint rule * Resolve unnecessary disabling of no-unused-vars eslint rule * Resolve unnecessary disabling of no-empty eslint rule * Fix eslint errors and add npm script for eslint (#5427) * re-enable auth check for device status routes * Resolve eslint errors * Add npm script for eslint * Correct regex for express extension middleware and add tests for expected behaviour * Resolve lint error in virtual assistant base * Update index.js * Update index.js * Remove redundant checks on entry ID (#5440) * Run CI Action for Pull Requests * Update DayToDay report for Loop Overrides (#5452) Add Loop override name/reason as text to the grey bar at the top of the graph. * Fix earlier merge error with predictions having moved to the report bundle * fix brushing loop (#5499) * Update README.md (#5480) Clarified that the &quot;bridge&quot; plugin is for Dexcom Share (&quot;Dexcom&quot; didn't appear at all in the read me), fixed a few typos, and added line 444 about the BRIDGE_SERVER variable. * Added period of days into headline of glucose distribution and percen… (#5428) * Added period of days into headline of glucose distribution and percentil chart report I make screencopies of the glucose distribution and percential chart report for my diabtes consultant and had to manually add the period of days to the report everytime because it was not shown in the report itself. I added the period of days this with a small number of lines of code and think this is helpful for other too. * removed comments as requested removed comments as requested * Camelcase for new variables reportPlugins, firstDay, lastDay, countDays * forget to save the change of reportPlugins in percentile.js * Move app caching to a service worker (#5504) * Move app caching to a webworker * Code cleanup * Code cleanup * Make Codacy happy * More parentheses * Added indexes to 'entries' and 'treatments' along with other updates (#5463) * Added compound indexes for treatments and entries collections. Updated ensureIndex to createIndex in mongo-strage.js as ensureIndex has been deprecated. Finally, updated testing/populate.js to be compatible with more recent versions of the node driver, as well as fixing a path issue. * Fixed missing end quote in lib/server/treatments.js. Changed all newly added double quotes to single quote to match style guide. * Removed indexes that referenced key600. * Fix: Round interporlated mg/dL value to an integer * Plugin to show database size (% of available space or in MiB) (#5496) * Database size plugin - pill that displays current mongoDB database size * Enabled dbsize by default * Fixed bug with dbsize not shownig when size is (rounded) 0% but real bytes &gt; 0 * Cleanup &amp; update to iconfont generation manual * Changed how warning/urgent levels are configured - from absolute MiB to percentage of DBSIZE_MAX * Trying to fix random fail of APIv3 tests (#5519) * APIv3: isolating documents from tests (not allowing clashes of calculated identifiers) * removing unused async keyword * client - mobile - Axis label font is scaled on small screens (#5512) On phones or other small screens, the axis labels (especially x axis) were previously an unreadable jumble of too-close letters * Split view (#5518) * Adds a 2, 3, 4 and 8 way split view option * Updated description * Generate the table on demand, so any number of sites from 1 to 8 generates a sensible layout * Update readme &amp; don't crash if a name is missing * Allow flagging specific settings to be not exposed the /properties and /status APIs (#5525) * Add more variables to the special list * [DEV][FIX] Fix dbsize plugin to make it hideable again (#5529) * [FIX] Making dbsize plugin default but hideable - removed its forced show state * Removed unused lodash dependency * Removed duplicate if statement (#5531) Removed the additional if statement checking for the loop specific developer team id. This since the exact same if statement existed just above it. * Update Dutch translations (#5532) * Fix settings test * Update version to 13.1.0 * Fix topbar collapse on small screens (#5562) * Fix top bar collapsing on small screens * Fix wide button array overflowing the button bar * Option to switch off bolus amount outputs (#5522) * Option to switch off bolus amount outputs (#5514) * Fixing issue with carb value not be output when set to &quot;none&quot; (#5514) * Adding additional output options (#5514) * Adding environment variable option for 'x U and Over' option. This option is BOLUS_RENDER_OVER with a default value of 1 and the value can be an integer or a float, e.g. 0.3, 1.5, 2, etc... * Adding change to change the font size depending on the bolus value. * Merge two &quot;all&quot; options to create an option that displays as SMB had. * Fix d3 portrait to landscape brush failure (#5638) * fix d3 portrait to landscape brush failure * fix client.renderer.test for highlighBrushPoints function prototype change * fix highlightBrush * move brush reset inside check for valid brush * Sanitize data from manual careportal entries so only fields with actual data are sent to the server (#5619) * do not redirect to profile editor by default (#5671) In a default configuration, there is no treatment data. The code to redirect the UI to the profile editor is buried deep within the chart rendering code for basals. This plugin is only supposed to go into action when enabled via ENABLE=basal. This commit fixes first-use experience for the default configuration intended to draw real-time CGM traces and no basal information is expected. Since no basal information is expected unless plugin is enabled via ENABLE=basal, this allows skipping instead of redirecting to the profile editor. * Fix Issue #5486 - Device Status Days Feature (#5651) * Device Status Days Feature * Edits per review from @sulkaharo * Configurable clock views (#5625) * Configurable clock views * Configurable clock views * Configurable clock views * Configurable clock views * Configurable clock views * Configurable clock views * Update README.md * Update README.md * Configurable clock views * Add remote bolus/carbs + otp entry for loop (#5598) Add a remote bolus entry field for users on Loop, along with support for an OTP field * Sometimes at the very start no profiles provided. (#5591) At the first start the nightscout is crashed if profile not full. * Fixes #4991 - Now selects basal profile based day by day (#5572) * Test profile settings * NPM Version change * Use console log * Use console log for client * Use console log for client.sbx * Use console log for client.ddata * Use console log for client again * revert * Added multi-profile reporting capabilities Co-authored-by: VIS TFS Admin &lt;liveid@visualsolution.co.uk&gt; * prepare hotfix for MMConnect/EU - 2020-06-28 Prepare to handle issue #5719. This patch adjusts dependencies to target a community edition fork of minimed-connect-to-nightscout. The new dependency targets information provided to begin addressing changes to Medtronic Carelink services starting late June 2020. * bump pointing at right tag * prepare hotfix for MMConnect/EU - 2020-06-28 Prepare to handle issue #5719. This patch adjusts dependencies to target a community edition fork of minimed-connect-to-nightscout. The new dependency targets information provided to begin addressing changes to Medtronic Carelink services starting late June 2020. * bump pointing at right tag * hotfix attempt 2 - carelink 2020 sso updates * hotfix 3 - attempt 3 at carelink 2020 sso updates * attempt 4 at hotfix for nightscout Based on more reliable version of minimed-connect-to-nightscout.... This is testing the hotfix. When it works, we will bump this one more time with the newly released version. * hotfix 5 - incorporates latest axios changes * Fix for boluscalc issue (#5729) Boluscalc fix &amp; remove integer validation from BG input field * npm install --save minimed-connect-to-nightscout@^1.4.0 * Change DISPLAY_UNITS to use readENV's default value and added several tests for DISPLAY_UNITS (#5708) readENV() was hard coding the default value of DISPLAY_UNITS, and ignoring the default value for no particular reason. Fixed that. Also, I added a full test suite for DISPLAY_UNITS environment settings to make sure that it works as intended. Finally, I've added the console log for the DISPLAY_UNITS since there's no particular reason why we log that setting and not others. * Fix audit errors, button order (#5694) * * Update packages giving npm audit errors * Fix Mongo test that broke after update (now uses async/await on getting the connection) * Restore original navigation bar button order * Disable Node 10 tests * Fix temporary target cancellation * Added documentation on the use of Alpha Testing (#5784) * Wip/bewest/mmconnect eu (#5731) * prepare hotfix for MMConnect/EU - 2020-06-28 Prepare to handle issue #5719. This patch adjusts dependencies to target a community edition fork of minimed-connect-to-nightscout. The new dependency targets information provided to begin addressing changes to Medtronic Carelink services starting late June 2020. * bump pointing at right tag * hotfix attempt 2 - carelink 2020 sso updates * hotfix 3 - attempt 3 at carelink 2020 sso updates * attempt 4 at hotfix for nightscout Based on more reliable version of minimed-connect-to-nightscout.... This is testing the hotfix. When it works, we will bump this one more time with the newly released version. Co-authored-by: Sulka Haro &lt;sulka@sulka.net&gt; * * Updated several packages to remove issues from NPM audit * Fix excess logging in settings.js * Removed heapdump package, which was causing issues for some users * * Limit the default number of profiles returned by the API to fix issues with users who are syncing a large amount of profiles from an APS. * Fix profile reporting * Upgrade Helmet to 4.0.0 * CSP and service worker improvements (#5856) * Add connectSrc for Safari compatibiity * Add new font URL for Google Fonts compatibility * Reload on re-registering the worker * Change Mongo version in github to fix builds * Serve the CSP to everyone * Split view CSP support (#5864) * Parse split view frames into frameAncestors * Re-enable CSP configuration (#5867) * Re-enable CSP configuration * Bump share2nightscout-bridge plugin Use latest update from share2nightscout bridge to make things easier. It contains an updated default for OUS users. * feat Add robots.txt to disallow site crawling * Fix dbsize for usage with Atlas (#5962) * Openaps performance improvement (#5945) * improve openaps plugin performance * more performance improvements (cherry picked from commit 076a2dd3b69093149994258eb0244ae61d68f44e) * correct setting notEnacted variable * remove unnecessary debug logging * Adapt to MongoDB Atlas (#5893) * Fix Issue #5763 - Change $.ajax to /api/v1/profile (#5704) * Bug fixes for Service Worker (#5970) * Fix service worker refresh for Firefox * Improve logging for service worker initialisation * Skip browser cache for service worker precaching * Prevent `Partial Content` responses in `fetch` by stripping `Range` header * Prevent calling `filter` on an undefined property when service worker cache is empty * Bug fixes for Service Worker * Fixes https://github.com/nightscout/cgm-remote-monitor/issues/5920 * Fixes https://github.com/nightscout/cgm-remote-monitor/issues/5943 * Update service-worker.js Removed the MP3 files from the preload to fix issues with webkit-based browsers Co-authored-by: p5nbTgip0r &lt;cb3f02c5@opayq.com&gt; Co-authored-by: Sulka Haro &lt;sulka@sulka.net&gt; * Optimize Nightscout database usage (#5947) * On periodic polls, only load delta for CGM data, treatments and device statuses * Serve basic CGM data API queries from in-memory cache. Increases the Nightscout memory footprint but should significantly reduce the Mongo load * Serve device status, CGM and treatment records from memory cache * Support count parameter in /profile * Bumping version to 14.0.0 given this is a relatively large update and we want people on Atlas to all migrate to this version * Remove logging statements * fix brushing recursion * Normalize treatments to support absolute doses from the amount field * Add Loop Carbs foodType, absorptionTime to Reports for ISSUE #5701 (#5702) * add carb foodType, absorptionTime to reports * Update README to point to new docs * Fix `Treatments` report for `mmol/L` users Fixed a typo to a client function name * Bump version to 14.0.1 * Bump dev to 14.0.2 * Serve Last-Modified header for the service worker to help with some browsers misdetecting caching * Cleaned old appcache references * * Remove unnecessary logging to help with Papertrail limits * Load more treatments and entries to fix caching issues (need to add better cache invalidation to really fix this) * When merging inserts and updates from the database, ensure we always use the new data over the old data * Bump treatment delta loading to four hours * One more increase to treatment load time to cover long overrides * * Bump version to 14.0.3 * Fix a bug in the REST API query for profiles * Bumped up the number of treatments loaded / day for reporting * Fix reports unit test * Bump treatments default limit default to 1000 objects for queries that include other query parameters * * Require created_at for Treatments on insert * Refactoring the cache: moved to another file and support flushing from bus events * Add support for CGM data and device statuses. Refactor dataloader to use the new model and reduce queries back down * Fix data order for REST API * * Add cache update events to websocket API * Remove the validation for created_at in REST API ;( * Remove excess logging * Bump version to .4 * Bump version to 14.0.5 and fix #6050 * Fix Pebble API detecting mmol units from settings * Make settings parsing whitespace tolerant * * Fix security test * Change boot and caching to expose Mongo connection errors * Don't report an error on every reconnect * Less intimidating error page on start, which also checks for api_secret * Add file missing from last commit * Fix tests * Remove require statement breaking deploys * Update --feature-request--.md * Update --bug-report.md * Update --individual-troubleshooting-help.md * Fix memory leak and cache update issues in 14.0.4 (#6133) * Fix a memory leak in 14.0.4 * Fix linter error in ddata.js * Move data retention periods to caching * Update _id of inserted entries and device status so merging to cache works correctly * Reset the data in ddata before updating * Fix typo on entry cache retention period * Have device status cache retention period follow configuration * Fix _id injection in treatments * Add error cat to error page * Fix MONGODB_URI reference in error message * Bump version to 14.0.6 * Support uploading device statuses in batches (#6147) * Support uploading device statuses in batches * Correctly report batch insertion results * Make empty cache detection a bit more aggressive to account for cache flush and data insert happening concurrently * Update README.md Explicitly link to the application template in Github * Create config.yml * Delete --individual-troubleshooting-help.md * Update config.yml Co-authored-by: Sulka Haro &lt;sulka@sulka.net&gt; Co-authored-by: inventor96 &lt;inventor96@gmail.com&gt; Co-authored-by: Jeremy Cunningham &lt;34543464+jpcunningh@users.noreply.github.com&gt; Co-authored-by: PetrOndrusek &lt;petr-ondrusek@seznam.cz&gt; Co-authored-by: Caleb &lt;inventor96@users.noreply.github.com&gt; Co-authored-by: Diabetlum &lt;44998140+diabetlum@users.noreply.github.com&gt; Co-authored-by: Willem Fibbe &lt;fibbers@gmail.com&gt; Co-authored-by: John Weston &lt;unsoluble@me.com&gt; Co-authored-by: ireneusz-ptak &lt;31506973+ireneusz-ptak@users.noreply.github.com&gt; Co-authored-by: Lukas Herzog &lt;git@lukasherzog.de&gt; Co-authored-by: Jeremy Cunningham &lt;jpcunningh@gmail.com&gt; Co-authored-by: Jake Bloom &lt;jake@steady.health&gt; Co-authored-by: David Jansson &lt;david.jansson81@gmail.com&gt; Co-authored-by: fedor apanasenko &lt;apanasef@gmail.com&gt; Co-authored-by: Jakob Sandberg &lt;jakobs@zillowgroup.com&gt; Co-authored-by: Jakob &lt;jakobsandberg95@gmail.com&gt; Co-authored-by: Asbjørn Aarrestad &lt;asbjorn@aarrestad.com&gt; Co-authored-by: lixgbg &lt;henrik.sjostrand@gmail.com&gt; Co-authored-by: Harmjan Greving &lt;harmjan@dynasign.nl&gt; Co-authored-by: Bluefox &lt;dogafox@gmail.com&gt; Co-authored-by: Cas Eliëns &lt;cas.eliens@gmail.com&gt; Co-authored-by: Tanja &lt;7403966+tanja3981@users.noreply.github.com&gt; Co-authored-by: Bartłomiej Szubert &lt;bartlomiejszubert@gmail.com&gt; Co-authored-by: Andrew Dixon &lt;andrew@andrewdixon.co.uk&gt; Co-authored-by: Petr Ondrusek &lt;34578008+PetrOndrusek@users.noreply.github.com&gt; Co-authored-by: Lukas Herzog &lt;mail@lukasherzog.de&gt; Co-authored-by: jonfawcett &lt;38429455+jonfawcett@users.noreply.github.com&gt; Co-authored-by: Jonas Hummelstrand &lt;jonas@hummelstrand.com&gt; Co-authored-by: peterleimbach &lt;peterleimbach@icloud.com&gt; Co-authored-by: Adam Harrison &lt;adamaharrison@gmail.com&gt; Co-authored-by: Dominik Dzienia &lt;dlvoy@users.noreply.github.com&gt; Co-authored-by: stephencmorton &lt;17858976+stephencmorton@users.noreply.github.com&gt; Co-authored-by: Simon Persson &lt;simon@akep.se&gt; Co-authored-by: Cas Eliëns &lt;cas.eliens@isaac.nl&gt; Co-authored-by: Ben West &lt;bewest@gmail.com&gt; Co-authored-by: Matthew &lt;mtfoley.mae@gmail.com&gt; Co-authored-by: josep1972 &lt;joseangelparedesd@gmail.com&gt; Co-authored-by: fromorbonia &lt;3193811+fromorbonia@users.noreply.github.com&gt; Co-authored-by: VIS TFS Admin &lt;liveid@visualsolution.co.uk&gt; Co-authored-by: joracine &lt;joracine@users.noreply.github.com&gt; Co-authored-by: Alexandre Viau &lt;alexandre@alexandreviau.net&gt; Co-authored-by: Lennart Goedhart &lt;lennart@omnibase.com.au&gt; Co-authored-by: p5nbTgip0r &lt;cb3f02c5@opayq.com&gt; Co-authored-by: kskandispersonal &lt;kskandis@live.com&gt;</MESSAGE>
      <SHA>dcf2e45814ef3348b49750740fa82fb30c65f2e1</SHA>
      <PATCHEDFILES>
        <FILE>.eslintrc.js</FILE>
        <FILE>.github/ISSUE_TEMPLATE/--bug-report.md</FILE>
        <FILE>.github/ISSUE_TEMPLATE/--feature-request--.md</FILE>
        <FILE>.github/ISSUE_TEMPLATE/--individual-troubleshooting-help.md</FILE>
        <FILE>.github/ISSUE_TEMPLATE/config.yml</FILE>
        <FILE>.github/workflows/main.yml</FILE>
        <FILE>.gitignore</FILE>
        <FILE>.travis.yml</FILE>
        <FILE>CONTRIBUTING.md</FILE>
        <FILE>Makefile</FILE>
        <FILE>README.md</FILE>
        <FILE>app.js</FILE>
        <FILE>app.json</FILE>
        <FILE>assets/fonts/Nightscout Plugin Icons.json</FILE>
        <FILE>assets/fonts/README.md</FILE>
        <FILE>azuredeploy.json</FILE>
        <FILE>bundle/bundle.reports.source.js</FILE>
        <FILE>bundle/bundle.source.js</FILE>
        <FILE>ci.test.env</FILE>
        <FILE>docs/plugins/add-virtual-assistant-support-to-plugin.md</FILE>
        <FILE>docs/plugins/alexa-plugin.md</FILE>
        <FILE>docs/plugins/alexa-templates/en-us.json</FILE>
        <FILE>docs/plugins/google-home-templates/en-us.zip</FILE>
        <FILE>docs/plugins/googlehome-plugin.md</FILE>
        <FILE>docs/plugins/interacting-with-virtual-assistants.md</FILE>
        <FILE>env.js</FILE>
        <FILE>lib/api/activity/index.js</FILE>
        <FILE>lib/api/alexa/index.js</FILE>
        <FILE>lib/api/const.json</FILE>
        <FILE>lib/api/devicestatus/index.js</FILE>
        <FILE>lib/api/entries/index.js</FILE>
        <FILE>lib/api/googlehome/index.js</FILE>
        <FILE>lib/api/index.js</FILE>
        <FILE>lib/api/notifications-api.js</FILE>
        <FILE>lib/api/notifications-v2.js</FILE>
        <FILE>lib/api/profile/index.js</FILE>
        <FILE>lib/api/properties.js</FILE>
        <FILE>lib/api/root.js</FILE>
        <FILE>lib/api/status.js</FILE>
        <FILE>lib/api/treatments/index.js</FILE>
        <FILE>lib/api/verifyauth.js</FILE>
        <FILE>lib/api3/const.json</FILE>
        <FILE>lib/api3/doc/formats.md</FILE>
        <FILE>lib/api3/doc/security.md</FILE>
        <FILE>lib/api3/doc/socket.md</FILE>
        <FILE>lib/api3/doc/tutorial.md</FILE>
        <FILE>lib/api3/generic/collection.js</FILE>
        <FILE>lib/api3/generic/create/insert.js</FILE>
        <FILE>lib/api3/generic/create/operation.js</FILE>
        <FILE>lib/api3/generic/create/validate.js</FILE>
        <FILE>lib/api3/generic/delete/operation.js</FILE>
        <FILE>lib/api3/generic/history/operation.js</FILE>
        <FILE>lib/api3/generic/patch/operation.js</FILE>
        <FILE>lib/api3/generic/patch/validate.js</FILE>
        <FILE>lib/api3/generic/read/operation.js</FILE>
        <FILE>lib/api3/generic/search/input.js</FILE>
        <FILE>lib/api3/generic/search/operation.js</FILE>
        <FILE>lib/api3/generic/setup.js</FILE>
        <FILE>lib/api3/generic/update/operation.js</FILE>
        <FILE>lib/api3/generic/update/replace.js</FILE>
        <FILE>lib/api3/generic/update/validate.js</FILE>
        <FILE>lib/api3/index.js</FILE>
        <FILE>lib/api3/security.js</FILE>
        <FILE>lib/api3/shared/dateTools.js</FILE>
        <FILE>lib/api3/shared/fieldsProjector.js</FILE>
        <FILE>lib/api3/shared/operationTools.js</FILE>
        <FILE>lib/api3/shared/renderer.js</FILE>
        <FILE>lib/api3/shared/storageTools.js</FILE>
        <FILE>lib/api3/shared/stringTools.js</FILE>
        <FILE>lib/api3/specific/lastModified.js</FILE>
        <FILE>lib/api3/specific/status.js</FILE>
        <FILE>lib/api3/specific/version.js</FILE>
        <FILE>lib/api3/storage/mongoCollection/find.js</FILE>
        <FILE>lib/api3/storage/mongoCollection/index.js</FILE>
        <FILE>lib/api3/storage/mongoCollection/modify.js</FILE>
        <FILE>lib/api3/storage/mongoCollection/utils.js</FILE>
        <FILE>lib/api3/storageSocket.js</FILE>
        <FILE>lib/api3/swagger.js</FILE>
        <FILE>lib/api3/swagger.yaml</FILE>
        <FILE>lib/authorization/index.js</FILE>
        <FILE>lib/authorization/storage.js</FILE>
        <FILE>lib/bus.js</FILE>
        <FILE>lib/client/browser-settings.js</FILE>
        <FILE>lib/client/browser-utils.js</FILE>
        <FILE>lib/client/careportal.js</FILE>
        <FILE>lib/client/chart.js</FILE>
        <FILE>lib/client/clock-client.js</FILE>
        <FILE>lib/client/d3locales.js</FILE>
        <FILE>lib/client/index.js</FILE>
        <FILE>lib/client/receiveddata.js</FILE>
        <FILE>lib/client/renderer.js</FILE>
        <FILE>lib/constants.json</FILE>
        <FILE>lib/data/calcdelta.js</FILE>
        <FILE>lib/data/dataloader.js</FILE>
        <FILE>lib/data/ddata.js</FILE>
        <FILE>lib/data/treatmenttocurve.js</FILE>
        <FILE>lib/hashauth.js</FILE>
        <FILE>lib/language.js</FILE>
        <FILE>lib/middleware/express-extension-to-accept.js</FILE>
        <FILE>lib/middleware/index.js</FILE>
        <FILE>lib/notifications.js</FILE>
        <FILE>lib/plugins/alexa.js</FILE>
        <FILE>lib/plugins/ar2.js</FILE>
        <FILE>lib/plugins/basalprofile.js</FILE>
        <FILE>lib/plugins/bridge.js</FILE>
        <FILE>lib/plugins/careportal.js</FILE>
        <FILE>lib/plugins/cob.js</FILE>
        <FILE>lib/plugins/dbsize.js</FILE>
        <FILE>lib/plugins/direction.js</FILE>
        <FILE>lib/plugins/googlehome.js</FILE>
        <FILE>lib/plugins/index.js</FILE>
        <FILE>lib/plugins/iob.js</FILE>
        <FILE>lib/plugins/loop.js</FILE>
        <FILE>lib/plugins/mmconnect.js</FILE>
        <FILE>lib/plugins/openaps.js</FILE>
        <FILE>lib/plugins/pluginbase.js</FILE>
        <FILE>lib/plugins/pump.js</FILE>
        <FILE>lib/plugins/rawbg.js</FILE>
        <FILE>lib/plugins/timeago.js</FILE>
        <FILE>lib/plugins/upbat.js</FILE>
        <FILE>lib/plugins/virtAsstBase.js</FILE>
        <FILE>lib/plugins/xdripjs.js</FILE>
        <FILE>lib/profilefunctions.js</FILE>
        <FILE>lib/report/predictions.js</FILE>
        <FILE>lib/report_plugins/calibrations.js</FILE>
        <FILE>lib/report_plugins/daytoday.js</FILE>
        <FILE>lib/report_plugins/glucosedistribution.js</FILE>
        <FILE>lib/report_plugins/loopalyzer.js</FILE>
        <FILE>lib/report_plugins/percentile.js</FILE>
        <FILE>lib/report_plugins/profiles.js</FILE>
        <FILE>lib/report_plugins/treatments.js</FILE>
        <FILE>lib/report_plugins/utils.js</FILE>
        <FILE>lib/report_plugins/weektoweek.js</FILE>
        <FILE>lib/sandbox.js</FILE>
        <FILE>lib/server/booterror.js</FILE>
        <FILE>lib/server/bootevent.js</FILE>
        <FILE>lib/server/cache.js</FILE>
        <FILE>lib/server/clocks.js</FILE>
        <FILE>lib/server/devicestatus.js</FILE>
        <FILE>lib/server/entries.js</FILE>
        <FILE>lib/server/loop.js</FILE>
        <FILE>lib/server/pebble.js</FILE>
        <FILE>lib/server/profile.js</FILE>
        <FILE>lib/server/pushnotify.js</FILE>
        <FILE>lib/server/treatments.js</FILE>
        <FILE>lib/server/websocket.js</FILE>
        <FILE>lib/settings.js</FILE>
        <FILE>lib/storage/mongo-storage.js</FILE>
        <FILE>lib/units.js</FILE>
        <FILE>lib/utils.js</FILE>
        <FILE>npm-shrinkwrap.json</FILE>
        <FILE>package.json</FILE>
        <FILE>server.js</FILE>
        <FILE>static/css/drawer.css</FILE>
        <FILE>static/css/main.css</FILE>
        <FILE>static/css/report.css</FILE>
        <FILE>static/css/translations.css</FILE>
        <FILE>static/images/browserstack-logo.png</FILE>
        <FILE>static/images/errorcat.jpg</FILE>
        <FILE>static/profile/js/profileeditor.js</FILE>
        <FILE>static/report/js/predictions.js</FILE>
        <FILE>static/report/js/report.js</FILE>
        <FILE>static/robots.txt</FILE>
        <FILE>swagger.json</FILE>
        <FILE>swagger.yaml</FILE>
        <FILE>test</FILE>
        <FILE>testing/populate.js</FILE>
        <FILE>tests/admintools.test.js</FILE>
        <FILE>tests/api.alexa.test.js</FILE>
        <FILE>tests/api.devicestatus.test.js</FILE>
        <FILE>tests/api.root.test.js</FILE>
        <FILE>tests/api.treatments.test.js</FILE>
        <FILE>tests/api.verifyauth.test.js</FILE>
        <FILE>tests/api3.basic.test.js</FILE>
        <FILE>tests/api3.create.test.js</FILE>
        <FILE>tests/api3.delete.test.js</FILE>
        <FILE>tests/api3.generic.workflow.test.js</FILE>
        <FILE>tests/api3.patch.test.js</FILE>
        <FILE>tests/api3.read.test.js</FILE>
        <FILE>tests/api3.renderer.test.js</FILE>
        <FILE>tests/api3.search.test.js</FILE>
        <FILE>tests/api3.security.test.js</FILE>
        <FILE>tests/api3.socket.test.js</FILE>
        <FILE>tests/api3.update.test.js</FILE>
        <FILE>tests/ar2.test.js</FILE>
        <FILE>tests/basalprofileplugin.test.js</FILE>
        <FILE>tests/bgnow.test.js</FILE>
        <FILE>tests/bridge.test.js</FILE>
        <FILE>tests/careportal.test.js</FILE>
        <FILE>tests/client.renderer.test.js</FILE>
        <FILE>tests/cob.test.js</FILE>
        <FILE>tests/dbsize.test.js</FILE>
        <FILE>tests/ddata.test.js</FILE>
        <FILE>tests/env.test.js</FILE>
        <FILE>tests/expressextensions.test.js</FILE>
        <FILE>tests/fail.test.js</FILE>
        <FILE>tests/fixtures/api/instance.js</FILE>
        <FILE>tests/fixtures/api3/authSubject.js</FILE>
        <FILE>tests/fixtures/api3/const.json</FILE>
        <FILE>tests/fixtures/api3/instance.js</FILE>
        <FILE>tests/fixtures/api3/localhost.crt</FILE>
        <FILE>tests/fixtures/api3/localhost.key</FILE>
        <FILE>tests/fixtures/api3/utils.js</FILE>
        <FILE>tests/iob.test.js</FILE>
        <FILE>tests/loop.test.js</FILE>
        <FILE>tests/mongo-storage.test.js</FILE>
        <FILE>tests/openaps.test.js</FILE>
        <FILE>tests/profile.test.js</FILE>
        <FILE>tests/profileeditor.test.js</FILE>
        <FILE>tests/pump.test.js</FILE>
        <FILE>tests/rawbg.test.js</FILE>
        <FILE>tests/reports.test.js</FILE>
        <FILE>tests/security.test.js</FILE>
        <FILE>tests/settings.test.js</FILE>
        <FILE>tests/timeago.test.js</FILE>
        <FILE>tests/units.test.js</FILE>
        <FILE>tests/upbat.test.js</FILE>
        <FILE>views/adminindex.html</FILE>
        <FILE>views/clockviews/bgclock.css</FILE>
        <FILE>views/clockviews/clock-color.css</FILE>
        <FILE>views/clockviews/clock-config.css</FILE>
        <FILE>views/clockviews/clock-config.html</FILE>
        <FILE>views/clockviews/clock-shared.css</FILE>
        <FILE>views/clockviews/clock.css</FILE>
        <FILE>views/clockviews/clock.html</FILE>
        <FILE>views/error.html</FILE>
        <FILE>views/foodindex.html</FILE>
        <FILE>views/frame.html</FILE>
        <FILE>views/index.html</FILE>
        <FILE>views/nightscout.appcache</FILE>
        <FILE>views/partials/authentication-status.ejs</FILE>
        <FILE>views/partials/toolbar.ejs</FILE>
        <FILE>views/profileindex.html</FILE>
        <FILE>views/reportindex.html</FILE>
        <FILE>views/service-worker.js</FILE>
        <FILE>views/translationsindex.html</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>update (#1) * mgdl -&gt; mg/dl * Release ref update v2 (#5301) * Updated release name and number * Added missing version number * Added missing version number * Fix auth dialog sizing error (#5315) * Fix auth dialog sizing error (#5314) * Fix auth dialog sizing error * Fix Client Init After Auth (cherry picked from commit 1bf416c3bb964ed555850c3fc55977d69980b8e5) * update NS minor version * Bump version to 13.0.2-dev * fix some random test failures (#5341) * fix some random test failures * use typeof to test for existence * Added support for asking delta * Added time reference * Made delta reading more informative * Corrected time reference * Try shortening the response * Revert attempt * Updated templates and documentation * Minor improvement in response when delta is 0 * German translations improved and added (#5360) * Fix Alexa Launch and SessionEnded Requests (#5377) * Fix Alexa Launch Request * Allow LaunchRequest to handle intent if set, change shouldEndSession from string to bool * Fix SessionEndedRequest * Fix #5149 - discord link on CONTRIBUTING.md doesn't do anything (#5380) * Fix #5146 - display of treatment with only Fat and Protein set (#5381) * Basic report page style fixes and updates (#5387) * Add missing Polish translations and improve existing (#5382) * Add missing Polish translations and improve existing * Improve translations * Addressed virtual assistant usage with Authentication Roles (#5388) * Fix #5347 - Addressed auth roles * Unification * Fix timeago alarms (again). The changes to the rendered had an unintended consequence of triggering the timeago detection less frequently, causing the code to think the client has been hibernating, thus suppressing the alarms. The update changes the clock to be updated more frequently (this updating the hibernation detection), fixing the issue * Remove the server side test * Fix Graph Display Without Recent Devicestatus (#5409) * Update Russian (#5415) Corrected major and minor misprints and mistakes - particularly in variables, new translations added * Add server teardown ability (#5410) * adding teardown event to ctx.bus * adding teardown support for mmconnect and bridge plugins * Additional German Translations and corrections (#5405) * Cleaned up changed translations * Added Virtual Assistant Translations * Fix #5188 - move predictions to bundle and don't render chart on predictions offset change (#5395) * Fix #5188 - move predictions to bundle and don't render chart on predictions offset change * Fix predictions show for day to day * Move toolbar and authentication status to partial and include on each page (#5393) * Move authentication status to partial and include on each page * Move toolbar to partial Co-authored-by: Sulka Haro &lt;sulka@sulka.net&gt; * Virtual assistant code simplification (#5400) * Moved duplicate plugin code to single location, and small improvements * Defined _each() * Pr/5379 (#5441) * Release 13.0.1 (#5329) * Release ref update v2 (#5301) * Updated release name and number * Added missing version number * Added missing version number * Fix auth dialog sizing error (#5315) * Fix auth dialog sizing error (#5314) * Fix auth dialog sizing error * Fix Client Init After Auth (cherry picked from commit 1bf416c3bb964ed555850c3fc55977d69980b8e5) * update NS minor version * Added handlers and translations for CGM info * Defined translate() * Fixed sensor state reference * Improved wording for tx age response * Improved wording for session duration response * Updated documentation and templates * Updated README.md TOC and a reference to it * Added CGM battery info * Added unit reference to CGM battery levels * Added handlers and translations for CGM info * Defined translate() * Fixed sensor state reference * Improved wording for tx age response * Improved wording for session duration response * Updated documentation and templates * Updated README.md TOC and a reference to it * Added CGM battery info * Added unit reference to CGM battery levels * Updated API reference in Google Home template Co-authored-by: Caleb &lt;inventor96@users.noreply.github.com&gt; * Volunteer for Polish translations (#5396) * Api3 output renderers (#5425) * APIv3: adding framework for various output renderers * APIv3: adding xml output renderer * APIv3: adding csv output renderer * APIv3: documenting supported output renderers * APIv3: testing output renderers * Restore glucose distribution test (#5434) * Increase coverage of tests on units utility and clean up timeago test (#5435) * Increase coverage of tests on units utility * clean up timeago test * Refactor to encapsulate duplicated settings logic (#5426) * Encapsulate duplicate settings checks inside functions * Simplify settings::isAlarmEventEnabled() * Send coverage reports to Codacy (#5444) * Send coverage reports to Codacy * Action secrets may not be read from forks :( * Let's see if this fixes the path &amp; key passing * Ok one more try for the Actions env * Run tests and coverage separately * Try increasing the admintools test runtime for Node 10 * Run tests only once * Resolve unnecessary uses of eslint-ignore (#5436) * Resolve unnecessary disabling of no-undef eslint rule * Resolve unnecessary disabling of no-prototype-builtins eslint rule * Resolve unnecessary disabling of no-unused-vars eslint rule * Resolve unnecessary disabling of no-empty eslint rule * Fix eslint errors and add npm script for eslint (#5427) * re-enable auth check for device status routes * Resolve eslint errors * Add npm script for eslint * Correct regex for express extension middleware and add tests for expected behaviour * Resolve lint error in virtual assistant base * Update index.js * Update index.js * Remove redundant checks on entry ID (#5440) * Run CI Action for Pull Requests * Update DayToDay report for Loop Overrides (#5452) Add Loop override name/reason as text to the grey bar at the top of the graph. * Fix earlier merge error with predictions having moved to the report bundle * fix brushing loop (#5499) * Update README.md (#5480) Clarified that the &quot;bridge&quot; plugin is for Dexcom Share (&quot;Dexcom&quot; didn't appear at all in the read me), fixed a few typos, and added line 444 about the BRIDGE_SERVER variable. * Added period of days into headline of glucose distribution and percen… (#5428) * Added period of days into headline of glucose distribution and percentil chart report I make screencopies of the glucose distribution and percential chart report for my diabtes consultant and had to manually add the period of days to the report everytime because it was not shown in the report itself. I added the period of days this with a small number of lines of code and think this is helpful for other too. * removed comments as requested removed comments as requested * Camelcase for new variables reportPlugins, firstDay, lastDay, countDays * forget to save the change of reportPlugins in percentile.js * Move app caching to a service worker (#5504) * Move app caching to a webworker * Code cleanup * Code cleanup * Make Codacy happy * More parentheses * Added indexes to 'entries' and 'treatments' along with other updates (#5463) * Added compound indexes for treatments and entries collections. Updated ensureIndex to createIndex in mongo-strage.js as ensureIndex has been deprecated. Finally, updated testing/populate.js to be compatible with more recent versions of the node driver, as well as fixing a path issue. * Fixed missing end quote in lib/server/treatments.js. Changed all newly added double quotes to single quote to match style guide. * Removed indexes that referenced key600. * Fix: Round interporlated mg/dL value to an integer * Plugin to show database size (% of available space or in MiB) (#5496) * Database size plugin - pill that displays current mongoDB database size * Enabled dbsize by default * Fixed bug with dbsize not shownig when size is (rounded) 0% but real bytes &gt; 0 * Cleanup &amp; update to iconfont generation manual * Changed how warning/urgent levels are configured - from absolute MiB to percentage of DBSIZE_MAX * Trying to fix random fail of APIv3 tests (#5519) * APIv3: isolating documents from tests (not allowing clashes of calculated identifiers) * removing unused async keyword * client - mobile - Axis label font is scaled on small screens (#5512) On phones or other small screens, the axis labels (especially x axis) were previously an unreadable jumble of too-close letters * Split view (#5518) * Adds a 2, 3, 4 and 8 way split view option * Updated description * Generate the table on demand, so any number of sites from 1 to 8 generates a sensible layout * Update readme &amp; don't crash if a name is missing * Allow flagging specific settings to be not exposed the /properties and /status APIs (#5525) * Add more variables to the special list * [DEV][FIX] Fix dbsize plugin to make it hideable again (#5529) * [FIX] Making dbsize plugin default but hideable - removed its forced show state * Removed unused lodash dependency * Removed duplicate if statement (#5531) Removed the additional if statement checking for the loop specific developer team id. This since the exact same if statement existed just above it. * Update Dutch translations (#5532) * Fix settings test * Update version to 13.1.0 * Fix topbar collapse on small screens (#5562) * Fix top bar collapsing on small screens * Fix wide button array overflowing the button bar * Option to switch off bolus amount outputs (#5522) * Option to switch off bolus amount outputs (#5514) * Fixing issue with carb value not be output when set to &quot;none&quot; (#5514) * Adding additional output options (#5514) * Adding environment variable option for 'x U and Over' option. This option is BOLUS_RENDER_OVER with a default value of 1 and the value can be an integer or a float, e.g. 0.3, 1.5, 2, etc... * Adding change to change the font size depending on the bolus value. * Merge two &quot;all&quot; options to create an option that displays as SMB had. * Fix d3 portrait to landscape brush failure (#5638) * fix d3 portrait to landscape brush failure * fix client.renderer.test for highlighBrushPoints function prototype change * fix highlightBrush * move brush reset inside check for valid brush * Sanitize data from manual careportal entries so only fields with actual data are sent to the server (#5619) * do not redirect to profile editor by default (#5671) In a default configuration, there is no treatment data. The code to redirect the UI to the profile editor is buried deep within the chart rendering code for basals. This plugin is only supposed to go into action when enabled via ENABLE=basal. This commit fixes first-use experience for the default configuration intended to draw real-time CGM traces and no basal information is expected. Since no basal information is expected unless plugin is enabled via ENABLE=basal, this allows skipping instead of redirecting to the profile editor. * Fix Issue #5486 - Device Status Days Feature (#5651) * Device Status Days Feature * Edits per review from @sulkaharo * Configurable clock views (#5625) * Configurable clock views * Configurable clock views * Configurable clock views * Configurable clock views * Configurable clock views * Configurable clock views * Update README.md * Update README.md * Configurable clock views * Add remote bolus/carbs + otp entry for loop (#5598) Add a remote bolus entry field for users on Loop, along with support for an OTP field * Sometimes at the very start no profiles provided. (#5591) At the first start the nightscout is crashed if profile not full. * Fixes #4991 - Now selects basal profile based day by day (#5572) * Test profile settings * NPM Version change * Use console log * Use console log for client * Use console log for client.sbx * Use console log for client.ddata * Use console log for client again * revert * Added multi-profile reporting capabilities Co-authored-by: VIS TFS Admin &lt;liveid@visualsolution.co.uk&gt; * prepare hotfix for MMConnect/EU - 2020-06-28 Prepare to handle issue #5719. This patch adjusts dependencies to target a community edition fork of minimed-connect-to-nightscout. The new dependency targets information provided to begin addressing changes to Medtronic Carelink services starting late June 2020. * bump pointing at right tag * prepare hotfix for MMConnect/EU - 2020-06-28 Prepare to handle issue #5719. This patch adjusts dependencies to target a community edition fork of minimed-connect-to-nightscout. The new dependency targets information provided to begin addressing changes to Medtronic Carelink services starting late June 2020. * bump pointing at right tag * hotfix attempt 2 - carelink 2020 sso updates * hotfix 3 - attempt 3 at carelink 2020 sso updates * attempt 4 at hotfix for nightscout Based on more reliable version of minimed-connect-to-nightscout.... This is testing the hotfix. When it works, we will bump this one more time with the newly released version. * hotfix 5 - incorporates latest axios changes * Fix for boluscalc issue (#5729) Boluscalc fix &amp; remove integer validation from BG input field * npm install --save minimed-connect-to-nightscout@^1.4.0 * Change DISPLAY_UNITS to use readENV's default value and added several tests for DISPLAY_UNITS (#5708) readENV() was hard coding the default value of DISPLAY_UNITS, and ignoring the default value for no particular reason. Fixed that. Also, I added a full test suite for DISPLAY_UNITS environment settings to make sure that it works as intended. Finally, I've added the console log for the DISPLAY_UNITS since there's no particular reason why we log that setting and not others. * Fix audit errors, button order (#5694) * * Update packages giving npm audit errors * Fix Mongo test that broke after update (now uses async/await on getting the connection) * Restore original navigation bar button order * Disable Node 10 tests * Fix temporary target cancellation * Added documentation on the use of Alpha Testing (#5784) * Wip/bewest/mmconnect eu (#5731) * prepare hotfix for MMConnect/EU - 2020-06-28 Prepare to handle issue #5719. This patch adjusts dependencies to target a community edition fork of minimed-connect-to-nightscout. The new dependency targets information provided to begin addressing changes to Medtronic Carelink services starting late June 2020. * bump pointing at right tag * hotfix attempt 2 - carelink 2020 sso updates * hotfix 3 - attempt 3 at carelink 2020 sso updates * attempt 4 at hotfix for nightscout Based on more reliable version of minimed-connect-to-nightscout.... This is testing the hotfix. When it works, we will bump this one more time with the newly released version. Co-authored-by: Sulka Haro &lt;sulka@sulka.net&gt; * * Updated several packages to remove issues from NPM audit * Fix excess logging in settings.js * Removed heapdump package, which was causing issues for some users * * Limit the default number of profiles returned by the API to fix issues with users who are syncing a large amount of profiles from an APS. * Fix profile reporting * Upgrade Helmet to 4.0.0 * CSP and service worker improvements (#5856) * Add connectSrc for Safari compatibiity * Add new font URL for Google Fonts compatibility * Reload on re-registering the worker * Change Mongo version in github to fix builds * Serve the CSP to everyone * Split view CSP support (#5864) * Parse split view frames into frameAncestors * Re-enable CSP configuration (#5867) * Re-enable CSP configuration * Bump share2nightscout-bridge plugin Use latest update from share2nightscout bridge to make things easier. It contains an updated default for OUS users. * feat Add robots.txt to disallow site crawling * Fix dbsize for usage with Atlas (#5962) * Openaps performance improvement (#5945) * improve openaps plugin performance * more performance improvements (cherry picked from commit 076a2dd3b69093149994258eb0244ae61d68f44e) * correct setting notEnacted variable * remove unnecessary debug logging * Adapt to MongoDB Atlas (#5893) * Fix Issue #5763 - Change $.ajax to /api/v1/profile (#5704) * Bug fixes for Service Worker (#5970) * Fix service worker refresh for Firefox * Improve logging for service worker initialisation * Skip browser cache for service worker precaching * Prevent `Partial Content` responses in `fetch` by stripping `Range` header * Prevent calling `filter` on an undefined property when service worker cache is empty * Bug fixes for Service Worker * Fixes https://github.com/nightscout/cgm-remote-monitor/issues/5920 * Fixes https://github.com/nightscout/cgm-remote-monitor/issues/5943 * Update service-worker.js Removed the MP3 files from the preload to fix issues with webkit-based browsers Co-authored-by: p5nbTgip0r &lt;cb3f02c5@opayq.com&gt; Co-authored-by: Sulka Haro &lt;sulka@sulka.net&gt; * Optimize Nightscout database usage (#5947) * On periodic polls, only load delta for CGM data, treatments and device statuses * Serve basic CGM data API queries from in-memory cache. Increases the Nightscout memory footprint but should significantly reduce the Mongo load * Serve device status, CGM and treatment records from memory cache * Support count parameter in /profile * Bumping version to 14.0.0 given this is a relatively large update and we want people on Atlas to all migrate to this version * Remove logging statements * fix brushing recursion * Normalize treatments to support absolute doses from the amount field * Add Loop Carbs foodType, absorptionTime to Reports for ISSUE #5701 (#5702) * add carb foodType, absorptionTime to reports * Update README to point to new docs * Fix `Treatments` report for `mmol/L` users Fixed a typo to a client function name * Bump version to 14.0.1 * Bump dev to 14.0.2 * Serve Last-Modified header for the service worker to help with some browsers misdetecting caching * Cleaned old appcache references * * Remove unnecessary logging to help with Papertrail limits * Load more treatments and entries to fix caching issues (need to add better cache invalidation to really fix this) * When merging inserts and updates from the database, ensure we always use the new data over the old data * Bump treatment delta loading to four hours * One more increase to treatment load time to cover long overrides * * Bump version to 14.0.3 * Fix a bug in the REST API query for profiles * Bumped up the number of treatments loaded / day for reporting * Fix reports unit test * Bump treatments default limit default to 1000 objects for queries that include other query parameters * * Require created_at for Treatments on insert * Refactoring the cache: moved to another file and support flushing from bus events * Add support for CGM data and device statuses. Refactor dataloader to use the new model and reduce queries back down * Fix data order for REST API * * Add cache update events to websocket API * Remove the validation for created_at in REST API ;( * Remove excess logging * Bump version to .4 * Bump version to 14.0.5 and fix #6050 * Fix Pebble API detecting mmol units from settings * Make settings parsing whitespace tolerant * * Fix security test * Change boot and caching to expose Mongo connection errors * Don't report an error on every reconnect * Less intimidating error page on start, which also checks for api_secret * Add file missing from last commit * Fix tests * Remove require statement breaking deploys * Update --feature-request--.md * Update --bug-report.md * Update --individual-troubleshooting-help.md * Fix memory leak and cache update issues in 14.0.4 (#6133) * Fix a memory leak in 14.0.4 * Fix linter error in ddata.js * Move data retention periods to caching * Update _id of inserted entries and device status so merging to cache works correctly * Reset the data in ddata before updating * Fix typo on entry cache retention period * Have device status cache retention period follow configuration * Fix _id injection in treatments * Add error cat to error page * Fix MONGODB_URI reference in error message * Bump version to 14.0.6 * Support uploading device statuses in batches (#6147) * Support uploading device statuses in batches * Correctly report batch insertion results * Make empty cache detection a bit more aggressive to account for cache flush and data insert happening concurrently * * Bump version to 14.0.7 * Add onerror handler for pushover * Update README.md Explicitly link to the application template in Github * Fixed #5852 - Updated Google Home setup steps (#6195) * Fix broken swagger for APIv3 (#6201) * APIv3: isolating documents from tests (not allowing clashes of calculated identifiers) * removing unused async keyword * fixing api v3 swagger and moving it to /api3-docs Co-authored-by: Petr Ondrusek &lt;petr.ondrusek@seznam.cz&gt; Co-authored-by: Petr Ondrůšek &lt;petr.ondrusek@okin.eu&gt; * Use lodash.get() in virtual assistant API endpoints (v2) (#6199) * Fixed #5632 - Improved value resolution * More value resolution improvements * Fixed a couple object paths * Corrected setup of `dbsize` for virtual assistants (#6270) * Corrected db size config for virtual assistants * Language fix, improvements, added dbsize to virtAsst config * Using env * Added logging * Debug logging * Different logging * More troubleshooting * Another try * Reverted stuff, added dbsize to server defaults * Fixed test * Fixed another test * Create config.yml * Delete --individual-troubleshooting-help.md * Update config.yml * Fix batch (#6248) * Use the delta plugin data to show the delta in the clock views * Update Node checks * Fix disabling the BG alarms for simple alarms * Load battery and other rare events up to two months back * Possibly fixes compatibility with ios9 - needs testing * Unified black and color clock layouts * Update clock data every 20 seconds * Update clock time every second * Fix how CSP policy is set for Helmet, fixes #6260 * Authorization fix for misformatted URLs * Added unit test for batch upload of CGM entries * Improved / removed some logging * Test if user is in read only mode when Nightscout starts and give an error if so * Adding Hungarian translation to nightscout (#6037) * Finished first round of translation for Hungarian language * Added hungarian language to the readme file * Fixes * WIP * Typo fixes and changes to translations * Update language.js Fixed some mistyped language keys Co-authored-by: Andy Feher &lt;andras.feher@smildonis.com&gt; Co-authored-by: Sulka Haro &lt;sulka@sulka.net&gt; * Update language.js (#6193) Isfjell -&gt; Istapp Co-authored-by: Sulka Haro &lt;sulka@sulka.net&gt; * #5991 Typo in translation (#6217) Co-authored-by: Sulka Haro &lt;sulka@sulka.net&gt; * add missing translations (#6346) Co-authored-by: Sulka Haro &lt;sulka@sulka.net&gt; * Updated Alexa's intents because Amazon required new ones yet again. (#6457) * Add runtime state tracking to Nightscout, where client now checks if the server has loaded initial data from Mongo before the user is directed to the UI * Add file missing from previous commit * Update app.json * Fix unit tests * Fix the read detection to work correctly with MongoDB Atlas * * Added basal and careportal to default plugins * Changed report BG target to allow fractional numbers * Increase load interval to 5 seconds * Create codeql-analysis.yml Co-authored-by: AdrianLxM &lt;AdrianLxM@users.noreply.github.com&gt; Co-authored-by: Caleb &lt;inventor96@users.noreply.github.com&gt; Co-authored-by: inventor96 &lt;inventor96@gmail.com&gt; Co-authored-by: Jeremy Cunningham &lt;34543464+jpcunningh@users.noreply.github.com&gt; Co-authored-by: Sulka Haro &lt;sulka@sulka.net&gt; Co-authored-by: Tanja &lt;7403966+tanja3981@users.noreply.github.com&gt; Co-authored-by: Bartłomiej Szubert &lt;bartlomiejszubert@gmail.com&gt; Co-authored-by: Andrew Dixon &lt;andrew@andrewdixon.co.uk&gt; Co-authored-by: fedor apanasenko &lt;apanasef@gmail.com&gt; Co-authored-by: Petr Ondrusek &lt;34578008+PetrOndrusek@users.noreply.github.com&gt; Co-authored-by: Lukas Herzog &lt;mail@lukasherzog.de&gt; Co-authored-by: Jakob &lt;jakobsandberg95@gmail.com&gt; Co-authored-by: jonfawcett &lt;38429455+jonfawcett@users.noreply.github.com&gt; Co-authored-by: Jonas Hummelstrand &lt;jonas@hummelstrand.com&gt; Co-authored-by: peterleimbach &lt;peterleimbach@icloud.com&gt; Co-authored-by: Adam Harrison &lt;adamaharrison@gmail.com&gt; Co-authored-by: Dominik Dzienia &lt;dlvoy@users.noreply.github.com&gt; Co-authored-by: stephencmorton &lt;17858976+stephencmorton@users.noreply.github.com&gt; Co-authored-by: Simon Persson &lt;simon@akep.se&gt; Co-authored-by: Cas Eliëns &lt;cas.eliens@isaac.nl&gt; Co-authored-by: Ben West &lt;bewest@gmail.com&gt; Co-authored-by: Matthew &lt;mtfoley.mae@gmail.com&gt; Co-authored-by: ireneusz-ptak &lt;31506973+ireneusz-ptak@users.noreply.github.com&gt; Co-authored-by: josep1972 &lt;joseangelparedesd@gmail.com&gt; Co-authored-by: Bluefox &lt;dogafox@gmail.com&gt; Co-authored-by: fromorbonia &lt;3193811+fromorbonia@users.noreply.github.com&gt; Co-authored-by: VIS TFS Admin &lt;liveid@visualsolution.co.uk&gt; Co-authored-by: joracine &lt;joracine@users.noreply.github.com&gt; Co-authored-by: Alexandre Viau &lt;alexandre@alexandreviau.net&gt; Co-authored-by: Lennart Goedhart &lt;lennart@omnibase.com.au&gt; Co-authored-by: p5nbTgip0r &lt;cb3f02c5@opayq.com&gt; Co-authored-by: Jeremy Cunningham &lt;jpcunningh@gmail.com&gt; Co-authored-by: kskandispersonal &lt;kskandis@live.com&gt; Co-authored-by: Petr Ondrusek &lt;petr.ondrusek@seznam.cz&gt; Co-authored-by: Petr Ondrůšek &lt;petr.ondrusek@okin.eu&gt; Co-authored-by: Andras Feher &lt;56167205+andrasfeher-smilodonis@users.noreply.github.com&gt; Co-authored-by: Andy Feher &lt;andras.feher@smildonis.com&gt; Co-authored-by: bjornoleh &lt;63544115+bjornoleh@users.noreply.github.com&gt; Co-authored-by: Matt Gaide &lt;mgaide@salesforce.com&gt; Co-authored-by: Lukas Herzog &lt;git@lukasherzog.de&gt;</MESSAGE>
      <SHA>03f480b9adaba916274299012b14f5b9ed9b3885</SHA>
      <PATCHEDFILES>
        <FILE>.github/ISSUE_TEMPLATE/--bug-report.md</FILE>
        <FILE>.github/ISSUE_TEMPLATE/--feature-request--.md</FILE>
        <FILE>.github/ISSUE_TEMPLATE/--individual-troubleshooting-help.md</FILE>
        <FILE>.github/ISSUE_TEMPLATE/config.yml</FILE>
        <FILE>.github/workflows/codeql-analysis.yml</FILE>
        <FILE>.github/workflows/main.yml</FILE>
        <FILE>CONTRIBUTING.md</FILE>
        <FILE>README.md</FILE>
        <FILE>app.js</FILE>
        <FILE>app.json</FILE>
        <FILE>assets/fonts/Nightscout Plugin Icons.json</FILE>
        <FILE>assets/fonts/README.md</FILE>
        <FILE>azuredeploy.json</FILE>
        <FILE>bundle/bundle.reports.source.js</FILE>
        <FILE>bundle/bundle.source.js</FILE>
        <FILE>ci.test.env</FILE>
        <FILE>docs/plugins/add-virtual-assistant-support-to-plugin.md</FILE>
        <FILE>docs/plugins/alexa-plugin.md</FILE>
        <FILE>docs/plugins/alexa-templates/en-us.json</FILE>
        <FILE>docs/plugins/google-home-templates/en-us.zip</FILE>
        <FILE>docs/plugins/googlehome-plugin.md</FILE>
        <FILE>docs/plugins/interacting-with-virtual-assistants.md</FILE>
        <FILE>env.js</FILE>
        <FILE>lib/api/activity/index.js</FILE>
        <FILE>lib/api/alexa/index.js</FILE>
        <FILE>lib/api/devicestatus/index.js</FILE>
        <FILE>lib/api/entries/index.js</FILE>
        <FILE>lib/api/googlehome/index.js</FILE>
        <FILE>lib/api/profile/index.js</FILE>
        <FILE>lib/api/properties.js</FILE>
        <FILE>lib/api/status.js</FILE>
        <FILE>lib/api/treatments/index.js</FILE>
        <FILE>lib/api3/const.json</FILE>
        <FILE>lib/api3/doc/formats.md</FILE>
        <FILE>lib/api3/doc/tutorial.md</FILE>
        <FILE>lib/api3/generic/create/insert.js</FILE>
        <FILE>lib/api3/generic/history/operation.js</FILE>
        <FILE>lib/api3/generic/read/operation.js</FILE>
        <FILE>lib/api3/generic/search/operation.js</FILE>
        <FILE>lib/api3/generic/update/replace.js</FILE>
        <FILE>lib/api3/index.js</FILE>
        <FILE>lib/api3/shared/renderer.js</FILE>
        <FILE>lib/api3/swagger.js</FILE>
        <FILE>lib/api3/swagger.json</FILE>
        <FILE>lib/api3/swagger.yaml</FILE>
        <FILE>lib/authorization/index.js</FILE>
        <FILE>lib/authorization/storage.js</FILE>
        <FILE>lib/bus.js</FILE>
        <FILE>lib/client/browser-settings.js</FILE>
        <FILE>lib/client/browser-utils.js</FILE>
        <FILE>lib/client/careportal.js</FILE>
        <FILE>lib/client/chart.js</FILE>
        <FILE>lib/client/clock-client.js</FILE>
        <FILE>lib/client/d3locales.js</FILE>
        <FILE>lib/client/index.js</FILE>
        <FILE>lib/client/receiveddata.js</FILE>
        <FILE>lib/client/renderer.js</FILE>
        <FILE>lib/constants.json</FILE>
        <FILE>lib/data/calcdelta.js</FILE>
        <FILE>lib/data/dataloader.js</FILE>
        <FILE>lib/data/ddata.js</FILE>
        <FILE>lib/data/treatmenttocurve.js</FILE>
        <FILE>lib/language.js</FILE>
        <FILE>lib/middleware/express-extension-to-accept.js</FILE>
        <FILE>lib/middleware/index.js</FILE>
        <FILE>lib/notifications.js</FILE>
        <FILE>lib/plugins/alexa.js</FILE>
        <FILE>lib/plugins/ar2.js</FILE>
        <FILE>lib/plugins/basalprofile.js</FILE>
        <FILE>lib/plugins/bgnow.js</FILE>
        <FILE>lib/plugins/bridge.js</FILE>
        <FILE>lib/plugins/careportal.js</FILE>
        <FILE>lib/plugins/cob.js</FILE>
        <FILE>lib/plugins/dbsize.js</FILE>
        <FILE>lib/plugins/googlehome.js</FILE>
        <FILE>lib/plugins/index.js</FILE>
        <FILE>lib/plugins/iob.js</FILE>
        <FILE>lib/plugins/loop.js</FILE>
        <FILE>lib/plugins/mmconnect.js</FILE>
        <FILE>lib/plugins/openaps.js</FILE>
        <FILE>lib/plugins/pump.js</FILE>
        <FILE>lib/plugins/pushover.js</FILE>
        <FILE>lib/plugins/rawbg.js</FILE>
        <FILE>lib/plugins/runtimestate.js</FILE>
        <FILE>lib/plugins/simplealarms.js</FILE>
        <FILE>lib/plugins/timeago.js</FILE>
        <FILE>lib/plugins/upbat.js</FILE>
        <FILE>lib/plugins/virtAsstBase.js</FILE>
        <FILE>lib/plugins/xdripjs.js</FILE>
        <FILE>lib/profilefunctions.js</FILE>
        <FILE>lib/report/predictions.js</FILE>
        <FILE>lib/report_plugins/daytoday.js</FILE>
        <FILE>lib/report_plugins/glucosedistribution.js</FILE>
        <FILE>lib/report_plugins/loopalyzer.js</FILE>
        <FILE>lib/report_plugins/percentile.js</FILE>
        <FILE>lib/report_plugins/profiles.js</FILE>
        <FILE>lib/report_plugins/treatments.js</FILE>
        <FILE>lib/sandbox.js</FILE>
        <FILE>lib/server/booterror.js</FILE>
        <FILE>lib/server/bootevent.js</FILE>
        <FILE>lib/server/cache.js</FILE>
        <FILE>lib/server/clocks.js</FILE>
        <FILE>lib/server/devicestatus.js</FILE>
        <FILE>lib/server/entries.js</FILE>
        <FILE>lib/server/loop.js</FILE>
        <FILE>lib/server/pebble.js</FILE>
        <FILE>lib/server/profile.js</FILE>
        <FILE>lib/server/treatments.js</FILE>
        <FILE>lib/server/websocket.js</FILE>
        <FILE>lib/settings.js</FILE>
        <FILE>lib/storage/mongo-storage.js</FILE>
        <FILE>npm-shrinkwrap.json</FILE>
        <FILE>package.json</FILE>
        <FILE>server.js</FILE>
        <FILE>static/css/drawer.css</FILE>
        <FILE>static/css/main.css</FILE>
        <FILE>static/css/report.css</FILE>
        <FILE>static/css/translations.css</FILE>
        <FILE>static/images/errorcat.jpg</FILE>
        <FILE>static/profile/js/profileeditor.js</FILE>
        <FILE>static/report/js/predictions.js</FILE>
        <FILE>static/report/js/report.js</FILE>
        <FILE>swagger.json</FILE>
        <FILE>swagger.yaml</FILE>
        <FILE>test</FILE>
        <FILE>testing/populate.js</FILE>
        <FILE>tests/admintools.test.js</FILE>
        <FILE>tests/api.alexa.test.js</FILE>
        <FILE>tests/api.entries.test.js</FILE>
        <FILE>tests/api.treatments.test.js</FILE>
        <FILE>tests/api3.basic.test.js</FILE>
        <FILE>tests/api3.create.test.js</FILE>
        <FILE>tests/api3.delete.test.js</FILE>
        <FILE>tests/api3.generic.workflow.test.js</FILE>
        <FILE>tests/api3.patch.test.js</FILE>
        <FILE>tests/api3.read.test.js</FILE>
        <FILE>tests/api3.renderer.test.js</FILE>
        <FILE>tests/api3.search.test.js</FILE>
        <FILE>tests/api3.security.test.js</FILE>
        <FILE>tests/api3.socket.test.js</FILE>
        <FILE>tests/api3.update.test.js</FILE>
        <FILE>tests/client.renderer.test.js</FILE>
        <FILE>tests/dbsize.test.js</FILE>
        <FILE>tests/env.test.js</FILE>
        <FILE>tests/expressextensions.test.js</FILE>
        <FILE>tests/fixtures/default-server-settings.js</FILE>
        <FILE>tests/mongo-storage.test.js</FILE>
        <FILE>tests/profile.test.js</FILE>
        <FILE>tests/profileeditor.test.js</FILE>
        <FILE>tests/reports.test.js</FILE>
        <FILE>tests/security.test.js</FILE>
        <FILE>tests/settings.test.js</FILE>
        <FILE>tests/timeago.test.js</FILE>
        <FILE>tests/units.test.js</FILE>
        <FILE>views/adminindex.html</FILE>
        <FILE>views/clockviews/bgclock.css</FILE>
        <FILE>views/clockviews/clock-color.css</FILE>
        <FILE>views/clockviews/clock-config.css</FILE>
        <FILE>views/clockviews/clock-config.html</FILE>
        <FILE>views/clockviews/clock-shared.css</FILE>
        <FILE>views/clockviews/clock.css</FILE>
        <FILE>views/clockviews/clock.html</FILE>
        <FILE>views/error.html</FILE>
        <FILE>views/foodindex.html</FILE>
        <FILE>views/frame.html</FILE>
        <FILE>views/index.html</FILE>
        <FILE>views/nightscout.appcache</FILE>
        <FILE>views/partials/authentication-status.ejs</FILE>
        <FILE>views/partials/toolbar.ejs</FILE>
        <FILE>views/profileindex.html</FILE>
        <FILE>views/reportindex.html</FILE>
        <FILE>views/service-worker.js</FILE>
        <FILE>views/translationsindex.html</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>update nightscout (#1) * mgdl -&gt; mg/dl * Release ref update v2 (#5301) * Updated release name and number * Added missing version number * Added missing version number * Fix auth dialog sizing error (#5315) * Fix auth dialog sizing error (#5314) * Fix auth dialog sizing error * Fix Client Init After Auth (cherry picked from commit 1bf416c3bb964ed555850c3fc55977d69980b8e5) * update NS minor version * Bump version to 13.0.2-dev * fix some random test failures (#5341) * fix some random test failures * use typeof to test for existence * Added support for asking delta * Added time reference * Made delta reading more informative * Corrected time reference * Try shortening the response * Revert attempt * Updated templates and documentation * Minor improvement in response when delta is 0 * German translations improved and added (#5360) * Fix Alexa Launch and SessionEnded Requests (#5377) * Fix Alexa Launch Request * Allow LaunchRequest to handle intent if set, change shouldEndSession from string to bool * Fix SessionEndedRequest * Fix #5149 - discord link on CONTRIBUTING.md doesn't do anything (#5380) * Fix #5146 - display of treatment with only Fat and Protein set (#5381) * Basic report page style fixes and updates (#5387) * Add missing Polish translations and improve existing (#5382) * Add missing Polish translations and improve existing * Improve translations * Addressed virtual assistant usage with Authentication Roles (#5388) * Fix #5347 - Addressed auth roles * Unification * Fix timeago alarms (again). The changes to the rendered had an unintended consequence of triggering the timeago detection less frequently, causing the code to think the client has been hibernating, thus suppressing the alarms. The update changes the clock to be updated more frequently (this updating the hibernation detection), fixing the issue * Remove the server side test * Fix Graph Display Without Recent Devicestatus (#5409) * Update Russian (#5415) Corrected major and minor misprints and mistakes - particularly in variables, new translations added * Add server teardown ability (#5410) * adding teardown event to ctx.bus * adding teardown support for mmconnect and bridge plugins * Additional German Translations and corrections (#5405) * Cleaned up changed translations * Added Virtual Assistant Translations * Fix #5188 - move predictions to bundle and don't render chart on predictions offset change (#5395) * Fix #5188 - move predictions to bundle and don't render chart on predictions offset change * Fix predictions show for day to day * Move toolbar and authentication status to partial and include on each page (#5393) * Move authentication status to partial and include on each page * Move toolbar to partial Co-authored-by: Sulka Haro &lt;sulka@sulka.net&gt; * Virtual assistant code simplification (#5400) * Moved duplicate plugin code to single location, and small improvements * Defined _each() * Pr/5379 (#5441) * Release 13.0.1 (#5329) * Release ref update v2 (#5301) * Updated release name and number * Added missing version number * Added missing version number * Fix auth dialog sizing error (#5315) * Fix auth dialog sizing error (#5314) * Fix auth dialog sizing error * Fix Client Init After Auth (cherry picked from commit 1bf416c3bb964ed555850c3fc55977d69980b8e5) * update NS minor version * Added handlers and translations for CGM info * Defined translate() * Fixed sensor state reference * Improved wording for tx age response * Improved wording for session duration response * Updated documentation and templates * Updated README.md TOC and a reference to it * Added CGM battery info * Added unit reference to CGM battery levels * Added handlers and translations for CGM info * Defined translate() * Fixed sensor state reference * Improved wording for tx age response * Improved wording for session duration response * Updated documentation and templates * Updated README.md TOC and a reference to it * Added CGM battery info * Added unit reference to CGM battery levels * Updated API reference in Google Home template Co-authored-by: Caleb &lt;inventor96@users.noreply.github.com&gt; * Volunteer for Polish translations (#5396) * Api3 output renderers (#5425) * APIv3: adding framework for various output renderers * APIv3: adding xml output renderer * APIv3: adding csv output renderer * APIv3: documenting supported output renderers * APIv3: testing output renderers * Restore glucose distribution test (#5434) * Increase coverage of tests on units utility and clean up timeago test (#5435) * Increase coverage of tests on units utility * clean up timeago test * Refactor to encapsulate duplicated settings logic (#5426) * Encapsulate duplicate settings checks inside functions * Simplify settings::isAlarmEventEnabled() * Send coverage reports to Codacy (#5444) * Send coverage reports to Codacy * Action secrets may not be read from forks :( * Let's see if this fixes the path &amp; key passing * Ok one more try for the Actions env * Run tests and coverage separately * Try increasing the admintools test runtime for Node 10 * Run tests only once * Resolve unnecessary uses of eslint-ignore (#5436) * Resolve unnecessary disabling of no-undef eslint rule * Resolve unnecessary disabling of no-prototype-builtins eslint rule * Resolve unnecessary disabling of no-unused-vars eslint rule * Resolve unnecessary disabling of no-empty eslint rule * Fix eslint errors and add npm script for eslint (#5427) * re-enable auth check for device status routes * Resolve eslint errors * Add npm script for eslint * Correct regex for express extension middleware and add tests for expected behaviour * Resolve lint error in virtual assistant base * Update index.js * Update index.js * Remove redundant checks on entry ID (#5440) * Run CI Action for Pull Requests * Update DayToDay report for Loop Overrides (#5452) Add Loop override name/reason as text to the grey bar at the top of the graph. * Fix earlier merge error with predictions having moved to the report bundle * fix brushing loop (#5499) * Update README.md (#5480) Clarified that the &quot;bridge&quot; plugin is for Dexcom Share (&quot;Dexcom&quot; didn't appear at all in the read me), fixed a few typos, and added line 444 about the BRIDGE_SERVER variable. * Added period of days into headline of glucose distribution and percen… (#5428) * Added period of days into headline of glucose distribution and percentil chart report I make screencopies of the glucose distribution and percential chart report for my diabtes consultant and had to manually add the period of days to the report everytime because it was not shown in the report itself. I added the period of days this with a small number of lines of code and think this is helpful for other too. * removed comments as requested removed comments as requested * Camelcase for new variables reportPlugins, firstDay, lastDay, countDays * forget to save the change of reportPlugins in percentile.js * Move app caching to a service worker (#5504) * Move app caching to a webworker * Code cleanup * Code cleanup * Make Codacy happy * More parentheses * Added indexes to 'entries' and 'treatments' along with other updates (#5463) * Added compound indexes for treatments and entries collections. Updated ensureIndex to createIndex in mongo-strage.js as ensureIndex has been deprecated. Finally, updated testing/populate.js to be compatible with more recent versions of the node driver, as well as fixing a path issue. * Fixed missing end quote in lib/server/treatments.js. Changed all newly added double quotes to single quote to match style guide. * Removed indexes that referenced key600. * Fix: Round interporlated mg/dL value to an integer * Plugin to show database size (% of available space or in MiB) (#5496) * Database size plugin - pill that displays current mongoDB database size * Enabled dbsize by default * Fixed bug with dbsize not shownig when size is (rounded) 0% but real bytes &gt; 0 * Cleanup &amp; update to iconfont generation manual * Changed how warning/urgent levels are configured - from absolute MiB to percentage of DBSIZE_MAX * Trying to fix random fail of APIv3 tests (#5519) * APIv3: isolating documents from tests (not allowing clashes of calculated identifiers) * removing unused async keyword * client - mobile - Axis label font is scaled on small screens (#5512) On phones or other small screens, the axis labels (especially x axis) were previously an unreadable jumble of too-close letters * Split view (#5518) * Adds a 2, 3, 4 and 8 way split view option * Updated description * Generate the table on demand, so any number of sites from 1 to 8 generates a sensible layout * Update readme &amp; don't crash if a name is missing * Allow flagging specific settings to be not exposed the /properties and /status APIs (#5525) * Add more variables to the special list * [DEV][FIX] Fix dbsize plugin to make it hideable again (#5529) * [FIX] Making dbsize plugin default but hideable - removed its forced show state * Removed unused lodash dependency * Removed duplicate if statement (#5531) Removed the additional if statement checking for the loop specific developer team id. This since the exact same if statement existed just above it. * Update Dutch translations (#5532) * Fix settings test * Update version to 13.1.0 * Fix topbar collapse on small screens (#5562) * Fix top bar collapsing on small screens * Fix wide button array overflowing the button bar * Option to switch off bolus amount outputs (#5522) * Option to switch off bolus amount outputs (#5514) * Fixing issue with carb value not be output when set to &quot;none&quot; (#5514) * Adding additional output options (#5514) * Adding environment variable option for 'x U and Over' option. This option is BOLUS_RENDER_OVER with a default value of 1 and the value can be an integer or a float, e.g. 0.3, 1.5, 2, etc... * Adding change to change the font size depending on the bolus value. * Merge two &quot;all&quot; options to create an option that displays as SMB had. * Fix d3 portrait to landscape brush failure (#5638) * fix d3 portrait to landscape brush failure * fix client.renderer.test for highlighBrushPoints function prototype change * fix highlightBrush * move brush reset inside check for valid brush * Sanitize data from manual careportal entries so only fields with actual data are sent to the server (#5619) * do not redirect to profile editor by default (#5671) In a default configuration, there is no treatment data. The code to redirect the UI to the profile editor is buried deep within the chart rendering code for basals. This plugin is only supposed to go into action when enabled via ENABLE=basal. This commit fixes first-use experience for the default configuration intended to draw real-time CGM traces and no basal information is expected. Since no basal information is expected unless plugin is enabled via ENABLE=basal, this allows skipping instead of redirecting to the profile editor. * Fix Issue #5486 - Device Status Days Feature (#5651) * Device Status Days Feature * Edits per review from @sulkaharo * Configurable clock views (#5625) * Configurable clock views * Configurable clock views * Configurable clock views * Configurable clock views * Configurable clock views * Configurable clock views * Update README.md * Update README.md * Configurable clock views * Add remote bolus/carbs + otp entry for loop (#5598) Add a remote bolus entry field for users on Loop, along with support for an OTP field * Sometimes at the very start no profiles provided. (#5591) At the first start the nightscout is crashed if profile not full. * Fixes #4991 - Now selects basal profile based day by day (#5572) * Test profile settings * NPM Version change * Use console log * Use console log for client * Use console log for client.sbx * Use console log for client.ddata * Use console log for client again * revert * Added multi-profile reporting capabilities Co-authored-by: VIS TFS Admin &lt;liveid@visualsolution.co.uk&gt; * prepare hotfix for MMConnect/EU - 2020-06-28 Prepare to handle issue #5719. This patch adjusts dependencies to target a community edition fork of minimed-connect-to-nightscout. The new dependency targets information provided to begin addressing changes to Medtronic Carelink services starting late June 2020. * bump pointing at right tag * prepare hotfix for MMConnect/EU - 2020-06-28 Prepare to handle issue #5719. This patch adjusts dependencies to target a community edition fork of minimed-connect-to-nightscout. The new dependency targets information provided to begin addressing changes to Medtronic Carelink services starting late June 2020. * bump pointing at right tag * hotfix attempt 2 - carelink 2020 sso updates * hotfix 3 - attempt 3 at carelink 2020 sso updates * attempt 4 at hotfix for nightscout Based on more reliable version of minimed-connect-to-nightscout.... This is testing the hotfix. When it works, we will bump this one more time with the newly released version. * hotfix 5 - incorporates latest axios changes * Fix for boluscalc issue (#5729) Boluscalc fix &amp; remove integer validation from BG input field * npm install --save minimed-connect-to-nightscout@^1.4.0 * Change DISPLAY_UNITS to use readENV's default value and added several tests for DISPLAY_UNITS (#5708) readENV() was hard coding the default value of DISPLAY_UNITS, and ignoring the default value for no particular reason. Fixed that. Also, I added a full test suite for DISPLAY_UNITS environment settings to make sure that it works as intended. Finally, I've added the console log for the DISPLAY_UNITS since there's no particular reason why we log that setting and not others. * Fix audit errors, button order (#5694) * * Update packages giving npm audit errors * Fix Mongo test that broke after update (now uses async/await on getting the connection) * Restore original navigation bar button order * Disable Node 10 tests * Fix temporary target cancellation * Added documentation on the use of Alpha Testing (#5784) * Wip/bewest/mmconnect eu (#5731) * prepare hotfix for MMConnect/EU - 2020-06-28 Prepare to handle issue #5719. This patch adjusts dependencies to target a community edition fork of minimed-connect-to-nightscout. The new dependency targets information provided to begin addressing changes to Medtronic Carelink services starting late June 2020. * bump pointing at right tag * hotfix attempt 2 - carelink 2020 sso updates * hotfix 3 - attempt 3 at carelink 2020 sso updates * attempt 4 at hotfix for nightscout Based on more reliable version of minimed-connect-to-nightscout.... This is testing the hotfix. When it works, we will bump this one more time with the newly released version. Co-authored-by: Sulka Haro &lt;sulka@sulka.net&gt; * * Updated several packages to remove issues from NPM audit * Fix excess logging in settings.js * Removed heapdump package, which was causing issues for some users * * Limit the default number of profiles returned by the API to fix issues with users who are syncing a large amount of profiles from an APS. * Fix profile reporting * Upgrade Helmet to 4.0.0 * CSP and service worker improvements (#5856) * Add connectSrc for Safari compatibiity * Add new font URL for Google Fonts compatibility * Reload on re-registering the worker * Change Mongo version in github to fix builds * Serve the CSP to everyone * Split view CSP support (#5864) * Parse split view frames into frameAncestors * Re-enable CSP configuration (#5867) * Re-enable CSP configuration * Bump share2nightscout-bridge plugin Use latest update from share2nightscout bridge to make things easier. It contains an updated default for OUS users. * feat Add robots.txt to disallow site crawling * Fix dbsize for usage with Atlas (#5962) * Openaps performance improvement (#5945) * improve openaps plugin performance * more performance improvements (cherry picked from commit 076a2dd3b69093149994258eb0244ae61d68f44e) * correct setting notEnacted variable * remove unnecessary debug logging * Adapt to MongoDB Atlas (#5893) * Fix Issue #5763 - Change $.ajax to /api/v1/profile (#5704) * Bug fixes for Service Worker (#5970) * Fix service worker refresh for Firefox * Improve logging for service worker initialisation * Skip browser cache for service worker precaching * Prevent `Partial Content` responses in `fetch` by stripping `Range` header * Prevent calling `filter` on an undefined property when service worker cache is empty * Bug fixes for Service Worker * Fixes https://github.com/nightscout/cgm-remote-monitor/issues/5920 * Fixes https://github.com/nightscout/cgm-remote-monitor/issues/5943 * Update service-worker.js Removed the MP3 files from the preload to fix issues with webkit-based browsers Co-authored-by: p5nbTgip0r &lt;cb3f02c5@opayq.com&gt; Co-authored-by: Sulka Haro &lt;sulka@sulka.net&gt; * Optimize Nightscout database usage (#5947) * On periodic polls, only load delta for CGM data, treatments and device statuses * Serve basic CGM data API queries from in-memory cache. Increases the Nightscout memory footprint but should significantly reduce the Mongo load * Serve device status, CGM and treatment records from memory cache * Support count parameter in /profile * Bumping version to 14.0.0 given this is a relatively large update and we want people on Atlas to all migrate to this version * Remove logging statements * fix brushing recursion * Normalize treatments to support absolute doses from the amount field * Add Loop Carbs foodType, absorptionTime to Reports for ISSUE #5701 (#5702) * add carb foodType, absorptionTime to reports * Update README to point to new docs * Fix `Treatments` report for `mmol/L` users Fixed a typo to a client function name * Bump version to 14.0.1 * Bump dev to 14.0.2 * Serve Last-Modified header for the service worker to help with some browsers misdetecting caching * Cleaned old appcache references * * Remove unnecessary logging to help with Papertrail limits * Load more treatments and entries to fix caching issues (need to add better cache invalidation to really fix this) * When merging inserts and updates from the database, ensure we always use the new data over the old data * Bump treatment delta loading to four hours * One more increase to treatment load time to cover long overrides * * Bump version to 14.0.3 * Fix a bug in the REST API query for profiles * Bumped up the number of treatments loaded / day for reporting * Fix reports unit test * Bump treatments default limit default to 1000 objects for queries that include other query parameters * * Require created_at for Treatments on insert * Refactoring the cache: moved to another file and support flushing from bus events * Add support for CGM data and device statuses. Refactor dataloader to use the new model and reduce queries back down * Fix data order for REST API * * Add cache update events to websocket API * Remove the validation for created_at in REST API ;( * Remove excess logging * Bump version to .4 * Bump version to 14.0.5 and fix #6050 * Fix Pebble API detecting mmol units from settings * Make settings parsing whitespace tolerant * * Fix security test * Change boot and caching to expose Mongo connection errors * Don't report an error on every reconnect * Less intimidating error page on start, which also checks for api_secret * Add file missing from last commit * Fix tests * Remove require statement breaking deploys * Update --feature-request--.md * Update --bug-report.md * Update --individual-troubleshooting-help.md * Fix memory leak and cache update issues in 14.0.4 (#6133) * Fix a memory leak in 14.0.4 * Fix linter error in ddata.js * Move data retention periods to caching * Update _id of inserted entries and device status so merging to cache works correctly * Reset the data in ddata before updating * Fix typo on entry cache retention period * Have device status cache retention period follow configuration * Fix _id injection in treatments * Add error cat to error page * Fix MONGODB_URI reference in error message * Bump version to 14.0.6 * Support uploading device statuses in batches (#6147) * Support uploading device statuses in batches * Correctly report batch insertion results * Make empty cache detection a bit more aggressive to account for cache flush and data insert happening concurrently * * Bump version to 14.0.7 * Add onerror handler for pushover * Update README.md Explicitly link to the application template in Github * Fixed #5852 - Updated Google Home setup steps (#6195) * Fix broken swagger for APIv3 (#6201) * APIv3: isolating documents from tests (not allowing clashes of calculated identifiers) * removing unused async keyword * fixing api v3 swagger and moving it to /api3-docs Co-authored-by: Petr Ondrusek &lt;petr.ondrusek@seznam.cz&gt; Co-authored-by: Petr Ondrůšek &lt;petr.ondrusek@okin.eu&gt; * Use lodash.get() in virtual assistant API endpoints (v2) (#6199) * Fixed #5632 - Improved value resolution * More value resolution improvements * Fixed a couple object paths * Corrected setup of `dbsize` for virtual assistants (#6270) * Corrected db size config for virtual assistants * Language fix, improvements, added dbsize to virtAsst config * Using env * Added logging * Debug logging * Different logging * More troubleshooting * Another try * Reverted stuff, added dbsize to server defaults * Fixed test * Fixed another test * Create config.yml * Delete --individual-troubleshooting-help.md * Update config.yml * Fix batch (#6248) * Use the delta plugin data to show the delta in the clock views * Update Node checks * Fix disabling the BG alarms for simple alarms * Load battery and other rare events up to two months back * Possibly fixes compatibility with ios9 - needs testing * Unified black and color clock layouts * Update clock data every 20 seconds * Update clock time every second * Fix how CSP policy is set for Helmet, fixes #6260 * Authorization fix for misformatted URLs * Added unit test for batch upload of CGM entries * Improved / removed some logging * Test if user is in read only mode when Nightscout starts and give an error if so * Adding Hungarian translation to nightscout (#6037) * Finished first round of translation for Hungarian language * Added hungarian language to the readme file * Fixes * WIP * Typo fixes and changes to translations * Update language.js Fixed some mistyped language keys Co-authored-by: Andy Feher &lt;andras.feher@smildonis.com&gt; Co-authored-by: Sulka Haro &lt;sulka@sulka.net&gt; * Update language.js (#6193) Isfjell -&gt; Istapp Co-authored-by: Sulka Haro &lt;sulka@sulka.net&gt; * #5991 Typo in translation (#6217) Co-authored-by: Sulka Haro &lt;sulka@sulka.net&gt; * add missing translations (#6346) Co-authored-by: Sulka Haro &lt;sulka@sulka.net&gt; * Updated Alexa's intents because Amazon required new ones yet again. (#6457) * Add runtime state tracking to Nightscout, where client now checks if the server has loaded initial data from Mongo before the user is directed to the UI * Add file missing from previous commit * Update app.json * Fix unit tests * Fix the read detection to work correctly with MongoDB Atlas * * Added basal and careportal to default plugins * Changed report BG target to allow fractional numbers * Increase load interval to 5 seconds * Create codeql-analysis.yml Co-authored-by: AdrianLxM &lt;AdrianLxM@users.noreply.github.com&gt; Co-authored-by: Caleb &lt;inventor96@users.noreply.github.com&gt; Co-authored-by: inventor96 &lt;inventor96@gmail.com&gt; Co-authored-by: Jeremy Cunningham &lt;34543464+jpcunningh@users.noreply.github.com&gt; Co-authored-by: Sulka Haro &lt;sulka@sulka.net&gt; Co-authored-by: Tanja &lt;7403966+tanja3981@users.noreply.github.com&gt; Co-authored-by: Bartłomiej Szubert &lt;bartlomiejszubert@gmail.com&gt; Co-authored-by: Andrew Dixon &lt;andrew@andrewdixon.co.uk&gt; Co-authored-by: fedor apanasenko &lt;apanasef@gmail.com&gt; Co-authored-by: Petr Ondrusek &lt;34578008+PetrOndrusek@users.noreply.github.com&gt; Co-authored-by: Lukas Herzog &lt;mail@lukasherzog.de&gt; Co-authored-by: Jakob &lt;jakobsandberg95@gmail.com&gt; Co-authored-by: jonfawcett &lt;38429455+jonfawcett@users.noreply.github.com&gt; Co-authored-by: Jonas Hummelstrand &lt;jonas@hummelstrand.com&gt; Co-authored-by: peterleimbach &lt;peterleimbach@icloud.com&gt; Co-authored-by: Adam Harrison &lt;adamaharrison@gmail.com&gt; Co-authored-by: Dominik Dzienia &lt;dlvoy@users.noreply.github.com&gt; Co-authored-by: stephencmorton &lt;17858976+stephencmorton@users.noreply.github.com&gt; Co-authored-by: Simon Persson &lt;simon@akep.se&gt; Co-authored-by: Cas Eliëns &lt;cas.eliens@isaac.nl&gt; Co-authored-by: Ben West &lt;bewest@gmail.com&gt; Co-authored-by: Matthew &lt;mtfoley.mae@gmail.com&gt; Co-authored-by: ireneusz-ptak &lt;31506973+ireneusz-ptak@users.noreply.github.com&gt; Co-authored-by: josep1972 &lt;joseangelparedesd@gmail.com&gt; Co-authored-by: Bluefox &lt;dogafox@gmail.com&gt; Co-authored-by: fromorbonia &lt;3193811+fromorbonia@users.noreply.github.com&gt; Co-authored-by: VIS TFS Admin &lt;liveid@visualsolution.co.uk&gt; Co-authored-by: joracine &lt;joracine@users.noreply.github.com&gt; Co-authored-by: Alexandre Viau &lt;alexandre@alexandreviau.net&gt; Co-authored-by: Lennart Goedhart &lt;lennart@omnibase.com.au&gt; Co-authored-by: p5nbTgip0r &lt;cb3f02c5@opayq.com&gt; Co-authored-by: Jeremy Cunningham &lt;jpcunningh@gmail.com&gt; Co-authored-by: kskandispersonal &lt;kskandis@live.com&gt; Co-authored-by: Petr Ondrusek &lt;petr.ondrusek@seznam.cz&gt; Co-authored-by: Petr Ondrůšek &lt;petr.ondrusek@okin.eu&gt; Co-authored-by: Andras Feher &lt;56167205+andrasfeher-smilodonis@users.noreply.github.com&gt; Co-authored-by: Andy Feher &lt;andras.feher@smildonis.com&gt; Co-authored-by: bjornoleh &lt;63544115+bjornoleh@users.noreply.github.com&gt; Co-authored-by: Matt Gaide &lt;mgaide@salesforce.com&gt; Co-authored-by: Lukas Herzog &lt;git@lukasherzog.de&gt;</MESSAGE>
      <SHA>6e2ad4edc8ebf08732d3d5a9ca353937ada0148a</SHA>
      <PATCHEDFILES>
        <FILE>.github/ISSUE_TEMPLATE/--bug-report.md</FILE>
        <FILE>.github/ISSUE_TEMPLATE/--feature-request--.md</FILE>
        <FILE>.github/ISSUE_TEMPLATE/--individual-troubleshooting-help.md</FILE>
        <FILE>.github/ISSUE_TEMPLATE/config.yml</FILE>
        <FILE>.github/workflows/codeql-analysis.yml</FILE>
        <FILE>.github/workflows/main.yml</FILE>
        <FILE>CONTRIBUTING.md</FILE>
        <FILE>README.md</FILE>
        <FILE>app.js</FILE>
        <FILE>app.json</FILE>
        <FILE>assets/fonts/Nightscout Plugin Icons.json</FILE>
        <FILE>assets/fonts/README.md</FILE>
        <FILE>azuredeploy.json</FILE>
        <FILE>bundle/bundle.reports.source.js</FILE>
        <FILE>bundle/bundle.source.js</FILE>
        <FILE>ci.test.env</FILE>
        <FILE>docs/plugins/add-virtual-assistant-support-to-plugin.md</FILE>
        <FILE>docs/plugins/alexa-plugin.md</FILE>
        <FILE>docs/plugins/alexa-templates/en-us.json</FILE>
        <FILE>docs/plugins/google-home-templates/en-us.zip</FILE>
        <FILE>docs/plugins/googlehome-plugin.md</FILE>
        <FILE>docs/plugins/interacting-with-virtual-assistants.md</FILE>
        <FILE>env.js</FILE>
        <FILE>lib/api/activity/index.js</FILE>
        <FILE>lib/api/alexa/index.js</FILE>
        <FILE>lib/api/devicestatus/index.js</FILE>
        <FILE>lib/api/entries/index.js</FILE>
        <FILE>lib/api/googlehome/index.js</FILE>
        <FILE>lib/api/profile/index.js</FILE>
        <FILE>lib/api/properties.js</FILE>
        <FILE>lib/api/status.js</FILE>
        <FILE>lib/api/treatments/index.js</FILE>
        <FILE>lib/api3/const.json</FILE>
        <FILE>lib/api3/doc/formats.md</FILE>
        <FILE>lib/api3/doc/tutorial.md</FILE>
        <FILE>lib/api3/generic/create/insert.js</FILE>
        <FILE>lib/api3/generic/history/operation.js</FILE>
        <FILE>lib/api3/generic/read/operation.js</FILE>
        <FILE>lib/api3/generic/search/operation.js</FILE>
        <FILE>lib/api3/generic/update/replace.js</FILE>
        <FILE>lib/api3/index.js</FILE>
        <FILE>lib/api3/shared/renderer.js</FILE>
        <FILE>lib/api3/swagger.js</FILE>
        <FILE>lib/api3/swagger.json</FILE>
        <FILE>lib/api3/swagger.yaml</FILE>
        <FILE>lib/authorization/index.js</FILE>
        <FILE>lib/authorization/storage.js</FILE>
        <FILE>lib/bus.js</FILE>
        <FILE>lib/client/browser-settings.js</FILE>
        <FILE>lib/client/browser-utils.js</FILE>
        <FILE>lib/client/careportal.js</FILE>
        <FILE>lib/client/chart.js</FILE>
        <FILE>lib/client/clock-client.js</FILE>
        <FILE>lib/client/d3locales.js</FILE>
        <FILE>lib/client/index.js</FILE>
        <FILE>lib/client/receiveddata.js</FILE>
        <FILE>lib/client/renderer.js</FILE>
        <FILE>lib/constants.json</FILE>
        <FILE>lib/data/calcdelta.js</FILE>
        <FILE>lib/data/dataloader.js</FILE>
        <FILE>lib/data/ddata.js</FILE>
        <FILE>lib/data/treatmenttocurve.js</FILE>
        <FILE>lib/language.js</FILE>
        <FILE>lib/middleware/express-extension-to-accept.js</FILE>
        <FILE>lib/middleware/index.js</FILE>
        <FILE>lib/notifications.js</FILE>
        <FILE>lib/plugins/alexa.js</FILE>
        <FILE>lib/plugins/ar2.js</FILE>
        <FILE>lib/plugins/basalprofile.js</FILE>
        <FILE>lib/plugins/bgnow.js</FILE>
        <FILE>lib/plugins/bridge.js</FILE>
        <FILE>lib/plugins/careportal.js</FILE>
        <FILE>lib/plugins/cob.js</FILE>
        <FILE>lib/plugins/dbsize.js</FILE>
        <FILE>lib/plugins/googlehome.js</FILE>
        <FILE>lib/plugins/index.js</FILE>
        <FILE>lib/plugins/iob.js</FILE>
        <FILE>lib/plugins/loop.js</FILE>
        <FILE>lib/plugins/mmconnect.js</FILE>
        <FILE>lib/plugins/openaps.js</FILE>
        <FILE>lib/plugins/pump.js</FILE>
        <FILE>lib/plugins/pushover.js</FILE>
        <FILE>lib/plugins/rawbg.js</FILE>
        <FILE>lib/plugins/runtimestate.js</FILE>
        <FILE>lib/plugins/simplealarms.js</FILE>
        <FILE>lib/plugins/timeago.js</FILE>
        <FILE>lib/plugins/upbat.js</FILE>
        <FILE>lib/plugins/virtAsstBase.js</FILE>
        <FILE>lib/plugins/xdripjs.js</FILE>
        <FILE>lib/profilefunctions.js</FILE>
        <FILE>lib/report/predictions.js</FILE>
        <FILE>lib/report_plugins/daytoday.js</FILE>
        <FILE>lib/report_plugins/glucosedistribution.js</FILE>
        <FILE>lib/report_plugins/loopalyzer.js</FILE>
        <FILE>lib/report_plugins/percentile.js</FILE>
        <FILE>lib/report_plugins/profiles.js</FILE>
        <FILE>lib/report_plugins/treatments.js</FILE>
        <FILE>lib/sandbox.js</FILE>
        <FILE>lib/server/booterror.js</FILE>
        <FILE>lib/server/bootevent.js</FILE>
        <FILE>lib/server/cache.js</FILE>
        <FILE>lib/server/clocks.js</FILE>
        <FILE>lib/server/devicestatus.js</FILE>
        <FILE>lib/server/entries.js</FILE>
        <FILE>lib/server/loop.js</FILE>
        <FILE>lib/server/pebble.js</FILE>
        <FILE>lib/server/profile.js</FILE>
        <FILE>lib/server/treatments.js</FILE>
        <FILE>lib/server/websocket.js</FILE>
        <FILE>lib/settings.js</FILE>
        <FILE>lib/storage/mongo-storage.js</FILE>
        <FILE>npm-shrinkwrap.json</FILE>
        <FILE>package.json</FILE>
        <FILE>server.js</FILE>
        <FILE>static/css/drawer.css</FILE>
        <FILE>static/css/main.css</FILE>
        <FILE>static/css/report.css</FILE>
        <FILE>static/css/translations.css</FILE>
        <FILE>static/images/errorcat.jpg</FILE>
        <FILE>static/profile/js/profileeditor.js</FILE>
        <FILE>static/report/js/predictions.js</FILE>
        <FILE>static/report/js/report.js</FILE>
        <FILE>swagger.json</FILE>
        <FILE>swagger.yaml</FILE>
        <FILE>test</FILE>
        <FILE>testing/populate.js</FILE>
        <FILE>tests/admintools.test.js</FILE>
        <FILE>tests/api.alexa.test.js</FILE>
        <FILE>tests/api.entries.test.js</FILE>
        <FILE>tests/api.treatments.test.js</FILE>
        <FILE>tests/api3.basic.test.js</FILE>
        <FILE>tests/api3.create.test.js</FILE>
        <FILE>tests/api3.delete.test.js</FILE>
        <FILE>tests/api3.generic.workflow.test.js</FILE>
        <FILE>tests/api3.patch.test.js</FILE>
        <FILE>tests/api3.read.test.js</FILE>
        <FILE>tests/api3.renderer.test.js</FILE>
        <FILE>tests/api3.search.test.js</FILE>
        <FILE>tests/api3.security.test.js</FILE>
        <FILE>tests/api3.socket.test.js</FILE>
        <FILE>tests/api3.update.test.js</FILE>
        <FILE>tests/client.renderer.test.js</FILE>
        <FILE>tests/dbsize.test.js</FILE>
        <FILE>tests/env.test.js</FILE>
        <FILE>tests/expressextensions.test.js</FILE>
        <FILE>tests/fixtures/default-server-settings.js</FILE>
        <FILE>tests/mongo-storage.test.js</FILE>
        <FILE>tests/profile.test.js</FILE>
        <FILE>tests/profileeditor.test.js</FILE>
        <FILE>tests/reports.test.js</FILE>
        <FILE>tests/security.test.js</FILE>
        <FILE>tests/settings.test.js</FILE>
        <FILE>tests/timeago.test.js</FILE>
        <FILE>tests/units.test.js</FILE>
        <FILE>views/adminindex.html</FILE>
        <FILE>views/clockviews/bgclock.css</FILE>
        <FILE>views/clockviews/clock-color.css</FILE>
        <FILE>views/clockviews/clock-config.css</FILE>
        <FILE>views/clockviews/clock-config.html</FILE>
        <FILE>views/clockviews/clock-shared.css</FILE>
        <FILE>views/clockviews/clock.css</FILE>
        <FILE>views/clockviews/clock.html</FILE>
        <FILE>views/error.html</FILE>
        <FILE>views/foodindex.html</FILE>
        <FILE>views/frame.html</FILE>
        <FILE>views/index.html</FILE>
        <FILE>views/nightscout.appcache</FILE>
        <FILE>views/partials/authentication-status.ejs</FILE>
        <FILE>views/partials/toolbar.ejs</FILE>
        <FILE>views/profileindex.html</FILE>
        <FILE>views/reportindex.html</FILE>
        <FILE>views/service-worker.js</FILE>
        <FILE>views/translationsindex.html</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
