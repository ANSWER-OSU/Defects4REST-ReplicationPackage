<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>7730</ISSUENO>
  <ISSUEURL>https://github.com/vercel/vercel/issues/7730</ISSUEURL>
  <TITLE>[Monorepo Detection] Add getWorkspaces helper function</TITLE>
  <DESCRIPTION>```ts /* Example 1: my-repo |-- packages | |-- api-1 | |-- api-2 |-- package.json |-- pnpm-workspaces.yaml // packages: [&quot;packages/*&quot;] getWorkspaces(&quot;my-repo&quot;) =&gt; [ { implementation: &quot;pnpm&quot;, rootPath: &quot;my-repo&quot; } ] Example 2: my-repo |-- backend | |-- api-1 | |-- api-2 | |-- package.json // workspaces: [&quot;api-1&quot;, &quot;api-2&quot;] |-- frontend | |-- nextjs-app | |-- gatsby-app | |-- package.json | |-- pnpm-workspaces.yaml // packages: [&quot;nextjs-app&quot;, &quot;gatsby-app&quot;] getWorkspaces(&quot;my-repo&quot;) =&gt; [ { implementation: &quot;yarn&quot;, rootPath: &quot;my-repo/backend&quot; }, { implementation: &quot;pnpm&quot;, rootPath: &quot;my-repo/frontend&quot; } ] */ type Workspace = { implementation: &quot;yarn&quot; | &quot;npm&quot; | &quot;pnpm&quot; // rush, lerna in the future rootPath: string // the path to the root of the workspace } function getWorkspaces(fs: DetectorFilesystem): Workspace[] ``` A couple notes around implementation, * We should have a max depth of 2 * We may want to add the `workspace-implementations` list as an argument to this function. For now we can hard code until https://github.com/vercel/vercel/issues/7731 is complete * Unit tests</DESCRIPTION>
  <REPONAME>vercel</REPONAME>
  <TIMEDIFFERENCEDAYS>25</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>[cli] Symlink `@now/build-utils` when installing builders in &quot;vc build&quot; (#7844) To support legacy Builders like `@frontity/now` which still depends on the old `@now/build-utils` package name, create a symlink to `@vercel/build-utils` to make import the package work transparently. Depends on #7842 being merged first.</MESSAGE>
    <SHA>e8a9000137e8c8fc7bd53d00f7cc7f1a69c00ae7</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>[build-utils] Add getWorkspaces helper function (#7775) ```ts /* Example 1: my-repo |-- packages | |-- api-1 | |-- api-2 |-- package.json |-- pnpm-workspaces.yaml // packages: [&quot;packages/*&quot;] getWorkspaces(&quot;my-repo&quot;) =&gt; [ { implementation: &quot;pnpm&quot;, rootPath: &quot;https://github.com/.../my-repo&quot; } ] Example 2: my-repo |-- backend | |-- api-1 | |-- api-2 | |-- package.json // workspaces: [&quot;api-1&quot;, &quot;api-2&quot;] |-- frontend | |-- nextjs-app | |-- gatsby-app | |-- package.json | |-- pnpm-workspaces.yaml // packages: [&quot;nextjs-app&quot;, &quot;gatsby-app&quot;] getWorkspaces(&quot;my-repo&quot;) =&gt; [ { implementation: &quot;yarn&quot;, rootPath: &quot;https://github.com/.../my-repo/backend&quot; }, { implementation: &quot;pnpm&quot;, rootPath: &quot;https://github.com/.../my-repo/frontend&quot; } ] */ type Workspace = { implementation: &quot;yarn&quot; | &quot;npm&quot; | &quot;pnpm&quot; rootPath: string // the path to the root of the workspace } function getWorkspaces(fs: DetectorFilesystem): Workspace[] ``` ### Related Issues &gt; Closes https://github.com/vercel/vercel/issues/7730 ### Checklist &lt;!-- Please keep your PR as a Draft until the checklist is complete --&gt; #### Tests - [x] The code changed/added as part of this PR has been covered with tests - [x] All tests pass locally with `yarn test-unit` #### Code Review - [x] This PR has a concise title and thorough description useful to a reviewer - [x] Issue from task tracker has a link to this PR</MESSAGE>
      <SHA>86886e6b6005c84bc39afd20fa2603da03fe74a3</SHA>
      <PATCHEDFILES>
        <FILE>packages/build-utils/src/index.ts</FILE>
        <FILE>packages/build-utils/src/workspaces/get-workspaces.ts</FILE>
        <FILE>packages/build-utils/test/fixtures/29-nested-workspaces/backend/c/package.json</FILE>
        <FILE>packages/build-utils/test/fixtures/29-nested-workspaces/backend/d/package.json</FILE>
        <FILE>packages/build-utils/test/fixtures/29-nested-workspaces/backend/package.json</FILE>
        <FILE>packages/build-utils/test/fixtures/29-nested-workspaces/backend/pnpm-lock.yaml</FILE>
        <FILE>packages/build-utils/test/fixtures/29-nested-workspaces/backend/pnpm-workspace.yaml</FILE>
        <FILE>packages/build-utils/test/fixtures/29-nested-workspaces/frontend/a/package.json</FILE>
        <FILE>packages/build-utils/test/fixtures/29-nested-workspaces/frontend/b/package.json</FILE>
        <FILE>packages/build-utils/test/fixtures/29-nested-workspaces/frontend/ignored/.gitkeep</FILE>
        <FILE>packages/build-utils/test/fixtures/29-nested-workspaces/frontend/package.json</FILE>
        <FILE>packages/build-utils/test/fixtures/29-nested-workspaces/frontend/yarn.lock</FILE>
        <FILE>packages/build-utils/test/fixtures/30-double-nested-workspaces/packages/backend/c/package.json</FILE>
        <FILE>packages/build-utils/test/fixtures/30-double-nested-workspaces/packages/backend/d/package.json</FILE>
        <FILE>packages/build-utils/test/fixtures/30-double-nested-workspaces/packages/backend/package.json</FILE>
        <FILE>packages/build-utils/test/fixtures/30-double-nested-workspaces/packages/backend/pnpm-lock.yaml</FILE>
        <FILE>packages/build-utils/test/fixtures/30-double-nested-workspaces/packages/backend/pnpm-workspace.yaml</FILE>
        <FILE>packages/build-utils/test/fixtures/30-double-nested-workspaces/packages/frontend/a/package.json</FILE>
        <FILE>packages/build-utils/test/fixtures/30-double-nested-workspaces/packages/frontend/b/package.json</FILE>
        <FILE>packages/build-utils/test/fixtures/30-double-nested-workspaces/packages/frontend/ignored/.gitkeep</FILE>
        <FILE>packages/build-utils/test/fixtures/30-double-nested-workspaces/packages/frontend/package.json</FILE>
        <FILE>packages/build-utils/test/fixtures/30-double-nested-workspaces/packages/frontend/yarn.lock</FILE>
        <FILE>packages/build-utils/test/fixtures/31-turborepo-in-package-json/a/package.json</FILE>
        <FILE>packages/build-utils/test/fixtures/31-turborepo-in-package-json/b/package.json</FILE>
        <FILE>packages/build-utils/test/fixtures/31-turborepo-in-package-json/package.json</FILE>
        <FILE>packages/build-utils/test/fixtures/31-turborepo-in-package-json/yarn.lock</FILE>
        <FILE>packages/build-utils/test/integration.test.ts</FILE>
        <FILE>packages/build-utils/test/unit.detect-monorepo-managers.test.ts</FILE>
        <FILE>packages/build-utils/test/unit.detect-workspace-managers.test.ts</FILE>
        <FILE>packages/build-utils/test/unit.get-workspaces.test.ts</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
