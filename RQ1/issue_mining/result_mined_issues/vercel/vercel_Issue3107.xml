<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>3107</ISSUENO>
  <ISSUEURL>https://github.com/vercel/vercel/issues/3107</ISSUEURL>
  <TITLE>[now-cli] Now cli 16.3.0 `--prod` option does not alias domain when build succeeded</TITLE>
  <DESCRIPTION>Hi everyone, First of all, amazing service and this is really the first time I've found an issue in a process that was overall very seamless, thank you! Now I did get an issue with updating `now-cli` to 16.3.0, and to my surprise my build does not get to be aliased to my custom domain. Going back to `now-cli@16.2.0` fixes my issue completely. My command is the following: ``` now --prod --local-config ./.now/now.dev.json ``` My config is: ``` { &quot;name&quot;: &quot;website-dev&quot;, &quot;alias&quot;: &quot;domain.com&quot;, &quot;version&quot;: 2, &quot;build&quot;: { &quot;env&quot;: { // hidden } }, &quot;builds&quot;: [{ &quot;src&quot;: &quot;next.config.js&quot;, &quot;use&quot;: &quot;@now/next&quot; }] } ``` Is there something I need to update to support the newer now-cli updates? Thanks in advance, let me know if you need more info from me!</DESCRIPTION>
  <REPONAME>vercel</REPONAME>
  <TIMEDIFFERENCEDAYS>1</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Revert &quot;[tests] Add test all script&quot; since it runs on commit (#3108) Reverts #3106 from @MAPESO The tests seem to be running on each commit which is going to slow down development.</MESSAGE>
    <SHA>0af87dc2bef14e1368342482cf416e32055021b3</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>[now-cli][now-client] Add parameter `nowConfig` for custom now.json (#3110) When now-client was implemented, it did not work with `--local-config` flag from now-cli because the only parameters it looks at are the files in a directory. This fixes the regression in now@16.3.0 so that now-client can accept an optional `nowConfig` object or fallback to the `now.json` file. Fixes #3099 Fixes #3105 Fixes #3107 Fixes #3109 [PRODUCT-350] #close [PRODUCT-350]: https://zeit.atlassian.net/browse/PRODUCT-350</MESSAGE>
      <SHA>2791338e04b1cc1f5dafa355aa223d153e26e971</SHA>
      <PATCHEDFILES>
        <FILE>packages/now-cli/src/util/deploy/process-deployment.ts</FILE>
        <FILE>packages/now-cli/src/util/get-config.ts</FILE>
        <FILE>packages/now-cli/src/util/index.js</FILE>
        <FILE>packages/now-cli/test/helpers/prepare.js</FILE>
        <FILE>packages/now-cli/test/integration.js</FILE>
        <FILE>packages/now-client/src/create-deployment.ts</FILE>
        <FILE>packages/now-client/src/deploy.ts</FILE>
        <FILE>packages/now-client/src/types.ts</FILE>
        <FILE>packages/now-client/src/upload.ts</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>[now-cli][now-client] Fix `--local-config` flag and `files` key (#3117) This PR is a followup to #3110 that fixes the first deployment when using the `--local-config` flag and also fixes v1 deployments using the [`files`](https://zeit.co/docs/v1/features/configuration/#files-(array)) key. The tests have been adjusted so we don't regress in both cases. Fixes #3099 Fixes #3105 Fixes #3107 Fixes #3109 [PRODUCT-350] #close [PRODUCT-350]: https://zeit.atlassian.net/browse/PRODUCT-350</MESSAGE>
      <SHA>d9bb6c8a54b298b2cbd8420b366e7a4ae7029dcc</SHA>
      <PATCHEDFILES>
        <FILE>packages/now-cli/test/helpers/prepare.js</FILE>
        <FILE>packages/now-cli/test/integration.js</FILE>
        <FILE>packages/now-client/src/create-deployment.ts</FILE>
        <FILE>packages/now-client/src/deploy.ts</FILE>
        <FILE>packages/now-client/src/types.ts</FILE>
        <FILE>packages/now-client/src/utils/index.ts</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
