<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>2023</ISSUENO>
  <ISSUEURL>https://github.com/vercel/vercel/issues/2023</ISSUEURL>
  <TITLE>`now dev` routing errors</TITLE>
  <DESCRIPTION>Please assign now dev tag, and good work getting closer to public release. Getting `Error: Unable to encode undefined of type undefined` when trying to navigate directly to a page defined in the routes, `/page?uid=$uid` in a project integrating Prismic. Client-side routing works as usual. Issue seems to be when `getInitialProps` is called and tries to fetch using the Prismic API ``` const API = await Prismic.getApi(apiEndpoint, { req, accessToken }); const document = await API.getByUID('page', uid); ``` Works without any issues when deployed in Now v2. Repository to replicate error https://github.com/raulg/nextjs-blog/tree/Serverless-Now</DESCRIPTION>
  <REPONAME>vercel</REPONAME>
  <TIMEDIFFERENCEDAYS>39</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>[now dev] Don't add `.gitignore` to the ignore list (#2025) `.gitignore` is not respected anymore for Now v2, so this was a bug. Also removes `ncc` and `user` from the ignore list, since that issue was fixed a while back as well. Fixes #2021.</MESSAGE>
    <SHA>b3bd8c592987e81ff16dde485f115a586a57e6dd</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>[now dev] Use `pcre-to-regexp` to match `routes` The now.json `routes` support PCRE syntax like named captures, so use the `pcre-to-regexp` module to match the routes. Fixes #2023.</MESSAGE>
      <SHA>ef5305d368aa7396b4223529992f84e1af3b4ad6</SHA>
      <PATCHEDFILES>
        <FILE>@types/pcre-to-regexp/index.d.ts</FILE>
        <FILE>package.json</FILE>
        <FILE>src/commands/dev/lib/dev-router.ts</FILE>
        <FILE>test/dev-router.unit.js</FILE>
        <FILE>yarn.lock</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>[now dev] Use `pcre-to-regexp` to match `routes` (#2027) * [now dev] Use `pcre-to-regexp` to match `routes` The now.json `routes` support PCRE syntax like named captures, so use the `pcre-to-regexp` module to match the routes. Fixes #2023. * Pass the resolved router `dest` and query params to the Lambda</MESSAGE>
      <SHA>b29f602ce9a944c6f7217568d8a4a61a976ba2a7</SHA>
      <PATCHEDFILES>
        <FILE>@types/pcre-to-regexp/index.d.ts</FILE>
        <FILE>package.json</FILE>
        <FILE>src/commands/dev/lib/dev-router.ts</FILE>
        <FILE>src/commands/dev/lib/dev-server.ts</FILE>
        <FILE>test/dev-router.unit.js</FILE>
        <FILE>yarn.lock</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>[now dev] Use `pcre-to-regexp` to match `routes` (#2027) * [now dev] Use `pcre-to-regexp` to match `routes` The now.json `routes` support PCRE syntax like named captures, so use the `pcre-to-regexp` module to match the routes. Fixes #2023. * Pass the resolved router `dest` and query params to the Lambda</MESSAGE>
      <SHA>635f6f93c46e979950fe2c97e7f5315e1460e8fa</SHA>
      <PATCHEDFILES>
        <FILE>@types/pcre-to-regexp/index.d.ts</FILE>
        <FILE>package.json</FILE>
        <FILE>src/commands/dev/lib/dev-router.ts</FILE>
        <FILE>src/commands/dev/lib/dev-server.ts</FILE>
        <FILE>test/dev-router.unit.js</FILE>
        <FILE>yarn.lock</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>[now dev] Use `pcre-to-regexp` to match `routes` (#2027) * [now dev] Use `pcre-to-regexp` to match `routes` The now.json `routes` support PCRE syntax like named captures, so use the `pcre-to-regexp` module to match the routes. Fixes #2023. * Pass the resolved router `dest` and query params to the Lambda</MESSAGE>
      <SHA>fd3c110c02145ef801f0a72f196b5cfead8c79ee</SHA>
      <PATCHEDFILES>
        <FILE>@types/pcre-to-regexp/index.d.ts</FILE>
        <FILE>package.json</FILE>
        <FILE>src/commands/dev/lib/dev-router.ts</FILE>
        <FILE>src/commands/dev/lib/dev-server.ts</FILE>
        <FILE>test/dev-router.unit.js</FILE>
        <FILE>yarn.lock</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
