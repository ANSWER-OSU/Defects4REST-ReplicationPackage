<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>4835</ISSUENO>
  <ISSUEURL>https://github.com/vercel/vercel/issues/4835</ISSUEURL>
  <TITLE>Vercel refuses to work with TypeScript’s default tsconfig.json</TITLE>
  <DESCRIPTION>By creating a `tsconfig.json` using `tsc --init`, which looks like this: ```jsonc { &quot;compilerOptions&quot;: { /* Visit https://aka.ms/tsconfig.json to read more about this file */ /* Basic Options */ // &quot;incremental&quot;: true, /* Enable incremental compilation */ &quot;target&quot;: &quot;es5&quot;, /* Specify ECMAScript target version: 'ES3' (default), 'ES5', 'ES2015', 'ES2016', 'ES2017', 'ES2018', 'ES2019', 'ES2020', or 'ESNEXT'. */ &quot;module&quot;: &quot;commonjs&quot;, /* Specify module code generation: 'none', 'commonjs', 'amd', 'system', 'umd', 'es2015', 'es2020', or 'ESNext'. */ // &quot;lib&quot;: [], /* Specify library files to be included in the compilation. */ // &quot;allowJs&quot;: true, /* Allow javascript files to be compiled. */ // &quot;checkJs&quot;: true, /* Report errors in .js files. */ // &quot;jsx&quot;: &quot;preserve&quot;, /* Specify JSX code generation: 'preserve', 'react-native', or 'react'. */ // &quot;declaration&quot;: true, /* Generates corresponding '.d.ts' file. */ // &quot;declarationMap&quot;: true, /* Generates a sourcemap for each corresponding '.d.ts' file. */ // &quot;sourceMap&quot;: true, /* Generates corresponding '.map' file. */ // &quot;outFile&quot;: &quot;./&quot;, /* Concatenate and emit output to single file. */ // &quot;outDir&quot;: &quot;./&quot;, /* Redirect output structure to the directory. */ // &quot;rootDir&quot;: &quot;./&quot;, /* Specify the root directory of input files. Use to control the output directory structure with --outDir. */ // &quot;composite&quot;: true, /* Enable project compilation */ // &quot;tsBuildInfoFile&quot;: &quot;./&quot;, /* Specify file to store incremental compilation information */ // &quot;removeComments&quot;: true, /* Do not emit comments to output. */ // &quot;noEmit&quot;: true, /* Do not emit outputs. */ // &quot;importHelpers&quot;: true, /* Import emit helpers from 'tslib'. */ // &quot;downlevelIteration&quot;: true, /* Provide full support for iterables in 'for-of', spread, and destructuring when targeting 'ES5' or 'ES3'. */ // &quot;isolatedModules&quot;: true, /* Transpile each file as a separate module (similar to 'ts.transpileModule'). */ /* Strict Type-Checking Options */ &quot;strict&quot;: true, /* Enable all strict type-checking options. */ // &quot;noImplicitAny&quot;: true, /* Raise error on expressions and declarations with an implied 'any' type. */ // &quot;strictNullChecks&quot;: true, /* Enable strict null checks. */ // &quot;strictFunctionTypes&quot;: true, /* Enable strict checking of function types. */ // &quot;strictBindCallApply&quot;: true, /* Enable strict 'bind', 'call', and 'apply' methods on functions. */ // &quot;strictPropertyInitialization&quot;: true, /* Enable strict checking of property initialization in classes. */ // &quot;noImplicitThis&quot;: true, /* Raise error on 'this' expressions with an implied 'any' type. */ // &quot;alwaysStrict&quot;: true, /* Parse in strict mode and emit &quot;use strict&quot; for each source file. */ /* Additional Checks */ // &quot;noUnusedLocals&quot;: true, /* Report errors on unused locals. */ // &quot;noUnusedParameters&quot;: true, /* Report errors on unused parameters. */ // &quot;noImplicitReturns&quot;: true, /* Report error when not all code paths in function return a value. */ // &quot;noFallthroughCasesInSwitch&quot;: true, /* Report errors for fallthrough cases in switch statement. */ /* Module Resolution Options */ // &quot;moduleResolution&quot;: &quot;node&quot;, /* Specify module resolution strategy: 'node' (Node.js) or 'classic' (TypeScript pre-1.6). */ // &quot;baseUrl&quot;: &quot;./&quot;, /* Base directory to resolve non-absolute module names. */ // &quot;paths&quot;: {}, /* A series of entries which re-map imports to lookup locations relative to the 'baseUrl'. */ // &quot;rootDirs&quot;: [], /* List of root folders whose combined content represents the structure of the project at runtime. */ // &quot;typeRoots&quot;: [], /* List of folders to include type definitions from. */ // &quot;types&quot;: [], /* Type declaration files to be included in compilation. */ // &quot;allowSyntheticDefaultImports&quot;: true, /* Allow default imports from modules with no default export. This does not affect code emit, just typechecking. */ &quot;esModuleInterop&quot;: true, /* Enables emit interoperability between CommonJS and ES Modules via creation of namespace objects for all imports. Implies 'allowSyntheticDefaultImports'. */ // &quot;preserveSymlinks&quot;: true, /* Do not resolve the real path of symlinks. */ // &quot;allowUmdGlobalAccess&quot;: true, /* Allow accessing UMD globals from modules. */ /* Source Map Options */ // &quot;sourceRoot&quot;: &quot;&quot;, /* Specify the location where debugger should locate TypeScript files instead of source locations. */ // &quot;mapRoot&quot;: &quot;&quot;, /* Specify the location where debugger should locate map files instead of generated locations. */ // &quot;inlineSourceMap&quot;: true, /* Emit a single file with source maps instead of having a separate file. */ // &quot;inlineSources&quot;: true, /* Emit the source alongside the sourcemaps within a single file; requires '--inlineSourceMap' or '--sourceMap' to be set. */ /* Experimental Options */ // &quot;experimentalDecorators&quot;: true, /* Enables experimental support for ES7 decorators. */ // &quot;emitDecoratorMetadata&quot;: true, /* Enables experimental support for emitting type metadata for decorators. */ /* Advanced Options */ &quot;skipLibCheck&quot;: true, /* Skip type checking of declaration files. */ &quot;forceConsistentCasingInFileNames&quot;: true /* Disallow inconsistently-cased references to the same file. */ } } ``` …and then run `vercel dev`, it errors out with: ``` Error while parsing &quot;/home/ubuntu/environment/dtinth/tsconfig.json&quot; /home/ubuntu/environment/dtinth/node_modules/vercel/node_modules/@vercel/node/dist/dev-server.js:47 throw err; ^ SyntaxError: Unexpected token / in JSON at position 29 at JSON.parse (&lt;anonymous&gt;) at Object.&lt;anonymous&gt; (/home/ubuntu/environment/dtinth/node_modules/vercel/node_modules/@vercel/node/dist/dev-server.js:38:37) at Module._compile (internal/modules/cjs/loader.js:778:30) at Object.Module._extensions..js (internal/modules/cjs/loader.js:789:10) at Module.load (internal/modules/cjs/loader.js:653:32) at tryModuleLoad (internal/modules/cjs/loader.js:593:12) at Function.Module._load (internal/modules/cjs/loader.js:585:3) at Function.Module.runMain (internal/modules/cjs/loader.js:831:12) at startup (internal/bootstrap/node.js:283:19) at bootstrapNodeJSCore (internal/bootstrap/node.js:623:3) ``` From checking the source code, it seems that the code that parses `tsconfig.json` did not handle JSON comments. https://github.com/vercel/vercel/blob/c68e83f9726e622c3366653aee2674e35ccf4bc9/packages/now-node/src/dev-server.ts#L37 Note that TypeScript configuration file `tsconfig.json`, despite having a `.json` file format, is actually a JSONC (JSON with Comments) file. Easiest way to deal with this may be to use [strip-json-comments](https://www.npmjs.com/package/strip-json-comments)</DESCRIPTION>
  <REPONAME>vercel</REPONAME>
  <TIMEDIFFERENCEDAYS>62</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Bump node-fetch from 2.6.0 to 2.6.1 (#5176) Bumps [node-fetch](https://github.com/bitinn/node-fetch) from 2.6.0 to 2.6.1. &lt;details&gt; &lt;summary&gt;Release notes&lt;/summary&gt; &lt;p&gt;&lt;em&gt;Sourced from &lt;a href=&quot;https://github.com/bitinn/node-fetch/releases&quot;&gt;node-fetch's releases&lt;/a&gt;.&lt;/em&gt;&lt;/p&gt; &lt;blockquote&gt; &lt;h2&gt;v2.6.1&lt;/h2&gt; &lt;p&gt;&lt;strong&gt;This is an important security release. It is strongly recommended to update as soon as possible.&lt;/strong&gt;&lt;/p&gt; &lt;p&gt;See &lt;a href=&quot;https://github.com/node-fetch/node-fetch/blob/master/docs/CHANGELOG.md#v261&quot;&gt;CHANGELOG&lt;/a&gt; for details.&lt;/p&gt; &lt;/blockquote&gt; &lt;/details&gt; &lt;details&gt; &lt;summary&gt;Changelog&lt;/summary&gt; &lt;p&gt;&lt;em&gt;Sourced from &lt;a href=&quot;https://github.com/node-fetch/node-fetch/blob/master/docs/CHANGELOG.md&quot;&gt;node-fetch's changelog&lt;/a&gt;.&lt;/em&gt;&lt;/p&gt; &lt;blockquote&gt; &lt;h2&gt;v2.6.1&lt;/h2&gt; &lt;p&gt;&lt;strong&gt;This is an important security release. It is strongly recommended to update as soon as possible.&lt;/strong&gt;&lt;/p&gt; &lt;ul&gt; &lt;li&gt;Fix: honor the &lt;code&gt;size&lt;/code&gt; option after following a redirect.&lt;/li&gt; &lt;/ul&gt; &lt;/blockquote&gt; &lt;/details&gt; &lt;details&gt; &lt;summary&gt;Commits&lt;/summary&gt; &lt;ul&gt; &lt;li&gt;&lt;a href=&quot;https://github.com/node-fetch/node-fetch/commit/b5e2e41b2b50bf2997720d6125accaf0dd68c0ab&quot;&gt;&lt;code&gt;b5e2e41&lt;/code&gt;&lt;/a&gt; update version number&lt;/li&gt; &lt;li&gt;&lt;a href=&quot;https://github.com/node-fetch/node-fetch/commit/2358a6c2563d1730a0cdaccc197c611949f6a334&quot;&gt;&lt;code&gt;2358a6c&lt;/code&gt;&lt;/a&gt; Honor the &lt;code&gt;size&lt;/code&gt; option after following a redirect and revert data uri support&lt;/li&gt; &lt;li&gt;&lt;a href=&quot;https://github.com/node-fetch/node-fetch/commit/8c197f8982a238b3c345c64b17bfa92e16b4f7c4&quot;&gt;&lt;code&gt;8c197f8&lt;/code&gt;&lt;/a&gt; docs: Fix typos and grammatical errors in README.md (&lt;a href=&quot;https://github-redirect.dependabot.com/bitinn/node-fetch/issues/686&quot;&gt;#686&lt;/a&gt;)&lt;/li&gt; &lt;li&gt;&lt;a href=&quot;https://github.com/node-fetch/node-fetch/commit/1e99050f944ac435fce26a9549eadcc2419a968a&quot;&gt;&lt;code&gt;1e99050&lt;/code&gt;&lt;/a&gt; fix: Change error message thrown with redirect mode set to error (&lt;a href=&quot;https://github-redirect.dependabot.com/bitinn/node-fetch/issues/653&quot;&gt;#653&lt;/a&gt;)&lt;/li&gt; &lt;li&gt;&lt;a href=&quot;https://github.com/node-fetch/node-fetch/commit/244e6f63d42025465796e3ca4ce813bf2c31fc5b&quot;&gt;&lt;code&gt;244e6f6&lt;/code&gt;&lt;/a&gt; docs: Show backers in README&lt;/li&gt; &lt;li&gt;&lt;a href=&quot;https://github.com/node-fetch/node-fetch/commit/6a5d192034a0f438551dffb6d2d8df2c00921d16&quot;&gt;&lt;code&gt;6a5d192&lt;/code&gt;&lt;/a&gt; fix: Properly parse meta tag when parameters are reversed (&lt;a href=&quot;https://github-redirect.dependabot.com/bitinn/node-fetch/issues/682&quot;&gt;#682&lt;/a&gt;)&lt;/li&gt; &lt;li&gt;&lt;a href=&quot;https://github.com/node-fetch/node-fetch/commit/47a24a03eb49a49d81b768892aee10074ed54a91&quot;&gt;&lt;code&gt;47a24a0&lt;/code&gt;&lt;/a&gt; chore: Add opencollective badge&lt;/li&gt; &lt;li&gt;&lt;a href=&quot;https://github.com/node-fetch/node-fetch/commit/7b136627c537cb24430b0310638c9177a85acee1&quot;&gt;&lt;code&gt;7b13662&lt;/code&gt;&lt;/a&gt; chore: Add funding link&lt;/li&gt; &lt;li&gt;&lt;a href=&quot;https://github.com/node-fetch/node-fetch/commit/5535c2ed478d418969ecfd60c16453462de2a53f&quot;&gt;&lt;code&gt;5535c2e&lt;/code&gt;&lt;/a&gt; fix: Check for global.fetch before binding it (&lt;a href=&quot;https://github-redirect.dependabot.com/bitinn/node-fetch/issues/674&quot;&gt;#674&lt;/a&gt;)&lt;/li&gt; &lt;li&gt;&lt;a href=&quot;https://github.com/node-fetch/node-fetch/commit/1d5778ad0d910dbd1584fb407a186f5a0bc1ea22&quot;&gt;&lt;code&gt;1d5778a&lt;/code&gt;&lt;/a&gt; docs: Add Discord badge&lt;/li&gt; &lt;li&gt;Additional commits viewable in &lt;a href=&quot;https://github.com/bitinn/node-fetch/compare/v2.6.0...v2.6.1&quot;&gt;compare view&lt;/a&gt;&lt;/li&gt; &lt;/ul&gt; &lt;/details&gt; &lt;details&gt; &lt;summary&gt;Maintainer changes&lt;/summary&gt; &lt;p&gt;This version was pushed to npm by &lt;a href=&quot;https://www.npmjs.com/~akepinski&quot;&gt;akepinski&lt;/a&gt;, a new releaser for node-fetch since your current version.&lt;/p&gt; &lt;/details&gt; &lt;br /&gt; [![Dependabot compatibility score](https://dependabot-badges.githubapp.com/badges/compatibility_score?dependency-name=node-fetch&amp;package-manager=npm_and_yarn&amp;previous-version=2.6.0&amp;new-version=2.6.1)](https://docs.github.com/en/github/managing-security-vulnerabilities/configuring-github-dependabot-security-updates) Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`. [//]: # (dependabot-automerge-start) [//]: # (dependabot-automerge-end) --- &lt;details&gt; &lt;summary&gt;Dependabot commands and options&lt;/summary&gt; &lt;br /&gt; You can trigger Dependabot actions by commenting on this PR: - `@dependabot rebase` will rebase this PR - `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it - `@dependabot merge` will merge this PR after your CI passes on it - `@dependabot squash and merge` will squash and merge this PR after your CI passes on it - `@dependabot cancel merge` will cancel a previously requested merge and block automerging - `@dependabot reopen` will reopen this PR if it is closed - `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually - `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself) - `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself) - `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself) - `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language - `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language - `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language - `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language You can disable automated security fix PRs for this repo from the [Security Alerts page](https://github.com/vercel/vercel/network/alerts). &lt;/details&gt;</MESSAGE>
    <SHA>7c35d7992b9262deee49317f791af66eb87b65cc</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>[node] Use `ts.readConfigFile()` to parse user's `tsconfig.json` file (#5180) TypeScript supports comments in the `tsconfig.json` file, which is not compatible with `JSON.parse()` so we have to use the built-in function to parse the config file. Fixes #4835.</MESSAGE>
      <SHA>b69a41a0aa6184c48eea2bc26299e6b7369fdab5</SHA>
      <PATCHEDFILES>
        <FILE>packages/now-cli/test/dev/fixtures/node-ts-node-target/tsconfig.json</FILE>
        <FILE>packages/now-node/src/dev-server.ts</FILE>
        <FILE>packages/now-node/tsconfig.json</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
