<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>7086</ISSUENO>
  <ISSUEURL>https://github.com/vercel/vercel/issues/7086</ISSUEURL>
  <TITLE>`_middleware.js` does not have access to process.env when run without Next.js</TITLE>
  <DESCRIPTION>When compiling the `_middleware.js` file with esbuild you need to pass the `process.env` variables to define or those will be undefined https://github.com/vercel/vercel/blob/be1c78e72f1bbb23fbbcecf569049211cdf8bd52/packages/middleware/src/index.ts#L66</DESCRIPTION>
  <REPONAME>vercel</REPONAME>
  <TIMEDIFFERENCEDAYS>7</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Publish Canary - @vercel/build-utils@2.12.3-canary.41 - vercel@23.1.3-canary.64 - @vercel/client@10.2.3-canary.42 - vercel-plugin-middleware@0.0.0-canary.17 - vercel-plugin-go@1.0.0-canary.29 - vercel-plugin-node@1.12.2-canary.33 - vercel-plugin-python@1.0.0-canary.30 - vercel-plugin-ruby@1.0.0-canary.29</MESSAGE>
    <SHA>35c8fc272905524eeb83268bdc09edb165d3382a</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>[middleware] Define env vars when building `_middleware.js` with esbuild (#7087) ### Related Issues &gt; Fixes #7086 &gt; Related to #7086 ### Checklist &lt;!-- Please keep your PR as a Draft until the checklist is complete --&gt; #### Tests - [x] The code changed/added as part of this PR has been covered with tests - [x] All tests pass locally with `yarn test-unit` #### Code Review - [x] This PR has a concise title and thorough description useful to a reviewer - [ ] Issue from task tracker has a link to this PR</MESSAGE>
      <SHA>d94b9806ab9ff1d8f19ab7153784a53060f0c96a</SHA>
      <PATCHEDFILES>
        <FILE>packages/middleware/src/esbuild-plugins.ts</FILE>
        <FILE>packages/middleware/src/index.ts</FILE>
        <FILE>packages/middleware/test/build.test.ts</FILE>
        <FILE>packages/middleware/test/fixtures/env/_middleware.js</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
