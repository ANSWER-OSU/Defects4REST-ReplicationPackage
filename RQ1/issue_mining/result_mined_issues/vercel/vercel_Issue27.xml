<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>27</ISSUENO>
  <ISSUEURL>https://github.com/vercel/vercel/issues/27</ISSUEURL>
  <TITLE>Aliasing a `now-serve` deployment to custom domain</TITLE>
  <DESCRIPTION>Hopefully I just have a bad dependency somewhere. Note that the domain I'm trying this with is a .bm (Bermuda) domain name, not sure if that matters but it's definitely not common. Deployment ID and domain truncated and replaced, respectively, for privacy. ``` bash $ now alias wKUr5n example.bm --debug &gt; [debug] Checking for updates. &gt; [debug] Up to date (0.25.0). &gt; [debug] /list: 703.425ms &gt; [debug] matched deployment wKUr5n by uid wKUr5n &gt; example.bm is a custom domain. &gt; Verifying the DNS settings for example.bm (see https://zeit.world for help) &gt; [debug] #1 GET /whois-ns: 287.395ms &gt; [debug] Retrying: Error: Whois error (500): An unexpected internal error occurred at Alias._callee11$ (/usr/local/lib/node_modules/now/build/lib/index.js:900:27) at tryCatch (/usr/local/lib/node_modules/now/node_modules/babel-runtime/regenerator/runtime.js:88:40) at GeneratorFunctionPrototype.invoke [as _invoke] (/usr/local/lib/node_modules/now/node_modules/babel-runtime/regenerator/runtime.js:341:22) at GeneratorFunctionPrototype.prototype.(anonymous function) [as next] (/usr/local/lib/node_modules/now/node_modules/babel-runtime/regenerator/runtime.js:121:21) at step (/usr/local/lib/node_modules/now/node_modules/babel-runtime/helpers/asyncToGenerator.js:17:30) at /usr/local/lib/node_modules/now/node_modules/babel-runtime/helpers/asyncToGenerator.js:28:13 at run (/usr/local/lib/node_modules/now/node_modules/core-js/library/modules/es6.promise.js:108:47) at /usr/local/lib/node_modules/now/node_modules/core-js/library/modules/es6.promise.js:119:28 at flush (/usr/local/lib/node_modules/now/node_modules/core-js/library/modules/$.microtask.js:19:5) at nextTickCallbackWith0Args (node.js:433:9) &gt; [debug] #2 GET /whois-ns: 84.056ms &gt; [debug] Retrying: Error: Whois error (500): An unexpected internal error occurred at Alias._callee11$ (/usr/local/lib/node_modules/now/build/lib/index.js:900:27) at tryCatch (/usr/local/lib/node_modules/now/node_modules/babel-runtime/regenerator/runtime.js:88:40) at GeneratorFunctionPrototype.invoke [as _invoke] (/usr/local/lib/node_modules/now/node_modules/babel-runtime/regenerator/runtime.js:341:22) at GeneratorFunctionPrototype.prototype.(anonymous function) [as next] (/usr/local/lib/node_modules/now/node_modules/babel-runtime/regenerator/runtime.js:121:21) at step (/usr/local/lib/node_modules/now/node_modules/babel-runtime/helpers/asyncToGenerator.js:17:30) at /usr/local/lib/node_modules/now/node_modules/babel-runtime/helpers/asyncToGenerator.js:28:13 at run (/usr/local/lib/node_modules/now/node_modules/core-js/library/modules/es6.promise.js:108:47) at /usr/local/lib/node_modules/now/node_modules/core-js/library/modules/es6.promise.js:119:28 at flush (/usr/local/lib/node_modules/now/node_modules/core-js/library/modules/$.microtask.js:19:5) at nextTickCallbackWith0Args (node.js:433:9) &gt; [debug] Retrying: FetchError: request to https://api.zeit.co/whois-ns-fallback?domain=example.bm failed, reason: socket hang up at ClientRequest.&lt;anonymous&gt; (/usr/local/lib/node_modules/now/node_modules/node-fetch/index.js:127:11) at emitOne (events.js:77:13) at ClientRequest.emit (events.js:169:7) at Socket.socketErrorListener (_http_client.js:265:9) at emitOne (events.js:77:13) at Socket.emit (events.js:169:7) at Stream.onStreamError (/usr/local/lib/node_modules/now/node_modules/spdy/lib/spdy/handle.js:89:18) at emitOne (events.js:77:13) at Stream.emit (events.js:169:7) at /usr/local/lib/node_modules/now/node_modules/spdy-transport/lib/spdy-transport/connection.js:752:12 ```</DESCRIPTION>
  <REPONAME>vercel</REPONAME>
  <TIMEDIFFERENCEDAYS>7</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Feature/domains (#26) * Add the skeleton of `now teams` * Add support for &quot;complex&quot; command aliases This adds the ability to set, for example, `now switch` as an alias for `now teams switch`. Subsequent commands and arguments are taken into account: `now switch zeit --debug` will be parsed to `now teams switch zeit --debug`. * `now switch` =&gt; `now teams switch` * Extract `rightPad` * Extract `eraseLines` * Extract `✓` * Text input: add `valid` option * Text input: add `forceLowerCase` option * Add preliminary `now teams add` * Make the linter happy * Extract `&gt; NOTE: ...` * Add missing labels * Fix typos * Add missing parameters * Change the section label after inviting all specified team mates * Call the API after each email submission * Show the elapsed time after each `inviteUser` api call * Handle user aborts * We don't need `args` for `now teams add` * Add missing `await` * Extract regex * `process.exit()` =&gt; `exit(1)` * `prompt-bool` is an `input` util, not an `output` one * Add the ability to delete a key from the config file * Add `fatal-error` * Add `now teams invite` * This shouldn't be black * Save the username in `~/.now.json` upon login * Save the token and userId instead of token and email * Fix typo * Save more info about the user to `~/.now.json` upon login * `~/.now.json`: Persist the current time when login in * Add `user` helper * `user.userId` =&gt; `user.id` * Tweak code organization * Add caching system to `.now.json` * Automatically switch to a team after its creation * Introduce the concept of `inactive` teams * Use bold for `payment method` * Remove duplicated code * Add line breaks * Auto complete with the first match * Remove placeholder stuff * Add the user's email to the list of suggestions * FIx bad merge * Add `now switch` * Make `now teams invite` more reliable and faster * Shut up XO * Improve autocompletion * Fix TypeError * Make stuff pretty * Not sure how this got overwritten * `prompt-bool` is an `input` util, not an `output` one * Make stuff pretty * Not sure how this got overwritten * Add domains.status, price and buy * Add `now domains buy` * Add the ability to buy a domain when running `now alias`</MESSAGE>
    <SHA>ead1da927b0e3eaa53f8a89f86d3a535192470ef</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Logs (#27) * Added `logs` sub command * add missing dependencies * use utils/output/logo * logs: fix wrong reference * logs: fix buffer time * sort build logs (#19) * logs: use lib/logs * lib/logs: fix * logs: resolve url to id * logs: default to follow * logs: don't resolve URL to id * logs: revert to default unfollow * logs: add since option and until option * logs: fix default number of logs * fix logs auth * logs: listen ready event * logs: new endpoint * log: remove v query param * logs: default to not include access logs * fix styles of now-logs * logs: remove relative time</MESSAGE>
      <SHA>4bbf8d55d11b49d58cea1bffc28f0443dd710cc1</SHA>
      <PATCHEDFILES>
        <FILE>bin/now-logs.js</FILE>
        <FILE>bin/now-remove.js</FILE>
        <FILE>bin/now.js</FILE>
        <FILE>lib/index.js</FILE>
        <FILE>lib/logs.js</FILE>
        <FILE>lib/utils/url.js</FILE>
        <FILE>package.json</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Add `logs`, `teams`, `switch`, `scale`, new `ls` and much more (#468) * Feature/teams (#25) * Add the skeleton of `now teams` * Add support for &quot;complex&quot; command aliases This adds the ability to set, for example, `now switch` as an alias for `now teams switch`. Subsequent commands and arguments are taken into account: `now switch zeit --debug` will be parsed to `now teams switch zeit --debug`. * `now switch` =&gt; `now teams switch` * Extract `rightPad` * Extract `eraseLines` * Extract `✓` * Text input: add `valid` option * Text input: add `forceLowerCase` option * Add preliminary `now teams add` * Make the linter happy * Extract `&gt; NOTE: ...` * Add missing labels * Fix typos * Add missing parameters * Change the section label after inviting all specified team mates * Call the API after each email submission * Show the elapsed time after each `inviteUser` api call * Handle user aborts * We don't need `args` for `now teams add` * Add missing `await` * Extract regex * `process.exit()` =&gt; `exit(1)` * `prompt-bool` is an `input` util, not an `output` one * Add the ability to delete a key from the config file * Add `fatal-error` * Add `now teams invite` * This shouldn't be black * Save the username in `~/.now.json` upon login * Save the token and userId instead of token and email * Fix typo * Save more info about the user to `~/.now.json` upon login * `~/.now.json`: Persist the current time when login in * Add `user` helper * `user.userId` =&gt; `user.id` * Tweak code organization * Add caching system to `.now.json` * Automatically switch to a team after its creation * Introduce the concept of `inactive` teams * Use bold for `payment method` * Remove duplicated code * Add line breaks * Auto complete with the first match * Remove placeholder stuff * Add the user's email to the list of suggestions * FIx bad merge * Add `now switch` * Make `now teams invite` more reliable and faster * Shut up XO * Improve autocompletion * Fix TypeError * Make stuff pretty * Not sure how this got overwritten * Feature/domains (#26) * Add the skeleton of `now teams` * Add support for &quot;complex&quot; command aliases This adds the ability to set, for example, `now switch` as an alias for `now teams switch`. Subsequent commands and arguments are taken into account: `now switch zeit --debug` will be parsed to `now teams switch zeit --debug`. * `now switch` =&gt; `now teams switch` * Extract `rightPad` * Extract `eraseLines` * Extract `✓` * Text input: add `valid` option * Text input: add `forceLowerCase` option * Add preliminary `now teams add` * Make the linter happy * Extract `&gt; NOTE: ...` * Add missing labels * Fix typos * Add missing parameters * Change the section label after inviting all specified team mates * Call the API after each email submission * Show the elapsed time after each `inviteUser` api call * Handle user aborts * We don't need `args` for `now teams add` * Add missing `await` * Extract regex * `process.exit()` =&gt; `exit(1)` * `prompt-bool` is an `input` util, not an `output` one * Add the ability to delete a key from the config file * Add `fatal-error` * Add `now teams invite` * This shouldn't be black * Save the username in `~/.now.json` upon login * Save the token and userId instead of token and email * Fix typo * Save more info about the user to `~/.now.json` upon login * `~/.now.json`: Persist the current time when login in * Add `user` helper * `user.userId` =&gt; `user.id` * Tweak code organization * Add caching system to `.now.json` * Automatically switch to a team after its creation * Introduce the concept of `inactive` teams * Use bold for `payment method` * Remove duplicated code * Add line breaks * Auto complete with the first match * Remove placeholder stuff * Add the user's email to the list of suggestions * FIx bad merge * Add `now switch` * Make `now teams invite` more reliable and faster * Shut up XO * Improve autocompletion * Fix TypeError * Make stuff pretty * Not sure how this got overwritten * `prompt-bool` is an `input` util, not an `output` one * Make stuff pretty * Not sure how this got overwritten * Add domains.status, price and buy * Add `now domains buy` * Add the ability to buy a domain when running `now alias` * Logs (#27) * Added `logs` sub command * add missing dependencies * use utils/output/logo * logs: fix wrong reference * logs: fix buffer time * sort build logs (#19) * logs: use lib/logs * lib/logs: fix * logs: resolve url to id * logs: default to follow * logs: don't resolve URL to id * logs: revert to default unfollow * logs: add since option and until option * logs: fix default number of logs * fix logs auth * logs: listen ready event * logs: new endpoint * log: remove v query param * logs: default to not include access logs * fix styles of now-logs * logs: remove relative time * Fix bad merge conflict * Add `now scale` (#28) * Inital drafts fro `now-scale` * More final draft * sketch new `now ls` format * Add sketch for `now ls --all` * Placeholder for `now scale ls` * &quot;Prettify&quot; and improve scale command Signed-off-by: Jarmo Isotalo &lt;jamo@isotalo.fi&gt; * Adopt to now-list api changes * Improve now-list --all colors Signed-off-by: Jarmo Isotalo &lt;jamo@isotalo.fi&gt; * Add now scale ls Signed-off-by: Jarmo Isotalo &lt;jamo@isotalo.fi&gt; * Prettify * Show auto correctly * Add partial match scale for now alias * Make alias to match scale before uptading alias and presumably a bunch of unrelated style changes * Replace spinners with help text * Make the list :nice: * Make now-list great again * Final touches * Allow --all only when app is defined * Add progress tracking to scale * Correctly use --all for &gt; 0 deployments found [1s] and improve scale info ux * Show --all info if we are hiding stuff * Fixes * Refactor scale info and unfreeze * Fixes * Proper progress bar * Fix bad merge * Fix auth for now-scale * logs: fix reading config * Fix reference * Small ux tweaks * Improve now alias ux * Fix a ton of lint errors * Fix scaling up and alias ux * Fix lint errors + prettify * Make `bin/now-scale.js` available via `now scale` * Fix errornous syntax for domains list * And use correct header for domains list * Update now-scale help to match new spec * `await` for `cfg.read()` on `cfg.remove()` * Update scale command * Cleanu p * Fetch the teams from the api on teams.ls() Plus prettier shit * Run prettier hooks manually * Make `now switch` perfect * Rm unused variables * Lint * Ruin ux but lint * Consume `POST /teams` * Consume `PATCH /teams/:id` * Fix/teams support (#29) * Add teams support for lib/index.js * Consume `POST /teams/:id/members` * Make `now teams create` and `now teams invite` perfect * Add a way to not send `?teamId` if necessary * Add `?teamId=${currentTeam.id}` support to all comamnds and subcommands * Display the username only if it's available * Consume the preoduction endpoits for domain purchase * Fix typo * Fix grammar * Fix grammar * Remove useless require * Display the user name/team slug on creation/list commands * Remove use of old, now undefined variable * Show domains in bold on `now domains ls` * `user.userId` =&gt; `user.uid` * Remove console.log * Show a better messsage upon unexpected `domains.buy()` error * typo * Consume new `/plan` API and fix plan check * Update `now upgrade` – consume new APIs and expose new plans * Fix `now ugprade` info message * `now cc`: consume new APIs and fix error messages * Add team/user context to `now alias` when buying a domain * Fix wording on `now domains buy` * Add stamp to domain purchase * Improve scale ux * Remove ToS prompt upon login * Fix `prompt-bool` trailing issues * Remove useless `require` * Allow `now switch &lt;username&gt;` * Make `now help` better * This shouldn't be here * Make `now switch` incredible * Remove old stuff from ~/.now.json * Add comments * `now team` =&gt; `now teams` * 5.0.0 * Fix linter * Fix DNS * Parse subdomain * FIx lint * drop IDs for certs * Make now ls look nice also when noTTY * Make now list look nice when colors are not supported * Mane certs ls look nice when we have no colers * Now ls --all can also take uniq url as a parameter * Improve now ls --all * Now ls -all takes alias as an argument</MESSAGE>
      <SHA>e59e7616c719b0194d729d489f57e1176bacef35</SHA>
      <PATCHEDFILES>
        <FILE>bin/domains/buy.js</FILE>
        <FILE>bin/now-alias.js</FILE>
        <FILE>bin/now-billing-add.js</FILE>
        <FILE>bin/now-billing.js</FILE>
        <FILE>bin/now-certs.js</FILE>
        <FILE>bin/now-deploy.js</FILE>
        <FILE>bin/now-dns.js</FILE>
        <FILE>bin/now-domains.js</FILE>
        <FILE>bin/now-list.js</FILE>
        <FILE>bin/now-logs.js</FILE>
        <FILE>bin/now-open.js</FILE>
        <FILE>bin/now-remove.js</FILE>
        <FILE>bin/now-scale.js</FILE>
        <FILE>bin/now-secrets.js</FILE>
        <FILE>bin/now-teams.js</FILE>
        <FILE>bin/now-upgrade.js</FILE>
        <FILE>bin/now.js</FILE>
        <FILE>bin/teams/add.js</FILE>
        <FILE>bin/teams/invite.js</FILE>
        <FILE>bin/teams/switch.js</FILE>
        <FILE>lib/alias.js</FILE>
        <FILE>lib/cfg.js</FILE>
        <FILE>lib/credit-cards.js</FILE>
        <FILE>lib/domains.js</FILE>
        <FILE>lib/index.js</FILE>
        <FILE>lib/login.js</FILE>
        <FILE>lib/logs.js</FILE>
        <FILE>lib/plans.js</FILE>
        <FILE>lib/re-alias.js</FILE>
        <FILE>lib/scale-info.js</FILE>
        <FILE>lib/scale.js</FILE>
        <FILE>lib/teams.js</FILE>
        <FILE>lib/unfreeze.js</FILE>
        <FILE>lib/user.js</FILE>
        <FILE>lib/utils/domains/treat-buy-error.js</FILE>
        <FILE>lib/utils/fatal-error.js</FILE>
        <FILE>lib/utils/input/regexes.js</FILE>
        <FILE>lib/utils/input/text.js</FILE>
        <FILE>lib/utils/output/chars.js</FILE>
        <FILE>lib/utils/output/erase-lines.js</FILE>
        <FILE>lib/utils/output/note.js</FILE>
        <FILE>lib/utils/output/right-pad.js</FILE>
        <FILE>lib/utils/url.js</FILE>
        <FILE>package.json</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Merge pull request #27 from vdanchenkov/network-errors Do not swallow network errors</MESSAGE>
      <SHA>ab3ee7d322a758ea451f2a7a259e626a17d268c4</SHA>
      <PATCHEDFILES>
        <FILE>src/now.js</FILE>
        <FILE>test/index.js</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
