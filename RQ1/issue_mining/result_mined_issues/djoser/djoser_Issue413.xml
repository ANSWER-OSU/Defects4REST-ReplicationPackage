<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>413</ISSUENO>
  <ISSUEURL>https://github.com/sunscrapers/djoser/issues/413</ISSUEURL>
  <TITLE>AttributeError at /api/auth/users/</TITLE>
  <DESCRIPTION>I tried to create a new user by running a POST request to `/api/auth/users/`. User created and email sended, but with error: ``` Got AttributeError when attempting to get a value for field `re_password` on serializer `UserCreatePasswordRetypeSerializer`. The serializer field might be named incorrectly and not match any attribute or key on the `User` instance. Original exception text was: 'User' object has no attribute 're_password'. ``` ``` Environment: Request Method: POST Request URL: http://api.localhost/api/auth/users/ Django Version: 2.2.3 Python Version: 3.7.3 Installed Applications: ['corsheaders', 'django_filters', 'mptt', 'django.contrib.admin', 'django.contrib.auth', 'django.contrib.contenttypes', 'django.contrib.sessions', 'django.contrib.messages', 'django.contrib.staticfiles', 'django.contrib.sites', 'rest_framework', 'rest_framework.authtoken', 'djoser', 'debug_toolbar'] Installed Middleware: ['debug_toolbar.middleware.DebugToolbarMiddleware', 'django.middleware.security.SecurityMiddleware', 'django.contrib.sessions.middleware.SessionMiddleware', 'corsheaders.middleware.CorsMiddleware', 'django.middleware.common.CommonMiddleware', 'django.middleware.csrf.CsrfViewMiddleware', 'django.contrib.auth.middleware.AuthenticationMiddleware', 'django.contrib.messages.middleware.MessageMiddleware', 'django.middleware.clickjacking.XFrameOptionsMiddleware', 'django_currentuser.middleware.ThreadLocalUserMiddleware'] Traceback: File &quot;/usr/local/lib/python3.7/site-packages/rest_framework/fields.py&quot; in get_attribute 443. return get_attribute(instance, self.source_attrs) File &quot;/usr/local/lib/python3.7/site-packages/rest_framework/fields.py&quot; in get_attribute 93. instance = getattr(instance, attr) During handling of the above exception ('User' object has no attribute 're_password'), another exception occurred: File &quot;/usr/local/lib/python3.7/site-packages/django/core/handlers/exception.py&quot; in inner 34. response = get_response(request) File &quot;/usr/local/lib/python3.7/site-packages/django/core/handlers/base.py&quot; in _get_response 115. response = self.process_exception_by_middleware(e, request) File &quot;/usr/local/lib/python3.7/site-packages/django/core/handlers/base.py&quot; in _get_response 113. response = wrapped_callback(request, *callback_args, **callback_kwargs) File &quot;/usr/local/lib/python3.7/site-packages/django/views/decorators/csrf.py&quot; in wrapped_view 54. return view_func(*args, **kwargs) File &quot;/usr/local/lib/python3.7/site-packages/rest_framework/viewsets.py&quot; in view 114. return self.dispatch(request, *args, **kwargs) File &quot;/usr/local/lib/python3.7/site-packages/rest_framework/views.py&quot; in dispatch 497. response = self.handle_exception(exc) File &quot;/usr/local/lib/python3.7/site-packages/rest_framework/views.py&quot; in handle_exception 457. self.raise_uncaught_exception(exc) File &quot;/usr/local/lib/python3.7/site-packages/rest_framework/views.py&quot; in raise_uncaught_exception 468. raise exc File &quot;/usr/local/lib/python3.7/site-packages/rest_framework/views.py&quot; in dispatch 494. response = handler(request, *args, **kwargs) File &quot;/usr/local/lib/python3.7/site-packages/rest_framework/mixins.py&quot; in create 20. headers = self.get_success_headers(serializer.data) File &quot;/usr/local/lib/python3.7/site-packages/rest_framework/serializers.py&quot; in data 559. ret = super().data File &quot;/usr/local/lib/python3.7/site-packages/rest_framework/serializers.py&quot; in data 261. self._data = self.to_representation(self.instance) File &quot;/usr/local/lib/python3.7/site-packages/rest_framework/serializers.py&quot; in to_representation 513. attribute = field.get_attribute(instance) File &quot;/usr/local/lib/python3.7/site-packages/rest_framework/fields.py&quot; in get_attribute 476. raise type(exc)(msg) Exception Type: AttributeError at /api/auth/users/ Exception Value: Got AttributeError when attempting to get a value for field `re_password` on serializer `UserCreatePasswordRetypeSerializer`. The serializer field might be named incorrectly and not match any attribute or key on the `User` instance. Original exception text was: 'User' object has no attribute 're_password'. ``` settings.py ```python DJOSER = { 'ACTIVATION_URL': '#/activate/{uid}/{token}', 'PASSWORD_RESET_CONFIRM_RETYPE': True, 'PASSWORD_RESET_CONFIRM_URL': '#/password/reset/confirm/{uid}/{token}', 'SEND_ACTIVATION_EMAIL': True, 'SEND_CONFIRMATION_EMAIL': True, 'USER_CREATE_PASSWORD_RETYPE': True, } ``` User Model ```python class User(AbstractUser): USERNAME_FIELD = 'email' REQUIRED_FIELDS = [] username = None email = models.EmailField('Email', unique=True) company = models.ForeignKey(Company, on_delete=models.CASCADE, null=True, blank=True) objects = IMSUserManager() ``` UserManager, rewrite without username ```python class IMSUserManager(BaseUserManager): use_in_migrations = True def _create_user(self, email, password, **extra_fields): &quot;&quot;&quot; Create and save a user with the given username, email, and password. &quot;&quot;&quot; if not email: raise ValueError('The given email must be set') email = self.normalize_email(email) user = self.model(email=email, **extra_fields) user.set_password(password) user.save(using=self._db) return user def create_user(self, email=None, password=None, **extra_fields): extra_fields.setdefault('is_staff', False) extra_fields.setdefault('is_superuser', False) return self._create_user(email, password, **extra_fields) def create_superuser(self, email, password, **extra_fields): extra_fields.setdefault('is_staff', True) extra_fields.setdefault('is_superuser', True) if extra_fields.get('is_staff') is not True: raise ValueError('Superuser must have is_staff=True.') if extra_fields.get('is_superuser') is not True: raise ValueError('Superuser must have is_superuser=True.') return self._create_user(email, password, **extra_fields) ```</DESCRIPTION>
  <REPONAME>djoser</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Fix documentation</MESSAGE>
    <SHA>4943b532c8e2e9013bbfc39239b3704ce2ff63cf</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fix registration bug; fixes #413</MESSAGE>
      <SHA>856a5930b259db03182e4fa374dfba268bb82c97</SHA>
      <PATCHEDFILES>
        <FILE>CHANGELOG.rst</FILE>
        <FILE>djoser/__init__.py</FILE>
        <FILE>djoser/serializers.py</FILE>
        <FILE>docs/source/conf.py</FILE>
        <FILE>setup.py</FILE>
        <FILE>testproject/testapp/tests/test_user_create.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Merge pull request #414 from dekoza/fix/413 Fix registration bug; fixes #413</MESSAGE>
      <SHA>21eeae9da9014af109b4c2d9142f7505674b4159</SHA>
      <PATCHEDFILES>
        <FILE>CHANGELOG.rst</FILE>
        <FILE>djoser/__init__.py</FILE>
        <FILE>djoser/serializers.py</FILE>
        <FILE>docs/source/conf.py</FILE>
        <FILE>setup.py</FILE>
        <FILE>testproject/testapp/tests/test_user_create.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
