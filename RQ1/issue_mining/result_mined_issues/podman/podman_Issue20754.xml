<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>20754</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/20754</ISSUEURL>
  <TITLE>tmpfs mount is not always world-writable anymore</TITLE>
  <DESCRIPTION>### Issue Description After my fedora coreos device updated itself yesterday from `38.20231027.3.2` to `39.20231101.3.0`, one of my containers failed to start. It is a rootless container with a read-only filesystem which runs as a non-root user. The process requires a work directory, which is why I mount a tmpfs at this location. However, after the upgrade, the work directory was not writable anymore for the user in the container. I compared the package list between the two releases and the only podman-relevant package was the upgrade of `crun`: `crun-1.10-1.fc38.aarch64 ⟶ 1.11-1.fc39.aarch64` Apparently, crun &gt;= 1.11 uses the permissions of the underlying directory as mode for the tmpfs mount if no mode is specified (https://github.com/containers/crun/commit/3b874c2045a31ee049941947ddbc7114a09fd2c1). The [documentation](https://github.com/containers/podman/blob/ed1d3d6ee8d0eb8e7973ea255a131f3409bdf388/docs/source/markdown/options/mount.md?plain=1#L86) states: &gt; · tmpfs-mode: File mode of the tmpfs/ramfs in octal. (e.g. 700 or 0700.) Defaults to 1777 in Linux. I guess this was the case for me before the crun update, but now the statement about the default does not apply anymore. Possible solutions: 1. Fix the documentation. 2. Append `mode=1777` to a tmpfs mount, if no other mode is specified. ### Steps to reproduce the issue Steps to reproduce the issue 1. update to crun &gt;= 1.11 2. run `podman run --userns=keep-id --tmpfs /home docker.io/library/alpine:latest touch /home/test` 3. get error message: &gt; touch: /home/test: Permission denied ### Describe the results you received The tmpfs mount is not writable for the non-root user. ### Describe the results you expected The tmpfs mount should be writable for the non-root user. ### podman info output ```yaml host: arch: arm64 buildahVersion: 1.32.0 cgroupControllers: - cpu - memory - pids cgroupManager: systemd cgroupVersion: v2 conmon: package: conmon-2.1.7-3.fc39.aarch64 path: /usr/bin/conmon version: 'conmon version 2.1.7, commit: ' cpuUtilization: idlePercent: 99.79 systemPercent: 0.09 userPercent: 0.12 cpus: 4 databaseBackend: boltdb distribution: distribution: fedora variant: coreos version: &quot;39&quot; eventLogger: file freeLocks: 2044 hostname: localhost.localdomain idMappings: gidmap: - container_id: 0 host_id: 1001 size: 1 - container_id: 1 host_id: 589824 size: 65536 uidmap: - container_id: 0 host_id: 1001 size: 1 - container_id: 1 host_id: 589824 size: 65536 kernel: 6.5.9-300.fc39.aarch64 linkmode: dynamic logDriver: none memFree: 6860488704 memTotal: 8204500992 networkBackend: netavark networkBackendInfo: backend: netavark dns: package: aardvark-dns-1.8.0-1.fc39.aarch64 path: /usr/libexec/podman/aardvark-dns version: aardvark-dns 1.8.0 package: netavark-1.8.0-2.fc39.aarch64 path: /usr/libexec/podman/netavark version: netavark 1.8.0 ociRuntime: name: crun package: crun-1.11-1.fc39.aarch64 path: /usr/bin/crun version: |- crun version 1.11 commit: 11f8d3dc9fc4bb8a0adcff5ba8bd340f24612701 rundir: /run/user/1001/crun spec: 1.0.0 +SYSTEMD +SELINUX +APPARMOR +CAP +SECCOMP +EBPF +CRIU +LIBKRUN +WASM:wasmedge +YAJL os: linux pasta: executable: /usr/bin/pasta package: passt-0^20231004.gf851084-1.fc39.aarch64 version: | pasta 0^20231004.gf851084-1.fc39.aarch64-pasta Copyright Red Hat GNU General Public License, version 2 or later &lt;https://www.gnu.org/licenses/old-licenses/gpl-2.0.html&gt; This is free software: you are free to change and redistribute it. There is NO WARRANTY, to the extent permitted by law. remoteSocket: exists: false path: /run/user/1001/podman/podman.sock security: apparmorEnabled: false capabilities: CAP_CHOWN,CAP_DAC_OVERRIDE,CAP_FOWNER,CAP_FSETID,CAP_KILL,CAP_NET_BIND_SERVICE,CAP_SETFCAP,CAP_SETGID,CAP_SETPCAP,CAP_SETUID,CAP_SYS_CHROOT rootless: true seccompEnabled: true seccompProfilePath: /usr/share/containers/seccomp.json selinuxEnabled: true serviceIsRemote: false slirp4netns: executable: /usr/bin/slirp4netns package: slirp4netns-1.2.2-1.fc39.aarch64 version: |- slirp4netns version 1.2.2 commit: 0ee2d87523e906518d34a6b423271e4826f71faf libslirp: 4.7.0 SLIRP_CONFIG_VERSION_MAX: 4 libseccomp: 2.5.3 swapFree: 0 swapTotal: 0 uptime: 36h 17m 18.00s (Approximately 1.50 days) plugins: authorization: null log: - k8s-file - none - passthrough - journald network: - bridge - macvlan - ipvlan volume: - local registries: search: - registry.fedoraproject.org - registry.access.redhat.com - docker.io - quay.io store: configFile: /var/home/podman/.config/containers/storage.conf containerStore: number: 4 paused: 0 running: 4 stopped: 0 graphDriverName: overlay graphOptions: overlay.mount_program: Executable: /usr/bin/fuse-overlayfs Package: fuse-overlayfs-1.12-2.fc39.aarch64 Version: |- fusermount3 version: 3.16.1 fuse-overlayfs: version 1.12 FUSE library version 3.16.1 using FUSE kernel interface version 7.38 graphRoot: /var/home/podman/.local/share/containers/storage graphRootAllocated: 127438663680 graphRootUsed: 5462306816 graphStatus: Backing Filesystem: xfs Native Overlay Diff: &quot;false&quot; Supports d_type: &quot;true&quot; Supports shifting: &quot;true&quot; Supports volatile: &quot;true&quot; Using metacopy: &quot;false&quot; imageCopyTmpDir: /var/tmp imageStore: number: 8 runRoot: /run/user/1001/containers transientStore: true volumePath: /var/home/podman/.local/share/containers/storage/volumes version: APIVersion: 4.7.0 Built: 1695838660 BuiltTime: Wed Sep 27 18:17:40 2023 GitCommit: &quot;&quot; GoVersion: go1.21.1 Os: linux OsArch: linux/arm64 Version: 4.7.0 ``` ### Podman in a container No ### Privileged Or Rootless Rootless ### Upstream Latest Release No ### Additional environment details Additional environment details ### Additional information Additional information like issue happens only occasionally or issue happens with a particular architecture or on a particular setting</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>5</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #20796 from containers/renovate/golang.org-x-net-0.x fix(deps): update module golang.org/x/net to v0.19.0</MESSAGE>
    <SHA>3a841ce6a9fcfe529cce15420269502f5518c732</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>docs: drop default for tmpfs-mode The default is OCI runtime specific, there is no way for Podman to know it. [CI:DOCS] Closes: https://github.com/containers/podman/issues/20754 Signed-off-by: Giuseppe Scrivano &lt;gscrivan@redhat.com&gt;</MESSAGE>
      <SHA>248cbc6f693aa385e869f7f4c99926e37b717520</SHA>
      <PATCHEDFILES>
        <FILE>docs/source/markdown/options/mount.md</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
