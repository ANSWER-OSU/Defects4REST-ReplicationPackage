<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>14057</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/14057</ISSUEURL>
  <TITLE>Flake: Deleting pod: something-cgroup-conmon: EBUSY</TITLE>
  <DESCRIPTION>Yep, jinxed myself yesterday. ``` # podman [options] play kube --replace /tmp/podman_test1113683552/kube.yaml --configmap /tmp/podman_test1113683552/foo-cm.yaml time=&quot;2022-04-28T17:02:07Z&quot; level=error msg=&quot;Deleting pod 6eeba76dfdf7c4ab35cd5e7064e286b43371aa36d8630ecdca4ef08181f6a3c6 cgroup /libpod_parent/6eeba76dfdf7c4ab35cd5e7064e286b43371aa36d8630ecdca4ef08181f6a3c6: remove /sys/fs/cgroup/libpod_parent/6eeba76dfdf7c4ab35cd5e7064e286b43371aa36d8630ecdca4ef08181f6a3c6/conmon: remove /sys/fs/cgroup/libpod_parent/6eeba76dfdf7c4ab35cd5e7064e286b43371aa36d8630ecdca4ef08181f6a3c6/conmon: device or resource busy&quot; Error: error removing pod 6eeba76dfdf7c4ab35cd5e7064e286b43371aa36d8630ecdca4ef08181f6a3c6 conmon cgroup: remove /sys/fs/cgroup/libpod_parent/6eeba76dfdf7c4ab35cd5e7064e286b43371aa36d8630ecdca4ef08181f6a3c6/conmon: remove /sys/fs/cgroup/libpod_parent/6eeba76dfdf7c4ab35cd5e7064e286b43371aa36d8630ecdca4ef08181f6a3c6/conmon: device or resource busy ``` Looks similar to #11946 but different enough to merit a new issue. Seen just now in [int f36 root](https://storage.googleapis.com/cirrus-ci-6707778565701632-fcae48/artifacts/containers/podman/4607778919546880/html/int-podman-fedora-36-root-container.log.html#t--podman-play-kube-test-env-value-from-configmap-and-replace-should-reuse-the-configmap-volume--1) on an in-flight PR; logs show it happening since April 2: ### Podman play kube [It] podman play kube test env value from configmap and --replace should reuse the configmap volume * fedora-35 : int podman fedora-35 root container * PR #14051 * [04-28 08:19](https://storage.googleapis.com/cirrus-ci-6707778565701632-fcae48/artifacts/containers/podman/4973817507348480/html/int-podman-fedora-35-root-container.log.html#t--podman-play-kube-test-env-value-from-configmap-and---replace-should-reuse-the-configmap-volume--1) * [04-28 08:19](https://storage.googleapis.com/cirrus-ci-6707778565701632-fcae48/artifacts/containers/podman/4973817507348480/html/int-podman-fedora-35-root-container.log.html#t--podman-play-kube-test-env-value-from-configmap-and---replace-should-reuse-the-configmap-volume--2) * [04-28 08:19](https://storage.googleapis.com/cirrus-ci-6707778565701632-fcae48/artifacts/containers/podman/4973817507348480/html/int-podman-fedora-35-root-container.log.html#t--podman-play-kube-test-env-value-from-configmap-and---replace-should-reuse-the-configmap-volume--3) * PR #13955 * [04-21 15:02](https://storage.googleapis.com/cirrus-ci-6707778565701632-fcae48/artifacts/containers/podman/5529787685928960/html/int-podman-fedora-35-root-container.log.html#t--podman-play-kube-test-env-value-from-configmap-and---replace-should-reuse-the-configmap-volume--1) * [04-21 15:02](https://storage.googleapis.com/cirrus-ci-6707778565701632-fcae48/artifacts/containers/podman/5529787685928960/html/int-podman-fedora-35-root-container.log.html#t--podman-play-kube-test-env-value-from-configmap-and---replace-should-reuse-the-configmap-volume--2) * [04-21 15:02](https://storage.googleapis.com/cirrus-ci-6707778565701632-fcae48/artifacts/containers/podman/5529787685928960/html/int-podman-fedora-35-root-container.log.html#t--podman-play-kube-test-env-value-from-configmap-and---replace-should-reuse-the-configmap-volume--3) * PR #13865 * [04-14 15:26](https://storage.googleapis.com/cirrus-ci-6707778565701632-fcae48/artifacts/containers/podman/5008658164613120/html/int-podman-fedora-35-root-container.log.html#t--podman-play-kube-test-env-value-from-configmap-and---replace-should-reuse-the-configmap-volume--1) * [04-14 15:26](https://storage.googleapis.com/cirrus-ci-6707778565701632-fcae48/artifacts/containers/podman/5008658164613120/html/int-podman-fedora-35-root-container.log.html#t--podman-play-kube-test-env-value-from-configmap-and---replace-should-reuse-the-configmap-volume--2) * [04-14 15:26](https://storage.googleapis.com/cirrus-ci-6707778565701632-fcae48/artifacts/containers/podman/5008658164613120/html/int-podman-fedora-35-root-container.log.html#t--podman-play-kube-test-env-value-from-configmap-and---replace-should-reuse-the-configmap-volume--3) * PR #13811 * [04-08 10:03](https://storage.googleapis.com/cirrus-ci-6707778565701632-fcae48/artifacts/containers/podman/5926478717124608/html/int-podman-fedora-35-root-container.log.html#t--podman-play-kube-test-env-value-from-configmap-and---replace-should-reuse-the-configmap-volume--1) * [04-08 10:03](https://storage.googleapis.com/cirrus-ci-6707778565701632-fcae48/artifacts/containers/podman/5926478717124608/html/int-podman-fedora-35-root-container.log.html#t--podman-play-kube-test-env-value-from-configmap-and---replace-should-reuse-the-configmap-volume--2) * [04-08 10:03](https://storage.googleapis.com/cirrus-ci-6707778565701632-fcae48/artifacts/containers/podman/5926478717124608/html/int-podman-fedora-35-root-container.log.html#t--podman-play-kube-test-env-value-from-configmap-and---replace-should-reuse-the-configmap-volume--3) * PR #13808 * [04-22 12:24](https://storage.googleapis.com/cirrus-ci-6707778565701632-fcae48/artifacts/containers/podman/5205147130265600/html/int-podman-fedora-35-root-container.log.html#t--podman-play-kube-test-env-value-from-configmap-and---replace-should-reuse-the-configmap-volume--1) * [04-22 12:24](https://storage.googleapis.com/cirrus-ci-6707778565701632-fcae48/artifacts/containers/podman/5205147130265600/html/int-podman-fedora-35-root-container.log.html#t--podman-play-kube-test-env-value-from-configmap-and---replace-should-reuse-the-configmap-volume--2) * [04-22 12:24](https://storage.googleapis.com/cirrus-ci-6707778565701632-fcae48/artifacts/containers/podman/5205147130265600/html/int-podman-fedora-35-root-container.log.html#t--podman-play-kube-test-env-value-from-configmap-and---replace-should-reuse-the-configmap-volume--3) * PR #13796 * [04-07 00:06](https://storage.googleapis.com/cirrus-ci-6707778565701632-fcae48/artifacts/containers/podman/5770276460822528/html/int-podman-fedora-35-root-container.log.html#t--podman-play-kube-test-env-value-from-configmap-and---replace-should-reuse-the-configmap-volume--1) * [04-07 00:06](https://storage.googleapis.com/cirrus-ci-6707778565701632-fcae48/artifacts/containers/podman/5770276460822528/html/int-podman-fedora-35-root-container.log.html#t--podman-play-kube-test-env-value-from-configmap-and---replace-should-reuse-the-configmap-volume--2) * [04-07 00:06](https://storage.googleapis.com/cirrus-ci-6707778565701632-fcae48/artifacts/containers/podman/5770276460822528/html/int-podman-fedora-35-root-container.log.html#t--podman-play-kube-test-env-value-from-configmap-and---replace-should-reuse-the-configmap-volume--3) * PR #13757 * [04-02 17:00](https://storage.googleapis.com/cirrus-ci-6707778565701632-fcae48/artifacts/containers/podman/6393619794886656/html/int-podman-fedora-35-root-container.log.html#t--podman-play-kube-test-env-value-from-configmap-and---replace-should-reuse-the-configmap-volume--1) * [04-02 17:00](https://storage.googleapis.com/cirrus-ci-6707778565701632-fcae48/artifacts/containers/podman/6393619794886656/html/int-podman-fedora-35-root-container.log.html#t--podman-play-kube-test-env-value-from-configmap-and---replace-should-reuse-the-configmap-volume--2) * [04-02 17:00](https://storage.googleapis.com/cirrus-ci-6707778565701632-fcae48/artifacts/containers/podman/6393619794886656/html/int-podman-fedora-35-root-container.log.html#t--podman-play-kube-test-env-value-from-configmap-and---replace-should-reuse-the-configmap-volume--3) ### Podman play kube [It] podman play kube teardown * fedora-34 : int podman fedora-34 root container * PR #13249 * [02-16 10:48](https://storage.googleapis.com/cirrus-ci-6707778565701632-fcae48/artifacts/containers/podman/5391338182017024/html/int-podman-fedora-34-root-container.log.html#t--podman-play-kube-teardown--1) * fedora-35 : int podman fedora-35 root container * PR #14051 * [04-28 08:19](https://storage.googleapis.com/cirrus-ci-6707778565701632-fcae48/artifacts/containers/podman/4973817507348480/html/int-podman-fedora-35-root-container.log.html#t--podman-play-kube-teardown--1) * PR #13955 * [04-21 15:02](https://storage.googleapis.com/cirrus-ci-6707778565701632-fcae48/artifacts/containers/podman/5529787685928960/html/int-podman-fedora-35-root-container.log.html#t--podman-play-kube-teardown--1) * PR #13808 * [04-22 12:24](https://storage.googleapis.com/cirrus-ci-6707778565701632-fcae48/artifacts/containers/podman/5205147130265600/html/int-podman-fedora-35-root-container.log.html#t--podman-play-kube-teardown--1) * PR #13255 * [02-17 13:25](https://storage.googleapis.com/cirrus-ci-6707778565701632-fcae48/artifacts/containers/podman/4536459939020800/html/int-podman-fedora-35-root-container.log.html#t--podman-play-kube-teardown--1) * [02-17 13:25](https://storage.googleapis.com/cirrus-ci-6707778565701632-fcae48/artifacts/containers/podman/4536459939020800/html/int-podman-fedora-35-root-container.log.html#t--podman-play-kube-teardown--2) * [02-17 13:25](https://storage.googleapis.com/cirrus-ci-6707778565701632-fcae48/artifacts/containers/podman/4536459939020800/html/int-podman-fedora-35-root-container.log.html#t--podman-play-kube-teardown--3)</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>19</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #14045 from cdoern/cgroupPath remove unused codepath for creating/running ctr in a pod</MESSAGE>
    <SHA>ab3e072a0c3d321fd12cbd1f6ef8e322c6d9214a</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>libpod: unlock containers when removing pod It solves a race where a container cleanup process launched because of the container process exiting normally would hang. It also solves a problem when running as rootless on cgroup v1 since it is not possible to force pids.max = 1 on conmon to limit spawning the cleanup process. Partially copied from https://github.com/containers/podman/pull/13403 Related to: https://github.com/containers/podman/issues/14057 [NO NEW TESTS NEEDED] it doesn't add any new functionality Signed-off-by: Giuseppe Scrivano &lt;gscrivan@redhat.com&gt;</MESSAGE>
      <SHA>384c2359b7adf9441e949128d58396872b30fc84</SHA>
      <PATCHEDFILES>
        <FILE>libpod/runtime_pod_linux.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>libpod: unlock containers when removing pod It solves a race where a container cleanup process launched because of the container process exiting normally would hang. It also solves a problem when running as rootless on cgroup v1 since it is not possible to force pids.max = 1 on conmon to limit spawning the cleanup process. Partially copied from https://github.com/containers/podman/pull/13403 Related to: https://github.com/containers/podman/issues/14057 [NO NEW TESTS NEEDED] it doesn't add any new functionality Signed-off-by: Giuseppe Scrivano &lt;gscrivan@redhat.com&gt;</MESSAGE>
      <SHA>7249651329c380f21a9e5f7bef870950b6086eab</SHA>
      <PATCHEDFILES>
        <FILE>libpod/runtime_pod_linux.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
