<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>20821</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/20821</ISSUEURL>
  <TITLE>Unmarshalling error when using `podman exec`</TITLE>
  <DESCRIPTION>### Issue Description When I use `podman exec ...` for any container, I get the following error: ``` Error: unmarshalling error into &amp;errorhandling.ErrorModel{Because:&quot;&quot;, Message:&quot;&quot;, ResponseCode:0}, data &quot;Not Found\n&quot;: invalid character 'N' looking for beginning of value ``` ### Steps to reproduce the issue Steps to reproduce the issue 1. Run a detached container: `podman run --name httpd -p 8080:80 -d -i -t docker.io/library/httpd` 2. Try to run podman exec: `podman exec httpd pwd` 3. Error message shows up ### Describe the results you received An unexpected error message. ### Describe the results you expected No error message, if the command is run correctly. ### podman info output ```yaml host: arch: arm64 buildahVersion: 1.32.0 cgroupControllers: - cpu - io - memory - pids cgroupManager: systemd cgroupVersion: v2 conmon: package: conmon-2.1.8-2.fc39.aarch64 path: /usr/bin/conmon version: 'conmon version 2.1.8, commit: ' cpuUtilization: idlePercent: 99.33 systemPercent: 0.34 userPercent: 0.33 cpus: 4 databaseBackend: boltdb distribution: distribution: fedora variant: coreos version: &quot;39&quot; eventLogger: journald freeLocks: 2039 hostname: localhost.localdomain idMappings: gidmap: - container_id: 0 host_id: 1000 size: 1 - container_id: 1 host_id: 100000 size: 1000000 uidmap: - container_id: 0 host_id: 501 size: 1 - container_id: 1 host_id: 100000 size: 1000000 kernel: 6.5.11-300.fc39.aarch64 linkmode: dynamic logDriver: journald memFree: 3151986688 memTotal: 6189867008 networkBackend: netavark networkBackendInfo: backend: netavark dns: package: aardvark-dns-1.8.0-1.fc39.aarch64 path: /usr/libexec/podman/aardvark-dns version: aardvark-dns 1.8.0 package: netavark-1.8.0-2.fc39.aarch64 path: /usr/libexec/podman/netavark version: netavark 1.8.0 ociRuntime: name: crun package: crun-1.11.1-1.fc39.aarch64 path: /usr/bin/crun version: |- crun version 1.11.1 commit: 1084f9527c143699b593b44c23555fb3cc4ff2f3 rundir: /run/user/501/crun spec: 1.0.0 +SYSTEMD +SELINUX +APPARMOR +CAP +SECCOMP +EBPF +CRIU +LIBKRUN +WASM:wasmedge +YAJL os: linux pasta: executable: /usr/bin/pasta package: passt-0^20231004.gf851084-1.fc39.aarch64 version: | pasta 0^20231004.gf851084-1.fc39.aarch64-pasta Copyright Red Hat GNU General Public License, version 2 or later &lt;https://www.gnu.org/licenses/old-licenses/gpl-2.0.html&gt; This is free software: you are free to change and redistribute it. There is NO WARRANTY, to the extent permitted by law. remoteSocket: exists: true path: /run/user/501/podman/podman.sock security: apparmorEnabled: false capabilities: CAP_CHOWN,CAP_DAC_OVERRIDE,CAP_FOWNER,CAP_FSETID,CAP_KILL,CAP_NET_BIND_SERVICE,CAP_SETFCAP,CAP_SETGID,CAP_SETPCAP,CAP_SETUID,CAP_SYS_CHROOT rootless: true seccompEnabled: true seccompProfilePath: /usr/share/containers/seccomp.json selinuxEnabled: true serviceIsRemote: true slirp4netns: executable: /usr/bin/slirp4netns package: slirp4netns-1.2.2-1.fc39.aarch64 version: |- slirp4netns version 1.2.2 commit: 0ee2d87523e906518d34a6b423271e4826f71faf libslirp: 4.7.0 SLIRP_CONFIG_VERSION_MAX: 4 libseccomp: 2.5.3 swapFree: 0 swapTotal: 0 uptime: 12h 26m 50.00s (Approximately 0.50 days) variant: &quot;&quot; plugins: authorization: null log: - k8s-file - none - passthrough - journald network: - bridge - macvlan - ipvlan volume: - local registries: search: - docker.io store: configFile: /var/home/core/.config/containers/storage.conf containerStore: number: 3 paused: 0 running: 3 stopped: 0 graphDriverName: overlay graphOptions: {} graphRoot: /var/home/core/.local/share/containers/storage graphRootAllocated: 106769133568 graphRootUsed: 6775140352 graphStatus: Backing Filesystem: xfs Native Overlay Diff: &quot;true&quot; Supports d_type: &quot;true&quot; Supports shifting: &quot;false&quot; Supports volatile: &quot;true&quot; Using metacopy: &quot;false&quot; imageCopyTmpDir: /var/tmp imageStore: number: 33 runRoot: /run/user/501/containers transientStore: false volumePath: /var/home/core/.local/share/containers/storage/volumes version: APIVersion: 4.7.2 Built: 1698762633 BuiltTime: Tue Oct 31 15:30:33 2023 GitCommit: &quot;&quot; GoVersion: go1.21.1 Os: linux OsArch: linux/arm64 Version: 4.7.2 ``` ### Podman in a container No ### Privileged Or Rootless None ### Upstream Latest Release Yes ### Additional environment details ZSH on MacOS ### Additional information When downgrading to v4.7.2 the issue disappeared.</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>2</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #20823 from nalind/close-that-readcloser utils: close a couple of ReadClosers</MESSAGE>
    <SHA>e0a524f63035cb9f2de1e63b9a2f6daec16a14af</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>fix podman-remote exec regression with v4.8 Commit f48a706abc added a new API endpoint to remove exec session correctly. And the bindings try to call that endpoint for exec every time. Now since client and server must not be the same version this causes a problem if a new 4.8 client calls an older 4.7 server as it has no idea about such endpoint and throws an ugly error. This is a common scenario for podman machine setups. The client does know the server version so it should make sure to not call such endpoint if the server is older than 4.8. I added a exec test to the machine tests as this can be reproduced with podman machine as at the moment at least the VM image does not contain podman 4.8. And it should at least make sure podman exec keeps working for podman machine without regressions. Fixes #20821 Signed-off-by: Paul Holzinger &lt;pholzing@redhat.com&gt;</MESSAGE>
      <SHA>93bcd2a25d84cb8430e2c30cf378f77e039400e7</SHA>
      <PATCHEDFILES>
        <FILE>pkg/bindings/containers/exec.go</FILE>
        <FILE>pkg/machine/e2e/basic_test.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>fix podman-remote exec regression with v4.8 Commit f48a706abc added a new API endpoint to remove exec session correctly. And the bindings try to call that endpoint for exec every time. Now since client and server must not be the same version this causes a problem if a new 4.8 client calls an older 4.7 server as it has no idea about such endpoint and throws an ugly error. This is a common scenario for podman machine setups. The client does know the server version so it should make sure to not call such endpoint if the server is older than 4.8. I added a exec test to the machine tests as this can be reproduced with podman machine as at the moment at least the VM image does not contain podman 4.8. And it should at least make sure podman exec keeps working for podman machine without regressions. Fixes #20821 Signed-off-by: Paul Holzinger &lt;pholzing@redhat.com&gt;</MESSAGE>
      <SHA>86bb91001a0540d58281d16ee2111c679a260506</SHA>
      <PATCHEDFILES>
        <FILE>pkg/bindings/containers/exec.go</FILE>
        <FILE>pkg/machine/e2e/basic_test.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
