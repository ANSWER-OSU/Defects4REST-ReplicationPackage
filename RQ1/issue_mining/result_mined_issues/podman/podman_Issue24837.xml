<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>24837</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/24837</ISSUEURL>
  <TITLE>Allow mixing userns=auto and userns=keep-id</TITLE>
  <DESCRIPTION>### Feature request description Currently you have to pick between using userns=auto for every container you have or being able to keep-id which is useful for development containers. I'm hitting this issue with distrobox for example. Using the following flag gets a working result: ``` --userns=auto:gidmapping=1000:0:1,uidmapping=1000:0:1,size=65536 ``` ### Suggest potential solution podman never promises the UID range in nomap or keep-id. Maybe these could use auto by default, or by a configuration flag? ### Have you considered any alternatives? The application using podman could instead be changed to use =auto. In my case I modified distrobox. However there's no way for distrobox to know whether to use =auto or =keep-id, especially since using the wrong one may affect other containers running on the machine. ### Additional context Using =auto has a significant security boost, it would be nice to have this as a rootless user.</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>26</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>specgen: fix comment Signed-off-by: Giuseppe Scrivano &lt;gscrivan@redhat.com&gt;</MESSAGE>
    <SHA>b87ad660186558b43022dddc644a7a91a135d098</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>namespaces: allow configuring keep-id userns size Introduce a new option &quot;size&quot; to configure the maximum size of the user namespace configured by keep-id. Closes: https://github.com/containers/podman/issues/24837 Signed-off-by: Giuseppe Scrivano &lt;gscrivan@redhat.com&gt;</MESSAGE>
      <SHA>5290a37a4146683bd3903ac7e427241ab2b9c59e</SHA>
      <PATCHEDFILES>
        <FILE>docs/source/markdown/options/userns.container.md</FILE>
        <FILE>pkg/namespaces/namespaces.go</FILE>
        <FILE>pkg/util/utils.go</FILE>
        <FILE>pkg/util/utils_test.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>namespaces: allow configuring keep-id userns size Introduce a new option &quot;size&quot; to configure the maximum size of the user namespace configured by keep-id. Closes: https://github.com/containers/podman/issues/24837 Signed-off-by: Giuseppe Scrivano &lt;gscrivan@redhat.com&gt;</MESSAGE>
      <SHA>8f3662a57699006bdc8b5fe9adea3542176814cb</SHA>
      <PATCHEDFILES>
        <FILE>docs/source/markdown/options/userns.container.md</FILE>
        <FILE>pkg/namespaces/namespaces.go</FILE>
        <FILE>pkg/util/utils.go</FILE>
        <FILE>pkg/util/utils_test.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>namespaces: allow configuring keep-id userns size Introduce a new option &quot;size&quot; to configure the maximum size of the user namespace configured by keep-id. Closes: https://github.com/containers/podman/issues/24837 Signed-off-by: Giuseppe Scrivano &lt;gscrivan@redhat.com&gt;</MESSAGE>
      <SHA>67318cff9c42021b28e393e4fa130ab288cea3bc</SHA>
      <PATCHEDFILES>
        <FILE>docs/source/markdown/options/userns.container.md</FILE>
        <FILE>pkg/namespaces/namespaces.go</FILE>
        <FILE>pkg/util/utils.go</FILE>
        <FILE>pkg/util/utils_test.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>namespaces: allow configuring keep-id userns size Introduce a new option &quot;size&quot; to configure the maximum size of the user namespace configured by keep-id. Closes: https://github.com/containers/podman/issues/24837 Signed-off-by: Giuseppe Scrivano &lt;gscrivan@redhat.com&gt;</MESSAGE>
      <SHA>5f2b57bc1ea9b0a9862e98460645a038a0756d65</SHA>
      <PATCHEDFILES>
        <FILE>docs/source/markdown/options/userns.container.md</FILE>
        <FILE>pkg/namespaces/namespaces.go</FILE>
        <FILE>pkg/util/utils.go</FILE>
        <FILE>pkg/util/utils_test.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>namespaces: allow configuring keep-id userns size Introduce a new option &quot;size&quot; to configure the maximum size of the user namespace configured by keep-id. Closes: https://github.com/containers/podman/issues/24837 Signed-off-by: Giuseppe Scrivano &lt;gscrivan@redhat.com&gt;</MESSAGE>
      <SHA>d5911d2a5ef6d694855e8ceb9ad75a4d0205fbb1</SHA>
      <PATCHEDFILES>
        <FILE>docs/source/markdown/options/userns.container.md</FILE>
        <FILE>pkg/namespaces/namespaces.go</FILE>
        <FILE>pkg/specgen/namespaces.go</FILE>
        <FILE>pkg/util/utils.go</FILE>
        <FILE>pkg/util/utils_test.go</FILE>
        <FILE>test/e2e/run_userns_test.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>namespaces: allow configuring keep-id userns size Introduce a new option &quot;size&quot; to configure the maximum size of the user namespace configured by keep-id. Closes: https://github.com/containers/podman/issues/24837 Signed-off-by: Giuseppe Scrivano &lt;gscrivan@redhat.com&gt;</MESSAGE>
      <SHA>b0b1d1972351054a09a044088f8ed942422ef8da</SHA>
      <PATCHEDFILES>
        <FILE>docs/source/markdown/options/userns.container.md</FILE>
        <FILE>pkg/namespaces/namespaces.go</FILE>
        <FILE>pkg/specgen/namespaces.go</FILE>
        <FILE>pkg/util/utils.go</FILE>
        <FILE>pkg/util/utils_test.go</FILE>
        <FILE>test/e2e/run_userns_test.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>namespaces: allow configuring keep-id userns size Introduce a new option &quot;size&quot; to configure the maximum size of the user namespace configured by keep-id. Closes: https://github.com/containers/podman/issues/24837 Signed-off-by: Giuseppe Scrivano &lt;gscrivan@redhat.com&gt;</MESSAGE>
      <SHA>11592b2d9c9f489b54d6e6548e787470b48fc134</SHA>
      <PATCHEDFILES>
        <FILE>docs/source/markdown/options/userns.container.md</FILE>
        <FILE>pkg/namespaces/namespaces.go</FILE>
        <FILE>pkg/specgen/namespaces.go</FILE>
        <FILE>pkg/util/utils.go</FILE>
        <FILE>pkg/util/utils_test.go</FILE>
        <FILE>test/e2e/run_userns_test.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>namespaces: allow configuring keep-id userns size Introduce a new option &quot;size&quot; to configure the maximum size of the user namespace configured by keep-id. Closes: https://github.com/containers/podman/issues/24837 Signed-off-by: Giuseppe Scrivano &lt;gscrivan@redhat.com&gt;</MESSAGE>
      <SHA>806ad94d473c9116609ababb4bf37bd9721102d1</SHA>
      <PATCHEDFILES>
        <FILE>docs/source/markdown/options/userns.container.md</FILE>
        <FILE>pkg/namespaces/namespaces.go</FILE>
        <FILE>pkg/specgen/namespaces.go</FILE>
        <FILE>pkg/util/utils.go</FILE>
        <FILE>pkg/util/utils_test.go</FILE>
        <FILE>test/e2e/run_userns_test.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
