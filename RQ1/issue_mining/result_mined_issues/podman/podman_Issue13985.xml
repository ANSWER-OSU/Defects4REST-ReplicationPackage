<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>13985</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/13985</ISSUEURL>
  <TITLE>podman generate kube creates a pod with non-compliant name</TITLE>
  <DESCRIPTION>&lt;!-- --------------------------------------------------- BUG REPORT INFORMATION --------------------------------------------------- Use the commands below to provide key information from your environment: You do NOT have to include this information if this is a FEATURE REQUEST **NOTE** A large number of issues reported against Podman are often found to already be fixed in more current versions of the project. Before reporting an issue, please verify the version you are running with `podman version` and compare it to the latest release documented on the top of Podman's [README.md](../README.md). If they differ, please update your version of Podman to the latest possible and retry your command before creating an issue. Also, there is a running list of known issues in the [Podman Troubleshooting Guide](https://github.com/containers/podman/blob/main/troubleshooting.md), please reference that page before opening a new issue. If you are filing a bug against `podman build`, please instead file a bug against Buildah (https://github.com/containers/buildah/issues). Podman build executes Buildah to perform container builds, and as such the Buildah maintainers are best equipped to handle these bugs. --&gt; **Is this a BUG REPORT or FEATURE REQUEST? (leave only one on its own line)** /kind bug **Description** &lt;!-- Briefly describe the problem you are having in a few paragraphs. --&gt; **Steps to reproduce the issue:** 1. `$ podman create -p 8080:80 --name nginx docker.io/nginx` 2. `$ podman generate kube nginx&gt; nginx.yaml` 3. `$ kubectl create -f nginx.yaml` **Describe the results you received:** ``` The Pod &quot;nginx_pod&quot; is invalid: metadata.name: Invalid value: &quot;nginx_pod&quot;: a lowercase RFC 1123 subdomain must consist of lower case alphanumeric characters, '-' or '.', and must start and end with an alphanumeric character (e.g. 'example.com', regex used for validation is '[a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*') ``` **Describe the results you expected:** Kubernetes pod should be created. **Additional information you deem important (e.g. issue happens only occasionally):** **Output of `podman version`:** ``` Client: Podman Engine Version: 4.0.3 API Version: 4.0.3 Go Version: go1.16.15 Git Commit: 62534053086fdeba7b93117e7c4dc6e797835a3e Built: Mon Apr 4 19:34:42 2022 OS/Arch: windows/amd64 Server: Podman Engine Version: 4.0.3 API Version: 4.0.3 Go Version: go1.16.15 Built: Fri Apr 1 20:21:14 2022 OS/Arch: linux/amd64 ``` **Output of `podman info --debug`:** ``` host: arch: amd64 buildahVersion: 1.24.3 cgroupControllers: [] cgroupManager: cgroupfs cgroupVersion: v1 conmon: package: conmon-2.1.0-2.fc35.x86_64 path: /usr/bin/conmon version: 'conmon version 2.1.0, commit: ' cpus: 4 distribution: distribution: fedora variant: container version: &quot;35&quot; eventLogger: file hostname: GAMING-DESKTOP idMappings: gidmap: - container_id: 0 host_id: 1000 size: 1 - container_id: 1 host_id: 100000 size: 65536 uidmap: - container_id: 0 host_id: 1000 size: 1 - container_id: 1 host_id: 100000 size: 65536 kernel: 5.10.102.1-microsoft-standard-WSL2 linkmode: dynamic logDriver: journald memFree: 2726428672 memTotal: 8336093184 networkBackend: netavark ociRuntime: name: crun package: crun-1.4.4-1.fc35.x86_64 path: /usr/bin/crun version: |- crun version 1.4.4 commit: 6521fcc5806f20f6187eb933f9f45130c86da230 spec: 1.0.0 +SYSTEMD +SELINUX +APPARMOR +CAP +SECCOMP +EBPF +CRIU +YAJL os: linux remoteSocket: exists: true path: /run/user/1000/podman/podman.sock security: apparmorEnabled: false capabilities: CAP_CHOWN,CAP_DAC_OVERRIDE,CAP_FOWNER,CAP_FSETID,CAP_KILL,CAP_NET_BIND_SERVICE,CAP_SETFCAP,CAP_SETGID,CAP_SETPCAP,CAP_SETUID,CAP_SYS_CHROOT rootless: true seccompEnabled: true seccompProfilePath: /usr/share/containers/seccomp.json selinuxEnabled: false serviceIsRemote: true slirp4netns: executable: /usr/bin/slirp4netns package: slirp4netns-1.1.12-2.fc35.x86_64 version: |- slirp4netns version 1.1.12 commit: 7a104a101aa3278a2152351a082a6df71f57c9a3 libslirp: 4.6.1 SLIRP_CONFIG_VERSION_MAX: 3 libseccomp: 2.5.3 swapFree: 2145898496 swapTotal: 2147483648 uptime: 1h 8m 12.25s (Approximately 0.04 days) plugins: log: - k8s-file - none - passthrough - journald network: - bridge - macvlan volume: - local registries: search: - registry.fedoraproject.org - registry.access.redhat.com - docker.io - quay.io store: configFile: /home/user/.config/containers/storage.conf containerStore: number: 2 paused: 0 running: 0 stopped: 2 graphDriverName: overlay graphOptions: overlay.mount_program: Executable: /usr/bin/fuse-overlayfs Package: fuse-overlayfs-1.7.1-2.fc35.x86_64 Version: |- fusermount3 version: 3.10.5 fuse-overlayfs: version 1.7.1 FUSE library version 3.10.5 using FUSE kernel interface version 7.31 graphRoot: /home/user/.local/share/containers/storage graphStatus: Backing Filesystem: extfs Native Overlay Diff: &quot;false&quot; Supports d_type: &quot;true&quot; Using metacopy: &quot;false&quot; imageCopyTmpDir: /var/tmp imageStore: number: 6 runRoot: /run/user/1000/containers volumePath: /home/user/.local/share/containers/storage/volumes version: APIVersion: 4.0.3 Built: 1648837274 BuiltTime: Fri Apr 1 20:21:14 2022 GitCommit: &quot;&quot; GoVersion: go1.16.15 OsArch: linux/amd64 Version: 4.0.3 ``` **Package info (e.g. output of `rpm -q podman` or `apt list podman`):** ``` $ scoop info podman Name : podman Description : A tool for managing OCI containers and pods. Version : 4.0.3 Bucket : main Website : https://podman.io License : Apache-2.0 Updated at : 04-Apr-22 22:27:06 Updated by : github-actions[bot] Installed : 4.0.3 Binaries : usr\bin\podman.exe ``` **Have you tested with the latest version of Podman and have you checked the Podman Troubleshooting Guide? (https://github.com/containers/podman/blob/main/troubleshooting.md)** Yes **Additional environment details (AWS, VirtualBox, physical, etc.):**</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>1</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #13988 from rhatdan/apiv2 Allow filtering of &quot;removing&quot;, it is a valid status</MESSAGE>
    <SHA>ba6356280a86531d3cda7016859aef98bb3d8272</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>kube: pod name should not contain _, honor RFC 1123 for DNS label Pod name should contain underscore and honor kubernetes DNS label scheme while `generate kube` See: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#dns-label-names See: https://www.rfc-editor.org/rfc/rfc1123#section-2 See: https://stackoverflow.com/questions/27791913/what-characters-are-allowed-in-kubernetes-port-and-container-names Closes: https://github.com/containers/podman/issues/13985 Signed-off-by: Aditya R &lt;arajan@redhat.com&gt;</MESSAGE>
      <SHA>03eb2d8ffca0e674a795764d9e844f6b1ec360a7</SHA>
      <PATCHEDFILES>
        <FILE>libpod/kube.go</FILE>
        <FILE>test/e2e/generate_kube_test.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
