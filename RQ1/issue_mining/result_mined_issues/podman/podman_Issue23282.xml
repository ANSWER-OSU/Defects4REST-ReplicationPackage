<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>23282</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/23282</ISSUEURL>
  <TITLE>completion: container diff: no such pod</TITLE>
  <DESCRIPTION>Seen when running system tests in parallel: ``` # [12:02:39.744447467] $ bin/podman __completeNoDesc container diff # [12:02:40.521000319] [Debug] [Error] no such pod # :4 # Completion ended with directive: ShellCompDirectiveNoFileComp # #/vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv # #| FAIL: container diff: actual container listed in suggestions # #| expected: '.*-ctrt111_bcqa22xf # ' (using expr) # #| actual: '[Debug] [Error] no such pod' # #| &gt; ':4' # #| &gt; 'Completion ended with directive: ShellCompDirectiveNoFileComp' # #\^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ ``` I've been unable to reproduce</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>2</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #23305 from Luap99/auto-update-race podman auto-update/system df: fix ErrNoSuchCtr/Volume race</MESSAGE>
    <SHA>22cf2b42d4f791eec34e91ecffc159859ed06776</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>podman ps: fix racy pod name query The pod name was queried without holding the container lock, thus it was possible that the pod was deleted in the meantime and podman just failed with &quot;no such pod&quot; as the errors.Is() check matched the wrong error. Move it into the locked code this should prevent anyone from removing the pod while the container is part of it. Also fix the returned error, there is no reason to special case one specific error just wrap any error here so callers at least know where it happened. However this is not good enough because the batch doesn't update the state which means it see everything before the container was locked. In this case it might be possible the ctr and pod was already removed so let the caller skip both ctr and pod removed errors. Fixes #23282 Signed-off-by: Paul Holzinger &lt;pholzing@redhat.com&gt;</MESSAGE>
      <SHA>e1caf80e814a2e0ed026706f0a16371ca40dbc26</SHA>
      <PATCHEDFILES>
        <FILE>pkg/ps/ps.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
