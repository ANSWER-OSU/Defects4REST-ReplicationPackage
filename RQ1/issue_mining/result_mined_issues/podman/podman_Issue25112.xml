<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>25112</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/25112</ISSUEURL>
  <TITLE>Two podman machines can be run at the same time on macos</TITLE>
  <DESCRIPTION>### Issue Description It seems that currently it's possible to two two podman machines running at the same time on macos if the machines are of different types (e.g. one applehv and one libkrun), normally podman does not support running multiple podman machines simultaneously on macos. &lt;img width=&quot;781&quot; alt=&quot;Image&quot; src=&quot;https://github.com/user-attachments/assets/f71d26c7-8d36-4fcf-b229-2bcfba2b36f9&quot; /&gt; podman version Client: Podman Engine Version: 5.3.2 API Version: 5.3.2 Go Version: go1.23.5 Git Commit: 85043bb1a3818102194afa82845cb63841067c9c Built: Wed Jan 22 14:42:02 2025 OS/Arch: darwin/arm64 Server: Podman Engine Version: 5.3.2 API Version: 5.3.2 Go Version: go1.23.4 Built: Wed Jan 22 01:00:00 2025 OS/Arch: linux/arm64 ### Steps to reproduce the issue 1. Install podman 5.3.2 version on macos. 2. Create a podman machine of type applehv and start it. 3. Reconfigure podman to create libkrun podman machine. 4. Create a second podman machine of type libkrun with a different name from machine from step 2 and start it also. 5. Notice that no error is thrown and both machines are operational at the same time. ### Describe the results you received Both podman machines are operations and in running state. ### Describe the results you expected Only one podman machine should be in running state at any one moment. ### podman info output ```yaml podman info host: arch: arm64 buildahVersion: 1.38.1 cgroupControllers: - cpuset - cpu - io - memory - pids - rdma - misc cgroupManager: systemd cgroupVersion: v2 conmon: package: conmon-2.1.12-3.fc41.aarch64 path: /usr/bin/conmon version: 'conmon version 2.1.12, commit: ' cpuUtilization: idlePercent: 99.81 systemPercent: 0.1 userPercent: 0.09 cpus: 6 databaseBackend: sqlite distribution: distribution: fedora variant: coreos version: &quot;41&quot; eventLogger: journald freeLocks: 2048 hostname: localhost.localdomain idMappings: gidmap: null uidmap: null kernel: 6.12.7-200.fc41.aarch64 linkmode: dynamic logDriver: journald memFree: 3290648576 memTotal: 3791691776 networkBackend: netavark networkBackendInfo: backend: netavark dns: package: aardvark-dns-1.13.1-1.fc41.aarch64 path: /usr/libexec/podman/aardvark-dns version: aardvark-dns 1.13.1 package: netavark-1.13.1-1.fc41.aarch64 path: /usr/libexec/podman/netavark version: netavark 1.13.1 ociRuntime: name: crun package: crun-1.19.1-1.fc41.aarch64 path: /usr/bin/crun version: |- crun version 1.19.1 commit: 3e32a70c93f5aa5fea69b50256cca7fd4aa23c80 rundir: /run/crun spec: 1.0.0 +SYSTEMD +SELINUX +APPARMOR +CAP +SECCOMP +EBPF +CRIU +LIBKRUN +WASM:wasmedge +YAJL os: linux pasta: executable: /usr/bin/pasta package: passt-0^20241211.g09478d5-1.fc41.aarch64 version: | pasta 0^20241211.g09478d5-1.fc41.aarch64-pasta Copyright Red Hat GNU General Public License, version 2 or later &lt;https://www.gnu.org/licenses/old-licenses/gpl-2.0.html&gt; This is free software: you are free to change and redistribute it. There is NO WARRANTY, to the extent permitted by law. remoteSocket: exists: true path: unix:///run/podman/podman.sock rootlessNetworkCmd: pasta security: apparmorEnabled: false capabilities: CAP_CHOWN,CAP_DAC_OVERRIDE,CAP_FOWNER,CAP_FSETID,CAP_KILL,CAP_NET_BIND_SERVICE,CAP_SETFCAP,CAP_SETGID,CAP_SETPCAP,CAP_SETUID,CAP_SYS_CHROOT rootless: false seccompEnabled: true seccompProfilePath: /usr/share/containers/seccomp.json selinuxEnabled: true serviceIsRemote: true slirp4netns: executable: /usr/bin/slirp4netns package: slirp4netns-1.3.1-1.fc41.aarch64 version: |- slirp4netns version 1.3.1 commit: e5e368c4f5db6ae75c2fce786e31eef9da6bf236 libslirp: 4.8.0 SLIRP_CONFIG_VERSION_MAX: 5 libseccomp: 2.5.5 swapFree: 0 swapTotal: 0 uptime: 0h 28m 10.00s variant: v8 plugins: authorization: null log: - k8s-file - none - passthrough - journald network: - bridge - macvlan - ipvlan volume: - local registries: search: - docker.io store: configFile: /usr/share/containers/storage.conf containerStore: number: 0 paused: 0 running: 0 stopped: 0 graphDriverName: overlay graphOptions: overlay.imagestore: /usr/lib/containers/storage overlay.mountopt: nodev,metacopy=on graphRoot: /var/lib/containers/storage graphRootAllocated: 98899800064 graphRootUsed: 4063305728 graphStatus: Backing Filesystem: xfs Native Overlay Diff: &quot;false&quot; Supports d_type: &quot;true&quot; Supports shifting: &quot;true&quot; Supports volatile: &quot;true&quot; Using metacopy: &quot;true&quot; imageCopyTmpDir: /var/tmp imageStore: number: 0 runRoot: /run/containers/storage transientStore: false volumePath: /var/lib/containers/storage/volumes version: APIVersion: 5.3.2 Built: 1737504000 BuiltTime: Wed Jan 22 01:00:00 2025 GitCommit: &quot;&quot; GoVersion: go1.23.4 Os: linux OsArch: linux/arm64 Version: 5.3.2 ``` ### Podman in a container No ### Privileged Or Rootless Privileged ### Upstream Latest Release Yes ### Additional environment details Additional environment details ### Additional information Additional information like issue happens only occasionally or issue happens with a particular architecture or on a particular setting</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>6</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Remove unnecessary error handling A function in the reset code does not return an error. Simply removing the error variable and check for the condition (which was always false or nil) Signed-off-by: Brent Baude &lt;bbaude@redhat.com&gt;</MESSAGE>
    <SHA>89814fb19aaea384a9fc3ceafacf63ffda6cd5d2</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Prevent two podman machines running on darwin As issue #25112 points out, it was possible to start a machine on one of the darwin providers and then switch providers and start another one with a different name. This PR firstly prevents that use which is a forbidden use case. Secondarily, performed some minor cleanup on the error messages being used so that the error would be specific to this condition. This bug fix is for darwin only. In the case of Windows, we probably need to answer the question I raised in #24067 first, which is whether we want to stop allowing WSL to run multiple machines. Fixes #25112 Signed-off-by: Brent Baude &lt;bbaude@redhat.com&gt;</MESSAGE>
      <SHA>e4bb0026bb1e265c7984978110fec5b96089d4b5</SHA>
      <PATCHEDFILES>
        <FILE>pkg/machine/define/errors.go</FILE>
        <FILE>pkg/machine/shim/host.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Prevent two podman machines running on darwin As issue #25112 points out, it was possible to start a machine on one of the darwin providers and then switch providers and start another one with a different name. This PR firstly prevents that use which is a forbidden use case. Secondarily, performed some minor cleanup on the error messages being used so that the error would be specific to this condition. This bug fix is for darwin only. In the case of Windows, we probably need to answer the question I raised in #24067 first, which is whether we want to stop allowing WSL to run multiple machines. Fixes #25112 Signed-off-by: Brent Baude &lt;bbaude@redhat.com&gt;</MESSAGE>
      <SHA>385f0a1d9e9043357867f988be62a7d5ef52ffd0</SHA>
      <PATCHEDFILES>
        <FILE>pkg/machine/define/errors.go</FILE>
        <FILE>pkg/machine/e2e/start_test.go</FILE>
        <FILE>pkg/machine/shim/host.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Prevent two podman machines running on darwin As issue #25112 points out, it was possible to start a machine on one of the darwin providers and then switch providers and start another one with a different name. This PR firstly prevents that use which is a forbidden use case. Secondarily, performed some minor cleanup on the error messages being used so that the error would be specific to this condition. This bug fix is for darwin only. In the case of Windows, we probably need to answer the question I raised in #24067 first, which is whether we want to stop allowing WSL to run multiple machines. Fixes #25112 Signed-off-by: Brent Baude &lt;bbaude@redhat.com&gt;</MESSAGE>
      <SHA>627ded18e63949d1a84ce113d6c455fb969034a8</SHA>
      <PATCHEDFILES>
        <FILE>pkg/machine/define/errors.go</FILE>
        <FILE>pkg/machine/e2e/start_test.go</FILE>
        <FILE>pkg/machine/shim/host.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Prevent two podman machines running on darwin As issue #25112 points out, it was possible to start a machine on one of the darwin providers and then switch providers and start another one with a different name. This PR firstly prevents that use which is a forbidden use case. Secondarily, performed some minor cleanup on the error messages being used so that the error would be specific to this condition. This bug fix is for darwin only. In the case of Windows, we probably need to answer the question I raised in #24067 first, which is whether we want to stop allowing WSL to run multiple machines. Fixes #25112 Signed-off-by: Brent Baude &lt;bbaude@redhat.com&gt;</MESSAGE>
      <SHA>d81ba9fca3ca30abaa1539652f4047e70a6fbf66</SHA>
      <PATCHEDFILES>
        <FILE>pkg/machine/define/errors.go</FILE>
        <FILE>pkg/machine/e2e/start_test.go</FILE>
        <FILE>pkg/machine/shim/host.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Prevent two podman machines running on darwin As issue #25112 points out, it was possible to start a machine on one of the darwin providers and then switch providers and start another one with a different name. This PR firstly prevents that use which is a forbidden use case. Secondarily, performed some minor cleanup on the error messages being used so that the error would be specific to this condition. This bug fix is for darwin only. In the case of Windows, we probably need to answer the question I raised in #24067 first, which is whether we want to stop allowing WSL to run multiple machines. Fixes #25112 Signed-off-by: Brent Baude &lt;bbaude@redhat.com&gt;</MESSAGE>
      <SHA>db5ce7b5fdf421672d10c83ae6671c546b0d58e2</SHA>
      <PATCHEDFILES>
        <FILE>pkg/machine/define/errors.go</FILE>
        <FILE>pkg/machine/e2e/start_test.go</FILE>
        <FILE>pkg/machine/shim/host.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Prevent two podman machines running on darwin As issue #25112 points out, it was possible to start a machine on one of the darwin providers and then switch providers and start another one with a different name. This PR firstly prevents that use which is a forbidden use case. Secondarily, performed some minor cleanup on the error messages being used so that the error would be specific to this condition. This bug fix is for darwin only. In the case of Windows, we probably need to answer the question I raised in #24067 first, which is whether we want to stop allowing WSL to run multiple machines. Fixes #25112 Signed-off-by: Brent Baude &lt;bbaude@redhat.com&gt;</MESSAGE>
      <SHA>5f21353d45ea101b63b468c03eed122bab3012cb</SHA>
      <PATCHEDFILES>
        <FILE>pkg/machine/define/errors.go</FILE>
        <FILE>pkg/machine/e2e/start_test.go</FILE>
        <FILE>pkg/machine/shim/host.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Prevent two podman machines running on darwin As issue #25112 points out, it was possible to start a machine on one of the darwin providers and then switch providers and start another one with a different name. This PR firstly prevents that use which is a forbidden use case. Secondarily, performed some minor cleanup on the error messages being used so that the error would be specific to this condition. This bug fix is for darwin only. In the case of Windows, we probably need to answer the question I raised in #24067 first, which is whether we want to stop allowing WSL to run multiple machines. Fixes #25112 Signed-off-by: Brent Baude &lt;bbaude@redhat.com&gt;</MESSAGE>
      <SHA>7095a1537bc659a1bb8f2f309e014e2fdfc4f4ef</SHA>
      <PATCHEDFILES>
        <FILE>pkg/machine/define/errors.go</FILE>
        <FILE>pkg/machine/e2e/start_test.go</FILE>
        <FILE>pkg/machine/shim/host.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Prevent two podman machines running on darwin As issue #25112 points out, it was possible to start a machine on one of the darwin providers and then switch providers and start another one with a different name. This PR firstly prevents that use which is a forbidden use case. Secondarily, performed some minor cleanup on the error messages being used so that the error would be specific to this condition. This bug fix is for darwin only. In the case of Windows, we probably need to answer the question I raised in #24067 first, which is whether we want to stop allowing WSL to run multiple machines. Fixes #25112 Signed-off-by: Brent Baude &lt;bbaude@redhat.com&gt;</MESSAGE>
      <SHA>837dab00d5a7f1b5fe9fc94213f6fb769442226a</SHA>
      <PATCHEDFILES>
        <FILE>pkg/machine/define/errors.go</FILE>
        <FILE>pkg/machine/e2e/start_test.go</FILE>
        <FILE>pkg/machine/shim/host.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Prevent two podman machines running on darwin As issue #25112 points out, it was possible to start a machine on one of the darwin providers and then switch providers and start another one with a different name. This PR firstly prevents that use which is a forbidden use case. Secondarily, performed some minor cleanup on the error messages being used so that the error would be specific to this condition. This bug fix is for darwin only. In the case of Windows, we probably need to answer the question I raised in #24067 first, which is whether we want to stop allowing WSL to run multiple machines. Fixes #25112 Signed-off-by: Brent Baude &lt;bbaude@redhat.com&gt;</MESSAGE>
      <SHA>4a42928946e80becf3bdad57e6e6140e6a0ba89a</SHA>
      <PATCHEDFILES>
        <FILE>pkg/machine/define/errors.go</FILE>
        <FILE>pkg/machine/e2e/start_test.go</FILE>
        <FILE>pkg/machine/shim/host.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Prevent two podman machines running on darwin As issue #25112 points out, it was possible to start a machine on one of the darwin providers and then switch providers and start another one with a different name. This PR firstly prevents that use which is a forbidden use case. Secondarily, performed some minor cleanup on the error messages being used so that the error would be specific to this condition. This bug fix is for darwin only. In the case of Windows, we probably need to answer the question I raised in #24067 first, which is whether we want to stop allowing WSL to run multiple machines. Fixes #25112 Signed-off-by: Brent Baude &lt;bbaude@redhat.com&gt;</MESSAGE>
      <SHA>4eeaedfe131f94e25a1ca3937892ee32b81149fd</SHA>
      <PATCHEDFILES>
        <FILE>pkg/machine/define/errors.go</FILE>
        <FILE>pkg/machine/e2e/start_test.go</FILE>
        <FILE>pkg/machine/shim/host.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Prevent two podman machines running on darwin As issue #25112 points out, it was possible to start a machine on one of the darwin providers and then switch providers and start another one with a different name. This PR firstly prevents that use which is a forbidden use case. Secondarily, performed some minor cleanup on the error messages being used so that the error would be specific to this condition. This bug fix is for darwin only. In the case of Windows, we probably need to answer the question I raised in #24067 first, which is whether we want to stop allowing WSL to run multiple machines. Fixes #25112 Signed-off-by: Brent Baude &lt;bbaude@redhat.com&gt;</MESSAGE>
      <SHA>599da8c50b9068df4694b8388031ab7798ba48a5</SHA>
      <PATCHEDFILES>
        <FILE>pkg/machine/define/errors.go</FILE>
        <FILE>pkg/machine/e2e/start_test.go</FILE>
        <FILE>pkg/machine/shim/host.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
