<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>18047</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/18047</ISSUEURL>
  <TITLE>[sys] kube play read-only: racy status checks</TITLE>
  <DESCRIPTION>Flake seen in my hammer-sqlite PR, `f37 aarch64 root`, both [local](https://api.cirrus-ci.com/v1/artifact/task/6384574364647424/html/sys-podman-fedora-37-aarch64-root-host-sqlite.log.html#t--00535) and [remote](https://api.cirrus-ci.com/v1/artifact/task/4625355760205824/html/sys-remote-fedora-37-aarch64-root-host-sqlite.log.html#t--00534): ``` not ok 535 podman kube play read-only from containers.conf ... # podman inspect --format {{.State.ExitCode}} pod1-test2 0 #/vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv #| FAIL: Container / should be read/only &lt;---- poor message. Should read &quot;exit status from touch /file on RO container&quot; #| expected: '1' #| actual: '0' ``` Root cause: when `podman kube play` runs containers, a container that exits nonzero seems to be infinite-looped: it keeps retrying forever. The above `inspect` caught it in a moment when the container had just started. Solution: I give up. I've spent an hour trying to play with `restartPolicy` and `container create --restart=no` (which does not get seen by `podman generate kube`) and looking at man pages. I can find no way to tell podman-kube to just run that container once. I'm astonished that this doesn't flake more often.</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>8</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #17854 from matejvasek/enable-test-test_wait_next_exit test: enable test_wait_next_exit</MESSAGE>
    <SHA>c8eb15114b2456ae508c87de47fd4d8bc82bc4fc</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>system tests: fix race in kube-play read-only Use --restart=no on all created containers. Without this, all containers spin forever and it's impossible to get a reliable exit status. As a side effort, clean up tests, make more robust and maintainable. Fixes: #18047 Signed-off-by: Ed Santiago &lt;santiago@redhat.com&gt;</MESSAGE>
      <SHA>31420112ceb3f39485e4744196fdea472a8785f5</SHA>
      <PATCHEDFILES>
        <FILE>test/system/700-play.bats</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
