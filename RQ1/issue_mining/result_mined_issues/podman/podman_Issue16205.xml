<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>16205</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/16205</ISSUEURL>
  <TITLE>Two copies of the image references parser included</TITLE>
  <DESCRIPTION>Podman vendors the `github.com/containers/image/v5/docker/reference`, with the README.md saying: &gt; This is a copy of github.com/docker/distribution/reference as of commit 3226863cbcba6dbc2f6c83a37b28126c934af3f8, except that ParseAnyReferenceWithSet has been removed to drop the dependency on github.com/docker/distribution/digestset. However, it also vendors the above mentioned `github.com/docker/distribution/reference`, including the &quot;digestset&quot; dependency that was apparently problematic. This is not great, because both of these libraries are very heavy during initialization. Running podman with `GODEBUG=inittrace=1` produces this: ``` init github.com/containers/image/v5/docker/reference @1.1 ms, 1.8 ms clock, 1341880 bytes, 11453 allocs init github.com/docker/distribution/reference @5.1 ms, 1.8 ms clock, 1341816 bytes, 11452 allocs ``` I.e. each instance creates 1.3 MB of compiled regexps.</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>77</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge branch 'main' of github.com:containers/podman</MESSAGE>
    <SHA>65d9a937d0486ec798102fa6dd5ad0343a6876b7</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Don't use github.com/docker/distribution containers/image/v5/docker/reference has same content, but less overhead. Partial fix for: https://github.com/containers/podman/issues/16205 Signed-off-by: Daniel J Walsh &lt;dwalsh@redhat.com&gt;</MESSAGE>
      <SHA>f9b4cce6a1cd1d1a64b8ec18177079bdea59c9c4</SHA>
      <PATCHEDFILES>
        <FILE>go.mod</FILE>
        <FILE>pkg/api/handlers/utils/images.go</FILE>
        <FILE>pkg/domain/infra/abi/images.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Don't use github.com/docker/distribution containers/image/v5/docker/reference has same content, but less overhead. Partial fix for: https://github.com/containers/podman/issues/16205 Signed-off-by: Daniel J Walsh &lt;dwalsh@redhat.com&gt;</MESSAGE>
      <SHA>234b2230ef19201063116c13100d3bc4e739cfb7</SHA>
      <PATCHEDFILES>
        <FILE>go.mod</FILE>
        <FILE>pkg/api/handlers/utils/images.go</FILE>
        <FILE>pkg/domain/infra/abi/images.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
