<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>17059</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/17059</ISSUEURL>
  <TITLE>containerignore, remote, Containerfile, broken</TITLE>
  <DESCRIPTION>#16810 broke #13665. &quot;Containerfile&quot; used to appear in output, it no longer does. But because the test was broken, and nobody tried to fix it, we didn't notice. Reproducer ([save this as test-13655](https://github.com/containers/podman/files/10384831/test-13655.txt)) ```bash #!/bin/bash rm -rf /tmp/pm1 /tmp/pm2 mkdir /tmp/pm1 /tmp/pm2 cat &gt;/tmp/pm1/Containerfile &lt;&lt;EOF FROM alpine ADD . /testfilter/ RUN find /testfilter/ -print EOF # With no files in context dir, error &quot;While reading directory /tmp/pm2: EOF&quot; touch /tmp/pm2/dummyfile bin/podman rmi -f foo bin/podman-remote build -t foo -f /tmp/pm1/Containerfile /tmp/pm2 |&amp; tee /tmp/pm1/log echo if grep /Containerfile /tmp/pm1/log; then echo &quot;GOOD&quot; else echo &quot;BAD&quot; exit 1 fi ``` Steps: ```console $ git co 553df8748bd7936ba09c836d54525e45d80c121e^ $ ./test-13655 GOOD $ git co 553df8748bd7936ba09c836d54525e45d80c121e $ ./test-13655 BAD ``` @flouthoc PTAL. And when this gets re-fixed, please (fingers crossed) try this to see if it fixes the test: ```diff diff --git a/test/e2e/build_test.go b/test/e2e/build_test.go index fb75ad1b9..8e3f3647c 100644 --- a/test/e2e/build_test.go +++ b/test/e2e/build_test.go @@ -572,8 +572,6 @@ subdir**` // See https://github.com/containers/podman/issues/13535 It(&quot;Remote build .containerignore filtering embedded directory (#13535)&quot;, func() { SkipIfNotRemote(&quot;Testing remote .containerignore file filtering&quot;) - Skip(&quot;FIXME: #15014: test times out in 'dd' on f36.&quot;) - podmanTest.RestartRemoteService() // Switch to temp dir and restore it afterwards @@ -605,7 +603,7 @@ subdir**` dd := exec.Command(&quot;dd&quot;, &quot;if=/dev/urandom&quot;, &quot;of=&quot;+randomFile, &quot;bs=1G&quot;, &quot;count=1&quot;) ddSession, err := Start(dd, GinkgoWriter, GinkgoWriter) Expect(err).ToNot(HaveOccurred()) - Eventually(ddSession, &quot;10s&quot;, &quot;1s&quot;).Should(Exit(0)) + Eventually(ddSession, &quot;30s&quot;, &quot;1s&quot;).Should(Exit(0)) // make cwd as context root path Expect(os.Chdir(contextDir)).ToNot(HaveOccurred()) ```</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>8</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #17144 from rhatdan/annotations Remove ReservedAnnotations from kube generate specification</MESSAGE>
    <SHA>21d1e794cea8b4bcdda771f33979d5e15019f2c7</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>e2e tests: reenable long-skipped build test July 2022: test was flaking on new VM images. We needed new images, so I filed #15014 and skipped the test. January 2023: no attention from anyone, so I'll try bumping up a dd timeout from 10s to 30s. But in the interim, the test has broken: it used to expect &quot;Containerfile&quot; in output (this was deliberately added in #13655)... but #16810 changed that so Containerfile no longer appears. @flouthoc argues that this too is deliberate (#17059). Okay, so let's change the test then. All I care about is not adding more regressions. Signed-off-by: Ed Santiago &lt;santiago@redhat.com&gt;</MESSAGE>
      <SHA>51836aa47ce224f0f3bdbee2152c74665a4a0634</SHA>
      <PATCHEDFILES>
        <FILE>test/e2e/build_test.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
