<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>14647</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/14647</ISSUEURL>
  <TITLE>containers list api route response header is text/plain instead of application/json</TITLE>
  <DESCRIPTION>/kind bug **Description** Response content-type header is not `application/json` for containers list endpoint, although negotiation requests it. Some client libraries do attempt deserializing automatically to their data structures. Although it can be mitigated as an exception for this route, it should respect the negotiation. (v3 and v4 have the same behavior) **Steps to reproduce the issue:** 1. base url `v3.0.0` - `curl -v -X GET --unix-socket &quot;/run/user/1000/podman/podman.sock&quot; &quot;http://d/v3.0.0/libpod/containers/json&quot; -H &quot;Accept: application/json&quot; -H &quot;Content-Type: application/json&quot;` 2. base url `v4.0.0` - `curl -v -X GET --unix-socket &quot;/run/user/1000/podman/podman.sock&quot; &quot;http://d/v4.0.0/libpod/containers/json&quot; -H &quot;Accept: application/json&quot; -H &quot;Content-Type: application/json&quot;` **Describe the results you received:** ``` &gt; GET /v4.0.0/libpod/containers/json HTTP/1.1 ... &lt; Content-Type: text/plain; charset=us-ascii &lt; Libpod-Api-Version: 4.1.0 ... ``` **Describe the results you expected:** ``` &gt; GET /v4.0.0/libpod/containers/json HTTP/1.1 ... &lt; Content-Type: application/json; charset=us-ascii &lt; Libpod-Api-Version: 4.1.0 ... ``` If any use, issued the same for docker api and it does have `application/json` as response content-type header ``` docker --version Docker version 20.10.16, build aa7e414fdc ``` ``` curl -v -X GET --unix-socket &quot;/var/run/docker.sock&quot; &quot;http://localhost/containers/json&quot; -H &quot;Accept: application/json&quot; -H &quot;Content-Type: application/json&quot; Note: Unnecessary use of -X or --request, GET is already inferred. * Trying /var/run/docker.sock:0... * Connected to localhost (/run/docker.sock) port 80 (#0) &gt; GET /containers/json HTTP/1.1 &gt; Host: localhost &gt; User-Agent: curl/7.83.1 &gt; Accept: application/json &gt; Content-Type: application/json &gt; * Mark bundle as not supporting multiuse &lt; HTTP/1.1 200 OK &lt; Api-Version: 1.41 &lt; Content-Type: application/json &lt; Docker-Experimental: false &lt; Ostype: linux &lt; Server: Docker/20.10.16 (linux) &lt; Date: Fri, 17 Jun 2022 15:57:22 GMT &lt; Transfer-Encoding: chunked ``` &gt; IMPORTANT EDIT - It only happens when the list of containers is empty, as soon as at least one is present it respects!</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>4</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #14657 from eriksjolund/rewrite_env_docs [CI:DOCS] Rewrite --env docs</MESSAGE>
    <SHA>55052c6b9807b5a51b50abc90e391e872be450c2</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>API: containers/json always set application/json content type When we return no containers we just return `[]` but we still have to keep the content type header `application/json` so external tools can correctly parse the output. Fixes #14647 Signed-off-by: Paul Holzinger &lt;pholzing@redhat.com&gt;</MESSAGE>
      <SHA>bb5bd09eade239dda07332a887d0fafb6e29ee87</SHA>
      <PATCHEDFILES>
        <FILE>pkg/api/handlers/libpod/containers.go</FILE>
        <FILE>test/apiv2/20-containers.at</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
