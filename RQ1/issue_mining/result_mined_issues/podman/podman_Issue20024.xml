<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>20024</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/20024</ISSUEURL>
  <TITLE>Support better isulation when building images as part of `kube play`</TITLE>
  <DESCRIPTION>### Feature request description `podman kube play` has a useful option to build an image when the image specified in the K8s YAML maps to a directory with a Dockerfile or a Container file in it. Currently when images are built this way, the isolation use is hard-coded to &quot;cheroot&quot; as evident by [this code][1]. This can cause more complex container builds to fail due to e.g. collisions with resources running on the host. [1]: https://github.com/containers/podman/blob/main/pkg/domain/infra/abi/play.go#L984-L990 ### Suggest potential solution I would like to have at least one of the following: - If nothing else, document the current behaviour - it took us quite a while to figure out why images that build properly with `podman build` fail to build with `podman kube play` - A command-line option to set the desired isolation level - Support for the `BUILDAH_ISOLATION` environment variable - A way the specify the isolation via the k8s YAML file (E.g. via a POD annotation) - Default to higher isolation level (OCI or rootless) ### Have you considered any alternatives? We are currently telling people to build the images on their own via `podman build` before spinning up their environment via `podman kube play`. We may also end up providing our own wrapper script, but this is cumbersome. We'd really like to have a single command to spin up a work environment. ### Additional context Add any other context or screenshots about the feature request here.</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>35</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #20451 from rhatdan/volume Support size option when creating tmpfs volumes</MESSAGE>
    <SHA>e9e18acd5fbcb57574ea5e759683b2b97cc96602</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Use buildah default isolation when working with podman play kube Users can specify BUILDAH_ISOLATION environment variable to change the default. Fixes: https://github.com/containers/podman/issues/20024 Currently podman play kube is defaulting to chroot, which is the least safe version of build, we should always default to secure whenever possible. Chroot should only be used when building within a container. No great way to tests this. [NO NEW TESTS NEEDED] Signed-off-by: Daniel J Walsh &lt;dwalsh@redhat.com&gt;</MESSAGE>
      <SHA>06b72649779718fe7e41c3b91f44d7b056b12579</SHA>
      <PATCHEDFILES>
        <FILE>docs/source/markdown/podman-kube-play.1.md.in</FILE>
        <FILE>pkg/domain/infra/abi/play.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
