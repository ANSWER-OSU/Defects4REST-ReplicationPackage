<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>17189</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/17189</ISSUEURL>
  <TITLE>[Bug]: podman run --ipc=host not work as expected</TITLE>
  <DESCRIPTION>### Issue Description I am using centos-stream 8 , when running like below: ``` podman run -it --rm --ipc host localhost/registry:2 sh ```` the ipc mode should be `host` as expected. but i got following ``` podman inspect gallant_mahavira | grep -i ipc -C 2 &quot;-it&quot;, &quot;--rm&quot;, &quot;--ipc&quot;, &quot;host&quot;, &quot;localhost/registry:2&quot;, -- &quot;ExtraHosts&quot;: [], &quot;GroupAdd&quot;: [], &quot;IpcMode&quot;: &quot;shareable&quot;, &quot;Cgroup&quot;: &quot;&quot;, &quot;Cgroups&quot;: &quot;default&quot;, ``` ### Steps to reproduce the issue Steps to reproduce the issue 1. run like `podman run -it --rm --ipc host localhost/registry:2 sh` ### Describe the results you received ``` podman inspect gallant_mahavira | grep -i ipc -C 2 &quot;-it&quot;, &quot;--rm&quot;, &quot;--ipc&quot;, &quot;host&quot;, &quot;localhost/registry:2&quot;, -- &quot;ExtraHosts&quot;: [], &quot;GroupAdd&quot;: [], &quot;IpcMode&quot;: &quot;shareable&quot;, &quot;Cgroup&quot;: &quot;&quot;, &quot;Cgroups&quot;: &quot;default&quot;, ```` It use `shareable` rather than `host` ### Describe the results you expected ```` podman inspect gallant_mahavira | grep -i ipc -C 2 &quot;-it&quot;, &quot;--rm&quot;, &quot;--ipc&quot;, &quot;host&quot;, &quot;localhost/registry:2&quot;, -- &quot;ExtraHosts&quot;: [], &quot;GroupAdd&quot;: [], &quot;IpcMode&quot;: &quot;host&quot;, &quot;Cgroup&quot;: &quot;&quot;, &quot;Cgroups&quot;: &quot;default&quot;, ```` ### podman info output ```shell If you are unable to run podman info for any reason, please provide the podman version, operating system and its version and the architecture you are running. podman info host: arch: amd64 buildahVersion: 1.27.0 cgroupControllers: - cpuset - cpu - cpuacct - blkio - memory - devices - freezer - net_cls - perf_event - net_prio - hugetlb - pids - rdma cgroupManager: systemd cgroupVersion: v1 conmon: package: conmon-2.1.4-1.module_el8.7.0+1216+b022c01d.x86_64 path: /usr/bin/conmon version: 'conmon version 2.1.4, commit: ec95327311bd1f0a118cadc9b24032df370babe4' cpuUtilization: idlePercent: 98.75 systemPercent: 0.38 userPercent: 0.87 cpus: 4 distribution: distribution: '&quot;centos&quot;' version: &quot;8&quot; eventLogger: file hostname: stream8 idMappings: gidmap: null uidmap: null kernel: 4.18.0-358.el8.x86_64 linkmode: dynamic logDriver: k8s-file memFree: 72482816 memTotal: 2067890176 networkBackend: cni ociRuntime: name: runc package: runc-1.1.4-1.module_el8.7.0+1216+b022c01d.x86_64 path: /usr/bin/runc version: |- runc version 1.1.4 spec: 1.0.2-dev go: go1.18.4 libseccomp: 2.5.2 os: linux remoteSocket: exists: true path: /run/podman/podman.sock security: apparmorEnabled: false capabilities: CAP_NET_RAW,CAP_CHOWN,CAP_DAC_OVERRIDE,CAP_FOWNER,CAP_FSETID,CAP_KILL,CAP_NET_BIND_SERVICE,CAP_SETFCAP,CAP_SETGID,CAP_SETPCAP,CAP_SETUID,CAP_SYS_CHROOT rootless: false seccompEnabled: true seccompProfilePath: /usr/share/containers/seccomp.json selinuxEnabled: false serviceIsRemote: false slirp4netns: executable: /usr/bin/slirp4netns package: slirp4netns-1.2.0-2.module_el8.7.0+1216+b022c01d.x86_64 version: |- slirp4netns version 1.2.0 commit: 656041d45cfca7a4176f6b7eed9e4fe6c11e8383 libslirp: 4.4.0 SLIRP_CONFIG_VERSION_MAX: 3 libseccomp: 2.5.2 swapFree: 0 swapTotal: 0 uptime: 12h 40m 7.00s (Approximately 0.50 days) plugins: authorization: null log: - k8s-file - none - passthrough - journald network: - bridge - macvlan - ipvlan volume: - local registries: 10.3.0.82:4000: Blocked: false Insecure: true Location: 10.3.0.82:4000 MirrorByDigestOnly: false Mirrors: null Prefix: 10.3.0.82:4000 PullFromMirror: &quot;&quot; search: - registry.access.redhat.com - registry.redhat.io - docker.io - localhost:4000 store: configFile: /etc/containers/storage.conf containerStore: number: 18 paused: 0 running: 17 stopped: 1 graphDriverName: overlay graphOptions: overlay.mountopt: nodev,metacopy=on graphRoot: /var/lib/containers/storage graphRootAllocated: 42938118144 graphRootUsed: 17803042816 graphStatus: Backing Filesystem: xfs Native Overlay Diff: &quot;false&quot; Supports d_type: &quot;true&quot; Using metacopy: &quot;true&quot; imageCopyTmpDir: /var/tmp imageStore: number: 11 runRoot: /run/containers/storage volumePath: /var/lib/containers/storage/volumes version: APIVersion: 4.2.0 Built: 1663766104 BuiltTime: Wed Sep 21 13:15:04 2022 GitCommit: &quot;&quot; GoVersion: go1.18.4 Os: linux OsArch: linux/amd64 Version: 4.2.0 ``` ``` ### Podman in a container No ### Privileged Or Rootless None ### Upstream Latest Release No ### Additional environment details Additional environment details ### Additional information Additional information like issue happens only occasionally or issue happens with a particular architecture or on a particular setting</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>1</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #17183 from agowa338/patch-1 (fix) mount_program is in storage.options.overlay</MESSAGE>
    <SHA>ce504bbfe3d9fed8073160bbb7f54a1a259ec662</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>fix ipc namespace inspect logic The ipc ns inspect logic did not work, the switch case was just broken because it will only execute the first branch. Therefore it always showed `shareable` or `container:...` as mode. This fixes the logic and adds tests for all modes. Fixes #17189 Signed-off-by: Paul Holzinger &lt;pholzing@redhat.com&gt;</MESSAGE>
      <SHA>40549113dbf884caaa9849e5c1cf0cc1fdb69f65</SHA>
      <PATCHEDFILES>
        <FILE>libpod/container_inspect_linux.go</FILE>
        <FILE>test/system/190-run-ipcns.bats</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Correct output when inspecting containers created with --ipc Fixes: https://github.com/containers/podman/issues/17189 Signed-off-by: Daniel J Walsh &lt;dwalsh@redhat.com&gt;</MESSAGE>
      <SHA>623ad2a6362382e286a49c428488d06eeffeec05</SHA>
      <PATCHEDFILES>
        <FILE>libpod/container_inspect_linux.go</FILE>
        <FILE>test/system/190-run-ipcns.bats</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
