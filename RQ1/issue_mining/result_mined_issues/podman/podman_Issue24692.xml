<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>24692</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/24692</ISSUEURL>
  <TITLE>Fail to run privileged nested container, on fedora 41</TITLE>
  <DESCRIPTION>### Issue Description Describe your issue Fail to run privileged nested container, on fedora 41 ### Steps to reproduce the issue Steps to reproduce the issue 1. Fedora41 2. `dnf copr enable -y @centos-automotive-sig/bluechi-snapshot &quot;Fedora-41-$(arch)&quot;` 3. `dnf copr enable -y rhcontainerbot/qm &quot;fedora-41-$(arch)&quot;` 4. `dnf install -y qm` 5. Now, need to run emulated setup script to install qm systemd and podman in QM rootfs. ` bash -x /usr/share/qm/setup ` 6. Verify qm service is up ``` systemctl is-acive qm podman ps shows qm enviroment is running. ``` 7. Run nested container, rootfull ``` podman exec qm podman run ubi9-minimal pwd ``` ### Describe the results you received Describe the results you received ``` Resolved &quot;ubi9-minimal&quot; as an alias (/etc/containers/registries.conf.d/000-shortnames.conf) Trying to pull registry.access.redhat.com/ubi9-minimal:latest... Getting image source signatures Writing manifest to image destination Storing signatures Error: crun: setrlimit `RLIMIT_NOFILE`: Operation not permitted: OCI permission denied ``` ### Describe the results you expected Describe the results you expected Nested container should run without failures.[host-podman-info.txt](https://github.com/user-attachments/files/17935955/host-podman-info.txt) [qm-podman-info.txt](https://github.com/user-attachments/files/17935954/qm-podman-info.txt) Nested podman container is run successfully for c9s https://artifacts.dev.testing-farm.io/0d73bf4f-14b2-43c9-8bcf-27b07f3406fb/work-kvm-tier-05glnpgbx/plans/e2e/kvm-tier-0/execute/data/guest/default-0/tests/qm-sanity-test/check_qm_podman_quadlet_is_ok-4/output.txt ### podman info output ```yaml If you are unable to run podman info for any reason, please provide the podman version, operating system and its version and the architecture you are running. *podman info* Please see attached files host-podman-info.txt attached file for qm qm-podman-info.txt *podman version* rpm -q podman podman-5.3.1-1.fc41.x86_64 podman exec qm rpm -q podman podman-5.3.1-1.fc41.x86_64 *operating system* Fedora *version* 41, uname -r 6.11.8-300.fc41.x86_64 architecture x86_64 ``` ### Podman in a container Yes ### Privileged Or Rootless Privileged ### Upstream Latest Release Yes ### Additional environment details Additional environment details To understand tested enviroment please refer this README https://github.com/containers/qm?tab=readme-ov-file#qm-is-a-containerized-environment-for-running-functional-safety-qm-quality-management-software ### Additional information more details exist here [qm#660](https://github.com/containers/qm/issues/666) This one https://github.com/containers/qm/issues/666#issuecomment-2500103556 Did not help to solve the issue</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #24682 from lsm5/main-packit-remove-epel-targets [skip-ci] Packit: remove epel and re-enable c9s</MESSAGE>
    <SHA>ceee7cb0a6b92412f6be5d6206cd4ac764cd99e6</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>spec: clamp rlimits without CAP_SYS_RESOURCE commit 5ebba75dbd4462da47283b3f018804b7361d52bf implemented this behaviour for rootless users and later commit 0a69aefa41d55d2aa30333d6a4ce76b178d1ed5b changed it when in a user namespace, but the same limitation exists for root without CAP_SYS_RESOURCE. Change the check to use the clamp to the current values if running without CAP_SYS_RESOURCE. Closes: https://github.com/containers/podman/issues/24692 Signed-off-by: Giuseppe Scrivano &lt;gscrivan@redhat.com&gt;</MESSAGE>
      <SHA>c447288bdf66325fa4e13af16f5ea381fc523078</SHA>
      <PATCHEDFILES>
        <FILE>libpod/container_internal_common.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>spec: clamp rlimits without CAP_SYS_RESOURCE commit 5ebba75dbd4462da47283b3f018804b7361d52bf implemented this behaviour for rootless users and later commit 0a69aefa41d55d2aa30333d6a4ce76b178d1ed5b changed it when in a user namespace, but the same limitation exists for root without CAP_SYS_RESOURCE. Change the check to use the clamp to the current values if running without CAP_SYS_RESOURCE. Closes: https://github.com/containers/podman/issues/24692 Signed-off-by: Giuseppe Scrivano &lt;gscrivan@redhat.com&gt;</MESSAGE>
      <SHA>4b38031699053067ef8fc58493cb68881d4dc6e8</SHA>
      <PATCHEDFILES>
        <FILE>libpod/container_internal_common.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>spec: clamp rlimits without CAP_SYS_RESOURCE commit 5ebba75dbd4462da47283b3f018804b7361d52bf implemented this behaviour for rootless users and later commit 0a69aefa41d55d2aa30333d6a4ce76b178d1ed5b changed it when in a user namespace, but the same limitation exists for root without CAP_SYS_RESOURCE. Change the check to use the clamp to the current values if running without CAP_SYS_RESOURCE. Closes: https://github.com/containers/podman/issues/24692 Signed-off-by: Giuseppe Scrivano &lt;gscrivan@redhat.com&gt;</MESSAGE>
      <SHA>4b38294e92cb19433f46f38f5fd8e826c8cb6616</SHA>
      <PATCHEDFILES>
        <FILE>libpod/container_internal_common.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
