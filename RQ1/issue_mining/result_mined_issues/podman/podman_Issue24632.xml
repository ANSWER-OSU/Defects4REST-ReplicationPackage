<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>24632</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/24632</ISSUEURL>
  <TITLE>stats API endpoint crashing 500 when container has no cgroup</TITLE>
  <DESCRIPTION>### Issue Description hello! I found a surprising behavior via use of the podman-exporter to report metrics. In creating a pod via `kube play`, the pod is created fine, but the metrics endpoint is failing with 500: ``` curl -s localhost:5000/v5.2.5/libpod/containers/stats Request Failed(Internal Server Error): cannot run top on container 0c72.. as it did not create a cgroup: this container does not have a cgroup ``` error logged: ``` GET /v5.2.5/libpod/containers/stats?all=false&amp;interval=1&amp;stream=false HTTP/1.1&quot; 500 239 &quot;&quot; &quot;Go-http-client/1.1&quot; ``` Here the container `0c72..` is a pause container. I would not expect the endpoint to crash 500 and deny all stat info. Notably podman is rootless mode and in k8s (ie like DnD). Not seeing the problem in native host mode. Unclear if `containers.conf` is the source of problem. Have not had time to extensively rtfm there, but a latest attempt looked like this (largely inherited from /etc version found at https://quay.io/repository/containers/podman) ``` [containers] netns=&quot;host&quot; userns=&quot;host&quot; ipcns=&quot;host&quot; utsns=&quot;host&quot; cgroupns=&quot;host&quot; cgroups=&quot;disabled&quot; log_driver = &quot;k8s-file&quot; volumes = [ &quot;/proc:/proc&quot;, ] default_sysctls = [] [engine] cgroup_manager = &quot;cgroupfs&quot; events_logger=&quot;file&quot; runtime=&quot;crun&quot; ``` Version info ``` $ podman version Client: Podman Engine Version: 5.2.5 API Version: 5.2.5 Go Version: go1.23.2 Built: Fri Oct 18 00:00:00 2024 OS/Arch: linux/amd64 ```</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>7</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #24682 from lsm5/main-packit-remove-epel-targets [skip-ci] Packit: remove epel and re-enable c9s</MESSAGE>
    <SHA>ceee7cb0a6b92412f6be5d6206cd4ac764cd99e6</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>stats: ignore errors from containers without cgroups Now `podman stats --all` ignores failures from a container that has no cgroups. Closes: https://github.com/containers/podman/issues/24632 Signed-off-by: Giuseppe Scrivano &lt;gscrivan@redhat.com&gt;</MESSAGE>
      <SHA>5adf07c6e8bc45cba940d3c7eb8c8e2340b4aa69</SHA>
      <PATCHEDFILES>
        <FILE>pkg/domain/infra/abi/containers.go</FILE>
        <FILE>test/system/420-cgroups.bats</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>stats: ignore errors from containers without cgroups Now `podman stats --all` ignores failures from a container that has no cgroups. Closes: https://github.com/containers/podman/issues/24632 Signed-off-by: Giuseppe Scrivano &lt;gscrivan@redhat.com&gt;</MESSAGE>
      <SHA>6673f5c202c187ce3c222fa859d03aa06df3211f</SHA>
      <PATCHEDFILES>
        <FILE>pkg/domain/infra/abi/containers.go</FILE>
        <FILE>test/system/420-cgroups.bats</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
