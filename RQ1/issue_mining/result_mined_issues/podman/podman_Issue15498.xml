<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>15498</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/15498</ISSUEURL>
  <TITLE>Error: mkdir /sys/fs/cgroup/init: permission denied</TITLE>
  <DESCRIPTION>&lt;!-- --------------------------------------------------- BUG REPORT INFORMATION --------------------------------------------------- Use the commands below to provide key information from your environment: You do NOT have to include this information if this is a FEATURE REQUEST **NOTE** A large number of issues reported against Podman are often found to already be fixed in more current versions of the project. Before reporting an issue, please verify the version you are running with `podman version` and compare it to the latest release documented on the top of Podman's [README.md](../README.md). If they differ, please update your version of Podman to the latest possible and retry your command before creating an issue. Also, there is a running list of known issues in the [Podman Troubleshooting Guide](https://github.com/containers/podman/blob/main/troubleshooting.md), please reference that page before opening a new issue. If you are filing a bug against `podman build`, please instead file a bug against Buildah (https://github.com/containers/buildah/issues). Podman build executes Buildah to perform container builds, and as such the Buildah maintainers are best equipped to handle these bugs. --&gt; **Is this a BUG REPORT or FEATURE REQUEST? (leave only one on its own line)** /kind bug **Description** I have a podman in rootless docker setup, which looks like this: OS -&gt; rootless docker as user daemon -&gt; run privileged container -&gt; podman runs as user With 4.2.0 I can't run run podman system service as user in this setup, maybe because of https://github.com/containers/podman/pull/14787 &lt;!-- Briefly describe the problem you are having in a few paragraphs. --&gt; **Steps to reproduce the issue:** ``` podman --log-level debug system service --time 0 unix:///tmp/podman.sock ``` **Describe the results you received:** ``` INFO[0000] podman filtering at log level debug DEBU[0000] Called service.PersistentPreRunE(podman --log-level debug system service --time 0 unix:///tmp/podman.sock) DEBU[0000] Merged system config &quot;/etc/containers/containers.conf&quot; DEBU[0000] Using conmon: &quot;/usr/local/bin/conmon&quot; DEBU[0000] Initializing boltdb state at /home/jenkins/.local/share/containers/storage/libpod/bolt_state.db DEBU[0000] systemd-logind: dial unix /var/run/dbus/system_bus_socket: connect: no such file or directory DEBU[0000] Using graph driver overlay DEBU[0000] Using graph root /home/jenkins/.local/share/containers/storage DEBU[0000] Using run root /tmp/podman-run-1000/containers DEBU[0000] Using static dir /home/jenkins/.local/share/containers/storage/libpod DEBU[0000] Using tmp dir /tmp/podman-run-1000/libpod/tmp DEBU[0000] Using volume path /home/jenkins/.local/share/containers/storage/volumes DEBU[0000] Set libpod namespace to &quot;&quot; DEBU[0000] Not configuring container store DEBU[0000] Initializing event backend file DEBU[0000] Configured OCI runtime runc initialization failed: no valid executable found for OCI runtime runc: invalid argument DEBU[0000] Configured OCI runtime runj initialization failed: no valid executable found for OCI runtime runj: invalid argument DEBU[0000] Configured OCI runtime kata initialization failed: no valid executable found for OCI runtime kata: invalid argument DEBU[0000] Configured OCI runtime runsc initialization failed: no valid executable found for OCI runtime runsc: invalid argument DEBU[0000] Configured OCI runtime krun initialization failed: no valid executable found for OCI runtime krun: invalid argument DEBU[0000] Using OCI runtime &quot;/usr/local/bin/crun&quot; INFO[0000] podman filtering at log level debug DEBU[0000] Called service.PersistentPreRunE(podman --log-level debug system service --time 0 unix:///tmp/podman.sock) DEBU[0000] Merged system config &quot;/etc/containers/containers.conf&quot; DEBU[0000] Using conmon: &quot;/usr/local/bin/conmon&quot; DEBU[0000] Initializing boltdb state at /home/jenkins/.local/share/containers/storage/libpod/bolt_state.db DEBU[0000] systemd-logind: dial unix /var/run/dbus/system_bus_socket: connect: no such file or directory DEBU[0000] Using graph driver overlay DEBU[0000] Using graph root /home/jenkins/.local/share/containers/storage DEBU[0000] Using run root /tmp/podman-run-1000/containers DEBU[0000] Using static dir /home/jenkins/.local/share/containers/storage/libpod DEBU[0000] Using tmp dir /tmp/podman-run-1000/libpod/tmp DEBU[0000] Using volume path /home/jenkins/.local/share/containers/storage/volumes DEBU[0000] Set libpod namespace to &quot;&quot; DEBU[0000] [graphdriver] trying provided driver &quot;overlay&quot; DEBU[0000] overlay: test mount with multiple lowers succeeded DEBU[0000] Cached value indicated that overlay is supported DEBU[0000] overlay: test mount indicated that metacopy is not being used DEBU[0000] backingFs=extfs, projectQuotaSupported=false, useNativeDiff=true, usingMetacopy=false DEBU[0000] Initializing event backend file DEBU[0000] Configured OCI runtime runc initialization failed: no valid executable found for OCI runtime runc: invalid argument DEBU[0000] Configured OCI runtime runj initialization failed: no valid executable found for OCI runtime runj: invalid argument DEBU[0000] Configured OCI runtime kata initialization failed: no valid executable found for OCI runtime kata: invalid argument DEBU[0000] Configured OCI runtime runsc initialization failed: no valid executable found for OCI runtime runsc: invalid argument DEBU[0000] Configured OCI runtime krun initialization failed: no valid executable found for OCI runtime krun: invalid argument DEBU[0000] Using OCI runtime &quot;/usr/local/bin/crun&quot; DEBU[0000] Successfully loaded 1 networks DEBU[0000] Initialized SHM lock manager at path /libpod_rootless_lock_1000 DEBU[0000] Podman detected system restart - performing state refresh INFO[0000] Setting parallel job count to 73 **Error: mkdir /sys/fs/cgroup/init: permission denied** ``` **Describe the results you expected:** ``` INFO[0000] podman filtering at log level debug DEBU[0000] Called service.PersistentPreRunE(podman --log-level debug system service --time 0 unix:///tmp/podman.sock) DEBU[0000] Merged system config &quot;/etc/containers/containers.conf&quot; DEBU[0000] Using conmon: &quot;/usr/local/bin/conmon&quot; DEBU[0000] Initializing boltdb state at /home/jenkins/.local/share/containers/storage/libpod/bolt_state.db DEBU[0000] systemd-logind: dial unix /var/run/dbus/system_bus_socket: connect: no such file or directory DEBU[0000] Using graph driver vfs DEBU[0000] Using graph root /home/jenkins/.local/share/containers/storage DEBU[0000] Using run root /tmp/podman-run-1000/containers DEBU[0000] Using static dir /home/jenkins/.local/share/containers/storage/libpod DEBU[0000] Using tmp dir /tmp/podman-run-1000/libpod/tmp DEBU[0000] Using volume path /home/jenkins/.local/share/containers/storage/volumes DEBU[0000] Set libpod namespace to &quot;&quot; DEBU[0000] Not configuring container store DEBU[0000] Initializing event backend file DEBU[0000] Configured OCI runtime runc initialization failed: no valid executable found for OCI runtime runc: invalid argument DEBU[0000] Configured OCI runtime kata initialization failed: no valid executable found for OCI runtime kata: invalid argument DEBU[0000] Configured OCI runtime runsc initialization failed: no valid executable found for OCI runtime runsc: invalid argument DEBU[0000] Configured OCI runtime krun initialization failed: no valid executable found for OCI runtime krun: invalid argument DEBU[0000] Using OCI runtime &quot;/usr/local/bin/crun&quot; INFO[0000] podman filtering at log level debug DEBU[0000] Called service.PersistentPreRunE(podman --log-level debug system service --time 0 unix:///tmp/podman.sock) DEBU[0000] Merged system config &quot;/etc/containers/containers.conf&quot; DEBU[0000] Using conmon: &quot;/usr/local/bin/conmon&quot; DEBU[0000] Initializing boltdb state at /home/jenkins/.local/share/containers/storage/libpod/bolt_state.db DEBU[0000] systemd-logind: dial unix /var/run/dbus/system_bus_socket: connect: no such file or directory DEBU[0000] Using graph driver vfs DEBU[0000] Using graph root /home/jenkins/.local/share/containers/storage DEBU[0000] Using run root /tmp/podman-run-1000/containers DEBU[0000] Using static dir /home/jenkins/.local/share/containers/storage/libpod DEBU[0000] Using tmp dir /tmp/podman-run-1000/libpod/tmp DEBU[0000] Using volume path /home/jenkins/.local/share/containers/storage/volumes DEBU[0000] Set libpod namespace to &quot;&quot; DEBU[0000] [graphdriver] trying provided driver &quot;vfs&quot; DEBU[0000] Initializing event backend file DEBU[0000] Configured OCI runtime runc initialization failed: no valid executable found for OCI runtime runc: invalid argument DEBU[0000] Configured OCI runtime kata initialization failed: no valid executable found for OCI runtime kata: invalid argument DEBU[0000] Configured OCI runtime runsc initialization failed: no valid executable found for OCI runtime runsc: invalid argument DEBU[0000] Configured OCI runtime krun initialization failed: no valid executable found for OCI runtime krun: invalid argument DEBU[0000] Using OCI runtime &quot;/usr/local/bin/crun&quot; DEBU[0000] Successfully loaded 1 networks DEBU[0000] Initialized SHM lock manager at path /libpod_rootless_lock_1000 DEBU[0000] Podman detected system restart - performing state refresh INFO[0000] Setting parallel job count to 73 DEBU[0000] registered SIGHUP watcher for config INFO[0000] API service listening on &quot;/tmp/podman.sock&quot;. URI: &quot;unix:///tmp/podman.sock&quot; DEBU[0000] CORS Headers were not set INFO[0000] API service listening on &quot;/tmp/podman.sock&quot; DEBU[0000] waiting for SIGHUP to reload configuration DEBU[0000] API service(s) shutting down, idle for 0s DEBU[0000] API service shutdown request ignored as timeout Duration is UnlimitedService ``` **Additional information you deem important (e.g. issue happens only occasionally):** **Output of `podman version`:** ``` Client: Podman Engine Version: 4.2.0 API Version: 4.2.0 Go Version: go1.19 Built: Thu Jan 1 01:00:00 1970 OS/Arch: linux/amd64 ``` **Output of `podman info`:** ``` host: arch: amd64 buildahVersion: 1.27.0 cgroupControllers: - memory - pids cgroupManager: cgroupfs cgroupVersion: v2 conmon: package: Unknown path: /usr/local/bin/conmon version: 'conmon version 2.1.3, commit: ab52a597278b20173440140cd810dc9fa8785c93-dirty' cpuUtilization: idlePercent: 99.88 systemPercent: 0.06 userPercent: 0.06 cpus: 24 distribution: codename: focal distribution: ubuntu version: &quot;20.04&quot; eventLogger: file hostname: 15150d64b287 idMappings: gidmap: - container_id: 0 host_id: 1000 size: 1 - container_id: 1 host_id: 10000 size: 65535 uidmap: - container_id: 0 host_id: 1000 size: 1 - container_id: 1 host_id: 10000 size: 65535 kernel: 5.15.0-46-generic linkmode: static logDriver: k8s-file memFree: 399939493888 memTotal: 405685620736 networkBackend: netavark ociRuntime: name: crun package: Unknown path: /usr/local/bin/crun version: |- crun version 1.5 commit: 54ebb8ca8bf7e6ddae2eb919f5b82d1d96863dea spec: 1.0.0 +SELINUX +APPARMOR +CAP +SECCOMP +EBPF +CRIU +YAJL os: linux remoteSocket: path: /tmp/podman-run-1000/podman/podman.sock security: apparmorEnabled: false capabilities: CAP_AUDIT_WRITE,CAP_CHOWN,CAP_DAC_OVERRIDE,CAP_FOWNER,CAP_FSETID,CAP_KILL,CAP_MKNOD,CAP_NET_BIND_SERVICE,CAP_NET_RAW,CAP_SETFCAP,CAP_SETGID,CAP_SETPCAP,CAP_SETUID,CAP_SYS_CHROOT rootless: true seccompEnabled: true seccompProfilePath: &quot;&quot; selinuxEnabled: false serviceIsRemote: false slirp4netns: executable: /usr/local/bin/slirp4netns package: Unknown version: |- slirp4netns version 1.2.0 commit: 656041d45cfca7a4176f6b7eed9e4fe6c11e8383 libslirp: 4.7.0 SLIRP_CONFIG_VERSION_MAX: 4 libseccomp: 2.5.3 swapFree: 0 swapTotal: 0 uptime: 48h 38m 43.00s (Approximately 2.00 days) plugins: authorization: null log: - k8s-file - none - passthrough network: - bridge - macvlan volume: - local registries: docker.io: Blocked: false Insecure: false Location: &lt;private:5000 MirrorByDigestOnly: false Mirrors: null Prefix: docker.io PullFromMirror: &quot;&quot; search: - docker.io store: configFile: /home/jenkins/.config/containers/storage.conf containerStore: number: 0 paused: 0 running: 0 stopped: 0 graphDriverName: overlay graphOptions: {} graphRoot: /home/jenkins/.local/share/containers/storage graphRootAllocated: 105089261568 graphRootUsed: 6835048448 graphStatus: Backing Filesystem: extfs Native Overlay Diff: &quot;true&quot; Supports d_type: &quot;true&quot; Using metacopy: &quot;false&quot; imageCopyTmpDir: /var/tmp imageStore: number: 0 runRoot: /tmp/podman-run-1000/containers volumePath: /home/jenkins/.local/share/containers/storage/volumes version: APIVersion: 4.2.0 Built: 0 BuiltTime: Thu Jan 1 01:00:00 1970 GitCommit: &quot;&quot; GoVersion: go1.19 Os: linux OsArch: linux/amd64 Version: 4.2.0 ``` **Package info (e.g. output of `rpm -q podman` or `apt list podman`):** ``` not packaged ``` **Have you tested with the latest version of Podman and have you checked the Podman Troubleshooting Guide? (https://github.com/containers/podman/blob/main/troubleshooting.md)** Yes **Additional environment details (AWS, VirtualBox, physical, etc.):** containers.conf ``` [containers] cgroupns = &quot;host&quot; cgroups = &quot;disabled&quot; [engine] cgroup_manager = &quot;cgroupfs&quot; events_logger=&quot;file&quot; ``` Ubuntu 22.04.1 LTS cgroup v2 (by default)</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #15495 from containers/dependabot/go_modules/github.com/vbauerster/mpb/v7-7.5.2 Bump github.com/vbauerster/mpb/v7 from 7.4.2 to 7.5.2</MESSAGE>
    <SHA>e47b54df3bdd7caf41d1639a7c06ce75a1989a63</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>service: make move to sub-cgroup non fatal if we are running in a container in the root cgroup, Podman tries to move itself to a sub-cgroup. This could be a problem in a setup where the cgroups are not writeable, so just log a debug message and continue, since anyway it is a best-effort operation. Closes: https://github.com/containers/podman/issues/15498 [NO NEW TESTS NEEDED] Signed-off-by: Giuseppe Scrivano &lt;gscrivan@redhat.com&gt;</MESSAGE>
      <SHA>e448122feff952f574acdd0f9dea3c1d2edcaccb</SHA>
      <PATCHEDFILES>
        <FILE>cmd/podman/system/service_abi.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>service: make move to sub-cgroup non fatal if we are running in a container in the root cgroup, Podman tries to move itself to a sub-cgroup. This could be a problem in a setup where the cgroups are not writeable, so just log a debug message and continue, since anyway it is a best-effort operation. Closes: https://github.com/containers/podman/issues/15498 [NO NEW TESTS NEEDED] Signed-off-by: Giuseppe Scrivano &lt;gscrivan@redhat.com&gt;</MESSAGE>
      <SHA>fc5cd0e2406302972c029946eae047609d9a53e1</SHA>
      <PATCHEDFILES>
        <FILE>cmd/podman/system/service_abi.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
