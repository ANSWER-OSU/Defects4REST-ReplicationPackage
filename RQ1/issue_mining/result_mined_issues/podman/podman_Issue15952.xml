<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>15952</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/15952</ISSUEURL>
  <TITLE>remote: manifest add --annotation failed to add annotations field</TITLE>
  <DESCRIPTION>&lt;!-- --------------------------------------------------- BUG REPORT INFORMATION --------------------------------------------------- Use the commands below to provide key information from your environment: You do NOT have to include this information if this is a FEATURE REQUEST **NOTE** A large number of issues reported against Podman are often found to already be fixed in more current versions of the project. Before reporting an issue, please verify the version you are running with `podman version` and compare it to the latest release documented on the top of Podman's [README.md](../README.md). If they differ, please update your version of Podman to the latest possible and retry your command before creating an issue. Also, there is a running list of known issues in the [Podman Troubleshooting Guide](https://github.com/containers/podman/blob/main/troubleshooting.md), please reference that page before opening a new issue. If you are filing a bug against `podman build`, please instead file a bug against Buildah (https://github.com/containers/buildah/issues). Podman build executes Buildah to perform container builds, and as such the Buildah maintainers are best equipped to handle these bugs. --&gt; **Is this a BUG REPORT or FEATURE REQUEST? (leave only one on its own line)** /kind bug **Description** &lt;!-- Briefly describe the problem you are having in a few paragraphs. --&gt; In help page, podman-remote manifest add --annotation option seems to be supported. However, --annotation option doesn't work. ``` # podman-remote manifest add --help Add images to a manifest list or image index &lt; ...snip... &gt; Options: --all add all of the list's images if the image is a list --annotation annotation set an annotation for the specified image --arch architecture override the architecture of the specified image --authfile string path of the authentication file. Use REGISTRY_AUTH_FILE environment variable to override --creds [username[:password]] use [username[:password]] for accessing the registry --features features override the features of the specified image --os OS override the OS of the specified image --os-version version override the OS version of the specified image --tls-verify require HTTPS and verify certificates when accessing the registry (default true) --variant Variant override the Variant of the specified image ``` **Steps to reproduce the issue:** ``` # podman-remote manifest create test 44f340f882d25deee282e2d9abede61a030a922041d03105b02c22982f1fa8d6 # podman-remote manifest add --annotation foo=bar test quay.io/libpod/testimage:20220615 44f340f882d25deee282e2d9abede61a030a922041d03105b02c22982f1fa8d6 ``` **Describe the results you received:** ``` # podman-remote manifest inspect test { &quot;schemaVersion&quot;: 2, &quot;mediaType&quot;: &quot;application/vnd.docker.distribution.manifest.list.v2+json&quot;, &quot;manifests&quot;: [ { &quot;mediaType&quot;: &quot;application/vnd.oci.image.manifest.v1+json&quot;, &quot;size&quot;: 758, &quot;digest&quot;: &quot;sha256:a07e678985cd67330fd30a4c8a008cefeb1ca917c25ab0f8468ea17c7b34beb2&quot;, &quot;platform&quot;: { &quot;architecture&quot;: &quot;amd64&quot;, &quot;os&quot;: &quot;linux&quot; } } ] } ``` **Describe the results you expected:** 1. If --annotation option isn't supported, we need to hide --annotation option from help page. 2. If --annotation option is supported, add annotations field such as below. ``` # podman-remote manifest inspect test { &quot;schemaVersion&quot;: 2, &quot;mediaType&quot;: &quot;application/vnd.docker.distribution.manifest.list.v2+json&quot;, &quot;manifests&quot;: [ { &quot;mediaType&quot;: &quot;application/vnd.oci.image.manifest.v1+json&quot;, &quot;size&quot;: 758, &quot;digest&quot;: &quot;sha256:a07e678985cd67330fd30a4c8a008cefeb1ca917c25ab0f8468ea17c7b34beb2&quot;, &quot;platform&quot;: { &quot;architecture&quot;: &quot;amd64&quot;, &quot;os&quot;: &quot;linux&quot; }, &quot;annotations&quot;: { &quot;foo&quot;: &quot;bar&quot; } } ] } ``` **Additional information you deem important (e.g. issue happens only occasionally):** Succeeded to add annotations field on local enviornment. ``` # podman manifest inspect test { &quot;schemaVersion&quot;: 2, &quot;mediaType&quot;: &quot;application/vnd.docker.distribution.manifest.list.v2+json&quot;, &quot;manifests&quot;: [ { &quot;mediaType&quot;: &quot;application/vnd.oci.image.manifest.v1+json&quot;, &quot;size&quot;: 758, &quot;digest&quot;: &quot;sha256:a07e678985cd67330fd30a4c8a008cefeb1ca917c25ab0f8468ea17c7b34beb2&quot;, &quot;platform&quot;: { &quot;architecture&quot;: &quot;amd64&quot;, &quot;os&quot;: &quot;linux&quot; }, &quot;annotations&quot;: { &quot;foo&quot;: &quot;bar&quot; } } ] } ``` &lt;details&gt; &lt;summary&gt;podman-remote version&lt;/summary&gt; ``` Client: Podman Engine Version: 4.3.0-dev API Version: 4.3.0-dev Go Version: go1.18.3 Git Commit: 98e26278844506e64e311810f97bffcc7efc0b8a Built: Tue Sep 27 13:55:08 2022 OS/Arch: linux/amd64 Server: Podman Engine Version: 4.3.0-dev API Version: 4.3.0-dev Go Version: go1.18.3 Git Commit: 98e26278844506e64e311810f97bffcc7efc0b8a Built: Tue Sep 27 13:54:58 2022 OS/Arch: linux/amd64 ``` &lt;/details&gt; &lt;details&gt; &lt;summary&gt;podman-remote info&lt;/summary&gt; ``` host: arch: amd64 buildahVersion: 1.28.0-dev cgroupControllers: - cpuset - cpu - io - memory - hugetlb - pids - misc cgroupManager: systemd cgroupVersion: v2 conmon: package: conmon-2.1.0-2.fc36.x86_64 path: /usr/bin/conmon version: 'conmon version 2.1.0, commit: ' cpuUtilization: idlePercent: 99.98 systemPercent: 0.01 userPercent: 0.01 cpus: 12 distribution: distribution: fedora variant: server version: &quot;36&quot; eventLogger: journald hostname: fedora36 idMappings: gidmap: null uidmap: null kernel: 5.18.11-200.fc36.x86_64 linkmode: dynamic logDriver: journald memFree: 6005047296 memTotal: 8326590464 networkBackend: netavark ociRuntime: name: crun package: crun-1.5-1.fc36.x86_64 path: /usr/bin/crun version: |- crun version 1.5 commit: 54ebb8ca8bf7e6ddae2eb919f5b82d1d96863dea spec: 1.0.0 +SYSTEMD +SELINUX +APPARMOR +CAP +SECCOMP +EBPF +CRIU +YAJL os: linux remoteSocket: exists: true path: unix:///run/podman/podman.sock security: apparmorEnabled: false capabilities: CAP_CHOWN,CAP_DAC_OVERRIDE,CAP_FOWNER,CAP_FSETID,CAP_KILL,CAP_NET_BIND_SERVICE,CAP_SETFCAP,CAP_SETGID,CAP_SETPCAP,CAP_SETUID,CAP_SYS_CHROOT rootless: false seccompEnabled: true seccompProfilePath: /usr/share/containers/seccomp.json selinuxEnabled: true serviceIsRemote: true slirp4netns: executable: /usr/bin/slirp4netns package: slirp4netns-1.2.0-0.2.beta.0.fc36.x86_64 version: |- slirp4netns version 1.2.0-beta.0 commit: 477db14a24ff1a3de3a705e51ca2c4c1fe3dda64 libslirp: 4.6.1 SLIRP_CONFIG_VERSION_MAX: 3 libseccomp: 2.5.3 swapFree: 8325689344 swapTotal: 8325689344 uptime: 124h 49m 14.00s (Approximately 5.17 days) plugins: authorization: null log: - k8s-file - none - passthrough - journald network: - bridge - macvlan volume: - local registries: search: - registry.fedoraproject.org - registry.access.redhat.com - docker.io - quay.io store: configFile: /usr/share/containers/storage.conf containerStore: number: 0 paused: 0 running: 0 stopped: 0 graphDriverName: overlay graphOptions: overlay.mountopt: nodev,metacopy=on graphRoot: /var/lib/containers/storage graphRootAllocated: 106285760512 graphRootUsed: 19557855232 graphStatus: Backing Filesystem: xfs Native Overlay Diff: &quot;false&quot; Supports d_type: &quot;true&quot; Using metacopy: &quot;true&quot; imageCopyTmpDir: /var/tmp imageStore: number: 1 runRoot: /run/containers/storage volumePath: /var/lib/containers/storage/volumes version: APIVersion: 4.3.0-dev Built: 1664254498 BuiltTime: Tue Sep 27 13:54:58 2022 GitCommit: 98e26278844506e64e311810f97bffcc7efc0b8a GoVersion: go1.18.3 Os: linux OsArch: linux/amd64 Version: 4.3.0-dev ``` &lt;/details&gt; **Have you tested with the latest version of Podman and have you checked the Podman Troubleshooting Guide? (https://github.com/containers/podman/blob/main/troubleshooting.md)** Yes **Additional environment details (AWS, VirtualBox, physical, etc.):** KVM, fedora36</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>2</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #15917 from cevich/check_new_go_code [CI:BUILD] Check new go code</MESSAGE>
    <SHA>b7eee0b2ce1eb19804ebed6184d0ad2a4bd91fb9</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>remote: fix manifest add --annotation * `manifest add --annotation option` adds annotations field on remote environment. * `manifest inspect` prints annotations field on remote environment. Fixes: #15952 Signed-off-by: Toshiki Sonoda &lt;sonoda.toshiki@fujitsu.com&gt;</MESSAGE>
      <SHA>32f54a81ed797597827123b671b6e73194354327</SHA>
      <PATCHEDFILES>
        <FILE>pkg/api/handlers/libpod/manifests.go</FILE>
        <FILE>pkg/bindings/manifests/manifests.go</FILE>
        <FILE>pkg/bindings/manifests/types.go</FILE>
        <FILE>pkg/bindings/manifests/types_add_options.go</FILE>
        <FILE>pkg/bindings/manifests/types_modify_options.go</FILE>
        <FILE>pkg/domain/entities/manifest.go</FILE>
        <FILE>pkg/domain/infra/tunnel/manifest.go</FILE>
        <FILE>test/e2e/manifest_test.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>remote: fix manifest add --annotation * `manifest add --annotation option` adds annotations field on remote environment. * `manifest inspect` prints annotations field on remote environment. Fixes: #15952 Signed-off-by: Toshiki Sonoda &lt;sonoda.toshiki@fujitsu.com&gt;</MESSAGE>
      <SHA>f807b6784f37799778c6646eb924f31a3b7dfa3a</SHA>
      <PATCHEDFILES>
        <FILE>pkg/api/handlers/libpod/manifests.go</FILE>
        <FILE>pkg/bindings/manifests/manifests.go</FILE>
        <FILE>pkg/domain/entities/manifest.go</FILE>
        <FILE>pkg/domain/infra/abi/manifest.go</FILE>
        <FILE>pkg/domain/infra/tunnel/manifest.go</FILE>
        <FILE>test/apiv2/15-manifest.at</FILE>
        <FILE>test/e2e/manifest_test.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
