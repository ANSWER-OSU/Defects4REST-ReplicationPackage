<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>25414</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/25414</ISSUEURL>
  <TITLE>CI: remote buildah bud flake: bud-with-mount-cache-like-buildkit</TITLE>
  <DESCRIPTION>I have seen this a few times in the past few days ``` not ok 379 bud-with-mount-cache-like-buildkit # (from function `assert' in file tests/[helpers.bash, line 578](https://github.com/containers/podman/blob/e8fc1e679a9d13aa1c9874d4868d9ed3e564e307/test/system/helpers.bash#L578), # from function `expect_output' in file tests/[helpers.bash, line 605](https://github.com/containers/podman/blob/e8fc1e679a9d13aa1c9874d4868d9ed3e564e307/test/system/helpers.bash#L605), # in test file tests/[bud.bats, line 6762](https://github.com/containers/podman/blob/e8fc1e679a9d13aa1c9874d4868d9ed3e564e307/test/system/bud.bats#L6762)) # `expect_output --substring &quot;hello&quot;' failed # /var/tmp/go/src/github.com/containers/podman/test-buildah-v1.39.1/tests /var/tmp/go/src/github.com/containers/podman/test-buildah-v1.39.1 # # podman --root /var/tmp/buildah_tests.rx8yaw/root --runroot /var/tmp/buildah_tests.rx8yaw/runroot --storage-driver vfs --registries-conf /var/tmp/go/src/github.com/containers/podman/test-buildah-v1.39.1/tests/registries.conf system service [...] unix:///run/podman/podman-379.sock # # [checking for: docker.io/library/alpine] # # [restoring from cache: /var/tmp/bats-run-ohJTlp/suite/buildah-image-cache / docker.io/library/alpine] # Getting image source signatures # Copying blob sha256:9d16cba9fb961d1aafec9542f2bf7cb64acfc55245f9e4eb5abecd4cdc38d749 # Copying config sha256:961769676411f082461f9ef46626dd7a2d1e2b2a38e6a44364bcbecf51e66dd4 # Writing manifest to image destination # # podman-remote build --force-rm=false --layers=false -t testbud --signature-policy /var/tmp/go/src/github.com/containers/podman/test-buildah-v1.39.1/tests/policy.json -f /var/tmp/buildah_tests.rx8yaw/buildkit-mount/Dockerfilecachewrite # STEP 1/3: FROM alpine # STEP 2/3: RUN mkdir /test # STEP 3/3: RUN --mount=type=cache,target=/test,z echo hello &gt; /test/world # COMMIT testbud # Getting image source signatures # Copying blob sha256:03901b4a2ea88eeaad62dbe59b072b28b6efa00491962b8741081c5df50c65e0 # Copying blob sha256:aa1f7b673e85ceda43f632fbdf22dfa24606d46b0f463d09e33c413f8d902856 # Copying config sha256:f306c98a9e850b7ab37b51a97fdf396a565220c7d6c3d70579604f97c13c1556 # Writing manifest to image destination # --&gt; f306c98a9e85 # Successfully tagged localhost/testbud:latest # f306c98a9e850b7ab37b51a97fdf396a565220c7d6c3d70579604f97c13c1556 # # podman-remote build --force-rm=false --layers=false -t testbud2 --signature-policy /var/tmp/go/src/github.com/containers/podman/test-buildah-v1.39.1/tests/policy.json -f /var/tmp/buildah_tests.rx8yaw/buildkit-mount/Dockerfilecacheread # STEP 1/3: FROM alpine # STEP 2/3: RUN mkdir /test # STEP 3/3: RUN --mount=type=cache,target=/test,z cat /test/world # world # COMMIT testbud2 # Getting image source signatures # Copying blob sha256:03901b4a2ea88eeaad62dbe59b072b28b6efa00491962b8741081c5df50c65e0 # Copying blob sha256:1fd84a4521c521bb77975e7ab2a6e76112b53f324d1116f35c06f58fd624aca9 # Copying config sha256:f3a381b03bdf0ef65da6c59393837e1ce842d83b923699e7c4a82612b1b8d921 # Writing manifest to image destination # --&gt; f3a381b03bdf # Successfully tagged localhost/testbud2:latest # f3a381b03bdf0ef65da6c59393837e1ce842d83b923699e7c4a82612b1b8d921 # #/vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv # #| FAIL: podman-remote build --force-rm=false --layers=false -t testbud2 --signature-policy /var/tmp/go/src/github.com/containers/podman/test-buildah-v1.39.1/tests/policy.json -f /var/tmp/buildah_tests.rx8yaw/buildkit-mount/Dockerfilecacheread # #| expected: =~ 'hello' # #| actual: 'STEP 1/3: FROM alpine' # #| &gt; 'STEP 2/3: RUN mkdir /test' # #| &gt; 'STEP 3/3: RUN --mount=type=cache,target=/test,z cat /test/world' # #| &gt; 'world' # #| &gt; 'COMMIT testbud2' # #| &gt; 'Getting image source signatures' # #| &gt; 'Copying blob sha256:03901b4a2ea88eeaad62dbe59b072b28b6efa00491962b8741081c5df50c65e0' # #| &gt; 'Copying blob sha256:1fd84a4521c521bb77975e7ab2a6e76112b53f324d1116f35c06f58fd624aca9' # #| &gt; 'Copying config sha256:f3a381b03bdf0ef65da6c59393837e1ce842d83b923699e7c4a82612b1b8d921' # #| &gt; 'Writing manifest to image destination' # #| &gt; '--&gt; f3a381b03bdf' # #| &gt; 'Successfully tagged localhost/testbud2:latest' # #| &gt; 'f3a381b03bdf0ef65da6c59393837e1ce842d83b923699e7c4a82612b1b8d921' # #\^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ # teardown: stopping podman server 162470 # /var/tmp/go/src/github.com/containers/podman/test-buildah-v1.39.1 ``` Only when running through podman-remote though so likely a podman problem and no buildah. example logs: https://api.cirrus-ci.com/v1/artifact/task/6045792848314368/html/bud-remote-fedora-41-root-host-sqlite.log.html https://api.cirrus-ci.com/v1/artifact/task/4936405345894400/html/bud-remote-fedora-41-root-host-sqlite.log.html</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>25</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #25665 from Honny1/health-timeout-note Clarify behavior of --health-timeout in man page</MESSAGE>
    <SHA>49b756e063f85393d4ce4186f6f1159eae5a77ea</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>buildah-bud: skip bud-with-mount-cache-like-buildkit Following test needs unique cache in TMPDIR so cache of this test does not conflicts with other tests however for this specific test there is no convenient way to pass custom TMPDIR. Skipping this test similar to this already exists in tests/bud.bats but covers `--mount=type=cache,sharing=locked` Read more discussion here: https://github.com/containers/podman/issues/25414 Closes: https://github.com/containers/podman/issues/25414 Signed-off-by: flouthoc &lt;flouthoc.git@gmail.com&gt;</MESSAGE>
      <SHA>8040934bb435ffe58467a76e3c5ed4ea9d9e80d7</SHA>
      <PATCHEDFILES>
        <FILE>test/buildah-bud/apply-podman-deltas</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>buildah-bud: skip bud-with-mount-cache-like-buildkit Following test needs unique cache in TMPDIR so cache of this test does not conflicts with other tests however for this specific test there is no convenient way to pass custom TMPDIR. Skipping this test similar to this already exists in tests/bud.bats but covers `--mount=type=cache,sharing=locked` Read more discussion here: https://github.com/containers/podman/issues/25414 Closes: https://github.com/containers/podman/issues/25414 Signed-off-by: flouthoc &lt;flouthoc.git@gmail.com&gt;</MESSAGE>
      <SHA>7ca96702ee87f392cd49e03606c02a1909b98a91</SHA>
      <PATCHEDFILES>
        <FILE>test/buildah-bud/apply-podman-deltas</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
