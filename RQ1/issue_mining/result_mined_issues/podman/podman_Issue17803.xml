<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>17803</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/17803</ISSUEURL>
  <TITLE>kube play --wait test: looks like a race</TITLE>
  <DESCRIPTION>``` [+1250s] not ok 536 podman kube play --wait - wait for pod to exit ... # podman-remote --url unix:/tmp/podman_tmp_2V6q kube play --wait /tmp/play_kube_wait_j4WBda.yaml Use ctrl+c to clean up or wait for pods to exit Pod: 993d1e21bffa86e1c259ef3573ac8c8ada8f9ca1543f1e62af8bab308a90013b Container: df47ee2ab1c3beea09bdeae68fe10acdcb55fb979c6307c27731591a0804a684 Cleaning up containers, pods, and volumes... Pods stopped: 993d1e21bffa86e1c259ef3573ac8c8ada8f9ca1543f1e62af8bab308a90013b Pods removed: 993d1e21bffa86e1c259ef3573ac8c8ada8f9ca1543f1e62af8bab308a90013b Secrets removed: Volumes removed: # podman-remote --url unix:/tmp/podman_tmp_2V6q ps -aq bc8ea17032f9 #/vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv #| FAIL: There should be no containers #| expected: '[no output]' #| actual: 'bc8ea17032f9' #\^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ ``` Seen twice in two days, both in remote f37 aarch64 root: * [first](https://api.cirrus-ci.com/v1/artifact/task/4801092333076480/html/sys-remote-fedora-37-aarch64-root-host.log.html#t--00536) and * [second (just now)](https://api.cirrus-ci.com/v1/artifact/task/6006758338985984/html/sys-remote-fedora-37-aarch64-root-host.log.html)</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>23</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #18069 from cevich/fix_build_aarch64_dep Cirrus: Fix aarch64 clone_script 404 errors</MESSAGE>
    <SHA>19463738c2f4512e118c4a12c6422a66537a6edb</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>e2e tests: fix racy flakes ...mostly just test code that wasn't doing the required waits. My first approach in the kube-play test was to add &quot;--wait&quot;. Bit mistake! The --wait flag, counterintuitively and counter to documentation, actually destroys all pods+containers+everything on exit. (Or tries -- see #17803). Since this violates POLA and is undocumented, I include here a fix to the man page. Despite my best intentions, I can't reasonably check every single test for missing waits, especially in kube-play where failing containers will get retried forever so we can't wait. We'll just have to fix flakes as we see them. Fixes: #17958 Fixes: #18071 Signed-off-by: Ed Santiago &lt;santiago@redhat.com&gt;</MESSAGE>
      <SHA>761eca9e75dd8366ed71ca2162712681419b66ef</SHA>
      <PATCHEDFILES>
        <FILE>docs/source/markdown/podman-kube-play.1.md.in</FILE>
        <FILE>test/e2e/logs_test.go</FILE>
        <FILE>test/e2e/play_kube_test.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
