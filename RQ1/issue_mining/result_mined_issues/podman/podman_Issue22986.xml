<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>22986</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/22986</ISSUEURL>
  <TITLE>remote: pod top -eo invalid: unmarshalling error</TITLE>
  <DESCRIPTION>```console $ bin/podman-remote run -d --pod new:foo quay.io/libpod/testimage:20240123 top b829985a6ffa9e8aa35114e48e44e1814469ddf8a801bc77bc3141d7c1065e47 $ bin/podman-remote pod top foo -eo bar Error: unmarshalling into &amp;handlers.PodTopOKBody{ContainerTopOKBody:container.ContainerTopOKBody{Processes:[][]string(nil), Titles:[]string(nil)}}, data &quot;&quot;: unexpected end of JSON input ```</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>11</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>libpod API: return proper error status code for pod start When we failed to do anything we should return 500, the 409 code has a special meaing to the client as it uses a different error format. As such the remote client was not able to unmarshal the error correctly and just returned an empty string. Fixes #22989 Signed-off-by: Paul Holzinger &lt;pholzing@redhat.com&gt;</MESSAGE>
    <SHA>29ecf5984c33c700a7c31beb3c0911d9bc7f3ca6</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>remote API: fix pod top error reporting Do not return 200 status code before we know if there will be an error. Delay writing the status code until we send the first response. That way we can set an error code inside the loop when we get a error on the first try, i.e. because an invalid descriptor was used. Fixes #22986 Signed-off-by: Paul Holzinger &lt;pholzing@redhat.com&gt;</MESSAGE>
      <SHA>e404976d1b6b8a51bf14760064b9e752178c1ea0</SHA>
      <PATCHEDFILES>
        <FILE>pkg/api/handlers/libpod/pods.go</FILE>
        <FILE>test/e2e/pod_top_test.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>remote API: fix pod top error reporting Do not return 200 status code before we know if there will be an error. Delay writing the status code until we send the first response. That way we can set an error code inside the loop when we get a error on the first try, i.e. because an invalid descriptor was used. Fixes #22986 Signed-off-by: Paul Holzinger &lt;pholzing@redhat.com&gt; &lt;MH: Fixed conflict in tests&gt; Signed-off-by: Matt Heon &lt;mheon@redhat.com&gt;</MESSAGE>
      <SHA>e2518503ee123aa14bfdd2392c5c58b73a079655</SHA>
      <PATCHEDFILES>
        <FILE>pkg/api/handlers/libpod/pods.go</FILE>
        <FILE>test/e2e/pod_top_test.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
