<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>14674</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/14674</ISSUEURL>
  <TITLE>discrepancy in podman network inspect for netmask (compat API)</TITLE>
  <DESCRIPTION>&lt;!-- --------------------------------------------------- BUG REPORT INFORMATION --------------------------------------------------- Use the commands below to provide key information from your environment: You do NOT have to include this information if this is a FEATURE REQUEST **NOTE** A large number of issues reported against Podman are often found to already be fixed in more current versions of the project. Before reporting an issue, please verify the version you are running with `podman version` and compare it to the latest release documented on the top of Podman's [README.md](../README.md). If they differ, please update your version of Podman to the latest possible and retry your command before creating an issue. Also, there is a running list of known issues in the [Podman Troubleshooting Guide](https://github.com/containers/podman/blob/main/troubleshooting.md), please reference that page before opening a new issue. If you are filing a bug against `podman build`, please instead file a bug against Buildah (https://github.com/containers/buildah/issues). Podman build executes Buildah to perform container builds, and as such the Buildah maintainers are best equipped to handle these bugs. --&gt; **Is this a BUG REPORT or FEATURE REQUEST? (leave only one on its own line)** /kind bug **Description** podman main: The netmask of secondaryIPAddresses/SecondaryIPv6Addresses in container network inspect compat API is always zero. podman v3: Wrong type used for secondaryIPAddresses/SecondaryIPv6Addresses (string instead of network.Address) results in broken container inspect compat API in presence of secondary network interfaces. **Steps to reproduce the issue:** Reproduction in **main** branch 1. create a named network namespace and setup two veth interface ``` ip netns add test ip netns exec test /bin/bash ip link add enp2s0 type veth peer name eth0 ip addr add 10.0.1.0/24 dev eth0 ip link set eth0 up ip link add enp2s1 type veth peer name eth1 ip addr add 10.0.2.0/24 dev eth1 ip link set eth1 up exit ``` 2. run a container and join the created network namespace ``` podman run --net ns:/run/netns/test --name test -it alpine /bin/sh ``` 3. start a podman service ``` podman system service tcp:localhost:20000 --log-level=debug --time=0 ``` 4. Check output of podman inspect test ``` curl -X GET 'http://127.0.0.1:20000/v3.0.0/containers/test/json'| jq ``` **Describe the results you received:** PrefixLen is **0** ``` &quot;NetworkSettings&quot;: { &quot;Bridge&quot;: &quot;&quot;, &quot;SandboxID&quot;: &quot;&quot;, &quot;HairpinMode&quot;: false, &quot;LinkLocalIPv6Address&quot;: &quot;&quot;, &quot;LinkLocalIPv6PrefixLen&quot;: 0, &quot;Ports&quot;: {}, &quot;SandboxKey&quot;: &quot;&quot;, &quot;SecondaryIPAddresses&quot;: [ { &quot;Addr&quot;: &quot;10.0.2.0&quot;, &quot;PrefixLen&quot;: 0 } ``` **Describe the results you expected:** PrefixLen should be **24** **Output of `podman version`:** ``` podman version 4.0.0-dev ``` **Output of `podman info --debug`:** ``` host: arch: amd64 buildahVersion: 1.24.1 cgroupControllers: - cpuset - cpu - cpuacct - blkio - memory - devices - freezer - net_cls - perf_event - net_prio - pids cgroupManager: systemd cgroupVersion: v1 conmon: package: conmon-2.0.27+git0+3efab3e71c-r0.core2_64 path: /usr/bin/conmon version: 'conmon version 2.0.28-dev, commit: 3efab3e71c4c29f127cd7b8e8a5a885fc17dec88' cpus: 6 distribution: distribution: mbient version: &quot;1.0&quot; eventLogger: journald hostname: qemux86-64 idMappings: gidmap: null uidmap: null kernel: 5.10.30-yocto-standard linkmode: dynamic logDriver: journald memFree: 7883513856 memTotal: 22187085824 networkBackend: cni ociRuntime: name: crun package: crun-0.18+gitf302dd8c02c6fddd2c50d1685d82b7a19aae8afe-r0.core2_64 path: /usr/bin/crun version: |- crun version 0.19.5-f302-dirty commit: f302dd8c02c6fddd2c50d1685d82b7a19aae8afe spec: 1.0.0 +SYSTEMD +SELINUX +APPARMOR +CAP +SECCOMP +EBPF +YAJL os: linux remoteSocket: path: /run/podman/podman.sock security: apparmorEnabled: true capabilities: CAP_AUDIT_WRITE,CAP_CHOWN,CAP_DAC_OVERRIDE,CAP_FOWNER,CAP_FSETID,CAP_KILL,CAP_MKNOD,CAP_NET_BIND_SERVICE,CAP_NET_RAW,CAP_SETFCAP,CAP_SETGID,CAP_SETPCAP,CAP_SETUID,CAP_SYS_CHROOT rootless: false seccompEnabled: true seccompProfilePath: &quot;&quot; selinuxEnabled: false serviceIsRemote: false slirp4netns: executable: /usr/bin/slirp4netns package: slirp4netns-0.4.1-r0.core2_64 version: |- slirp4netns version 0.4.1 commit: unknown swapFree: 46133248 swapTotal: 46133248 uptime: 6h 6m 42.11s (Approximately 0.25 days) plugins: log: - k8s-file - none - passthrough - journald network: - bridge - macvlan - ipvlan volume: - local registries: search: - docker.io - registry.fedoraproject.org - quay.io - registry.access.redhat.com - registry.centos.org store: configFile: /etc/containers/storage.conf containerStore: number: 6 paused: 0 running: 3 stopped: 3 graphDriverName: overlay graphOptions: overlay.mountopt: nodev graphRoot: /mnt/systemdata/dynamic-contents/podman graphStatus: Backing Filesystem: extfs Native Overlay Diff: &quot;true&quot; Supports d_type: &quot;true&quot; Using metacopy: &quot;false&quot; imageCopyTmpDir: /var/tmp imageStore: number: 2 runRoot: /var/run/containers/storage volumePath: /mnt/systemdata/dynamic-contents/podman/volumes version: APIVersion: 4.0.0-dev Built: 1655756421 BuiltTime: Mon Jun 20 22:20:21 2022 GitCommit: 192dea7d981443a8091596eb91e6c4274b8a6f85 GoVersion: go1.18.3 OsArch: linux/amd64 Version: 4.0.0-dev ``` **Have you tested with the latest version of Podman and have you checked the Podman Troubleshooting Guide? (https://github.com/containers/podman/blob/main/troubleshooting.md)** Yes ```</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>16</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Bump to v3.4.4 Signed-off-by: Matthew Heon &lt;mheon@redhat.com&gt;</MESSAGE>
    <SHA>f6526ada1025c2e3f88745ba83b8b461ca659933</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fix network inspect of docker compat API Fix type mismatch of SecondaryIPAddresses in network inspect Closes: containers#14674 Signed-off-by: Mostafa Emami &lt;mustafaemami@gmail.com&gt;</MESSAGE>
      <SHA>9e55389dd18a043a2eb322e2b8d6c5028bc02298</SHA>
      <PATCHEDFILES>
        <FILE>libpod/define/container_inspect.go</FILE>
        <FILE>libpod/networking_linux.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fix network inspect compat API discrepancy - containerInspect compat API expects field value PrefixLen instead of PrefixLength for type Address for SecondaryIPAddresses - Add tests for network part of containerInspect compat api Closes: containers#14674 Signed-off-by: Mostafa Emami &lt;mustafaemami@gmail.com&gt;</MESSAGE>
      <SHA>ee05bc031882cd47cf402f55e1bfefbe83ecb3c0</SHA>
      <PATCHEDFILES>
        <FILE>pkg/api/handlers/compat/containers.go</FILE>
        <FILE>test/apiv2/python/rest_api/fixtures/api_testcase.py</FILE>
        <FILE>test/apiv2/python/rest_api/test_v2_0_0_container.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
