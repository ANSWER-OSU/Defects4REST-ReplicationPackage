<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>14763</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/14763</ISSUEURL>
  <TITLE>podman manifest rm gives the error &quot;tag not known&quot; even though inspect works</TITLE>
  <DESCRIPTION>**Is this a BUG REPORT or FEATURE REQUEST? (leave only one on its own line)** /kind bug **Description** Using podman 4.1.1 on macOS, I built a manifest list and I can inspect it, but trying to `podman manifest rm` it gives the error, &quot;tag not known&quot;. **Steps to reproduce the issue:** 1. `git clone https://github.com/IBM/containerdiag &amp;&amp; cd containerdiag` 2. `podman build --platform linux/amd64,linux/arm64 --manifest localhost/containerdiag:testmanifest .` 3. Inspecting and listing works fine: ``` $ podman manifest inspect localhost/containerdiag:testmanifest { &quot;schemaVersion&quot;: 2, &quot;mediaType&quot;: &quot;application/vnd.docker.distribution.manifest.list.v2+json&quot;, &quot;manifests&quot;: [ { &quot;mediaType&quot;: &quot;application/vnd.oci.image.manifest.v1+json&quot;, &quot;size&quot;: 1369, &quot;digest&quot;: &quot;sha256:bf87e19b854b4bad99b21d8301415bc50e50ae89283255d99d90490de2e4f7a3&quot;, &quot;platform&quot;: { &quot;architecture&quot;: &quot;amd64&quot;, &quot;os&quot;: &quot;linux&quot; } }, { &quot;mediaType&quot;: &quot;application/vnd.oci.image.manifest.v1+json&quot;, &quot;size&quot;: 1369, &quot;digest&quot;: &quot;sha256:5726853086de6ecd541def2e445b78bc6c8916265dcf508413ee517c1f43505b&quot;, &quot;platform&quot;: { &quot;architecture&quot;: &quot;arm64&quot;, &quot;os&quot;: &quot;linux&quot; } } ] } $ podman image ls localhost/containerdiag:testmanifest REPOSITORY TAG IMAGE ID CREATED SIZE localhost/containerdiag testmanifest 044a5933fa63 2 minutes ago 2 kB ``` 4. Deleting it fails: ``` $ podman manifest rm localhost/containerdiag:testmanifest Error: localhost/containerdiag:testmanifest: tag not known ``` **Describe the results you received:** `tag not known` **Describe the results you expected:** Manifest list deleted **Additional information you deem important (e.g. issue happens only occasionally):** With `--log-level=debug`: ``` $ podman manifest rm --log-level=debug localhost/containerdiag:testmanifest INFO[0000] podman filtering at log level debug DEBU[0000] Called rm.PersistentPreRunE(podman manifest rm --log-level=debug localhost/containerdiag:testmanifest) DEBU[0000] SSH Ident Key &quot;/Users/kevin/.ssh/podman-machine-default&quot; SHA256:HDfyUZ9uekoNiwQzy/kdVhoM+enCTX5OoaT4v7e9KYc ssh-ed25519 DEBU[0000] Found SSH_AUTH_SOCK &quot;/private/tmp/com.apple.launchd.wLOpBRXGMq/Listeners&quot;, ssh-agent signer(s) enabled DEBU[0000] SSH Agent Key SHA256:7Z2VAKPt/xZjYk290LSjGhV/KeIwjk7FgqHmD+2eqjM ssh-rsa DEBU[0000] DoRequest Method: GET URI: http://d/v4.1.1/libpod/_ping DEBU[0000] DoRequest Method: DELETE URI: http://d/v4.1.1/libpod/images/remove Error: localhost/containerdiag:testmanifest: tag not known ``` **Output of `podman version`:** &lt;details&gt; &lt;summary&gt;podman version output&lt;/summary&gt; ``` $ podman version Client: Podman Engine Version: 4.1.1 API Version: 4.1.1 Go Version: go1.18.3 Built: Tue Jun 14 15:12:46 2022 OS/Arch: darwin/amd64 Server: Podman Engine Version: 4.1.0 API Version: 4.1.0 Go Version: go1.18 Built: Fri May 6 11:15:54 2022 OS/Arch: linux/amd64 ``` &lt;/details&gt; **Output of `podman info --debug`:** &lt;details&gt; &lt;summary&gt;podman info --debug output&lt;/summary&gt; ``` $ podman version Client: Podman Engine Version: 4.1.1 API Version: 4.1.1 Go Version: go1.18.3 Built: Tue Jun 14 15:12:46 2022 OS/Arch: darwin/amd64 Server: Podman Engine Version: 4.1.0 API Version: 4.1.0 Go Version: go1.18 Built: Fri May 6 11:15:54 2022 OS/Arch: linux/amd64 Kevins-MBP:containerdiag kevin$ podman info --debug host: arch: amd64 buildahVersion: 1.26.1 cgroupControllers: - cpuset - cpu - io - memory - hugetlb - pids - misc cgroupManager: systemd cgroupVersion: v2 conmon: package: conmon-2.1.0-2.fc36.x86_64 path: /usr/bin/conmon version: 'conmon version 2.1.0, commit: ' cpuUtilization: idlePercent: 98.96 systemPercent: 0.45 userPercent: 0.59 cpus: 4 distribution: distribution: fedora variant: coreos version: &quot;36&quot; eventLogger: journald hostname: localhost.localdomain idMappings: gidmap: null uidmap: null kernel: 5.17.5-300.fc36.x86_64 linkmode: dynamic logDriver: journald memFree: 5062844416 memTotal: 10431864832 networkBackend: netavark ociRuntime: name: crun package: crun-1.4.4-1.fc36.x86_64 path: /usr/bin/crun version: |- crun version 1.4.4 commit: 6521fcc5806f20f6187eb933f9f45130c86da230 spec: 1.0.0 +SYSTEMD +SELINUX +APPARMOR +CAP +SECCOMP +EBPF +CRIU +YAJL os: linux remoteSocket: exists: true path: /run/podman/podman.sock security: apparmorEnabled: false capabilities: CAP_CHOWN,CAP_DAC_OVERRIDE,CAP_FOWNER,CAP_FSETID,CAP_KILL,CAP_NET_BIND_SERVICE,CAP_SETFCAP,CAP_SETGID,CAP_SETPCAP,CAP_SETUID,CAP_SYS_CHROOT rootless: false seccompEnabled: true seccompProfilePath: /usr/share/containers/seccomp.json selinuxEnabled: true serviceIsRemote: true slirp4netns: executable: /usr/bin/slirp4netns package: slirp4netns-1.2.0-0.2.beta.0.fc36.x86_64 version: |- slirp4netns version 1.2.0-beta.0 commit: 477db14a24ff1a3de3a705e51ca2c4c1fe3dda64 libslirp: 4.6.1 SLIRP_CONFIG_VERSION_MAX: 3 libseccomp: 2.5.3 swapFree: 0 swapTotal: 0 uptime: 1h 18m 5.98s (Approximately 0.04 days) plugins: log: - k8s-file - none - passthrough - journald network: - bridge - macvlan volume: - local registries: search: - docker.io store: configFile: /usr/share/containers/storage.conf containerStore: number: 0 paused: 0 running: 0 stopped: 0 graphDriverName: overlay graphOptions: overlay.mountopt: nodev,metacopy=on graphRoot: /var/lib/containers/storage graphRootAllocated: 128300593152 graphRootUsed: 14736486400 graphStatus: Backing Filesystem: xfs Native Overlay Diff: &quot;false&quot; Supports d_type: &quot;true&quot; Using metacopy: &quot;true&quot; imageCopyTmpDir: /var/tmp imageStore: number: 128 runRoot: /run/containers/storage volumePath: /var/lib/containers/storage/volumes version: APIVersion: 4.1.0 Built: 1651853754 BuiltTime: Fri May 6 11:15:54 2022 GitCommit: &quot;&quot; GoVersion: go1.18 Os: linux OsArch: linux/amd64 Version: 4.1.0 ``` &lt;/details&gt; **Package info (e.g. output of `rpm -q podman` or `apt list podman`):** &lt;details&gt; &lt;summary&gt;brew info podman output&lt;/summary&gt; ``` $ brew info podman podman: stable 4.1.1 (bottled), HEAD Tool for managing OCI containers and pods https://podman.io/ /usr/local/Cellar/podman/4.1.1 (174 files, 47.7MB) * Poured from bottle on 2022-06-28 at 12:38:03 From: https://github.com/Homebrew/homebrew-core/blob/HEAD/Formula/podman.rb ``` &lt;/details&gt; **Have you tested with the latest version of Podman and have you checked the Podman Troubleshooting Guide? (https://github.com/containers/podman/blob/main/troubleshooting.md)** Yes **Additional environment details (AWS, VirtualBox, physical, etc.):** &lt;details&gt; &lt;summary&gt;macOS information&lt;/summary&gt; ``` $ system_profiler SPSoftwareDataType SPHardwareDataType | grep -v -e UUID -e UDID -e 'User Name' -e 'Computer Name' -e Serial Software: System Software Overview: System Version: macOS 12.4 (21F79) Kernel Version: Darwin 21.5.0 Boot Volume: MainDisk Boot Mode: Normal Secure Virtual Memory: Enabled System Integrity Protection: Disabled Time since boot: 12 days 2:24 Hardware: Hardware Overview: Model Name: MacBook Pro Model Identifier: MacBookPro15,1 Processor Name: 6-Core Intel Core i7 Processor Speed: 2.6 GHz Number of Processors: 1 Total Number of Cores: 6 L2 Cache (per Core): 256 KB L3 Cache: 9 MB Hyper-Threading Technology: Enabled Memory: 16 GB System Firmware Version: 1731.120.10.0.0 (iBridge: 19.16.15071.0.0,0) OS Loader Version: 540.120.3~6 Activation Lock Status: Enabled ``` &lt;/details&gt;</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>1</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #14770 from containers/dependabot/go_modules/github.com/stretchr/testify-1.8.0 build(deps): bump github.com/stretchr/testify from 1.7.5 to 1.8.0</MESSAGE>
    <SHA>3426d56b92be2ac1c3cc62fc578e9cb6d64aca81</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>api,images: add support for LookupManifest to Image remove API ImagesBatchRemoval and ImageRemoval now honors and accepts `LookupManifest` parameter which further tells libimage to resolve to manifest list if it exists instead of actual image. Following PR also makes `podman-remote manifest rm` functional which was broken till now. Closes: https://github.com/containers/podman/issues/14763 Signed-off-by: Aditya R &lt;arajan@redhat.com&gt;</MESSAGE>
      <SHA>7bbfb3eb0d9c711332b5d96963bbc8db28bf6115</SHA>
      <PATCHEDFILES>
        <FILE>pkg/api/handlers/libpod/images.go</FILE>
        <FILE>pkg/api/server/register_images.go</FILE>
        <FILE>pkg/bindings/images/types.go</FILE>
        <FILE>pkg/bindings/images/types_remove_options.go</FILE>
        <FILE>pkg/domain/infra/tunnel/images.go</FILE>
        <FILE>test/e2e/manifest_test.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
