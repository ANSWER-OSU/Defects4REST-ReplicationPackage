<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>17607</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/17607</ISSUEURL>
  <TITLE>auto-update: test getting &quot;rolled back&quot; instead of &quot;true&quot;</TITLE>
  <DESCRIPTION>``` not ok 346 podman auto-update - label io.containers.autoupdate=local ... # podman auto-update --format {{.Unit}},{{.Image}},{{.Updated}},{{.Policy}} container-c_local_SOwgTtVbcL.service,quay.io/libpod/localtest:latest,rolled back,local #/vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv #| FAIL: Image is updated. #| expected: '.*container-c_local_SOwgTtVbcL.service,quay.io/libpod/localtest:latest,true,local.*' (using expr) #| actual: 'container-c_local_SOwgTtVbcL.service,quay.io/libpod/localtest:latest,rolled back,local' #\^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ ^^^^^^^^^^^----- this is the diff ``` Debian-only so far, and [only one logged instance](https://api.cirrus-ci.com/v1/artifact/task/6064714845782016/html/sys-podman-debian-12-root-host.log.html#t--00346), but I saw this one twice (in non-preserved logs) while reviewing #17305. This is going to start hitting us hard now that Debian is live.</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>34</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #17656 from ygalblum/quadlet-container-mount Quadlet: Add support for the Mount key in .container files</MESSAGE>
    <SHA>3cab05aa3ebd32c3116b630b64be192c2d2ea72d</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>auto-update test: wait for service to be ready The symptoms in #17607 point to some race since it does not always flake on Debian (and Debian only). Hence, wait for the service to be ready before building the image to make sure that the service is started with the old image and that everything's in order. Fixes: #17607 Signed-off-by: Valentin Rothberg &lt;vrothberg@redhat.com&gt;</MESSAGE>
      <SHA>b727f30ac686c575718006cac16682966a1c1689</SHA>
      <PATCHEDFILES>
        <FILE>test/system/255-auto-update.bats</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>255-auto-update.bats: turn off rollback where needed To help debug #17607, turn off rollbacks for tests that do not require rollbacks. Error when restarting the systemd units are then not suppressed but returned which should give us more information about what is going on the Debian systems. Signed-off-by: Valentin Rothberg &lt;vrothberg@redhat.com&gt;</MESSAGE>
      <SHA>40d0d233eb970647918b0f51e5a236c3b24ac4ef</SHA>
      <PATCHEDFILES>
        <FILE>test/system/255-auto-update.bats</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>test/system/255-auto-update.bats: multiple services Wait for all generated services to be ready to be sure we can iron out race conditions. Also disable rollbacks to make sure we can analyze the error if restarting a service fails. This information may be crucial to understand the flakes on Debian as tracked in #17607. Signed-off-by: Valentin Rothberg &lt;vrothberg@redhat.com&gt;</MESSAGE>
      <SHA>7a7af735ade0fc12ff413e2724ea4006d4c09691</SHA>
      <PATCHEDFILES>
        <FILE>test/system/255-auto-update.bats</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Merge pull request #17770 from vrothberg/debug-17607 auto update system tests: help debug #17607</MESSAGE>
      <SHA>c4c0793d2172193dd5a43c28b07ebc50a05bed2d</SHA>
      <PATCHEDFILES>
        <FILE>test/system/255-auto-update.bats</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>auto update: return restart error Return the error when restarting the unit failed during an update. The task is correctly marked to have failed but we really need to return the error to the user. [NO NEW TESTS NEEDED] - The flakes in #17607 will reveal errors. Signed-off-by: Valentin Rothberg &lt;vrothberg@redhat.com&gt;</MESSAGE>
      <SHA>3c51b61d766dc6718b62de4906acc21efad57856</SHA>
      <PATCHEDFILES>
        <FILE>pkg/autoupdate/autoupdate.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
