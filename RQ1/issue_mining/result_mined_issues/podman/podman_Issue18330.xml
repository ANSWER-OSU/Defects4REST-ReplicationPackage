<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>18330</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/18330</ISSUEURL>
  <TITLE>`podman machine rm` for QEMU provider removed connections before confirmation</TITLE>
  <DESCRIPTION>### Issue Description After calling `podman machine rm` and pressing `n` to abort, the machine is not functional as connections are erased. Confirmed for QEMU on Windows and macOS. The code part causing this is https://github.com/containers/podman/blob/main/pkg/machine/qemu/machine.go#L960 which is immediate, but should go inside callback https://github.com/containers/podman/blob/main/pkg/machine/qemu/machine.go#L992 (like in WSL implementation). WSL implementation is not affected. ### Steps to reproduce the issue Steps to reproduce the issue 1. `podman machine init` 2. `podman machine rm` 3. press `n` 4. `podman system connection list` (no connections) 5. `podman machine list` (machine still exists) ### Describe the results you received Connections are erased. ### Describe the results you expected Connections persisted like in WSL case on Widnows ### podman info output ```yaml Intentionally skipped as machine was already ruined. ``` ### Podman in a container No ### Privileged Or Rootless None ### Upstream Latest Release Yes ### Additional environment details On Windows was tested with built from latest main + QEMU machine supporting changes on top. ### Additional information _No response_</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>6</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #18342 from edsantiago/aardvarks_are_slow Netavark userns test: give aardvark time to come up</MESSAGE>
    <SHA>846e7aa21bc747240d6f70543adca85520f75ef7</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>machine: qemu only remove connection after confirmation the connection remove call must be done inside the function that is returned so that we wait until the user confirmed it. Fixes #18330 Signed-off-by: Paul Holzinger &lt;pholzing@redhat.com&gt;</MESSAGE>
      <SHA>2296e71e39a86615b28ae2de8df60e7d4870e722</SHA>
      <PATCHEDFILES>
        <FILE>pkg/machine/qemu/machine.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>machine: qemu only remove connection after confirmation the connection remove call must be done inside the function that is returned so that we wait until the user confirmed it. Fixes #18330 Signed-off-by: Paul Holzinger &lt;pholzing@redhat.com&gt;</MESSAGE>
      <SHA>dc21698d60edf52df1af38c84c488a8ea3328542</SHA>
      <PATCHEDFILES>
        <FILE>pkg/machine/qemu/machine.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
