<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>20196</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/20196</ISSUEURL>
  <TITLE>StopSignal SIGTERM failed to stop container in 10 seconds</TITLE>
  <DESCRIPTION>Weird new flake, where &quot;new&quot; means &quot;since ExitCleanly() started checking stderr&quot;: ``` # podman [options] run --http-proxy=false -d quay.io/libpod/alpine:latest top 89a002f65e0abc37edb7dd74e7402aa5d3c8e44b348be9b8173b0b4b62c84e7e # podman [options] stop --ignore foobar 89a002f65e0abc37edb7dd74e7402aa5d3c8e44b348be9b8173b0b4b62c84e7e time=&quot;2023-09-28T10:44:05-05:00&quot; level=warning msg=&quot;StopSignal SIGTERM failed to stop container lucid_dubinsky in 10 seconds, resorting to SIGKILL&quot; ``` Happens almost exclusively in this one test. (The other one, the &quot;pod something&quot;, is probably because entrypoint defaults to `sh`. Probably.). This shouldn't happen, because `top` is quick to exit upon signal. And okay, maybe not always, maybe 2-3 seconds, but ten?? I've tried reproducing, with no luck: ```console $ while :;do cid=$(bin/podman --events-backend=file run --http-proxy=false -d quay.io/libpod/alpine:latest top);bin/podman stop --ignore foobar $cid;bin/podman rm $cid;done ``` Anything obvious I've missed? * fedora-37 : int podman fedora-37 rootless host sqlite * [09-22 12:10](https://api.cirrus-ci.com/v1/artifact/task/4593042863161344/html/int-podman-fedora-37-rootless-host-sqlite.log.html#t--Podman-stop-podman-stop-ignore-bogus-container--1) in Podman stop podman stop --ignore bogus container * fedora-38 : int podman fedora-38 root host sqlite * [09-28 12:00](https://api.cirrus-ci.com/v1/artifact/task/5836341863251968/html/int-podman-fedora-38-root-host-sqlite.log.html#t--Podman-stop-podman-stop-ignore-bogus-container--1) in Podman stop podman stop --ignore bogus container * fedora-39 : int podman fedora-39 root host sqlite * [09-27 21:49](https://api.cirrus-ci.com/v1/artifact/task/6533378279735296/html/int-podman-fedora-39-root-host-sqlite.log.html#t--Podman-stop-podman-stop-ignore-bogus-container--1) in Podman stop podman stop --ignore bogus container * fedora-39 : int podman fedora-39 rootless host boltdb * [09-27 15:37](https://api.cirrus-ci.com/v1/artifact/task/6572920902778880/html/int-podman-fedora-39-rootless-host-boltdb.log.html#t--Podman-stop-podman-stop-ignore-bogus-container--1) in Podman stop podman stop --ignore bogus container * fedora-39 : int podman fedora-39 rootless host sqlite * [09-27 08:58](https://api.cirrus-ci.com/v1/artifact/task/6715687226310656/html/int-podman-fedora-39-rootless-host-sqlite.log.html#t--Podman-stop-podman-stop-ignore-bogus-container--1) in Podman stop podman stop --ignore bogus container * fedora-39? : int podman fedora-39? root host boltdb * [09-28 13:13](https://api.cirrus-ci.com/v1/artifact/task/4534150460342272/html/int-podman-fedora-39?-root-host-boltdb.log.html#t--Podman-stop-podman-stop-ignore-bogus-container--1) in Podman stop podman stop --ignore bogus container * rawhide : int podman rawhide root host sqlite * [09-27 21:53](https://api.cirrus-ci.com/v1/artifact/task/5829690837958656/html/int-podman-rawhide-root-host-sqlite.log.html#t--Podman-stop-podman-stop-ignore-bogus-container--1) in Podman stop podman stop --ignore bogus container * [09-27 15:38](https://api.cirrus-ci.com/v1/artifact/task/5517389740113920/html/int-podman-rawhide-root-host-sqlite.log.html#t--Podman-prune-podman-system-prune-with-running--exited-pod-and-volume-prune-set-true--1) in Podman prune podman system prune with running, exited pod and volume prune set true Seen in: fedora-37/fedora-38/fedora-39/fedora-39?/rawhide root/rootless boltdb/sqlite</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>260</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #21004 from umohnani8/push-endpoint Fix push endpoint stream</MESSAGE>
    <SHA>b82e336751320aa37f219ba3588c6ab17f9d5ed1</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>CI: safer podman-stop tests A number of tests start a container then immediately run podman stop. This frequently flakes with: StopSignal SIGTERM failed to stop [...] in 10 seconds, resorting to SIGKILL Likely reason: container is still initializing, and its process has not yet set up its signal handlers. Solution: if possible (containers running &quot;top&quot;), wait for &quot;Mem:&quot; to indicate that top is running. If not possible (pods / catatonit), sleep half a second. Intended to fix some of the flakes cataloged in #20196 but I'm leaving that open in case we see more. These are hard to identify just by looking in the code. Signed-off-by: Ed Santiago &lt;santiago@redhat.com&gt;</MESSAGE>
      <SHA>1c59a9ced1a625a14a3f0f69b23442a1d23fb328</SHA>
      <PATCHEDFILES>
        <FILE>test/e2e/common_test.go</FILE>
        <FILE>test/e2e/prune_test.go</FILE>
        <FILE>test/system/050-stop.bats</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
