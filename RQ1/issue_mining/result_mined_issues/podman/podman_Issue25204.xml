<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>25204</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/25204</ISSUEURL>
  <TITLE>CI: podman pause/unpause with HealthCheck interval flake</TITLE>
  <DESCRIPTION>``` not ok 150 |080| podman pause/unpause with HealthCheck interval in 545ms # tags: ci:parallel # (in test file test/system/[080-pause.bats, line 109](https://github.com/containers/podman/blob/89283c6fccbd790a18b3c0745d9d598be5238667/test/system/080-pause.bats#L109)) # `run -0 systemctl status $cid-*.{service,timer}' failed, expected exit code 0, got 3 # &lt;+ &gt; # # podman-remote run -d --name c-t150-jkjwqswn --health-cmd echo healthmsg-xBrRytJnDW --health-interval 1s quay.io/libpod/testimage:20241011 /home/podman/pause &lt;+174ms&gt; # 524c9ecf5201812168534a0fe13c91aa464c9d99652a1d9d072938d894a56fa7 # &lt;+010ms&gt; # # podman-remote healthcheck run c-t150-jkjwqswn # ● 524c9ecf5201812168534a0fe13c91aa464c9d99652a1d9d072938d894a56fa7-3279f6b011c14988.timer - /var/tmp/go/src/github.com/containers/podman/bin/podman healthcheck run 524c9ecf5201812168534a0fe13c91aa464c9d99652a1d9d072938d894a56fa7 # Loaded: loaded (/run/systemd/transient/524c9ecf5201812168534a0fe13c91aa464c9d99652a1d9d072938d894a56fa7-3279f6b011c14988.timer; transient) # Transient: yes # Active: active (elapsed) since Mon 2025-02-03 15:13:18 UTC; 170ms ago # Invocation: adebe6cc00b64b8d9ba802ff406022a1 # Trigger: n/a # Triggers: ● 524c9ecf5201812168534a0fe13c91aa464c9d99652a1d9d072938d894a56fa7-3279f6b011c14988.service # # Feb 03 15:13:18 ip-172-31-42-77.ec2.internal systemd[1]: Started 524c9ecf5201812168534a0fe13c91aa464c9d99652a1d9d072938d894a56fa7-3279f6b011c14988.timer - /var/tmp/go/src/github.com/containers/podman/bin/podman healthcheck run 524c9ecf5201812168534a0fe13c91aa464c9d99652a1d9d072938d894a56fa7. # # ○ 524c9ecf5201812168534a0fe13c91aa464c9d99652a1d9d072938d894a56fa7-3279f6b011c14988.service - /var/tmp/go/src/github.com/containers/podman/bin/podman healthcheck run 524c9ecf5201812168534a0fe13c91aa464c9d99652a1d9d072938d894a56fa7 # Loaded: loaded (/run/systemd/transient/524c9ecf5201812168534a0fe13c91aa464c9d99652a1d9d072938d894a56fa7-3279f6b011c14988.service; transient) # Transient: yes # Drop-In: /usr/lib/systemd/system/service.d # └─10-timeout-abort.conf, 50-keep-warm.conf # Active: inactive (dead) since Mon 2025-02-03 15:13:18 UTC; 7ms ago # Duration: 154ms # Invocation: 9d942a8def69404985f8ed3a441d0e62 # TriggeredBy: ● 524c9ecf5201812168534a0fe13c91aa464c9d99652a1d9d072938d894a56fa7-3279f6b011c14988.timer # Process: 65685 ExecStart=/var/tmp/go/src/github.com/containers/podman/bin/podman healthcheck run 524c9ecf5201812168534a0fe13c91aa464c9d99652a1d9d072938d894a56fa7 (code=exited, status=0/SUCCESS) # Main PID: 65685 (code=exited, status=0/SUCCESS) # Mem peak: 11.2M # CPU: 75ms # # Feb 03 15:13:18 ip-172-31-42-77.ec2.internal podman[65685]: 2025-02-03 15:13:18.513812646 +0000 UTC m=+0.130376597 container health_status 524c9ecf5201812168534a0fe13c91aa464c9d99652a1d9d072938d894a56fa7 (image=quay.io/libpod/testimage:20241011, name=c-t150-jkjwqswn, health_status=healthy, health_failing_streak=0, health_log=, io.buildah.version=1.38.0-dev, created_at=2024-10-11T12:26:00Z, created_by=test/system/build-testimage) # # [teardown] ``` https://api.cirrus-ci.com/v1/artifact/task/5896295807713280/html/sys-remote-fedora-41-aarch64-root-host-sqlite.log.html This is failing: ``` `run -0 systemctl status $cid-*.{service,timer}' failed, expected exit code 0, got 3 ``` I have seen the same error several times but only on podman-remote tests so far.</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #25209 from Luap99/e2e-conf test/e2e: improve write/removeConf()</MESSAGE>
    <SHA>4b68b0f2a3c2a0926a23640675c6db3a2e45e0eb</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fix flake test: podman pause/unpause with HealthCheck interval Checking of service and timer caused unexpected exit code `3` of `systemctl status`. Since the status check can be executed when HealthCheck was exited, this caused a termination error code `3` for `systemctl status`. Because service was in dead state because HealthCheck exited. Fixes: https://github.com/containers/podman/issues/25204 Signed-off-by: Jan Rodák &lt;hony.com@seznam.cz&gt;</MESSAGE>
      <SHA>841ede09ab02fa214c7d3d7be32c789c8f3abdca</SHA>
      <PATCHEDFILES>
        <FILE>test/system/080-pause.bats</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fix flake test: podman pause/unpause with HealthCheck interval Checking of service and timer caused unexpected exit code `3` of `systemctl status`. Since the status check can be executed when HealthCheck was exited, this caused a termination error code `3` for `systemctl status`. Because service was in dead state because HealthCheck exited. Fixes: https://github.com/containers/podman/issues/25204 Signed-off-by: Jan Rodák &lt;hony.com@seznam.cz&gt;</MESSAGE>
      <SHA>52febf6a0acd113bc24fa33ad06388e6fd09ed01</SHA>
      <PATCHEDFILES>
        <FILE>test/system/080-pause.bats</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
