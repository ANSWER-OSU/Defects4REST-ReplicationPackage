<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>23637</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/23637</ISSUEURL>
  <TITLE>another mount race: ctr XYZ is a libpod container: container already exists</TITLE>
  <DESCRIPTION>Looks similar to #23507 (whose fix is already in the code I'm running): ``` not ok 61 |060| podman mount external container - basic test in 449ms ... &lt;+026ms&gt; # # podman mount --notruncate &lt;+056ms&gt; # Error: ctr a5361035a5628efdd0b4947812ddb077854f202ec5877b7fc27c0b9cd12ebe7c is a libpod container: container already exists &lt;+004ms&gt; # [ rc=125 (** EXPECTED 0 **) ] ``` This is in [parallel system tests](https://api.cirrus-ci.com/v1/artifact/task/4794233427591168/html/sys-podman-fedora-40-aarch64-root-host-sqlite.log.html#t--00061p) where presumably objects are being created/removed unpredictably. Not much to go on, but journal shows the container safename being `t-55` which corresponds to `podman stop, with --rm container`, which simply does `podman run -d --rm sleep` then `podman stop -t0`. That's where I'd begin with a reproducer, that in one loop, `podman mount` in another.</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #23595 from edsantiago/parallel-safe-random-free-port CI: system tests: make random_free_port() parallel-safe</MESSAGE>
    <SHA>8c132cc38861da3c84ccd26fd0528db47c6a7307</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>podman mount: fix storage/libpod ctr race When we create a container we first create it in the storage then in the libpod db so there is a tiny window where it is seen as storage ctr but then by the time we mount it we see it was a libpod container. Fixes #23637 Signed-off-by: Paul Holzinger &lt;pholzing@redhat.com&gt;</MESSAGE>
      <SHA>7a7aec355ba1227d6d4fe6d69e9704dcbd365234</SHA>
      <PATCHEDFILES>
        <FILE>pkg/domain/infra/abi/containers.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
