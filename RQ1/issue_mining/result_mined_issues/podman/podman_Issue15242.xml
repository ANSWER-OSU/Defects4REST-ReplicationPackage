<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>15242</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/15242</ISSUEURL>
  <TITLE>podman container clone does not copy environment variables</TITLE>
  <DESCRIPTION>**Is this a BUG REPORT or FEATURE REQUEST? (leave only one on its own line)** /kind bug **Description** The new container created by `podman container clone` does not copy environment variables set on the first container. **Steps to reproduce the issue:** 1. `$ podman run --name my_container -e 'ENV_VAR=MyValue' docker.io/busybox /bin/sh -c 'echo ${ENV_VAR}'` 2. `podman container clone my_container my_clone` 3. `podman start -a my_clone` **Describe the results you received:** ``` $ podman run --name my_container -e 'ENV_VAR=MyValue' docker.io/busybox /bin/sh -c 'echo ${ENV_VAR}' **MyValue** $ podman container clone my_container my_clone 26f558722fb01ed7fe62cc4b9f4df2f23eb42b7d28ad2b16b44e2a957517fcf0 $ podman start -a my_clone $ podman inspect --format &quot;{{.Name}} {{.Config.Env}}&quot; my_container my_clone my_container [**ENV_VAR=MyValue** PATH=... TERM=xterm container=podman HOME=/root HOSTNAME=...] my_clone [PATH=... TERM=xterm container=podman HOME=/root HOSTNAME=...] ``` **Describe the results you expected:** ``` $ podman run --name my_container -e 'ENV_VAR=MyValue' docker.io/busybox /bin/sh -c 'echo ${ENV_VAR}' **MyValue** $ podman container clone my_container my_clone 26f558722fb01ed7fe62cc4b9f4df2f23eb42b7d28ad2b16b44e2a957517fcf0 $ podman start -a my_clone **MyValue** $ podman inspect --format &quot;{{.Name}} {{.Config.Env}}&quot; my_container my_clone my_container [**ENV_VAR=MyValue** PATH=... TERM=xterm container=podman HOME=/root HOSTNAME=...] my_clone [**ENV_VAR=MyValue** PATH=... TERM=xterm container=podman HOME=/root HOSTNAME=...] ``` **Output of `podman version`:** ``` Client: Podman Engine Version: 4.1.1 API Version: 4.1.1 Go Version: go1.17.7 Built: Mon Jul 11 15:56:53 2022 OS/Arch: linux/amd64 ``` **Output of `podman info`:** ``` host: arch: amd64 buildahVersion: 1.26.2 cgroupControllers: - cpuset - cpu - io - memory - pids cgroupManager: systemd cgroupVersion: v2 conmon: package: conmon-2.1.2-2.module+el8.6.0+15917+093ca6f8.x86_64 path: /usr/bin/conmon version: 'conmon version 2.1.2, commit: 8c4f33ac0dcf558874b453d5027028b18d1502db' cpuUtilization: idlePercent: 95.09 systemPercent: 2.49 userPercent: 2.42 cpus: 4 distribution: distribution: '&quot;rhel&quot;' version: &quot;8.6&quot; eventLogger: journald hostname: t3dlukfmnapp02 idMappings: gidmap: - container_id: 0 host_id: 10668 size: 1 - container_id: 1 host_id: 231072 size: 65536 uidmap: - container_id: 0 host_id: 1002 size: 1 - container_id: 1 host_id: 231072 size: 65536 kernel: 4.18.0-372.19.1.el8_6.x86_64 linkmode: dynamic logDriver: k8s-file memFree: 4480204800 memTotal: 10251575296 networkBackend: cni ociRuntime: name: crun package: crun-1.4.5-2.module+el8.6.0+15917+093ca6f8.x86_64 path: /usr/bin/crun version: |- crun version 1.4.5 commit: c381048530aa750495cf502ddb7181f2ded5b400 spec: 1.0.0 +SYSTEMD +SELINUX +APPARMOR +CAP +SECCOMP +EBPF +YAJL os: linux remoteSocket: path: /run/user/1002/podman/podman.sock security: apparmorEnabled: false capabilities: CAP_NET_RAW,CAP_CHOWN,CAP_DAC_OVERRIDE,CAP_FOWNER,CAP_FSETID,CAP_KILL,CAP_NET_BIND_SERVICE,CAP_SETFCAP,CAP_SETGID,CAP_SETPCAP,CAP_SETUID,CAP_SYS_CHROOT rootless: true seccompEnabled: true seccompProfilePath: /usr/share/containers/seccomp.json selinuxEnabled: false serviceIsRemote: false slirp4netns: executable: /usr/bin/slirp4netns package: slirp4netns-1.2.0-2.module+el8.6.0+15917+093ca6f8.x86_64 version: |- slirp4netns version 1.2.0 commit: 656041d45cfca7a4176f6b7eed9e4fe6c11e8383 libslirp: 4.4.0 SLIRP_CONFIG_VERSION_MAX: 3 libseccomp: 2.5.2 swapFree: 4500484096 swapTotal: 4500484096 uptime: 122h 56m 7.53s (Approximately 5.08 days) plugins: log: - k8s-file - none - passthrough - journald network: - bridge - macvlan - ipvlan volume: - local registries: {} store: configFile: /home/$USER/.config/containers/storage.conf containerStore: number: 2 paused: 0 running: 0 stopped: 2 graphDriverName: overlay graphOptions: {} graphRoot: /home/$USER/.local/share/containers/storage graphRootAllocated: 16145346560 graphRootUsed: 7455256576 graphStatus: Backing Filesystem: extfs Native Overlay Diff: &quot;true&quot; Supports d_type: &quot;true&quot; Using metacopy: &quot;false&quot; imageCopyTmpDir: /var/tmp imageStore: number: 4 runRoot: /run/user/1002/containers volumePath: /home/$USER/.local/share/containers/storage/volumes version: APIVersion: 4.1.1 Built: 1657551413 BuiltTime: Mon Jul 11 15:56:53 2022 GitCommit: &quot;&quot; GoVersion: go1.17.7 Os: linux OsArch: linux/amd64 Version: 4.1.1 ``` **Package info (e.g. output of `rpm -q podman` or `apt list podman`):** ``` podman-4.1.1-2.module+el8.6.0+15917+093ca6f8.x86_64 ``` **Have you tested with the latest version of Podman and have you checked the Podman Troubleshooting Guide? (https://github.com/containers/podman/blob/main/troubleshooting.md)** Yes (latest version available). **Additional environment details (AWS, VirtualBox, physical, etc.):** RHEL 8.6 under vmware.</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>14</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #15412 from edsantiago/docs_dedup_creds Man pages: refactor common options: --creds</MESSAGE>
    <SHA>aefd0aed3990848e77b706d673c23108092594a0</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>pass environment variables to container clone the env vars are held in the spec rather than the config, so they need to be mapped manually. They are also of a different format so special handling needed to be added. All env from the parent container will now be passed to the clone. resolves #15242 Signed-off-by: Charlie Doern &lt;cdoern@redhat.com&gt;</MESSAGE>
      <SHA>53369aaa1575caa652461d3671713577fa0ac291</SHA>
      <PATCHEDFILES>
        <FILE>pkg/specgen/generate/container.go</FILE>
        <FILE>test/e2e/container_clone_test.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>pass environment variables to container clone the env vars are held in the spec rather than the config, so they need to be mapped manually. They are also of a different format so special handling needed to be added. All env from the parent container will now be passed to the clone. resolves #15242 Signed-off-by: Charlie Doern &lt;cdoern@redhat.com&gt;</MESSAGE>
      <SHA>9d8c17ec08f472e1685a77abcbfce2fa5032ee7c</SHA>
      <PATCHEDFILES>
        <FILE>pkg/specgen/generate/container.go</FILE>
        <FILE>test/e2e/container_clone_test.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
