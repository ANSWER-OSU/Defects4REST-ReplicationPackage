<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>25851</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/25851</ISSUEURL>
  <TITLE>Podman socket doesn't output EXPOSED ports</TITLE>
  <DESCRIPTION>### Issue Description The ports exposed of the containers are not returned by the podman socket (only the ones bind to the host) I'm using rootfull containers, I'm not sure if it's the same for rootless. I haven't been able to find another issue regarding this, so I'm not sure if this behavior is by design ### Steps to reproduce the issue Steps to reproduce the issue: ``` $ sudo podman --version podman version 5.2.2 $ sudo podman run -d --name port-test -p 80:80 nginx:alpine $ sudo curl -s --unix-socket /run/podman/podman.sock http://localhost/containers/json?all=true | jq '.[] | select(.Names[] == &quot;/port-test&quot;) | .Ports' [ { &quot;PrivatePort&quot;: 80, &quot;PublicPort&quot;: 80, &quot;Type&quot;: &quot;tcp&quot; } ] $ sudo podman run -d --name expose-test --expose 80 nginx:alpine $ sudo curl -s --unix-socket /run/podman/podman.sock http://localhost/containers/json?all=true | jq '.[] | select(.Names[] == &quot;/expose-test&quot;) | .Ports' [] ``` ### Describe the results you received Exposed ports are not returned by the Podman socket [] ### Describe the results you expected Docker equivalent ``` $ sudo docker --version Docker version 27.3.1, build ce12230 $ sudo docker run -d --name port-test -p 80:80 nginx:alpine $ sudo curl -s --unix-socket /run/docker.sock http://localhost/containers/json?all=true | jq '.[] | select(.Names[] == &quot;/port-test&quot;) | .Ports' [ { &quot;IP&quot;: &quot;0.0.0.0&quot;, &quot;PrivatePort&quot;: 80, &quot;PublicPort&quot;: 80, &quot;Type&quot;: &quot;tcp&quot; }, ] $ sudo docker run -d --name expose-test --expose 80 nginx:alpine $ sudo curl -s --unix-socket /run/docker.sock http://localhost/containers/json?all=true | jq '.[] | select(.Names[] == &quot;/expose-test&quot;) | .Ports' [ { &quot;PrivatePort&quot;: 80, &quot;Type&quot;: &quot;tcp&quot; }, ] ``` ### podman info output ```yaml host: arch: amd64 buildahVersion: 1.37.6 cgroupControllers: - cpuset - cpu - io - memory - hugetlb - pids - rdma - misc cgroupManager: systemd cgroupVersion: v2 conmon: package: conmon-2.1.12-1.el9.x86_64 path: /usr/bin/conmon version: 'conmon version 2.1.12, commit: eb379dceb7efebd9a9d6b3349a57424d83483065' cpuUtilization: idlePercent: 99.61 systemPercent: 0.2 userPercent: 0.19 cpus: 4 databaseBackend: sqlite distribution: distribution: almalinux version: &quot;9.5&quot; eventLogger: journald freeLocks: 2046 hostname: almalinux9 idMappings: gidmap: null uidmap: null kernel: 5.14.0-503.35.1.el9_5.x86_64 linkmode: dynamic logDriver: journald memFree: 7268474880 memTotal: 8037085184 networkBackend: netavark networkBackendInfo: backend: netavark dns: package: aardvark-dns-1.12.2-1.el9_5.x86_64 path: /usr/libexec/podman/aardvark-dns version: aardvark-dns 1.12.2 package: netavark-1.12.2-1.el9.x86_64 path: /usr/libexec/podman/netavark version: netavark 1.12.2 ociRuntime: name: crun package: crun-1.16.1-1.el9.x86_64 path: /usr/bin/crun version: |- crun version 1.16.1 commit: afa829ca0122bd5e1d67f1f38e6cc348027e3c32 rundir: /run/crun spec: 1.0.0 +SYSTEMD +SELINUX +APPARMOR +CAP +SECCOMP +EBPF +CRIU +YAJL os: linux pasta: executable: /bin/pasta package: passt-0^20240806.gee36266-7.el9_5.x86_64 version: | pasta 0^20240806.gee36266-7.el9_5.x86_64 Copyright Red Hat GNU General Public License, version 2 or later &lt;https://www.gnu.org/licenses/old-licenses/gpl-2.0.html&gt; This is free software: you are free to change and redistribute it. There is NO WARRANTY, to the extent permitted by law. remoteSocket: exists: true path: /run/podman/podman.sock rootlessNetworkCmd: pasta security: apparmorEnabled: false capabilities: CAP_CHOWN,CAP_DAC_OVERRIDE,CAP_FOWNER,CAP_FSETID,CAP_KILL,CAP_NET_BIND_SERVICE,CAP_SETFCAP,CAP_SETGID,CAP_SETPCAP,CAP_SETUID,CAP_SYS_CHROOT rootless: false seccompEnabled: true seccompProfilePath: /usr/share/containers/seccomp.json selinuxEnabled: true serviceIsRemote: false slirp4netns: executable: /bin/slirp4netns package: slirp4netns-1.3.1-1.el9.x86_64 version: |- slirp4netns version 1.3.1 commit: e5e368c4f5db6ae75c2fce786e31eef9da6bf236 libslirp: 4.4.0 SLIRP_CONFIG_VERSION_MAX: 3 libseccomp: 2.5.2 swapFree: 0 swapTotal: 0 uptime: 0h 54m 8.00s variant: &quot;&quot; plugins: authorization: null log: - k8s-file - none - passthrough - journald network: - bridge - macvlan - ipvlan volume: - local registries: search: - registry.access.redhat.com - registry.redhat.io - docker.io store: configFile: /etc/containers/storage.conf containerStore: number: 2 paused: 0 running: 2 stopped: 0 graphDriverName: overlay graphOptions: overlay.mountopt: nodev,metacopy=on graphRoot: /var/lib/containers/storage graphRootAllocated: 40352677888 graphRootUsed: 1982976000 graphStatus: Backing Filesystem: extfs Native Overlay Diff: &quot;false&quot; Supports d_type: &quot;true&quot; Supports shifting: &quot;false&quot; Supports volatile: &quot;true&quot; Using metacopy: &quot;true&quot; imageCopyTmpDir: /var/tmp imageStore: number: 2 runRoot: /run/containers/storage transientStore: false volumePath: /var/lib/containers/storage/volumes version: APIVersion: 5.2.2 Built: 1743162783 BuiltTime: Fri Mar 28 11:53:03 2025 GitCommit: &quot;&quot; GoVersion: go1.22.9 (Red Hat 1.22.9-2.el9_5) Os: linux OsArch: linux/amd64 Version: 5.2.2 ``` ### Podman in a container No ### Privileged Or Rootless Privileged ### Upstream Latest Release No ### Additional environment details ``` $ cat /etc/*-release AlmaLinux release 9.5 (Teal Serval) NAME=&quot;AlmaLinux&quot; VERSION=&quot;9.5 (Teal Serval)&quot; ID=&quot;almalinux&quot; ID_LIKE=&quot;rhel centos fedora&quot; VERSION_ID=&quot;9.5&quot; PLATFORM_ID=&quot;platform:el9&quot; PRETTY_NAME=&quot;AlmaLinux 9.5 (Teal Serval)&quot; ANSI_COLOR=&quot;0;34&quot; LOGO=&quot;fedora-logo-icon&quot; CPE_NAME=&quot;cpe:/o:almalinux:almalinux:9::baseos&quot; HOME_URL=&quot;https://almalinux.org/&quot; DOCUMENTATION_URL=&quot;https://wiki.almalinux.org/&quot; BUG_REPORT_URL=&quot;https://bugs.almalinux.org/&quot; ALMALINUX_MANTISBT_PROJECT=&quot;AlmaLinux-9&quot; ALMALINUX_MANTISBT_PROJECT_VERSION=&quot;9.5&quot; REDHAT_SUPPORT_PRODUCT=&quot;AlmaLinux&quot; REDHAT_SUPPORT_PRODUCT_VERSION=&quot;9.5&quot; SUPPORT_END=2032-06-01 AlmaLinux release 9.5 (Teal Serval) AlmaLinux release 9.5 (Teal Serval) ``` ### Additional information I'm using prometheus [docker_sd_config](https://prometheus.io/docs/prometheus/latest/configuration/configuration/#docker_sd_config) I want expose the containers metrics port, not bind it</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>25</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #25701 from danegsta/danegsta/windowsCpPath Fix windows path handling in `podman cp`</MESSAGE>
    <SHA>48423a615d1d8e5f9d7a3f4cbee0c98088692cf7</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>update podman socket output to include also exposed ports Fixes https://github.com/containers/podman/issues/25851 Signed-off-by: Cesar Goncalves &lt;mail@cesargoncalves.com&gt;</MESSAGE>
      <SHA>f89992de93d14d46215cbd7466282df2d2de9862</SHA>
      <PATCHEDFILES>
        <FILE>pkg/api/handlers/compat/containers.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>update podman socket output to include also exposed ports Fixes https://github.com/containers/podman/issues/25851 Co-authored-by: Brent Baude &lt;bbaude@redhat.com&gt; Signed-off-by: Cesar Goncalves &lt;mail@cesargoncalves.com&gt;</MESSAGE>
      <SHA>a969dbd73ef7757a3fb471128a82602b6682914b</SHA>
      <PATCHEDFILES>
        <FILE>pkg/api/handlers/compat/containers.go</FILE>
        <FILE>test/apiv2/20-containers.at</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>update podman socket output to include also exposed ports Fixes https://github.com/containers/podman/issues/25851 Co-authored-by: Brent Baude &lt;bbaude@redhat.com&gt; Signed-off-by: Cesar Goncalves &lt;mail@cesargoncalves.com&gt;</MESSAGE>
      <SHA>82a1a2271173cd5674b7730b4cd03ccf6ef5f168</SHA>
      <PATCHEDFILES>
        <FILE>pkg/api/handlers/compat/containers.go</FILE>
        <FILE>test/apiv2/20-containers.at</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
