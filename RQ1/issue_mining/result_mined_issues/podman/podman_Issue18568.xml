<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>18568</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/18568</ISSUEURL>
  <TITLE>slirp4netns should honour the `helper_binaries_dir` config</TITLE>
  <DESCRIPTION>### Feature request description Podman's slirp4netns implementation currently uses a custom logic to find the `slirp4netns` binary. See https://github.com/containers/podman/blob/493aac69e06605a26307bb3d774670c0b1fb5e3b/libpod/networking_slirp4netns.go#L216-L223 For some time now Podman chose to rely on [`r.config.FindHelperBinary()`](https://github.com/containers/podman/blob/493aac69e06605a26307bb3d774670c0b1fb5e3b/vendor/github.com/containers/common/pkg/config/config.go#L1353) to find helper binaries. This method uses the `helper_binaries_dir` config in `storage.conf` (or the purposely undocumented `CONTAINERS_HELPER_BINARY_DIR` env variable for testing) and falls back to `$PATH` otherwise. slirp4netns instead uses the custom single-purpose CLI option `--network-cmd-path` with a fallback to `$PATH`. slirp4netns doesn't honour the `helper_binaries_dir` config right now. Setting a path for slirp4netns is unnecessary hard because of this; due to the CLI option's generic name and a false documentation it even caused some confusion in the past (see #18560 and #18569 to fix it). ### Suggest potential solution Unify how Podman finds helper binaries: Podman should use `r.config.FindHelperBinary()` to find the `slirp4netns` binary and deprecate the `--network-cmd-path` CLI option. For backwards compatibility reasons we must keep the `--network-cmd-path` CLI option for now (it should take precedence for now), but deprecate it by adding a note to the [`podman(1)` manpage](https://github.com/containers/podman/blob/493aac69e06605a26307bb3d774670c0b1fb5e3b/docs/source/markdown/podman.1.md?plain=1#L85-L86). We should then consider removing the option with Podman's next major release. ### Have you considered any alternatives? Previous discussion and reasoning for this approach see #18560 ### Additional context Also see #18569 for the docs fixes Cc: @Luap99</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>4</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #18535 from rhatdan/mount Fix handling of .containenv on tmpfs</MESSAGE>
    <SHA>493aac69e06605a26307bb3d774670c0b1fb5e3b</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fix documentation of `--network-cmd-path` CLI option The `--network-cmd-path` CLI option only affects rootless networks using `slirp4netns(1)`, not `pasta(1)`. Following #18568 Podman should rather use the more generic `r.config.FindHelperBinary()` method (and therefore honour the `helper_binaries_dir` config) to find the path to the `slirp4netns` binary and deprecate the misleading `--network-cmd-path` CLI option. However, since this wasn't implemented yet we can't deprecate `--network-cmd-path` as of now. Adding a note anyway. Fixes #18560 Signed-off-by: Daniel Rudolf &lt;github.com@daniel-rudolf.de&gt;</MESSAGE>
      <SHA>ae5cbf37cf4c2b9aca8d3dfa27275419c7abc732</SHA>
      <PATCHEDFILES>
        <FILE>cmd/podman/root.go</FILE>
        <FILE>docs/source/markdown/podman.1.md</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>podman: Add binary file from helper_binaries_dir to find slirp4netns [NO NEW TESTS NEEDED] Fixes: #18568 Signed-off-by: binghongtao &lt;695097494plus@gmail.com&gt;</MESSAGE>
      <SHA>a4428eaaf1828305359fdf42759b65f972a1add4</SHA>
      <PATCHEDFILES>
        <FILE>libpod/info_linux.go</FILE>
        <FILE>libpod/networking_linux.go</FILE>
        <FILE>libpod/networking_slirp4netns.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>podman: Added find slirp4netns binary file from helper_binaries_dir [NO NEW TESTS NEEDED] Fixes: #18568 Signed-off-by: binghongtao &lt;695097494plus@gmail.com&gt;</MESSAGE>
      <SHA>29749362a079da211c3d4e94bfff354a1d23b526</SHA>
      <PATCHEDFILES>
        <FILE>cmd/podman/root.go</FILE>
        <FILE>docs/source/markdown/podman.1.md</FILE>
        <FILE>libpod/info_linux.go</FILE>
        <FILE>libpod/networking_linux.go</FILE>
        <FILE>libpod/networking_slirp4netns.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
