<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>14761</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/14761</ISSUEURL>
  <TITLE>podman wait: new timeout, possibly deadlock</TITLE>
  <DESCRIPTION>Started right after #14685, but please don't anybody get tunnel vision on it: correlation causation etc. ``` # podman-remote run ... # podman-remote kill ... # podman-remote wait ... timeout: sending signal TERM to command ?/var/tmp/go/src/github.com/containers/podman/bin/podman-remote? ``` Seen root and rootless; fedora 35, 36, and ubuntu. So far, `podman-remote` only. Once it triggers, the entire system is unusable, podman-everything hangs, and tests die after the Cirrus timeout. ### [sys] 101 podman stop - unlock while waiting for timeout * fedora-35 : sys remote fedora-35 root host [remote] * PR #14597 * [06-27 16:49](https://api.cirrus-ci.com/v1/task/6006984553005056/logs/main.log) * fedora-36 : sys remote fedora-36 rootless host [remote] * PR #14742 * [06-27 11:46](https://api.cirrus-ci.com/v1/task/6755034766508032/logs/main.log) * PR #14717 * [06-28 12:24](https://api.cirrus-ci.com/v1/task/6116050067521536/logs/main.log) * ubuntu-2110 : sys remote ubuntu-2110 root host [remote] * PR #14733 * [06-27 10:37](https://api.cirrus-ci.com/v1/task/5565201654218752/logs/main.log) (Labeling `remote`, and waiting to see if stupid bot removes the tag. I'm betting it will.)</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>6</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #14807 from eriksjolund/fix_read_only_spelling [CI:DOCS] Fix spelling &quot;read only&quot; -&gt; &quot;read-only&quot;</MESSAGE>
    <SHA>a406b950e4f8cf64bdd2c1e03a8480d4b5f97226</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>kill: record exit code Make sure to record the exit code after killing a container. Otherwise, a concurrent `stop` may not record the exit code and yield the container unusable. Fixes: #14761 Signed-off-by: Valentin Rothberg &lt;vrothberg@redhat.com&gt;</MESSAGE>
      <SHA>e5e57004fe2dd322b439d25511c0eade9ef20209</SHA>
      <PATCHEDFILES>
        <FILE>libpod/container_api.go</FILE>
        <FILE>libpod/container_internal.go</FILE>
        <FILE>test/system/130-kill.bats</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Sync: handle exit file Make sure `Sync()` handles state transitions and exit codes correctly. The function was only being called when batching which could render containers in an unusable state when running concurrently with other state-altering functions/commands since the state must be re-read from the database before acting upon it. Fixes: #14761 Signed-off-by: Valentin Rothberg &lt;vrothberg@redhat.com&gt;</MESSAGE>
      <SHA>b9aa4755559d50d39bee3f571734a1e17c0f08b2</SHA>
      <PATCHEDFILES>
        <FILE>libpod/container_api.go</FILE>
        <FILE>test/system/130-kill.bats</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
