<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>17542</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/17542</ISSUEURL>
  <TITLE>Docker compatible `/containers/&lt;id or name&gt;/stop` does not support negative timeouts</TITLE>
  <DESCRIPTION>### Issue Description The Docker compatible `/containers/&lt;id or name&gt;/stop` endpoint does not support using a negative timeout. Docker's [spec](https://github.com/moby/moby/blob/master/api/types/container/config.go#L24-L32) for this endpoint states that you can &quot;use '-1' to wait indefinitely.&quot; rather then having a set timeout after which the container will be killed. Podman's [implementation](https://github.com/containers/podman/blob/main/pkg/api/handlers/compat/containers_stop.go#L27) of this endpoint utilizes a `uint` rather then an `int`, causing a error to be thrown when using negative values. ### Steps to reproduce the issue Steps to reproduce the issue 1. Run a container 2. Send stop request with a negative (indefinite) timeout value of `-1` (if using the Docker Go SDK this will need to be `-1 * time.Second`) 3. Notice the error ### Describe the results you received Request returns an error and the container continues to run. ``` failed to parse parameters for /v1.41/containers/&lt;ID&gt;/stop?t=-1: schema: error converting value for &quot;t&quot; ``` ### Describe the results you expected Container is sent a stop signal and is not terminated immediately or after a default timeout. ### podman info output ```yaml host: arch: amd64 buildahVersion: 1.29.0-dev cgroupControllers: - cpu - io - memory - pids cgroupManager: systemd cgroupVersion: v2 conmon: package: conmon-2.1.5-3.fc38.x86_64 path: /usr/bin/conmon version: 'conmon version 2.1.5, commit: ' cpuUtilization: idlePercent: 95.57 systemPercent: 1.1 userPercent: 3.33 cpus: 24 distribution: distribution: fedora variant: silverblue version: &quot;38&quot; eventLogger: journald hostname: matthew-desktop.local idMappings: gidmap: - container_id: 0 host_id: 1000 size: 1 - container_id: 1 host_id: 100000 size: 65536 uidmap: - container_id: 0 host_id: 1000 size: 1 - container_id: 1 host_id: 100000 size: 65536 kernel: 6.2.0-0.rc7.20230208git0983f6bf2bfc.52.fc38.x86_64 linkmode: dynamic logDriver: journald memFree: 72184705024 memTotal: 134972575744 networkBackend: cni ociRuntime: name: crun package: crun-1.8-1.fc38.x86_64 path: /usr/bin/crun version: |- crun version 1.8 commit: 0356bf4aff9a133d655dc13b1d9ac9424706cac4 rundir: /run/user/1000/crun spec: 1.0.0 +SYSTEMD +SELINUX +APPARMOR +CAP +SECCOMP +EBPF +CRIU +LIBKRUN +WASM:wasmedge +YAJL os: linux remoteSocket: exists: true path: /run/user/1000/podman/podman.sock security: apparmorEnabled: false capabilities: CAP_CHOWN,CAP_DAC_OVERRIDE,CAP_FOWNER,CAP_FSETID,CAP_KILL,CAP_NET_BIND_SERVICE,CAP_SETFCAP,CAP_SETGID,CAP_SETPCAP,CAP_SETUID rootless: true seccompEnabled: true seccompProfilePath: /usr/share/containers/seccomp.json selinuxEnabled: true serviceIsRemote: false slirp4netns: executable: /usr/bin/slirp4netns package: slirp4netns-1.2.0-12.fc38.x86_64 version: |- slirp4netns version 1.2.0 commit: 656041d45cfca7a4176f6b7eed9e4fe6c11e8383 libslirp: 4.7.0 SLIRP_CONFIG_VERSION_MAX: 4 libseccomp: 2.5.3 swapFree: 8589930496 swapTotal: 8589930496 uptime: 5h 45m 24.00s (Approximately 0.21 days) plugins: authorization: null log: - k8s-file - none - passthrough - journald network: - bridge - macvlan - ipvlan volume: - local registries: default-route-openshift-image-registry.apps-crc.testing: Blocked: false Insecure: true Location: default-route-openshift-image-registry.apps-crc.testing MirrorByDigestOnly: false Mirrors: null Prefix: default-route-openshift-image-registry.apps-crc.testing PullFromMirror: &quot;&quot; search: - docker.io - quay.io - registry.fedoraproject.org - registry.access.redhat.com store: configFile: /var/home/matthew/.config/containers/storage.conf containerStore: number: 10 paused: 0 running: 8 stopped: 2 graphDriverName: overlay graphOptions: {} graphRoot: /var/home/matthew/.local/share/containers/storage graphRootAllocated: 998483427328 graphRootUsed: 696580554752 graphStatus: Backing Filesystem: btrfs Native Overlay Diff: &quot;true&quot; Supports d_type: &quot;true&quot; Using metacopy: &quot;false&quot; imageCopyTmpDir: /var/tmp imageStore: number: 329 runRoot: /run/user/1000/containers transientStore: false volumePath: /var/home/matthew/.local/share/containers/storage/volumes version: APIVersion: 4.4.0-rc2 Built: 1674134600 BuiltTime: Thu Jan 19 06:23:20 2023 GitCommit: &quot;&quot; GoVersion: go1.20rc3 Os: linux OsArch: linux/amd64 Version: 4.4.0-rc2 ``` ### Podman in a container No ### Privileged Or Rootless Rootless ### Upstream Latest Release Yes ### Additional environment details _No response_ ### Additional information _No response_</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>172</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #19505 from eriksjolund/fix_issue_19462_remove_duplicate_lastup_from_man_page [CI:DOCS] man: remove duplicate entry `.LastUp`</MESSAGE>
    <SHA>144098587706ac3fd4e257ea03c75aaf4ee29064</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Add support for passing container stop timeout as -1 (infinite) Compat api for containers/stop should take -1 value Add support for `podman stop --time -1` Add support for `podman restart --time -1` Add support for `podman rm --time -1` Add support for `podman pod stop --time -1` Add support for `podman pod rm --time -1` Add support for `podman volume rm --time -1` Add support for `podman network rm --time -1` Fixes: https://github.com/containers/podman/issues/17542 Signed-off-by: Daniel J Walsh &lt;dwalsh@redhat.com&gt;</MESSAGE>
      <SHA>1e545394326bc8260ab47139955346b440046aad</SHA>
      <PATCHEDFILES>
        <FILE>cmd/podman/containers/restart.go</FILE>
        <FILE>cmd/podman/containers/rm.go</FILE>
        <FILE>cmd/podman/containers/stop.go</FILE>
        <FILE>cmd/podman/networks/rm.go</FILE>
        <FILE>cmd/podman/pods/rm.go</FILE>
        <FILE>cmd/podman/pods/stop.go</FILE>
        <FILE>cmd/podman/volumes/rm.go</FILE>
        <FILE>docs/source/markdown/options/stop-timeout.md</FILE>
        <FILE>docs/source/markdown/options/time.md</FILE>
        <FILE>docs/source/markdown/podman-network-rm.1.md</FILE>
        <FILE>docs/source/markdown/podman-volume-rm.1.md</FILE>
        <FILE>libpod/oci_conmon_common.go</FILE>
        <FILE>libpod/options.go</FILE>
        <FILE>pkg/api/handlers/compat/containers_stop.go</FILE>
        <FILE>pkg/domain/infra/tunnel/containers.go</FILE>
        <FILE>pkg/util/utils.go</FILE>
        <FILE>test/apiv2/22-stop.at</FILE>
        <FILE>test/e2e/pod_stop_test.go</FILE>
        <FILE>test/e2e/start_test.go</FILE>
        <FILE>test/system/030-run.bats</FILE>
        <FILE>test/system/160-volumes.bats</FILE>
        <FILE>test/system/200-pod.bats</FILE>
        <FILE>test/system/500-networking.bats</FILE>
        <FILE>test/system/700-play.bats</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
