<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>16964</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/16964</ISSUEURL>
  <TITLE>Rarely `Error: getting pod's service container: container {ID} not found in DB: no such container`</TITLE>
  <DESCRIPTION>**Is this a BUG REPORT or FEATURE REQUEST? (leave only one on its own line)** /kind bug **Description** Maybe connected to https://github.com/containers/podman/issues/12034 I can't remove, start or restart the pod. It just tell me, that it's missing the service container with a specific id. My workaround is to edit the database file `~/.local/share/containers/storage/libpod/bolt_state.db` and replace this id by the id of a running service container and then remove the pod and start it again with systemD. On removing I get the error `Error: freeing pod 59c9006b753b60141d73d23e1f42ef0fae794a45e3c6315a27faee9db1bf930a lock: no such file or directory`, but I can ignore it and just recreate the database pod. The service container I stole the ID from still works fine. **Steps to reproduce the issue:** 1. podman pod rm database **Describe the results you received:** ``` $ podman pod ps POD ID NAME STATUS CREATED INFRA ID # OF CONTAINERS 59c9006b753b database Created 24 hours ago 0 ``` ``` $ podman pod rm database Error: getting pod's service container: container b6a7e0e2c9325da40272180a80445b2e8d090866a78911545773e1173a045737 not found in DB: no such container ``` **Describe the results you expected:** Removed pod. **Additional information you deem important (e.g. issue happens only occasionally):** happens rarely **Output of `podman version`:** ``` Client: Podman Engine Version: 4.3.1 API Version: 4.3.1 Go Version: go1.19.3 Git Commit: 814b7b003cc630bf6ab188274706c383f9fb9915-dirty Built: Sun Nov 20 23:32:45 2022 OS/Arch: linux/amd64 ``` **Output of `podman info`:** ``` host: arch: amd64 buildahVersion: 1.28.0 cgroupControllers: - cpuset - cpu - io - memory - pids cgroupManager: systemd cgroupVersion: v2 conmon: package: /usr/bin/conmon ist in conmon 1:2.1.5-1 enthalten path: /usr/bin/conmon version: 'conmon version 2.1.5, commit: c9f7f19eb82d5b8151fc3ba7fbbccf03fdcd0325' cpuUtilization: idlePercent: 96.7 systemPercent: 2.48 userPercent: 0.82 cpus: 4 distribution: distribution: arch version: unknown eventLogger: journald hostname: homeserver idMappings: gidmap: - container_id: 0 host_id: 1000 size: 1 - container_id: 1 host_id: 100000 size: 65536 uidmap: - container_id: 0 host_id: 1000 size: 1 - container_id: 1 host_id: 100000 size: 65536 kernel: 5.15.85-1-lts linkmode: dynamic logDriver: journald memFree: 1236152320 memTotal: 6218739712 networkBackend: netavark ociRuntime: name: crun package: /usr/bin/crun ist in crun 1.7.2-1 enthalten path: /usr/bin/crun version: |- crun version 1.7.2 commit: 0356bf4aff9a133d655dc13b1d9ac9424706cac4 rundir: /run/user/1000/crun spec: 1.0.0 +SYSTEMD +SELINUX +APPARMOR +CAP +SECCOMP +EBPF +CRIU +YAJL os: linux remoteSocket: exists: true path: /run/user/1000/podman/podman.sock security: apparmorEnabled: false capabilities: CAP_CHOWN,CAP_DAC_OVERRIDE,CAP_FOWNER,CAP_FSETID,CAP_KILL,CAP_NET_BIND_SERVICE,CAP_SETFCAP,CAP_SETGID,CAP_SETPCAP,CAP_SETUID,CAP_SYS_CHROOT rootless: true seccompEnabled: true seccompProfilePath: /etc/containers/seccomp.json selinuxEnabled: false serviceIsRemote: false slirp4netns: executable: /usr/bin/slirp4netns package: /usr/bin/slirp4netns ist in slirp4netns 1.2.0-1 enthalten version: |- slirp4netns version 1.2.0 commit: 656041d45cfca7a4176f6b7eed9e4fe6c11e8383 libslirp: 4.7.0 SLIRP_CONFIG_VERSION_MAX: 4 libseccomp: 2.5.4 swapFree: 34359730176 swapTotal: 34359730176 uptime: 1h 17m 33.00s (Approximately 0.04 days) plugins: authorization: null log: - k8s-file - none - passthrough - journald network: - bridge - macvlan volume: - local registries: {} store: configFile: /home/homeserver/.config/containers/storage.conf containerStore: number: 13 paused: 0 running: 13 stopped: 0 graphDriverName: btrfs graphOptions: {} graphRoot: /home/homeserver/.local/share/containers/storage graphRootAllocated: 1000187023360 graphRootUsed: 2227044352 graphStatus: Build Version: Btrfs v6.0.1 Library Version: &quot;102&quot; imageCopyTmpDir: /var/tmp imageStore: number: 13 runRoot: /run/user/1000/containers volumePath: /home/homeserver/.local/share/containers/storage/volumes version: APIVersion: 4.3.1 Built: 1668983565 BuiltTime: Sun Nov 20 23:32:45 2022 GitCommit: 814b7b003cc630bf6ab188274706c383f9fb9915-dirty GoVersion: go1.19.3 Os: linux OsArch: linux/amd64 Version: 4.3.1 ``` **Package info (e.g. output of `rpm -q podman` or `apt list podman` or `brew info podman`):** ``` podman 4.3.1-2 ``` **Have you tested with the latest version of Podman and have you checked [the Podman Troubleshooting Guide](https://github.com/containers/podman/blob/main/troubleshooting.md)?** Yes **Additional environment details (AWS, VirtualBox, physical, etc.):** physical</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>8</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #17014 from rhatdan/VENDOR Vendor in latest containers/common</MESSAGE>
    <SHA>bc6908e7612c3165b77de42fb6b9f3adfe9ea1d4</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>remove service container _after_ pods Do not allow for removing the service container unless all associated pods have been removed. Previously, the service container could be removed when all pods have exited which can lead to a number of issues. Now, the service container is treated like an infra container and can only be removed along with the pods. Also make sure that a pod is unlinked from the service container once it's being removed. Fixes: #16964 Signed-off-by: Valentin Rothberg &lt;vrothberg@redhat.com&gt;</MESSAGE>
      <SHA>4a7a45f97319abd2cfd4e140b0278b9c06d6a71b</SHA>
      <PATCHEDFILES>
        <FILE>libpod/runtime_ctr.go</FILE>
        <FILE>libpod/service.go</FILE>
        <FILE>test/system/700-play.bats</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
