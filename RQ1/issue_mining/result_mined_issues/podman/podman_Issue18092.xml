<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>18092</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/18092</ISSUEURL>
  <TITLE>Image Filtering Incompatability with Docker API</TITLE>
  <DESCRIPTION>### Issue Description Attempting to filter images by label value via the compat HTTP API doesn't find images that definitely exist with the set labels. The same requests with the docker socket (after the same set of calls to create a labeled image) do return images. There seems to be something about a new and old format for filters, this seems to only apply to how the new filters are handled. ### Steps to reproduce the issue 1. run `podman image pull docker.io/ubuntu:22.04` 2. run: ``` curl --unix-socket /run/user/1000/podman/podman.sock --get 'http://_/images/json' \ --data-urlencode 'filters={&quot;label&quot;: [&quot;org.opencontainers.image.ref.name=ubuntu&quot;, &quot;org.opencontainers.image.version=22.04&quot;]}' ``` ### Describe the results you received This returns `[]`. ### Describe the results you expected I would expect this to return the same thing as: ``` curl --unix-socket /run/user/1000/podman/podman.sock --get 'http://_/images/json' \ --data-urlencode 'filters={&quot;label&quot;: {&quot;org.opencontainers.image.ref.name=ubuntu&quot;:true, &quot;org.opencontainers.image.version=22.04&quot;: true}}' ``` Which returns: ``` [ { &quot;Id&quot;: &quot;sha256:08d22c0ceb150ddeb2237c5fa3129c0183f3cc6f5eeb2e7aa4016da3ad02140a&quot;, &quot;ParentId&quot;: &quot;&quot;, &quot;RepoTags&quot;: [ &quot;docker.io/library/ubuntu:22.04&quot;, &quot;docker.io/library/ubuntu:latest&quot; ], &quot;RepoDigests&quot;: [ &quot;docker.io/library/ubuntu@sha256:67211c14fa74f070d27cc59d69a7fa9aeff8e28ea118ef3babc295a0428a6d21&quot;, &quot;docker.io/library/ubuntu@sha256:7a57c69fe1e9d5b97c5fe649849e79f2cfc3bf11d10bbd5218b4eb61716aebe6&quot; ], &quot;Created&quot;: 1678250667, &quot;Size&quot;: 80337591, &quot;SharedSize&quot;: 0, &quot;VirtualSize&quot;: 80337591, &quot;Labels&quot;: { &quot;org.opencontainers.image.ref.name&quot;: &quot;ubuntu&quot;, &quot;org.opencontainers.image.version&quot;: &quot;22.04&quot; }, &quot;Containers&quot;: 496, &quot;Names&quot;: [ &quot;docker.io/library/ubuntu:22.04&quot;, &quot;docker.io/library/ubuntu:latest&quot; ], &quot;Digest&quot;: &quot;sha256:67211c14fa74f070d27cc59d69a7fa9aeff8e28ea118ef3babc295a0428a6d21&quot;, &quot;History&quot;: [ &quot;docker.io/library/ubuntu:latest&quot;, &quot;docker.io/library/ubuntu:22.04&quot; ] } ] ``` ### podman info output ```yaml Client: Podman Engine Version: 4.4.2 API Version: 4.4.2 Go Version: go1.19.6 Built: Wed Mar 1 05:22:59 2023 OS/Arch: linux/amd64 ``` ### Podman in a container No ### Privileged Or Rootless Rootless ### Upstream Latest Release No ### Additional environment details _No response_ ### Additional information When the above commands are run, but for the docker command/socket, both curl calls result in the same output.</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>25</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #18372 from Luap99/save-stdout windows: podman save allow the use of stdout</MESSAGE>
    <SHA>91da62d74c82bf6c30245c4d49faa902102b00f5</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>api: fix parsing filters Podman and Docker clients split the filter map slightly different, so account for that when parsing the filters in the image-listing endpoint. Fixes: #18092 Signed-off-by: Valentin Rothberg &lt;vrothberg@redhat.com&gt;</MESSAGE>
      <SHA>1720042d04845b62e9171e127984104269a4bba6</SHA>
      <PATCHEDFILES>
        <FILE>pkg/api/handlers/compat/images.go</FILE>
        <FILE>test/apiv2/10-images.at</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>api: fix parsing filters Podman and Docker clients split the filter map slightly different, so account for that when parsing the filters in the image-listing endpoint. Fixes: #18092 Signed-off-by: Valentin Rothberg &lt;vrothberg@redhat.com&gt;</MESSAGE>
      <SHA>696c2d40d2343a0f168838d2ed277cf6df2d2082</SHA>
      <PATCHEDFILES>
        <FILE>pkg/api/handlers/compat/images.go</FILE>
        <FILE>test/apiv2/10-images.at</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
