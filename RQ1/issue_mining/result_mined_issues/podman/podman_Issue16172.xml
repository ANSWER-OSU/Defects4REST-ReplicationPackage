<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>16172</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/16172</ISSUEURL>
  <TITLE>Podman's `--dns` + `--network` is different than docker's `--dns` + `--network`</TITLE>
  <DESCRIPTION>I think Podman's `--dns` is behaving differently than how is it supposed to work when comparing with `docker` when a container is started with `--network`. # What Podman is doing when `--dns` is used with `--network` Podman's `--dns` is overrding the `nameservers` inside container's `/etc/resolv.conf` So `podman run --network test --dns 8.8.8.8 ...` will produce a `/etc/resolv.conf` inside container with following content. ```console bash-5.1# cat /etc/resolv.conf nameserver 8.8.8.8 ``` Following behavior mismatches with docker. # What docker is doing when `--dns` is used with `--network` Docker is setting the custom dns server instead of host's `/etc/resolv.conf` when container makes request to docker's DNS resolver. Actual `/etc/resolv.conf` inside the container is never changed with `docker` irrespective of `--dns` flag with `--network` flag. See the text here: https://docs.docker.com/config/containers/container-networking/#dns-services</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>101</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #16159 from vrothberg/ebusy-mcflakeface vendor containers/storage@main</MESSAGE>
    <SHA>03211654747f921810745993d9e3b25d29b65833</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>libpod: propogate custom DNS server to /etc/resolv.conf only when dns_enabled Podman populates container's `/etc/resolv.conf` with custom DNS servers ( specified via `--dns` or `dns_server` in containers.conf ) even when container is connected to a network where `dns_enabled` is `true`. Current behavior does not matches with docker, hence following commit ensures that podman only populates custom DNS server when container is not connected to any network where DNS is enabled and for the cases where `dns_enabled` is `true` the resolution for custom DNS server will happen via ( `aardvark-dns` or `dnsname` ). Reference: https://docs.docker.com/config/containers/container-networking/#dns-services Closes: https://github.com/containers/podman/issues/16172 ```release-note container: `--dns` and `dns_server` behavior for containers connected to network matches with docker now ``` Signed-off-by: Aditya R &lt;arajan@redhat.com&gt;</MESSAGE>
      <SHA>01915ad1b46f2225c4ead45c3d0f8bc5c3835f1e</SHA>
      <PATCHEDFILES>
        <FILE>libpod/container_internal_common.go</FILE>
        <FILE>test/e2e/run_networking_test.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
