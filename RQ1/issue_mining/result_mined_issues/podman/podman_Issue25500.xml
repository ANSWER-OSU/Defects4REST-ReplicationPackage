<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>25500</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/25500</ISSUEURL>
  <TITLE>Can't start HyperV machine with a volume path with spaces</TITLE>
  <DESCRIPTION>### Issue Description I can't start HyperV podman machines got an error each time I start it. The VM is started but the initialization process is errored. Might be cause by my Windows user name (thus home dirrectory) containing space ### Steps to reproduce the issue Steps to reproduce the issue 1. create an HyperV podman machine 2. start it ### Describe the results you received VM is started, error messages in the console: ``` podman machine start h1 Starting machine &quot;h1&quot; This machine is currently configured in rootless mode. If your containers require root permissions (e.g. ports &lt; 1024), or if you run into compatibility issues with non-podman clients, you can switch using the following command: podman machine set --rootful h1 Error: accepts 2 arg(s), received 3 Error: Process exited with status 125 ``` ### Describe the results you expected Machine should be started successfully ### podman info output ```yaml OS: windows/amd64 provider: hyperv version: 5.4.0 Cannot connect to Podman. Please verify your connection to the Linux system using `podman system connection list`, or try `podman machine init` and `podman machine start` to manage a new Linux VM Error: unable to connect to Podman socket: failed to connect: dial tcp 127.0.0.1:59529: connectex: No connection could be made because the target machine actively refused it. ``` ### Podman in a container No ### Privileged Or Rootless None ### Upstream Latest Release Yes ### Additional environment details Win11Pro ### Additional information ``` podman machine start --log-level debug h1 time=&quot;2025-03-07T09:10:00+01:00&quot; level=info msg=&quot;podman filtering at log level debug&quot; time=&quot;2025-03-07T09:10:00+01:00&quot; level=debug msg=&quot;Using Podman machine with `hyperv` virtualization provider&quot; time=&quot;2025-03-07T09:10:00+01:00&quot; level=debug msg=&quot;socket length for C:\\Users\\Jeff Maury\\.config\\containers\\podman\\machine\\hyperv is 60&quot; time=&quot;2025-03-07T09:10:00+01:00&quot; level=debug msg=&quot;socket length for C:\\Users\\Jeff Maury\\.local\\share\\containers\\podman\\machine\\hyperv is 65&quot; time=&quot;2025-03-07T09:10:00+01:00&quot; level=debug msg=&quot;socket length for C:\\Users\\Jeff Maury\\.local\\share\\containers\\podman\\machine\\hyperv\\cache is 71&quot; time=&quot;2025-03-07T09:10:00+01:00&quot; level=debug msg=&quot;socket length for C:\\Users\\JEFFMA~1\\AppData\\Local\\Temp\\podman is 43&quot; time=&quot;2025-03-07T09:10:00+01:00&quot; level=debug msg=&quot;socket length for C:\\Users\\Jeff Maury\\.config\\containers\\podman\\machine\\hyperv\\h1.json is 68&quot; Starting machine &quot;h1&quot; time=&quot;2025-03-07T09:10:00+01:00&quot; level=debug msg=&quot;socket length for C:\\Users\\Jeff Maury\\.config\\containers\\podman\\machine\\wsl is 57&quot; time=&quot;2025-03-07T09:10:00+01:00&quot; level=debug msg=&quot;socket length for C:\\Users\\Jeff Maury\\.local\\share\\containers\\podman\\machine\\wsl is 62&quot; time=&quot;2025-03-07T09:10:00+01:00&quot; level=debug msg=&quot;socket length for C:\\Users\\Jeff Maury\\.local\\share\\containers\\podman\\machine\\wsl\\cache is 68&quot; time=&quot;2025-03-07T09:10:00+01:00&quot; level=debug msg=&quot;socket length for C:\\Users\\JEFFMA~1\\AppData\\Local\\Temp\\podman is 43&quot; time=&quot;2025-03-07T09:10:00+01:00&quot; level=debug msg=&quot;socket length for C:\\Users\\Jeff Maury\\.config\\containers\\podman\\machine\\wsl\\podman-machine-default.json is 85&quot; time=&quot;2025-03-07T09:10:00+01:00&quot; level=debug msg=&quot;socket length for C:\\Users\\Jeff Maury\\.config\\containers\\podman\\machine\\hyperv is 60&quot; time=&quot;2025-03-07T09:10:00+01:00&quot; level=debug msg=&quot;socket length for C:\\Users\\Jeff Maury\\.local\\share\\containers\\podman\\machine\\hyperv is 65&quot; time=&quot;2025-03-07T09:10:00+01:00&quot; level=debug msg=&quot;socket length for C:\\Users\\Jeff Maury\\.local\\share\\containers\\podman\\machine\\hyperv\\cache is 71&quot; time=&quot;2025-03-07T09:10:00+01:00&quot; level=debug msg=&quot;socket length for C:\\Users\\JEFFMA~1\\AppData\\Local\\Temp\\podman is 43&quot; time=&quot;2025-03-07T09:10:00+01:00&quot; level=debug msg=&quot;socket length for C:\\Users\\Jeff Maury\\.config\\containers\\podman\\machine\\hyperv\\h1.json is 68&quot; time=&quot;2025-03-07T09:10:00+01:00&quot; level=debug msg=&quot;socket length for C:\\Users\\Jeff Maury\\.config\\containers\\podman\\machine\\hyperv\\h3.json is 68&quot; Error: unable to start &quot;h1&quot;: already running time=&quot;2025-03-07T09:10:00+01:00&quot; level=debug msg=&quot;Shutting down engines&quot; ```</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>56</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #25619 from l0rd/machine-cp-flake Fix flake on machine cp e2e test</MESSAGE>
    <SHA>2b0aef554ec2cceb25f47e5681c2e445f6300215</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fix HyperV machines with volumes with names Hyper-V machines failed to start when the path of a volume contained a space. To avoid that we are surrounding the path name with quotation marks before invoking `podman machine ssh`. Fixes https://github.com/containers/podman/issues/25500 Signed-off-by: Mario Loriedo &lt;mario.loriedo@gmail.com&gt;</MESSAGE>
      <SHA>5b63673310df0320684944ca0f0b60c30784090e</SHA>
      <PATCHEDFILES>
        <FILE>pkg/machine/e2e/init_test.go</FILE>
        <FILE>pkg/machine/hyperv/volumes.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fix HyperV machines with volumes with names Hyper-V machines failed to start when the path of a volume contained a space. To avoid that we are surrounding the path name with quotation marks before invoking `podman machine ssh`. Fixes https://github.com/containers/podman/issues/25500 Signed-off-by: Mario Loriedo &lt;mario.loriedo@gmail.com&gt;</MESSAGE>
      <SHA>29cbd55e075c194dea0309bd5903ba76632dd584</SHA>
      <PATCHEDFILES>
        <FILE>pkg/machine/e2e/init_test.go</FILE>
        <FILE>pkg/machine/hyperv/volumes.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fix running machines with volumes containing spaces Machines configured to mount local paths containing spaces failed to start on Hyper-V and silently failed to mount the folder on macOS/Linux. On Hyper-V, where local paths are mounted running a 9p client inside the VM, the local host path needs to be surrounding with quotation marks before using in a `podman machine ssh ...` command. On macOS/Linux, where local paths are mounted using virtiofs, the spaces char is escaped in the unit name so that it is parsed successfully in systemd unit files: ```diff -- enable path with spaces.mount ++ enable path\x20with\x20spaces.mount ``` Fixes https://github.com/containers/podman/issues/25500 Signed-off-by: Mario Loriedo &lt;mario.loriedo@gmail.com&gt;</MESSAGE>
      <SHA>bcf1468408d8f87ce46644561d5b2cbaab94dcb9</SHA>
      <PATCHEDFILES>
        <FILE>pkg/machine/e2e/init_test.go</FILE>
        <FILE>pkg/machine/hyperv/volumes.go</FILE>
        <FILE>pkg/systemd/parser/split.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fix running machines with volumes containing spaces Machines configured to mount local paths containing spaces failed to start on Hyper-V and silently failed to mount the folder on macOS/Linux. On Hyper-V, where local paths are mounted running a 9p client inside the VM, the local host path needs to be surrounding with quotation marks before using in a `podman machine ssh ...` command. On macOS/Linux, where local paths are mounted using virtiofs, the spaces char is escaped in the unit name so that it is parsed successfully in systemd unit files: ```diff -- enable path with spaces.mount ++ enable path\x20with\x20spaces.mount ``` Fixes https://github.com/containers/podman/issues/25500 Signed-off-by: Mario Loriedo &lt;mario.loriedo@gmail.com&gt;</MESSAGE>
      <SHA>b799103b92d0b6cc7236f85d8d0dfcabffb3e400</SHA>
      <PATCHEDFILES>
        <FILE>pkg/machine/e2e/init_test.go</FILE>
        <FILE>pkg/machine/hyperv/volumes.go</FILE>
        <FILE>pkg/systemd/parser/split.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fix running machines with volumes containing spaces Machines configured to mount local paths containing spaces failed to start on Hyper-V and silently failed to mount the folder on macOS/Linux. On Hyper-V, where local paths are mounted running a 9p client inside the VM, the local host path needs to be surrounded with quotation marks before using in a `podman machine ssh ...` command. The same problem happened on Linux, where the guest path passed to an ssh command was not surrounded with quotations marks. And on macOS/Linux, where local paths are written in systemd unit files, spaces need to be encoded: ```diff -- enable path with spaces.mount ++ enable path\x20with\x20spaces.mount ``` Fixes https://github.com/containers/podman/issues/25500 Signed-off-by: Mario Loriedo &lt;mario.loriedo@gmail.com&gt;</MESSAGE>
      <SHA>7304c5178e63f488d591541e7b1df84d8249b738</SHA>
      <PATCHEDFILES>
        <FILE>pkg/machine/e2e/init_test.go</FILE>
        <FILE>pkg/machine/hyperv/volumes.go</FILE>
        <FILE>pkg/machine/qemu/stubber.go</FILE>
        <FILE>pkg/systemd/parser/split.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fix running machines with volumes containing spaces Machines configured to mount local paths containing spaces failed to start on Hyper-V and silently failed to mount the folder on macOS/Linux. On Hyper-V, where local paths are mounted running a 9p client inside the VM, the local host path needs to be surrounding with quotation marks before using in a `podman machine ssh ...` command. On macOS/Linux, where local paths are mounted using virtiofs, the spaces char is escaped in the unit name so that it is parsed successfully in systemd unit files: ```diff -- enable path with spaces.mount ++ enable path\x20with\x20spaces.mount ``` Fixes https://github.com/containers/podman/issues/25500 Signed-off-by: Mario Loriedo &lt;mario.loriedo@gmail.com&gt;</MESSAGE>
      <SHA>d2f2775933ae766b155cd33530134fe9a7ab57df</SHA>
      <PATCHEDFILES>
        <FILE>pkg/machine/e2e/init_test.go</FILE>
        <FILE>pkg/machine/hyperv/volumes.go</FILE>
        <FILE>pkg/systemd/parser/split.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fix running machines with volumes containing spaces Machines configured to mount local paths containing spaces failed to start on Hyper-V and silently failed to mount the folder on macOS/Linux. On Hyper-V, where local paths are mounted running a 9p client inside the VM, the local host path needs to be surrounding with quotation marks before using in a `podman machine ssh ...` command. On macOS/Linux, where local paths are mounted using virtiofs, the spaces char is escaped in the unit name so that it is parsed successfully in systemd unit files: ```diff -- enable path with spaces.mount ++ enable path\x20with\x20spaces.mount ``` Fixes https://github.com/containers/podman/issues/25500 Signed-off-by: Mario Loriedo &lt;mario.loriedo@gmail.com&gt;</MESSAGE>
      <SHA>81ed46b1dce8c56f5ec39a195715e4ce3a64d839</SHA>
      <PATCHEDFILES>
        <FILE>pkg/machine/e2e/init_test.go</FILE>
        <FILE>pkg/machine/hyperv/volumes.go</FILE>
        <FILE>pkg/machine/qemu/stubber.go</FILE>
        <FILE>pkg/systemd/parser/split.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fix running machines with volumes containing spaces Machines configured to mount local paths containing spaces failed to start on Hyper-V and silently failed to mount the folder on macOS/Linux. On Windows/hyperv, where local paths are mounted running a 9p client inside the VM, the local host path needs to be surrounding with quotation marks before using in a `podman machine ssh ...` command. A similar behavior happened on Linux/QEMU where the path was used in a SSH command to mount the folder using virtiofs. Quoting the path when buidling the command arguments fixed the problem. On macOS/libkit,applehv the path was written as is in a systemd unit name to instruct how to mount it. Escaping space chars so that they are are parsed successfully fixed this: ```diff -- enable path with spaces.mount ++ enable path\x20with\x20spaces.mount ``` Fixes https://github.com/containers/podman/issues/25500 Signed-off-by: Mario Loriedo &lt;mario.loriedo@gmail.com&gt;</MESSAGE>
      <SHA>8e6ecb97c95b6c33b63f439eee61f7e30585b8d1</SHA>
      <PATCHEDFILES>
        <FILE>pkg/machine/e2e/init_test.go</FILE>
        <FILE>pkg/machine/hyperv/volumes.go</FILE>
        <FILE>pkg/machine/qemu/stubber.go</FILE>
        <FILE>pkg/systemd/parser/split.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fix running machines with volumes containing spaces Machines configured to mount local paths containing spaces failed to start on Hyper-V and silently failed to mount the folder on macOS/Linux. On Windows/hyperv, where local paths are mounted running a 9p client inside the VM, the local host path needs to be surrounding with quotation marks before using in a `podman machine ssh ...` command. A similar behavior happened on Linux/QEMU where the path was used in a SSH command to mount the folder using virtiofs. Quoting the path when buidling the command arguments fixed the problem. On macOS/libkit,applehv the path was written as is in a systemd unit name to instruct how to mount it. Escaping space chars so that they are are parsed successfully fixed this: ```diff -- enable path with spaces.mount ++ enable path\x20with\x20spaces.mount ``` Fixes https://github.com/containers/podman/issues/25500 Signed-off-by: Mario Loriedo &lt;mario.loriedo@gmail.com&gt;</MESSAGE>
      <SHA>d358e918172d16d59b7c312d088cb745ba071843</SHA>
      <PATCHEDFILES>
        <FILE>pkg/machine/e2e/init_test.go</FILE>
        <FILE>pkg/machine/hyperv/volumes.go</FILE>
        <FILE>pkg/machine/qemu/stubber.go</FILE>
        <FILE>pkg/systemd/parser/split.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
