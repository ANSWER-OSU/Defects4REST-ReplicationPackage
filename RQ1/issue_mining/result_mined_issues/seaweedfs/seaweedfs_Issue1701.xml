<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>1701</ISSUENO>
  <ISSUEURL>https://github.com/seaweedfs/seaweedfs/issues/1701</ISSUEURL>
  <TITLE>[filer] Internal looping ListDirectoryPrefixedEntries (Critical)</TITLE>
  <DESCRIPTION>**Describe the bug** CPU load 100% and internal looping ListDirectoryPrefixedEntries **System Setup** ```2.16``` from master branch **Additional context** ``` I1223 16:53:28 1 filerstore_wrapper.go:224] ListDirectoryPrefixedEntries /buckets/registry/docker/registry/v2/repositories/library/seaweedfs/_uploads/22c98200-169f-4535-b013-e87a63c598f8/hashstates/sha256 from prefix limit 8 I1223 16:53:28 1 filer_client.go:113] read directory: directory:&quot;/buckets/registry/docker/registry/v2/repositories/library/seaweedfs/_uploads/22c98200-169f-4535-b013-e87a63c598f8/hashstates/sha256&quot; limit:8 I1223 16:53:28 1 filer_client.go:113] read directory: directory:&quot;/buckets/registry/docker/registry/v2/repositories/library/seaweedfs/_uploads/22c98200-169f-4535-b013-e87a63c598f8/hashstates/sha256&quot; limit:8 I1223 16:53:28 1 filer_grpc_server.go:49] ListEntries directory:&quot;/buckets/registry/docker/registry/v2/repositories/library/seaweedfs/_uploads/22c98200-169f-4535-b013-e87a63c598f8/hashstates/sha256&quot; limit:8 I1223 16:53:28 1 filerstore_wrapper.go:224] ListDirectoryPrefixedEntries /buckets/registry/docker/registry/v2/repositories/library/seaweedfs/_uploads/22c98200-169f-4535-b013-e87a63c598f8/hashstates/sha256 from prefix limit 8 I1223 16:53:28 1 filer_client.go:113] read directory: directory:&quot;/buckets/registry/docker/registry/v2/repositories/library/seaweedfs/_uploads/22c98200-169f-4535-b013-e87a63c598f8/hashstates/sha256&quot; limit:8 I1223 16:53:28 1 filer_grpc_server.go:49] ListEntries directory:&quot;/buckets/registry/docker/registry/v2/repositories/library/seaweedfs/_uploads/22c98200-169f-4535-b013-e87a63c598f8/hashstates/sha256&quot; limit:8 I1223 16:53:28 1 filerstore_wrapper.go:224] ListDirectoryPrefixedEntries /buckets/registry/docker/registry/v2/repositories/library/seaweedfs/_uploads/22c98200-169f-4535-b013-e87a63c598f8/hashstates/sha256 from prefix limit 8 I1223 16:53:28 1 filer_client.go:113] read directory: directory:&quot;/buckets/registry/docker/registry/v2/repositories/library/seaweedfs/_uploads/22c98200-169f-4535-b013-e87a63c598f8/hashstates/sha256&quot; limit:8 ```</DESCRIPTION>
  <REPONAME>seaweedfs</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge branch 'master' into support_ssd_volume</MESSAGE>
    <SHA>1c7e1295dc4c91ab55920af9082498b55bdc3e66</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>s3: break loop if error fix https://github.com/chrislusf/seaweedfs/issues/1701</MESSAGE>
      <SHA>db62090f88b6af9d44c7a92f8ccb075e93b3d9a3</SHA>
      <PATCHEDFILES>
        <FILE>weed/s3api/s3api_objects_list_handlers.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>s3: avoid looping if the directory is empty fix https://github.com/chrislusf/seaweedfs/issues/1701</MESSAGE>
      <SHA>8e48a235e2e0eb3edaeb30aa82b3c5624d564e01</SHA>
      <PATCHEDFILES>
        <FILE>weed/s3api/s3api_objects_list_handlers.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
