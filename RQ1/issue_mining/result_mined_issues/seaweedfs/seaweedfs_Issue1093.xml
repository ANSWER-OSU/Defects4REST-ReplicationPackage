<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>1093</ISSUENO>
  <ISSUEURL>https://github.com/seaweedfs/seaweedfs/issues/1093</ISSUEURL>
  <TITLE>Server disconnects when volumes become unwritable</TITLE>
  <DESCRIPTION>**Describe the bug** Time to time servers disconnect when volumes become unwritable. **System Setup** Master server command ``` master ``` Volume server command ``` volume -max=50 -mserver=&quot;scrooge-weed-master:9333&quot; -publicUrl=&quot;10.178.3.20:8081&quot; -port=8081 ``` **Expected behavior** Servers never disconnect. **Logs** Master logs: ``` I1023 08:35:42 1 master_grpc_server.go:24] unregister disconnected volume server 172.16.238.50:8081 I1023 08:35:42 1 topology_event_handling.go:57] Removing Volume 5 from the dead volume server 172.16.238.50:8081 I1023 08:35:42 1 volume_layout.go:261] Volume 5 has 0 replica, less than required 1 I1023 08:35:42 1 volume_layout.go:237] Volume 5 becomes unwritable I1023 08:35:42 1 topology_event_handling.go:57] Removing Volume 3 from the dead volume server 172.16.238.50:8081 I1023 08:35:42 1 volume_layout.go:261] Volume 3 has 0 replica, less than required 1 I1023 08:35:42 1 volume_layout.go:237] Volume 3 becomes unwritable I1023 08:35:42 1 topology_event_handling.go:57] Removing Volume 4 from the dead volume server 172.16.238.50:8081 I1023 08:35:42 1 volume_layout.go:261] Volume 4 has 0 replica, less than required 1 I1023 08:35:42 1 volume_layout.go:237] Volume 4 becomes unwritable I1023 08:35:42 1 topology_event_handling.go:57] Removing Volume 2 from the dead volume server 172.16.238.50:8081 I1023 08:35:42 1 volume_layout.go:261] Volume 2 has 0 replica, less than required 1 I1023 08:35:42 1 volume_layout.go:237] Volume 2 becomes unwritable I1023 08:35:42 1 topology_event_handling.go:57] Removing Volume 1 from the dead volume server 172.16.238.50:8081 I1023 08:35:42 1 volume_layout.go:261] Volume 1 has 0 replica, less than required 1 I1023 08:35:42 1 volume_layout.go:237] Volume 1 becomes unwritable I1023 08:35:42 1 node.go:256] topo:DefaultDataCenter:DefaultRack removes 172.16.238.50:8081 I1023 08:36:02 1 node.go:241] topo:DefaultDataCenter:DefaultRack adds child 172.16.238.50:8081 I1023 08:36:02 1 master_grpc_server.go:72] added volume server 172.16.238.50:8081 I1023 08:36:02 1 master_grpc_server.go:102] master see new volume 5 from 172.16.238.50:8081 I1023 08:36:02 1 master_grpc_server.go:102] master see new volume 3 from 172.16.238.50:8081 I1023 08:36:02 1 master_grpc_server.go:102] master see new volume 4 from 172.16.238.50:8081 I1023 08:36:02 1 master_grpc_server.go:102] master see new volume 2 from 172.16.238.50:8081 I1023 08:36:02 1 master_grpc_server.go:102] master see new volume 1 from 172.16.238.50:8081 I1023 08:36:02 1 master_grpc_server.go:148] master send to master172.16.238.75:54168: url:&quot;172.16.238.50:8081&quot; public_url:&quot;10.26.111.25:8081&quot; new_vids:5 new_vids:3 new_vids:4 new_vids:2 new_vids:1 I1023 08:36:02 1 master_grpc_server.go:24] unregister disconnected volume server 172.16.238.50:8081 I1023 08:36:02 1 topology_event_handling.go:57] Removing Volume 5 from the dead volume server 172.16.238.50:8081 I1023 08:36:02 1 volume_layout.go:261] Volume 5 has 0 replica, less than required 1 I1023 08:36:02 1 volume_layout.go:237] Volume 5 becomes unwritable I1023 08:36:02 1 topology_event_handling.go:57] Removing Volume 3 from the dead volume server 172.16.238.50:8081 I1023 08:36:02 1 volume_layout.go:261] Volume 3 has 0 replica, less than required 1 I1023 08:36:02 1 volume_layout.go:237] Volume 3 becomes unwritable I1023 08:36:02 1 topology_event_handling.go:57] Removing Volume 4 from the dead volume server 172.16.238.50:8081 I1023 08:36:02 1 volume_layout.go:261] Volume 4 has 0 replica, less than required 1 I1023 08:36:02 1 volume_layout.go:237] Volume 4 becomes unwritable I1023 08:36:02 1 topology_event_handling.go:57] Removing Volume 2 from the dead volume server 172.16.238.50:8081 I1023 08:36:02 1 volume_layout.go:261] Volume 2 has 0 replica, less than required 1 I1023 08:36:02 1 volume_layout.go:237] Volume 2 becomes unwritable I1023 08:36:02 1 topology_event_handling.go:57] Removing Volume 1 from the dead volume server 172.16.238.50:8081 I1023 08:36:02 1 volume_layout.go:261] Volume 1 has 0 replica, less than required 1 I1023 08:36:02 1 volume_layout.go:237] Volume 1 becomes unwritable I1023 08:36:02 1 node.go:256] topo:DefaultDataCenter:DefaultRack removes 172.16.238.50:8081 I1023 08:36:02 1 node.go:241] topo:DefaultDataCenter:DefaultRack adds child 172.16.238.50:8081 I1023 08:36:02 1 master_grpc_server.go:72] added volume server 172.16.238.50:8081 I1023 08:36:02 1 master_grpc_server.go:102] master see new volume 3 from 172.16.238.50:8081 I1023 08:36:02 1 master_grpc_server.go:102] master see new volume 4 from 172.16.238.50:8081 I1023 08:36:02 1 master_grpc_server.go:102] master see new volume 2 from 172.16.238.50:8081 I1023 08:36:02 1 master_grpc_server.go:102] master see new volume 1 from 172.16.238.50:8081 I1023 08:36:02 1 master_grpc_server.go:102] master see new volume 5 from 172.16.238.50:8081 I1023 08:36:02 1 master_grpc_server.go:148] master send to master172.16.238.75:54168: url:&quot;172.16.238.50:8081&quot; public_url:&quot;10.26.111.25:8081&quot; new_vids:3 new_vids:4 new_vids:2 new_vids:1 new_vids:5 ``` Volume logs: ``` I1023 08:35:57 1 volume_grpc_client_to_master.go:160] Volume Server Failed to talk with master 172.16.238.75:9333: EOF I1023 08:35:57 1 volume_grpc_client_to_master.go:45] heartbeat error: EOF I1023 08:36:02 1 volume_grpc_client_to_master.go:68] Heartbeat to: scrooge-weed-master:9333 I1023 08:36:02 1 volume_grpc_client_to_master.go:84] Volume Server found a new master newLeader: 172.16.238.75:9333 instead of scrooge-weed-master:9333 I1023 08:36:02 1 volume_grpc_client_to_master.go:68] Heartbeat to: 172.16.238.75:9333 ``` Possible related to #499 ``` dell âžœ ~ weed version version 30GB 1.44 linux amd64 ```</DESCRIPTION>
  <REPONAME>seaweedfs</REPONAME>
  <TIMEDIFFERENCEDAYS>47</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>go fmt</MESSAGE>
    <SHA>69de05f6cbc5ed506a6f045c31823b5a0d844c03</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>master: add logging for volume server disconnection add logging for https://github.com/chrislusf/seaweedfs/issues/1093</MESSAGE>
      <SHA>55a2221eba881304f8c5a877d1e72ba2829f5b5a</SHA>
      <PATCHEDFILES>
        <FILE>weed/server/master_grpc_server.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
