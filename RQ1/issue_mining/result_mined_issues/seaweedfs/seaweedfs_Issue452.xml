<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>452</ISSUENO>
  <ISSUEURL>https://github.com/seaweedfs/seaweedfs/issues/452</ISSUEURL>
  <TITLE>master panic in SendHeartbeat</TITLE>
  <DESCRIPTION>cause: `glog.V(0).Infof(&quot;lost volume server %s:%d&quot;, dn.Ip, dn.Port)` when dn == nil call trace: panic: runtime error: invalid memory address or nil pointer dereference [signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0xa65005] goroutine 60 [running]: github.com/chrislusf/seaweedfs/weed/server.MasterServer.SendHeartbeat(0x2475, 0x0, 0x0, 0x7530, 0x0, 0x5, 0xc6ebe1, 0x3, 0xc6ebde, 0x3, ...) /home/travis/gopath/src/github.com/chrislusf/seaweedfs/weed/server/master_grpc_server.go:62 +0xc85 github.com/chrislusf/seaweedfs/weed/server.(*MasterServer).SendHeartbeat(0xc4201ae300, 0x1015160, 0xc4202da6d0, 0x1005de0, 0xc4201ae300) &lt;autogenerated&gt;:1 +0x9a github.com/chrislusf/seaweedfs/weed/pb._Seaweed_SendHeartbeat_Handler(0xc47520, 0xc4201ae300, 0x1013d80, 0xc4202ec500, 0xc42025ce10, 0xc4202ee900) /home/travis/gopath/src/github.com/chrislusf/seaweedfs/weed/pb/seaweed.pb.go:308 +0xb7 google.golang.org/grpc.(*Server).processStreamingRPC(0xc4201cf6c0, 0x1014800, 0xc4202f42a0, 0xc4202ee900, 0xc42024ee70, 0x103c880, 0xc4202d2d20, 0x0, 0x0) /home/travis/gopath/src/google.golang.org/grpc/server.go:819 +0x7b9 google.golang.org/grpc.(*Server).handleStream(0xc4201cf6c0, 0x1014800, 0xc4202f42a0, 0xc4202ee900, 0xc4202d2d20) /home/travis/gopath/src/google.golang.org/grpc/server.go:909 +0x11fd google.golang.org/grpc.(*Server).serveStreams.func1.1(0xc4202da610, 0xc4201cf6c0, 0x1014800, 0xc4202f42a0, 0xc4202ee900) /home/travis/gopath/src/google.golang.org/grpc/server.go:478 +0xa9 created by google.golang.org/grpc.(*Server).serveStreams.func1 /home/travis/gopath/src/google.golang.org/grpc/server.go:479 +0xa1 all logs before panic: ./weed master -mdir=/home/worker/data/weed/master -ip=FBI-1 I0211 22:22:24 17780 file_util.go:20] Folder /home/worker/data/weed/master Permission: -rwxr-xr-x I0211 22:22:24 17780 topology.go:81] Using default configurations. I0211 22:22:24 17780 master_server.go:67] Volume Size Limit is 30000 MB I0211 22:22:24 17780 master.go:88] Start Seaweed Master 0.74 at 0.0.0.0:9333 I0211 22:22:24 17780 raft_server.go:56] Peers Change: [FBI-1:9333] =&gt; [] I0211 22:22:24 17780 raft_server.go:98] Initializing new cluster I0211 22:22:24 17780 master_server.go:100] [ FBI-1:9333 ] I am the leader! I0211 22:22:25 17780 node.go:223] topo adds child DefaultDataCenter I0211 22:22:25 17780 node.go:223] topo:DefaultDataCenter adds child DefaultRack I0211 22:22:25 17780 node.go:223] topo:DefaultDataCenter:DefaultRack adds child FBI-1:8080 I0211 22:22:25 17780 master_grpc_server.go:36] added volume server FBI-1:8080 I0211 22:22:58 17780 master_grpc_server.go:62] lost volume server FBI-1:8080 I0211 22:22:58 17780 topology_event_handling.go:52] Removing Volume 1 from the dead volume server FBI-1:8080 I0211 22:22:58 17780 volume_layout.go:221] Volume 1 has 0 replica, less than required 2 I0211 22:22:58 17780 topology_event_handling.go:52] Removing Volume 3 from the dead volume server FBI-1:8080 I0211 22:22:58 17780 volume_layout.go:221] Volume 3 has 0 replica, less than required 2 I0211 22:22:58 17780 topology_event_handling.go:52] Removing Volume 4 from the dead volume server FBI-1:8080 I0211 22:22:58 17780 volume_layout.go:221] Volume 4 has 0 replica, less than required 2 I0211 22:22:58 17780 topology_event_handling.go:52] Removing Volume 5 from the dead volume server FBI-1:8080 I0211 22:22:58 17780 volume_layout.go:221] Volume 5 has 0 replica, less than required 2 I0211 22:22:58 17780 topology_event_handling.go:52] Removing Volume 2 from the dead volume server FBI-1:8080 I0211 22:22:58 17780 volume_layout.go:221] Volume 2 has 0 replica, less than required 2 I0211 22:22:58 17780 node.go:237] topo:DefaultDataCenter:DefaultRack removes FBI-1:8080 I0211 22:23:01 17780 node.go:223] topo:DefaultDataCenter:DefaultRack adds child FBI-1:8080 I0211 22:23:01 17780 master_grpc_server.go:36] added volume server FBI-1:8080</DESCRIPTION>
  <REPONAME>seaweedfs</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Update Dockerfile Bump docker base image version to alpine 3.5</MESSAGE>
    <SHA>275446c0723ca691ac1416b00684553e5b7bd203</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>avoid nil fix https://github.com/chrislusf/seaweedfs/issues/452</MESSAGE>
      <SHA>96ac222002548d2f8dccbb0ad9a2f014a7a08a8e</SHA>
      <PATCHEDFILES>
        <FILE>weed/server/master_grpc_server.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
