<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>2371</ISSUENO>
  <ISSUEURL>https://github.com/seaweedfs/seaweedfs/issues/2371</ISSUEURL>
  <TITLE>[s3] Content Disposition support</TITLE>
  <DESCRIPTION>**Describe the bug** ContentDisposition and ResponseContentDisposition parameters are ignored When using s3 api, ContentDisposition is always set to 'inline; filename=&lt;key&gt;' Example with boto3: Setting ContentDisposition during put: ```python3 s3.put_object(Bucket='test', Key='test.jpeg', Body='test.jpeg', ContentDisposition='attachment; filename=&quot;test.jpeg') {'ResponseMetadata': {'RequestId': '1633946607781063224', 'HostId': '', 'HTTPStatusCode': 200, 'HTTPHeaders': {'date': 'Mon, 11 Oct 2021 10:03:27 GMT', 'content-length': '0', 'connection': 'keep-alive', 'accept-ranges': 'bytes', 'etag': '&quot;bb1469ad3d21a04760cf719a86f2e7be&quot;', 'x-amz-request-id': '1633946607781063224', 'strict-transport-security': 'max-age=15724800; includeSubDomains', }, 'RetryAttempts': 0}, 'ETag': '&quot;bb1469ad3d21a04760cf719a86f2e7be&quot;'} s3.get_object(Bucket='test', Key='test.jpeg') {'ResponseMetadata': {'HTTPStatusCode': 200, 'HTTPHeaders': {'date': 'Mon, 11 Oct 2021 10:03:45 GMT', 'content-type': 'image/jpeg', 'content-length': '9', 'connection': 'keep-alive', 'accept-ranges': 'bytes', 'content-disposition': 'inline; filename=&quot;test.jpeg&quot;', 'etag': '&quot;bb1469ad3d21a04760cf719a86f2e7be&quot;', 'last-modified': 'Mon, 11 Oct 2021 10:03:27 GMT', 'strict-transport-security': 'max-age=15724800; includeSubDomains', }, 'RetryAttempts': 0}, 'AcceptRanges': 'bytes', 'LastModified': datetime.datetime(2021, 10, 11, 10, 3, 27, tzinfo=tzutc()), 'ContentLength': 9, 'ETag': '&quot;bb1469ad3d21a04760cf719a86f2e7be&quot;', 'ContentDisposition': 'inline; filename=&quot;test.jpeg&quot;', 'ContentType': 'image/jpeg', 'Metadata': {}, 'Body': &lt;botocore.response.StreamingBody at 0x1108820d0&gt;} ``` Setting ResponseContentDisposition: ```python3 s3.get_object(Bucket='test', Key='test.jpeg', ResponseContentDisposition='attachment; filename=test.jpeg') {'ResponseMetadata': {'HTTPStatusCode': 200, 'HTTPHeaders': {'date': 'Mon, 11 Oct 2021 10:07:56 GMT', 'content-type': 'image/jpeg', 'content-length': '9', 'connection': 'keep-alive', 'accept-ranges': 'bytes', 'content-disposition': 'inline; filename=&quot;test.jpeg&quot;', 'etag': '&quot;bb1469ad3d21a04760cf719a86f2e7be&quot;', 'last-modified': 'Mon, 11 Oct 2021 10:03:27 GMT', 'strict-transport-security': 'max-age=15724800; includeSubDomains' }, 'RetryAttempts': 0}, 'AcceptRanges': 'bytes', 'LastModified': datetime.datetime(2021, 10, 11, 10, 3, 27, tzinfo=tzutc()), 'ContentLength': 9, 'ETag': '&quot;bb1469ad3d21a04760cf719a86f2e7be&quot;', 'ContentDisposition': 'inline; filename=&quot;test.jpeg&quot;', 'ContentType': 'image/jpeg', 'Metadata': {}, 'Body': &lt;botocore.response.StreamingBody at 0x110882340&gt;} ``` **System Setup** seaweedfs 2.70 **Expected behavior** Setting ContentDisposition parameter during put should set the ContentDisposition in object metadata, setting ResponseContentDisposition during get should only set this in reposnse metadata</DESCRIPTION>
  <REPONAME>seaweedfs</REPONAME>
  <TIMEDIFFERENCEDAYS>12</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>go fmt</MESSAGE>
    <SHA>f0b928ff5ea43ca9dffe9cc851fc134b190ab155</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>s3: use &quot;response-content-disposition&quot; to overwrite default content-disposition fix one part of https://github.com/chrislusf/seaweedfs/issues/2371 see https://docs.aws.amazon.com/AmazonS3/latest/API/API_GetObject.html</MESSAGE>
      <SHA>8e9273db99888fbfb46c18362af7ab6c527814dc</SHA>
      <PATCHEDFILES>
        <FILE>weed/server/common.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>fier/s3: save &quot;Content-Disposition&quot; to extended properties related to https://github.com/chrislusf/seaweedfs/issues/2371</MESSAGE>
      <SHA>de1ec050e86ba8ba941de7bc3eaf80ce5b6ee208</SHA>
      <PATCHEDFILES>
        <FILE>weed/server/common.go</FILE>
        <FILE>weed/server/filer_server_handlers_write_autochunk.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
