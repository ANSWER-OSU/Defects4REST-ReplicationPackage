<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>2055</ISSUENO>
  <ISSUEURL>https://github.com/seaweedfs/seaweedfs/issues/2055</ISSUEURL>
  <TITLE>Mount point crashed</TITLE>
  <DESCRIPTION>Had a mount point crash: ``` May 07 03:00:00 weatherwax weed[3259922]: E0507 03:00:00 59922 reader_at.go:146] fetching chunk &amp;{FileId:105,0160610d87233a6d Offset:0 Size:574 LogicOffset:20480 ChunkSize:574 CipherKey:[] IsGzipped:true}: http://138.38.108.115:9380/105,0160610d87233a6d&gt; May 07 03:00:00 weatherwax weed[3259922]: E0507 03:00:00 59922 filehandle.go:148] file handle read /homes/ar2056/.bash_history: http://138.38.108.115:9380/105,0160610d87233a6d?readDeleted=true: 404 Not Found May 07 03:00:00 weatherwax weed[3259922]: W0507 03:00:00 59922 filehandle.go:88] file handle read /homes/ar2056/.bash_history 20480: http://138.38.108.115:9380/105,0160610d87233a6d?readDeleted=true: 404 Not Found May 07 03:00:00 weatherwax weed[3259922]: E0507 03:00:00 59922 reader_at.go:146] fetching chunk &amp;{FileId:105,0160610d87233a6d Offset:0 Size:574 LogicOffset:20480 ChunkSize:574 CipherKey:[] IsGzipped:true}: http://138.38.108.125:9380/105,0160610d87233a6d&gt; May 07 03:00:00 weatherwax weed[3259922]: E0507 03:00:00 59922 filehandle.go:148] file handle read /homes/ar2056/.bash_history: http://138.38.108.125:9380/105,0160610d87233a6d?readDeleted=true: 404 Not Found May 07 03:00:00 weatherwax weed[3259922]: W0507 03:00:00 59922 filehandle.go:88] file handle read /homes/ar2056/.bash_history 0: http://138.38.108.125:9380/105,0160610d87233a6d?readDeleted=true: 404 Not Found May 07 07:43:26 weatherwax weed[3259922]: panic: runtime error: invalid memory address or nil pointer dereference May 07 07:43:26 weatherwax weed[3259922]: [signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0x1bb85ad] May 07 07:43:26 weatherwax weed[3259922]: goroutine 229 [running]: May 07 07:43:26 weatherwax weed[3259922]: github.com/seaweedfs/fuse/fs.(*Server).InvalidateEntry(0xc0002ba8c0, 0x2613d40, 0xc002859690, 0xc00114c3b5, 0x9, 0x0, 0x0) May 07 07:43:26 weatherwax weed[3259922]: /home/travis/gopath/pkg/mod/github.com/seaweedfs/fuse@v1.1.4/fs/serve.go:1851 +0xcd May 07 07:43:26 weatherwax weed[3259922]: github.com/chrislusf/seaweedfs/weed/filesys.NewSeaweedFileSystem.func2(0xc00114c3a0, 0x1e) May 07 07:43:26 weatherwax weed[3259922]: /home/travis/gopath/src/github.com/chrislusf/seaweedfs/weed/filesys/wfs.go:117 +0x185 May 07 07:43:26 weatherwax weed[3259922]: github.com/chrislusf/seaweedfs/weed/filesys/meta_cache.NewMetaCache.func1(0xc00114c3a0, 0x1e) May 07 07:43:26 weatherwax weed[3259922]: /home/travis/gopath/src/github.com/chrislusf/seaweedfs/weed/filesys/meta_cache/meta_cache.go:33 +0x39 May 07 07:43:26 weatherwax weed[3259922]: github.com/chrislusf/seaweedfs/weed/filesys/meta_cache.SubscribeMetaEvents.func1(0xc008d90230, 0xc008d90230, 0x0) May 07 07:43:26 weatherwax weed[3259922]: /home/travis/gopath/src/github.com/chrislusf/seaweedfs/weed/filesys/meta_cache/meta_cache_subscribe.go:45 +0x40c May 07 07:43:26 weatherwax weed[3259922]: github.com/chrislusf/seaweedfs/weed/filesys/meta_cache.SubscribeMetaEvents.func2(0x266bc68, 0xc000876580, 0x0, 0x0) May 07 07:43:26 weatherwax weed[3259922]: /home/travis/gopath/src/github.com/chrislusf/seaweedfs/weed/filesys/meta_cache/meta_cache_subscribe.go:75 +0x2c4 May 07 07:43:26 weatherwax weed[3259922]: github.com/chrislusf/seaweedfs/weed/filesys.(*WFS).WithFilerClient.func1.1(0xc000b0e000, 0x14, 0xc0016d5e00) May 07 07:43:26 weatherwax weed[3259922]: /home/travis/gopath/src/github.com/chrislusf/seaweedfs/weed/filesys/wfs_filer_client.go:18 +0x76 May 07 07:43:26 weatherwax weed[3259922]: github.com/chrislusf/seaweedfs/weed/pb.WithCachedGrpcClient(0xc0016d5e10, 0xc0005a7d70, 0x14, 0xc0016d5e00, 0x1, 0x1, 0x22df9b0, 0xc0014f0320) May 07 07:43:26 weatherwax weed[3259922]: /home/travis/gopath/src/github.com/chrislusf/seaweedfs/weed/pb/grpc_client_server.go:108 +0x15f May 07 07:43:26 weatherwax weed[3259922]: github.com/chrislusf/seaweedfs/weed/filesys.(*WFS).WithFilerClient.func1(0x861c4680, 0x0) May 07 07:43:26 weatherwax weed[3259922]: /home/travis/gopath/src/github.com/chrislusf/seaweedfs/weed/filesys/wfs_filer_client.go:16 +0x9b May 07 07:43:26 weatherwax weed[3259922]: github.com/chrislusf/seaweedfs/weed/util.Retry(0xc00032a200, 0x1f, 0xc0016d5f08, 0xc0005a7d70, 0x14) May 07 07:43:26 weatherwax weed[3259922]: /home/travis/gopath/src/github.com/chrislusf/seaweedfs/weed/util/retry.go:16 +0x91 May 07 07:43:26 weatherwax weed[3259922]: github.com/chrislusf/seaweedfs/weed/filesys.(*WFS).WithFilerClient(0xc0009bcd00, 0xc0015c0030, 0x2267635, 0x21) May 07 07:43:26 weatherwax weed[3259922]: /home/travis/gopath/src/github.com/chrislusf/seaweedfs/weed/filesys/wfs_filer_client.go:15 +0xab May 07 07:43:26 weatherwax weed[3259922]: github.com/chrislusf/seaweedfs/weed/filesys/meta_cache.SubscribeMetaEvents(0xc000337100, 0xf751e10e, 0x262aa10, 0xc0009bcd00, 0x2225dce, 0x1, 0x167b107fcbd55bc9, 0xc000154740, 0x32) May 07 07:43:26 weatherwax weed[3259922]: /home/travis/gopath/src/github.com/chrislusf/seaweedfs/weed/filesys/meta_cache/meta_cache_subscribe.go:53 +0x11e May 07 07:43:26 weatherwax weed[3259922]: created by github.com/chrislusf/seaweedfs/weed/filesys.NewSeaweedFileSystem May 07 07:43:26 weatherwax weed[3259922]: /home/travis/gopath/src/github.com/chrislusf/seaweedfs/weed/filesys/wfs.go:122 +0x473 May 07 07:43:26 weatherwax systemd[1]: seaweed-mount.service: Main process exited, code=exited, status=2/INVALIDARGUMENT May 07 07:43:26 weatherwax systemd[1]: seaweed-mount.service: Failed with result 'exit-code'. ``` Don't think they are helpful, as they look like the messages you would expect after a crash, but here is the filer on that node and master at the same time. Nothing in the volumes: Filer: ``` May 07 07:43:23 weatherwax weed[3259835]: I0507 07:43:23 59835 meta_aggregator.go:151] subscribing remote 138.38.108.119:8888 meta change: rpc error: code = Unavailable desc = transport is closing May 07 07:43:26 weatherwax weed[3259835]: I0507 07:43:26 59835 filer_grpc_server_sub_meta.go:187] =&gt; client mount@138.38.108.125:39534: rpc error: code = Unavailable desc = transport is closing May 07 07:43:26 weatherwax weed[3259835]: E0507 07:43:26 59835 filer_grpc_server_sub_meta.go:56] processed to 2021-05-07 07:43:26.181162812 +0000 UTC: rpc error: code = Unavailable desc = transport is closing May 07 07:43:29 weatherwax weed[3259835]: I0507 07:43:29 59835 filer_grpc_server_sub_meta.go:201] - listener mount@138.38.108.125:39534 ``` Master: ``` May 07 07:43:50 weatherwax weed[3259663]: I0507 07:43:50 59663 master_grpc_server.go:265] - client master@138.38.108.125:52366 May 07 07:43:50 weatherwax weed[3259663]: I0507 07:43:50 59663 masterclient.go:120] master masterClient failed to receive from 138.38.108.125:9333: rpc error: code = Unavailable desc = transport is closing May 07 07:43:50 weatherwax weed[3259663]: I0507 07:43:50 59663 master_grpc_server.go:249] + client master@138.38.108.125:49216 ``` Afraid I have no idea what was occuring on the computer during the crash, but it seems doubtful that any students were up and using the server at that time;-) Plenty of processes running that could be doing anything however. Seaweed 2.43, fully distributed and secure setup over 7 nodes - happy to provide setup details if useful!</DESCRIPTION>
  <REPONAME>seaweedfs</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #2052 from jbarotin/master Add exists() to java client</MESSAGE>
    <SHA>84397b814aaacac87ea1a83b788829928b85bae0</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>fuse: avoid nil when invalidating entry fix https://github.com/chrislusf/seaweedfs/issues/2055</MESSAGE>
      <SHA>930581cedc00c86cfbc711efe0b99d7e65f09d11</SHA>
      <PATCHEDFILES>
        <FILE>go.mod</FILE>
        <FILE>go.sum</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
