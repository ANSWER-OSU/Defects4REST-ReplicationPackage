<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>1776</ISSUENO>
  <ISSUEURL>https://github.com/seaweedfs/seaweedfs/issues/1776</ISSUEURL>
  <TITLE>S3 should return 204 on DELETE to nonexistent file (not 404)</TITLE>
  <DESCRIPTION>**Describe the bug** The Amazon S3 api specification states that a DELETE request to a non-existing file should return HTTP status `HTTP/1.1 204 No Content`, as described [here](https://docs.aws.amazon.com/AmazonS3/latest/API/API_DeleteObject.html). Currently, seaweedfs S3 implementation returns `404 Not Found`. **System Setup** - List the command line to start: `./weed server -s3 -s3.config=config.json -dir=&quot;/minio/weed&quot; -volume.max=100` - OS version: `CentOS 8` - output of `weed version`: `version 30GB 2.23 318a3d2 linux amd64` **Expected behavior** Seaweedfs should follow the Amazon S3 API specification and return HTTP 204 status-code when issuing a DELETE request to a non-existing file. This is important for compatibility with applications expecting S3 behavior. **Additional context** I stumbled upon this problem when attempting to use [pgbackrest](https://pgbackrest.org/) postgres backup software configured with seaweedfs S3 API as storage. When performing a regular backup, pgbackrest would almost finish but at the end run into an exception: ``` 2021-02-02 16:04:39.364 P00 DEBUG: common/io/http/request::httpRequestResponse: =&gt; {code: 404, reason: Not Found, header: {accept-ranges: 'bytes', content-length: '234', content-type: 'application/xml', date: 'Tue, 02 Feb 2021 15:04:39 GMT', server: 'SeaweedFS S3 30GB 2.23', x-amz-request-id: '1612278279364142795'}, contentChunked: false, contentSize: 234, contentRemaining: 0, closeOnContentEof: false, contentExists: true, contentEof: true, contentCached: true} 2021-02-02 16:04:39.365 P00 DEBUG: common/exit::exitSafe: (result: 0, error: true, signalType: 0) ERROR: [039]: HTTP request failed with 404 (Not Found): *** URI/Query ***: /dev-pgbackrest/backup/dev-pg-f3c001/latest *** Request Headers ***: authorization: &lt;redacted&gt; content-length: 0 host: dev-seaweed-backup001-vip.&lt;redacted&gt; x-amz-content-sha256: e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855 x-amz-date: &lt;redacted&gt; *** Response Headers ***: accept-ranges: bytes content-length: 234 content-type: application/xml date: Tue, 02 Feb 2021 15:04:39 GMT server: SeaweedFS S3 30GB 2.23 x-amz-request-id: 1612278279364142795 *** Response Content ***: &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;Error&gt;&lt;Code&gt;NoSuchKey&lt;/Code&gt;&lt;Message&gt;The specified key does not exist.&lt;/Message&gt;&lt;Resource&gt;/dev-pgbackrest/backup/dev-pg-f3c001/latest&lt;/Resource&gt;&lt;RequestId&gt;1612278279364119515&lt;/RequestId&gt;&lt;/Error&gt; ``` Searching for this error came up with this pgbackrest bug; https://github.com/pgbackrest/pgbackrest/issues/985 which details the same problem of an S3 implementation returning 404 for DELETE. I think this problem stems from issue #1160 where it was incorrectly stated that the API should return 404 in this case. Please let me know if I can provide additional information!</DESCRIPTION>
  <REPONAME>seaweedfs</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>S3: should return 204 on DELETE to nonexistent file fix https://github.com/chrislusf/seaweedfs/issues/1776</MESSAGE>
    <SHA>5353e384696764af171e9479bd2cf488c0422be3</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>filer: should return 204 on DELETE to nonexistent file related to https://github.com/chrislusf/seaweedfs/issues/1776 https://github.com/chrislusf/seaweedfs/issues/1160</MESSAGE>
      <SHA>a331bbb3ae7b75025850f67a5758812fddfe0ecd</SHA>
      <PATCHEDFILES>
        <FILE>weed/server/filer_server_handlers_write.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
