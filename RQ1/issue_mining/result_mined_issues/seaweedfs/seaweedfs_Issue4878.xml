<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>4878</ISSUENO>
  <ISSUEURL>https://github.com/seaweedfs/seaweedfs/issues/4878</ISSUEURL>
  <TITLE>Panic in lock_table_test on 32-bit</TITLE>
  <DESCRIPTION>**Describe the bug** Hello, while running the test suite of SeaweedFS 3.57 on x86, i encountered a panic in lock_table_test.go: ``` Now we need to generate a 256-bit key for AES 256 GCM -- Executing third function -- -- Executing first function -- -- Executing second function -- -- Third Function finished -- -- Executing fourth function -- -- Second Function finished -- -- Executing fifth function -- -- First Function finished -- 1 2 3 -- Fourth fifth finished -- -- Fourth Function finished -- 4 5 panic: unaligned 64-bit atomic operation goroutine 111 [running]: runtime/internal/atomic.panicUnaligned() runtime/internal/atomic/unaligned.go:8 +0x38 runtime/internal/atomic.Xadd64(0x58e0a15c, 0x1) runtime/internal/atomic/atomic_386.s:125 +0x11 github.com/seaweedfs/seaweedfs/weed/util.(*LockTable[...]).NewActiveLock(0x56e3de00, {0x0, 0x0}, 0x1) github.com/seaweedfs/seaweedfs/weed/util/lock_table.go:47 +0x3b github.com/seaweedfs/seaweedfs/weed/util.(*LockTable[...]).AcquireLock(0x56e3de00, {0x0, 0x0}, {0x56c36fc5, 0x8}, 0x1) github.com/seaweedfs/seaweedfs/weed/util/lock_table.go:63 +0x1a2 github.com/seaweedfs/seaweedfs/weed/util.TestOrderedLock.func1(0x32) github.com/seaweedfs/seaweedfs/weed/util/lock_table_test.go:27 +0xcc created by github.com/seaweedfs/seaweedfs/weed/util.TestOrderedLock in goroutine 61 github.com/seaweedfs/seaweedfs/weed/util/lock_table_test.go:18 +0x9b FAIL github.com/seaweedfs/seaweedfs/weed/util 0.130s ``` **System Setup** - OS version: Alpine Linux edge - Go version: 1.21.1 **Expected behavior** The test passes like it does on x86_64.</DESCRIPTION>
  <REPONAME>seaweedfs</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Allow override internalTrafficPolicy (#4877)</MESSAGE>
    <SHA>f15debbd3b6fbbeb26f97e9f45833201741cd4fc</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>align 64bit atomic operation fix https://github.com/seaweedfs/seaweedfs/issues/4878</MESSAGE>
      <SHA>a41752afced741b116aa71406c5ec92fafc60f38</SHA>
      <PATCHEDFILES>
        <FILE>weed/util/lock_table.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>align 64bit atomic operation fix https://github.com/seaweedfs/seaweedfs/issues/4878</MESSAGE>
      <SHA>40888b561226004765ce158e922df6aca5dcfe70</SHA>
      <PATCHEDFILES>
        <FILE>weed/util/lock_table.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
