<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>3623</ISSUENO>
  <ISSUEURL>https://github.com/seaweedfs/seaweedfs/issues/3623</ISSUEURL>
  <TITLE>[aligo] optimization storage structs</TITLE>
  <DESCRIPTION>``` aligo check . -- {GOPATH} ---------------------------------------------------------------------------- Struct Store (store.go:43) fields order can be optimized (193 → 186) type Store struct { Locations []*DiskLocation // - MasterAddress pb.ServerAddress // - grpcDialOption grpc.DialOption // - Ip string // - PublicUrl string // - dataCenter string // optional informaton, overwriting master setting if exists rack string // optional information, overwriting master setting if exists volumeSizeLimit uint64 // read from the master Port int // - GrpcPort int // - NeedleMapKind NeedleMapKind // - NewVolumesChan chan pb/master_pb.VolumeShortIn… // - DeletedVolumesChan chan master_pb.VolumeShortInfor… // - NewEcShardsChan chan master_pb.VolumeEcShardInf… // - DeletedEcShardsChan chan master_pb.VolumeEcShardInf… // - connected bool // - isStopping bool // - } Struct Volume (volume.go:21) fields order can be optimized (304 → 287) type Volume struct { SuperBlock super_block.SuperBlock // - dir string // - dirIdx string // - Collection string // - DataBackend backend.BackendStorageFile // - nm NeedleMapper // - tmpNm TempNeedleMapper // - lastIoError error // - needleMapKind NeedleMapKind // - asyncRequestsChan chan *needle.AsyncRequest // - lastModifiedTsSeconds uint64 // unix time in seconds lastAppendAtNs uint64 // unix time in nanoseconds lastCompactIndexOffset uint64 // - volumeInfo *pb/volume_server_pb.VolumeInfo // - location *DiskLocation // - noWriteLock sync.RWMutex // - dataFileAccessLock sync.RWMutex // - superBlockAccessLock sync.Mutex // - Id needle.VolumeId // - MemoryMapMaxSizeMb uint32 // - lastCompactRevision uint16 // - noWriteOrDelete bool // if readonly, either noWriteOrDelete or noWriteCanDelete noWriteCanDelete bool // if readonly, either noWriteOrDelete or noWriteCanDelete hasRemoteFile bool // if the volume has a remote file isCompacting bool // - isCommitCompacting bool // - } Struct VolumeInfo (volume_info.go:12) fields order can be optimized (144 → 130) type VolumeInfo struct { DiskType string Collection string RemoteStorageName string RemoteStorageKey string Size uint64 ReplicaPlacement *super_block.ReplicaPlacement Ttl *needle.TTL FileCount int DeleteCount int DeletedByteCount uint64 ModifiedAtSecond int64 Id needle.VolumeId CompactRevision uint32 Version needle.Version ReadOnly bool } Struct VolumeFileScanner4Vacuum (volume_vacuum.go:355) fields order can be optimized (64 → 57) type VolumeFileScanner4Vacuum struct { dstBackend backend.BackendStorageFile v *Volume nm *needle_map.MemDb newOffset int64 now uint64 writeThrottler *util.WriteThrottler version needle.Version } ---------------------------------------------------------------------------------------- ```</DESCRIPTION>
  <REPONAME>seaweedfs</REPONAME>
  <TIMEDIFFERENCEDAYS>179</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge branch 'master' of https://github.com/seaweedfs/seaweedfs</MESSAGE>
    <SHA>7de112943b2548183c0dfe594600479489c0bced</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>aligo storage https://github.com/seaweedfs/seaweedfs/issues/3623</MESSAGE>
      <SHA>e89d1ba95948606bd809da615db30994ea24fecf</SHA>
      <PATCHEDFILES>
        <FILE>weed/storage/store.go</FILE>
        <FILE>weed/storage/volume.go</FILE>
        <FILE>weed/storage/volume_info.go</FILE>
        <FILE>weed/storage/volume_vacuum.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
