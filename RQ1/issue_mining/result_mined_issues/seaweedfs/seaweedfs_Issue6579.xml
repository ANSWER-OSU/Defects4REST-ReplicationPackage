<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>6579</ISSUENO>
  <ISSUEURL>https://github.com/seaweedfs/seaweedfs/issues/6579</ISSUEURL>
  <TITLE>Client certificate unnecessarily mounted in master and volume</TITLE>
  <DESCRIPTION>In the seaweedfs helm chart, the client-cert, which is the certificate used to make the S3 service TLS enabled, is mounted into the Volume and Master pods, even though it is unused by these pods. The problem here is when coupled with tooling that restarts pods when a mounted secret changes (for example a Kyverno policy or https://github.com/stakater/Reloader), ALL pods are restarted, when only the pods that run the S3 service need be restarted. This would either be the S3 Deployment, or the Filer (in the case that S3 is bundled with the Filer).</DESCRIPTION>
  <REPONAME>seaweedfs</REPONAME>
  <TIMEDIFFERENCEDAYS>1</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>chore(deps): bump google.golang.org/api from 0.221.0 to 0.222.0 (#6570) * chore(deps): bump google.golang.org/api from 0.221.0 to 0.222.0 Bumps [google.golang.org/api](https://github.com/googleapis/google-api-go-client) from 0.221.0 to 0.222.0. - [Release notes](https://github.com/googleapis/google-api-go-client/releases) - [Changelog](https://github.com/googleapis/google-api-go-client/blob/main/CHANGES.md) - [Commits](https://github.com/googleapis/google-api-go-client/compare/v0.221.0...v0.222.0) --- updated-dependencies: - dependency-name: google.golang.org/api dependency-type: direct:production update-type: version-update:semver-minor ... Signed-off-by: dependabot[bot] &lt;support@github.com&gt; * go mod tidy --------- Signed-off-by: dependabot[bot] &lt;support@github.com&gt; Co-authored-by: dependabot[bot] &lt;49699333+dependabot[bot]@users.noreply.github.com&gt; Co-authored-by: chrislu &lt;chris.lu@gmail.com&gt;</MESSAGE>
    <SHA>2dc26a064c1c568ecda6d8c3cb53c24ccbb3aaea</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>What problem are we solving? Fix: #6579 How are we solving the problem? In the Helm chart, we remove volume and volumeMounts for the certificates that are not used. How is the PR tested? We ran SeaweedFS in a Kubernetes Cluster with a joint Filer and S3 server in one container, with leveldb2 as the filer storage. Full communication between the various components stays intact, despite the removal of the unused certificates. Checks [ ] I have added unit tests if possible. [ ] I will add related wiki document changes and link to this PR after merging.</MESSAGE>
      <SHA>ef4f342f5737878c907d787af120f5b1beac99a5</SHA>
      <PATCHEDFILES>
        <FILE>k8s/charts/seaweedfs/Chart.yaml</FILE>
        <FILE>k8s/charts/seaweedfs/templates/filer-statefulset.yaml</FILE>
        <FILE>k8s/charts/seaweedfs/templates/master-statefulset.yaml</FILE>
        <FILE>k8s/charts/seaweedfs/templates/volume-statefulset.yaml</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
