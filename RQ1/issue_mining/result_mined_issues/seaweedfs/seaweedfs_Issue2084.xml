<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>2084</ISSUENO>
  <ISSUEURL>https://github.com/seaweedfs/seaweedfs/issues/2084</ISSUEURL>
  <TITLE>Filer.backup does not work as expected</TITLE>
  <DESCRIPTION>I am trying to test a backup to local disk (both on Windows and Linux) of files that are stored with Filer (MySQL), but it doesn't seem to work properly - it just doesn't copy all the files, only specific files and folders, not even full sizes. Maybe it's just getting stuck for whatever reason? I also tried to change the directory on Filer in replication.toml, but it does no effect. It also makes two folders of different dates, but I've configured it to &quot;is_incremental = false&quot;. **System Setup** Weed cluster is started with Docker compose ([Docker.zip](https://github.com/chrislusf/seaweedfs/files/6539293/Docker.zip); it contains filer.toml as well). OS version: - Windows 10 Pro 20H2 19042.985 - Linux mx 4.19.0-6-amd64 #1 SMP Debian 4.19.67-2+deb10u2 (2019-11-11) x86_64 GNU/Linux Weed version: - version 30GB 2.49 42fb03a windows amd64 - version 30GB 2.49 42fb03a linux amd64 FIler.backup start command: .\weed.exe filer.backup -filerProxy Replication.toml: [replication(.toml).txt](https://github.com/chrislusf/seaweedfs/files/6539325/replication.toml.txt) **Expected behavior** A full copy of files stored with Filer on a local disk. **Screenshots** Filer ![image](https://user-images.githubusercontent.com/17049504/119495375-05b79600-bd6b-11eb-8124-c9ba3110f943.png) ![image](https://user-images.githubusercontent.com/17049504/119495436-149e4880-bd6b-11eb-843e-b161daf55197.png) ![image](https://user-images.githubusercontent.com/17049504/119495607-40213300-bd6b-11eb-8b7d-95344f34aa38.png) ![image](https://user-images.githubusercontent.com/17049504/119495679-50d1a900-bd6b-11eb-82d5-3d3dd8c7ab3e.png) ![image](https://user-images.githubusercontent.com/17049504/119495646-4a433180-bd6b-11eb-8cfe-e41270d528e6.png) Windows backup ![image](https://user-images.githubusercontent.com/17049504/119496680-672c3480-bd6c-11eb-838c-cb50fe294259.png) ![image](https://user-images.githubusercontent.com/17049504/119496471-321fe200-bd6c-11eb-8fdc-3b4a324e4fed.png) ![image](https://user-images.githubusercontent.com/17049504/119496503-38ae5980-bd6c-11eb-9f14-a25a5854abb0.png) ![image](https://user-images.githubusercontent.com/17049504/119496530-3fd56780-bd6c-11eb-91c0-b4d3d1f268a2.png) ![image](https://user-images.githubusercontent.com/17049504/119496563-47950c00-bd6c-11eb-90b1-7ae249db9c59.png) ![image](https://user-images.githubusercontent.com/17049504/119496648-5f6c9000-bd6c-11eb-9357-a33eca5a581e.png) Linux backup Same picture as on Windows. **Additional context** File.backup output from Windows: [win filer.backup log.txt](https://github.com/chrislusf/seaweedfs/files/6539218/win.filer.backup.log.txt). File.backup output from Linux: [linux filer.backup log.txt](https://github.com/chrislusf/seaweedfs/files/6539249/linux.filer.backup.log.txt).</DESCRIPTION>
  <REPONAME>seaweedfs</REPONAME>
  <TIMEDIFFERENCEDAYS>4</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #2080 from kmlebedev/s3IfMatch</MESSAGE>
    <SHA>35ca9638c422c63383f922ace499472d1b897c77</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>filer.backup: backup to local directory optionally is incremental fixed one issue with https://github.com/chrislusf/seaweedfs/issues/2084</MESSAGE>
      <SHA>dce1f02c9efcf78f05e7f81f3cc116e594591642</SHA>
      <PATCHEDFILES>
        <FILE>weed/command/scaffold.go</FILE>
        <FILE>weed/replication/sink/localsink/local_sink.go</FILE>
        <FILE>weed/util/config.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>local sink: write and update files fix issues with https://github.com/chrislusf/seaweedfs/issues/2084</MESSAGE>
      <SHA>1a70cb9b631b95be1c0b07cb0e93e9e68be6ac23</SHA>
      <PATCHEDFILES>
        <FILE>weed/replication/sink/localsink/local_sink.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
