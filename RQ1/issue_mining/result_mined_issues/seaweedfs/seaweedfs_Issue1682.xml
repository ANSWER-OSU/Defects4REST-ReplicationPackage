<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>1682</ISSUENO>
  <ISSUEURL>https://github.com/seaweedfs/seaweedfs/issues/1682</ISSUEURL>
  <TITLE>panic when loading volumes concurrently</TITLE>
  <DESCRIPTION>**Describe the bug** Loading same volume more than once leads to SIGSEGV **System Setup** - List the command line to start &quot;weed master&quot;, &quot;weed volume&quot;, &quot;weed filer&quot;, &quot;weed s3&quot;, &quot;weed mount&quot;. - OS version - output of `weed version` - if using filer, show the content of `filer.toml` 1. start server: `./weed server` 2. upload some random files 3. restart with &quot;-volume.index leveldb&quot; `./weed server -volume.index leveldb` 4. crash log &gt; I1216 18:24:45 91019 master_grpc_server.go:250] + client master@10.170.160.252:56816 I1216 18:24:45 91019 volume_loading.go:128] loading leveldb /var/folders/1x/lbz9zhkd1_n0vd2zlmsl_0n40000gn/T/2.ldb I1216 18:24:45 91019 volume_loading.go:128] loading leveldb /var/folders/1x/lbz9zhkd1_n0vd2zlmsl_0n40000gn/T/4.ldb I1216 18:24:45 91019 volume_loading.go:128] loading leveldb /var/folders/1x/lbz9zhkd1_n0vd2zlmsl_0n40000gn/T/3.ldb I1216 18:24:45 91019 volume_loading.go:128] loading leveldb /var/folders/1x/lbz9zhkd1_n0vd2zlmsl_0n40000gn/T/2.ldb I1216 18:24:45 91019 volume_loading.go:128] loading leveldb /var/folders/1x/lbz9zhkd1_n0vd2zlmsl_0n40000gn/T/3.ldb I1216 18:24:45 91019 volume_loading.go:128] loading leveldb /var/folders/1x/lbz9zhkd1_n0vd2zlmsl_0n40000gn/T/1.ldb I1216 18:24:45 91019 volume_loading.go:128] loading leveldb /var/folders/1x/lbz9zhkd1_n0vd2zlmsl_0n40000gn/T/1.ldb I1216 18:24:45 91019 volume_loading.go:128] loading leveldb /var/folders/1x/lbz9zhkd1_n0vd2zlmsl_0n40000gn/T/4.ldb I1216 18:24:45 91019 volume_loading.go:128] loading leveldb /var/folders/1x/lbz9zhkd1_n0vd2zlmsl_0n40000gn/T/5.ldb I1216 18:24:45 91019 volume_loading.go:128] loading leveldb /var/folders/1x/lbz9zhkd1_n0vd2zlmsl_0n40000gn/T/5.ldb I1216 18:24:45 91019 volume_loading.go:135] loading leveldb /var/folders/1x/lbz9zhkd1_n0vd2zlmsl_0n40000gn/T/4.ldb error: resource temporarily unavailable I1216 18:24:45 91019 volume_loading.go:135] loading leveldb /var/folders/1x/lbz9zhkd1_n0vd2zlmsl_0n40000gn/T/2.ldb error: resource temporarily unavailable I1216 18:24:45 91019 volume_loading.go:135] loading leveldb /var/folders/1x/lbz9zhkd1_n0vd2zlmsl_0n40000gn/T/3.ldb error: resource temporarily unavailable I1216 18:24:45 91019 volume_loading.go:135] loading leveldb /var/folders/1x/lbz9zhkd1_n0vd2zlmsl_0n40000gn/T/1.ldb error: resource temporarily unavailable I1216 18:24:45 91019 volume_loading.go:135] loading leveldb /var/folders/1x/lbz9zhkd1_n0vd2zlmsl_0n40000gn/T/5.ldb error: resource temporarily unavailable panic: runtime error: invalid memory address or nil pointer dereference [signal SIGSEGV: segmentation violation code=0x1 addr=0x188 pc=0x49e80be] **Expected behavior** not crash</DESCRIPTION>
  <REPONAME>seaweedfs</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Revert &quot;Merge pull request #1683 from qieqieplus/master&quot; This reverts commit 8cb67952db822ef232dd2701ce78a5486d54b4ea, reversing changes made to 200e56215a4fdc4ec424f05fb975cdc876d7a2b4.</MESSAGE>
    <SHA>986cbdf7d95bbb0839ab77bb7e42e4b9baad0a69</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>volume: avoid reprocessing the same volume fix https://github.com/chrislusf/seaweedfs/issues/1682</MESSAGE>
      <SHA>e2076201d79e84df0407a9e1e535bf966452bba0</SHA>
      <PATCHEDFILES>
        <FILE>weed/storage/disk_location.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
