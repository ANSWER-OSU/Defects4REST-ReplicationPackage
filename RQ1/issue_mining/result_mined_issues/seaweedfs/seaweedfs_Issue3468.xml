<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>3468</ISSUENO>
  <ISSUEURL>https://github.com/seaweedfs/seaweedfs/issues/3468</ISSUEURL>
  <TITLE>Filer.backup saves no data if the file is saved in filer (saveToFilerLimit &gt; 0)</TITLE>
  <DESCRIPTION>**Describe the bug** When uploading files to filer which are less then size x as defined in `saveToFilerLimit`, it will have 0 byte size while running filer.backup -filerProxy **System Setup** - `weed server -dataCenter=$HOSTNAME -ip=$HOSTNAME -master.dir=/meta -master.peers=&quot;app1:9333,app2:9333,app3:9333&quot; -dir=/data -volume.dir.idx=/meta -volume.index=leveldbLarge -volume.max=0 -rack=1 -filer.encryptVolumeData -volume.fileSizeLimitMB=4096 -master.volumeSizeLimitMB=1024 -filer.defaultReplicaPlacement=100 -filer.saveToFilerLimit=4096 -filer` - `weed filer.backup --filerProxy` - Ubuntu server replicaiton.toml ```toml [sink.local] enabled = true directory = &quot;/data&quot; is_incremental = true ``` **Expected behavior** Filer should also backup that data, even though it's not stored on a volume server **Screenshots** &lt;img width=&quot;1224&quot; alt=&quot;filer&quot; src=&quot;https://user-images.githubusercontent.com/12692409/185657003-0b95a272-4aeb-4103-b89f-01a80031040d.png&quot;&gt; ```bash kb@host_dev1:/volume1/docker/filer.backup/2022-08-18$ ls -l total 15756 -rw-r----- 1 root root 332174 Aug 19 00:05 example Kopie.png -rw-r----- 1 root root 0 Aug 19 00:39 logo.svg -rw-r----- 1 root root 0 Aug 19 00:05 protection.********************.xml -rw-r----- 1 root root 209510 Aug 19 00:05 qr-code.svg -rw-r----- 1 root root 12214695 Aug 19 00:05 sc.ogv -rw-r----- 1 root root 3365047 Aug 19 00:05 SvgConverter.app.zip ``` **Additional context** You can see that I have saveToFilerLimit set to 4KB, the files that are smaller than that are empty in the backup.</DESCRIPTION>
  <REPONAME>seaweedfs</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Filer if-modified-since check doesn't fire on &quot;exact&quot; #3467 fix https://github.com/seaweedfs/seaweedfs/issues/3467</MESSAGE>
    <SHA>146144500bb602019b24cd87cce17262baed79b1</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>filer.backup: backup small files if the file is saved in filer (saveToFilerLimit &gt; 0) fix https://github.com/seaweedfs/seaweedfs/issues/3468</MESSAGE>
      <SHA>cfe7e72014b89839a4052529ace31ca7412b3bb9</SHA>
      <PATCHEDFILES>
        <FILE>weed/replication/sink/azuresink/azure_sink.go</FILE>
        <FILE>weed/replication/sink/b2sink/b2_sink.go</FILE>
        <FILE>weed/replication/sink/gcssink/gcs_sink.go</FILE>
        <FILE>weed/replication/sink/localsink/local_sink.go</FILE>
        <FILE>weed/replication/sink/s3sink/s3_sink.go</FILE>
        <FILE>weed/replication/sink/s3sink/s3_write.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
