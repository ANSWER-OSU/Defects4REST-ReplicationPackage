<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>675</ISSUENO>
  <ISSUEURL>https://github.com/snarfed/granary/issues/675</ISSUEURL>
  <TITLE>Bluesky.from_as1: convert links, @-mentions, and hashtags to facets</TITLE>
  <DESCRIPTION>We should support facet output in `from_as1`! Specifically, convert mention and hashtag `tag`s to `app.bsky.richtext.facet#mention`s and `#tag`s, respectively, and HTML links in `content` to `#link`s. This will be a bit tricky, since we don't currently generate indices for those `tag`s in eg `microformats.json_to_object` and `Source.postprocess_object`, and we don't generate anything at all for plain links yet. We'd want to look into how AS1 tag indices work anyway, eg do they always index into plain text content, eg `content.value`? cc @JoelOtter</DESCRIPTION>
  <REPONAME>granary</REPONAME>
  <TIMEDIFFERENCEDAYS>375</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>microformats2.json_to_object: Bug fix for when `name` property is an object eg an `h-card`. fixes https://console.cloud.google.com/errors/detail/CLm3o8-z35bVvAE;time=P30D?project=granary-demo</MESSAGE>
    <SHA>f9c75546fc3afb65fcc29c12ed17b923c43e4c5b</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>bluesky.from_as1: guess missing indices in facets based on text ...even if it was converted from HTML content. for #675</MESSAGE>
      <SHA>42a4153e1c58d05b967f5d874f92a112cccd6304</SHA>
      <PATCHEDFILES>
        <FILE>README.md</FILE>
        <FILE>granary/bluesky.py</FILE>
        <FILE>granary/tests/test_bluesky.py</FILE>
        <FILE>granary/tests/testdata/note.bsky-from-as.json</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>bluesky.from_as1: only add facets when we have their indices for #675</MESSAGE>
      <SHA>8dd5e470b27972b341637650b00db32ea23e2804</SHA>
      <PATCHEDFILES>
        <FILE>README.md</FILE>
        <FILE>granary/bluesky.py</FILE>
        <FILE>granary/tests/test_bluesky.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
