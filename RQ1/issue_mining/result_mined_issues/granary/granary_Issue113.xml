<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>113</ISSUENO>
  <ISSUEURL>https://github.com/snarfed/granary/issues/113</ISSUEURL>
  <TITLE>Include mf2 photo in Atom content?</TITLE>
  <DESCRIPTION>I'm struggling with getting my photos to appear in Micro.blog using the Granary Atom feed. In my mf2, I explicitly don't include the photo in the `e-content`, which is how I want the HTML to work, and is acceptable markup for a [photo post](https://indieweb.org/photo). Granary doesn't appear to do anything with the mf2 `photo` property, so my photos are missing from the Atom feed, and aren't making it into micro.blog. Would it make sense to add an `&lt;img class=&quot;u-photo&quot;&gt;` tag inside the Atom content if the photo is not already in the content? I haven't quite thought through the full implications of this so the answer may be no.</DESCRIPTION>
  <REPONAME>granary</REPONAME>
  <TIMEDIFFERENCEDAYS>27</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>atom: render AS image (mf2 u-photo) if it's not already in content fixes #113</MESSAGE>
    <SHA>097ca68ae243ff923f9f2cdf93c85e949b784b45</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>atom: don't render images that are also attachments for #113, fixes snarfed/twitter-atom#8. note the human dev error in 097ca68ae243ff923f9f2cdf93c85e949b784b45: the per-silo atom integration tests caught this, but i blindly added the new &lt;img&gt;s without checking to see if they were already there. they were. :P</MESSAGE>
      <SHA>8fd30712924ab8e9fdac7b9d568f19171f89a093</SHA>
      <PATCHEDFILES>
        <FILE>granary/atom.py</FILE>
        <FILE>granary/test/test_atom.py</FILE>
        <FILE>granary/test/test_instagram.py</FILE>
        <FILE>granary/test/test_twitter.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>mf2 to html: de-dupe image and attachments fixes #120...but by dropping the &lt;img&gt; *outside* content, not the one inside as requested. that may still be the right long term answer, but right now it's reused as atom content, and we're still debating whether we want to move that to an enclosure in #113 and snarfed/instagram-atom#3. reader support seems unclear at best.</MESSAGE>
      <SHA>1191e5afe3b8e4703329d77ac7eeca368313c8b5</SHA>
      <PATCHEDFILES>
        <FILE>granary/microformats2.py</FILE>
        <FILE>granary/test/testdata/article_with_image_duplicated_as_attachment.as.json</FILE>
        <FILE>granary/test/testdata/article_with_image_duplicated_as_attachment.mf2.html</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>atom: add enclosures for images and type attribute (guessed based on URL) fixes snarfed/instagram#3, also for #113</MESSAGE>
      <SHA>92341ea9c9e5b447e0bbd4be71ff371530942d1f</SHA>
      <PATCHEDFILES>
        <FILE>README.md</FILE>
        <FILE>granary/atom.py</FILE>
        <FILE>granary/templates/_entry.atom</FILE>
        <FILE>granary/test/test_atom.py</FILE>
        <FILE>granary/test/test_facebook.py</FILE>
        <FILE>granary/test/test_twitter.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
