<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>717</ISSUENO>
  <ISSUEURL>https://github.com/snarfed/granary/issues/717</ISSUEURL>
  <TITLE>Bluesky: truncate string values to length limits</TITLE>
  <DESCRIPTION>Lexicons can include length limits for some fields, [eg 300 graphemes for `app.bsky.feed.post text`](https://github.com/bluesky-social/atproto/blob/65a9fd7a5af738bf219b3793bf7dc5af5f20a121/lexicons/app/bsky/feed/post.json#L16). The relay (or AppView?) checks length limits in record validation and drops records if any fields are over their limit. We need to handle this in `bluesky.to/from_as1`. Ideally we'd bundle the lexicons themselves and look up and use per-field length limits automatically. Not sure I want to go that far though. Alternatively we could do this in lexrpc, with an option to truncate values that are too long.</DESCRIPTION>
  <REPONAME>granary</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>bluesky.to/from_as1: flag &lt;=&gt; createReport: include $type in subject</MESSAGE>
    <SHA>80854778587ff7546ebf2616aa750395829f6316</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>bluesky.from_as1: truncate string values based on maxGraphemes for #717</MESSAGE>
      <SHA>4aef9a2337c461393c734b5018f3538c82fefa1c</SHA>
      <PATCHEDFILES>
        <FILE>README.md</FILE>
        <FILE>granary/bluesky.py</FILE>
        <FILE>granary/tests/test_bluesky.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
