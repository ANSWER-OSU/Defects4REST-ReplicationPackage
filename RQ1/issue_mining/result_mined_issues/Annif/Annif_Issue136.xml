<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>136</ISSUENO>
  <ISSUEURL>https://github.com/NatLibFi/Annif/issues/136</ISSUEURL>
  <TITLE>Refactor corpus classes</TITLE>
  <DESCRIPTION>Right now the `annif.corpus` classes are a bit of a mess. They are trying to support different kinds of corpora: * SubjectIndex: subjects only as a TSV file + lookup and save functionality * SubjectIndexSKOS: subjects only as a SKOS file * SubjectDirectory: subjects with texts as a directory of TXT files * DocumentFile: documents with subjects as a TSV file * DocumentDirectory: documents with subjects as a directory of TXT + TSV files Some conversions / views are supported, for example SubjectDirectory.from_documents allows converting a DocumentFile into a SubjectDirectory and FastTextBackend knows how to convert a SubjectDirectory into the fastText train file format which resembles DocumentFile. But this makes for messy code in AnnifProject. Instead the classes should be seen as interfaces which provide access to the data in a uniform way regardless of the underlying storage. There could be a common abstract base class AnnifCorpus which provides methods/properties such as `subjects` (iterate through the available subjects as Subject objects, which are actually named tuples) and `documents` (iterate through the available documents, which could also be named tuples with text and subjects). These methods could perform the conversion behind the scenes, using temporary files or directories when necessary. The index functionality (lookup by ID or URI) of SubjectIndex should be separated from the loading/saving part, which could be implemented by a class called SubjectFileTSV.</DESCRIPTION>
  <REPONAME>Annif</REPONAME>
  <TIMEDIFFERENCEDAYS>1</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Bump version: 0.26.0 â†’ 0.27.0</MESSAGE>
    <SHA>160ba78fb9fa2033158a81210006b49a3467fdbd</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Split off index functionality (SubjectIndex) from subject file access. Part of #136</MESSAGE>
      <SHA>b6478ba18e56abdaf1d034295a60e45dea774563</SHA>
      <PATCHEDFILES>
        <FILE>annif/backend/fasttext.py</FILE>
        <FILE>annif/backend/tfidf.py</FILE>
        <FILE>annif/cli.py</FILE>
        <FILE>annif/corpus/__init__.py</FILE>
        <FILE>annif/corpus/skos.py</FILE>
        <FILE>annif/corpus/subject.py</FILE>
        <FILE>annif/project.py</FILE>
        <FILE>tests/test_backend_tfidf.py</FILE>
        <FILE>tests/test_corpus.py</FILE>
        <FILE>tests/test_vocab_skos.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>refactor document corpora, adding a DocumentCorpus abstract base class. Part of #136</MESSAGE>
      <SHA>ed601569d6c997e9db1d20059fc3d6048c8adb30</SHA>
      <PATCHEDFILES>
        <FILE>annif/backend/backend.py</FILE>
        <FILE>annif/backend/fasttext.py</FILE>
        <FILE>annif/corpus/document.py</FILE>
        <FILE>annif/corpus/subject.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Use a mixin for converting a DocumentCorpus to a SubjectCorpus. Part of #136</MESSAGE>
      <SHA>e68e564157edc38296e101b1781d8bcd64e4f2ba</SHA>
      <PATCHEDFILES>
        <FILE>annif/corpus/convert.py</FILE>
        <FILE>annif/corpus/document.py</FILE>
        <FILE>annif/corpus/subject.py</FILE>
        <FILE>annif/project.py</FILE>
        <FILE>tests/conftest.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Use a mixin for converting a SubjectCorpus into a DocumentCorpus. Part of #136</MESSAGE>
      <SHA>de90a7a00e10deb05d117d259c9a9ee81c499ef6</SHA>
      <PATCHEDFILES>
        <FILE>annif/backend/backend.py</FILE>
        <FILE>annif/backend/fasttext.py</FILE>
        <FILE>annif/backend/tfidf.py</FILE>
        <FILE>annif/corpus/convert.py</FILE>
        <FILE>annif/corpus/document.py</FILE>
        <FILE>annif/corpus/subject.py</FILE>
        <FILE>annif/corpus/types.py</FILE>
        <FILE>annif/project.py</FILE>
        <FILE>tests/test_backend_fasttext.py</FILE>
        <FILE>tests/test_backend_tfidf.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
