<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>33506</ISSUENO>
  <ISSUEURL>https://github.com/Dolibarr/dolibarr/issues/33506</ISSUEURL>
  <TITLE>ODT logo size : be able to accommodate the DPI of the source image</TITLE>
  <DESCRIPTION>### Feature Request Hello, When using the logo within a ODT template the odf.php sets a constat for the pixel to cm ratio assuming 96 DPI. This leads to a poor image quality in the resulting file, since printed mostly in 300DPI on printers. Would it be possible to have a Dolibarr Const that add another value the resulting image width and height is multiplied with ? Since the odf.php is outside of the dolibarr scope such a dolibarr constant can not be retrieved there. The setImage method is called from each doc_generic_*_odt_modules.php so it requires a lot of files to change. ### Use case _No response_ ### Suggested implementation I'm not a professional PHP developer so i do not know if the suggested approach is good but i tried to come up with something that i could test with success :) ### Suggested steps modify the setImage method in odf.php to have one more parameter called ratio `public function setImage($key, $value, $ratio=1)` Use this ratio to compute the image size ``` $width *= self::PIXEL_TO_CM * $ratio; $height *= self::PIXEL_TO_CM * $ratio; ``` Change all setImage calls in the doc_generic_*_odt_modules.php files after getting the Dolibarr constant with the defined ratio like ``` if (getDolGlobalString('MAIN_DOC_ODT_IMAGE_RATIO')) { $ratio = getDolGlobalString('MAIN_DOC_ODT_IMAGE_RATIO') * 1; } else { $ratio = 1; } $odfHandler-&gt;setImage($key, $value, $ratio); ```</DESCRIPTION>
  <REPONAME>dolibarr</REPONAME>
  <TIMEDIFFERENCEDAYS>6</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge branch '15.0' of git@github.com:Dolibarr/dolibarr.git into 16.0</MESSAGE>
    <SHA>089fab828b130db45cfe6485f56124e8da3aa5fa</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>CLOSE #33506 add a constant holding the ratio to resize images in ODT templates A new Dolibarr constant MAIN_DOC_ODT_IMAGE_RATIO is taken in consideration for ODT templates. This constant holds a number that is multiplied when computing the size of images in ODT templates. All doc_generic_*_odt_modules.php files have been updated to call the setImage Method with a new parameter $ratio The method setImage in the file odt.php has been modified to have a new parameter $ratio and use it to compute the image size</MESSAGE>
      <SHA>8a555cbcd2cd0e95399ff4df5984f46c301343dd</SHA>
      <PATCHEDFILES>
        <FILE>htdocs/core/modules/asset/doc/doc_generic_asset_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/bom/doc/doc_generic_bom_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/commande/doc/doc_generic_order_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/contract/doc/doc_generic_contract_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/expedition/doc/doc_generic_shipment_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/facture/doc/doc_generic_invoice_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/member/doc/doc_generic_member_odt.class.php</FILE>
        <FILE>htdocs/core/modules/product/doc/doc_generic_product_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/project/doc/doc_generic_project_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/project/task/doc/doc_generic_task_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/propale/doc/doc_generic_proposal_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/reception/doc/doc_generic_reception_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/societe/doc/doc_generic_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/stock/doc/doc_generic_stock_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/supplier_order/doc/doc_generic_supplier_order_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/supplier_proposal/doc/doc_generic_supplier_proposal_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/ticket/doc/doc_generic_ticket_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/user/doc/doc_generic_user_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/usergroup/doc/doc_generic_usergroup_odt.modules.php</FILE>
        <FILE>htdocs/includes/odtphp/odf.php</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>CLOSE #33506 add a constant holding the ratio to resize images in ODT templates A new Dolibarr constant MAIN_DOC_ODT_IMAGE_RATIO is taken in consideration for ODT templates. This constant holds a number that is multiplied when computing the size of images in ODT templates. All doc_generic_*_odt_modules.php files have been updated to call the setImage Method with a new parameter $ratio The method setImage in the file odt.php has been modified to have a new parameter $ratio and use it to compute the image size</MESSAGE>
      <SHA>d6c9fc80b443603788a43acfd4a88d9b7c2adda0</SHA>
      <PATCHEDFILES>
        <FILE>htdocs/core/modules/asset/doc/doc_generic_asset_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/bom/doc/doc_generic_bom_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/commande/doc/doc_generic_order_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/contract/doc/doc_generic_contract_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/expedition/doc/doc_generic_shipment_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/facture/doc/doc_generic_invoice_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/member/doc/doc_generic_member_odt.class.php</FILE>
        <FILE>htdocs/core/modules/product/doc/doc_generic_product_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/project/doc/doc_generic_project_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/project/task/doc/doc_generic_task_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/propale/doc/doc_generic_proposal_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/reception/doc/doc_generic_reception_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/societe/doc/doc_generic_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/stock/doc/doc_generic_stock_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/supplier_order/doc/doc_generic_supplier_order_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/supplier_proposal/doc/doc_generic_supplier_proposal_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/ticket/doc/doc_generic_ticket_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/user/doc/doc_generic_user_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/usergroup/doc/doc_generic_usergroup_odt.modules.php</FILE>
        <FILE>htdocs/includes/odtphp/odf.php</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>FIX #33506 wrong branch some other files needed to be changed in the develop branch</MESSAGE>
      <SHA>949eac47aaa4c8f5f2a7d648fc10a632c974e2b2</SHA>
      <PATCHEDFILES>
        <FILE>htdocs/core/modules/mrp/doc/doc_generic_mo_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/supplier_invoice/doc/doc_generic_supplier_invoice_odt.modules.php</FILE>
        <FILE>htdocs/includes/odtphp/Segment.php</FILE>
        <FILE>htdocs/modulebuilder/template/core/modules/mymodule/doc/doc_generic_myobject_odt.modules.php</FILE>
        <FILE>htdocs/recruitment/core/modules/recruitment/doc/doc_generic_recruitmentjobposition_odt.modules.php</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>FIX #33506 PR errors fixed</MESSAGE>
      <SHA>882821a28a57474be0a9126e808f3f06fe3d0ceb</SHA>
      <PATCHEDFILES>
        <FILE>htdocs/core/modules/asset/doc/doc_generic_asset_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/bom/doc/doc_generic_bom_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/commande/doc/doc_generic_order_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/contract/doc/doc_generic_contract_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/expedition/doc/doc_generic_shipment_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/facture/doc/doc_generic_invoice_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/member/doc/doc_generic_member_odt.class.php</FILE>
        <FILE>htdocs/core/modules/mrp/doc/doc_generic_mo_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/product/doc/doc_generic_product_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/project/doc/doc_generic_project_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/project/task/doc/doc_generic_task_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/propale/doc/doc_generic_proposal_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/reception/doc/doc_generic_reception_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/societe/doc/doc_generic_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/stock/doc/doc_generic_stock_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/supplier_invoice/doc/doc_generic_supplier_invoice_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/supplier_order/doc/doc_generic_supplier_order_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/supplier_proposal/doc/doc_generic_supplier_proposal_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/ticket/doc/doc_generic_ticket_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/user/doc/doc_generic_user_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/usergroup/doc/doc_generic_usergroup_odt.modules.php</FILE>
        <FILE>htdocs/includes/odtphp/Segment.php</FILE>
        <FILE>htdocs/includes/odtphp/odf.php</FILE>
        <FILE>htdocs/modulebuilder/template/core/modules/mymodule/doc/doc_generic_myobject_odt.modules.php</FILE>
        <FILE>htdocs/recruitment/core/modules/recruitment/doc/doc_generic_recruitmentjobposition_odt.modules.php</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>FIX #33506 codesniffer errors fixed</MESSAGE>
      <SHA>e148f82a19949560f94de63e62ff198adee457cc</SHA>
      <PATCHEDFILES>
        <FILE>htdocs/core/modules/asset/doc/doc_generic_asset_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/bom/doc/doc_generic_bom_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/commande/doc/doc_generic_order_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/contract/doc/doc_generic_contract_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/expedition/doc/doc_generic_shipment_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/facture/doc/doc_generic_invoice_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/member/doc/doc_generic_member_odt.class.php</FILE>
        <FILE>htdocs/core/modules/mrp/doc/doc_generic_mo_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/product/doc/doc_generic_product_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/project/doc/doc_generic_project_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/project/task/doc/doc_generic_task_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/propale/doc/doc_generic_proposal_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/reception/doc/doc_generic_reception_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/societe/doc/doc_generic_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/stock/doc/doc_generic_stock_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/supplier_invoice/doc/doc_generic_supplier_invoice_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/supplier_order/doc/doc_generic_supplier_order_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/supplier_proposal/doc/doc_generic_supplier_proposal_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/ticket/doc/doc_generic_ticket_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/user/doc/doc_generic_user_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/usergroup/doc/doc_generic_usergroup_odt.modules.php</FILE>
        <FILE>htdocs/modulebuilder/template/core/modules/mymodule/doc/doc_generic_myobject_odt.modules.php</FILE>
        <FILE>htdocs/recruitment/core/modules/recruitment/doc/doc_generic_recruitmentjobposition_odt.modules.php</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>QUAL #33506 completed method comment</MESSAGE>
      <SHA>866f2d17e847077edf1188c28aa865c89135dcc7</SHA>
      <PATCHEDFILES>
        <FILE>htdocs/includes/odtphp/Segment.php</FILE>
        <FILE>htdocs/includes/odtphp/odf.php</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>NEW #33506 Add a constant to apply a ratio to resize images in ODT templates (#33543) * CLOSE #33506 add a constant holding the ratio to resize images in ODT templates A new Dolibarr constant MAIN_DOC_ODT_IMAGE_RATIO is taken in consideration for ODT templates. This constant holds a number that is multiplied when computing the size of images in ODT templates. All doc_generic_*_odt_modules.php files have been updated to call the setImage Method with a new parameter $ratio The method setImage in the file odt.php has been modified to have a new parameter $ratio and use it to compute the image size * FIX #33506 wrong branch some other files needed to be changed in the develop branch * FIX #33506 PR errors fixed * FIX #33506 codesniffer errors fixed * QUAL #33506 completed method comment</MESSAGE>
      <SHA>b9946cef4a5be03588a3d19e382a5242692bf1d7</SHA>
      <PATCHEDFILES>
        <FILE>htdocs/core/modules/asset/doc/doc_generic_asset_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/bom/doc/doc_generic_bom_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/commande/doc/doc_generic_order_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/contract/doc/doc_generic_contract_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/expedition/doc/doc_generic_shipment_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/facture/doc/doc_generic_invoice_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/member/doc/doc_generic_member_odt.class.php</FILE>
        <FILE>htdocs/core/modules/mrp/doc/doc_generic_mo_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/product/doc/doc_generic_product_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/project/doc/doc_generic_project_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/project/task/doc/doc_generic_task_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/propale/doc/doc_generic_proposal_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/reception/doc/doc_generic_reception_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/societe/doc/doc_generic_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/stock/doc/doc_generic_stock_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/supplier_invoice/doc/doc_generic_supplier_invoice_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/supplier_order/doc/doc_generic_supplier_order_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/supplier_proposal/doc/doc_generic_supplier_proposal_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/ticket/doc/doc_generic_ticket_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/user/doc/doc_generic_user_odt.modules.php</FILE>
        <FILE>htdocs/core/modules/usergroup/doc/doc_generic_usergroup_odt.modules.php</FILE>
        <FILE>htdocs/includes/odtphp/Segment.php</FILE>
        <FILE>htdocs/includes/odtphp/odf.php</FILE>
        <FILE>htdocs/modulebuilder/template/core/modules/mymodule/doc/doc_generic_myobject_odt.modules.php</FILE>
        <FILE>htdocs/recruitment/core/modules/recruitment/doc/doc_generic_recruitmentjobposition_odt.modules.php</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
