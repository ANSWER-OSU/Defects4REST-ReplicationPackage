<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>31890</ISSUENO>
  <ISSUEURL>https://github.com/Dolibarr/dolibarr/issues/31890</ISSUEURL>
  <TITLE>v19.0.4 line extrafield in proposal cannot be saved, if empty</TITLE>
  <DESCRIPTION>### Bug Proposal line extrafield with contents: contents cannot be completely deleted - will keep the original contents after save. However, changes of the contents get successfully stored. ### Dolibarr Version Confirmed at least on v19.0.2, v19.0.3 and v19.0.4 ### Environment PHP 8.1 ### Environment Database MariaDB ### Steps to reproduce the behavior and expected behavior 1. create extrafield of type String for proposal line 2. create a proposal with one line with text in extrafield 3. click on pencil, delete the text of the extrafield and press save The extrafield now still contains the original text, log has a SQL error</DESCRIPTION>
  <REPONAME>dolibarr</REPONAME>
  <TIMEDIFFERENCEDAYS>16</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Fix: Plain MSG Can be empty with \n (#32003) Co-authored-by: No√© &lt;noe@scopen.fr&gt;</MESSAGE>
    <SHA>4706b5d1fee9469ca758b6c09fe5f1d53daccd52</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>FIX #31890 storing empty extrafield Trying to delete an existing contents of the extrafield was ignored, the original contents was still present. Empty input needs explicit handling.</MESSAGE>
      <SHA>95f66449505c988b4c71878d7c6866796256f32e</SHA>
      <PATCHEDFILES>
        <FILE>htdocs/comm/propal/card.php</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>FIX #31890 store empty line extrafields If a line extrafield had originally some contents, after deleting it and submitting it as empty, the extrafield was not stored but the original contents kept</MESSAGE>
      <SHA>52fc94e1f9d384f6d930da7f5deb5ba0ac0c5752</SHA>
      <PATCHEDFILES>
        <FILE>htdocs/core/class/extrafields.class.php</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>FIX #31890 store empty line extrafields (#32152) * FIX #31890 store empty line extrafields If a line extrafield had originally some contents, after deleting it and submitting it as empty, the extrafield was not stored but the original contents kept * corrected whitespace</MESSAGE>
      <SHA>18775c06ea9bed16c8590f9b0590a96c7cd0e531</SHA>
      <PATCHEDFILES>
        <FILE>htdocs/core/class/extrafields.class.php</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
