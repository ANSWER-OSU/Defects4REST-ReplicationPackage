<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>30768</ISSUENO>
  <ISSUEURL>https://github.com/Dolibarr/dolibarr/issues/30768</ISSUEURL>
  <TITLE>invoice_line_id is the same for every timespent invoiced from a task</TITLE>
  <DESCRIPTION>### Bug When I create an invoice from timespent and ask for every timespent to be a invoice line, the invoice_line_id is the same for every timespent included ### Dolibarr Version 17,18,19,20 ### Environment PHP 7.4 ### Environment Database _No response_ ### Steps to reproduce the behavior and expected behavior I create an invoice with the selected timespent ![image](https://github.com/user-attachments/assets/93c52c76-e14d-4fcc-af88-0e3115994d18) (the link between invoice and timespent is well created) I open the created invoice and delete the LAST invoice_line corresponding to the last timespent ![image](https://github.com/user-attachments/assets/a13a1d57-2f29-4808-bca8-8a473b3406fc) After I delete the last invoice_line, every other link are deleted (because in database the invoice_line_id for every timespent was the same instead to have invoice_line_id corresponding to only one factureline) ![image](https://github.com/user-attachments/assets/bb62457f-3458-421c-a5b3-47929944d765) ### Attached files _No response_</DESCRIPTION>
  <REPONAME>dolibarr</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>FIX: on change ref for bank account attachement are lost (#30529) * FIX: on change ref for bank account attachement are lost * FIX: on change ref for bank account attachement are lost * FIX: on change ref for bank account attachement are lost * Update card.php --------- Co-authored-by: Laurent Destailleur &lt;eldy@destailleur.fr&gt;</MESSAGE>
    <SHA>163e6239649dc6e03d6409f5971ac0f3017448c6</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>FIX #30768 allocate the correct invoice_line_id to the element timespent</MESSAGE>
      <SHA>64bf46a2b6afab361789d725727f052ad8a7e60e</SHA>
      <PATCHEDFILES>
        <FILE>htdocs/projet/tasks/time.php</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>FIX #30768 allocate the correct invoice_line_id to the element timespent (#30769)</MESSAGE>
      <SHA>e7e96f650aadb40ed0f32cb2442fd44f2a5d7d01</SHA>
      <PATCHEDFILES>
        <FILE>htdocs/projet/tasks/time.php</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
