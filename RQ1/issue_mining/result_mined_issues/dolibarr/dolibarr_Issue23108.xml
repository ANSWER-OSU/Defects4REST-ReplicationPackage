<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>23108</ISSUENO>
  <ISSUEURL>https://github.com/Dolibarr/dolibarr/issues/23108</ISSUEURL>
  <TITLE>Bug: Consuming a Service or a Product with activated flag &quot;Stock change disabled&quot; in a MO</TITLE>
  <DESCRIPTION>### Bug If consuming a Service or a Product with activated flag &quot;Stock change disabled&quot; in a MO, a error was thrown. &gt; Cannot add or update a child row: a foreign key constraint fails (`dolibarr_develop`.`llx_mrp_production`, CONSTRAINT `fk_mrp_production_stock_movement` FOREIGN KEY (`fk_stock_movement`) REFERENCES `llx_stock_mouvement` (`rowid`)) Also the Services must split from the &quot;Consumption&quot; to &quot;Consumption Services&quot; similar to BOM View. ItÂ´s not right to see the same fields how &quot;Stock&quot; or &quot;Warehouse&quot; as a Product. ![image](https://user-images.githubusercontent.com/78662388/205662796-80604206-6d6a-46d1-9ac7-5704222cc84c.png) ### Environment Version 17.0.0-beta ### Environment OS Windows 10 ### Environment Web server xampp ### Environment PHP PHP 8.1.10 ### Environment Database mariaDB ### Environment URL(s) _No response_ ### Expected and actual behavior _No response_ ### Steps to reproduce the behavior ![image](https://user-images.githubusercontent.com/78662388/205658395-2710c9fe-bec4-4274-a6a1-fc58a7104393.png) ### Attached files _No response_</DESCRIPTION>
  <REPONAME>dolibarr</REPONAME>
  <TIMEDIFFERENCEDAYS>34</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Debug vcard v4</MESSAGE>
    <SHA>3e12a8ab2178506f8906e3039e327b93676b8a45</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fix #23108: - Set NULL on fk_warehouse if stockmovement is empty. - Fix deletion on lines without stockmovement -&gt; set the correct rowid of the line. - Fix stock qty and warnings correct.</MESSAGE>
      <SHA>fc0ef489e62d4a7a091bfaad55559440dbfacc6a</SHA>
      <PATCHEDFILES>
        <FILE>htdocs/mrp/mo_production.php</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Merge pull request #23459 from Humml87/develop_Fix_#23108_MO_Consuming Fix #23108: Set NULL on fk_warehouse if stockmovement is empty.</MESSAGE>
      <SHA>7357f858b61d079d5d535682c41d84528275d488</SHA>
      <PATCHEDFILES>
        <FILE>htdocs/mrp/mo_production.php</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fix #23108: - Set NULL on fk_warehouse if stockmovement is empty. - Fix deletion on lines without stockmovement -&gt; set the correct rowid of the line. - Fix stock qty and warnings correct.</MESSAGE>
      <SHA>5152a7720885f636060843bd915f50ba92e404b0</SHA>
      <PATCHEDFILES>
        <FILE>htdocs/mrp/mo_production.php</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
