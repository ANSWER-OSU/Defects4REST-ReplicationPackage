<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>26620</ISSUENO>
  <ISSUEURL>https://github.com/Dolibarr/dolibarr/issues/26620</ISSUEURL>
  <TITLE>Multicurrency calculated incorrectly in Expedition fetch_lines</TITLE>
  <DESCRIPTION>### Bug Multicurrency total amounts are calculated incorrectly in Expedition fetch_lines ### Environment Version 17.0.x, 18.0.x ### Environment OS n/a ### Environment Web server n/a ### Environment PHP n/a ### Environment Database n/a ### Environment URL(s) severl URLs, eg compta/facture/card.php?action=create&amp;origin=shipping&amp;originid=xx ### Expected and actual behavior see &quot;Steps to reproduce the behavior&quot; ### Steps to reproduce the behavior 1. Create a customer order with multicurrency with at least 2 positions 2. Create an expedition from this order 3. Create an invoice from this expedition The total multicurrency amounts are wrong and showing the amount only of the last position of the order ### Attached files _No response_</DESCRIPTION>
  <REPONAME>dolibarr</REPONAME>
  <TIMEDIFFERENCEDAYS>1</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>FIX add display of an error when attempting to delete a committed transaction (#26573) * add display of an error when attempting to delete a committed transaction * update</MESSAGE>
    <SHA>966e26e450cb97dbf0ac5807ada110df726d66eb</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fix #26620 Fix calculation of total amount of multicurrency</MESSAGE>
      <SHA>1d2551db06572a55f2bc2be995841a6641b40a57</SHA>
      <PATCHEDFILES>
        <FILE>htdocs/expedition/class/expedition.class.php</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fix #26620 (#26622) Fix calculation of total amount of multicurrency</MESSAGE>
      <SHA>06915267a7915cb8ebad79f6272a9028bb2001ce</SHA>
      <PATCHEDFILES>
        <FILE>htdocs/expedition/class/expedition.class.php</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
