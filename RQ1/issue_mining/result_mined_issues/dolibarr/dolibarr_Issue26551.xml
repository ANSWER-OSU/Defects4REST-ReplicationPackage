<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>26551</ISSUENO>
  <ISSUEURL>https://github.com/Dolibarr/dolibarr/issues/26551</ISSUEURL>
  <TITLE>supplier invoice : no error message displayed when trying to delete a reconciled payment</TITLE>
  <DESCRIPTION>On a V18.0.3, go to a supplier invoice that has already been payed, and which payment has been reconciled. Re-open the invoice and notice there is a delete button at the end of the payment line, which proposes to delete the payment. If you click on this delete button, and confirm your choice, it seems like nothing happens. This is because your payment is reconciled and Dolibarr refuses to delete the payment. However, there is no error message giving you this information. This type of error is correctly handled via the `paiementfourn` class: https://github.com/Dolibarr/dolibarr/blob/09696078f37da3b5e37e72b3d3ea42fa205a8f28/htdocs/fourn/class/paiementfourn.class.php#L455-L465 In `card.php` however, `header()` is called right after the `delete()` action at line 706, so if there is an error, we never set the event message at line 709: https://github.com/Dolibarr/dolibarr/blob/09696078f37da3b5e37e72b3d3ea42fa205a8f28/htdocs/fourn/facture/card.php#L698-L711</DESCRIPTION>
  <REPONAME>dolibarr</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>overall percentage of advancement is false if specials lines (#26522)</MESSAGE>
    <SHA>09696078f37da3b5e37e72b3d3ea42fa205a8f28</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>fix #26551</MESSAGE>
      <SHA>5e776d8fe2146b37372e5d2a780154b38d521fc4</SHA>
      <PATCHEDFILES>
        <FILE>htdocs/fourn/facture/card.php</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>fix #26551 Supplier Invoice - Display the error message when trying to delete an already reconciled payment (#26552) * fix #26551 * fix white space at the end of lines</MESSAGE>
      <SHA>390260640ae4b76545f583c434b1a1566d048729</SHA>
      <PATCHEDFILES>
        <FILE>htdocs/fourn/facture/card.php</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
