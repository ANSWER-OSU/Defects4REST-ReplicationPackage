<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>26965</ISSUENO>
  <ISSUEURL>https://github.com/Dolibarr/dolibarr/issues/26965</ISSUEURL>
  <TITLE>Variants: missing check if variable &quot;VARIANT_ALLOW_STOCK_MOVEMENT_ON_VARIANT_PARENT&quot; is set</TITLE>
  <DESCRIPTION>### Bug In the check for the user rights the code has an OR clause which checks if a product is not a variant **OR** a certain string is globally set. https://github.com/Dolibarr/dolibarr/blob/e4536e0a2ebb87a91a09bf595242c2181889c0b4/htdocs/product/stock/product.php#L948 In the following if clause this check for the global string is missing: https://github.com/Dolibarr/dolibarr/blob/e4536e0a2ebb87a91a09bf595242c2181889c0b4/htdocs/product/stock/product.php#L962 This means that even if the global string **VARIANT_ALLOW_STOCK_MOVEMENT_ON_VARIANT_PARENT** is set the product stock page does not show the serial/charge number table. ### Environment Version 18.0.1 ### Environment OS Ubuntu Ubuntu 22.04.2 LTS x86_64 ### Environment Web server nginx version: nginx/1.18.0 (Ubuntu) ### Environment PHP PHP 7.4.33 (cli) (built: Jun 8 2023 15:23:32) ( NTS ) Copyright (c) The PHP Group Zend Engine v3.4.0, Copyright (c) Zend Technologies with Zend OPcache v7.4.33, Copyright (c), by Zend Technologies ### Environment Database mariadb Ver 15.1 Distrib 10.6.14-MariaDB, for debian-linux-gnu (x86_64) using EditLine wrapper ### Environment URL(s) /product/stock/product.php?id=2915 ### Expected and actual behavior Expected behaviour: If variable **VARIANT_ALLOW_STOCK_MOVEMENT_ON_VARIANT_PARENT** is set it should also show the stock table. ### Steps to reproduce the behavior 1. Setup -&gt; other Setup -&gt; add variable with name = &quot;VARIANT_ALLOW_STOCK_MOVEMENT_ON_VARIANT_PARENT&quot; and value = 1 2. go to product/stock/product.php Buttons for &quot;Transfer Stock&quot; and &quot;Correct Stock&quot; are visible, you can create a stock movement, but cannot see the table with serial/charge numbers. ### Attached files _No response_</DESCRIPTION>
  <REPONAME>dolibarr</REPONAME>
  <TIMEDIFFERENCEDAYS>1</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #26963 from cesar-bsd-com-br/patch-1 FIX: total_time at bottom in project overview only showing last value, instead of a sum of all records</MESSAGE>
    <SHA>e4536e0a2ebb87a91a09bf595242c2181889c0b4</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>FIX #26965 add check for global variable VARIANT_ALLOW_STOCK_MOVEMENT_ON_VARIANT_PARENT Adding an OR clause in the check if product is a variant. Same structure as in check if user has rights to create movement.</MESSAGE>
      <SHA>92161b67cdc24475b1f15f20a2e50f2ea95dcf67</SHA>
      <PATCHEDFILES>
        <FILE>htdocs/product/stock/product.php</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Merge pull request #26967 from DaBootO/develop FIX #26965 add check for global variable VARIANT_ALLOW_STOCK_MOVEMEMENT</MESSAGE>
      <SHA>b56688706bf732f63db94009042f37eb8558f2af</SHA>
      <PATCHEDFILES>
        <FILE>htdocs/product/stock/product.php</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
