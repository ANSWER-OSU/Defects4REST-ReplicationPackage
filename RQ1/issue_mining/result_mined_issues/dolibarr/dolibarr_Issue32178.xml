<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>32178</ISSUENO>
  <ISSUEURL>https://github.com/Dolibarr/dolibarr/issues/32178</ISSUEURL>
  <TITLE>[19.0.4]: repair script, postgresql, results in Error DB_ERROR_SYNTAX (Req 159): create table tmp_bank_url_expense_user</TITLE>
  <DESCRIPTION>### Bug repair.php results in the following error on 19.0.4 with a postgresql database: ``` Error DB_ERROR_SYNTAX (Req 159): create table tmp_bank_url_expense_user (select e.fk_user_author, bu2.fk_bank from llx_expensereport as e, llx_bank_url as bu2 where bu2.url_id = e.rowid and bu2.type = 'payment_expensereport'); ERROR: 42601: syntax error at or near &quot;select&quot; LINE 1: create table tmp_bank_url_expense_user (select e.fk_user_aut... ^ LOCATION: scanner_yyerror, scan.l:1145 ``` ### Dolibarr Version 19.0.4 ### Environment PHP 7.2 ### Environment Database Postgresql 12 ### Steps to reproduce the behavior and expected behavior Database originated from Dolibarr 15.0.x, updated to 16.0.x, then updated to 19.0.x (after 17.x and 18.x migration but from the 19.0.2 image), the problem appeared on 19.0.2, so I updated and tried to repair on 19.0.4. Start repairing resulted in the following SQL error: ``` Error DB_ERROR_SYNTAX (Req 159): create table tmp_bank_url_expense_user (select e.fk_user_author, bu2.fk_bank from llx_expensereport as e, llx_bank_url as bu2 where bu2.url_id = e.rowid and bu2.type = 'payment_expensereport'); ERROR: 42601: syntax error at or near &quot;select&quot; LINE 1: create table tmp_bank_url_expense_user (select e.fk_user_aut... ^ LOCATION: scanner_yyerror, scan.l:1145 ``` Full logs: ``` Database server version 12.20 (Debian 12.20-1.pgdg110+1) Please be patient... *** Script repair.sql Request 1 sql='UPDATE llx_user set api_key = null where api_key = '';' Request 2 sql='UPDATE llx_c_email_templates SET position = 0 WHERE position IS NULL;' Request 3 sql='ALTER TABLE llx_propal DROP FOREIGN KEY fk_propal_fk_currency;' Request 4 sql='ALTER TABLE llx_commande DROP FOREIGN KEY fk_commande_fk_currency;' Request 5 sql='ALTER TABLE llx_facture DROP FOREIGN KEY fk_facture_fk_currency;' Request 6 sql='delete from llx_facturedet where fk_facture in (select rowid from llx_facture where ref in ('(PROV)','ErrorBadMask'));' Request 7 sql='delete from llx_facture where ref in ('(PROV)','ErrorBadMask');' Request 8 sql='delete from llx_commandedet where fk_commande in (select rowid from llx_commande where ref in ('(PROV)','ErrorBadMask'));' Request 9 sql='delete from llx_commande where ref in ('(PROV)','ErrorBadMask');' Request 10 sql='delete from llx_propaldet where fk_propal in (select rowid from llx_propal where ref in ('(PROV)','ErrorBadMask'));' Request 11 sql='delete from llx_propal where ref in ('(PROV)','ErrorBadMask');' Request 12 sql='delete from llx_facturedet where fk_facture in (select rowid from llx_facture where ref = '');' Request 13 sql='delete from llx_facture where ref = '';' Request 14 sql='delete from llx_commandedet where fk_commande in (select rowid from llx_commande where ref = '');' Request 15 sql='delete from llx_commande where ref = '';' Request 16 sql='delete from llx_propaldet where fk_propal in (select rowid from llx_propal where ref = '');' Request 17 sql='delete from llx_propal where ref = '';' Request 18 sql='delete from llx_deliverydet where fk_delivery in (select rowid from llx_delivery where ref = '');' Request 19 sql='delete from llx_delivery where ref = '';' Request 20 sql='delete from llx_expeditiondet where fk_expedition in (select rowid from llx_expedition where ref = '');' Request 21 sql='delete from llx_expedition where ref = '';' Request 22 sql='delete from llx_holiday_logs where fk_user_update not IN (select rowid from llx_user);' Request 23 sql='delete from llx_rights_def where perms IS NULL;' Request 24 sql='delete from llx_user_rights where fk_user not IN (select rowid from llx_user);' Request 25 sql='delete from llx_usergroup_rights where fk_usergroup not in (select rowid from llx_usergroup);' Request 26 sql='delete from llx_usergroup_rights where fk_id not in (select id from llx_rights_def);' Request 27 sql='update llx_deplacement set dated='2010-01-01' where dated &lt; '2000-01-01';' Request 28 sql='update llx_subscription set fk_bank = null where fk_bank not in (select rowid from llx_bank);' Request 29 sql='update llx_propal set fk_projet = null where fk_projet not in (select rowid from llx_projet);' Request 30 sql='update llx_commande set fk_projet = null where fk_projet not in (select rowid from llx_projet);' Request 31 sql='update llx_facture set fk_projet = null where fk_projet not in (select rowid from llx_projet);' Request 32 sql='update llx_commande_fournisseur set fk_projet = null where fk_projet not in (select rowid from llx_projet);' Request 33 sql='update llx_contrat set fk_projet = null where fk_projet not in (select rowid from llx_projet);' Request 34 sql='update llx_deplacement set fk_projet = null where fk_projet not in (select rowid from llx_projet);' Request 35 sql='update llx_facture_fourn set fk_projet = null where fk_projet not in (select rowid from llx_projet);' Request 36 sql='update llx_facture_rec set fk_projet = null where fk_projet not in (select rowid from llx_projet);' Request 37 sql='update llx_fichinter set fk_projet = null where fk_projet not in (select rowid from llx_projet);' Request 38 sql='update llx_projet_task set fk_projet = null where fk_projet not in (select rowid from llx_projet);' Request 39 sql='update llx_propal set fk_user_author = null where fk_user_author not in (select rowid from llx_user);' Request 40 sql='update llx_propal set fk_user_valid = null where fk_user_valid not in (select rowid from llx_user);' Request 41 sql='update llx_propal set fk_user_cloture = null where fk_user_cloture not in (select rowid from llx_user);' Request 42 sql='update llx_commande set fk_user_author = null where fk_user_author not in (select rowid from llx_user);' Request 43 sql='update llx_commande set fk_user_valid = null where fk_user_valid not in (select rowid from llx_user);' Request 44 sql='delete from llx_societe_extrafields where fk_object not in (select rowid from llx_societe);' Request 45 sql='delete from llx_adherent_extrafields where fk_object not in (select rowid from llx_adherent);' Request 46 sql='delete from llx_product_extrafields where fk_object not in (select rowid from llx_product);' Request 47 sql='UPDATE llx_product SET datec = tms WHERE datec IS NULL;' Request 48 sql='update llx_product_batch set batch = '' where batch = 'Non défini';' Request 49 sql='update llx_product_batch set batch = '' where batch = 'Non défini';' Request 50 sql='update llx_stock_mouvement set batch = null where batch = 'Non défini';' Request 51 sql='update llx_stock_mouvement set batch = null where batch = 'Non défini';' Request 52 sql='DELETE FROM llx_product_lot WHERE fk_product NOT IN (select rowid from llx_product);' Request 53 sql='DELETE FROM llx_product_stock WHERE fk_product NOT IN (select rowid from llx_product);' Request 54 sql='DELETE FROM llx_product_stock WHERE reel = 0 AND rowid NOT IN (SELECT fk_product_stock FROM llx_product_batch as pb);' Request 55 sql='DROP TABLE tmp_llx_product_batch;' Request 56 sql='DROP TABLE tmp_llx_product_batch2;' Request 57 sql='CREATE TABLE tmp_llx_product_batch AS select fk_product_stock, eatby, sellby, batch, SUM(qty) as qty, COUNT(rowid) as nb FROM llx_product_batch GROUP BY fk_product_stock, eatby, sellby, batch HAVING COUNT(rowid) &gt; 1;' Request 58 sql='CREATE TABLE tmp_llx_product_batch2 AS select pb.rowid, pb.fk_product_stock, pb.eatby, pb.sellby, pb.batch, pb.qty from llx_product_batch as pb, tmp_llx_product_batch as tpb where pb.fk_product_stock = tpb.fk_product_stock and COALESCE(pb.eatby, '2000-01-01') = COALESCE(tpb.eatby,'2000-01-01') and COALESCE(pb.sellby, '2000-01-01') = COALESCE(tpb.sellby, '2000-01-01') and pb.batch = tpb.batch;' Request 59 sql='DELETE FROM llx_product_batch WHERE rowid IN (select rowid FROM tmp_llx_product_batch2);' Request 60 sql='INSERT INTO llx_product_batch(fk_product_stock, eatby, sellby, batch, qty) SELECT fk_product_stock, eatby, sellby, batch, qty FROM tmp_llx_product_batch;' Request 61 sql='DELETE FROM llx_product_stock WHERE reel = 0 AND rowid NOT IN (SELECT fk_product_stock FROM llx_product_batch as pb);' Request 62 sql='DELETE FROM llx_product_batch WHERE qty = 0;' Request 63 sql='UPDATE llx_product p SET p.stock= (SELECT SUM(ps.reel) FROM llx_product_stock ps WHERE ps.fk_product = p.rowid);' Request 64 sql='delete from llx_product_association where fk_product_pere NOT IN (select rowid from llx_product);' Request 65 sql='delete from llx_product_association where fk_product_fils NOT IN (select rowid from llx_product);' Request 66 sql='drop table tmp_categorie;' Request 67 sql='create table tmp_categorie as select * from llx_categorie;' Request 68 sql='delete from llx_categorie where fk_parent not in (select rowid from tmp_categorie) and fk_parent is not null and fk_parent &lt;&gt; 0;' Request 69 sql='drop table tmp_categorie;' Request 70 sql='delete from llx_categorie_product where fk_categorie not in (select rowid from llx_categorie where type = 0);' Request 71 sql='delete from llx_categorie_fournisseur where fk_categorie not in (select rowid from llx_categorie where type = 1);' Request 72 sql='delete from llx_categorie_societe where fk_categorie not in (select rowid from llx_categorie where type = 2);' Request 73 sql='delete from llx_categorie_member where fk_categorie not in (select rowid from llx_categorie where type = 3);' Request 74 sql='delete from llx_categorie_contact where fk_categorie not in (select rowid from llx_categorie where type = 4);' Request 75 sql='delete from llx_categorie_project where fk_categorie not in (select rowid from llx_categorie where type = 6);' Request 76 sql='delete from llx_ecm_files where src_object_type = 'expensereport' and src_object_id NOT IN (select rowid from llx_expensereport);' Request 77 sql='delete from llx_ecm_files where (src_object_type = 'contrat' OR src_object_type = 'contract') and src_object_id NOT IN (select rowid from llx_contrat);' Request 78 sql='delete from llx_deliverydet where fk_delivery not in (select fk_target from llx_element_element where targettype = 'delivery') AND fk_delivery not in (select fk_source from llx_element_element where sourcetype = 'delivery');' Request 79 sql='delete from llx_delivery where rowid not in (select fk_target from llx_element_element where targettype = 'delivery') AND rowid not in (select fk_source from llx_element_element where sourcetype = 'delivery');' Request 80 sql='delete from llx_element_element where targettype='shipping' and fk_target not in (select rowid from llx_expedition);' Request 81 sql='delete from llx_element_element where targettype='delivery' and fk_target not in (select rowid from llx_delivery);' Request 82 sql='delete from llx_element_element where targettype='propal' and fk_target not in (select rowid from llx_propal);' Request 83 sql='delete from llx_element_element where targettype='facture' and fk_target not in (select rowid from llx_facture);' Request 84 sql='delete from llx_element_element where targettype='commande' and fk_target not in (select rowid from llx_commande);' Request 85 sql='delete from llx_element_element where sourcetype='shipping' and fk_source not in (select rowid from llx_expedition);' Request 86 sql='delete from llx_element_element where sourcetype='delivery' and fk_source not in (select rowid from llx_delivery);' Request 87 sql='delete from llx_element_element where sourcetype='propal' and fk_source not in (select rowid from llx_propal);' Request 88 sql='delete from llx_element_element where sourcetype='facture' and fk_source not in (select rowid from llx_facture);' Request 89 sql='delete from llx_element_element where sourcetype='commande' and fk_source not in (select rowid from llx_commande);' Request 90 sql='DELETE FROM llx_actioncomm_resources WHERE fk_actioncomm not in (select id from llx_actioncomm);' Request 91 sql='DELETE from llx_bank_url where type = 'payment' and url_id not in (select rowid from llx_paiement);' Request 92 sql='DELETE from llx_bank_url where type = 'payment_supplier' and url_id not in (select rowid from llx_paiementfourn);' Request 93 sql='DELETE from llx_bank_url where type = 'company' and url_id not in (select rowid from llx_societe);' Request 94 sql='DELETE FROM llx_bank WHERE fk_account NOT IN (select rowid from llx_bank_account);' Request 95 sql='DROP table tmp_user;' Request 96 sql='CREATE TABLE tmp_user as (select * from llx_user);' Request 97 sql='UPDATE llx_user SET fk_user = NULL where fk_user NOT IN (select rowid from tmp_user);' Request 98 sql='UPDATE llx_product SET canvas = NULL where canvas = 'default@product';' Request 99 sql='UPDATE llx_product SET canvas = NULL where canvas = 'service@product';' Request 100 sql='DELETE FROM llx_boxes where box_id NOT IN (SELECT rowid FROM llx_boxes_def);' Request 101 sql='update llx_document_model set nom = 'typhon' where (nom = '' OR nom is null) and type = 'delivery';' Request 102 sql='DELETE FROM llx_document_model WHERE nom ='elevement' AND type='delivery';' Request 103 sql='insert into llx_c_actioncomm (id, code, type, libelle, module, position) values ( 1, 'AC_TEL', 'system', 'Phone call' ,NULL, 2);' Request 104 sql='insert into llx_c_actioncomm (id, code, type, libelle, module, position) values ( 2, 'AC_FAX', 'system', 'Send Fax' ,NULL, 3);' Request 105 sql='insert into llx_c_actioncomm (id, code, type, libelle, module, position) values ( 3, 'AC_PROP', 'systemauto', 'Send commercial proposal by email' ,'propal', 10);' Request 106 sql='insert into llx_c_actioncomm (id, code, type, libelle, module, position) values ( 4, 'AC_EMAIL', 'system', 'Send Email' ,NULL, 4);' Request 107 sql='insert into llx_c_actioncomm (id, code, type, libelle, module, position) values ( 5, 'AC_RDV', 'system', 'Rendez-vous' ,NULL, 1);' Request 108 sql='insert into llx_c_actioncomm (id, code, type, libelle, module, position) values ( 8, 'AC_COM', 'systemauto', 'Send customer order by email' ,'order', 8);' Request 109 sql='insert into llx_c_actioncomm (id, code, type, libelle, module, position) values ( 9, 'AC_FAC', 'systemauto', 'Send customer invoice by email' ,'invoice', 6);' Request 110 sql='insert into llx_c_actioncomm (id, code, type, libelle, module, position) values ( 10, 'AC_SHIP', 'systemauto', 'Send shipping by email' ,'shipping', 11);' Request 111 sql='insert into llx_c_actioncomm (id, code, type, libelle, module, position) values ( 30, 'AC_SUP_ORD', 'systemauto', 'Send supplier order by email' ,'order_supplier', 9);' Request 112 sql='insert into llx_c_actioncomm (id, code, type, libelle, module, position) values (31, 'AC_SUP_INV', 'systemauto', 'Send supplier invoice by email' ,'invoice_supplier', 7);' Request 113 sql='insert into llx_c_actioncomm (id, code, type, libelle, module, position) values ( 50, 'AC_OTH', 'system', 'Other' ,NULL, 5);' Request 114 sql='DELETE FROM llx_boxes_def as T1 WHERE rowid NOT IN (SELECT min(rowid) FROM llx_boxes_def GROUP BY file, entity, note);' Request 115 sql='ALTER TABLE llx_product_fournisseur_price DROP COLUMN fk_product_fournisseur;' Request 116 sql='ALTER TABLE llx_product_fournisseur_price DROP FOREIGN KEY fk_product_fournisseur;' Request 117 sql='update llx_opensurvey_sondage set format = 'D' where format = 'D+';' Request 118 sql='update llx_opensurvey_sondage set format = 'A' where format = 'A+';' Request 119 sql='update llx_opensurvey_sondage set tms = now();' Request 120 sql='update llx_product set barcode = null where barcode in ('', '-1', '0');' Request 121 sql='update llx_societe set barcode = null where barcode in ('', '-1', '0');' Request 122 sql='drop table tmp_links_double;' Request 123 sql='create table tmp_links_double as (select objectid, label, max(rowid) as max_rowid, count(rowid) as count_rowid from llx_links where label is not null group by objectid, label having count(rowid) &gt;= 2);' Request 124 sql='delete from llx_links where (rowid, label) in (select max_rowid, label from tmp_links_double);' Request 125 sql='drop table tmp_links_double;' Request 126 sql='drop table tmp_product_double;' Request 127 sql='create table tmp_product_double as (select barcode, max(rowid) as max_rowid, count(rowid) as count_rowid from llx_product where barcode is not null group by barcode having count(rowid) &gt;= 2);' Request 128 sql='update llx_product set barcode = null where (rowid, barcode) in (select max_rowid, barcode from tmp_product_double);' Request 129 sql='drop table tmp_product_double;' Request 130 sql='drop table tmp_societe_double;' Request 131 sql='create table tmp_societe_double as (select barcode, max(rowid) as max_rowid, count(rowid) as count_rowid from llx_societe where barcode is not null group by barcode having count(rowid) &gt;= 2);' Request 132 sql='update llx_societe set barcode = null where (rowid, barcode) in (select max_rowid, barcode from tmp_societe_double);' Request 133 sql='drop table tmp_societe_double;' Request 134 sql='drop table tmp_accounting_account_double;' Request 135 sql='create table tmp_accounting_account_double as (select account_number, fk_pcg_version, entity, max(rowid) as max_rowid, count(rowid) as count_rowid from llx_accounting_account where label is not null group by account_number, fk_pcg_version, entity having count(rowid) &gt;= 2);' Request 136 sql='delete from llx_accounting_account where (rowid) in (select max_rowid from tmp_accounting_account_double);' Request 137 sql='drop table tmp_accounting_account_double;' Request 138 sql='UPDATE llx_projet_task SET fk_task_parent = 0 WHERE fk_task_parent = rowid;' Request 139 sql='UPDATE llx_actioncomm set fk_user_action = fk_user_done where fk_user_done &gt; 0 and (fk_user_action is null or fk_user_action = 0);' Request 140 sql='UPDATE llx_actioncomm set fk_user_action = fk_user_author where fk_user_author &gt; 0 and (fk_user_action is null or fk_user_action = 0);' Request 141 sql='UPDATE llx_element_time set element_datehour = element_date where element_datehour IS NULL and element_date IS NOT NULL;' Request 142 sql='UPDATE llx_projet set fk_opp_status = NULL where fk_opp_status = -1;' Request 143 sql='UPDATE llx_projet set fk_opp_status = (SELECT rowid FROM llx_c_lead_status WHERE code='PROSP') where fk_opp_status IS NULL and opp_amount &gt; 0;' Request 144 sql='UPDATE llx_c_lead_status set code = 'WON' where code = 'WIN';' Request 145 sql='update llx_propaldet set product_type = 1 where product_type = 2;' Request 146 sql='update llx_commandedet set product_type = 1 where product_type = 2;' Request 147 sql='update llx_facturedet set product_type = 1 where product_type = 2;' Request 148 sql='update llx_propal set fk_statut = 1 where fk_statut = -1;' Request 149 sql='delete from llx_commande_fournisseur_dispatch where fk_commandefourndet = 0 or fk_commandefourndet IS NULL;' Request 150 sql='delete from llx_menu where menu_handler = 'smartphone';' Request 151 sql='update llx_expedition set date_valid = date_creation where fk_statut = 1 and date_valid IS NULL;' Request 152 sql='update llx_expedition set date_valid = NOW() where fk_statut = 1 and date_valid IS NULL;' Request 153 sql='update llx_projet_task as pt set pt.duration_effective = (select SUM(ptt.element_duration) as y from llx_element_time as ptt where ptt.fk_element = pt.rowid and ptt.elementtype = 'task') where pt.duration_effective &lt;&gt; (select SUM(ptt.element_duration) as y from llx_element_time as ptt where ptt.fk_element = pt.rowid and ptt.elementtype = 'task');' Request 154 sql='drop table tmp_c_shipment_mode;' Request 155 sql='create table tmp_c_shipment_mode as (select code, tracking from llx_c_shipment_mode);' Request 156 sql='DELETE FROM llx_c_shipment_mode where code IN (select code from tmp_c_shipment_mode WHERE tracking is NULL OR tracking = '') AND code IN (select code from tmp_c_shipment_mode WHERE tracking is NOT NULL AND tracking != '') AND (tracking IS NULL OR tracking = '');' Request 157 sql='drop table tmp_c_shipment_mode;' Request 158 sql='drop table tmp_bank_url_expense_user;' Request 159 sql='create table tmp_bank_url_expense_user (select e.fk_user_author, bu2.fk_bank from llx_expensereport as e, llx_bank_url as bu2 where bu2.url_id = e.rowid and bu2.type = 'payment_expensereport');' Error DB_ERROR_SYNTAX (Req 159): create table tmp_bank_url_expense_user (select e.fk_user_author, bu2.fk_bank from llx_expensereport as e, llx_bank_url as bu2 where bu2.url_id = e.rowid and bu2.type = 'payment_expensereport'); ERROR: 42601: syntax error at or near &quot;select&quot; LINE 1: create table tmp_bank_url_expense_user (select e.fk_user_aut... ^ LOCATION: scanner_yyerror, scan.l:1145 Request 160 sql='update llx_bank_url as bu set url_id = (select e.fk_user_author from tmp_bank_url_expense_user as e where e.fk_bank = bu.fk_bank) where (bu.url_id = 0 OR bu.url_id IS NULL) and bu.type ='user';' Request 161 sql='drop table tmp_bank_url_expense_user;' Request 162 sql='DROP TABLE tmp_llx_accouting_account;' Request 163 sql='CREATE TABLE tmp_llx_accouting_account AS SELECT MIN(rowid) as MINID, account_number, entity, fk_pcg_version, count(*) AS NB FROM llx_accounting_account group BY account_number, entity, fk_pcg_version HAVING count(*) &gt;= 2 order by account_number, entity, fk_pcg_version;' Request 164 sql='DELETE from llx_accounting_account where rowid in (select minid from tmp_llx_accouting_account where minid NOT IN (SELECT fk_code_ventilation from llx_facturedet) AND minid NOT IN (SELECT fk_code_ventilation from llx_facture_fourn_det) AND minid NOT IN (SELECT fk_code_ventilation from llx_expensereport_det));' Request 165 sql='ALTER TABLE llx_accounting_account DROP INDEX uk_accounting_account;' Request 166 sql='ALTER TABLE llx_accounting_account ADD UNIQUE INDEX uk_accounting_account (account_number, entity, fk_pcg_version);' Request 167 sql='UPDATE llx_facturedet SET fk_code_ventilation = 0 WHERE fk_code_ventilation &gt; 0 AND fk_code_ventilation NOT IN (select rowid FROM llx_accounting_account);' Request 168 sql='UPDATE llx_facture_fourn_det SET fk_code_ventilation = 0 WHERE fk_code_ventilation &gt; 0 AND fk_code_ventilation NOT IN (select rowid FROM llx_accounting_account);' Request 169 sql='UPDATE llx_expensereport_det SET fk_code_ventilation = 0 WHERE fk_code_ventilation &gt; 0 AND fk_code_ventilation NOT IN (select rowid FROM llx_accounting_account);' Request 170 sql='UPDATE llx_chargesociales SET date_creation = tms WHERE date_creation IS NULL;' Request 171 sql='update llx_facturedet set product_type = 0 where product_type = 1 AND fk_product &gt; 0 AND fk_product IN (SELECT rowid FROM llx_product WHERE fk_product_type = 0);' Request 172 sql='update llx_facturedet set product_type = 1 where product_type = 0 AND fk_product &gt; 0 AND fk_product IN (SELECT rowid FROM llx_product WHERE fk_product_type = 1);' Request 173 sql='update llx_facture_fourn_det set product_type = 0 where product_type = 1 AND fk_product &gt; 0 AND fk_product IN (SELECT rowid FROM llx_product WHERE fk_product_type = 0);' Request 174 sql='update llx_facture_fourn_det set product_type = 1 where product_type = 0 AND fk_product &gt; 0 AND fk_product IN (SELECT rowid FROM llx_product WHERE fk_product_type = 1);' Request 175 sql='DELETE FROM llx_mrp_production where qty = 0;' Request 176 sql='UPDATE llx_accounting_bookkeeping set date_creation = tms where date_creation IS NULL;' Request 177 sql='UPDATE llx_facturedet SET multicurrency_subprice = -multicurrency_subprice WHERE ((multicurrency_subprice &lt; 0 and subprice &gt; 0) OR (multicurrency_subprice &gt; 0 and subprice &lt; 0));' Request 178 sql='UPDATE llx_facturedet SET multicurrency_total_ht = -multicurrency_total_ht WHERE ((multicurrency_total_ht &lt; 0 and total_ht &gt; 0) OR (multicurrency_total_ht &gt; 0 and total_ht &lt; 0));' Request 179 sql='UPDATE llx_facturedet SET multicurrency_total_tva = -multicurrency_total_tva WHERE ((multicurrency_total_tva &lt; 0 and total_tva &gt; 0) OR (multicurrency_total_tva &gt; 0 and total_tva &lt; 0));' Request 180 sql='UPDATE llx_facturedet SET multicurrency_total_ttc = -multicurrency_total_ttc WHERE ((multicurrency_total_ttc &lt; 0 and total_ttc &gt; 0) OR (multicurrency_total_ttc &gt; 0 and total_ttc &lt; 0));' Request 181 sql='UPDATE llx_facture SET multicurrency_total_ht = -multicurrency_total_ht WHERE ((multicurrency_total_ht &lt; 0 and total_ht &gt; 0) OR (multicurrency_total_ht &gt; 0 and total_ht &lt; 0));' Request 182 sql='UPDATE llx_facture SET multicurrency_total_tva = -multicurrency_total_tva WHERE ((multicurrency_total_tva &lt; 0 and total_tva &gt; 0) OR (multicurrency_total_tva &gt; 0 and total_tva &lt; 0));' Request 183 sql='UPDATE llx_facture SET multicurrency_total_ttc = -multicurrency_total_ttc WHERE ((multicurrency_total_ttc &lt; 0 and total_ttc &gt; 0) OR (multicurrency_total_ttc &gt; 0 and total_ttc &lt; 0));' Request 184 sql='UPDATE llx_facture_fourn_det SET multicurrency_subprice = -multicurrency_subprice WHERE ((multicurrency_subprice &lt; 0 and pu_ht &gt; 0) OR (multicurrency_subprice &gt; 0 and pu_ht &lt; 0));' Request 185 sql='UPDATE llx_facture_fourn_det SET multicurrency_total_ht = -multicurrency_total_ht WHERE ((multicurrency_total_ht &lt; 0 and total_ht &gt; 0) OR (multicurrency_total_ht &gt; 0 and total_ht &lt; 0));' Request 186 sql='UPDATE llx_facture_fourn_det SET multicurrency_total_tva = -multicurrency_total_tva WHERE ((multicurrency_total_tva &lt; 0 and tva &gt; 0) OR (multicurrency_total_tva &gt; 0 and tva &lt; 0));' Request 187 sql='UPDATE llx_facture_fourn_det SET multicurrency_total_ttc = -multicurrency_total_ttc WHERE ((multicurrency_total_ttc &lt; 0 and total_ttc &gt; 0) OR (multicurrency_total_ttc &gt; 0 and total_ttc &lt; 0));' Request 188 sql='UPDATE llx_facture_fourn SET multicurrency_total_ht = -multicurrency_total_ht WHERE ((multicurrency_total_ht &lt; 0 and total_ht &gt; 0) OR (multicurrency_total_ht &gt; 0 and total_ht &lt; 0));' Request 189 sql='UPDATE llx_facture_fourn SET multicurrency_total_tva = -multicurrency_total_tva WHERE ((multicurrency_total_tva &lt; 0 and total_tva &gt; 0) OR (multicurrency_total_tva &gt; 0 and total_tva &lt; 0));' Request 190 sql='UPDATE llx_facture_fourn SET multicurrency_total_ttc = -multicurrency_total_ttc WHERE ((multicurrency_total_ttc &lt; 0 and total_ttc &gt; 0) OR (multicurrency_total_ttc &gt; 0 and total_ttc &lt; 0));' Request 191 sql='UPDATE llx_facturedet SET situation_percent = 100 WHERE situation_percent IS NULL AND fk_prev_id IS NULL;' Request 192 sql='DELETE FROM llx_rights_def WHERE module = 'hrm' AND perms = 'employee';' Request 193 sql='DELETE FROM llx_c_transport_mode as T1 WHERE rowid NOT IN (SELECT min(rowid) FROM llx_c_transport_mode GROUP BY code, entity);' Request 194 sql='DELETE FROM llx_c_departements WHERE fk_region &lt;&gt; 0 AND fk_region IN (select code_region FROM llx_c_regions WHERE fk_pays NOT IN (select rowid from llx_c_country));' Request 195 sql='DELETE from llx_c_regions WHERE fk_pays NOT IN (select rowid from llx_c_country);' Request 196 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combination;' Request 197 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_2;' Request 198 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_3;' Request 199 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_4;' Request 200 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_5;' Request 201 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_6;' Request 202 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_7;' Request 203 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_8;' Request 204 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_9;' Request 205 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_10;' Request 206 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_11;' Request 207 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_12;' Request 208 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_13;' Request 209 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_14;' Request 210 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_15;' Request 211 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_16;' Request 212 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_17;' Request 213 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_18;' Request 214 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_19;' Request 215 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_20;' Request 216 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_21;' Request 217 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_22;' Request 218 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_23;' Request 219 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_24;' Request 220 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_25;' Request 221 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_26;' Request 222 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_27;' Request 223 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_28;' Request 224 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_29;' Request 225 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_30;' Request 226 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_31;' Request 227 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_32;' Request 228 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_33;' Request 229 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_34;' Request 230 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_35;' Request 231 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_36;' Request 232 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_37;' Request 233 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_38;' Request 234 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_39;' Request 235 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_40;' Request 236 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_41;' Request 237 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_42;' Request 238 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_43;' Request 239 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_44;' Request 240 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_45;' Request 241 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_46;' Request 242 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_47;' Request 243 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_48;' Request 244 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_49;' Request 245 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_50;' Request 246 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_51;' Request 247 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_52;' Request 248 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_53;' Request 249 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_54;' Request 250 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_55;' Request 251 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_56;' Request 252 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_57;' Request 253 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_58;' Request 254 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_59;' Request 255 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_60;' Request 256 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_61;' Request 257 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_62;' Request 258 sql='alter table llx_product_attribute_combination_price_level drop index fk_product_attribute_combinati_63;' Request 259 sql='ALTER TABLE llx_product_attribute_combination_price_level ADD UNIQUE INDEX uk_prod_att_comb_price_level(fk_product_attribute_combination, fk_price_level);' ``` ### Attached files _No response_</DESCRIPTION>
  <REPONAME>dolibarr</REPONAME>
  <TIMEDIFFERENCEDAYS>1</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>FIX #31890 store empty line extrafields (#32152) * FIX #31890 store empty line extrafields If a line extrafield had originally some contents, after deleting it and submitting it as empty, the extrafield was not stored but the original contents kept * corrected whitespace</MESSAGE>
    <SHA>18775c06ea9bed16c8590f9b0590a96c7cd0e531</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>FIX #32178: repair.php: fix missing 'as' with Postgres Fix the following SQL error when executing the repair script on 19.0.x and above. Error DB_ERROR_SYNTAX (Req 159): create table tmp_bank_url_expense_user (select e.fk_user_author, bu2.fk_bank from llx_expensereport as e, llx_bank_url as bu2 where bu2.url_id = e.rowid and bu2.type = 'payment_expensereport'); ERROR: 42601: syntax error at or near &quot;select&quot; LINE 1: create table tmp_bank_url_expense_user (select e.fk_user_aut... ^ LOCATION: scanner_yyerror, scan.l:1145</MESSAGE>
      <SHA>e712a75f210d83c62dabf4ec5b3f16733d404903</SHA>
      <PATCHEDFILES>
        <FILE>htdocs/install/mysql/migration/repair.sql</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>FIX #32178: repair.php: fix missing 'as' with Postgres (#32179) Fix the following SQL error when executing the repair script on 19.0.x and above. Error DB_ERROR_SYNTAX (Req 159): create table tmp_bank_url_expense_user (select e.fk_user_author, bu2.fk_bank from llx_expensereport as e, llx_bank_url as bu2 where bu2.url_id = e.rowid and bu2.type = 'payment_expensereport'); ERROR: 42601: syntax error at or near &quot;select&quot; LINE 1: create table tmp_bank_url_expense_user (select e.fk_user_aut... ^ LOCATION: scanner_yyerror, scan.l:1145</MESSAGE>
      <SHA>b02742ebe1c2832af79a29f44c105386f6ba8f48</SHA>
      <PATCHEDFILES>
        <FILE>htdocs/install/mysql/migration/repair.sql</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
