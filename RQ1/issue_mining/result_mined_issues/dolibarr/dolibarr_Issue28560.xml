<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>28560</ISSUENO>
  <ISSUEURL>https://github.com/Dolibarr/dolibarr/issues/28560</ISSUEURL>
  <TITLE>Bug: Virtual stock calculation is wrong if a MoLine was marked as &quot;Stock changed disabled&quot;</TITLE>
  <DESCRIPTION>### Bug If a MoLine is marked with &quot;Stock changed disabled&quot;, the &quot;Virtual stock&quot; at the product is also reduced. The &quot;Virtual stock&quot; must untouched in this case. Mo: ![image](https://github.com/Dolibarr/dolibarr/assets/78662388/c78fcd1b-0742-4681-bd82-3542dcae0cf6) Product: ![image](https://github.com/Dolibarr/dolibarr/assets/78662388/40ee76a2-89a2-4db3-b5a6-eb31fd222b05) ### Environment Version 19 ### Environment OS _No response_ ### Environment Web server _No response_ ### Environment PHP _No response_ ### Environment Database _No response_ ### Environment URL(s) _No response_ ### Expected and actual behavior _No response_ ### Steps to reproduce the behavior _No response_ ### Attached files _No response_</DESCRIPTION>
  <REPONAME>dolibarr</REPONAME>
  <TIMEDIFFERENCEDAYS>5</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>- fix &quot;Found non sanitized string&quot; ?</MESSAGE>
    <SHA>03c0c6dbd9617d20760c5faa936cdc2664fa6cb8</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Merge branch '19.0' into 19.0_Fix-#28560-virtual-stock-calculation</MESSAGE>
      <SHA>ddfde2dfb67fd60d531cb51ad17fe7487a05eb86</SHA>
      <PATCHEDFILES>
        <FILE>ChangeLog</FILE>
        <FILE>htdocs/comm/card.php</FILE>
        <FILE>htdocs/compta/facture/class/facture.class.php</FILE>
        <FILE>htdocs/compta/sociales/list.php</FILE>
        <FILE>htdocs/core/class/commoninvoice.class.php</FILE>
        <FILE>htdocs/core/lib/functions.lib.php</FILE>
        <FILE>htdocs/core/lib/security.lib.php</FILE>
        <FILE>htdocs/filefunc.inc.php</FILE>
        <FILE>htdocs/fourn/class/fournisseur.facture.class.php</FILE>
        <FILE>htdocs/fourn/facture/list.php</FILE>
        <FILE>htdocs/mrp/class/mo.class.php</FILE>
        <FILE>htdocs/takepos/pay.php</FILE>
        <FILE>test/phpunit/SecurityTest.php</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
