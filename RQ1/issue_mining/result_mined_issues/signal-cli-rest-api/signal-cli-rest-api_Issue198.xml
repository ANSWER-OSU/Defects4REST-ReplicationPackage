<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>198</ISSUENO>
  <ISSUEURL>https://github.com/bbernhard/signal-cli-rest-api/issues/198</ISSUEURL>
  <TITLE>First messages get lost when receiving via WebSocket</TITLE>
  <DESCRIPTION>### The problem Hi everyone! As I am unsure if the following behavior is a problem specific to the signal-cli api or not, please feel free to close this issue if my question is not related to this project. I set up the signal-cli in a Docker Container and enabled json-rpc mode. Sending messages works like a charm, receiving messages does also work fine, at least to some degree. I noticed a kind of strange behavior that I can not explain to myself. Therefore I would be happy if someone could have a look at the following description of my problem: I wrote a simple Python program, that utilizes the WebSocket-client library to establish a connection to the receive endpoint and prints all incoming messages. However, the exact code of it seems to be irrelevant, as the same thing occurs when I establish a connection via wscat. When I start my receiving ws client, it misses the first x messages that are being sent to the signal-cli. All messages after the xth message get delivered without any problem. Here's how the number x of messages that get lost is determined: When I start my client, receive some messages, stop my client, and then start it up again, x is 1. Therefore I need to send 1 message to the signal-cli that gets lost, then I can continue to receive everything that is incoming as it should be. However, if I do not send a message to the signal-cli in this case and instead stop and restart my ws client again, x is equal to 2 now. The number of lost messages increases for every time a receiving client gets started and stopped, when no message gets sent to the cli while the client is running. It seems to be the case, that somehow all established connections of a WebSocket client get &quot;stacked&quot; inside the signal-cli API and for every incoming message, one of these (dead) connections gets removed from the stack, until finally the current (valid) ws client connection is on top and gets the messages delivered. Is somebody able to make any sense of this kind of behavior? I'd be very grateful if someone could explain to me what's going on here and maybe how to avoid this problem. Thank you very much! ### Are you using the latest released version? - [X] Yes ### Have you read the troubleshooting page? - [X] Yes ### What type of installation are you running? signal-cli-rest-api Docker Container ### In which mode are you using the docker container? JSON-RPC Mode ### What's the architecture of your host system? x86-64 ### Additional information _No response_</DESCRIPTION>
  <REPONAME>signal-cli-rest-api</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>re-generated swagger documentation</MESSAGE>
    <SHA>b64ee6bbb8937b9346d592ee354614654dd1ead7</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>fixed bug in json-rpc mode * properly close websocket connection when client disconnects see #198</MESSAGE>
      <SHA>284e92107cd62b108bad3183c9831145838b6225</SHA>
      <PATCHEDFILES>
        <FILE>src/api/api.go</FILE>
        <FILE>src/client/client.go</FILE>
        <FILE>src/client/jsonrpc2.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>fixed bug in json-rpc mode * properly close websocket connection when client disconnects see #198</MESSAGE>
      <SHA>78677af8f3c607f67c5b87df9688c831fe3e5b9f</SHA>
      <PATCHEDFILES>
        <FILE>src/api/api.go</FILE>
        <FILE>src/client/client.go</FILE>
        <FILE>src/client/jsonrpc2.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
