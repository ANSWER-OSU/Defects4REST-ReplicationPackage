<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>3130</ISSUENO>
  <ISSUEURL>https://github.com/DSpace/DSpace/issues/3130</ISSUEURL>
  <TITLE>Group2group cache is not updated by the REST endpoint</TITLE>
  <DESCRIPTION>**Describe the bug** The `org.dspace.app.rest.GroupRestController` doesn't call the update method of the group service that is responsible from the other things to rethink the group cache. This imply that if an user is member of the childGroup that is added as children to the parentGroup the subsequent calls to `GroupService.allMemberGroups(Context, EPerson)` would fail to get the parentGroup **To Reproduce** Steps to reproduce the behavior: 1. login as admin 2. create a &quot;children group&quot; 3. add the children group as member of a collection/community admin group 4. add a normal user to the children group 5. login with such user 6. verify that such user is not seen as administrator of the community/collection, this because it is an indirect member of the admin group. Alternatively you can check the content of the group2groupcache table This bugs also invalidate several scenario related to the security, discovery and workflow if the involved user get rights/tasks due to his membership to a sub-group **Expected behavior** The group2groupcache table is updated when a group is added or removed as a member of another group via the REST endpoints</DESCRIPTION>
  <REPONAME>DSpace</REPONAME>
  <TIMEDIFFERENCEDAYS>17</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #3103 from tdonohue/reenable_csrf_protection Enable Customized CSRF Protection in Spring Security for Server Webapp</MESSAGE>
    <SHA>d4c6bd7847b16a75f9e898399753484e29ac9036</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>#3130 Cleanup test and add check to proof the issue with the group2groupcache table</MESSAGE>
      <SHA>e310334dd4c31c712dd688f49ef664eb7955a1cc</SHA>
      <PATCHEDFILES>
        <FILE>dspace-server-webapp/src/test/java/org/dspace/app/rest/GroupRestRepositoryIT.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#3130 fix group2groupcache issue in adding/removing subgroups via REST</MESSAGE>
      <SHA>bbea5d548814ef6890dccd36ce50c42f0e69fca1</SHA>
      <PATCHEDFILES>
        <FILE>dspace-api/src/main/java/org/dspace/eperson/service/GroupService.java</FILE>
        <FILE>dspace-server-webapp/src/main/java/org/dspace/app/rest/GroupRestController.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
