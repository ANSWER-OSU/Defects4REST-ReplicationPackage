<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>8736</ISSUENO>
  <ISSUEURL>https://github.com/DSpace/DSpace/issues/8736</ISSUEURL>
  <TITLE>MetadataValues' list doesn't respect ordering after been modified</TITLE>
  <DESCRIPTION>**Description** The bug occurs whenever we modify the `metadata` list inside a `DspaceObject`. If we add or remove some elements, the remaining ones won't be re-ordered. Moreover, fot the `ItemServiceImpl` the order of the `metadata` depends on the method used: - `ItemServiceImpl#getMetadata` if used without `boolean` parameter will always return an ordered list - `ItemServiceImpl#getMetadata` if used with `boolean` parameter the returned list order depens on this value: - `true` The list will be ordered by `MetadataField` and then `Place` - `false` The list won't have a defined ordering. **To Reproduce** After adding a `metadata`, without saving and then reloading the list, the `DspaceObject#getMetadata` will return a filtered list with wrong order. If a `MetadataValue` has been added, without taking in count its place, it will be returned as last value. **Expected behavior** A filtered list by `MetadataField` should always be returned with the same order, and its order should be compatible with the one expected and declared by the _JPA Annotation_ `@OrderBy` here `DspaceObject#metadata`. **Related Work** [Here is](https://github.com/4Science/DSpace/actions/runs/4513210596/jobs/7947734088) a failing test with the expected behavior of the `ItemServiceImpl`.</DESCRIPTION>
  <REPONAME>DSpace</REPONAME>
  <TIMEDIFFERENCEDAYS>35</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #8707 from shorock/iss-8706 Off-by-one in solr-upgrade-statistics-6x #8706</MESSAGE>
    <SHA>b68f03b845a64de6ff88cb011d5040843104468c</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>[DURACOM-125][#8736] Failing Test ItemServiceTest bug: - MetadataValue list once modified should respect a similar order of the `@OrderBy` annotation inside the `DSpaceObject#metadata` field.</MESSAGE>
      <SHA>882373faa133fb5bd104f033a9082b35f9419498</SHA>
      <PATCHEDFILES>
        <FILE>dspace-api/src/test/java/org/dspace/content/service/ItemServiceTest.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>[DURACOM-125][#8736] Preserved order of modified MetadataValues feat: - Introduced new Class with static methods usable to order `MetadataValue` lists; - Introduced ITs also for `PatchMetadata` replace operations; - Introduced new method `DspaceObject#getMetadataFieldId`. ref: - Replaced old sort method inside `ItemServiceImpl` with the new one</MESSAGE>
      <SHA>b1c1edc7f0fc12ee0b2bdeedf463b50ad3e7d2c6</SHA>
      <PATCHEDFILES>
        <FILE>dspace-api/src/main/java/org/dspace/content/DSpaceObject.java</FILE>
        <FILE>dspace-api/src/main/java/org/dspace/content/DSpaceObjectServiceImpl.java</FILE>
        <FILE>dspace-api/src/main/java/org/dspace/content/ItemServiceImpl.java</FILE>
        <FILE>dspace-api/src/main/java/org/dspace/content/MetadataValue.java</FILE>
        <FILE>dspace-api/src/main/java/org/dspace/content/MetadataValueComparators.java</FILE>
        <FILE>dspace-server-webapp/src/test/java/org/dspace/app/rest/PatchMetadataIT.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>[DURACOM-125][#8736] Check replace operation correctness feat: - Introduced ITs inside RestRepositories to check correctness of multi replacement with indexes.</MESSAGE>
      <SHA>692c5b5a996f0376b4007df7ba70b7e8115bae10</SHA>
      <PATCHEDFILES>
        <FILE>dspace-server-webapp/src/test/java/org/dspace/app/rest/BitstreamRestRepositoryIT.java</FILE>
        <FILE>dspace-server-webapp/src/test/java/org/dspace/app/rest/BundleRestRepositoryIT.java</FILE>
        <FILE>dspace-server-webapp/src/test/java/org/dspace/app/rest/CollectionRestRepositoryIT.java</FILE>
        <FILE>dspace-server-webapp/src/test/java/org/dspace/app/rest/CommunityRestRepositoryIT.java</FILE>
        <FILE>dspace-server-webapp/src/test/java/org/dspace/app/rest/EPersonRestRepositoryIT.java</FILE>
        <FILE>dspace-server-webapp/src/test/java/org/dspace/app/rest/GroupRestRepositoryIT.java</FILE>
        <FILE>dspace-server-webapp/src/test/java/org/dspace/app/rest/SiteRestRepositoryIT.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>[DURACOM-125][#8736][DSC-998] Failing Test ItemServiceTest bug: - MetadataValue list once modified should respect a similar order of the `@OrderBy` annotation inside the `DSpaceObject#metadata` field.</MESSAGE>
      <SHA>630f1372beb7b2f65644b6dbed3c3346f41e3e6e</SHA>
      <PATCHEDFILES>
        <FILE>dspace-api/src/test/java/org/dspace/content/service/ItemServiceTest.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>[DURACOM-125][#8736][DSC-998] Preserved order of modified MetadataValues feat: - Introduced new Class with static methods usable to order `MetadataValue` lists; - Introduced ITs also for `PatchMetadata` replace operations; - Introduced new method `DspaceObject#getMetadataFieldId`. ref: - Replaced old sort method inside `ItemServiceImpl` with the new one</MESSAGE>
      <SHA>d7eba3c8bff68808422d57b888bd195d7da81da6</SHA>
      <PATCHEDFILES>
        <FILE>dspace-api/src/main/java/org/dspace/content/DSpaceObject.java</FILE>
        <FILE>dspace-api/src/main/java/org/dspace/content/DSpaceObjectServiceImpl.java</FILE>
        <FILE>dspace-api/src/main/java/org/dspace/content/ItemServiceImpl.java</FILE>
        <FILE>dspace-api/src/main/java/org/dspace/content/MetadataValue.java</FILE>
        <FILE>dspace-api/src/main/java/org/dspace/content/MetadataValueComparators.java</FILE>
        <FILE>dspace-server-webapp/src/test/java/org/dspace/app/rest/PatchMetadataIT.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>[DSC-998][DURACOM-125][#8736] Check replace operation correctness feat: - Introduced ITs inside RestRepositories to check correctness of multi replacement with indexes.</MESSAGE>
      <SHA>2e9e4c9b99561dde629672f4008ddc2beb837efa</SHA>
      <PATCHEDFILES>
        <FILE>dspace-server-webapp/src/test/java/org/dspace/app/rest/BitstreamRestRepositoryIT.java</FILE>
        <FILE>dspace-server-webapp/src/test/java/org/dspace/app/rest/BundleRestRepositoryIT.java</FILE>
        <FILE>dspace-server-webapp/src/test/java/org/dspace/app/rest/CollectionRestRepositoryIT.java</FILE>
        <FILE>dspace-server-webapp/src/test/java/org/dspace/app/rest/CommunityRestRepositoryIT.java</FILE>
        <FILE>dspace-server-webapp/src/test/java/org/dspace/app/rest/EPersonRestRepositoryIT.java</FILE>
        <FILE>dspace-server-webapp/src/test/java/org/dspace/app/rest/GroupRestRepositoryIT.java</FILE>
        <FILE>dspace-server-webapp/src/test/java/org/dspace/app/rest/SiteRestRepositoryIT.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
