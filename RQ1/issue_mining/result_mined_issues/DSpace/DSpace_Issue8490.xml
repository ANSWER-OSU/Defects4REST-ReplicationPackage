<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>8490</ISSUENO>
  <ISSUEURL>https://github.com/DSpace/DSpace/issues/8490</ISSUEURL>
  <TITLE>Solr query exception on workspace submission save due to ORCID &quot;will be generated::orcid::...&quot; authority key syntax</TITLE>
  <DESCRIPTION>**Describe the bug** DSpace 7.3: When adding a new ORCID authority author (dc.contributor.author) to a submission workspace item, a temporary authority key is created with the syntax &quot;will be generated::orcid::ID&quot; (where ID is the ORCID ID). If you select Save, or Save for later, a Solr authority query is performed with this temporary key and results in a server-side Solr org.apache.solr.search.SyntaxError exception. The exception also occurs when first loading a previously saved submission that has any such temporary authority keys. See [solr-exception.txt](https://github.com/DSpace/DSpace/files/9627022/solr-exception.txt) for full stack trace. **To Reproduce** Steps to reproduce the behavior: 1. Enable ORCID authority for dc.contributor.author 2. Start a new submission that accepts dc.contributor.author in the input form 3. Search for and add an ORCID author 4. Select Save or Save for later 5. Check dspace.log file for exception **Expected behavior** Solr queries for &quot;will be generated::orcid::...&quot; keys should be skipped since they will not be in the Solr authority core. Or, the Solr query should be transformed into an acceptable syntax to avoid the exception. **Related work** First discovered while investigating issue #8436</DESCRIPTION>
  <REPONAME>DSpace</REPONAME>
  <TIMEDIFFERENCEDAYS>236</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #8785 from mwoodiupui/event-consumer-doc Document the need to avoid commit() during event dispatch.</MESSAGE>
    <SHA>fea4067464b499f1104478f7edf018bb0aab5d9a</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fix #8490 preferred label lookup When the authority key still needs to be generated, skip the lookup for the preferred label since it does not exist in Solr yet.</MESSAGE>
      <SHA>98b843668e07ae2112b0ce7dbbd741af7afd3189</SHA>
      <PATCHEDFILES>
        <FILE>dspace-api/src/main/java/org/dspace/discovery/indexobject/ItemIndexFactoryImpl.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Merge pull request #8789 from amtuannguyen/main properly escape ':' in query to address #8490</MESSAGE>
      <SHA>c0e62657f634c7973f82a7d1fcbd5f5efa8152f1</SHA>
      <PATCHEDFILES>
        <FILE>dspace-api/src/main/java/org/dspace/content/authority/SolrAuthority.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Merge pull request #8799 from uofmsean/fix-8490-preferred-label-lookup Fix #8490 preferred label lookup</MESSAGE>
      <SHA>d3c03efe61bbd48d27f4cc6904a0a1b656585f64</SHA>
      <PATCHEDFILES>
        <FILE>dspace-api/src/main/java/org/dspace/discovery/indexobject/ItemIndexFactoryImpl.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
