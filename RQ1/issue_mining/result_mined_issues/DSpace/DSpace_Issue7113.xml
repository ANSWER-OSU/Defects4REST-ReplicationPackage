<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>7113</ISSUENO>
  <ISSUEURL>https://github.com/DSpace/DSpace/issues/7113</ISSUEURL>
  <TITLE>[DS-3766] Error submitting an item into a collection without approval workflow via SWORD</TITLE>
  <DESCRIPTION>&lt;i&gt;Imported from JIRA &lt;a href=&quot;https://jira.lyrasis.org/browse/DS-3766&quot;&gt;[DS-3766]&lt;/a&gt; created by olli_gold&lt;/i&gt; &lt;p&gt;Whenever I try to submit an item via SWORD into a collection, which is publicly available to anyone without a submission workflow behind it, I get an error. The submitting user has ADD rights for the target collection, but obviously this is not enough. I get the following error messages:&lt;/p&gt; &lt;p&gt;2017-11-25 14:37:31,620 ERROR org.dspace.sword.SWORDMETSIngester @ caught exception: &lt;br/&gt; org.dspace.authorize.AuthorizeException: Authorization denied for action WRITE on ITEM:be542a71-e668-45c6-93f5-762cc422d504 by user 4de0100f-3636-4614-8761-8d83e4b05db5&lt;br/&gt; at org.dspace.authorize.AuthorizeServiceImpl.authorizeAction(AuthorizeServiceImpl.java:157)&lt;br/&gt; at org.dspace.authorize.AuthorizeServiceImpl.authorizeAction(AuthorizeServiceImpl.java:95)&lt;br/&gt; at org.dspace.authorize.AuthorizeServiceImpl.authorizeAction(AuthorizeServiceImpl.java:89)&lt;br/&gt; at org.dspace.content.ItemServiceImpl.update(ItemServiceImpl.java:435)&lt;br/&gt; at org.dspace.content.ItemServiceImpl.update(ItemServiceImpl.java:61)&lt;br/&gt; at org.dspace.content.packager.PackageUtils.updateDSpaceObject(PackageUtils.java:567)&lt;br/&gt; at org.dspace.content.packager.AbstractMETSIngester.ingestObject(AbstractMETSIngester.java:565)&lt;br/&gt; at org.dspace.content.packager.AbstractMETSIngester.ingest(AbstractMETSIngester.java:243)&lt;br/&gt; at org.dspace.sword.SWORDMETSIngester.ingest(SWORDMETSIngester.java:107)&lt;br/&gt; at org.dspace.sword.CollectionDepositor.doDeposit(CollectionDepositor.java:139)&lt;br/&gt; at org.dspace.sword.DepositManager.deposit(DepositManager.java:168)&lt;br/&gt; at org.dspace.sword.DSpaceSWORDServer.doDeposit(DSpaceSWORDServer.java:133)&lt;br/&gt; at org.purl.sword.server.DepositServlet.doPost(DepositServlet.java:313)&lt;br/&gt; at javax.servlet.http.HttpServlet.service(HttpServlet.java:650)&lt;br/&gt; at javax.servlet.http.HttpServlet.service(HttpServlet.java:731)&lt;br/&gt; at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:303)&lt;br/&gt; at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:208)&lt;br/&gt; at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:52)&lt;br/&gt; at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:241)&lt;br/&gt; at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:208)&lt;br/&gt; at org.apache.catalina.filters.RequestFilter.process(RequestFilter.java:205)&lt;br/&gt; at org.apache.catalina.filters.RemoteAddrFilter.doFilter(RemoteAddrFilter.java:71)&lt;br/&gt; at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:241)&lt;br/&gt; at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:208)&lt;br/&gt; at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:221)&lt;br/&gt; at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:122)&lt;br/&gt; at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:614)&lt;br/&gt; at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:169)&lt;br/&gt; at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:103)&lt;br/&gt; at org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:956)&lt;br/&gt; at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:116)&lt;br/&gt; at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:436)&lt;br/&gt; at org.apache.coyote.ajp.AjpProcessor.process(AjpProcessor.java:190)&lt;br/&gt; at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:625)&lt;br/&gt; at org.apache.tomcat.util.net.JIoEndpoint$SocketProcessor.run(JIoEndpoint.java:316)&lt;br/&gt; at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)&lt;br/&gt; at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)&lt;br/&gt; at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)&lt;br/&gt; at java.lang.Thread.run(Thread.java:748)&lt;br/&gt; 2017-11-25 14:37:31,637 ERROR org.dspace.sword.DSpaceSWORDServer @ caught exception:&lt;br/&gt; org.dspace.sword.DSpaceSWORDException: org.dspace.authorize.AuthorizeException: Authorization denied for action WRITE on ITEM:be542a71-e668-45c6-93f5-762cc422d504 by user 4de0100f-3636-4614-8761-8d83e4b05db5&lt;br/&gt; at org.dspace.sword.SWORDMETSIngester.ingest(SWORDMETSIngester.java:183)&lt;br/&gt; at org.dspace.sword.CollectionDepositor.doDeposit(CollectionDepositor.java:139)&lt;br/&gt; at org.dspace.sword.DepositManager.deposit(DepositManager.java:168)&lt;br/&gt; at org.dspace.sword.DSpaceSWORDServer.doDeposit(DSpaceSWORDServer.java:133)&lt;br/&gt; at org.purl.sword.server.DepositServlet.doPost(DepositServlet.java:313)&lt;br/&gt; at javax.servlet.http.HttpServlet.service(HttpServlet.java:650)&lt;br/&gt; at javax.servlet.http.HttpServlet.service(HttpServlet.java:731)&lt;br/&gt; at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:303)&lt;br/&gt; at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:208)&lt;br/&gt; at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:52)&lt;br/&gt; at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:241)&lt;br/&gt; at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:208)&lt;br/&gt; at org.apache.catalina.filters.RequestFilter.process(RequestFilter.java:205)&lt;br/&gt; at org.apache.catalina.filters.RemoteAddrFilter.doFilter(RemoteAddrFilter.java:71)&lt;br/&gt; at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:241)&lt;br/&gt; at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:208)&lt;br/&gt; at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:221)&lt;br/&gt; at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:122)&lt;br/&gt; at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:614)&lt;br/&gt; at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:169)&lt;br/&gt; at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:103)&lt;br/&gt; at org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:956)&lt;br/&gt; at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:116)&lt;br/&gt; at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:436)&lt;br/&gt; at org.apache.coyote.ajp.AjpProcessor.process(AjpProcessor.java:190)&lt;br/&gt; at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:625)&lt;br/&gt; at org.apache.tomcat.util.net.JIoEndpoint$SocketProcessor.run(JIoEndpoint.java:316)&lt;br/&gt; at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)&lt;br/&gt; at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)&lt;br/&gt; at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)&lt;br/&gt; at java.lang.Thread.run(Thread.java:748)&lt;/p&gt; &lt;p&gt;As far as I understood it, the ADD permission should be enough to submit into a collection, no matter, if it was protected by a submission workflow or not. If I add WRITE permission to the user for the collection, the submission works, though...&lt;/p&gt; &lt;p&gt;As far as I saw that, the behaviour is the same on DSpace 5, but I haven't double checked that.&lt;/p&gt; &lt;p&gt;Is this a bug or expected behavior as its probably not a good idea to accept submissions into an open collection via SWORD?&lt;/p&gt;</DESCRIPTION>
  <REPONAME>DSpace</REPONAME>
  <TIMEDIFFERENCEDAYS>1374</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Cambio la URL al sitio del blog de SEDICI El sitio del blog cambió el protocolo de HTTP a HTTPS.</MESSAGE>
    <SHA>ef1a4641e9043c00c9913b091c0c0b33dbf4a7b6</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>-#7113 Se agregó una validación de existencia de DOI externo Esto para evitar que se creen tuplas en la tabla 'doi' de items que estén esperando a registrarse (TO_BE_REGISTERED) en la RA cuando en realidad ya tienen un DOI asignado de antemano (y diferente al utilizado en el repositorio).</MESSAGE>
      <SHA>2789066001980d21dd3b51eb9671fa0b0f5f330f</SHA>
      <PATCHEDFILES>
        <FILE>dspace-api/src/main/java/org/dspace/identifier/DOIIdentifierProvider.java</FILE>
        <FILE>dspace-api/src/main/java/org/dspace/identifier/doi/DOIConsumer.java</FILE>
        <FILE>dspace-api/src/main/java/org/dspace/identifier/doi/service/DOIFilterService.java</FILE>
        <FILE>dspace/config/spring/api/identifier-service.xml</FILE>
        <FILE>dspace/modules/additions/src/main/java/ar/edu/unlp/sedici/dspace/identifier/doi/service/DOIFilterServiceImpl.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>-#7113 Validación de DOI externo al momento de registrar online Ya que si acá no se verifica se puede crear una tupla innecesaria en la tabla 'doi' de un ítem que tiene un DOI externo. El método registerOnline se utiliza principalmente cuando se utiliza el comando &quot;./dspace doi-organiser -r&quot; (o similares) desde la línea de comandos.</MESSAGE>
      <SHA>51a9e010a8137166a5b3dcee6dd102beeebc2d51</SHA>
      <PATCHEDFILES>
        <FILE>dspace-api/src/main/java/org/dspace/identifier/DOIIdentifierProvider.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>-#7113 Agrego una validacion antes de formatear un posible DOI y así corroborar si es un DOI Esto es para evitar hacer este formateo en todos los los metadatos sedici.identifier.other.</MESSAGE>
      <SHA>0cd73e6db0bfdbb8948bc00b514740cab5d9cc2c</SHA>
      <PATCHEDFILES>
        <FILE>dspace/modules/additions/src/main/java/ar/edu/unlp/sedici/dspace/identifier/doi/service/DOIFilterServiceImpl.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
