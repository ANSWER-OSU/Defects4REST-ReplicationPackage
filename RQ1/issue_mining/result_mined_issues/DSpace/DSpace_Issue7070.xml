<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>7070</ISSUENO>
  <ISSUEURL>https://github.com/DSpace/DSpace/issues/7070</ISSUEURL>
  <TITLE>[DS-3723] Exporting AIP packages problem</TITLE>
  <DESCRIPTION>&lt;i&gt;Imported from JIRA &lt;a href=&quot;https://jira.lyrasis.org/browse/DS-3723&quot;&gt;[DS-3723]&lt;/a&gt; created by paulo_graca&lt;/i&gt; &lt;p&gt;Hi,&lt;/p&gt; &lt;p&gt;We have an installed process that periodacally exports all items, collections and communities from DSpace using the AIP packager feature. But sometimes this proccess breaks unexpectally. For instance this exception:&lt;/p&gt; &lt;p&gt; &lt;/p&gt; &lt;p&gt;Exception: Error exporting METS for DSpace Object, type=ITEM, handle=XXXXX/XXX, dbID=XXXXX&lt;br/&gt; org.dspace.content.packager.PackageValidationException: Error exporting METS for DSpace Object, type=ITEM, handle=XXXXX/XXX, dbID=XXXXX, Reason: edu.harvard.hul.ois.mets.helper.MetsException: ID &quot;&lt;b&gt;bitstream_3&lt;/b&gt;&quot; already exists&lt;br/&gt; at org.dspace.content.packager.AbstractMETSDisseminator.disseminate(AbstractMETSDisseminator.java:280)&lt;br/&gt; at org.dspace.content.packager.DSpaceAIPDisseminator.disseminate(DSpaceAIPDisseminator.java:160)&lt;br/&gt; at org.dspace.content.packager.AbstractPackageDisseminator.disseminateAll(AbstractPackageDisseminator.java:103)&lt;br/&gt; at org.dspace.app.packager.Packager.disseminate(Packager.java:641)&lt;br/&gt; at org.dspace.app.packager.Packager.main(Packager.java:460)&lt;br/&gt; at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt; at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)&lt;br/&gt; at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;br/&gt; at java.lang.reflect.Method.invoke(Method.java:606)&lt;br/&gt; at org.dspace.app.launcher.ScriptLauncher.runOneCommand(ScriptLauncher.java:226)&lt;br/&gt; at org.dspace.app.launcher.ScriptLauncher.main(ScriptLauncher.java:78)&lt;br/&gt; Caused by: edu.harvard.hul.ois.mets.helper.MetsException: ID &quot;&lt;b&gt;bitstream_3&lt;/b&gt;&quot; already exists&lt;br/&gt; at edu.harvard.hul.ois.mets.helper.MetsValidator.validate(MetsValidator.java:68)&lt;br/&gt; at edu.harvard.hul.ois.mets.helper.MetsVElement.validate(MetsVElement.java:68)&lt;br/&gt; at edu.harvard.hul.ois.mets.helper.MetsValidator.validate(MetsValidator.java:78)&lt;br/&gt; at edu.harvard.hul.ois.mets.helper.MetsVElement.validate(MetsVElement.java:68)&lt;br/&gt; at edu.harvard.hul.ois.mets.helper.MetsValidator.validate(MetsValidator.java:78)&lt;br/&gt; at edu.harvard.hul.ois.mets.helper.MetsVElement.validate(MetsVElement.java:68)&lt;br/&gt; at edu.harvard.hul.ois.mets.helper.MetsValidator.validate(MetsValidator.java:78)&lt;br/&gt; at edu.harvard.hul.ois.mets.helper.MetsVElement.validate(MetsVElement.java:68)&lt;br/&gt; at org.dspace.content.packager.AbstractMETSDisseminator.writeZipPackage(AbstractMETSDisseminator.java:386)&lt;br/&gt; at org.dspace.content.packager.AbstractMETSDisseminator.disseminate(AbstractMETSDisseminator.java:259)&lt;/p&gt; &lt;p&gt; &lt;/p&gt; &lt;p&gt;We identify that there are two different sequences. One in bundle2bitstream (field: bitstream_order) table and the other in bitstream table (sequence_id). I don't know the reason for having two different sequences, perhaps a legacy issue. In this reported issue we had:&lt;/p&gt; &lt;div class='table-wrap'&gt; &lt;table class='confluenceTable'&gt;&lt;tbody&gt; &lt;tr&gt; &lt;td class='confluenceTd'&gt;&lt;b&gt;bundle2bitstream.bitstream_order&lt;/b&gt;&lt;/td&gt; &lt;td class='confluenceTd'&gt;&lt;b&gt;bitstream.sequence_id&lt;/b&gt;&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td class='confluenceTd'&gt;0&lt;/td&gt; &lt;td class='confluenceTd'&gt;1&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td class='confluenceTd'&gt;1&lt;/td&gt; &lt;td class='confluenceTd'&gt;2&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td class='confluenceTd'&gt;2&lt;/td&gt; &lt;td class='confluenceTd'&gt;&lt;b&gt;3&lt;/b&gt;&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td class='confluenceTd'&gt;3&lt;/td&gt; &lt;td class='confluenceTd'&gt;&lt;b&gt;3&lt;/b&gt;&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td class='confluenceTd'&gt;4&lt;/td&gt; &lt;td class='confluenceTd'&gt;4&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td class='confluenceTd'&gt;5&lt;/td&gt; &lt;td class='confluenceTd'&gt;5&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td class='confluenceTd'&gt;6&lt;/td&gt; &lt;td class='confluenceTd'&gt;6&lt;/td&gt; &lt;/tr&gt; &lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;p&gt; &lt;/p&gt; &lt;p&gt;Not sure why the &lt;b&gt;bitstream.sequence_id&lt;/b&gt; = 3 field repeats itself but I think it must be related with the ordering feature in the adminstrator backoffice interface.&lt;/p&gt; &lt;p&gt;The solution to this problem it's to manually correct the bitstream sequence. &lt;/p&gt; &lt;p&gt; &lt;/p&gt;</DESCRIPTION>
  <REPONAME>DSpace</REPONAME>
  <TIMEDIFFERENCEDAYS>1407</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>-#7126 Agrego licencia cc0 como opcion en el formulario de carga de administradores clave, valor: https://creativecommons.org/publicdomain/zero/1.0/deed.es , CC0 1.0 Universal (CC0 1.0) Dedicación de Dominio Público Sirve para cualquier tipo de item</MESSAGE>
    <SHA>94b2f23e7c92828645e5f03fd274789ce5238049</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>&quot;#7070&quot; Ahora el campo &quot;Palabras Clave&quot;, dc.subject, está disponible para los usuarios al momento de hacer autoarchivo El metadato se dejó visible para todos los usuarios que autoarchiven, no solo para el grupo bibliotecarios, y se dejó como opcional en caso que haya algún usuario que no sepa bien que ingresar</MESSAGE>
      <SHA>e39811609477cc0ddbc209bccfeba11d45b6ef0b</SHA>
      <PATCHEDFILES>
        <FILE>dspace/config/input-forms.xml</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Cambio en los metadatos del formulario de submission (#100) * -#7083 Ahora el metadato dc.publisher (editorial) es obligatorio para los libros Esto se hizo porque los libros ahora reciben doi automaticamente, y crossref requiere el publisher para el doi * -#7060 Ahora el campo &quot;Autor institucional&quot;, sedici.creator.corporate, es repetible en el formulario de submission Puede pasar que varias instituciones sean las creadoras de una obra * -#7126 Agrego licencia cc0 como opcion en el formulario de carga de administradores clave, valor: https://creativecommons.org/publicdomain/zero/1.0/deed.es , CC0 1.0 Universal (CC0 1.0) Dedicación de Dominio Público Sirve para cualquier tipo de item * &quot;#7070&quot; Ahora el campo &quot;Palabras Clave&quot;, dc.subject, está disponible para los usuarios al momento de hacer autoarchivo El metadato se dejó visible para todos los usuarios que autoarchiven, no solo para el grupo bibliotecarios, y se dejó como opcional en caso que haya algún usuario que no sepa bien que ingresar</MESSAGE>
      <SHA>6fa443f4e1787d5d54a703e98f48b75eae6a5cb6</SHA>
      <PATCHEDFILES>
        <FILE>dspace/config/input-forms.xml</FILE>
        <FILE>dspace/config/modules/sedici-dspace.cfg</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
