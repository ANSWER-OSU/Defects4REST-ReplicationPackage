<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>9806</ISSUENO>
  <ISSUEURL>https://github.com/DSpace/DSpace/issues/9806</ISSUEURL>
  <TITLE>Rewrite integration tests to use Builders for [DSpace]Object creation wherever possible</TITLE>
  <DESCRIPTION>WIP PR: #9807 There are still a handful of cases where integration tests are directly using services (ItemService, CollectionService, GroupService, etc) to create new objects for use in testing, instead of using the AbstractBuilders which maintain a list of created objects (and cache) for thorough destruction and cleanup at the end of tests. I am working on a pull request to rewrite these &quot;create object&quot; operations to use Builders, where possible. This mostly applies to `AbstractIntegrationTestWithDatabase` classes as that is where `AbstractBuilder.cleanupObjects()` is called, and could mean some tests should be refactored to extend `AbstractIntegrationTestWithDatabase`, or extend their own `destroy()` methods to do something similar. I am hoping this can help to resolve or mitigate cases where ITs fail depending on the order and re-run count, where some data is not cleaned up properly. I will try to get a WIP PR created as soon as possible for others to comment on, review, assist with, and avoid any duplicate work since we are currently looking at failing IT issues (as at 2024-09-06)</DESCRIPTION>
  <REPONAME>DSpace</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #9653 from AndrewAlesik/media-filter-new-functionality New parameter fromdate for media-filter script</MESSAGE>
    <SHA>be1ee8b264c92672a6c5c14c6b0723a5f08df7cf</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>#9806: Add new create methods to group builder Now supports admin groups, default read, workflow role</MESSAGE>
      <SHA>cdb167e55aac9916618dcfee7222105f4456dbd8</SHA>
      <PATCHEDFILES>
        <FILE>dspace-api/src/test/java/org/dspace/builder/GroupBuilder.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#9806: Use builders for coll, comm, group creation in BitstreamRestRepositoryIT</MESSAGE>
      <SHA>b13abac7539944358711a381548fbaedd9dcbd92</SHA>
      <PATCHEDFILES>
        <FILE>dspace-server-webapp/src/test/java/org/dspace/app/rest/BitstreamRestRepositoryIT.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#9806: Use builders for coll, comm, group creation in GroupRestRepositoryIT</MESSAGE>
      <SHA>9205773802a8d22820b074e18409e245c63f5609</SHA>
      <PATCHEDFILES>
        <FILE>dspace-server-webapp/src/test/java/org/dspace/app/rest/GroupRestRepositoryIT.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#9806: Tidy imports for GroupRestRepositoryIT</MESSAGE>
      <SHA>80328eaca5f2ad36e006d32ea06aa3b89e2ada92</SHA>
      <PATCHEDFILES>
        <FILE>dspace-server-webapp/src/test/java/org/dspace/app/rest/GroupRestRepositoryIT.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#9806: Use builders for group, comm, coll creation in PackagerIT</MESSAGE>
      <SHA>1f475aa731bbe42ad523f1056e6b56796ea8a2ee</SHA>
      <PATCHEDFILES>
        <FILE>dspace-api/src/test/java/org/dspace/app/packager/PackagerIT.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#9806: Use builders for group, comm, coll creation in StructBuilderIT</MESSAGE>
      <SHA>2ef69045d15ae49a4d447227e8080860eecc61cd</SHA>
      <PATCHEDFILES>
        <FILE>dspace-api/src/test/java/org/dspace/administer/StructBuilderIT.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#9806: Refactor WorkspaceItemBuilder to support specific item uuid</MESSAGE>
      <SHA>b99b1eec29c5a0b6e92998b072282b03cfedc080</SHA>
      <PATCHEDFILES>
        <FILE>dspace-api/src/test/java/org/dspace/builder/WorkspaceItemBuilder.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#9806: Use builders for comm, coll, group creation in SupervisionOrderServiceIT</MESSAGE>
      <SHA>6e9181e3f7cd502b345af7d5879fa25654176c25</SHA>
      <PATCHEDFILES>
        <FILE>dspace-api/src/test/java/org/dspace/supervision/SupervisionOrderServiceIT.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#9806: Use builders for comm, coll, group creation in CollectionGroupRestControllerIT</MESSAGE>
      <SHA>f4629d8351b70ca945ffeebdf928cebfb868c349</SHA>
      <PATCHEDFILES>
        <FILE>dspace-server-webapp/src/test/java/org/dspace/app/rest/CollectionGroupRestControllerIT.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#9806: Builders for comm, coll, group in CommunityAdminGroupRestControllerIT</MESSAGE>
      <SHA>2d9988f77c52537f46888f27e35dbc0360299835</SHA>
      <PATCHEDFILES>
        <FILE>dspace-server-webapp/src/test/java/org/dspace/app/rest/CommunityAdminGroupRestControllerIT.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#9806: Update object cleanup in GroupRestRepositoryIT</MESSAGE>
      <SHA>8cfb433c40ad01f348461a2c656665d1891de398</SHA>
      <PATCHEDFILES>
        <FILE>dspace-server-webapp/src/test/java/org/dspace/app/rest/GroupRestRepositoryIT.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#9806: Align provider reg in CreateMissingIdentifiersIT with other tests VersionedHandlerIdentifierProviderIT uses this registerProvider method which looks more reliable and doesn't do a refresh/reload of applicationContext after (which I suspected might have an odd interaction with VersioningWithRelationshipsIT and its createBean() calls?)</MESSAGE>
      <SHA>90536e443b7fedef0481a34326cafc58fb334396</SHA>
      <PATCHEDFILES>
        <FILE>dspace-api/src/test/java/org/dspace/ctask/general/CreateMissingIdentifiersIT.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#9806: Use builders for creation in VersioningWithRelationshipsIT I am a bit uncertain about the createBean() calls here, why do we not simply *get* the configured beans using the service manager instead, but will look at that in a separate change</MESSAGE>
      <SHA>3521ab6d3598e716cc9fe8e938e883b302006580</SHA>
      <PATCHEDFILES>
        <FILE>dspace-api/src/test/java/org/dspace/content/VersioningWithRelationshipsIT.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#9806: Set explicit id provider before VersioningWithRelationshipsIT</MESSAGE>
      <SHA>4af690065038d9cb401d0fa1fc5fbfe0fa1fe2c7</SHA>
      <PATCHEDFILES>
        <FILE>dspace-api/src/test/java/org/dspace/content/VersioningWithRelationshipsIT.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#9806: Move cleanup of handle provider to destroy in VersionedHandleIdentifierProviderIT</MESSAGE>
      <SHA>f6cabe648dfcda786afdf7d5411dc3d7ad85c405</SHA>
      <PATCHEDFILES>
        <FILE>dspace-api/src/test/java/org/dspace/content/VersioningWithRelationshipsIT.java</FILE>
        <FILE>dspace-api/src/test/java/org/dspace/identifier/VersionedHandleIdentifierProviderIT.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#9806: Add new create methods to group builder Now supports admin groups, default read, workflow role (cherry picked from commit cdb167e55aac9916618dcfee7222105f4456dbd8)</MESSAGE>
      <SHA>404039ade6796f9abfb5dbf420ab83f87057a033</SHA>
      <PATCHEDFILES>
        <FILE>dspace-api/src/test/java/org/dspace/builder/GroupBuilder.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#9806: Use builders for coll, comm, group creation in BitstreamRestRepositoryIT (cherry picked from commit b13abac7539944358711a381548fbaedd9dcbd92)</MESSAGE>
      <SHA>2ff2297b1fdd90b6f7c595c34b1167df3f91c036</SHA>
      <PATCHEDFILES>
        <FILE>dspace-server-webapp/src/test/java/org/dspace/app/rest/BitstreamRestRepositoryIT.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#9806: Use builders for coll, comm, group creation in GroupRestRepositoryIT (cherry picked from commit 9205773802a8d22820b074e18409e245c63f5609)</MESSAGE>
      <SHA>b9b135163f5f261065aa272b3af41b92ac17cea7</SHA>
      <PATCHEDFILES>
        <FILE>dspace-server-webapp/src/test/java/org/dspace/app/rest/GroupRestRepositoryIT.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#9806: Tidy imports for GroupRestRepositoryIT (cherry picked from commit 80328eaca5f2ad36e006d32ea06aa3b89e2ada92)</MESSAGE>
      <SHA>690dfa0809dc0c1829898c5f2a4d8bdbc2de0095</SHA>
      <PATCHEDFILES>
        <FILE>dspace-server-webapp/src/test/java/org/dspace/app/rest/GroupRestRepositoryIT.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
