<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>8514</ISSUENO>
  <ISSUEURL>https://github.com/DSpace/DSpace/issues/8514</ISSUEURL>
  <TITLE>ImageMagick PDF thumbnails are blurry</TITLE>
  <DESCRIPTION>**Describe the bug** A side effect of many image resizing processes is that the resulting image is less sharp than the original. This is visible in PDF thumbnails generated by ImageMagick. DSpace has been able to use ImageMagick since 5.x, so this currently affects DSpace 5.x, 6.x, and 7.x. **To Reproduce** Steps to reproduce the behavior: 1. Have an item with a PDF bitstream in the `ORIGINAL` bundle 2. Enable ImageMagick [media filter](https://wiki.lyrasis.org/display/DSDOC6x/Mediafilters+for+Transforming+DSpace+Content) for PDFs 3. Generate a thumbnail using `dspace filter-media ...` 4. Resulting thumbnail is slightly blurry, dull, and less crisp than the the original item **Expected behavior** Thumbnail should look nicer. **Related work** This likely applies to the _normal_ image thumbnailer as well if ImageMagick is configured there too. I don't use it so I haven't noticed.</DESCRIPTION>
  <REPONAME>DSpace</REPONAME>
  <TIMEDIFFERENCEDAYS>21</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #8306 from kshepherd/docker-test_remote_debug Dockerfile.test and docker-compose: expose port 8000, set JDWP java opts</MESSAGE>
    <SHA>63b1ff825b3f2afc3c706d7101b213bbf06bfec3</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>dspace-api: apply unsharp mask to ImageMagick PDF operations Applying an unsharp mask to the ImageMagick PDF thumbnail process produces a slightly better image in every case I have tested. The unsharp option takes a radius, sigma, amount, and threshold, but we can use the defaults to good effect. If we use a radius of 0 then ImageMagick will select an appropriate value automatically. We only override the sigma with 0.5 (default 1.0). Fixes #8514 See: https://imagemagick.org/script/command-line-options.php#unsharp</MESSAGE>
      <SHA>9fd99d08ce0dd4d3c2d74e843c8deabaa1017e72</SHA>
      <PATCHEDFILES>
        <FILE>dspace-api/src/main/java/org/dspace/app/mediafilter/ImageMagickThumbnailFilter.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>dspace-api: allow overriding ImageMagick density Allow users to override ImageMagick's default density of 72 DPI for creating PDF thumbnails. In this case a density of 144 will perform a &quot;2x&quot; supersample, which greatly increases the quality of the res- ulting images at the expense of slightly longer execution time and higher memory usage. See: https://imagemagick.org/script/command-line-options.php#density See: https://stackoverflow.com/questions/49828544/how-to-make-thumbnails-using-imagickresizeimage-appear-sharper-php Fixes: https://github.com/DSpace/DSpace/issues/8514</MESSAGE>
      <SHA>bf0038182ff43bc6b9ebaf76e6b4c7a790455a12</SHA>
      <PATCHEDFILES>
        <FILE>dspace-api/src/main/java/org/dspace/app/mediafilter/ImageMagickThumbnailFilter.java</FILE>
        <FILE>dspace/config/dspace.cfg</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>dspace-api: allow overriding ImageMagick density Allow users to override ImageMagick's default density of 72 DPI for creating PDF thumbnails. In this case a density of 144 will perform a &quot;2x&quot; supersample, which greatly increases the quality of the res- ulting images at the expense of slightly longer execution time and higher memory usage. 6.x port of https://github.com/DSpace/DSpace/pull/8553. See: https://imagemagick.org/script/command-line-options.php#density See: https://stackoverflow.com/questions/49828544/how-to-make-thumbnails-using-imagickresizeimage-appear-sharper-php Fixes: https://github.com/DSpace/DSpace/issues/8514</MESSAGE>
      <SHA>e439ca027815c2c7069ca137b866f6382ba563a5</SHA>
      <PATCHEDFILES>
        <FILE>dspace-api/src/main/java/org/dspace/app/mediafilter/ImageMagickThumbnailFilter.java</FILE>
        <FILE>dspace/config/dspace.cfg</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>dspace-api: allow overriding ImageMagick density Allow users to override ImageMagick's default density of 72 DPI for creating PDF thumbnails. In this case a density of 144 will perform a &quot;2x&quot; supersample, which greatly increases the quality of the res- ulting images at the expense of slightly longer execution time and higher memory usage. 6.x port of https://github.com/DSpace/DSpace/pull/8553. See: https://imagemagick.org/script/command-line-options.php#density See: https://stackoverflow.com/questions/49828544/how-to-make-thumbnails-using-imagickresizeimage-appear-sharper-php Fixes: https://github.com/DSpace/DSpace/issues/8514</MESSAGE>
      <SHA>58468fd4e543398961b00459f5f6b4b69286895a</SHA>
      <PATCHEDFILES>
        <FILE>dspace-api/src/main/java/org/dspace/app/mediafilter/ImageMagickThumbnailFilter.java</FILE>
        <FILE>dspace/config/dspace.cfg</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
