<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>8055</ISSUENO>
  <ISSUEURL>https://github.com/DSpace/DSpace/issues/8055</ISSUEURL>
  <TITLE>DSpace 6: Item move operation can accidentally delete items</TITLE>
  <DESCRIPTION>**Describe the bug** When an item is moved from one collection to another, the back end does not validate the collections that the item is being moved from and to. Normally, this is not an issue because the admin UI will filter the appropriate collections for the user to choose from. However, there is an easily reproducible scenario where this results in the accidental deletion of the item and all of its bitstreams. **To Reproduce** Steps to reproduce the behavior: 1. Find an item, X, **belonging to a single collection**, Collection A, and move it through the Edit Item admin page to Collection B. 2. After the move completes successfully and you are taken back to the Edit Item page, refresh the page and agree to resubmit the form. (In practice, users may be working quickly and not notice what the form submission notice says; the consequences should not be as dire as an item being accidentally deleted.) 3. After the move request is processed the second time, the item becomes orphaned and all bitstreams for the item are deleted. This seems to happen because the item already belongs to Collection B after the first move, so the second time we attempt to move it from Collection A to Collection B, adding B to its collections has no effect. However, the logic in [CollectionServiceImpl](https://github.com/DSpace/DSpace/blob/97d0a1f12855b3451c77435591368c4c224b5138/dspace-api/src/main/java/org/dspace/content/CollectionServiceImpl.java#L646) erroneously determines that the item has now been orphaned, since it is only part of one collection when removeItem is called. **Expected behavior** Moving an item should be an idempotent operation. If the item already belongs to the collection it is being moved to, it should not become orphaned as a result of a move operation.</DESCRIPTION>
  <REPONAME>DSpace</REPONAME>
  <TIMEDIFFERENCEDAYS>70</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #8153 from the-library-code/DS-8152 Remove unneccessary second Context in RDFConsumer</MESSAGE>
    <SHA>579d926e95bfa3d58a95c64c42b16bb8d9f856bb</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Adds check for whether source and target collections are the same when moving an item. (#8055)</MESSAGE>
      <SHA>8ddb492901d8202c549c6da8ce0ca7a415c569e6</SHA>
      <PATCHEDFILES>
        <FILE>dspace-api/src/main/java/org/dspace/content/ItemServiceImpl.java</FILE>
        <FILE>dspace-api/src/test/java/org/dspace/content/ItemTest.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Adds check for whether source and target collection are the same, for DSpace 6. (#8055)</MESSAGE>
      <SHA>ee4f21918379eff5acb2f4ba704cdbe94d5cde24</SHA>
      <PATCHEDFILES>
        <FILE>dspace-api/src/main/java/org/dspace/content/ItemServiceImpl.java</FILE>
        <FILE>dspace-api/src/test/java/org/dspace/content/ItemTest.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Adds check for whether source and target collections are the same when moving an item. (#8055)</MESSAGE>
      <SHA>8c44a95c7b038c0422447cd2c713b0cfd299c9dd</SHA>
      <PATCHEDFILES>
        <FILE>dspace-api/src/main/java/org/dspace/content/ItemServiceImpl.java</FILE>
        <FILE>dspace-api/src/test/java/org/dspace/content/ItemTest.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
