<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>7986</ISSUENO>
  <ISSUEURL>https://github.com/DSpace/DSpace/issues/7986</ISSUEURL>
  <TITLE>Use a connection pool for communication with Solr</TITLE>
  <DESCRIPTION>**Is your feature request related to a problem? Please describe.** When we are busy, I have noticed a great many connections between DSpace and Solr, the vast majority of which are in CLOSE_WAIT or some other connection-teardown state. Making and breaking connections has a CPU cost, and large numbers of concurrent connections have a memory cost. **Describe the solution you'd like** We could use Solr more efficiently by keeping a pool of open connections. SolrJ uses an Apache HttpComponents HTTP client instance for connecting to the service, and we can allocate from the pool and pass a pooled connection to the client builder.</DESCRIPTION>
  <REPONAME>DSpace</REPONAME>
  <TIMEDIFFERENCEDAYS>95</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Initialize correctly. More generous pool defaults.</MESSAGE>
    <SHA>de9d1a8cd8de86b55f0276825ba0faf51f1f7c07</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Make connection maximum lifetime configurable. #7986</MESSAGE>
      <SHA>23b0ae1c4d5f168b8ef11feb1e126164a64f2dc8</SHA>
      <PATCHEDFILES>
        <FILE>dspace-api/src/main/java/org/dspace/service/impl/HttpConnectionPoolService.java</FILE>
        <FILE>dspace/config/dspace.cfg</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Add unit test. #7986</MESSAGE>
      <SHA>c462415a64ffaba28bc7a5e755a8e04a7257bb91</SHA>
      <PATCHEDFILES>
        <FILE>dspace-api/pom.xml</FILE>
        <FILE>dspace-api/src/main/java/org/dspace/service/impl/HttpConnectionPoolService.java</FILE>
        <FILE>dspace-api/src/test/java/org/dspace/service/impl/HttpConnectionPoolServiceTest.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Clarify the need to manage dependencies for mockserver. #7986</MESSAGE>
      <SHA>fc5d3bcd17b6f8c4f823517880bb3c5d6a31ffef</SHA>
      <PATCHEDFILES>
        <FILE>dspace-api/pom.xml</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Autowire with 'id' not &lt;qualifier&gt;: @Named doesn't find qualifiers. #7986</MESSAGE>
      <SHA>171245a144f247ef56f3b391de925bdf34e78754</SHA>
      <PATCHEDFILES>
        <FILE>dspace-api/src/main/java/org/dspace/authority/AuthoritySolrServiceImpl.java</FILE>
        <FILE>dspace-api/src/main/java/org/dspace/discovery/SolrSearchCore.java</FILE>
        <FILE>dspace-api/src/main/java/org/dspace/service/impl/HttpConnectionPoolService.java</FILE>
        <FILE>dspace-api/src/main/java/org/dspace/statistics/SolrStatisticsCore.java</FILE>
        <FILE>dspace-api/src/test/java/org/dspace/service/impl/HttpConnectionPoolServiceTest.java</FILE>
        <FILE>dspace-oai/src/main/java/org/dspace/xoai/services/impl/solr/DSpaceSolrServerResolver.java</FILE>
        <FILE>dspace/config/spring/api/core-services.xml</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Correct the names of configuration properties set by tests. #7986</MESSAGE>
      <SHA>8358e300c427aae0b6c3086040f5be2ce799ad94</SHA>
      <PATCHEDFILES>
        <FILE>dspace-api/src/test/java/org/dspace/service/impl/HttpConnectionPoolServiceTest.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
