<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>1538</ISSUENO>
  <ISSUEURL>https://github.com/harness/harness/issues/1538</ISSUEURL>
  <TITLE>Delegated secrets management</TITLE>
  <DESCRIPTION>First off we're willing to do the work proposed, I wanted to share the approach and general idea first. ## Current state of affairs Drone allows for encryption of secrets but it works locally and so the secrets yaml file needs to be shared amongst &quot;blessed&quot; team members who gate changes to .drone.yml. ## Expected behavior Decouple and delegate managing secrets yaml content from the ability to encrypt drone.yml. Every maintainer should be able to encrypt the .drone.yml file. But the ability to add or change secrets should still be gated through a set of &quot;blessed&quot; individuals. ## Proposed approach To achieve this we can introduce a secure secrets store like hashicorps vault, dockers notary, ... The backend might actually be pluggable, for a first pass I think hashicorps vault is most appropriate. The drone-cli will submit the .drone.yml file to the drone API server and gets the encryption string back. This then gets stored in .drone.sec. This can be a flag that allows people the choice but by default we stick to the current behavior of needing a local file. The drone-api server needs to get a new endpoint to accommodate this new workflow. There will also be a config necessary so that the drone api server knows how to connect to the secure store backend. The secrets are now provided through vault, so the people who can write or even read that are highly privileged accounts but this is decoupled from the build system.</DESCRIPTION>
  <REPONAME>harness</REPONAME>
  <TIMEDIFFERENCEDAYS>358</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #1545 from jeffastorey/active-repos #1533 first cut to show only active repos initially</MESSAGE>
    <SHA>51607488cd9e503a6afe92b708a2395f7bbfb3df</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Merge pull request #1557 from bradrydzewski/master centralized secrets #1538</MESSAGE>
      <SHA>7a3c9acd578efeb0a3a12339b6c1c696c680940e</SHA>
      <PATCHEDFILES>
        <FILE>api/secret.go</FILE>
        <FILE>api/sign.go</FILE>
        <FILE>model/registry.go</FILE>
        <FILE>model/secret.go</FILE>
        <FILE>router/router.go</FILE>
        <FILE>store/datastore/ddl/mysql/3.sql</FILE>
        <FILE>store/datastore/ddl/postgres/3.sql</FILE>
        <FILE>store/datastore/ddl/sqlite3/3.sql</FILE>
        <FILE>store/datastore/secret.go</FILE>
        <FILE>store/datastore/secret_test.go</FILE>
        <FILE>store/store.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
