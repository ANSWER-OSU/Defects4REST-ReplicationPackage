<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>2541</ISSUENO>
  <ISSUEURL>https://github.com/harness/harness/issues/2541</ISSUEURL>
  <TITLE>Handle expired vault token generated with Kube auth</TITLE>
  <DESCRIPTION>if the vault token is generated using kubernetes auth it expires after 32 days. I propose we try to generate a new kubernetes token if the vault token refresh fails. Something like this: ```diff func (v *vault) renewLoop() { for { select { case &lt;-time.After(v.renew): incr := int(v.ttl / time.Second) logrus.Debugf(&quot;vault: refreshing token: increment %v&quot;, v.ttl) _, err := v.client.Auth().Token().RenewSelf(incr) + if err != nil &amp;&amp; v.auth == &quot;kubernetes&quot; { + err = v.initKubernetes() + } if err != nil { logrus.Errorf(&quot;vault: refreshing token failed: %s&quot;, err) } else { logrus.Debugf(&quot;vault: refreshing token succeeded&quot;) } case &lt;-v.done: return } } } ``` cc @praxist</DESCRIPTION>
  <REPONAME>harness</REPONAME>
  <TIMEDIFFERENCEDAYS>363</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>bump static version</MESSAGE>
    <SHA>768ed784bd74b0e0c2d8d49c4c8b6dca99b25e96</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fix for #2541</MESSAGE>
      <SHA>6d144de7355facbee613dd99afc5c4657b580808</SHA>
      <PATCHEDFILES>
        <FILE>plugins/secrets/vault/vault.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
