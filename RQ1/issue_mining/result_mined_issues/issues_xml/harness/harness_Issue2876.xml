<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>2876</ISSUENO>
  <ISSUEURL>https://github.com/harness/harness/issues/2876</ISSUEURL>
  <TITLE>[BUG] Cron jobs seems not working with DRONE_GITEA_SKIP_VERIFY variable and SelfSigned Certificates</TITLE>
  <DESCRIPTION>First I have to be grateful, for this great project to everybody who are working on it. About the bug, as described in the community (https://discourse.drone.io/t/cron-jobs-seems-not-working-with-drone-gitea-skip-verify-variable-and-selfsigned-certificates/6213) I've detected errors when cron needs renew the oauth token on a Gitea with self-signed certificate, but it doesn't take the DRONE_GITEA_SKIP_VERIFY variable. These are the errors. ```json {&quot;branch&quot;:&quot;master&quot;,&quot;cron&quot;:3,&quot;error&quot;:&quot;Post https://git.myplatform.org/login/oauth/access_token: x509: certificate is valid for 413075044928d7b2d8864b1ada61ba7c.e5c739ab2bc51b1f4a195056046c6168.traefik.default, not git.myplatform.org&quot;,&quot;level&quot;:&quot;warning&quot;,&quot;msg&quot;:&quot;cron: cannot find commit&quot;,&quot;repo&quot;:&quot;myclient_probes/probe_firefox-google&quot;,&quot;time&quot;:&quot;2019-11-08T08:06:15Z&quot;} {&quot;branch&quot;:&quot;master&quot;,&quot;cron&quot;:3,&quot;error&quot;:&quot;Post https://git.myplatform.org/login/oauth/access_token: x509: certificate is valid for 413075044928d7b2d8864b1ada61ba7c.e5c739ab2bc51b1f4a195056046c6168.traefik.default, not git.myplatform.org&quot;,&quot;level&quot;:&quot;warning&quot;,&quot;msg&quot;:&quot;cron: cannot find commit&quot;,&quot;repo&quot;:&quot;myclient_probes/probe_firefox-google&quot;,&quot;time&quot;:&quot;2019-11-08T08:09:15Z&quot;} ``` Login to the IU is working OK, but token renew fails and cron can not authenticate to the Gitea repos. I've reviewed the code and I will send a PR that has fixed the problem in two different platforms with the same behaviour. Lots of thanks</DESCRIPTION>
  <REPONAME>harness</REPONAME>
  <TIMEDIFFERENCEDAYS>4</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>bump to 1.6.2 [CI SKIP]</MESSAGE>
    <SHA>e6ac2a53d4bc41d745fe708db30ec50dcd05a471</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>add http.Client with skipverify option to oauth renew token method, fix #2876</MESSAGE>
      <SHA>8830e3dfe246acc7a34859cd74609399e6a4f90c</SHA>
      <PATCHEDFILES>
        <FILE>cmd/drone-server/inject_login.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>add http.Client with skipverify option to oauth renew token method, fix #2876</MESSAGE>
      <SHA>af34ac8b1807459bd7d5d24c417ed5e957bd6511</SHA>
      <PATCHEDFILES>
        <FILE>cmd/drone-server/inject_login.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Merge pull request #2877 from toni-moreno/fix_oauth_token_renew_with_selfsigned_certs Add http.Client with skipverify option to oauth renew token method. fix #2876</MESSAGE>
      <SHA>12ca26237359c2dc156a5b9f589d00bb97a566e0</SHA>
      <PATCHEDFILES>
        <FILE>cmd/drone-server/inject_login.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>feat: [CDE-332]: added an event and method for auto-stopping (#2876) * feat: [CDE-332]: added an event and method for auto-stopping</MESSAGE>
      <SHA>f3016357d36a9c7f9a59e1ff71f39f7b3b134f21</SHA>
      <PATCHEDFILES>
        <FILE>app/api/controller/gitspace/events.go</FILE>
        <FILE>app/services/gitspace/action.go</FILE>
        <FILE>types/enum/gitspace_event_type.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
