<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>819</ISSUENO>
  <ISSUEURL>https://github.com/harness/harness/issues/819</ISSUEURL>
  <TITLE>Handling PR and commit webhooks for the same Commit</TITLE>
  <DESCRIPTION>I work in a team where we all have access to the private github repo, and develop directly against it (as opposed to forking it to our personal GitHub accounts). All our changes are submitted as Pull Requests though (we push the feature branch to the shared private repo on GitHub, and then create a PR from there). The issue is that because the branch and the PR are part of the repository linked to drone, github will send a webhook for both the commit on the branch and the PR. This then continues for each subsequent change to that branch after a PR has been created. Drone seems to just respond to 1 and ignore the other (I'm guessing it just responds to the first one it receives 'cause sometimes it is the PR one and sometimes it's the commit one). This results in the following issues: - If it handles the PR one and ignores the commit one, the commit message is the PR title and not the actual commit message. - If it handles the PR one after the initial PR was created, it then results in a duplicate block for the same PR under the Pull Requests section - If it handles the commit one, it doesn't update the PR block at the bottom. For example, if I submit a PR and the build fails, and I then push a fix which builds successfully, if drone runs the commit webhook (rather than the PR one), the PR block will still reflect a failure even though the commit from that PR has built successfully. I realise that this may be slightly unusual workflow (especially compared to open source repositories), but I'm assuming it should still handle it. Possibly, if a PR webhook is received after the commit webhook for the same SHA, it should update the record in the commits table (updating the commit_pr column, and probably replacing the value of the commit_message column to rather be the PR title too).</DESCRIPTION>
  <REPONAME>harness</REPONAME>
  <TIMEDIFFERENCEDAYS>215</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>[GIT] Fix `GetBranch` To Support Full Branch Reference (#820)</MESSAGE>
    <SHA>e162112a297fab11e154bfcc1bc6adff60a26617</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>feat: [CODE-1132]: dryrun requires view permission (#819)</MESSAGE>
      <SHA>3d97474dcf27648432aad1332cecf394f50e6971</SHA>
      <PATCHEDFILES>
        <FILE>app/api/controller/pullreq/merge.go</FILE>
        <FILE>app/api/controller/repo/commit.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
