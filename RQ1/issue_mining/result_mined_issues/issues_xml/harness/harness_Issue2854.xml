<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>2854</ISSUENO>
  <ISSUEURL>https://github.com/harness/harness/issues/2854</ISSUEURL>
  <TITLE>Cancelling a buid doesnâ€™t stop the containers</TITLE>
  <DESCRIPTION>When I cancel a build on the UI, the build it marked as canceled but containers are still running on the containers created by agents. There's a DELETE request send and it gives this response : ``` { &quot;JSON&quot;: { &quot;action&quot;: &quot;&quot;, &quot;after&quot;: &quot;806aca4d7ded658a087e8be0b053b6bf19c3c726&quot;, &quot;author_avatar&quot;: &quot;https://secure.gravatar.com/avatar/0ab45d63adae19f314668733071e1674?s=80&amp;d=identicon&quot;, &quot;author_email&quot;: &quot;&quot;, &quot;author_login&quot;: &quot;User.Name&quot;, &quot;author_name&quot;: &quot;User.Name&quot;, &quot;before&quot;: &quot;&quot;, &quot;created&quot;: 1569875380, &quot;event&quot;: &quot;push&quot;, &quot;finished&quot;: 1569876638, &quot;id&quot;: 530, &quot;link&quot;: &quot;https://git.mydomain.com/project/project/commit/806aca4d7ded658a087e8be0b053b6bf19c3c726&quot;, &quot;message&quot;: &quot;[MIGRATION] Better: Update Attachment with deprecated attachable_type 'MobileChat::Message' RD-11323\n&quot;, &quot;number&quot;: 110, &quot;ref&quot;: &quot;refs/heads/rd-11323-migrate-attachment-for-mobile-chat&quot;, &quot;repo_id&quot;: 2133, &quot;sender&quot;: &quot;User.Name&quot;, &quot;source&quot;: &quot;rd-11323-migrate-attachment-for-mobile-chat&quot;, &quot;source_repo&quot;: &quot;&quot;, &quot;stages&quot;: [ { &quot;arch&quot;: &quot;amd64&quot;, &quot;build_id&quot;: 530, &quot;created&quot;: 1569875380, &quot;errignore&quot;: false, &quot;exit_code&quot;: 0, &quot;id&quot;: 512, &quot;kind&quot;: &quot;pipeline&quot;, &quot;machine&quot;: &quot;end01-t01-utl04&quot;, &quot;name&quot;: &quot;default&quot;, &quot;number&quot;: 1, &quot;on_failure&quot;: false, &quot;on_success&quot;: true, &quot;os&quot;: &quot;linux&quot;, &quot;repo_id&quot;: 2133, &quot;started&quot;: 1569875730, &quot;status&quot;: &quot;killed&quot;, &quot;steps&quot;: [ { &quot;exit_code&quot;: 130, &quot;id&quot;: 5139, &quot;name&quot;: &quot;mongo&quot;, &quot;number&quot;: 1, &quot;started&quot;: 1569875730, &quot;status&quot;: &quot;killed&quot;, &quot;step_id&quot;: 512, &quot;stopped&quot;: 1569876638, &quot;version&quot;: 3 }, { &quot;exit_code&quot;: 130, &quot;id&quot;: 5140, &quot;name&quot;: &quot;redis&quot;, &quot;number&quot;: 2, &quot;started&quot;: 1569875730, &quot;status&quot;: &quot;killed&quot;, &quot;step_id&quot;: 512, &quot;stopped&quot;: 1569876638, &quot;version&quot;: 3 }, { &quot;exit_code&quot;: 130, &quot;id&quot;: 5141, &quot;name&quot;: &quot;elasticsearch&quot;, &quot;number&quot;: 3, &quot;started&quot;: 1569875730, &quot;status&quot;: &quot;killed&quot;, &quot;step_id&quot;: 512, &quot;stopped&quot;: 1569876638, &quot;version&quot;: 3 }, { &quot;exit_code&quot;: 130, &quot;id&quot;: 5142, &quot;name&quot;: &quot;memcache&quot;, &quot;number&quot;: 4, &quot;started&quot;: 1569875730, &quot;status&quot;: &quot;killed&quot;, &quot;step_id&quot;: 512, &quot;stopped&quot;: 1569876638, &quot;version&quot;: 3 }, { &quot;exit_code&quot;: 0, &quot;id&quot;: 5143, &quot;name&quot;: &quot;git&quot;, &quot;number&quot;: 5, &quot;started&quot;: 1569875730, &quot;status&quot;: &quot;success&quot;, &quot;step_id&quot;: 512, &quot;stopped&quot;: 1569875750, &quot;version&quot;: 3 }, { &quot;exit_code&quot;: 0, &quot;id&quot;: 5144, &quot;name&quot;: &quot;restore-cache&quot;, &quot;number&quot;: 6, &quot;started&quot;: 1569875750, &quot;status&quot;: &quot;success&quot;, &quot;step_id&quot;: 512, &quot;stopped&quot;: 1569875843, &quot;version&quot;: 3 }, { &quot;exit_code&quot;: 0, &quot;id&quot;: 5145, &quot;name&quot;: &quot;prepare&quot;, &quot;number&quot;: 7, &quot;started&quot;: 1569875843, &quot;status&quot;: &quot;success&quot;, &quot;step_id&quot;: 512, &quot;stopped&quot;: 1569875862, &quot;version&quot;: 3 }, { &quot;exit_code&quot;: 130, &quot;id&quot;: 5146, &quot;name&quot;: &quot;rspec&quot;, &quot;number&quot;: 8, &quot;started&quot;: 1569875862, &quot;status&quot;: &quot;killed&quot;, &quot;step_id&quot;: 512, &quot;stopped&quot;: 1569876638, &quot;version&quot;: 3 }, { &quot;exit_code&quot;: 130, &quot;id&quot;: 5147, &quot;name&quot;: &quot;rspec-features&quot;, &quot;number&quot;: 9, &quot;started&quot;: 1569875862, &quot;status&quot;: &quot;killed&quot;, &quot;step_id&quot;: 512, &quot;stopped&quot;: 1569876638, &quot;version&quot;: 3 }, { &quot;exit_code&quot;: 0, &quot;id&quot;: 5148, &quot;name&quot;: &quot;jasmine&quot;, &quot;number&quot;: 10, &quot;started&quot;: 1569875862, &quot;status&quot;: &quot;success&quot;, &quot;step_id&quot;: 512, &quot;stopped&quot;: 1569876020, &quot;version&quot;: 3 }, { &quot;exit_code&quot;: 0, &quot;id&quot;: 5149, &quot;name&quot;: &quot;assets-precompilation&quot;, &quot;number&quot;: 11, &quot;started&quot;: 1569875862, &quot;status&quot;: &quot;success&quot;, &quot;step_id&quot;: 512, &quot;stopped&quot;: 1569876167, &quot;version&quot;: 3 }, { &quot;exit_code&quot;: 0, &quot;id&quot;: 5150, &quot;name&quot;: &quot;rubocop&quot;, &quot;number&quot;: 12, &quot;started&quot;: 1569875862, &quot;status&quot;: &quot;success&quot;, &quot;step_id&quot;: 512, &quot;stopped&quot;: 1569875892, &quot;version&quot;: 3 }, { &quot;exit_code&quot;: 130, &quot;id&quot;: 5151, &quot;name&quot;: &quot;code-coverage&quot;, &quot;number&quot;: 13, &quot;started&quot;: 1569876638, &quot;status&quot;: &quot;skipped&quot;, &quot;step_id&quot;: 512, &quot;stopped&quot;: 1569876638, &quot;version&quot;: 2 }, { &quot;exit_code&quot;: 130, &quot;id&quot;: 5152, &quot;name&quot;: &quot;rebuild-cache&quot;, &quot;number&quot;: 14, &quot;started&quot;: 1569876638, &quot;status&quot;: &quot;skipped&quot;, &quot;step_id&quot;: 512, &quot;stopped&quot;: 1569876638, &quot;version&quot;: 2 } ], &quot;stopped&quot;: 1569876638, &quot;type&quot;: &quot;docker&quot;, &quot;updated&quot;: 1569875730, &quot;version&quot;: 4 } ], &quot;started&quot;: 1569875730, &quot;status&quot;: &quot;killed&quot;, &quot;target&quot;: &quot;rd-11323-migrate-attachment-for-mobile-chat&quot;, &quot;timestamp&quot;: 0, &quot;trigger&quot;: &quot;my.name&quot;, &quot;updated&quot;: 1569875730, &quot;version&quot;: 3 }, &quot;Response payload&quot;: { &quot;EDITOR_CONFIG&quot;: { &quot;mode&quot;: &quot;application/json&quot;, &quot;text&quot;: &quot;{\&quot;id\&quot;:530,\&quot;repo_id\&quot;:2133,\&quot;trigger\&quot;:\&quot;my.namel\&quot;,\&quot;number\&quot;:110,\&quot;status\&quot;:\&quot;killed\&quot;,\&quot;event\&quot;:\&quot;push\&quot;,\&quot;action\&quot;:\&quot;\&quot;,\&quot;link\&quot;:\&quot;https://git.mydomain.com/project/project/commit/806aca4d7ded658a087e8be0b053b6bf19c3c726\&quot;,\&quot;timestamp\&quot;:0,\&quot;message\&quot;:\&quot;[MIGRATION] Better: Update Attachment with deprecated attachable_type 'MobileChat::Message' RD-11323\\n\&quot;,\&quot;before\&quot;:\&quot;\&quot;,\&quot;after\&quot;:\&quot;806aca4d7ded658a087e8be0b053b6bf19c3c726\&quot;,\&quot;ref\&quot;:\&quot;refs/heads/rd-11323-migrate-attachment-for-mobile-chat\&quot;,\&quot;source_repo\&quot;:\&quot;\&quot;,\&quot;source\&quot;:\&quot;rd-11323-migrate-attachment-for-mobile-chat\&quot;,\&quot;target\&quot;:\&quot;rd-11323-migrate-attachment-for-mobile-chat\&quot;,\&quot;author_login\&quot;:\&quot;User.Name\&quot;,\&quot;author_name\&quot;:\&quot;User.Name\&quot;,\&quot;author_email\&quot;:\&quot;\&quot;,\&quot;author_avatar\&quot;:\&quot;https://secure.gravatar.com/avatar/0ab45d63adae19f314668733071e1674?s=80\\u0026d=identicon\&quot;,\&quot;sender\&quot;:\&quot;User.Name\&quot;,\&quot;started\&quot;:1569875730,\&quot;finished\&quot;:1569876638,\&quot;created\&quot;:1569875380,\&quot;updated\&quot;:1569875730,\&quot;version\&quot;:3,\&quot;stages\&quot;:[{\&quot;id\&quot;:512,\&quot;repo_id\&quot;:2133,\&quot;build_id\&quot;:530,\&quot;number\&quot;:1,\&quot;name\&quot;:\&quot;default\&quot;,\&quot;kind\&quot;:\&quot;pipeline\&quot;,\&quot;type\&quot;:\&quot;docker\&quot;,\&quot;status\&quot;:\&quot;killed\&quot;,\&quot;errignore\&quot;:false,\&quot;exit_code\&quot;:0,\&quot;machine\&quot;:\&quot;end01-t01-utl04\&quot;,\&quot;os\&quot;:\&quot;linux\&quot;,\&quot;arch\&quot;:\&quot;amd64\&quot;,\&quot;started\&quot;:1569875730,\&quot;stopped\&quot;:1569876638,\&quot;created\&quot;:1569875380,\&quot;updated\&quot;:1569875730,\&quot;version\&quot;:4,\&quot;on_success\&quot;:true,\&quot;on_failure\&quot;:false,\&quot;steps\&quot;:[{\&quot;id\&quot;:5139,\&quot;step_id\&quot;:512,\&quot;number\&quot;:1,\&quot;name\&quot;:\&quot;mongo\&quot;,\&quot;status\&quot;:\&quot;killed\&quot;,\&quot;exit_code\&quot;:130,\&quot;started\&quot;:1569875730,\&quot;stopped\&quot;:1569876638,\&quot;version\&quot;:3},{\&quot;id\&quot;:5140,\&quot;step_id\&quot;:512,\&quot;number\&quot;:2,\&quot;name\&quot;:\&quot;redis\&quot;,\&quot;status\&quot;:\&quot;killed\&quot;,\&quot;exit_code\&quot;:130,\&quot;started\&quot;:1569875730,\&quot;stopped\&quot;:1569876638,\&quot;version\&quot;:3},{\&quot;id\&quot;:5141,\&quot;step_id\&quot;:512,\&quot;number\&quot;:3,\&quot;name\&quot;:\&quot;elasticsearch\&quot;,\&quot;status\&quot;:\&quot;killed\&quot;,\&quot;exit_code\&quot;:130,\&quot;started\&quot;:1569875730,\&quot;stopped\&quot;:1569876638,\&quot;version\&quot;:3},{\&quot;id\&quot;:5142,\&quot;step_id\&quot;:512,\&quot;number\&quot;:4,\&quot;name\&quot;:\&quot;memcache\&quot;,\&quot;status\&quot;:\&quot;killed\&quot;,\&quot;exit_code\&quot;:130,\&quot;started\&quot;:1569875730,\&quot;stopped\&quot;:1569876638,\&quot;version\&quot;:3},{\&quot;id\&quot;:5143,\&quot;step_id\&quot;:512,\&quot;number\&quot;:5,\&quot;name\&quot;:\&quot;git\&quot;,\&quot;status\&quot;:\&quot;success\&quot;,\&quot;exit_code\&quot;:0,\&quot;started\&quot;:1569875730,\&quot;stopped\&quot;:1569875750,\&quot;version\&quot;:3},{\&quot;id\&quot;:5144,\&quot;step_id\&quot;:512,\&quot;number\&quot;:6,\&quot;name\&quot;:\&quot;restore-cache\&quot;,\&quot;status\&quot;:\&quot;success\&quot;,\&quot;exit_code\&quot;:0,\&quot;started\&quot;:1569875750,\&quot;stopped\&quot;:1569875843,\&quot;version\&quot;:3},{\&quot;id\&quot;:5145,\&quot;step_id\&quot;:512,\&quot;number\&quot;:7,\&quot;name\&quot;:\&quot;prepare\&quot;,\&quot;status\&quot;:\&quot;success\&quot;,\&quot;exit_code\&quot;:0,\&quot;started\&quot;:1569875843,\&quot;stopped\&quot;:1569875862,\&quot;version\&quot;:3},{\&quot;id\&quot;:5146,\&quot;step_id\&quot;:512,\&quot;number\&quot;:8,\&quot;name\&quot;:\&quot;rspec\&quot;,\&quot;status\&quot;:\&quot;killed\&quot;,\&quot;exit_code\&quot;:130,\&quot;started\&quot;:1569875862,\&quot;stopped\&quot;:1569876638,\&quot;version\&quot;:3},{\&quot;id\&quot;:5147,\&quot;step_id\&quot;:512,\&quot;number\&quot;:9,\&quot;name\&quot;:\&quot;rspec-features\&quot;,\&quot;status\&quot;:\&quot;killed\&quot;,\&quot;exit_code\&quot;:130,\&quot;started\&quot;:1569875862,\&quot;stopped\&quot;:1569876638,\&quot;version\&quot;:3},{\&quot;id\&quot;:5148,\&quot;step_id\&quot;:512,\&quot;number\&quot;:10,\&quot;name\&quot;:\&quot;jasmine\&quot;,\&quot;status\&quot;:\&quot;success\&quot;,\&quot;exit_code\&quot;:0,\&quot;started\&quot;:1569875862,\&quot;stopped\&quot;:1569876020,\&quot;version\&quot;:3},{\&quot;id\&quot;:5149,\&quot;step_id\&quot;:512,\&quot;number\&quot;:11,\&quot;name\&quot;:\&quot;assets-precompilation\&quot;,\&quot;status\&quot;:\&quot;success\&quot;,\&quot;exit_code\&quot;:0,\&quot;started\&quot;:1569875862,\&quot;stopped\&quot;:1569876167,\&quot;version\&quot;:3},{\&quot;id\&quot;:5150,\&quot;step_id\&quot;:512,\&quot;number\&quot;:12,\&quot;name\&quot;:\&quot;rubocop\&quot;,\&quot;status\&quot;:\&quot;success\&quot;,\&quot;exit_code\&quot;:0,\&quot;started\&quot;:1569875862,\&quot;stopped\&quot;:1569875892,\&quot;version\&quot;:3},{\&quot;id\&quot;:5151,\&quot;step_id\&quot;:512,\&quot;number\&quot;:13,\&quot;name\&quot;:\&quot;code-coverage\&quot;,\&quot;status\&quot;:\&quot;skipped\&quot;,\&quot;exit_code\&quot;:130,\&quot;started\&quot;:1569876638,\&quot;stopped\&quot;:1569876638,\&quot;version\&quot;:2},{\&quot;id\&quot;:5152,\&quot;step_id\&quot;:512,\&quot;number\&quot;:14,\&quot;name\&quot;:\&quot;rebuild-cache\&quot;,\&quot;status\&quot;:\&quot;skipped\&quot;,\&quot;exit_code\&quot;:130,\&quot;started\&quot;:1569876638,\&quot;stopped\&quot;:1569876638,\&quot;version\&quot;:2}]}]}\n&quot; } } } ``` Steps are marked as kill but aren't. I took the time to understand how it works and I understood than the canceling request is placed in a queue which is supposed to transmit the call, via a PubSub system, to [this line](https://github.com/drone/drone-runtime/blob/master/engine/docker/docker.go#L259) but I can't go further. I don't understand everything and I don't develop in GO. I'm ready to do more effort to fix the bug. Just let me know what you need.</DESCRIPTION>
  <REPONAME>harness</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>fix: [CODE-2583]: fix dry-running merge without merge method (#2852) * fix: [CODE-2583]: fix dry-running merge without merge method</MESSAGE>
    <SHA>7b5490ac10305dbecf57f21f57b56faa56e35226</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>feat: [AH-554]: Updated swagger changes (#2854) * [AH-554]: Updated swagger changes</MESSAGE>
      <SHA>c27a2f72013a7cf410ebfed2f31ea99905e86c35</SHA>
      <PATCHEDFILES>
        <FILE>registry/app/api/openapi/api.yaml</FILE>
        <FILE>registry/app/api/openapi/contracts/artifact/services.gen.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
