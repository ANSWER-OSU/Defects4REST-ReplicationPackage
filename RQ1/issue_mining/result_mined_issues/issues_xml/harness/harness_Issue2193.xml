<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>2193</ISSUENO>
  <ISSUEURL>https://github.com/harness/harness/issues/2193</ISSUEURL>
  <TITLE>Panic when trying to read non-existent vault secret</TITLE>
  <DESCRIPTION>If you try to reference a vault secret that does not exist in vault, drone will then panic and put the build in a forever pending state. This is with `drone/drone:0.8.0`. The stack trace: ``` Sep 5 21:46:11 drone6-server drone6[6307]: runtime error: invalid memory address or nil pointer dereference Sep 5 21:46:11 drone6-server drone6[6307]: /usr/local/go/src/runtime/panic.go:489 (0x42f29f) Sep 5 21:46:11 drone6-server drone6[6307]: /usr/local/go/src/runtime/panic.go:63 (0x42e14e) Sep 5 21:46:11 drone6-server drone6[6307]: /usr/local/go/src/runtime/signal_unix.go:290 (0x44430f) Sep 5 21:46:11 drone6-server drone6[6307]: /go/src/github.com/drone/drone/extras/secrets/vault.go:93 (0xa160c6) Sep 5 21:46:11 drone6-server drone6[6307]: /go/src/github.com/drone/drone/extras/secrets/vault.go:52 (0xa15c53) Sep 5 21:46:12 drone6-server drone6[6307]: /go/src/github.com/drone/drone/server/hook.go:222 (0x96871e) Sep 5 21:46:12 drone6-server drone6[6307]: /go/src/github.com/drone/drone/vendor/github.com/gin-gonic/gin/context.go:97 (0x8baa1a) Sep 5 21:46:12 drone6-server drone6[6307]: /go/src/github.com/drone/drone/router/middleware/token/token.go:17 (0x8d3ff0) Sep 5 21:46:12 drone6-server drone6[6307]: /go/src/github.com/drone/drone/vendor/github.com/gin-gonic/gin/context.go:97 (0x8baa1a) Sep 5 21:46:12 drone6-server drone6[6307]: /go/src/github.com/drone/drone/router/middleware/session/user.go:68 (0x8d3492) Sep 5 21:46:12 drone6-server drone6[6307]: /go/src/github.com/drone/drone/vendor/github.com/gin-gonic/gin/context.go:97 (0x8baa1a) Sep 5 21:46:12 drone6-server drone6[6307]: /go/src/github.com/drone/drone/router/middleware/store.go:15 (0x9cd767) Sep 5 21:46:12 drone6-server drone6[6307]: /go/src/github.com/drone/drone/vendor/github.com/gin-gonic/gin/context.go:97 (0x8baa1a) Sep 5 21:46:12 drone6-server drone6[6307]: /go/src/github.com/drone/drone/vendor/github.com/gin-gonic/contrib/ginrus/ginrus.go:26 (0x9cdbbf) Sep 5 21:46:12 drone6-server drone6[6307]: /go/src/github.com/drone/drone/vendor/github.com/gin-gonic/gin/context.go:97 (0x8baa1a) Sep 5 21:46:12 drone6-server drone6[6307]: /go/src/github.com/drone/drone/router/middleware/header/header.go:25 (0x8cb040) Sep 5 21:46:12 drone6-server drone6[6307]: /go/src/github.com/drone/drone/vendor/github.com/gin-gonic/gin/context.go:97 (0x8baa1a) Sep 5 21:46:12 drone6-server drone6[6307]: /go/src/github.com/drone/drone/router/middleware/header/header.go:17 (0x8cafe9) Sep 5 21:46:12 drone6-server drone6[6307]: /go/src/github.com/drone/drone/vendor/github.com/gin-gonic/gin/context.go:97 (0x8baa1a) Sep 5 21:46:12 drone6-server drone6[6307]: /go/src/github.com/drone/drone/vendor/github.com/gin-gonic/gin/recovery.go:45 (0x8c8caa) Sep 5 21:46:12 drone6-server drone6[6307]: /go/src/github.com/drone/drone/vendor/github.com/gin-gonic/gin/context.go:97 (0x8baa1a) Sep 5 21:46:12 drone6-server drone6[6307]: /go/src/github.com/drone/drone/vendor/github.com/gin-gonic/gin/gin.go:284 (0x8c0850) Sep 5 21:46:12 drone6-server drone6[6307]: /go/src/github.com/drone/drone/vendor/github.com/gin-gonic/gin/gin.go:265 (0x8c016b) Sep 5 21:46:12 drone6-server drone6[6307]: /usr/local/go/src/net/http/server.go:2568 (0x6ceb92) Sep 5 21:46:12 drone6-server drone6[6307]: /usr/local/go/src/net/http/server.go:1825 (0x6cad32) Sep 5 21:46:12 drone6-server drone6[6307]: /usr/local/go/src/runtime/asm_amd64.s:2197 (0x45dda1) ```</DESCRIPTION>
  <REPONAME>harness</REPONAME>
  <TIMEDIFFERENCEDAYS>9</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>feat: [CDE-127]: Adding changes to include logging in container orchestration. (#2178) * feat: [CDE-127]: Linting. * Merge branch 'refs/heads/main' into CDE-127 # Conflicts: # app/gitspace/orchestrator/container/embedded_docker.go # cmd/gitness/wire.go * feat: [CDE-127]: Addressing review comments. * feat: [CDE-127]: Removing streams map from StatefulLogger. Flushing the stream every time the invoking function is closed. * feat: [CDE-127]: Removing streams map from StatefulLogger. Flushing the stream every time the invoking function is closed. * feat: [CDE-127]: Removing streams map from StatefulLogger. Flushing the stream every time the invoking function is closed. * feat: [CDE-127]: Removing streams map from StatefulLogger. Flushing the stream every time the invoking function is closed. * feat: [CDE-127]: Adding flush stream logic to delete gitspace in orchestrator. Linting. * feat: [CDE-127]: Adding flush stream logic to delete gitspace in orchestrator. Linting. * feat: [CDE-127]: Addressing review comments. * feat: [CDE-127]: Adding changes to make logutil.StatefulLogger a wrapper on livelog.LogStream and adding initialisation and flush functions. * feat: [CDE-127]: Adding changes to make logutil.StatefulLogger a wrapper on livelog.LogStream and adding initialisation and flush functions. * feat: [CDE-127]: Adding changes to include logging in container orchestration's stop flow. * feat: [CDE-127]: Adding changes to include logging in container orchestration's start flow.</MESSAGE>
    <SHA>d577102d5ec6ff771163ab886ee26182ee694d25</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>feat: [CDE-127]: read multi-table and multi query data in a single SQL txn (#2193) * feat: [CDE-127]: starting and stopping states. * feat: [CDE-127]: read multi-table and multi query data in a single SQL txn</MESSAGE>
      <SHA>6e525fca4a5e1b02626bfe014c60c5ce4f4e7c2d</SHA>
      <PATCHEDFILES>
        <FILE>app/api/controller/gitspace/action.go</FILE>
        <FILE>app/api/controller/gitspace/controller.go</FILE>
        <FILE>app/api/controller/gitspace/create.go</FILE>
        <FILE>app/api/controller/gitspace/delete.go</FILE>
        <FILE>app/api/controller/gitspace/find.go</FILE>
        <FILE>app/api/controller/gitspace/wire.go</FILE>
        <FILE>app/api/controller/infraprovider/controller.go</FILE>
        <FILE>app/api/controller/infraprovider/create.go</FILE>
        <FILE>app/api/controller/infraprovider/wire.go</FILE>
        <FILE>app/api/controller/space/list_gitspaces.go</FILE>
        <FILE>cmd/gitness/wire_gen.go</FILE>
        <FILE>types/enum/gitspace_instance_state_type.go</FILE>
        <FILE>types/enum/gitspace_state_type.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
