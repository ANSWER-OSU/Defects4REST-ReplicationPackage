<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>3227</ISSUENO>
  <ISSUEURL>https://github.com/harness/harness/issues/3227</ISSUEURL>
  <TITLE>Docker-compose + Mariadb init db ERROR: Can't initialize batch_readline</TITLE>
  <DESCRIPTION>Hi, I have a strange problem when launching a mariadb container from a docker / compose service image via drone. **Scaffolding** SQL -init.sql .drone.yml docker-compose.yml **.drone.yml** ``` name: ERP Services kind: pipeline type: docker #### Stage Develop steps: - name: Run Services image: docker/compose:latest volumes: - name: dockersock path: /var/run/docker.sock commands: - docker-compose down - docker-compose rm - docker-compose up --detach environment: MYSQL_ROOT_PASSWORD: from_secret: MYSQL_ROOT_PASSWORD MYSQL_USER: from_secret: MYSQL_USER MYSQL_PASSWORD: from_secret: MYSQL_PASSWORD MYSQL_DATABASE: from_secret: MYSQL_DATABASE MYSQL_PORT: from_secret: MYSQL_PORT PMA_PORT: from_secret: PMA_PORT CLOUD_SERVER_PORT: from_secret: CLOUD_SERVER_PORT AWS_S3_ACCESS_KEY_ID: from_secret: AWS_S3_ACCESS_KEY_ID AWS_S3_SECRET_ACCESS_KEY: from_secret: AWS_S3_SECRET_ACCESS_KEY volumes: - name: dockersock host: path: /var/run/docker.sock trigger: branch: - master event: - push - tag ``` **docker-compose.yml** ``` version: &quot;3.8&quot; services: database: image: mariadb:latest container_name: Mariadb_ERP networks: - proxynet environment: MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD} MYSQL_USER: ${MYSQL_USER} MYSQL_TCP_PORT: ${MYSQL_PORT} MYSQL_UNIX_PORT: ${MYSQL_PORT} volumes: - ./SQL/init.sql:/docker-entrypoint-initdb.d/init.sql - /ERP/mariadb/:/var/lib/mysql restart: unless-stopped ports: - ${MYSQL_PORT}:3306 healthcheck: test: '/usr/bin/mysql --user=root --password=${MYSQL_ROOT_PASSWORD} --execute &quot;SHOW DATABASES;&quot;' interval: 3s timeout: 1s retries: 5 ``` Init.sql does not initialize the database and gives me the following error [Note] [Entrypoint]: /usr/local/bin/docker-entrypoint.sh: running /docker-entrypoint-initdb.d/init.sql ERROR: Can't initialize batch_readline - may be the input source is a directory or a block device. I noticed that it is created under the ./drone/src folder of folders: SQL / init.sql / I can't find the solution, if I launch it directly from localhost everything works perfectly. Do I have to go and create a build from the mysql image and do an ADD ./SQL?</DESCRIPTION>
  <REPONAME>harness</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>fix: [AH-859] Update URL validaiton regex to support aws urls (#3230) * fix: [AH-859] Update URL validaiton regex to support aws urls</MESSAGE>
    <SHA>bb5ffe1cae79ae3a0998a7427d40a61323f6a691</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>feat: [CDE-582]: refactor gitspaces, use spaceCache (#3227) * feat: [CDE-582]: refactor gitspaces seperate DB layer. * feat: [CDE-582]: refactor gitspaces seperate DB layer. * feat: [CDE-582]: refactor gitspaces seperate DB layer. * feat: [CDE-582]: refactor gitspaces seperate DB layer.</MESSAGE>
      <SHA>083a24d8eba0c339e0d5e40bf91689a4ebf0c4b6</SHA>
      <PATCHEDFILES>
        <FILE>app/api/controller/gitspace/action.go</FILE>
        <FILE>app/api/controller/gitspace/controller.go</FILE>
        <FILE>app/api/controller/gitspace/create.go</FILE>
        <FILE>app/api/controller/gitspace/delete.go</FILE>
        <FILE>app/api/controller/gitspace/events.go</FILE>
        <FILE>app/api/controller/gitspace/find.go</FILE>
        <FILE>app/api/controller/gitspace/list_all.go</FILE>
        <FILE>app/api/controller/gitspace/logs_stream.go</FILE>
        <FILE>app/api/controller/gitspace/lookup_repo.go</FILE>
        <FILE>app/api/controller/gitspace/update.go</FILE>
        <FILE>app/api/controller/gitspace/wire.go</FILE>
        <FILE>app/api/controller/infraprovider/controller.go</FILE>
        <FILE>app/api/controller/infraprovider/create.go</FILE>
        <FILE>app/api/controller/infraprovider/create_resources.go</FILE>
        <FILE>app/api/controller/infraprovider/find.go</FILE>
        <FILE>app/api/controller/infraprovider/wire.go</FILE>
        <FILE>app/api/controller/space/list_gitspaces.go</FILE>
        <FILE>app/api/handler/gitspace/list_all_gitspaces.go</FILE>
        <FILE>app/services/gitspace/find.go</FILE>
        <FILE>app/services/gitspace/gitspace.go</FILE>
        <FILE>app/services/gitspaceinfraevent/handler.go</FILE>
        <FILE>cmd/gitness/wire_gen.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
