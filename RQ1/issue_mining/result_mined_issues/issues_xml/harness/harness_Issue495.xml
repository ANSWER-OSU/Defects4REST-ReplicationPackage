<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>495</ISSUENO>
  <ISSUEURL>https://github.com/harness/harness/issues/495</ISSUEURL>
  <TITLE>[exp] Gitlab Auth issue</TITLE>
  <DESCRIPTION>since last commits, i can't auth via gitlab, got NotFound Ok, go to `server/main.go` and add handler: ``` go goji.Post(&quot;/api/auth/:host&quot;, handler.GetLogin) ``` Launch drone, and test: Internal Error ``` @iMac ➜ drone rvm:(ruby-2.1.3) git:(exp) ✗ ./debian/drone/usr/local/bin/droned --config=./drone.conf 2014/10/01 19:38:16.206024 Starting Goji on [::]:8000 2014/10/01 19:40:23.911282 [iMac-Kirill/224rnGM5Au-000001] Started POST &quot;/api/auth/git.teobit.ru&quot; from 127.0.0.1:58796 2014/10/01 19:40:24.265804 [iMac-Kirill/224rnGM5Au-000001] Returning 400 in 354.500938ms 2014/10/01 19:40:24.635285 [iMac-Kirill/224rnGM5Au-000002] Started GET &quot;/favicon.ico&quot; from 127.0.0.1:58796 2014/10/01 19:40:24.635454 [iMac-Kirill/224rnGM5Au-000002] Returning 200 in 142.609us 2014/10/01 19:45:25.809654 [iMac-Kirill/224rnGM5Au-000003] Started POST &quot;/api/auth/git.teobit.ru&quot; from 127.0.0.1:58796 2014/10/01 19:45:26.090742 [iMac-Kirill/224rnGM5Au-000003] Returning 400 in 281.071105ms 2014/10/01 19:45:26.497144 [iMac-Kirill/224rnGM5Au-000004] Started GET &quot;/favicon.ico&quot; from 127.0.0.1:58796 2014/10/01 19:45:26.497312 [iMac-Kirill/224rnGM5Au-000004] Returning 200 in 145.985us 2014/10/01 19:45:28.678011 [iMac-Kirill/224rnGM5Au-000005] Started GET &quot;/gitlab&quot; from 127.0.0.1:58796 2014/10/01 19:45:28.678176 [iMac-Kirill/224rnGM5Au-000005] Returning 200 in 139.485us 2014/10/01 19:45:28.861238 [iMac-Kirill/224rnGM5Au-000006] Started GET &quot;/api/user&quot; from 127.0.0.1:58796 invalid token 2014/10/01 19:45:28.861321 [iMac-Kirill/224rnGM5Au-000006] Returning 401 in 64.215us 2014/10/01 19:45:29.041267 [iMac-Kirill/224rnGM5Au-000007] Started GET &quot;/api/stream/user&quot; from 127.0.0.1:63467 2014/10/01 19:45:29.137947 [iMac-Kirill/224rnGM5Au-000008] Started GET &quot;/favicon.ico&quot; from 127.0.0.1:58796 2014/10/01 19:45:29.138098 [iMac-Kirill/224rnGM5Au-000008] Returning 200 in 124.012us 2014/10/01 19:45:30.498867 [iMac-Kirill/224rnGM5Au-000009] Started POST &quot;/api/auth/gitlab.com&quot; from 127.0.0.1:58796 2014/10/01 19:45:31.000913 [iMac-Kirill/224rnGM5Au-000009] panic: interface conversion: interface is nil, not capability.Capability /Users/bugagazavr/Documents/Go/src/github.com/zenazn/goji/web/middleware/recoverer.go:24 (0x42cd86b) func.006: debug.PrintStack() /usr/local/Cellar/go/1.3.2/libexec/src/pkg/runtime/panic.c:248 (0x40cbdfd) panic: runtime·newstackcall(d-&gt;fn, (byte*)d-&gt;args, d-&gt;siz); /usr/local/Cellar/go/1.3.2/libexec/src/pkg/runtime/iface.goc:292 (0x40dea10) assertE2Tret: runtime·panic(err); /usr/local/Cellar/go/1.3.2/libexec/src/pkg/runtime/iface.goc:280 (0x40de990) assertE2T: assertE2Tret(t, e, (byte*)&amp;retbase); /Users/bugagazavr/Documents/Go/src/github.com/drone/drone/server/capability/context.go:31 (0x42af94c) FromContext: return c.Value(reqkey).(Capability) /Users/bugagazavr/Documents/Go/src/github.com/drone/drone/server/capability/capability.go:22 (0x42af871) Enabled: return FromContext(c).Get(key) /Users/bugagazavr/Documents/Go/src/github.com/drone/drone/server/handler/login.go:51 (0x415295d) GetLogin: if capability.Enabled(ctx, capability.Registration) == false { /Users/bugagazavr/Documents/Go/src/github.com/zenazn/goji/web/web.go:127 (0x416e894) HandlerFunc.ServeHTTPC: h(c, w, r) /Users/bugagazavr/Documents/Go/src/github.com/zenazn/goji/web/router.go:210 (0x416d5a9) routeMachine.route: rm.routes[si].handler.ServeHTTPC(*c, w, r) /Users/bugagazavr/Documents/Go/src/github.com/zenazn/goji/web/router.go:250 (0x416d91a) (*router).route: methods, ok := rm.route(c, w, r) /Users/bugagazavr/Documents/Go/src/github.com/zenazn/goji/web/middleware.go:94 (0x416e96f) func.002: router.route(&amp;cs.C, w, r) /usr/local/Cellar/go/1.3.2/libexec/src/pkg/net/http/server.go:1235 (0x412b2b0) HandlerFunc.ServeHTTP: f(w, r) /Users/bugagazavr/Documents/Go/src/github.com/drone/drone/server/middleware/user.go:21 (0x415c819) func.005: h.ServeHTTP(w, r) /usr/local/Cellar/go/1.3.2/libexec/src/pkg/net/http/server.go:1235 (0x412b2b0) HandlerFunc.ServeHTTP: f(w, r) /Users/bugagazavr/Documents/Go/src/github.com/drone/drone/server/middleware/header.go:25 (0x415b9bf) func.001: h.ServeHTTP(w, r) /usr/local/Cellar/go/1.3.2/libexec/src/pkg/net/http/server.go:1235 (0x412b2b0) HandlerFunc.ServeHTTP: f(w, r) /Users/bugagazavr/Documents/Go/src/github.com/drone/drone/server/main.go:190 (0x40bd6d5) func.002: h.ServeHTTP(w, r) /usr/local/Cellar/go/1.3.2/libexec/src/pkg/net/http/server.go:1235 (0x412b2b0) HandlerFunc.ServeHTTP: f(w, r) /Users/bugagazavr/Documents/Go/src/github.com/zenazn/goji/web/middleware/options.go:70 (0x42cd7ab) func.004: h.ServeHTTP(w, r) /usr/local/Cellar/go/1.3.2/libexec/src/pkg/net/http/server.go:1235 (0x412b2b0) HandlerFunc.ServeHTTP: f(w, r) /Users/bugagazavr/Documents/Go/src/github.com/zenazn/goji/web/middleware/recoverer.go:29 (0x42cda29) func.007: h.ServeHTTP(w, r) /usr/local/Cellar/go/1.3.2/libexec/src/pkg/net/http/server.go:1235 (0x412b2b0) HandlerFunc.ServeHTTP: f(w, r) /Users/bugagazavr/Documents/Go/src/github.com/zenazn/goji/web/middleware/logger.go:28 (0x42cd4a0) func.002: h.ServeHTTP(lw, r) /usr/local/Cellar/go/1.3.2/libexec/src/pkg/net/http/server.go:1235 (0x412b2b0) HandlerFunc.ServeHTTP: f(w, r) /Users/bugagazavr/Documents/Go/src/github.com/zenazn/goji/web/middleware/request_id.go:68 (0x42cdd5f) func.008: h.ServeHTTP(w, r) /usr/local/Cellar/go/1.3.2/libexec/src/pkg/net/http/server.go:1235 (0x412b2b0) HandlerFunc.ServeHTTP: f(w, r) /Users/bugagazavr/Documents/Go/src/github.com/zenazn/goji/web/middleware.go:51 (0x4169b9f) (*cStack).ServeHTTP: s.m.ServeHTTP(w, r) /Users/bugagazavr/Documents/Go/src/github.com/zenazn/goji/web/mux.go:77 (0x416ad1f) (*Mux).ServeHTTP: stack.ServeHTTP(w, r) /usr/local/Cellar/go/1.3.2/libexec/src/pkg/net/http/server.go:1511 (0x412ca83) (*ServeMux).ServeHTTP: h.ServeHTTP(w, r) /usr/local/Cellar/go/1.3.2/libexec/src/pkg/net/http/server.go:1673 (0x412d3af) serverHandler.ServeHTTP: handler.ServeHTTP(rw, req) /usr/local/Cellar/go/1.3.2/libexec/src/pkg/net/http/server.go:1174 (0x412ae2e) (*conn).serve: serverHandler{c.server}.ServeHTTP(w, w.req) /usr/local/Cellar/go/1.3.2/libexec/src/pkg/runtime/proc.c:1445 (0x40d0620) goexit: runtime·goexit(void) ```</DESCRIPTION>
  <REPONAME>harness</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge branch 'akp/fix/CODE-863' of _OKE5H2PQKOUfzFFDuD4FA/default/CODE/gitness (#491)</MESSAGE>
    <SHA>70c8f84e2db2a303a21202c8d7c243b8ceef0f14</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Merge branch 'demo-feedback' of _OKE5H2PQKOUfzFFDuD4FA/default/CODE/gitness (#495)</MESSAGE>
      <SHA>9ddeaea2113e9197e169d0b5af39550b6a250a20</SHA>
      <PATCHEDFILES>
        <FILE>web/src/components/NewSecretModalButton/NewSecretModalButton.tsx</FILE>
        <FILE>web/src/components/PluginsPanel/PluginsPanel.tsx</FILE>
        <FILE>web/src/components/UpdateSecretModal/UpdateSecretModal.tsx</FILE>
        <FILE>web/src/framework/strings/stringTypes.ts</FILE>
        <FILE>web/src/i18n/strings.en.yaml</FILE>
        <FILE>web/src/pages/AddUpdatePipeline/AddUpdatePipeline.tsx</FILE>
        <FILE>web/src/pages/ExecutionList/ExecutionList.tsx</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
