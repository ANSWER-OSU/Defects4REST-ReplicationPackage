<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>2480</ISSUENO>
  <ISSUEURL>https://github.com/harness/harness/issues/2480</ISSUEURL>
  <TITLE>panic: send on closed channel</TITLE>
  <DESCRIPTION>Getting this panic in the server when a build outputs large logs: ``` panic: send on closed channel goroutine 168623 [running]: github.com/drone/drone/server.LogStreamSSE.func2.1(0xc428365a38, 0x1, 0x1) /go/src/github.com/drone/drone/server/stream.go:196 +0xc4 created by github.com/drone/drone/vendor/github.com/cncd/logging.(*log).Write /go/src/github.com/drone/drone/vendor/github.com/cncd/logging/log.go:74 +0x1cd ``` Possibly related error on the agent just before the panic: ``` grpc error: upload(): code: ResourceExhausted: rpc error: code = ResourceExhausted desc = grpc: trying to send message larger than max (6135644 vs. 4194304) ```</DESCRIPTION>
  <REPONAME>harness</REPONAME>
  <TIMEDIFFERENCEDAYS>203</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #2510 from tboerger/envsubst-update Upgrade envsubst to latest version</MESSAGE>
    <SHA>a1d270a2533885c34c1a339d74d1c2fa3d1c0600</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>fix for #2480</MESSAGE>
      <SHA>eb964569095cf1ab786e476ca129a50e289c91ca</SHA>
      <PATCHEDFILES>
        <FILE>.drone.yml</FILE>
        <FILE>server/stream.go</FILE>
        <FILE>version/version.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Recover panic on closed channel Related to #2480</MESSAGE>
      <SHA>0e86528aec4be84dab7a93b58b26948daaf09117</SHA>
      <PATCHEDFILES>
        <FILE>server/stream.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Recover panic on closed channel Related to #2480</MESSAGE>
      <SHA>662d887162808413ad0946268b0df3df67d5f845</SHA>
      <PATCHEDFILES>
        <FILE>server/stream.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Recover panic on closed channel Related to #2480 Signed-off-by: Niall Sheridan &lt;nsheridan@squarespace.com&gt;</MESSAGE>
      <SHA>2b43e9266ce3bf2b4982cfa354f875f999efc502</SHA>
      <PATCHEDFILES>
        <FILE>server/stream.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Recover panic on closed channel Related to #2480 Signed-off-by: Niall Sheridan &lt;nsheridan@squarespace.com&gt;</MESSAGE>
      <SHA>a55fa44589f7c7aff6998b0be17cd0ae0ea24cb8</SHA>
      <PATCHEDFILES>
        <FILE>server/stream.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
