<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>6789</ISSUENO>
  <ISSUEURL>https://github.com/nopSolutions/nopCommerce/issues/6789</ISSUEURL>
  <TITLE>The CustomCustomerAttributes data from customer attributes didn't migrate to the customer table</TITLE>
  <DESCRIPTION>&gt; The migration didn't migrate _CustomCustomerAttributesXML_ in my case, there seems to be an issue because the GenericAttribute was previously named CustomCustomerAttributes and not CustomCustomerAttributes**XML**. &gt; &gt; &gt; I'm upgrading nopCommerce 4.20 to 4.60.3. I ran the upgrade script from 4.20 to 4.30 and started the application, which did the needed database migrations. I lost all custom customer attributes, they remained in the GenericAttribute table but should have been moved to the customers table. &gt; &gt; I change the SQL-Upgrade-Script 4.50-4.60 as follows, which fixed it: &gt; &gt; ````SQL &gt; -- CustomCustomerAttributesXML &gt; MERGE Customer AS c USING [GenericAttribute] AS ga &gt; ON ga.EntityId = c.Id AND ga.KeyGroup = 'Customer' AND ga.[Key] = 'CustomCustomerAttributes' &gt; -- had 'CustomCustomerAttributesXML' which is wrong ^^^ &gt; WHEN MATCHED THEN UPDATE SET c.CustomCustomerAttributesXML = ga.[Value]; &gt; &gt; DELETE FROM [GenericAttribute] where [KeyGroup] = 'Customer' AND [Key] = 'CustomCustomerAttributes' &gt; -- had 'CustomCustomerAttributesXML' which is wrong ^^^ &gt; ```` _Originally posted by @BeniFreitag in https://github.com/nopSolutions/nopCommerce/issues/4601#issuecomment-1649737807_</DESCRIPTION>
  <REPONAME>nopCommerce</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge remote-tracking branch 'origin/4.60-bug-fixes' into 4.60-bug-fixes</MESSAGE>
    <SHA>fd9c7764e4d312829a5212c64aea6decab2d2682</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>#6789 Migrate The CustomCustomerAttributes data from customer attributes to the customer table</MESSAGE>
      <SHA>247ae3d78c8f9f9e9593a38f8b28b5dfab2dac2d</SHA>
      <PATCHEDFILES>
        <FILE>src/Libraries/Nop.Data/Migrations/MigrationManager.cs</FILE>
        <FILE>src/Libraries/Nop.Data/Migrations/NopMigrationDefaults.cs</FILE>
        <FILE>src/Libraries/Nop.Data/Migrations/UpgradeTo460/DataMigration.cs</FILE>
        <FILE>src/Presentation/Nop.Web.Framework/Migrations/UpgradeTo460/LocalizationMigration.cs</FILE>
        <FILE>src/Presentation/Nop.Web.Framework/Migrations/UpgradeTo460/SettingMigration.cs</FILE>
        <FILE>upgradescripts/4.50-4.60/mssql_customer_data_migrate.sql</FILE>
        <FILE>upgradescripts/4.50-4.60/mysql_customer_data_migrate.sql</FILE>
        <FILE>upgradescripts/4.50-4.60/postgres_customer_data_migrate.sql</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
