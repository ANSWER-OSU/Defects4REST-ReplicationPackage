<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>6602</ISSUENO>
  <ISSUEURL>https://github.com/nopSolutions/nopCommerce/issues/6602</ISSUEURL>
  <TITLE>IO Exception after changing storage for images</TITLE>
  <DESCRIPTION>nopCommerce version: develop Steps to reproduce the problem: &gt;I have Nopcommerce installed with pictures stored in database. After that I changed to file system and I got error when I first open any product. It looks like many processes try to create/update same file image. ``` System.IO.IOException: The process cannot access the file 'C:\Users\SSM\source\Workspaces\NopCommerce\nopCommerce461\src\Presentation\Nop.Web\wwwroot\images\0000036_0.jpeg' because it is being used by another process. at Microsoft.Win32.SafeHandles.SafeFileHandle.CreateFile(String fullPath, FileMode mode, FileAccess access, FileShare share, FileOptions options) at Microsoft.Win32.SafeHandles.SafeFileHandle.Open(String fullPath, FileMode mode, FileAccess access, FileShare share, FileOptions options, Int64 preallocationSize, Nullable`1 unixCreateMode) at System.IO.File.OpenHandle(String path, FileMode mode, FileAccess access, FileShare share, FileOptions options, Int64 preallocationSize) at System.IO.File.&lt;WriteAllBytesAsync&gt;g__Core|92_0(String path, Byte[] bytes, CancellationToken cancellationToken) at Nop.Core.Infrastructure.NopFileProvider.WriteAllBytesAsync(String filePath, Byte[] bytes) in C:\Users\SSM\source\Workspaces\NopCommerce\nopCommerce461\src\Libraries\Nop.Core\Infrastructure\NopFileProvider.cs:line 566 at Nop.Services.Media.PictureService.SavePictureInFileAsync(Int32 pictureId, Byte[] pictureBinary, String mimeType) in C:\Users\SSM\source\Workspaces\NopCommerce\nopCommerce461\src\Libraries\Nop.Services\Media\PictureService.cs:line 108 ... ``` Source: https://www.nopcommerce.com/en/boards/topic/96287/media-file-system</DESCRIPTION>
  <REPONAME>nopCommerce</REPONAME>
  <TIMEDIFFERENCEDAYS>10</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>fix incorrect quantity in printing packing slips #6608</MESSAGE>
    <SHA>10423403c2b7dccee62844e5c7e10fc8146bc996</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>#6436 #6602 Fixed image generation on first load</MESSAGE>
      <SHA>a930e574d545d8aa651ac0119907ae8751283089</SHA>
      <PATCHEDFILES>
        <FILE>src/Presentation/Nop.Web/Factories/ProductModelFactory.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#6602 Updated note about changing of image storage</MESSAGE>
      <SHA>b6cebc6f30b3995468da84a8bf7e27ef0f0ec6cb</SHA>
      <PATCHEDFILES>
        <FILE>src/Presentation/Nop.Web.Framework/Migrations/UpgradeTo470/LocalizationMigration.cs</FILE>
        <FILE>src/Presentation/Nop.Web/App_Data/Localization/defaultResources.nopres.xml</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#6436 #6602 Fixed image generation on first load</MESSAGE>
      <SHA>41def329cf572137c28c7eb7f877d130f7cf9399</SHA>
      <PATCHEDFILES>
        <FILE>src/Presentation/Nop.Web/Factories/ProductModelFactory.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
