<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>7155</ISSUENO>
  <ISSUEURL>https://github.com/nopSolutions/nopCommerce/issues/7155</ISSUEURL>
  <TITLE>GDPR: customer ip addresses saved in logs</TITLE>
  <DESCRIPTION>nopCommerce version: 4.60.x + Steps to reproduce the problem: 1. Disable setting `customersettings.storeipaddresses` 2. visit the store, and produce a log message that is associated to a customer. (i.e. with the following http status codes: 400, 404, 500) 3. visit the logs in the backend, open the details page of the produced log message 4. You will see the email of the customer with a link to the customer detail page and additionally the IP address of the customer. Based on the GDPR this is not allowed, as with this log file the displayed IP address can be directly associated with the customer. Proposed solution: If `customersettings.storeipaddresses` is disabled, IP addresses in the logs should not be stored for registered customers (or even any customers). https://github.com/nopSolutions/nopCommerce/blob/8ad98f390753bce78fed8cdc6f712ffdb513fe2b/src/Libraries/Nop.Services/Logging/DefaultLogger.cs#L191-L201</DESCRIPTION>
  <REPONAME>nopCommerce</REPONAME>
  <TIMEDIFFERENCEDAYS>23</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>#7154 Renamed AccessDeniedDataTablesJson method to AccessDeniedJsonAsync</MESSAGE>
    <SHA>a60580d18d8e1b41b9d0df10802f301999ee0ad8</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>#7155 Prevented to save customer IP address in the log if the CustomerSettings.StoreIpAddresses setting is disabled</MESSAGE>
      <SHA>d7449c020a67724bfaa976c3e9941a743721bb73</SHA>
      <PATCHEDFILES>
        <FILE>src/Libraries/Nop.Services/Logging/CustomerActivityService.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Logging/DefaultLogger.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Logging/ILogger.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#7155 Prevented to save customer IP address in the forum post if the CustomerSettings.StoreIpAddresses setting is disabled</MESSAGE>
      <SHA>e19755039ad500e90610a357ce472b55f105a23d</SHA>
      <PATCHEDFILES>
        <FILE>src/Presentation/Nop.Web/Controllers/BoardsController.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
