<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>4318</ISSUENO>
  <ISSUEURL>https://github.com/nopSolutions/nopCommerce/issues/4318</ISSUEURL>
  <TITLE>QualPay add to Vault</TITLE>
  <DESCRIPTION>nopCommerce version: 4.20 Steps to reproduce the problem: 1) Open current customer -- Customer Country is United States 2) Click &quot;Add to Vault&quot; 3) Get below errors: &gt; Short message &gt; Qualpay Customer Vault error: Failed to create customer. Error details in the log &gt; Full message &gt; Nop.Core.NopException: Qualpay Customer Vault error: Failed to create customer. Error details in the log &gt; at Nop.Plugin.Payments.Qualpay.Controllers.CustomerController.CreateQualpayCustomer(Int32 customerId) &gt; at lambda_method(Closure , Object , Object[] ) &gt; at Microsoft.AspNetCore.Mvc.Internal.ActionMethodExecutor.SyncActionResultExecutor.Execute(IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments) &gt; at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.InvokeActionMethodAsync() &gt; at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.InvokeNextActionFilterAsync() &gt; at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.Rethrow(ActionExecutedContext context) &gt; at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.Next(State&amp; next, Scope&amp; scope, Object&amp; state, Boolean&amp; isCompleted) &gt; at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.InvokeInnerFilterAsync() &gt; at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.InvokeNextResourceFilter() &gt; at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.Rethrow(ResourceExecutedContext context) &gt; at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.Next(State&amp; next, Scope&amp; scope, Object&amp; state, Boolean&amp; isCompleted) &gt; at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.InvokeFilterPipelineAsync() &gt; at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.InvokeAsync() &gt; at Microsoft.AspNetCore.Builder.RouterMiddleware.Invoke(HttpContext httpContext) &gt; at WebMarkupMin.AspNetCore2.WebMarkupMinMiddleware.Invoke(HttpContext context) &gt; at StackExchange.Profiling.MiniProfilerMiddleware.Invoke(HttpContext context) in C:\projects\dotnet\src\MiniProfiler.AspNetCore\MiniProfilerMiddleware.cs:line 94 &gt; at Nop.Services.Authentication.AuthenticationMiddleware.Invoke(HttpContext context) in C:\Users\dootc\Documents\Visual Studio 2019\Websites\nopCommerce_4.20_Source\Libraries\Nop.Services\Authentication\AuthenticationMiddleware.cs:line 79 &gt; at Microsoft.AspNetCore.Localization.RequestLocalizationMiddleware.Invoke(HttpContext context) &gt; at Microsoft.AspNetCore.Session.SessionMiddleware.Invoke(HttpContext context) &gt; at Microsoft.AspNetCore.Session.SessionMiddleware.Invoke(HttpContext context) &gt; at Nop.Services.Installation.InstallUrlMiddleware.Invoke(HttpContext context, IWebHelper webHelper) in C:\Users\dootc\Documents\Visual Studio 2019\Websites\nopCommerce_4.20_Source\Libraries\Nop.Services\Installation\InstallUrlMiddleware.cs:line 52 &gt; at Nop.Services.Common.KeepAliveMiddleware.Invoke(HttpContext context, IWebHelper webHelper) in C:\Users\dootc\Documents\Visual Studio 2019\Websites\nopCommerce_4.20_Source\Libraries\Nop.Services\Common\KeepAliveMiddleware.cs:line 49 &gt; at Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware.Invoke(HttpContext context) &gt; at Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware.Invoke(HttpContext context) &gt; at Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware.Invoke(HttpContext context) &gt; at Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware.Invoke(HttpContext context) &gt; at Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware.Invoke(HttpContext context) &gt; at Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware.Invoke(HttpContext context) &gt; at Microsoft.AspNetCore.Diagnostics.StatusCodePagesMiddleware.Invoke(HttpContext context) &gt; at Microsoft.AspNetCore.Diagnostics.StatusCodePagesMiddleware.Invoke(HttpContext context) &gt; at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddleware.Invoke(HttpContext context) &gt; Log level &gt; Error &gt; Short message &gt; Qualpay error: Error calling AddCustomer: { &gt; &quot;code&quot; : 2, &gt; &quot;message&quot; : &quot;Request validation failed&quot;, &gt; &quot;data&quot; : { &gt; &quot;shipping_country_code&quot; : &quot;Country code is invalid&quot; &gt; } &gt; } &gt; Full message &gt; qpPlatform.Client.ApiException: Error calling AddCustomer: { &gt; &quot;code&quot; : 2, &gt; &quot;message&quot; : &quot;Request validation failed&quot;, &gt; &quot;data&quot; : { &gt; &quot;shipping_country_code&quot; : &quot;Country code is invalid&quot; &gt; } &gt; } &gt; at qpPlatform.Api.CustomerVaultApi.AddCustomerWithHttpInfo(AddCustomerRequest body) &gt; at qpPlatform.Api.CustomerVaultApi.AddCustomer(AddCustomerRequest body) &gt; at Nop.Plugin.Payments.Qualpay.Services.QualpayManager.&lt;&gt;c__DisplayClass42_0.&lt;CreateCustomer&gt;b__0() &gt; at Nop.Plugin.Payments.Qualpay.Services.QualpayManager.InvokeFunction[TResult](Func`1 function)</DESCRIPTION>
  <REPONAME>nopCommerce</REPONAME>
  <TIMEDIFFERENCEDAYS>18</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>#4322 Drop force ssl setting</MESSAGE>
    <SHA>fbb534d372968ecb2a7d541971c93632766e1295</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>#4318 Fix country code in shipping address request</MESSAGE>
      <SHA>b1531e0db59de09436fddeeba9fde8c3399f6e9f</SHA>
      <PATCHEDFILES>
        <FILE>src/Plugins/Nop.Plugin.Payments.Qualpay/Services/QualpayManager.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.Qualpay/plugin.json</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
