<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>3411</ISSUENO>
  <ISSUEURL>https://github.com/nopSolutions/nopCommerce/issues/3411</ISSUEURL>
  <TITLE>Form value count limit 2048 exceeded.</TITLE>
  <DESCRIPTION>nopCommerce version: 4.1 Steps to reproduce the problem: We have around 25 methods in Admin/Shipping/Restrictions multiplied for around 250 countries we get around 6250 elements in the form, far more than 2048 limit. Full error here: &gt; System.IO.InvalidDataException: Form value count limit 2048 exceeded. &gt; at Microsoft.AspNetCore.WebUtilities.FormReader.Append(KeyValueAccumulator&amp; accumulator) &gt; at Microsoft.AspNetCore.WebUtilities.FormReader.ReadFormAsync(CancellationToken cancellationToken) &gt; at Microsoft.AspNetCore.Http.Features.FormFeature.InnerReadFormAsync(CancellationToken cancellationToken) &gt; at Microsoft.AspNetCore.Mvc.ModelBinding.FormValueProviderFactory.AddValueProviderAsync(ValueProviderFactoryContext context) &gt; at Microsoft.AspNetCore.Mvc.ModelBinding.CompositeValueProvider.CreateAsync(ActionContext actionContext, IList`1 factories) &gt; at Microsoft.AspNetCore.Mvc.ModelBinding.CompositeValueProvider.CreateAsync(ControllerContext controllerContext) &gt; at Microsoft.AspNetCore.Mvc.Internal.ControllerBinderDelegateProvider.&lt;&gt;c__DisplayClass0_0.&lt;&lt;CreateBinderDelegate&gt;g__Bind|0&gt;d.MoveNext() &gt; --- End of stack trace from previous location where exception was thrown --- &gt; at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.InvokeInnerFilterAsync() &gt; at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.InvokeNextResourceFilter() &gt; at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.Rethrow(ResourceExecutedContext context) &gt; at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.Next(State&amp; next, Scope&amp; scope, Object&amp; state, Boolean&amp; isCompleted) &gt; at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.InvokeFilterPipelineAsync() &gt; at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.InvokeAsync() &gt; at Microsoft.AspNetCore.Builder.RouterMiddleware.Invoke(HttpContext httpContext) &gt; at StackExchange.Profiling.MiniProfilerMiddleware.Invoke(HttpContext context) in C:\projects\dotnet\src\MiniProfiler.AspNetCore\MiniProfilerMiddleware.cs:line 94 &gt; at Nop.Services.Authentication.AuthenticationMiddleware.Invoke(HttpContext context) in C:\andrei\nopcommerce\sources\src\Libraries\Nop.Services\Authentication\AuthenticationMiddleware.cs:line 79 &gt; at Microsoft.AspNetCore.Localization.RequestLocalizationMiddleware.Invoke(HttpContext context) &gt; at Microsoft.AspNetCore.Session.SessionMiddleware.Invoke(HttpContext context) &gt; at Microsoft.AspNetCore.Session.SessionMiddleware.Invoke(HttpContext context) &gt; at Nop.Core.Http.InstallUrlMiddleware.Invoke(HttpContext context, IWebHelper webHelper) in C:\andrei\nopcommerce\sources\src\Libraries\Nop.Core\Http\InstallUrlMiddleware.cs:line 51 &gt; at Nop.Core.Http.KeepAliveMiddleware.Invoke(HttpContext context, IWebHelper webHelper) in C:\andrei\nopcommerce\sources\src\Libraries\Nop.Core\Http\KeepAliveMiddleware.cs:line 50 &gt; at Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware.Invoke(HttpContext context) &gt; at Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware.Invoke(HttpContext context) &gt; at Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware.Invoke(HttpContext context) &gt; at Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware.Invoke(HttpContext context) &gt; at Microsoft.AspNetCore.Diagnostics.StatusCodePagesMiddleware.Invoke(HttpContext context) &gt; at Microsoft.AspNetCore.Diagnostics.StatusCodePagesMiddleware.Invoke(HttpContext context) &gt; at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddleware.Invoke(HttpContext context) &gt;</DESCRIPTION>
  <REPONAME>nopCommerce</REPONAME>
  <TIMEDIFFERENCEDAYS>2</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge branch 'issue-3266-checkout-as-guest-or-register' into develop</MESSAGE>
    <SHA>3fec89083de0fb975480f03a64fdf497eed234f1</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>ValueCountLimit and ValueLengthLimit = int.MaxValue #3411</MESSAGE>
      <SHA>c9dc8b1a2d1a145f74a57b743d3242f71ca481b0</SHA>
      <PATCHEDFILES>
        <FILE>src/Presentation/Nop.Web.Framework/Mvc/Filters/RequestFormSizeLimitAttribute.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Controllers/BaseAdminController.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
