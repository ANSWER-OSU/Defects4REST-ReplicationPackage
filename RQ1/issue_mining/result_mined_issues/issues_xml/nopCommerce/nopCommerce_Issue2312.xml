<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>2312</ISSUENO>
  <ISSUEURL>https://github.com/nopSolutions/nopCommerce/issues/2312</ISSUEURL>
  <TITLE>If a returning customer has entered a couponcode which no longer exists accessing, the cart can cause a crash</TITLE>
  <DESCRIPTION>If a returning customer has entered a couponcode which no longer exists accessing, the cart can cause a crash due to the following lines in ShoppingCartModelFactory: var discount = _discountService.GetAllDiscountsForCaching(couponCode: couponCode) .FirstOrDefault(d =&gt; d.RequiresCouponCode &amp;&amp; _discountService.ValidateDiscount(d, _workContext.CurrentCustomer).IsValid); model.DiscountBox.AppliedDiscountsWithCodes.Add(new ShoppingCartModel.DiscountBoxModel.DiscountInfoModel() { Id = discount.Id, CouponCode = discount.CouponCode }); The discount in this case is null. Source: http://www.nopcommerce.com/boards/t/47053/missing-null-check-causes-crash-in-cart.aspx</DESCRIPTION>
  <REPONAME>nopCommerce</REPONAME>
  <TIMEDIFFERENCEDAYS>33</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>#2270 Checkout didn't work in SQL Server compact with reward points enabled</MESSAGE>
    <SHA>379d8acbf126ee0cc9cfe83449266bee322567df</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>#2312 If a returning customer has entered a couponcode which no longer exists accessing, the cart can cause a crash</MESSAGE>
      <SHA>b5f7884ce5be583e0d5e4deaa300b9176eca42fa</SHA>
      <PATCHEDFILES>
        <FILE>src/Presentation/Nop.Web/Factories/ShoppingCartModelFactory.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#2312 If a returning customer has entered a couponcode which no longer exists accessing, the cart can cause a crash</MESSAGE>
      <SHA>03c4b701fd92529e5ea785500f7da16e84c9b4a2</SHA>
      <PATCHEDFILES>
        <FILE>src/Presentation/Nop.Web/Factories/ShoppingCartModelFactory.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
