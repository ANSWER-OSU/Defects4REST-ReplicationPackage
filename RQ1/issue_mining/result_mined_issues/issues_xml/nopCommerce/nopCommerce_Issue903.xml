<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>903</ISSUENO>
  <ISSUEURL>https://github.com/nopSolutions/nopCommerce/issues/903</ISSUEURL>
  <TITLE>We should not allow a customer to visit &quot;checkout&quot; page (hide it and appropriate buttons) if we have only &quot;Button&quot; payment methods</TITLE>
  <DESCRIPTION>We should not allow a customer to visit &quot;checkout&quot; page if we have only &quot;Button&quot; payment methods (such as Google Checkout) Hide appropriate buttons on the shopping cart page and mini-shopping cart block Add validate in CheckoutController (index method) We can do it the following way: 1. ShoppingCartController, PrepareMiniShoppingCartModel method. Use the following code: var hasStandardOrRedirectionPaymentMethods = _paymentService .LoadActivePaymentMethods(_workContext.CurrentCustomer.Id) .Where(pm =&gt; pm.PaymentMethodType == PaymentMethodType.Standard || pm.PaymentMethodType == PaymentMethodType.Redirection) .ToList() .Count &gt; 0; model.DisplayCheckoutButton = !_orderSettings.TermsOfServiceEnabled &amp;&amp; checkoutAttributes.Count == 0 &amp;&amp; hasStandardOrRedirectionPaymentMethods; # 1. Put the similar logic into PrepareShoppingCartModel method and hide a button according to this value But there's one important issue. We use 'LoadActivePaymentMethods' method which accepts current customer. Maybe later, we (or somebody else) will add some a logic for restricting active payment methods based on a billing country of current customer. But we cannot know what billing address a customer will enter, and can accidentally hide 'Checkout' button in some cases.</DESCRIPTION>
  <REPONAME>nopCommerce</REPONAME>
  <TIMEDIFFERENCEDAYS>238</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>#1740 Added missing localization</MESSAGE>
    <SHA>fbf6a342b6aa431513af8a2997c9822c21a15a32</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>#903 We should not allow a customer to visit &quot;checkout&quot; page (hide it and appropriate buttons) if we have only &quot;Button&quot; payment methods (e.g. PayPal Express)</MESSAGE>
      <SHA>301d409f7afcd760e2db9bafabd31b19f8ed26c9</SHA>
      <PATCHEDFILES>
        <FILE>src/Presentation/Nop.Web/Controllers/CheckoutController.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Controllers/ShoppingCartController.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Models/ShoppingCart/ShoppingCartModel.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Views/ShoppingCart/OrderSummary.cshtml</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
