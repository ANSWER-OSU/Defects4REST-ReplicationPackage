<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>3701</ISSUENO>
  <ISSUEURL>https://github.com/nopSolutions/nopCommerce/issues/3701</ISSUEURL>
  <TITLE>Browser language isn't detected properly</TITLE>
  <DESCRIPTION>nopCommerce version: 4.10 Steps to reproduce the problem: Install 2 language EU and IT. Language display order doesn't matter here for me. Our website server is in Italy so they are using Italian culture on server. In previous version(nop 3.90) it was working fine. But in this version it works like below - When I visited our site from Italy it shows me website in Italian language - When I visited our site outside from Italy then also it shows site in Italian language. _This issue only happen when customer open site &amp; didn't login yet. After login it's showing site as per customer's choice language_ Under **GetLanguageFromRequest()** method while debugging using logger `var requestCulture = _httpContextAccessor.HttpContext.Features.Get&lt;IRequestCultureFeature&gt;()?.RequestCulture;` it gives culture = it-IT &amp; UI culture = en-US which might be wrong for me if I m visiting site from India with en-US culture set in Browser(chrome). so I follow up this link [https://stackoverflow.com/a/54877321](url) &amp; they suggested to use this &amp; it works fine now with our site. customers form Italy can see site in Italian by default and customer outside Italy can see site in English `var requestCulture = _httpContextAccessor.HttpContext.Request.GetTypedHeaders() .AcceptLanguage .OrderByDescending(x =&gt; x.Quality ?? 1) // Quality defines priority from 0 to 1, where 1 is the highest. .Select(x =&gt; x.Value.ToString()) .FirstOrDefault();` instead of this (your code) `var requestCulture = _httpContextAccessor.HttpContext.Features.Get&lt;IRequestCultureFeature&gt;()?.RequestCulture;`</DESCRIPTION>
  <REPONAME>nopCommerce</REPONAME>
  <TIMEDIFFERENCEDAYS>5</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>#75 DataTables. Removed extra comma from generated javascript code</MESSAGE>
    <SHA>8fa4c7381881e5c8be5d615797aebad7ff91c445</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>#3701 Add supported cultures to properly identify the request language</MESSAGE>
      <SHA>15f81830067a99baa6acef5f206d1c4e31b54d82</SHA>
      <PATCHEDFILES>
        <FILE>src/Presentation/Nop.Web.Framework/Infrastructure/Extensions/ApplicationBuilderExtensions.cs</FILE>
        <FILE>src/Presentation/Nop.Web.Framework/Infrastructure/NopCommonStartup.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#3701 #5242 Next changes to better identify the request language</MESSAGE>
      <SHA>6f1854087ae93edb774f6f31d937829d726e42b4</SHA>
      <PATCHEDFILES>
        <FILE>src/Libraries/Nop.Core/Domain/Customers/NopCustomerDefaults.cs</FILE>
        <FILE>src/Presentation/Nop.Web.Framework/Globalization/NopHeaderRequestCultureProvider.cs</FILE>
        <FILE>src/Presentation/Nop.Web.Framework/Globalization/NopRequestCultureProvider.cs</FILE>
        <FILE>src/Presentation/Nop.Web.Framework/Globalization/NopSeoUrlCultureProvider.cs</FILE>
        <FILE>src/Presentation/Nop.Web.Framework/Infrastructure/Extensions/ApplicationBuilderExtensions.cs</FILE>
        <FILE>src/Presentation/Nop.Web.Framework/Mvc/ModelBinding/NopResourceDisplayNameAttribute.cs</FILE>
        <FILE>src/Presentation/Nop.Web.Framework/Mvc/Razor/NopRazorPage.cs</FILE>
        <FILE>src/Presentation/Nop.Web.Framework/WebWorkContext.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Views/Shared/_AdminLayout.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Views/Shared/_AdminPopupLayout.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Views/_ViewImports.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Extensions/HtmlExtensions.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Themes/DefaultClean/Views/Shared/Head.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Themes/DefaultClean/Views/_ViewImports.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Shared/_Print.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Shared/_Root.Head.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/_ViewImports.cshtml</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#3701 #5242 Some refactoring of previous changes</MESSAGE>
      <SHA>0a19e1a0c54dc176805410fc303b920dd0ee1b38</SHA>
      <PATCHEDFILES>
        <FILE>src/Libraries/Nop.Core/Http/NopCookieDefaults.cs</FILE>
        <FILE>src/Presentation/Nop.Web.Framework/Globalization/NopHeaderRequestCultureProvider.cs</FILE>
        <FILE>src/Presentation/Nop.Web.Framework/Globalization/NopSeoUrlCultureProvider.cs</FILE>
        <FILE>src/Presentation/Nop.Web.Framework/Infrastructure/Extensions/ApplicationBuilderExtensions.cs</FILE>
        <FILE>src/Presentation/Nop.Web.Framework/Infrastructure/NopCommonStartup.cs</FILE>
        <FILE>src/Presentation/Nop.Web.Framework/Mvc/Razor/NopRazorPage.cs</FILE>
        <FILE>src/Presentation/Nop.Web.Framework/TagHelpers/Shared/NopDatePickerTagHelper.cs</FILE>
        <FILE>src/Presentation/Nop.Web.Framework/WebWorkContext.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Views/Customer/List.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Views/Shared/Table.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Views/Shared/_AdminLayout.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Views/Shared/_AdminPopupLayout.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Views/Shared/_Table.Definition.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Extensions/HtmlExtensions.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Themes/DefaultClean/Views/Shared/Head.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Checkout/_PickupPoints.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Product/_RentalInfo.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Shared/_Print.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Shared/_Root.Head.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/_ViewImports.cshtml</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
