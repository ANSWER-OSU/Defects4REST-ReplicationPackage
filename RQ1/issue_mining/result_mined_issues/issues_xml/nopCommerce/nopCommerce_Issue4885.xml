<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>4885</ISSUENO>
  <ISSUEURL>https://github.com/nopSolutions/nopCommerce/issues/4885</ISSUEURL>
  <TITLE>Schedule task stop automatically</TITLE>
  <DESCRIPTION>nopCommerce version: 4.20 &gt; What is happening is the scheduled tasks run, it makes the http post call to trigger send email task. This send email connects to SendGrid to send email, but this SMTP connection times out due to a network issue. When this times out it goes in the catch block trying to get the user context and then localize the &quot;Schedule.Timeouterror&quot; message to put in the log. This catch block is creating unhandled exception and causing the issue. &gt; Error in Timer Handler at Microsoft.AspNetCore.Authentication.AuthenticationHttpContextExtensions.AuthenticateAsync(HttpContext context, String scheme) &gt; at Nop.Services.Authentication.CookieAuthenticationService.GetAuthenticatedCustomer() in D:\GitProject\musictribec2c\Source\Libraries\Nop.Services\Authentication\CookieAuthenticationService.cs:line 101 &gt; at Nop.Web.Framework.WebWorkContext.get_CurrentCustomer() in D:\GitProject\musictribec2c\Source\Presentation\Nop.Web.Framework\WebWorkContext.cs:line 211 &gt; at Nop.Web.Framework.WebWorkContext.get_WorkingLanguage() in D:\GitProject\musictribec2c\Source\Presentation\Nop.Web.Framework\WebWorkContext.cs:line 360 &gt; at Nop.Services.Localization.LocalizationService.GetResource(String resourceKey) in D:\GitProject\musictribec2c\Source\Libraries\Nop.Services\Localization\LocalizationService.cs:line 311 &gt; at Nop.Services.Tasks.TaskThread.Run() in D:\GitProject\musictribec2c\Source\Libraries\Nop.Services\Tasks\TaskThread.cs:line 95 &gt; at Nop.Services.Tasks.TaskThread.TimerHandler(Object state) in D:\GitProject\musictribec2c\Source\Libraries\Nop.Services\Tasks\TaskThread.cs:line 119Object reference not set to an instance of an object. Source: PS-15494</DESCRIPTION>
  <REPONAME>nopCommerce</REPONAME>
  <TIMEDIFFERENCEDAYS>99</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Updated UTMs</MESSAGE>
    <SHA>597a2df22f03bf4509f36c4160caa45f3ad8b37b</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>#4885 Schedule task stop automatically</MESSAGE>
      <SHA>575ce2d9935e266229acc0632625b4d0cbdeb6ef</SHA>
      <PATCHEDFILES>
        <FILE>src/Libraries/Nop.Services/Tasks/TaskThread.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
