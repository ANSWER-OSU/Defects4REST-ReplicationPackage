<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>3633</ISSUENO>
  <ISSUEURL>https://github.com/nopSolutions/nopCommerce/issues/3633</ISSUEURL>
  <TITLE>Tier prices cannot be updated</TITLE>
  <DESCRIPTION>nopCommerce version: 4.20 BETA Steps to reproduce the problem: 1. Add a tier price to a product 2. Try to udpate it You'll get the following exception: SqlException: The UPDATE statement conflicted with the FOREIGN KEY constraint &quot;FK_TierPrice_Product_ProductId&quot;. The conflict occurred in database &quot;dev-nopCommerce&quot;, table &quot;dbo.Product&quot;, column 'Id'. The statement has been terminated. System.Data.SqlClient.SqlConnection.OnError(SqlException exception, bool breakConnection, Action&lt;Action&gt; wrapCloseInAction) DbUpdateException: An error occurred while updating the entries. See the inner exception for details. Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.Execute(IRelationalConnection connection) Exception: Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details. ---&gt; System.Data.SqlClient.SqlException: The UPDATE statement conflicted with the FOREIGN KEY constraint &quot;FK_TierPrice_Product_ProductId&quot;. The conflict occurred in database &quot;dev-nopCommerce&quot;, table &quot;dbo.Product&quot;, column 'Id'. The statement has been terminated.</DESCRIPTION>
  <REPONAME>nopCommerce</REPONAME>
  <TIMEDIFFERENCEDAYS>16</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>#3466 Reduced the number of locks when calling the PageHeadBuilder.GenerateCssFiles method</MESSAGE>
    <SHA>24fbc35df15e1c52787f35032e0d8f028d93bb59</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>#3633 Fixed problem with updating tier prices</MESSAGE>
      <SHA>2e4dd609701b6658dd00910debcc4f11e2b764d7</SHA>
      <PATCHEDFILES>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Views/Product/_CreateOrUpdateTierPrice.cshtml</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#3633 Other way to fix the issue when updating tier prices</MESSAGE>
      <SHA>63632b273eb40a995ef885b1c736a3e56ded5c18</SHA>
      <PATCHEDFILES>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Controllers/ProductController.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Infrastructure/Mapper/AdminMapperConfiguration.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Views/Product/_CreateOrUpdateTierPrice.cshtml</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
