<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>6102</ISSUENO>
  <ISSUEURL>https://github.com/nopSolutions/nopCommerce/issues/6102</ISSUEURL>
  <TITLE>Plugin reload issue with shadow copy disabled</TITLE>
  <DESCRIPTION>nopCommerce version: 4.40+ Steps to reproduce the problem: Just to follow up on the scenario above when &quot;UsePluginsShadowCopy&quot; is disabled and you try to upload a plugin's package and don't have permissions to delete the dll file of the plugin. If you got this error &quot;&quot;Access to the path 'Nop.Plugin.Feed.GoogleShopping.dll' is denied.&quot; in the administration, although the site seems to be working in the beginning, actually the uploaded plugin's folder is corrupted. All files and folders inside the plugin will be deleted i.e Views, Content, plugin.json etc. except the dll file that was left because of the access error above. In other words if you use this functionality and you don't have permissions then this would corrupt the installation and you end up with broken plugins. Maybe you should improve the upload plugin functionality by trying to delete the plugin's dll file first and if it is not successful then do not delete the rest of the files thus not corrupting the original plugin. If the dll file is deleted successfully then you can go ahead and delete the other files of the plugin. See details on [this post](https://www.nopcommerce.com/en/boards/topic/92668/nopcommerce-450-suggestions-bug-reports-and-improvements/page/3#292278)</DESCRIPTION>
  <REPONAME>nopCommerce</REPONAME>
  <TIMEDIFFERENCEDAYS>49</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>#6150 Fixed sorting by name issue (cherry picked from commit 541628df7f526f0690c3b61ef1a1bf7635b0a2bf)</MESSAGE>
    <SHA>e2487cc378bc10de6b2d14d637178c0b64a51daa</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>#6102. Refactoring of plugin system</MESSAGE>
      <SHA>ecb046566badfc11ce9aff438f9dbd8caf128698</SHA>
      <PATCHEDFILES>
        <FILE>src/Libraries/Nop.Core/Configuration/PluginConfig.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Plugins/IPluginsInfo.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Plugins/NopPluginDefaults.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Plugins/PluginDescriptor.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Plugins/PluginService.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Plugins/PluginsInfo.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Plugins/UploadService.cs</FILE>
        <FILE>src/Presentation/Nop.Web.Framework/Infrastructure/Extensions/ApplicationPartManagerExtensions.cs</FILE>
        <FILE>src/Presentation/Nop.Web.Framework/Migrations/UpgradeTo460/LocalizationMigration.cs</FILE>
        <FILE>src/Presentation/Nop.Web/App_Data/Localization/defaultResources.nopres.xml</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Controllers/PluginController.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Models/Settings/PluginConfigModel.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Views/Setting/_AppSettings.Plugin.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Nop.Web.csproj</FILE>
        <FILE>src/Presentation/Nop.Web/Plugins/bin/placeholder.txt</FILE>
        <FILE>src/Tests/Nop.Tests/Nop.Services.Tests/ServiceTest.cs</FILE>
        <FILE>src/Tests/Nop.Tests/Nop.Web.Tests/WebTest.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#6102 Deleted merge commits</MESSAGE>
      <SHA>63c22b582def29856e96d518b31a8fef2db006b7</SHA>
      <PATCHEDFILES>
        <FILE>src/Presentation/Nop.Web.Framework/Migrations/UpgradeTo460/LocalizationMigration.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#6102 Fixed problem on clean installation process</MESSAGE>
      <SHA>031d103a21e0c08b75348e99684ed255cd5ba976</SHA>
      <PATCHEDFILES>
        <FILE>src/Libraries/Nop.Services/Plugins/IPluginsInfo.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Plugins/PluginsInfo.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
