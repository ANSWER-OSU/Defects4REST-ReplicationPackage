<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>3520</ISSUENO>
  <ISSUEURL>https://github.com/nopSolutions/nopCommerce/issues/3520</ISSUEURL>
  <TITLE>Redundant fetch of child categories</TITLE>
  <DESCRIPTION>nopCommerce version: Dev Steps to reproduce the problem: ... I think this [statement](https://github.com/nopSolutions/nopCommerce/blob/develop/src/Presentation/Nop.Web/Factories/CatalogModelFactory.cs#L457) is redundant: ``` if (_catalogSettings.ShowProductsFromSubcategories) { //include subcategories categoryIds.AddRange(_categoryService.GetChildCategoryIds(category.Id, _storeContext.CurrentStore.Id)); } ``` We already have a list of [subcategories](https://github.com/nopSolutions/nopCommerce/blob/develop/src/Presentation/Nop.Web/Factories/CatalogModelFactory.cs#L386): ``` model.SubCategories = _cacheManager.Get(subCategoriesCacheKey, () =&gt; _categoryService.GetAllCategoriesByParentCategoryId(category.Id) .Select(x =&gt; { var subCatModel = new CategoryModel.SubCategoryModel { Id = x.Id, Name = _localizationService.GetLocalized(x, y =&gt; y.Name), SeName = _urlRecordService.GetSeName(x), Description = _localizationService.GetLocalized(x, y =&gt; y.Description) }; //prepare picture model var categoryPictureCacheKey = string.Format(NopModelCacheDefaults.CategoryPictureModelKey, x.Id, pictureSize, true, _workContext.WorkingLanguage.Id, _webHelper.IsCurrentConnectionSecured(), _storeContext.CurrentStore.Id); subCatModel.PictureModel = _cacheManager.Get(categoryPictureCacheKey, () =&gt; { var picture = _pictureService.GetPictureById(x.PictureId); var pictureModel = new PictureModel { FullSizeImageUrl = _pictureService.GetPictureUrl(picture), ImageUrl = _pictureService.GetPictureUrl(picture, pictureSize), Title = string.Format(_localizationService.GetResource(&quot;Media.Category.ImageLinkTitleFormat&quot;), subCatModel.Name), AlternateText = string.Format(_localizationService.GetResource(&quot;Media.Category.ImageAlternateTextFormat&quot;), subCatModel.Name) }; return pictureModel; }); return subCatModel; }) .ToList() ); ```</DESCRIPTION>
  <REPONAME>nopCommerce</REPONAME>
  <TIMEDIFFERENCEDAYS>416</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Fixed problem with caching the NULL value</MESSAGE>
    <SHA>6738acd1cafa73da8044180fd45f1e84c32dc45f</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>#3520 Removed redundant fetch of child categories</MESSAGE>
      <SHA>a6bb4bd99daaa685adbf6ef2a105b52435db9deb</SHA>
      <PATCHEDFILES>
        <FILE>src/Presentation/Nop.Web/Factories/CatalogModelFactory.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
