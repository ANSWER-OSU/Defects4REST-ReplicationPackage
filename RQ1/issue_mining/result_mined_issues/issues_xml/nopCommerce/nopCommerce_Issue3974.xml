<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>3974</ISSUENO>
  <ISSUEURL>https://github.com/nopSolutions/nopCommerce/issues/3974</ISSUEURL>
  <TITLE>Unable to upload plugin/theme zip file that created by Windows compression feature</TITLE>
  <DESCRIPTION>nopCommerce version: 4.20 Nop throws error &quot;The archive should contain only one root plugin or theme directory. For example, Payments.PayPalDirect or DefaultClean. To upload multiple items, the archive should have the 'uploadedItems.json' file in the root&quot; and the zip file cannot be uploaded.&quot; when uploading zip file of theme/plugin that had been created using Window default compression feature. Steps to reproduce the problem: - Copy the default template folder - Zip the folder as it is by using the &quot;Send to - Compressed (zipped) folder&quot; within Windows. (Tested on latest Windows 10). - Upload the zip file and Nop will throw the error despite the theme folder structure is correct. After doing some research, I have found some discrepancies in the zip file structure that created by Windows and by other zip program and because of the logic that check for the root folder in the zip file within Nop, it will throws the error even though the folder layout is correct. If you compare the two zip files, one is created by the built-in Windows feature and one by other software (for example, I used 7-Zip and Winrar), the Window zip file is missing the name of the root folder in the first few bytes. Hence, during the uploading process, Nop will use this below code in UploadService.cs to check for root folder name and will throw the error because it is missing: ``` protected virtual IDescriptor UploadSingleItem(string archivePath) { // Other code var rootDirectories = archive.Entries.Where(entry =&gt; entry.FullName.Count(ch =&gt; ch == '/') == 1 &amp;&amp; entry.FullName.EndsWith(&quot;/&quot;)).ToList(); // Line 88 // Other code } ```</DESCRIPTION>
  <REPONAME>nopCommerce</REPONAME>
  <TIMEDIFFERENCEDAYS>119</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>#3984 Add order authorized event</MESSAGE>
    <SHA>59fe7274aa71389593d584b9011c74da69f9d88b</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>#3974 Fixed problem with uploading plugin/theme zip file that created by Windows compression feature</MESSAGE>
      <SHA>be8cb252bb8350e1a5cb2508eb94eef72640b76f</SHA>
      <PATCHEDFILES>
        <FILE>src/Libraries/Nop.Services/Plugins/UploadService.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
