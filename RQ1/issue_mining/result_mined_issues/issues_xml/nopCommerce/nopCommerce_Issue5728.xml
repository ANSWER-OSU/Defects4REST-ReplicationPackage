<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>5728</ISSUENO>
  <ISSUEURL>https://github.com/nopSolutions/nopCommerce/issues/5728</ISSUEURL>
  <TITLE>Mysql exception: Expression #1 of ORDER BY clause is not in SELECT list, references column 'dbName.item.CreatedOnUtc' which is not in SELECT list; this is incompatible with DISTINCT</TITLE>
  <DESCRIPTION>nopCommerce version: 4.40.3 Steps to reproduce the problem: Just go to /Admin/ShoppingCart/CurrentCarts Full Exception: `MySql.Data.MySqlClient.MySqlException (0x80004005): Expression #1 of ORDER BY clause is not in SELECT list, references column 'dbName.item.CreatedOnUtc' which is not in SELECT list; this is incompatible with DISTINCT at MySql.Data.MySqlClient.MySqlStream.ReadPacket() at MySql.Data.MySqlClient.NativeDriver.GetResult(Int32&amp; affectedRow, Int64&amp; insertedId) at MySql.Data.MySqlClient.Driver.NextResult(Int32 statementId, Boolean force) at MySql.Data.MySqlClient.MySqlDataReader.NextResult() at MySql.Data.MySqlClient.MySqlCommand.ExecuteReader(CommandBehavior behavior) at System.Data.Common.DbCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) --- End of stack trace from previous location --- at LinqToDB.Data.DataConnection.ExecuteReaderAsync(CommandBehavior commandBehavior, CancellationToken cancellationToken) at LinqToDB.Data.DataConnection.QueryRunner.ExecuteReaderAsync(CancellationToken cancellationToken) at LinqToDB.Linq.QueryRunner.ExecuteElementAsync[T](Query query, IDataContext dataContext, Mapper`1 mapper, Expression expression, Object[] ps, Object[] preambles, CancellationToken cancellationToken) at LinqToDB.Linq.ExpressionQuery`1.LinqToDB.Async.IQueryProviderAsync.ExecuteAsync[TResult](Expression expression, CancellationToken cancellationToken) at System.Linq.AsyncIQueryableExtensions.ToPagedListAsync[T](IQueryable`1 source, Int32 pageIndex, Int32 pageSize, Boolean getOnlyTotalCount) in /home/***hide-my-info***/src/Libraries/Nop.Data/Extensions/AsyncIQueryableExtensions.cs:line 657 at Nop.Services.Customers.CustomerService.GetCustomersWithShoppingCartsAsync(Nullable`1 shoppingCartType, Int32 storeId, Nullable`1 productId, Nullable`1 createdFromUtc, Nullable`1 createdToUtc, Nullable`1 countryId, Int32 pageIndex, Int32 pageSize) in /home/***hide-my-info***/src/Libraries/Nop.Services/Customers/CustomerService.cs:line 373 at Nop.Web.Areas.Admin.Factories.ShoppingCartModelFactory.PrepareShoppingCartListModelAsync(ShoppingCartSearchModel searchModel) in /home/***hide-my-info***/src/Presentation/Nop.Web/Areas/Admin/Factories/ShoppingCartModelFactory.cs:line 150 at Nop.Web.Areas.Admin.Controllers.ShoppingCartController.CurrentCarts(ShoppingCartSearchModel searchModel) in /home/***hide-my-info***/src/Presentation/Nop.Web/Areas/Admin/Controllers/ShoppingCartController.cs:line 58 at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments) at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.&lt;InvokeActionMethodAsync&gt;g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask) at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.&lt;InvokeNextActionFilterAsync&gt;g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted) at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context) at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State&amp; next, Scope&amp; scope, Object&amp; state, Boolean&amp; isCompleted) at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync() --- End of stack trace from previous location --- at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.&lt;InvokeNextResourceFilter&gt;g__Awaited|24_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted) at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResourceExecutedContextSealed context) at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Next(State&amp; next, Scope&amp; scope, Object&amp; state, Boolean&amp; isCompleted) at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.InvokeFilterPipelineAsync() --- End of stack trace from previous location --- at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.&lt;InvokeAsync&gt;g__Logged|17_1(ResourceInvoker invoker) at Microsoft.AspNetCore.Routing.EndpointMiddleware.&lt;Invoke&gt;g__AwaitRequestTask|6_0(Endpoint endpoint, Task requestTask, ILogger logger) at WebMarkupMin.AspNetCore5.WebMarkupMinMiddleware.ProcessAsync(HttpContext context, Boolean useMinification, Boolean useCompression) at WebMarkupMin.AspNetCore5.WebMarkupMinMiddleware.ProcessAsync(HttpContext context, Boolean useMinification, Boolean useCompression) at WebMarkupMin.AspNetCore5.WebMarkupMinMiddlewareBase.Invoke(HttpContext context) at StackExchange.Profiling.MiniProfilerMiddleware.Invoke(HttpContext context) in C:\projects\dotnet\src\MiniProfiler.AspNetCore\MiniProfilerMiddleware.cs:line 125 at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context) at Nop.Services.Authentication.AuthenticationMiddleware.InvokeAsync(HttpContext context) in /home/***hide-my-info***/src/Libraries/Nop.Services/Authentication/AuthenticationMiddleware.cs:line 94 at Microsoft.AspNetCore.Localization.RequestLocalizationMiddleware.Invoke(HttpContext context) at Microsoft.AspNetCore.Session.SessionMiddleware.Invoke(HttpContext context) at Microsoft.AspNetCore.Session.SessionMiddleware.Invoke(HttpContext context) at Nop.Services.Installation.InstallUrlMiddleware.InvokeAsync(HttpContext context, IWebHelper webHelper) in /home/***hide-my-info***/src/Libraries/Nop.Services/Installation/InstallUrlMiddleware.cs:line 53 at Nop.Services.Common.KeepAliveMiddleware.InvokeAsync(HttpContext context, IWebHelper webHelper) in /home/***hide-my-info***/src/Libraries/Nop.Services/Common/KeepAliveMiddleware.cs:line 50 at Microsoft.AspNetCore.ResponseCompression.ResponseCompressionMiddleware.Invoke(HttpContext context) at Microsoft.AspNetCore.Diagnostics.StatusCodePagesMiddleware.Invoke(HttpContext context) at Microsoft.AspNetCore.Diagnostics.StatusCodePagesMiddleware.Invoke(HttpContext context) at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddleware.&lt;Invoke&gt;g__Awaited|6_0(ExceptionHandlerMiddleware middleware, HttpContext context, Task task)`</DESCRIPTION>
  <REPONAME>nopCommerce</REPONAME>
  <TIMEDIFFERENCEDAYS>5</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>#5636 Fixed access to protected popup topic</MESSAGE>
    <SHA>c77f58edaeab23e492582a83cfe2aed323359a4a</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>#5728 Added workaround to avoid problems with the ONLY_FULL_GROUP_BY (MySQL engine)</MESSAGE>
      <SHA>3e09a8305d220a4893dfd00010a444e35745502e</SHA>
      <PATCHEDFILES>
        <FILE>src/Libraries/Nop.Services/Customers/CustomerService.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#5728: Fix Author in plugin.json</MESSAGE>
      <SHA>f32f743e7621773f0bbe8cddee259e68bc2687d6</SHA>
      <PATCHEDFILES>
        <FILE>src/Plugins/Nop.Plugin.ExternalAuth.OAuth/Controllers/OAuthAuthenticationController.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.ExternalAuth.OAuth/plugin.json</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
