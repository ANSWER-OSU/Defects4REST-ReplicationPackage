<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>7584</ISSUENO>
  <ISSUEURL>https://github.com/nopSolutions/nopCommerce/issues/7584</ISSUEURL>
  <TITLE>Avalara tax plugin. Error when address value was incomplete</TITLE>
  <DESCRIPTION>&gt; If the customer doesn't provide the full address then the Avalara API returns the error message. &gt; &gt; Tax.Avalara error. InvalidAddress - The address value was incomplete. &gt; Details: The address value ShipTo was incomplete. You must provide either a valid postal code, line1 + city + region, or line1 + postal code. &gt; &gt; Could you add this checking in the method? &gt; I added checking &quot;line1 + postal code + city&quot;. &gt; The Postal code is mandatory, when I provided the city without line 1 then I got error message. &gt; &gt; ``` &gt; public async Task&lt;TaxRateResult&gt; GetTaxRateAsync(TaxRateRequest taxRateRequest) &gt; { &gt; if (taxRateRequest.Address == null) &gt; return new TaxRateResult { Errors = new List&lt;string&gt; { &quot;Address is not set&quot; } }; &gt; &gt; //You must provide either a valid postal code, line1 + city + region, or line1 + postal code. &gt; if (string.IsNullOrWhiteSpace(taxRateRequest.Address.ZipPostalCode) &gt; || string.IsNullOrWhiteSpace(taxRateRequest.Address.City) &gt; || string.IsNullOrWhiteSpace(taxRateRequest.Address.Address1) &gt; ) &gt; return new TaxRateResult { Errors = new List&lt;string&gt; { &quot;Address is not set&quot; } }; &gt; &gt; //get tax rate &gt; var taxRate = await _avalaraTaxManager.GetTaxRateAsync(taxRateRequest); &gt; if (!taxRate.HasValue) &gt; return new TaxRateResult { Errors = new List&lt;string&gt; { &quot;No response from the service&quot; } }; &gt; &gt; return new TaxRateResult { TaxRate = taxRate.Value }; &gt; } &gt; ``` Source: https://www.nopcommerce.com/boards/topic/101847/avalara-tax-provider</DESCRIPTION>
  <REPONAME>nopCommerce</REPONAME>
  <TIMEDIFFERENCEDAYS>71</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>#1266 OrderHistoryPeriods moved to Nop.Core.Domain.Orders</MESSAGE>
    <SHA>849eb2c5b7f3e7991d436681bda3232b3ba92679</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>#7584 Avalara tax plugin. Don't try to create a transaction if address is incomplete</MESSAGE>
      <SHA>6282ffd174b5ba664955c40f98641d5649be1d83</SHA>
      <PATCHEDFILES>
        <FILE>src/Plugins/Nop.Plugin.Tax.Avalara/AvalaraTaxProvider.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Tax.Avalara/Components/AddressValidationViewComponent.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Tax.Avalara/Services/AvalaraTaxManager.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Tax.Avalara/plugin.json</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
