<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>4331</ISSUENO>
  <ISSUEURL>https://github.com/nopSolutions/nopCommerce/issues/4331</ISSUEURL>
  <TITLE>an infinite loop in a stored procedure when using full-text search</TITLE>
  <DESCRIPTION>nopCommerce version: 4.20 Steps to reproduce the problem: Firstly, full-text search should be enabled from the **General settings** page or by executing the **FullText_Enable** stored procedure. Next step would be to make sure that the following configuration settings are: - UseFullTextSearch = `True` (Database table `Setting`, row `Name = commonsettings.usefulltextsearch`) - FullTextMode = `And` (Database table `Setting`, row `Name = commonsettings.fulltextmode`) In a website search enter the following text: `product &quot;` and hit an enter. The most important part here is that the search term must end with a whitespace and a quotation mark to reproduce the problem. In a stored procedure `ProductLoadAllPaged` the quotation mark gets removed and the search is being performed with a keyword `product` and a trailing whitespace which results in an infinite loop inside the stored procedure and crazy large log message which fails to load in an administration page.</DESCRIPTION>
  <REPONAME>nopCommerce</REPONAME>
  <TIMEDIFFERENCEDAYS>2</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Added missing filtering for shipments by OrderId</MESSAGE>
    <SHA>d6a890fb0648bb8133a86fb6f7f0140d1b06c251</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>#4326, #4331 Fix full text search in ProductLoadAllPaged storage procedure</MESSAGE>
      <SHA>b3cae37506db18b3f431e7443c9155fb85ff984c</SHA>
      <PATCHEDFILES>
        <FILE>src/Presentation/Nop.Web/App_Data/Install/SqlServer.StoredProcedures.sql</FILE>
        <FILE>upgradescripts/4.20-4.30 (under development)/upgrade.sql</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
