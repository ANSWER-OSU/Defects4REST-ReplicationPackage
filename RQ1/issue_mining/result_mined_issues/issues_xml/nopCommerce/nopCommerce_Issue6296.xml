<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>6296</ISSUENO>
  <ISSUEURL>https://github.com/nopSolutions/nopCommerce/issues/6296</ISSUEURL>
  <TITLE>&quot;Sales summary&quot; report. User time of dates</TITLE>
  <DESCRIPTION>&gt; 1. NOP Commerce version: 4.50.2 &gt; &gt; 2. Expected behaviour: The numbers of orders listed in the two reports should match &gt; &gt; 3. Actual behaviour: Sales &gt; Orders and Reports reflects server time, whereas Reports &gt; Sales Summary uses UTC time (and also includes a line for the day before the selected start date if there were orders when the order date/time UTC was before midnight and server time was the next day. &gt; &gt; Example: &gt; &gt; In the UK we are now on summer time (UTC+1 hour) which is also the server time. &gt; &gt; The CreatedOnUtc time on the Order table is UTC(+0) as expected. &gt; &gt; Sales &gt; Orders shows the summer time against each order, and when filtering on the Start and End dates, will include orders based on summer time. &gt; &gt; However, Reports &gt; Sales Summary uses the UTC time. &gt; &gt; Therefore, when there are orders placed between UTC 23:00:00 and 23:59:59, there is a discrepancy in order numbers between the above two facilities because the orders are included/counted on different days. &gt; &gt; In addition, in Reports &gt; Sales Summary, when selecting a date range, if on the day before the &quot;Start date&quot; there were orders placed between UTC 23:00:00 and 23:59:59, the report will include a line for that date including the totals only for any late-night orders, when that date was not required. &gt; &gt; E.g. in Reports &gt; Sales Summary I ran a report with date range 20/06/2022 to 22/06/2022, but it also shows 4 orders on 19/06/2022 (all 4 were raised UTC 23:00:00-23:59:59 on that date - it has not counted other orders from earlier that day, so that day's figures are also incorrect). &gt; &gt; Reports &gt; Sales Summary should base its results on the server time as the orders page does this. &gt; &gt; NB. In System &gt; System Information, our &quot;Server time zone&quot; is &quot;GMT Standard Time&quot;, and the &quot;Server local time&quot; and &quot;Current user time&quot; correctly reflects this (i.e. UTC+1), and &quot;Coordinated Universal Time (UTC)&quot; correctly shows the UTC time. In Configuration &gt; Settings &gt; Customer Settings, we are on UTC+00:00 Source: https://www.nopcommerce.com/boards/topic/94524/discrepancy-between-order-numbers-in-sales-orders-and-reports-sales-summary On the order list page: get user date → convert to UTC date → get data from db by UTC date → convert data date to user date → display data. This smoothly works since the date is only used here for display. In reports: get user date → convert to UTC date → use UTC date in db query (grouping, calculations, etc) → get data from db → display data. In this case, the data is returned and displayed without reverse conversion of the date. So, should we change queries and use user dates or leave it as is and maybe show a warning that reports are generated for UTC dates?</DESCRIPTION>
  <REPONAME>nopCommerce</REPONAME>
  <TIMEDIFFERENCEDAYS>36</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge branch 'issue-4591-Two-stages-enable-SSL' into develop # Conflicts: # src/Presentation/Nop.Web.Framework/Migrations/UpgradeTo460/LocalizationMigration.cs</MESSAGE>
    <SHA>6f3c8b847128890020a3efb1c94f365f4f46cd0d</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>#6296 Fixed sorting and filtering by date in the sales summary report</MESSAGE>
      <SHA>c9427761b045382f4762fca044a17f664cfca65f</SHA>
      <PATCHEDFILES>
        <FILE>src/Libraries/Nop.Core/Domain/Orders/SalesSummaryReportLine.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Orders/OrderReportService.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
