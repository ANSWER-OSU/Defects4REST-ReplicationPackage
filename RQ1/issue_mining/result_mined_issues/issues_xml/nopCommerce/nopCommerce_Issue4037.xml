<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>4037</ISSUENO>
  <ISSUEURL>https://github.com/nopSolutions/nopCommerce/issues/4037</ISSUEURL>
  <TITLE>.UseKestrel is limiting and not aligned with aspnetcore22+</TITLE>
  <DESCRIPTION>nopCommerce version: 4.2 Steps to reproduce the problem: This (I believe) forces the application to use Kestrel (or at least Break ANCM startup in some scenarios, such as inprocess operation) var host = WebHost.CreateDefaultBuilder(args) **.UseKestrel(options =&gt; options.AddServerHeader = false)** .UseStartup&lt;Startup&gt;() According to the doco - the &quot;Kestrel vs IIS&quot; setup is &quot;intelligently&quot; already done in .CreateDefaultBuilder() and the &quot;addserverheader = false should be done in &quot;.ConfigureKestrel()&quot; https://docs.microsoft.com/en-us/aspnet/core/fundamentals/servers/index?view=aspnetcore-2.2&amp;tabs=windows#in-process-hosting-model https://docs.microsoft.com/en-us/aspnet/core/migration/21-to-22?view=aspnetcore-2.2&amp;tabs=visual-studio The current setup appears to be against the 2.2 migration advice and limits the application to ONLY outofprocess operation. There may be reasons that you have done this, but if not then this appears to me/my reading to be unnecessarily restrictive (eg: prohibiting performance gains from using IIS directly on windows). Additionally I note that there is a note on the web.config element to delay &quot;AspNetCoreModeuleV2&quot; until moving to 3.0, and I don't know if the decision to roll this back has anything to do with this, but its worth noting here, in case there is some insider knowledge that has an impact here.</DESCRIPTION>
  <REPONAME>nopCommerce</REPONAME>
  <TIMEDIFFERENCEDAYS>210</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Clear cache only once.</MESSAGE>
    <SHA>3873bc2b5f70131bef1c89a8632161a17747ce41</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Moved to IIS inprocess default. Fixes. https://github.com/nopSolutions/nopCommerce/issues/4037 Fixed version specific dependency on ASP.NET core. See https://github.com/dotnet/sdk/issues/2253</MESSAGE>
      <SHA>e64eb5479c0bda53f3abeaba686e0418a8e64e76</SHA>
      <PATCHEDFILES>
        <FILE>src/Libraries/Nop.Core/Nop.Core.csproj</FILE>
        <FILE>src/Libraries/Nop.Data/Nop.Data.csproj</FILE>
        <FILE>src/Libraries/Nop.Services/Nop.Services.csproj</FILE>
        <FILE>src/Plugins/Nop.Plugin.DiscountRules.CustomerRoles/Nop.Plugin.DiscountRules.CustomerRoles.csproj</FILE>
        <FILE>src/Plugins/Nop.Plugin.ExchangeRate.EcbExchange/Nop.Plugin.ExchangeRate.EcbExchange.csproj</FILE>
        <FILE>src/Plugins/Nop.Plugin.ExternalAuth.Facebook/Nop.Plugin.ExternalAuth.Facebook.csproj</FILE>
        <FILE>src/Plugins/Nop.Plugin.Misc.SendinBlue/Nop.Plugin.Misc.SendinBlue.csproj</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.CheckMoneyOrder/Nop.Plugin.Payments.CheckMoneyOrder.csproj</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.Manual/Nop.Plugin.Payments.Manual.csproj</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.PayPalStandard/Nop.Plugin.Payments.PayPalStandard.csproj</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.Qualpay/Nop.Plugin.Payments.Qualpay.csproj</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.Square/Nop.Plugin.Payments.Square.csproj</FILE>
        <FILE>src/Plugins/Nop.Plugin.Pickup.PickupInStore/Nop.Plugin.Pickup.PickupInStore.csproj</FILE>
        <FILE>src/Plugins/Nop.Plugin.Shipping.FixedByWeightByTotal/Nop.Plugin.Shipping.FixedByWeightByTotal.csproj</FILE>
        <FILE>src/Plugins/Nop.Plugin.Shipping.UPS/Nop.Plugin.Shipping.UPS.csproj</FILE>
        <FILE>src/Plugins/Nop.Plugin.Tax.Avalara/Nop.Plugin.Tax.Avalara.csproj</FILE>
        <FILE>src/Plugins/Nop.Plugin.Tax.FixedOrByCountryStateZip/Nop.Plugin.Tax.FixedOrByCountryStateZip.csproj</FILE>
        <FILE>src/Plugins/Nop.Plugin.Widgets.GoogleAnalytics/Nop.Plugin.Widgets.GoogleAnalytics.csproj</FILE>
        <FILE>src/Plugins/Nop.Plugin.Widgets.NivoSlider/Nop.Plugin.Widgets.NivoSlider.csproj</FILE>
        <FILE>src/Presentation/Nop.Web.Framework/Nop.Web.Framework.csproj</FILE>
        <FILE>src/Presentation/Nop.Web/Nop.Web.csproj</FILE>
        <FILE>src/Presentation/Nop.Web/Program.cs</FILE>
        <FILE>src/Presentation/Nop.Web/web.config</FILE>
        <FILE>src/Tests/Nop.Core.Tests/Nop.Core.Tests.csproj</FILE>
        <FILE>src/Tests/Nop.Services.Tests/Nop.Services.Tests.csproj</FILE>
        <FILE>src/Tests/Nop.Tests/Nop.Tests.csproj</FILE>
        <FILE>src/Tests/Nop.Web.MVC.Tests/Nop.Web.MVC.Tests.csproj</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Moved to IIS inprocess default. Fixes. https://github.com/nopSolutions/nopCommerce/issues/4037 Fixed version specific dependency on ASP.NET core. See https://github.com/dotnet/sdk/issues/2253</MESSAGE>
      <SHA>b3b2608908d9acf28fd89777173a5072c989da1a</SHA>
      <PATCHEDFILES>
        <FILE>src/Libraries/Nop.Core/Nop.Core.csproj</FILE>
        <FILE>src/Libraries/Nop.Data/Nop.Data.csproj</FILE>
        <FILE>src/Libraries/Nop.Services/Nop.Services.csproj</FILE>
        <FILE>src/Plugins/Nop.Plugin.DiscountRules.CustomerRoles/Nop.Plugin.DiscountRules.CustomerRoles.csproj</FILE>
        <FILE>src/Plugins/Nop.Plugin.ExchangeRate.EcbExchange/Nop.Plugin.ExchangeRate.EcbExchange.csproj</FILE>
        <FILE>src/Plugins/Nop.Plugin.ExternalAuth.Facebook/Nop.Plugin.ExternalAuth.Facebook.csproj</FILE>
        <FILE>src/Plugins/Nop.Plugin.Misc.SendinBlue/Nop.Plugin.Misc.SendinBlue.csproj</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.CheckMoneyOrder/Nop.Plugin.Payments.CheckMoneyOrder.csproj</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.Manual/Nop.Plugin.Payments.Manual.csproj</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.PayPalStandard/Nop.Plugin.Payments.PayPalStandard.csproj</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.Qualpay/Nop.Plugin.Payments.Qualpay.csproj</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.Square/Nop.Plugin.Payments.Square.csproj</FILE>
        <FILE>src/Plugins/Nop.Plugin.Pickup.PickupInStore/Nop.Plugin.Pickup.PickupInStore.csproj</FILE>
        <FILE>src/Plugins/Nop.Plugin.Shipping.FixedByWeightByTotal/Nop.Plugin.Shipping.FixedByWeightByTotal.csproj</FILE>
        <FILE>src/Plugins/Nop.Plugin.Shipping.UPS/Nop.Plugin.Shipping.UPS.csproj</FILE>
        <FILE>src/Plugins/Nop.Plugin.Tax.Avalara/Nop.Plugin.Tax.Avalara.csproj</FILE>
        <FILE>src/Plugins/Nop.Plugin.Tax.FixedOrByCountryStateZip/Nop.Plugin.Tax.FixedOrByCountryStateZip.csproj</FILE>
        <FILE>src/Plugins/Nop.Plugin.Widgets.GoogleAnalytics/Nop.Plugin.Widgets.GoogleAnalytics.csproj</FILE>
        <FILE>src/Plugins/Nop.Plugin.Widgets.NivoSlider/Nop.Plugin.Widgets.NivoSlider.csproj</FILE>
        <FILE>src/Presentation/Nop.Web.Framework/Nop.Web.Framework.csproj</FILE>
        <FILE>src/Presentation/Nop.Web/Nop.Web.csproj</FILE>
        <FILE>src/Presentation/Nop.Web/Program.cs</FILE>
        <FILE>src/Presentation/Nop.Web/web.config</FILE>
        <FILE>src/Tests/Nop.Core.Tests/Nop.Core.Tests.csproj</FILE>
        <FILE>src/Tests/Nop.Services.Tests/Nop.Services.Tests.csproj</FILE>
        <FILE>src/Tests/Nop.Tests/Nop.Tests.csproj</FILE>
        <FILE>src/Tests/Nop.Web.MVC.Tests/Nop.Web.MVC.Tests.csproj</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
