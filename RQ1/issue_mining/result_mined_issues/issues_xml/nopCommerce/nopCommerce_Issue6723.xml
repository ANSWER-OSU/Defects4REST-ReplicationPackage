<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>6723</ISSUENO>
  <ISSUEURL>https://github.com/nopSolutions/nopCommerce/issues/6723</ISSUEURL>
  <TITLE>400 bad request when trying to cancel/edit large order</TITLE>
  <DESCRIPTION>nopCommerce version: 4.60.3 Steps to reproduce the problem: The order that I'm working with has 432 items. When i try to cancel the order with the `cancel` button, or perform a manual status change, the change fails and the user receives a blank page. Dev tools and nop log show 400 bad request. Since the edit page is one big form that posts all input values regardless of what action is being taken on the order, and each order item has 6 attributes being posted, this results in 2,592 form fields being posted + approximately 25 other fields. So, the edit form for this order is submitting over 2,600 fields. This exceeds the default value of 1024 for the `RequestFormLimits` action attribute. I ran into a similar problem when developing a plugin for wholesale ordering. The best fix, in my opinion would involve limiting the form fields to only submit the values to what is necessary for what is being changed. The quick, less secure/robust fix would be adding `[DisableRequestSizeLimit]`, `[RequestFormLimits(ValueCountLimit = int.MaxValue, KeyLengthLimit = int.MaxValue)]` attributes to the `CancelOrder` action and other edit related actions which could suffer from this same issue. I can certainly apply the attribute overrides to my local build to get it working, but I would like to see a more robust upstream fix for this.</DESCRIPTION>
  <REPONAME>nopCommerce</REPONAME>
  <TIMEDIFFERENCEDAYS>3</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge branch '4.60-bug-fixes' into develop # Conflicts: # src/Libraries/Nop.Services/Catalog/ProductExtensions.cs</MESSAGE>
    <SHA>008682e0c4f0790e16969aa9f4c1497627e0790f</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>#6723 fix for large forms causing 400 Bad Request</MESSAGE>
      <SHA>3b8a5b9c2fb65814d639017044112054b4170232</SHA>
      <PATCHEDFILES>
        <FILE>src/Presentation/Nop.Web.Framework/Infrastructure/Extensions/ServiceCollectionExtensions.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#6723 #5950 Reduced form size to prevent causing 400 Bad Request on edit large orders</MESSAGE>
      <SHA>a481be440a8505a01a0ae0f379fb2362782cf130</SHA>
      <PATCHEDFILES>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Views/Order/_OrderDetails.Products.cshtml</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
