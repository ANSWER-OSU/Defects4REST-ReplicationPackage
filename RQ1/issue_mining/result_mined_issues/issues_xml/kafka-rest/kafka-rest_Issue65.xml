<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>65</ISSUENO>
  <ISSUEURL>https://github.com/confluentinc/kafka-rest/issues/65</ISSUEURL>
  <TITLE>Consumer read request hangs if you try to create two consumer instances with the same ID</TITLE>
  <DESCRIPTION>If you: 1. Create consumer with an ID 2. Read from a topic 3. Create consumer with same ID (don't delete previous one) 4. Read from topic the second create call succeeds and the read hangs. The stack trace shows it stuck trying to create a zookeeper node in a method that can also handle conflicts, which we'd expect since the IDs are the same. Turns out that we ended up conflating the meaning of &quot;ID&quot;, which is used both to name the consumer nicely so you have readable consumer URLs and it got passed in as the ID for the underlying old Kafka consumer. The latter should really only be happening for debugging purposes since a random UUID (generated automatically for the consumer if the ID is omitted) is way more reliable. Things get a bit more confusing when we consider moving to the new consumer, which has a separate client ID that it uses to make logging on the brokers clearer and traceable to specific applications. A fix for this has to be careful about compatibility. I think the right thing to do is add a new parameter (&quot;name&quot;) which will be used in the URL. If the &quot;id&quot; is specified and &quot;name&quot; isn't, &quot;name&quot; will default to &quot;id&quot;. The underlying Kafka &quot;consumer.id&quot; will only be set if &quot;id&quot; was explicitly set. Then, the name is only relevant to the single instance of the REST proxy since consumer URLs are specific to a single process. We can return a 409 if we see a naming conflict during creation, which will prevent the subsequent hang during read. Finally, we'll want to deprecate and deemphasize the &quot;id&quot; field in the docs since &quot;name&quot; will now be the field they really should be using.</DESCRIPTION>
  <REPONAME>kafka-rest</REPONAME>
  <TIMEDIFFERENCEDAYS>68</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #64 from confluentinc/issue-62-integration-test-performance Reduce integration test time.</MESSAGE>
    <SHA>7609dd3db4a80b9c5aecb69ff80fa208421ce2d1</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Handle conflicting IDs and separate IDs used in the REST proxy and by Kafka's consumer implementation. Add a check for duplicate IDs before creating a consumer and adding it to the map in ConsumerManager. Also add a &quot;name&quot; field to ConsumerInstanceConfig to allow control over the naming of the instance config within the single REST proxy without setting the ID of the underlying Kafka consumer, since this can be useful if a limited set of consumer instances within a group is desired. Update the documentation to mark the &quot;id&quot; field as deprecated since it probably doesn't provide the behavior users expect and without this fix it can cause problems if the user ends up with duplicates. Kafka doesn't expect it to be used this way except for testing anyway. Also add the name field and update all the example cURL requests to use the recommended default where both &quot;id&quot; and &quot;name&quot; are omitted, and consumers are deleted properly when they are no longer needed. Fixes #65.</MESSAGE>
      <SHA>70682fdee667a36d82f3a81675ac517a196048d9</SHA>
      <PATCHEDFILES>
        <FILE>README.md</FILE>
        <FILE>docs/api.rst</FILE>
        <FILE>docs/intro.rst</FILE>
        <FILE>src/main/java/io/confluent/kafkarest/ConsumerManager.java</FILE>
        <FILE>src/main/java/io/confluent/kafkarest/Errors.java</FILE>
        <FILE>src/main/java/io/confluent/kafkarest/entities/ConsumerInstanceConfig.java</FILE>
        <FILE>src/test/java/io/confluent/kafkarest/integration/AbstractConsumerTest.java</FILE>
        <FILE>src/test/java/io/confluent/kafkarest/integration/ConsumerAvroTest.java</FILE>
        <FILE>src/test/java/io/confluent/kafkarest/integration/ConsumerBinaryTest.java</FILE>
        <FILE>src/test/java/io/confluent/kafkarest/integration/ConsumerTimeoutTest.java</FILE>
        <FILE>src/test/java/io/confluent/kafkarest/unit/ConsumerManagerTest.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
