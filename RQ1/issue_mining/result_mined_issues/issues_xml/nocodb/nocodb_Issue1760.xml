<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>1760</ISSUENO>
  <ISSUEURL>https://github.com/nocodb/nocodb/issues/1760</ISSUEURL>
  <TITLE>Migration errors to 0.90.3</TITLE>
  <DESCRIPTION>- [x] 1. Invalid formula : need to handle exception ``` Unclosed ( at character 14&quot;,&quot;err&quot;:&quot;Error: Unclosed ( at character 14\n at throwError ``` - [x] 2. Trying to extract view id ``` Cannot read property 'id' of undefined&quot;,&quot;err&quot;:&quot;TypeError: Cannot read property 'id' of undefined\n ``` - [x] 3. nc_users_v2 doesnt exist. ``` insert into \&quot;nc_users_v2\&quot; (\&quot;created_at\&quot;, \&quot;email\&quot;, \&quot;email_verification_token\&quot;, \&quot;email_verified\&quot;, \&quot;firstname\&quot;, \&quot;id\&quot;, \&quot;invite_token\&quot;, \&quot;invite_token_expires\&quot;, \&quot;lastname\&quot;, \&quot;password\&quot;, \&quot;refresh_token\&quot;, \&quot;reset_password_expires\&quot;, \&quot;reset_password_token\&quot;, \&quot;roles\&quot;, \&quot;salt\&quot;, \&quot;updated_at\&quot;, \&quot;username\&quot;) values (CURRENT_TIMESTAMP, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, CURRENT_TIMESTAMP, $15) - relation \&quot;nc_users_v2\&quot; does not exist&quot;,&quot;err&quot;:&quot;error: insert into \&quot;nc_users_v2\&quot; (\&quot;created_at\&quot;, \&quot;email\&quot;, \&quot;email_verification_token\&quot;, \&quot;email_verified\&quot;, \&quot;firstname\&quot;, \&quot;id\&quot;, \&quot;invite_token\&quot;, \&quot;invite_token_expires\&quot;, \&quot;lastname\&quot;, \&quot;password\&quot;, \&quot;refresh_token\&quot;, \&quot;reset_password_expires\&quot;, \&quot;reset_password_token\&quot;, \&quot;roles\&quot;, \&quot;salt\&quot;, \&quot;updated_at\&quot;, \&quot;username\&quot;) values (CURRENT_TIMESTAMP, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, CURRENT_TIMESTAMP, $15) - relation \&quot;nc_users_v2\&quot; does not exist\n at ``` - [ ] 4. Cannot add or update a child row: a foreign key constraint fails ``` \&quot;insert into `nc_project_users_v2` (`created_at`, `fk_user_id`, `project_id`, `roles`, `updated_at`) values (CURRENT_TIMESTAMP, 3, \'ha_prod_docker__aved\', \'editor\', CURRENT_TIMESTAMP) - Cannot add or update a child row: a foreign key constraint fails (`root_db`.`nc_project_users_v2`, CONSTRAINT `nc_project_users_v2_fk_user_id_foreign` FOREIGN KEY (`fk_user_id`) REFERENCES `nc_users_v2` (`id`))\&quot;,\&quot;err\&quot;:\&quot;Error: insert into `nc_project_users_v2` (`created_at`, `fk_user_id`, `project_id`, `roles`, `updated_at`) values (CURRENT_TIMESTAMP, 3, \'ha_prod_docker__aved\', \'editor\', CURRENT_TIMESTAMP) - Cannot add or update a child row: a foreign key constraint fails (`root_db`.`nc_project_users_v2`, CONSTRAINT `nc_project_users_v2_fk_user_id_foreign` FOREIGN KEY (`fk_user_id`) REFERENCES `nc_users_v2` ``` - [x] 5. nc_shared_bases doesn't exist ``` &quot;select * from \&quot;nc_shared_bases\&quot; - relation \&quot;nc_shared_bases\&quot; does not exist&quot;,&quot;err&quot;:&quot;error: select * from \&quot;nc_shared_bases\&quot; - relation \&quot;nc_shared_bases\&quot; does not exist\n ```</DESCRIPTION>
  <REPONAME>nocodb</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #1757 from nocodb/fix/1756-ltar-based-filter Fix - LTAR based filter</MESSAGE>
    <SHA>d5aa1713105fee867eab7d7cbd8eb274ae9b11fe</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>fix: handle formula parse error in formula migration re #1760 Signed-off-by: Pranav C &lt;pranavxc@gmail.com&gt;</MESSAGE>
      <SHA>b43793e7bf8fd364ad82b944f30a42d0e6aabc44</SHA>
      <PATCHEDFILES>
        <FILE>packages/nocodb/src/lib/noco/upgrader/jobs/ncProjectUpgraderV2_0090000.ts</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>fix: avoid project user insertion if corresponding project or user is missing re #1760 Signed-off-by: Pranav C &lt;pranavxc@gmail.com&gt;</MESSAGE>
      <SHA>8563a9c7c44564210f5cac38209fa3cc971abc13</SHA>
      <PATCHEDFILES>
        <FILE>packages/nocodb/src/lib/noco/upgrader/jobs/ncProjectUpgraderV2_0090000.ts</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>fix: skip shared views if view_name/model_name is empty or missing re #1760 Signed-off-by: Pranav C &lt;pranavxc@gmail.com&gt;</MESSAGE>
      <SHA>ad066088f5610741e8e4693523f6b32e373a2b2e</SHA>
      <PATCHEDFILES>
        <FILE>packages/nocodb/src/lib/noco/upgrader/jobs/ncProjectUpgraderV2_0090000.ts</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fix - Migration bugs (#1771) * fix: handle formula parse error in formula migration re #1760 Signed-off-by: Pranav C &lt;pranavxc@gmail.com&gt; * fix: avoid project user insertion if corresponding project or user is missing re #1760 Signed-off-by: Pranav C &lt;pranavxc@gmail.com&gt; * fix: skip shared views if view_name/model_name is empty or missing re #1760 Signed-off-by: Pranav C &lt;pranavxc@gmail.com&gt; * fix: migration down statement correction Signed-off-by: Pranav C &lt;pranavxc@gmail.com&gt; * fix(migration): split alter table statement into multiple statements to support MSSQL re #1764 Signed-off-by: Pranav C &lt;pranavxc@gmail.com&gt;</MESSAGE>
      <SHA>03bf9180ea78a09b433c6fc14fef4e21169204b8</SHA>
      <PATCHEDFILES>
        <FILE>packages/nocodb/src/lib/noco/migrationsv2/nc_011.ts</FILE>
        <FILE>packages/nocodb/src/lib/noco/migrationsv2/nc_012_alter_column_data_types.ts</FILE>
        <FILE>packages/nocodb/src/lib/noco/upgrader/jobs/ncProjectUpgraderV2_0090000.ts</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>0.90.5 Pre-release (#1774) * chore(deps): bump minimist Bumps [minimist](https://github.com/substack/minimist) from 1.2.5 to 1.2.6. - [Release notes](https://github.com/substack/minimist/releases) - [Commits](https://github.com/substack/minimist/compare/1.2.5...1.2.6) --- updated-dependencies: - dependency-name: minimist dependency-type: indirect ... Signed-off-by: dependabot[bot] &lt;support@github.com&gt; * chore(deps): bump async from 2.6.3 to 2.6.4 in /packages/noco-docs-prev Bumps [async](https://github.com/caolan/async) from 2.6.3 to 2.6.4. - [Release notes](https://github.com/caolan/async/releases) - [Changelog](https://github.com/caolan/async/blob/v2.6.4/CHANGELOG.md) - [Commits](https://github.com/caolan/async/compare/v2.6.3...v2.6.4) --- updated-dependencies: - dependency-name: async dependency-type: indirect ... Signed-off-by: dependabot[bot] &lt;support@github.com&gt; * chore(deps): bump async from 2.6.3 to 2.6.4 in /packages/noco-docs Bumps [async](https://github.com/caolan/async) from 2.6.3 to 2.6.4. - [Release notes](https://github.com/caolan/async/releases) - [Changelog](https://github.com/caolan/async/blob/v2.6.4/CHANGELOG.md) - [Commits](https://github.com/caolan/async/compare/v2.6.3...v2.6.4) --- updated-dependencies: - dependency-name: async dependency-type: indirect ... Signed-off-by: dependabot[bot] &lt;support@github.com&gt; * chore(deps): bump async from 2.6.3 to 2.6.4 in /packages/nc-plugin Bumps [async](https://github.com/caolan/async) from 2.6.3 to 2.6.4. - [Release notes](https://github.com/caolan/async/releases) - [Changelog](https://github.com/caolan/async/blob/v2.6.4/CHANGELOG.md) - [Commits](https://github.com/caolan/async/compare/v2.6.3...v2.6.4) --- updated-dependencies: - dependency-name: async dependency-type: indirect ... Signed-off-by: dependabot[bot] &lt;support@github.com&gt; * chore(deps): bump async from 2.6.3 to 2.6.4 in /packages/nc-cli Bumps [async](https://github.com/caolan/async) from 2.6.3 to 2.6.4. - [Release notes](https://github.com/caolan/async/releases) - [Changelog](https://github.com/caolan/async/blob/v2.6.4/CHANGELOG.md) - [Commits](https://github.com/caolan/async/compare/v2.6.3...v2.6.4) --- updated-dependencies: - dependency-name: async dependency-type: indirect ... Signed-off-by: dependabot[bot] &lt;support@github.com&gt; * chore(deps): bump async from 2.6.3 to 2.6.4 in /packages/noco-i18n Bumps [async](https://github.com/caolan/async) from 2.6.3 to 2.6.4. - [Release notes](https://github.com/caolan/async/releases) - [Changelog](https://github.com/caolan/async/blob/v2.6.4/CHANGELOG.md) - [Commits](https://github.com/caolan/async/compare/v2.6.3...v2.6.4) --- updated-dependencies: - dependency-name: async dependency-type: indirect ... Signed-off-by: dependabot[bot] &lt;support@github.com&gt; * chore(deps): bump async from 2.6.3 to 2.6.4 in /packages/noco-blog Bumps [async](https://github.com/caolan/async) from 2.6.3 to 2.6.4. - [Release notes](https://github.com/caolan/async/releases) - [Changelog](https://github.com/caolan/async/blob/v2.6.4/CHANGELOG.md) - [Commits](https://github.com/caolan/async/compare/v2.6.3...v2.6.4) --- updated-dependencies: - dependency-name: async dependency-type: indirect ... Signed-off-by: dependabot[bot] &lt;support@github.com&gt; * chore(deps): bump async from 2.6.3 to 2.6.4 in /packages/nocodb-sdk Bumps [async](https://github.com/caolan/async) from 2.6.3 to 2.6.4. - [Release notes](https://github.com/caolan/async/releases) - [Changelog](https://github.com/caolan/async/blob/v2.6.4/CHANGELOG.md) - [Commits](https://github.com/caolan/async/compare/v2.6.3...v2.6.4) --- updated-dependencies: - dependency-name: async dependency-type: indirect ... Signed-off-by: dependabot[bot] &lt;support@github.com&gt; * chore(deps): bump minimist from 1.2.5 to 1.2.6 in /packages/nocodb Bumps [minimist](https://github.com/substack/minimist) from 1.2.5 to 1.2.6. - [Release notes](https://github.com/substack/minimist/releases) - [Commits](https://github.com/substack/minimist/compare/1.2.5...1.2.6) --- updated-dependencies: - dependency-name: minimist dependency-type: indirect ... Signed-off-by: dependabot[bot] &lt;support@github.com&gt; * refactor: i18n zh_CN corrections Signed-off-by: Raju Udava &lt;86527202+dstala@users.noreply.github.com&gt; * refactor: use SqlFactory from nocodb-sdk package (#1750) Signed-off-by: Pranav C &lt;pranavxc@gmail.com&gt; * fix: refer parent table referenced column in filter query(BT) re #1756 Signed-off-by: Pranav C &lt;pranavxc@gmail.com&gt; * fix: wrap nested add update query select part to avoid issue when referencing same table Signed-off-by: Pranav C &lt;pranavxc@gmail.com&gt; * chore(deps): bump async in /packages/nc-migrator-archived Bumps [async](https://github.com/caolan/async) from 2.6.2 to 2.6.4. - [Release notes](https://github.com/caolan/async/releases) - [Changelog](https://github.com/caolan/async/blob/v2.6.4/CHANGELOG.md) - [Commits](https://github.com/caolan/async/compare/v2.6.2...v2.6.4) --- updated-dependencies: - dependency-name: async dependency-type: indirect ... Signed-off-by: dependabot[bot] &lt;support@github.com&gt; * docs: update README.md [skip ci] * docs: update .all-contributorsrc [skip ci] * docs: add info related to {orgs} and swagger ui Signed-off-by: Wing-Kam Wong &lt;wingkwong.code@gmail.com&gt; * Fix - Migration bugs (#1771) * fix: handle formula parse error in formula migration re #1760 Signed-off-by: Pranav C &lt;pranavxc@gmail.com&gt; * fix: avoid project user insertion if corresponding project or user is missing re #1760 Signed-off-by: Pranav C &lt;pranavxc@gmail.com&gt; * fix: skip shared views if view_name/model_name is empty or missing re #1760 Signed-off-by: Pranav C &lt;pranavxc@gmail.com&gt; * fix: migration down statement correction Signed-off-by: Pranav C &lt;pranavxc@gmail.com&gt; * fix(migration): split alter table statement into multiple statements to support MSSQL re #1764 Signed-off-by: Pranav C &lt;pranavxc@gmail.com&gt; * refactor: add null check in upgrader Signed-off-by: Pranav C &lt;pranavxc@gmail.com&gt; Co-authored-by: dependabot[bot] &lt;49699333+dependabot[bot]@users.noreply.github.com&gt; Co-authored-by: Raju Udava &lt;86527202+dstala@users.noreply.github.com&gt; Co-authored-by: աɨռɢӄաօռɢ &lt;wingkwong.code@gmail.com&gt; Co-authored-by: navi &lt;oof1lab@gmail.com&gt; Co-authored-by: allcontributors[bot] &lt;46447321+allcontributors[bot]@users.noreply.github.com&gt;</MESSAGE>
      <SHA>412053039e84251293557b1b98036437266e61de</SHA>
      <PATCHEDFILES>
        <FILE>.all-contributorsrc</FILE>
        <FILE>README.md</FILE>
        <FILE>packages/nc-cli/package-lock.json</FILE>
        <FILE>packages/nc-gui/components/project/functionTab/functionQuery.vue</FILE>
        <FILE>packages/nc-gui/components/project/spreadsheet/public/xcForm.vue</FILE>
        <FILE>packages/nc-gui/components/project/spreadsheet/public/xcTable.vue</FILE>
        <FILE>packages/nc-gui/components/project/sqlClient.vue</FILE>
        <FILE>packages/nc-gui/components/project/tableTabs/columns.vue</FILE>
        <FILE>packages/nc-gui/helpers/sqlUi/MssqlUi.js</FILE>
        <FILE>packages/nc-gui/helpers/sqlUi/MysqlUi.js</FILE>
        <FILE>packages/nc-gui/helpers/sqlUi/OracleUi.js</FILE>
        <FILE>packages/nc-gui/helpers/sqlUi/PgUi.js</FILE>
        <FILE>packages/nc-gui/helpers/sqlUi/SqlUiFactory.js</FILE>
        <FILE>packages/nc-gui/helpers/sqlUi/SqliteUi.js</FILE>
        <FILE>packages/nc-gui/helpers/sqlUi/index.js</FILE>
        <FILE>packages/nc-gui/lang/zh_CN.json</FILE>
        <FILE>packages/nc-migrator-archived/package-lock.json</FILE>
        <FILE>packages/nc-plugin/package-lock.json</FILE>
        <FILE>packages/noco-blog/package-lock.json</FILE>
        <FILE>packages/noco-docs-prev/package-lock.json</FILE>
        <FILE>packages/noco-docs/content/en/developer-resources/rest-apis.md</FILE>
        <FILE>packages/noco-docs/package-lock.json</FILE>
        <FILE>packages/noco-i18n/package-lock.json</FILE>
        <FILE>packages/nocodb-sdk/package-lock.json</FILE>
        <FILE>packages/nocodb/package-lock.json</FILE>
        <FILE>packages/nocodb/src/__tests__/restv2.test.ts</FILE>
        <FILE>packages/nocodb/src/lib/dataMapper/lib/sql/BaseModelSqlv2.ts</FILE>
        <FILE>packages/nocodb/src/lib/dataMapper/lib/sql/conditionV2.ts</FILE>
        <FILE>packages/nocodb/src/lib/dataMapper/lib/sql/formulav2/formulaQueryBuilderv2.ts</FILE>
        <FILE>packages/nocodb/src/lib/dataMapper/lib/sql/sortV2.ts</FILE>
        <FILE>packages/nocodb/src/lib/noco-models/Column.ts</FILE>
        <FILE>packages/nocodb/src/lib/noco-models/Filter.ts</FILE>
        <FILE>packages/nocodb/src/lib/noco-models/GalleryView.ts</FILE>
        <FILE>packages/nocodb/src/lib/noco-models/HookFilter.ts</FILE>
        <FILE>packages/nocodb/src/lib/noco-models/Model.ts</FILE>
        <FILE>packages/nocodb/src/lib/noco/common/BaseApiBuilder.ts</FILE>
        <FILE>packages/nocodb/src/lib/noco/meta/NcMetaMgr.ts</FILE>
        <FILE>packages/nocodb/src/lib/noco/meta/api/columnApis.ts</FILE>
        <FILE>packages/nocodb/src/lib/noco/meta/api/metaDiffApis.ts</FILE>
        <FILE>packages/nocodb/src/lib/noco/meta/api/projectApis.ts</FILE>
        <FILE>packages/nocodb/src/lib/noco/meta/api/publicApis/publicMetaApis.ts</FILE>
        <FILE>packages/nocodb/src/lib/noco/meta/handlersv2/ncCreateLookup.ts</FILE>
        <FILE>packages/nocodb/src/lib/noco/migrationsv2/nc_011.ts</FILE>
        <FILE>packages/nocodb/src/lib/noco/migrationsv2/nc_012_alter_column_data_types.ts</FILE>
        <FILE>packages/nocodb/src/lib/noco/upgrader/jobs/ncProjectUpgraderV2_0090000.ts</FILE>
        <FILE>packages/nocodb/src/lib/sqlMgr/code/models/xc/BaseModelXcMeta.ts</FILE>
        <FILE>packages/nocodb/src/lib/sqlUi/MssqlUi.ts</FILE>
        <FILE>packages/nocodb/src/lib/sqlUi/MysqlUi.ts</FILE>
        <FILE>packages/nocodb/src/lib/sqlUi/OracleUi.ts</FILE>
        <FILE>packages/nocodb/src/lib/sqlUi/PgUi.ts</FILE>
        <FILE>packages/nocodb/src/lib/sqlUi/SqlUiFactory.ts</FILE>
        <FILE>packages/nocodb/src/lib/sqlUi/SqliteUi.ts</FILE>
        <FILE>packages/nocodb/src/lib/sqlUi/UITypes.ts</FILE>
        <FILE>packages/nocodb/src/lib/sqlUi/index.ts</FILE>
        <FILE>packages/nocodb/src/lib/templateParser/NcTemplateParser.ts</FILE>
        <FILE>scripts/cypress/fixtures/sqlite-sakila/regenFiles/package-lock.json</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
