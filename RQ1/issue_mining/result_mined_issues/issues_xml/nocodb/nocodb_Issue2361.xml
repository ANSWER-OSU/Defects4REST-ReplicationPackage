<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>2361</ISSUENO>
  <ISSUEURL>https://github.com/nocodb/nocodb/issues/2361</ISSUEURL>
  <TITLE>Normalization is breaking the login process</TITLE>
  <DESCRIPTION>Node: **v12.22.12** Arch: **x64** Platform: **linux** Docker: **true** Database: **pg** ProjectOnRootDB: **false** RootDB: **pg** PackageVersion: **0.91.8** Running a local NocoDB on Postgres. **Steps To Reproduce** 1. Register a user with mail `1Aa@test.com` 2. Log Out 3. Try logging in **Expected Behavior** I should be logged in. Instead, I get this error message: ![image](https://user-images.githubusercontent.com/4245227/173578131-daa1dc2b-e72a-4cd5-b7ac-e0173593c19e.png) Weird. When I went to try signing up again, I get *this:* ![image](https://user-images.githubusercontent.com/4245227/173578294-5ed83def-90f6-44dc-aa07-ad3d9c6aca2a.png) **Cause** I went to check the DB whether the user actually exists or not, and found the problem. ![image](https://user-images.githubusercontent.com/4245227/173578967-9f9b1c16-fa01-4bcb-b02d-3d305897f984.png) When I tried logging in with the e-mail in all lowercase, it worked. So the issue is being caused by storing the emails in lowercase, then comparing them in a case-sensitive manner with the original, uppercase version on next login attempt.</DESCRIPTION>
  <REPONAME>nocodb</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #2355 from nocodb/fix/sqlite-datetime fix: show err message when input cannot be parsed</MESSAGE>
    <SHA>bee19dd4929d3842b1099c8c2bc23cc75c16186b</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>fix: include `token_version` value in jwt payload use a generic function to populate jwt token to avoid repetition re #2361 Signed-off-by: Pranav C &lt;pranavxc@gmail.com&gt;</MESSAGE>
      <SHA>5ac169d840351733849207e082d2a65abf629c92</SHA>
      <PATCHEDFILES>
        <FILE>packages/nocodb/src/lib/meta/api/sync/importApis.ts</FILE>
        <FILE>packages/nocodb/src/lib/meta/api/userApi/helpers.ts</FILE>
        <FILE>packages/nocodb/src/lib/meta/api/userApi/userApis.ts</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>fix: make email case-insensitive re #2361 Signed-off-by: Pranav C &lt;pranavxc@gmail.com&gt;</MESSAGE>
      <SHA>04345cc085ff76f527ce3cd1e5628b869c786fa5</SHA>
      <PATCHEDFILES>
        <FILE>packages/nocodb/src/lib/models/User.ts</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>fix: include `token_version` value in jwt payload use a generic function to populate jwt token to avoid repetition re #2361 Signed-off-by: Pranav C &lt;pranavxc@gmail.com&gt;</MESSAGE>
      <SHA>29b2758dcb20e6842cc51c7f7b8522ee7b602bdd</SHA>
      <PATCHEDFILES>
        <FILE>packages/nocodb/src/lib/meta/api/sync/importApis.ts</FILE>
        <FILE>packages/nocodb/src/lib/meta/api/userApi/helpers.ts</FILE>
        <FILE>packages/nocodb/src/lib/meta/api/userApi/userApis.ts</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>fix: make email case-insensitive re #2361 Signed-off-by: Pranav C &lt;pranavxc@gmail.com&gt;</MESSAGE>
      <SHA>a30847af5f2cc73796a23a6239a7ed59dcda4c63</SHA>
      <PATCHEDFILES>
        <FILE>packages/nocodb/src/lib/models/User.ts</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
