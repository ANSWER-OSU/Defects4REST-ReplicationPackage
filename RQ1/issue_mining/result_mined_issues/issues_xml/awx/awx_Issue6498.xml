<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>6498</ISSUENO>
  <ISSUEURL>https://github.com/ansible/awx/issues/6498</ISSUEURL>
  <TITLE>504 timeouts when fetching job_events for a running job</TITLE>
  <DESCRIPTION>##### ISSUE TYPE - Bug Report ##### SUMMARY Having issues with 504 timeouts on `job_events` APIs for a given host when a job is running, e.g. `api/v2/hosts/1/job_events/`. Maybe due to deadlocks? **EDIT**: We redeployed `awx_web` to see if we could make the APIs work again, still 504 timeout on every `api/v2/hosts/1/job_events/` request. Something is very wrong here. ##### ENVIRONMENT * AWX version: 9.3.0 * AWX install method: openshift manual deployment * Ansible version: 2.9.5 * Operating System: Official AWX images * Web Browser: Firefox, postman, Python's `request.get()` (from both a Linux and Mac client) ##### STEPS TO REPRODUCE 1. Start a task that takes long time to finish (Our task is a task that writes hundreds of commands on a device and takes about 8 minutes to finish) 2. Fetch job events API while task is running 3. 504 timeouts on that API even after the job is done for a loong time. (It did start responding again earlier, but now I've waited 10 minutes and still no response from the API). It's important to note that when this occurs we get sporadic 504's on other endpoints too, but I believe this may happen due to sync workers and not enough of them. ##### EXPECTED RESULTS Being able to fetch `job_events` when a task is running. ##### ACTUAL RESULTS Timeout on `job_events`. ##### ADDITIONAL INFORMATION We found #6108 and disabled external logging to Logstash, but don't seem like the issue was solved. The timeout is happening due to OpenShift cutting the connection (499), but the request should never take more than 30 seconds anyway: ![image](https://user-images.githubusercontent.com/5310116/78008928-926dec00-7340-11ea-82e8-877aedbe2b17.png)</DESCRIPTION>
  <REPONAME>awx</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>add subscription usage page (#6497)</MESSAGE>
    <SHA>c13bb6e9d252aa17bee55cca6e745402babb23f9</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Set ip_address to empty string (#6498) ip_address cannot be null, so set to empty instead of None Signed-off-by: Seth Foster &lt;fosterbseth@gmail.com&gt;</MESSAGE>
      <SHA>4ae871a344ceae99aa38bc63bd35914925373c3d</SHA>
      <PATCHEDFILES>
        <FILE>awx/main/managers.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
