<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>10681</ISSUENO>
  <ISSUEURL>https://github.com/ansible/awx/issues/10681</ISSUEURL>
  <TITLE>API strings are not being compiled</TITLE>
  <DESCRIPTION>### Summary In our move to ui_next, the `make languages` target was no longer called when compiling the UI. This means that the API strings (think help_text in OPTIONS requests) are no longer being compiled and thus are not displayed in the client's browser. ### AWX version devel ### Web browser Chrome ### Steps to reproduce 1. Start the dev env - `make docker-compose` 2. Change your browser preferences to default to `ja` as your locale 3. Navigate to `api/v2/settings/authentication` and click OPTIONS to see the untranslated strings 4. Run the following to compile API strings: ``` $ python tools/scripts/compilemessages.py ``` 5. Restart your containers 6. Observe the strings are now translated ### Expected results ![image](https://user-images.githubusercontent.com/11698892/126224196-f76da94a-f6ca-4306-9187-b2db8326ab5c.png) ### Actual results ![image](https://user-images.githubusercontent.com/11698892/126224326-2461395d-6f14-4eaf-b34b-58a2108c0354.png) Sidenote, there is also a `fr` string that is throwing a compilation error which I will fix. ### Additional information We may also be able to lose our `compilemessages.py` file in favor of using the django build-in command.</DESCRIPTION>
  <REPONAME>awx</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #10562 from jakemcdermott/fix-relatives-2 Fix relative imports in src code, relocate src (Lots of files modified but the changes are low-risk and automated) This PR is a follow-up to #6954, specifically the part where we removed webpack aliases to pick up react-scripts. SUMMARY Add the jsconfig.json w/ baseUrl to enable absolute imports from src. Replaces all the ../../../../../ importing jsx -&gt; js extension renaming hooks directory [ ] ui_next -&gt; ui see: #10676 For posterity, the script used to fix the relative imports is included in the commit history. python3 tools/fixrelative.py awx/ui_next/src npm --prefix=awx/ui_next run lint -- --fix npm --prefix=awx/ui_next run prettier import argparse import glob import os from shutil import move, copymode from tempfile import mkstemp def get_new_import_string(old_import_str, root): if not root.startswith(&quot;./&quot;): raise Exception(&quot;root must start with './'&quot;) name = root.replace(&quot;./&quot;, &quot;&quot;) left, right = old_import_str.split(&quot;from&quot;) left += &quot;from '&quot; _, trailing = right.split(name) return left + name + trailing roots = [ &quot;./api&quot;, &quot;./components&quot;, # &quot;./constants&quot;, &quot;./contexts&quot;, &quot;./screens&quot;, &quot;./types&quot;, &quot;./util&quot;, ] def get_root(line): matched_root = None for root in roots: if root in line: matched_root = root break if &quot;jest&quot; in line: matched_root = None return matched_root def find_and_replace_roots(file_path, root_dir, preview): fh, temp_path = mkstemp() has_logged_file_name = False with os.fdopen(fh, &quot;w&quot;) as new_file: with open(file_path) as old_file: for (line_number, line) in enumerate(old_file): matched_root = get_root(line) if matched_root: new_line = get_new_import_string(line, matched_root) if not preview: new_file.write(new_line) if not has_logged_file_name: log_file_replacement(root_dir, file_path) has_logged_file_name = True log_line_replacement(line_number, line, new_line) elif not preview: new_file.write(line) if not preview: copymode(file_path, temp_path) os.remove(file_path) move(temp_path, file_path) def log_line_replacement(line_number, line, new_line): display_line = line.replace(os.linesep, &quot;&quot;) display_new_line = new_line.replace(os.linesep, &quot;&quot;) print(f&quot;\t (line {line_number}): {display_line} --&gt; {display_new_line}&quot;) def log_file_replacement(root_dir, file_path): display_path = os.path.relpath(file_path, root_dir) print(&quot;&quot;) print(f&quot;{display_path}:&quot;) def parse_args(): parser = argparse.ArgumentParser() parser.add_argument(&quot;root_dir&quot;, help=&quot;Root directory&quot;) parser.add_argument(&quot;--preview&quot;, help=&quot;Preview (no write)&quot;, action=&quot;store_true&quot;) args = parser.parse_args() return args def run(): args = parse_args() search_path = args.root_dir + &quot;**/**/*.js*&quot; for file_path in glob.iglob(search_path, recursive=True): find_and_replace_roots(file_path, args.root_dir, args.preview) if __name__ == &quot;__main__&quot;: run() Reviewed-by: Kersom &lt;None&gt; Reviewed-by: Tiago GÃ³es &lt;tiago.goes2009@gmail.com&gt;</MESSAGE>
    <SHA>001f66980ffee17059fbbc18c4dffd76d9f7c5f4</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Merge pull request #10684 from rooftopcellist/compile-messages Properly compile translated API strings SUMMARY Fixes: #10681 Now when make ui-devel is run, it will compile the API translated strings and display them to the client browser. [chadams@chadams-work awx]$ make ui-devel make[1]: Entering directory '/home/chadams/awx' python3.8 tools/scripts/compilemessages.py processing file django.po in /home/chadams/awx/awx/locale/fr/LC_MESSAGES processing file django.po in /home/chadams/awx/awx/locale/zh/LC_MESSAGES processing file django.po in /home/chadams/awx/awx/locale/en-us/LC_MESSAGES processing file django.po in /home/chadams/awx/awx/locale/ja/LC_MESSAGES processing file django.po in /home/chadams/awx/awx/locale/es/LC_MESSAGES processing file django.po in /home/chadams/awx/awx/locale/nl/LC_MESSAGES npm --prefix awx/ui_next --loglevel warn run compile-strings ... ISSUE TYPE Bugfix Pull Request Reviewed-by: Jake McDermott &lt;yo@jakemcdermott.me&gt; Reviewed-by: Christian Adams &lt;rooftopcellist@gmail.com&gt;</MESSAGE>
      <SHA>fd99b366c29bf3ebcae713711053eadce160ecc4</SHA>
      <PATCHEDFILES>
        <FILE>Makefile</FILE>
        <FILE>awx/api/generics.py</FILE>
        <FILE>awx/locale/fr/LC_MESSAGES/django.po</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
