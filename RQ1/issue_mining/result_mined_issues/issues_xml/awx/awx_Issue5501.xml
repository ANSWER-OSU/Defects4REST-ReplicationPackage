<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>5501</ISSUENO>
  <ISSUEURL>https://github.com/ansible/awx/issues/5501</ISSUEURL>
  <TITLE>Kubernetes/Openshift Ansible installer is not working on RHEL 7</TITLE>
  <DESCRIPTION>##### ISSUE TYPE - Bug Report ##### SUMMARY The Kubernetes/Openshift Ansible installer does not work on RHEL 7 ##### ENVIRONMENT * AWX version: 9.0.1 * AWX install method: openshift * Ansible version: 2.8.7 (from Redhat repository rhel-7-server-ansible-2.8-rpms) * Operating System: RHEL 7.7 * Web Browser: none * Jinja2 version: python-jinja2-2.7.2-4.el7.noarch ##### STEPS TO REPRODUCE oc login ansible-playbook -i inventory install.yml -e openshift_token=$(oc whoami -t) -e openshift_user=clusteradminuser -vvv Taget cluster is Openshift 3.11, oc binary is 3.11 too. ##### EXPECTED RESULTS successfull installation ##### ACTUAL RESULTS Playbook terminates: ``` TASK [kubernetes : Find cluster for current context] ******************************************************************************************************************** task path: /home/XXXX/src/awx/installer/roles/kubernetes/tasks/main.yml:203 The full traceback is: Traceback (most recent call last): File &quot;/usr/lib/python2.7/site-packages/ansible/executor/task_executor.py&quot;, line 145, in run res = self._execute() File &quot;/usr/lib/python2.7/site-packages/ansible/executor/task_executor.py&quot;, line 592, in _execute self._task.post_validate(templar=templar) File &quot;/usr/lib/python2.7/site-packages/ansible/playbook/task.py&quot;, line 268, in post_validate super(Task, self).post_validate(templar) File &quot;/usr/lib/python2.7/site-packages/ansible/playbook/base.py&quot;, line 435, in post_validate value = templar.template(getattr(self, name)) File &quot;/usr/lib/python2.7/site-packages/ansible/template/__init__.py&quot;, line 584, in template disable_lookups=disable_lookups, File &quot;/usr/lib/python2.7/site-packages/ansible/template/__init__.py&quot;, line 539, in template disable_lookups=disable_lookups, File &quot;/usr/lib/python2.7/site-packages/ansible/template/__init__.py&quot;, line 804, in do_template res = j2_concat(rf) File &quot;&lt;template&gt;&quot;, line 11, in root File &quot;/usr/lib/python2.7/site-packages/jinja2/filters.py&quot;, line 740, in do_list return list(value) File &quot;/usr/lib/python2.7/site-packages/jinja2/filters.py&quot;, line 931, in _select_or_reject if modfunc(func(transfunc(item))): File &quot;/usr/lib/python2.7/site-packages/jinja2/filters.py&quot;, line 925, in &lt;lambda&gt; name, item, args, kwargs) File &quot;/usr/lib/python2.7/site-packages/jinja2/environment.py&quot;, line 438, in call_test raise TemplateRuntimeError('no test named %r' % name) TemplateRuntimeError: no test named 'equalto' fatal: [localhost]: FAILED! =&gt; { &quot;msg&quot;: &quot;Unexpected failure during module execution.&quot;, &quot;stdout&quot;: &quot;&quot; } PLAY RECAP ************************************************************************************************************************************************************** localhost : ok=24 changed=8 unreachable=0 failed=1 skipped=68 rescued=0 ignored=1 ``` I suspect that the Jinja2 version is too old to support 'equalto' ##### ADDITIONAL INFORMATION &lt;!-- Include any links to sosreport, database dumps, screenshots or other information. --&gt;</DESCRIPTION>
  <REPONAME>awx</REPONAME>
  <TIMEDIFFERENCEDAYS>131</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #6455 from AlanCoding/auth_errors Improve error handling related to authentication Reviewed-by: https://github.com/apps/softwarefactory-project-zuul</MESSAGE>
    <SHA>2264a98c045c02203f2a5361130861cca6259ecf</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Merge pull request #6471 from megabreit/jinja2-installer-fix support for older jinja2 in installer #5501 Reviewed-by: Ryan Petrello https://github.com/ryanpetrello</MESSAGE>
      <SHA>0beda08cf9469638d0d587c848730f0f41a2cc61</SHA>
      <PATCHEDFILES>
        <FILE>installer/roles/kubernetes/tasks/openshift.yml</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
