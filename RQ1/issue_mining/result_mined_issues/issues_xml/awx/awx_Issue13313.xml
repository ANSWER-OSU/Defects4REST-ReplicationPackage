<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>13313</ISSUENO>
  <ISSUEURL>https://github.com/ansible/awx/issues/13313</ISSUEURL>
  <TITLE>AWX has problem to connect to Redis</TITLE>
  <DESCRIPTION>### Please confirm the following - [X] I agree to follow this project's [code of conduct](https://docs.ansible.com/ansible/latest/community/code_of_conduct.html). - [X] I have checked the [current issues](https://github.com/ansible/awx/issues) for duplicates. - [X] I understand that AWX is open source software provided for free and that I might not receive a timely response. ### Bug Summary After upgrading the AWX-operator to 1.1.1 and AWX included is 21.10.0 with removed aio redis package, we are getting errors in connection.py. See below: `future: &lt;Task finished name='Task-3' coro=&lt;Connection.disconnect() done, defined at /var/lib/awx/venv/awx/lib64/python3.9/site-packages/redis/asyncio/connection.py:828&gt; exception=RuntimeError('Event loop is closed')&gt; Traceback (most recent call last): File &quot;/var/lib/awx/venv/awx/lib64/python3.9/site-packages/redis/asyncio/connection.py&quot;, line 837, in disconnect self._writer.close() # type: ignore[union-attr] File &quot;/usr/lib64/python3.9/asyncio/streams.py&quot;, line 353, in close return self._transport.close() File &quot;/usr/lib64/python3.9/asyncio/selector_events.py&quot;, line 698, in close self._loop.call_soon(self._call_connection_lost, None) File &quot;/usr/lib64/python3.9/asyncio/base_events.py&quot;, line 751, in call_soon self._check_closed() File &quot;/usr/lib64/python3.9/asyncio/base_events.py&quot;, line 515, in _check_closed raise RuntimeError('Event loop is closed')` ### AWX version 21.10.0 ### Select the relevant components - [ ] UI - [ ] API - [ ] Docs - [ ] Collection - [ ] CLI - [X] Other ### Installation method kubernetes ### Modifications no ### Ansible version _No response_ ### Operating system _No response_ ### Web browser Chrome ### Steps to reproduce Deploy 1.1.1 of AWX-operator, sync dynamic inventory. ### Expected results Inventory sync ### Actual results Job failed and error is present in log. ### Additional information _No response_</DESCRIPTION>
  <REPONAME>awx</REPONAME>
  <TIMEDIFFERENCEDAYS>12</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Break up and conditionally add the RBAC checks for ActivityStream (#13279) This should vastly improve the queries executed when accessing any of the activity stream endpoints as a normal user, in many cases.</MESSAGE>
    <SHA>e87e041a2a2a6d168a84d3eeea6664985f1c8ab8</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Pin channels-redis to 4.3.1 to fix an async issue Refs django/channels_redis#332 Refs #13313 Signed-off-by: Rick Elrod &lt;rick@elrod.me&gt;</MESSAGE>
      <SHA>64afa2caacbe424c1215bbfe6fa78c13fbd9e486</SHA>
      <PATCHEDFILES>
        <FILE>requirements/README.md</FILE>
        <FILE>requirements/requirements.in</FILE>
        <FILE>requirements/requirements.txt</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Pin channels-redis to 4.3.1 to fix an async issue Refs django/channels_redis#332 Refs #13313 Signed-off-by: Rick Elrod &lt;rick@elrod.me&gt;</MESSAGE>
      <SHA>1556f7585d6eff56ea6dd114181b2ab62df66053</SHA>
      <PATCHEDFILES>
        <FILE>licenses/aioredis.txt</FILE>
        <FILE>licenses/hiredis.txt</FILE>
        <FILE>requirements/README.md</FILE>
        <FILE>requirements/requirements.in</FILE>
        <FILE>requirements/requirements.txt</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Pin channels-redis to 4.3.1 to fix an async issue Refs django/channels_redis#332 Refs #13313 Signed-off-by: Rick Elrod &lt;rick@elrod.me&gt;</MESSAGE>
      <SHA>c8449f635ac709c09aea3518bbd72de5c5f3d295</SHA>
      <PATCHEDFILES>
        <FILE>licenses/aioredis.txt</FILE>
        <FILE>licenses/hiredis.txt</FILE>
        <FILE>requirements/README.md</FILE>
        <FILE>requirements/requirements.in</FILE>
        <FILE>requirements/requirements.txt</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Pin channels-redis to 4.3.1 to fix an async issue (#13348) Refs django/channels_redis#332 Refs #13313 Signed-off-by: Rick Elrod &lt;rick@elrod.me&gt;</MESSAGE>
      <SHA>5dd0eab8060c16623bf6c5395767cd421dc09c4d</SHA>
      <PATCHEDFILES>
        <FILE>licenses/aioredis.txt</FILE>
        <FILE>licenses/hiredis.txt</FILE>
        <FILE>requirements/README.md</FILE>
        <FILE>requirements/requirements.in</FILE>
        <FILE>requirements/requirements.txt</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
