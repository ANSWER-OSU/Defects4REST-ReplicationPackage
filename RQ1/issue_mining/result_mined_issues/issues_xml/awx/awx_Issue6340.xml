<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>6340</ISSUENO>
  <ISSUEURL>https://github.com/ansible/awx/issues/6340</ISSUEURL>
  <TITLE>Jobs not running with external PostgreSQL database after PR #6034</TITLE>
  <DESCRIPTION>##### ISSUE TYPE Jobs not running with external PostgreSQL database after PR https://github.com/ansible/awx/pull/6034 ##### SUMMARY Jobs not running with external PostgreSQL database after PR https://github.com/ansible/awx/pull/6034 I've found that the issue is in following code: https://github.com/ansible/awx/blob/db7f0f9421853f2489ebb2f6b904202986dee99a/awx/main/dispatch/__init__.py#L72-L78 Replacing it with: ``` conn = psycopg2.connect(dbname=conf['NAME'], host=conf['HOST'], user=conf['USER'], password=conf['PASSWORD'], port=conf['PORT'], sslmode=conf[&quot;OPTIONS&quot;]['sslmode']) ``` enables job execution (note: this is specific to my setup which omits some options in credentials.py which are part of default AWX K8S credentials.py.j2 template, specifically I'm not using 'sslrootcert': '{{ ca_trust_bundle }}') ##### ENVIRONMENT * AWX version: 9.3.0 (devel branch) * AWX install method: kubernetes * Ansible version: 2.9.3 ##### STEPS TO REPRODUCE 1) Deploy latest AWX devel in Kubernetes with external PostgreSQL database. 2) Execute job ##### EXPECTED RESULTS Job should execute ##### ACTUAL RESULTS Job stays in pending with exceptions in `awx-task` log ##### ADDITIONAL INFORMATION Didn't open a PR since there might be more option in following file, and should be a clever way to enable them in `psycopg2.connect()` method. https://github.com/ansible/awx/blob/devel/installer/roles/kubernetes/templates/credentials.py.j2</DESCRIPTION>
  <REPONAME>awx</REPONAME>
  <TIMEDIFFERENCEDAYS>6</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #6034 from chrismeyersfsu/pg2_no_pubsub Replace rabbitmq with redis</MESSAGE>
    <SHA>db7f0f9421853f2489ebb2f6b904202986dee99a</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Added support for PG port and options. related #6340</MESSAGE>
      <SHA>3a208a0be27b842c6533836f09efec7084182628</SHA>
      <PATCHEDFILES>
        <FILE>awx/main/dispatch/__init__.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Merge pull request #6340 from ansible/backport_44_unpin_feature [4.4] Unpin python future</MESSAGE>
      <SHA>4aebf73e8f129c30b0e092fc26d6f4b0489a1672</SHA>
      <PATCHEDFILES>
        <FILE>licenses/future.txt</FILE>
        <FILE>requirements/requirements.txt</FILE>
        <FILE>requirements/requirements_git.txt</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
