<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>9872</ISSUENO>
  <ISSUEURL>https://github.com/ansible/awx/issues/9872</ISSUEURL>
  <TITLE>No feedback when launching sync from details screen</TITLE>
  <DESCRIPTION>##### ISSUE TYPE - Bug Report ##### SUMMARY 1. Create an inventory source, or a project 2. Go to the 'Details' view 3. See the 'Sync' button ![Screenshot from 2021-04-09 17-35-43](https://user-images.githubusercontent.com/5208768/114243196-2c0ba880-995a-11eb-93e6-859e4b4844a9.png) Click it to start a sync. There is no visible indicator that the sync was launched - no toast notification, no redirection to a view of the job, etc. A user may click multiple times thinking nothing is happening, launching multiple syncs. ##### ENVIRONMENT * AWX version: devel 12/10</DESCRIPTION>
  <REPONAME>awx</REPONAME>
  <TIMEDIFFERENCEDAYS>23</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #10067 from mabashian/test-warning-cleanup-3 Unit test warning cleanup SUMMARY These commits target the warnings that look like: Can't perform a React state update on an unmounted component The underlying problem here is that we have network requests that are being made by components that are subsequently being unmounted. When the network request resolves, we attempt to update some state but the component is no longer mounted and the warning is triggered. To address this I consolidated a lot of isMounted code into a single hook which can be used across the app to check to see whether the component in question is still mounted before attempting to update state inside of a useEffect. This primarily applies to network requests. I think this points to a larger issue which is that we sometimes mount components prematurely. For example, when the job template edit component is mounted we actually mount: JobTemplateForm (briefly) ContentLoading JobTemplateForm Network requests triggered by the first mount of JobTemplateForm are suscepitble to attempting to update state on an unmounted component. I believe this pattern exists in many places across the app but I haven't tried to solve this in this PR. ISSUE TYPE Bugfix Pull Request COMPONENT NAME UI Reviewed-by: Marliana Lara &lt;marliana.lara@gmail.com&gt; Reviewed-by: Kersom &lt;None&gt;</MESSAGE>
    <SHA>7d6a8adb79bdbb61cf053af7383d9bbeab112821</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Merge pull request #9931 from seiwailai/issue-9872-sync-feedback project: Add last job status as for project sync feedback feature. SUMMARY Fixes #9872 Add last job status as for the project sync feedback feature. When users clicked the sync button on the project page, last job status will eventually update the status to Pending, Waiting, Running, and final result (Successful, Cancelled, Failed, Error). The implementation requires the WebSocket connection to ensure synchronous status update. In particular, the last job status is similar to the functionality of status in the project list (status in ProjectListItem.jsx). More specifically, the last job status accompanied by a job link that allowing the user to navigate to the job output page. Besides, there is also the tooltip that allowing the user to view the information related to the most recent sync, covering information like JOB ID, STATUS, FINISHED. The rationale of having the last job status instead of redirection or toast notification is that: User has choices on whether to redirect to the job output. If the user wishes to navigate to job output, he/she can click the link. Besides, the user might have other projects to be synced right after the current project and he/she may want to proceed back to the project list page instead of the job output page. If we implement force redirection, it would take a longer time to navigate to the project list page. The status update on last job status is fundamentally similar to toast notification where the user can immediately be notified if he/she already clicked the sync button to launch the job. Nevertheless, this PR requires further discussion. Any comments are welcomed! ISSUE TYPE Feature Pull Request COMPONENT NAME UI awx/ui_next/src/screens/Project/Project.jsx awx/ui_next/src/screens/Project/useWsProject.js - Added websocket implementation awx/ui_next/src/screens/Project/ProjectDetail/ProjectDetail.jsx AWX VERSION awx: 19.0.0 ADDITIONAL INFORMATION In case if users spam the sync button, we will need to ensure the fluent UI on the most recent sync tooltip and last job status. Thus, we would not want to update our last job status to Pending if there is a current running job. For instance, we clicked sync for a particular project twice. For the first sync, our last job status should immediately change to Pending, then Waiting, then Running, then result (which are Successful, Failed, Error, Cancelled). For the second sync, if we have a running job, we should not update our UI to Pending, otherwise our most recent sync tooltip UI will lose our current running job and we cannot navigate to the job link through the link provided by last job status tooltip. Issue of sync button click spam Ideally, we should prevent any spamming on the sync button using backend logic to reduce overload on the server as we already have a similar running project. Together with backend logic, we can disable the sync button right after we start to sync a project. However, if we only disable sync through the frontend, this seems insecure as people with bad intentions might able to change the button disable attribute. After Reviewed-by: Alex Corey &lt;Alex.swansboro@gmail.com&gt; Reviewed-by: Sei Wai Lai &lt;None&gt; Reviewed-by: Tiago GÃ³es &lt;tiago.goes2009@gmail.com&gt;</MESSAGE>
      <SHA>cb26087c2aa08fb3cba29a6e5d43c528ce13b399</SHA>
      <PATCHEDFILES>
        <FILE>awx/ui_next/src/screens/Project/ProjectDetail/ProjectDetail.jsx</FILE>
        <FILE>awx/ui_next/src/screens/Project/ProjectDetail/useWsProject.js</FILE>
        <FILE>awx/ui_next/src/screens/Project/ProjectDetail/useWsProject.test.jsx</FILE>
        <FILE>awx/ui_next/src/screens/Project/ProjectList/ProjectListItem.jsx</FILE>
        <FILE>awx/ui_next/src/screens/Project/ProjectList/ProjectListItem.test.jsx</FILE>
        <FILE>awx/ui_next/src/screens/Project/ProjectList/useWsProjects.js</FILE>
        <FILE>awx/ui_next/src/screens/Project/ProjectList/useWsProjects.test.jsx</FILE>
        <FILE>awx/ui_next/src/screens/Project/shared/ProjectSyncButton.jsx</FILE>
        <FILE>awx/ui_next/src/screens/Project/shared/ProjectSyncButton.test.jsx</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
