<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>8006</ISSUENO>
  <ISSUEURL>https://github.com/ansible/awx/issues/8006</ISSUEURL>
  <TITLE>using set_stats with large amounts of data slows down UI and API endpoints</TITLE>
  <DESCRIPTION>1. Create an inventory w/ 25+ (local connection) hosts. 2. Run this playbook w/ a 100MB artifact file for `set_stats`: ```yaml --- - hosts: all connection: local tasks: - set_stats: data: random_data: &quot;{{ lookup('file', 'random_data.txt') }}&quot; delegate_to: localhost ``` ```shell bash-4.4$ base64 /dev/urandom | head -c 100000000 &gt; random_data.txt bash-4.4$ du -h random_data.txt 96M random_data.txt ``` 3. Go to `/api/v2/inventories/N/hosts/` 4. Become very, very sad: &lt;img width=&quot;372&quot; alt=&quot;image&quot; src=&quot;https://user-images.githubusercontent.com/214912/91335777-e15c6800-e79e-11ea-8d52-f29c2efdbcf4.png&quot;&gt;</DESCRIPTION>
  <REPONAME>awx</REPONAME>
  <TIMEDIFFERENCEDAYS>6</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #7990 from ryanpetrello/build-needs-facts gather facts for image builds so we can detect arch Reviewed-by: Christian Adams &lt;rooftopcellist@gmail.com&gt; https://github.com/rooftopcellist</MESSAGE>
    <SHA>48f00587f878d519d2d3a48d74c254f0c2df8816</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>defer loading Job.artifacts on host views to improve performance see: https://github.com/ansible/awx/issues/8006 this data can be *really* large, and we don't actually need it for the summary fields on this API endpoint</MESSAGE>
      <SHA>163543fb22cb0e952fbaac160139aa126713682a</SHA>
      <PATCHEDFILES>
        <FILE>awx/api/serializers.py</FILE>
        <FILE>awx/main/managers.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>defer loading Job.artifacts on host views to improve performance see: https://github.com/ansible/awx/issues/8006 this data can be *really* large, and we don't actually need it for the summary fields on this API endpoint</MESSAGE>
      <SHA>7fe5f749fc237c5001df88d2b6e312cae8a97321</SHA>
      <PATCHEDFILES>
        <FILE>awx/api/serializers.py</FILE>
        <FILE>awx/main/managers.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>defer loading Job.artifacts on host views to improve performance see: https://github.com/ansible/awx/issues/8006 this data can be *really* large, and we don't actually need it for the summary fields on this API endpoint</MESSAGE>
      <SHA>73baf3fcf910ad0e94f88962f363ed2921692dce</SHA>
      <PATCHEDFILES>
        <FILE>awx/api/serializers.py</FILE>
        <FILE>awx/main/managers.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>defer loading Job.artifacts on host views to improve performance see: https://github.com/ansible/awx/issues/8006 this data can be *really* large, and we don't actually need it for the summary fields on this API endpoint</MESSAGE>
      <SHA>bb74b915a45402c379d9e733ec976fe738f3fbab</SHA>
      <PATCHEDFILES>
        <FILE>awx/api/serializers.py</FILE>
        <FILE>awx/main/managers.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
