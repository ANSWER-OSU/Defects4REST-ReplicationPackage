<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>9371</ISSUENO>
  <ISSUEURL>https://github.com/ansible/awx/issues/9371</ISSUEURL>
  <TITLE>Project Update fails with no output</TITLE>
  <DESCRIPTION>&lt;!-- Issues are for **concrete, actionable bugs and feature requests** only - if you're just asking for debugging help or technical support, please use: - http://webchat.freenode.net/?channels=ansible-awx - https://groups.google.com/forum/#!forum/awx-project We have to limit this because of limited volunteer time to respond to issues! --&gt; ##### ISSUE TYPE - Bug Report ##### SUMMARY &lt;!-- Briefly describe the problem. --&gt; ##### ENVIRONMENT * AWX version: 17.0.1 * AWX install method: kubernetes * Ansible version: 2.9 ##### STEPS TO REPRODUCE &lt;!-- Please describe exactly how to reproduce the problem. --&gt; Launch a Job Template with a custom SCM branch. Have that SCM branch been recently updated via a `git commit --amend` and `git push --force`, therefore forcing a rebase or a `git pull --force` to take place. ##### EXPECTED RESULTS &lt;!-- What did you expect to happen when running the steps above? --&gt; The project should update properly and the job should run. ##### ACTUAL RESULTS &lt;!-- What actually happened? --&gt; No output in the Job screen: ![image](https://user-images.githubusercontent.com/2234516/108566967-4e2b6780-72d5-11eb-925a-08a0b30a6ee7.png) Some api information from `/api/v2/jobs/3340/` ``` &quot;job_explanation&quot;: &quot;Previous Task Failed: {\&quot;job_type\&quot;: \&quot;project_update\&quot;, \&quot;job_name\&quot;: \&quot;Shared Ansible Repo\&quot;, \&quot;job_id\&quot;: \&quot;3341\&quot;}&quot;, &quot;execution_node&quot;: &quot;awx-job-3340&quot;, &quot;controller_node&quot;: &quot;awx-65b9694b58-7chbw&quot;, &quot;result_traceback&quot;: &quot;Traceback (most recent call last):\n File \&quot;/var/lib/awx/venv/awx/lib/python3.6/site-packages/awx/main/tasks.py\&quot;, line 1385, in run\n self.pre_run_hook(self.instance, private_data_dir)\n File \&quot;/var/lib/awx/venv/awx/lib/python3.6/site-packages/awx/main/tasks.py\&quot;, line 1944, in pre_run_hook\n sync_task.run(local_project_sync.id)\n File \&quot;/var/lib/awx/venv/awx/lib/python3.6/site-packages/awx/main/tasks.py\&quot;, line 816, in _wrapped\n return f(self, *args, **kwargs)\n File \&quot;/var/lib/awx/venv/awx/lib/python3.6/site-packages/awx/main/tasks.py\&quot;, line 1557, in run\n raise AwxTaskError.TaskError(self.instance, rc)\nException: project_update 3341 (failed) encountered an error (rc=2), please see task stdout for details.\n&quot;, &quot;event_processing_finished&quot;: true, &quot;job_template&quot;: 35, ``` And from `/api/v2/project_updates/3341/` ``` &quot;job_args&quot;: &quot;[\&quot;bwrap\&quot;, \&quot;--die-with-parent\&quot;, \&quot;--unshare-pid\&quot;, \&quot;--dev-bind\&quot;, \&quot;/\&quot;, \&quot;/\&quot;, \&quot;--proc\&quot;, \&quot;/proc\&quot;, \&quot;--bind\&quot;, \&quot;/tmp/ansible_runner_pi_utw897xe/ansible_runner_pi_ynztsn__/tmpbmfhfdbr\&quot;, \&quot;/etc/ssh\&quot;, \&quot;--bind\&quot;, \&quot;/tmp/ansible_runner_pi_utw897xe/ansible_runner_pi_ynztsn__/tmp42e6stt5\&quot;, \&quot;/etc/tower\&quot;, \&quot;--bind\&quot;, \&quot;/tmp/ansible_runner_pi_utw897xe/ansible_runner_pi_ynztsn__/tmpd4xxbyt8\&quot;, \&quot;/tmp\&quot;, \&quot;--bind\&quot;, \&quot;/tmp/ansible_runner_pi_utw897xe/ansible_runner_pi_ynztsn__/tmp3_5_lb44\&quot;, \&quot;/var/lib/awx\&quot;, \&quot;--bind\&quot;, \&quot;/tmp/ansible_runner_pi_utw897xe/ansible_runner_pi_ynztsn__/tmpnmjdmsbw\&quot;, \&quot;/var/lib/awx/projects\&quot;, \&quot;--bind\&quot;, \&quot;/tmp/ansible_runner_pi_utw897xe/ansible_runner_pi_ynztsn__/tmpipv_v9sd\&quot;, \&quot;/var/log\&quot;, \&quot;--ro-bind\&quot;, \&quot;/var/lib/awx/venv/ansible\&quot;, \&quot;/var/lib/awx/venv/ansible\&quot;, \&quot;--ro-bind\&quot;, \&quot;/var/lib/awx/venv/awx\&quot;, \&quot;/var/lib/awx/venv/awx\&quot;, \&quot;--bind\&quot;, \&quot;/tmp/awx_3341_7b88dg2g\&quot;, \&quot;/tmp/awx_3341_7b88dg2g\&quot;, \&quot;--bind\&quot;, \&quot;/var/lib/awx/projects\&quot;, \&quot;/var/lib/awx/projects\&quot;, \&quot;--chdir\&quot;, \&quot;/tmp/awx_3341_7b88dg2g/project\&quot;, \&quot;ssh-agent\&quot;, \&quot;sh\&quot;, \&quot;-c\&quot;, \&quot;ssh-add /tmp/awx_3341_7b88dg2g/artifacts/3341/ssh_key_data &amp;&amp; rm -f /tmp/awx_3341_7b88dg2g/artifacts/3341/ssh_key_data &amp;&amp; ansible-playbook -vvv -t update_git,install_roles,install_collections -i /tmp/awx_3341_7b88dg2g/inventory/hosts -e @/tmp/awx_3341_7b88dg2g/env/extravars project_update.yml\&quot;]&quot;, &quot;job_cwd&quot;: &quot;/tmp/awx_3341_7b88dg2g/project&quot;, &quot;job_explanation&quot;: &quot;&quot;, &quot;execution_node&quot;: &quot;awx-65b9694b58-7chbw&quot;, &quot;result_traceback&quot;: &quot;&quot;, &quot;event_processing_finished&quot;: true, ``` There is no `stdout` to see. Here's the logs from `awx-task` from the AWX Pod: ``` 2021-02-19 22:07:24,985 ERROR awx.main.tasks job 3342 (running) Exception occurred while running task Traceback (most recent call last): File &quot;/var/lib/awx/venv/awx/lib/python3.6/site-packages/awx/main/tasks.py&quot;, line 1385, in run self.pre_run_hook(self.instance, private_data_dir) File &quot;/var/lib/awx/venv/awx/lib/python3.6/site-packages/awx/main/tasks.py&quot;, line 1944, in pre_run_hook sync_task.run(local_project_sync.id) File &quot;/var/lib/awx/venv/awx/lib/python3.6/site-packages/awx/main/tasks.py&quot;, line 816, in _wrapped return f(self, *args, **kwargs) File &quot;/var/lib/awx/venv/awx/lib/python3.6/site-packages/awx/main/tasks.py&quot;, line 1557, in run raise AwxTaskError.TaskError(self.instance, rc) Exception: project_update 3343 (failed) encountered an error (rc=2), please see task stdout for details. ``` Not sure what's going on here, this is all the information I can find.</DESCRIPTION>
  <REPONAME>awx</REPONAME>
  <TIMEDIFFERENCEDAYS>88</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #10212 from sarabrajsingh/bugfix/create-seperator-worker-thread-for-transmit-jobs-9952 created a TransmitterThread class to start transmit jobs within. Surrâ€¦ SUMMARY Surfaced this bug while fixing issue #9952. Receptor-ctl would hang trying to read from a socket pair that is never closed, when the transmit job was executed yet threw an exception. This anomaly occurred when using a k8s cluster (Openshift in our case) as the execution environment. FYI - for now, this only applies to container groups. We moved the transmit function to execute in its own thread, and rejoin the calling function (_run_internal) when it finishes transmitting, and bubbling up exceptions if any occurred in the thread. ISSUE TYPE Bugfix Pull Request COMPONENT NAME API AWX VERSION awx: 19.1.0 ADDITIONAL INFORMATION Steps to reproduce bug: Create an ansible project with some files (or roles) and commit to a git repository Purposely commit a broken symlink on any file in the project files to git Create a credential set that authenticates to your k8s cluster in AWX Create a container instance group that leverages the credentials from Step 3 in AWX Create a project in AWX that leverages the ansible project/git repo from Step 1 Create a job template that leverages the AWX project from Step 4 and set your EE to the container instance group from Step 3 Execute the job from Step 5 Reviewed-by: Shane McDonald &lt;me@shanemcd.com&gt;</MESSAGE>
    <SHA>61ae80819ff839fc1923b9d42f02ec0dc4d99ad2</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Merge pull request #10005 from AlanCoding/force_on_override Update with force option if branch_override Addresses a reported issue where force-pushing to feature branches did not work. Connect #9371 (comment) Reviewed-by: Bill Nottingham &lt;None&gt;</MESSAGE>
      <SHA>fd60105db3dd88132fc384c3a1483b951d5bba08</SHA>
      <PATCHEDFILES>
        <FILE>awx/main/tasks.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
