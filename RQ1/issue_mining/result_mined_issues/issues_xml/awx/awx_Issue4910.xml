<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>4910</ISSUENO>
  <ISSUEURL>https://github.com/ansible/awx/issues/4910</ISSUEURL>
  <TITLE>jobs still dispatched to container group even if ResourceQuota will cause them to be rejected + fail immediately</TITLE>
  <DESCRIPTION>##### ISSUE TYPE - Bug Report ##### SUMMARY &lt;!-- Briefly describe the problem. --&gt; This is a known issue of #4189 that will be resolved in follow up PR. _IF the user sets up the namespace that they use for the Container Group with a ResourceQuota_... @one-t has confirmed that when a Container Group has exceeded capacity (e.g. has met its ResourceQuota) , jobs will still be sent to it because of lack of capacity calculation for ContainerGroups. The jobs then immediately fail becaues of a `403` response from kubernetes API instead of expected behavior of waiting to dispatch job until an instance group has capacity to run it. This means in a Tower environment that is saturated with jobs such that all other resources available to a new job are out of capacity, the Container Group will still appear to have capacity even if it itself has also exceeded resource limits. This will cause the job and any future jobs dispatched to the CG to immediately fail until resources are freed up. ##### STEPS TO REPRODUCE &lt;!-- Please describe exactly how to reproduce the problem. --&gt; Create a ResourceQuota in the namespace you use to set up a ContainerGroup Associate the ContainerGroup with a JT Launch more jobs that your ResourceQuota will allow ##### EXPECTED RESULTS &lt;!-- What did you expect to happen when running the steps above? --&gt; Later jobs will go into pending until resources are available ##### ACTUAL RESULTS &lt;!-- What actually happened? --&gt; Later jobs fail immediately with `403` from kubernetes API ##### ADDITIONAL INFORMATION &lt;!-- Include any links to sosreport, database dumps, screenshots or other information. --&gt; @one-t can provide more details about how to configure your namespace ResourceQuota</DESCRIPTION>
  <REPONAME>awx</REPONAME>
  <TIMEDIFFERENCEDAYS>13</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #4861 from chrismeyersfsu/backport_3.8.2-file-sharing-outside-jail-iso fix iso when private_data_dir is more than 1 subdir</MESSAGE>
    <SHA>c0040383ffc105c2439d04850cf9a91b6e6011e9</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Merge pull request #4910 from kdelee/pin-websocket-lib pin websocket-client lib</MESSAGE>
      <SHA>220d6c8af7b4fadb89935dcf3a93a4f5bf6916b2</SHA>
      <PATCHEDFILES>
        <FILE>awxkit/setup.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
