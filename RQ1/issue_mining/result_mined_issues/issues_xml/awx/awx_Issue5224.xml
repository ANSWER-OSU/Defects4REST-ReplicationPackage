<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>5224</ISSUENO>
  <ISSUEURL>https://github.com/ansible/awx/issues/5224</ISSUEURL>
  <TITLE>AWX 9.0.0 bubblewrap needs setuid permission</TITLE>
  <DESCRIPTION>##### ISSUE TYPE - Bug Report ##### SUMMARY Error when running jobs. &quot;bwrap: Creating new namespace failed, likely because the kernel does not support user namespaces. bwrap must be installed setuid on such systems.&quot; ##### ENVIRONMENT * AWX version: 9.0.0 * AWX install method: openshift * Ansible version: 2.8.5 * Operating System: CentOS 8.0.1905 * Web Browser: Any ##### STEPS TO REPRODUCE Run SCM Update or Inventory Sync jobs. No other jobs could be tried because they depend on these two. ##### EXPECTED RESULTS Jobs complete without error. ##### ACTUAL RESULTS bwrap: Creating new namespace failed, likely because the kernel does not support user namespaces. bwrap must be installed setuid on such systems. ##### ADDITIONAL INFORMATION Worked around error by running `chmod u+s /usr/bin/bwrap` in Dockerfile.j2 template. Here's a patch that applies the change: ``` diff --git a/installer/roles/image_build/templates/Dockerfile.j2 b/installer/roles/image_build/templates/Dockerfile.j2 index 64d7125..da16a47 100644 --- a/installer/roles/image_build/templates/Dockerfile.j2 +++ b/installer/roles/image_build/templates/Dockerfile.j2 @@ -49,6 +49,8 @@ RUN dnf -y update &amp;&amp; \ xmlsec1-openssl-devel \ dnf-utils +RUN chmod u+s /usr/bin/bwrap + ADD https://github.com/krallin/tini/releases/download/v0.14.0/tini /tini RUN chmod +x /tini ```</DESCRIPTION>
  <REPONAME>awx</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Fix k8s installs using external db</MESSAGE>
    <SHA>fa278f83ad59f0841fd1645a442b6d5830e6ec15</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Set setuid bit on bwrap Related: https://github.com/ansible/awx/issues/5224</MESSAGE>
      <SHA>8b53d7cb9d1a59ed94cc1dd170c2dc363aca2fed</SHA>
      <PATCHEDFILES>
        <FILE>installer/roles/image_build/templates/Dockerfile.j2</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Set setuid bit on bwrap Related: https://github.com/ansible/awx/issues/5224</MESSAGE>
      <SHA>089bafa5d46893cd2a3c5cd82c0a3743555becf9</SHA>
      <PATCHEDFILES>
        <FILE>installer/roles/image_build/templates/Dockerfile.j2</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Set setuid bit on bwrap in development Dockerfile Related: #5224 Signed-off-by: Philip Douglass &lt;philip.douglass@amadeus.com&gt;</MESSAGE>
      <SHA>7ae1c7c3d2ad6c18cb48b384b3a32bf969f487b4</SHA>
      <PATCHEDFILES>
        <FILE>tools/docker-compose/Dockerfile</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
