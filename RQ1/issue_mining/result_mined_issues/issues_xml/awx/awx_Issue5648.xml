<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>5648</ISSUENO>
  <ISSUEURL>https://github.com/ansible/awx/issues/5648</ISSUEURL>
  <TITLE>VMware dynamic inventory fails in awx 9.1.0 with py env 3</TITLE>
  <DESCRIPTION>##### ISSUE TYPE - Bug Report ##### SUMMARY &lt;!-- Briefly describe the problem. --&gt; Not able to update vmware inventory. I tried the approach tried here: [https://github.com/ansible/awx/issues/4156](url) but did not resolve the issue. ##### ENVIRONMENT * AWX version: 9.1.0 * AWX install method: docker on linux * Ansible version: 2.9,2 ##### STEPS TO REPRODUCE &lt;!-- Please describe exactly how to reproduce the problem. --&gt; AWX 9.1.0 installed and setup a &quot;VMware vCenter&quot; inventory. This worked in AWX 6.1.0 with ansible 2.8.6. ##### EXPECTED RESULTS &lt;!-- What did you expect to happen when running the steps above? --&gt; Update of inventory. ##### ACTUAL RESULTS &lt;!-- What actually happened? --&gt; ``` 4.545 INFO Updating inventory 28: VCENTER_INVENTORY 5.489 INFO Reading Ansible inventory source: /var/lib/awx/venv/awx/lib64/python3.6/site-packages/awx/plugins/inventory/vmware_inventory.py 5.495 INFO Using VIRTUAL_ENV: /var/lib/awx/venv/ansible 5.495 INFO Using PATH: /var/lib/awx/venv/ansible/bin:/var/lib/awx/venv/awx/bin:/var/lib/awx/venv/awx/bin:/var/lib/awx/venv/awx/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin 5.496 INFO Using PYTHONPATH: /var/lib/awx/venv/ansible/lib/python3.6/site-packages: Traceback (most recent call last): File &quot;/var/lib/awx/venv/awx/bin/awx-manage&quot;, line 11, in &lt;module&gt; load_entry_point('awx==9.1.0', 'console_scripts', 'awx-manage')() File &quot;/var/lib/awx/venv/awx/lib64/python3.6/site-packages/awx/__init__.py&quot;, line 165, in manage execute_from_command_line(sys.argv) File &quot;/var/lib/awx/venv/awx/lib64/python3.6/site-packages/django/core/management/__init__.py&quot;, line 381, in execute_from_command_line utility.execute() File &quot;/var/lib/awx/venv/awx/lib64/python3.6/site-packages/django/core/management/__init__.py&quot;, line 375, in execute self.fetch_command(subcommand).run_from_argv(self.argv) File &quot;/var/lib/awx/venv/awx/lib64/python3.6/site-packages/django/core/management/base.py&quot;, line 323, in run_from_argv self.execute(*args, **cmd_options) File &quot;/var/lib/awx/venv/awx/lib64/python3.6/site-packages/django/core/management/base.py&quot;, line 364, in execute output = self.handle(*args, **options) File &quot;/var/lib/awx/venv/awx/lib64/python3.6/site-packages/awx/main/management/commands/inventory_import.py&quot;, line 1158, in handle raise exc File &quot;/var/lib/awx/venv/awx/lib64/python3.6/site-packages/awx/main/management/commands/inventory_import.py&quot;, line 1048, in handle venv_path=venv_path, verbosity=self.verbosity).load() File &quot;/var/lib/awx/venv/awx/lib64/python3.6/site-packages/awx/main/management/commands/inventory_import.py&quot;, line 215, in load return self.command_to_json(base_args + ['--list']) File &quot;/var/lib/awx/venv/awx/lib64/python3.6/site-packages/awx/main/management/commands/inventory_import.py&quot;, line 198, in command_to_json self.method, proc.returncode, stdout, stderr)) RuntimeError: ansible-inventory failed (rc=1) with stdout: stderr: ansible-inventory 2.9.2 config file = /etc/ansible/ansible.cfg configured module search path = ['/var/lib/awx/.ansible/plugins/modules', '/usr/share/ansible/plugins/modules'] ansible python module location = /usr/local/lib/python3.6/site-packages/ansible executable location = /usr/local/bin/ansible-inventory python version = 3.6.8 (default, Oct 7 2019, 17:58:22) [GCC 8.2.1 20180905 (Red Hat 8.2.1-3)] Using /etc/ansible/ansible.cfg as config file [WARNING]: * Failed to parse /var/lib/awx/venv/awx/lib64/python3.6/site- packages/awx/plugins/inventory/vmware_inventory.py with script plugin: Inventory script (/var/lib/awx/venv/awx/lib64/python3.6/site- packages/awx/plugins/inventory/vmware_inventory.py) had an execution error: Traceback (most recent call last): File &quot;/var/lib/awx/venv/awx/lib64/python3.6/site- packages/awx/plugins/inventory/vmware_inventory.py&quot;, line 792, in &lt;module&gt; print(VMWareInventory().show()) File &quot;/var/lib/awx/venv/awx/lib64/python3.6/site- packages/awx/plugins/inventory/vmware_inventory.py&quot;, line 146, in __init__ self.do_api_calls_update_cache() File &quot;/var/lib/awx/venv/awx/lib64/python3.6/site- packages/awx/plugins/inventory/vmware_inventory.py&quot;, line 185, in do_api_calls_update_cache self.inventory = self.instances_to_inventory(self.get_instances()) File &quot;/var/lib/awx/venv/awx/lib64/python3.6/site- packages/awx/plugins/inventory/vmware_inventory.py&quot;, line 364, in get_instances return self._get_instances(kwargs) File &quot;/var/lib/awx/venv/awx/lib64/python3.6/site- packages/awx/plugins/inventory/vmware_inventory.py&quot;, line 381, in _get_instances if not si: UnboundLocalError: local variable 'si' referenced before assignment File &quot;/usr/local/lib/python3.6/site-packages/ansible/inventory/manager.py&quot;, line 280, in parse_source plugin.parse(self._inventory, self._loader, source, cache=cache) File &quot;/usr/local/lib/python3.6/site-packages/ansible/plugins/inventory/script.py&quot;, line 161, in parse raise AnsibleParserError(to_native(e)) [WARNING]: Unable to parse /var/lib/awx/venv/awx/lib64/python3.6/site- packages/awx/plugins/inventory/vmware_inventory.py as an inventory source ERROR! No inventory was parsed, please check your configuration and options. ``` ##### ADDITIONAL INFORMATION &lt;!-- Include any links to sosreport, database dumps, screenshots or other information. --&gt;</DESCRIPTION>
  <REPONAME>awx</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #5610 from thedoubl3j/canceled_jobs Added canceled_on field to unified_jobs model Reviewed-by: https://github.com/apps/softwarefactory-project-zuul</MESSAGE>
    <SHA>78e2cd7084ce06cbb5eab2ad2b3bcb4eba6dc2f9</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>update to latest vmware_inventory.py https://github.com/jladdjr/ansible/blob/63737ec0f8a37da17278cc257dde39e89eec6df2/contrib/inventory/vmware_inventory.py see: https://github.com/ansible/awx/issues/5648</MESSAGE>
      <SHA>6e5028587ac9efa14267074fd1e370845fb25478</SHA>
      <PATCHEDFILES>
        <FILE>awx/plugins/inventory/vmware_inventory.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
