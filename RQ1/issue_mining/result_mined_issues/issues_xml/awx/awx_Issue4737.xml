<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>4737</ISSUENO>
  <ISSUEURL>https://github.com/ansible/awx/issues/4737</ISSUEURL>
  <TITLE>can't install on k8s</TITLE>
  <DESCRIPTION>##### ISSUE TYPE - Bug Report ##### SUMMARY &lt;!-- Briefly describe the problem. --&gt; Display following error when clean install on k8s. ```json TASK [kubernetes : Migrate database] ****************************************************************************************************************************************************************************** fatal: [localhost]: FAILED! =&gt; {&quot;changed&quot;: true, &quot;cmd&quot;: &quot;kubectl -n awx exec ansible-tower-management -- bash -c \&quot;awx-manage migrate --noinput\&quot;\n&quot;, &quot;delta&quot;: &quot;0:00:05.399162&quot;, &quot;end&quot;: &quot;2019-09-13 15:01:31.015263&quot;, &quot;msg&quot;: &quot;non-zero return code&quot;, &quot;rc&quot;: 1, &quot;start&quot;: &quot;2019-09-13 15:01:25.616101&quot;, &quot;stderr&quot;: &quot;Traceback (most recent call last):\n File \&quot;/var/lib/awx/venv/awx/lib64/python3.6/site-packages/django/db/backends/base/base.py\&quot;, line 217, in ensure_connection\n self.connect()\n File \&quot;/var/lib/awx/venv/awx/lib64/python3.6/site-packages/django/db/backends/base/base.py\&quot;, line 195, in connect\n self.connection = self.get_new_connection(conn_params)\n File \&quot;/var/lib/awx/venv/awx/lib64/python3.6/site-packages/django/db/backends/postgresql/base.py\&quot;, line 178, in get_new_connection\n connection = Database.connect(**conn_params)\n File \&quot;/var/lib/awx/venv/awx/lib64/python3.6/site-packages/psycopg2/__init__.py\&quot;, line 130, in connect\n conn = _connect(dsn, connection_factory=connection_factory, **kwasync)\npsycopg2.OperationalError: FATAL: password authentication failed for user \&quot;awx\&quot;\n\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n File \&quot;/usr/bin/awx-manage\&quot;, line 11, in &lt;module&gt;\n load_entry_point('awx==7.0.0.0', 'console_scripts', 'awx-manage')()\n File \&quot;/var/lib/awx/venv/awx/lib64/python3.6/site-packages/awx/__init__.py\&quot;, line 142, in manage\n execute_from_command_line(sys.argv)\n File \&quot;/var/lib/awx/venv/awx/lib64/python3.6/site-packages/django/core/management/__init__.py\&quot;, line 381, in execute_from_command_line\n utility.execute()\n File \&quot;/var/lib/awx/venv/awx/lib64/python3.6/site-packages/django/core/management/__init__.py\&quot;, line 375, in execute\n self.fetch_command(subcommand).run_from_argv(self.argv)\n File \&quot;/var/lib/awx/venv/awx/lib64/python3.6/site-packages/django/core/management/base.py\&quot;, line 323, in run_from_argv\n self.execute(*args, **cmd_options)\n File \&quot;/var/lib/awx/venv/awx/lib64/python3.6/site-packages/django/core/management/base.py\&quot;, line 364, in execute\n output = self.handle(*args, **options)\n File \&quot;/var/lib/awx/venv/awx/lib64/python3.6/site-packages/django/core/management/base.py\&quot;, line 83, in wrapped\n res = handle_func(*args, **kwargs)\n File \&quot;/var/lib/awx/venv/awx/lib64/python3.6/site-packages/django/core/management/commands/migrate.py\&quot;, line 87, in handle\n executor = MigrationExecutor(connection, self.migration_progress_callback)\n File \&quot;/var/lib/awx/venv/awx/lib64/python3.6/site-packages/django/db/migrations/executor.py\&quot;, line 18, in __init__\n self.loader = MigrationLoader(self.connection)\n File \&quot;/var/lib/awx/venv/awx/lib64/python3.6/site-packages/django/db/migrations/loader.py\&quot;, line 49, in __init__\n self.build_graph()\n File \&quot;/var/lib/awx/venv/awx/lib64/python3.6/site-packages/django/db/migrations/loader.py\&quot;, line 212, in build_graph\n self.applied_migrations = recorder.applied_migrations()\n File \&quot;/var/lib/awx/venv/awx/lib64/python3.6/site-packages/django/db/migrations/recorder.py\&quot;, line 73, in applied_migrations\n if self.has_table():\n File \&quot;/var/lib/awx/venv/awx/lib64/python3.6/site-packages/django/db/migrations/recorder.py\&quot;, line 56, in has_table\n return self.Migration._meta.db_table in self.connection.introspection.table_names(self.connection.cursor())\n File \&quot;/var/lib/awx/venv/awx/lib64/python3.6/site-packages/django/db/backends/base/base.py\&quot;, line 256, in cursor\n return self._cursor()\n File \&quot;/var/lib/awx/venv/awx/lib64/python3.6/site-packages/django/db/backends/base/base.py\&quot;, line 233, in _cursor\n self.ensure_connection()\n File \&quot;/var/lib/awx/venv/awx/lib64/python3.6/site-packages/django/db/backends/base/base.py\&quot;, line 217, in ensure_connection\n self.connect()\n File \&quot;/var/lib/awx/venv/awx/lib64/python3.6/site-packages/django/db/utils.py\&quot;, line 89, in __exit__\n raise dj_exc_value.with_traceback(traceback) from exc_value\n File \&quot;/var/lib/awx/venv/awx/lib64/python3.6/site-packages/django/db/backends/base/base.py\&quot;, line 217, in ensure_connection\n self.connect()\n File \&quot;/var/lib/awx/venv/awx/lib64/python3.6/site-packages/django/db/backends/base/base.py\&quot;, line 195, in connect\n self.connection = self.get_new_connection(conn_params)\n File \&quot;/var/lib/awx/venv/awx/lib64/python3.6/site-packages/django/db/backends/postgresql/base.py\&quot;, line 178, in get_new_connection\n connection = Database.connect(**conn_params)\n File \&quot;/var/lib/awx/venv/awx/lib64/python3.6/site-packages/psycopg2/__init__.py\&quot;, line 130, in connect\n conn = _connect(dsn, connection_factory=connection_factory, **kwasync)\ndjango.db.utils.OperationalError: FATAL: password authentication failed for user \&quot;awx\&quot;\n\ncommand terminated with exit code 1&quot;, &quot;stderr_lines&quot;: [&quot;Traceback (most recent call last):&quot;, &quot; File \&quot;/var/lib/awx/venv/awx/lib64/python3.6/site-packages/django/db/backends/base/base.py\&quot;, line 217, in ensure_connection&quot;, &quot; self.connect()&quot;, &quot; File \&quot;/var/lib/awx/venv/awx/lib64/python3.6/site-packages/django/db/backends/base/base.py\&quot;, line 195, in connect&quot;, &quot; self.connection = self.get_new_connection(conn_params)&quot;, &quot; File \&quot;/var/lib/awx/venv/awx/lib64/python3.6/site-packages/django/db/backends/postgresql/base.py\&quot;, line 178, in get_new_connection&quot;, &quot; connection = Database.connect(**conn_params)&quot;, &quot; File \&quot;/var/lib/awx/venv/awx/lib64/python3.6/site-packages/psycopg2/__init__.py\&quot;, line 130, in connect&quot;, &quot; conn = _connect(dsn, connection_factory=connection_factory, **kwasync)&quot;, &quot;psycopg2.OperationalError: FATAL: password authentication failed for user \&quot;awx\&quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;The above exception was the direct cause of the following exception:&quot;, &quot;&quot;, &quot;Traceback (most recent call last):&quot;, &quot; File \&quot;/usr/bin/awx-manage\&quot;, line 11, in &lt;module&gt;&quot;, &quot; load_entry_point('awx==7.0.0.0', 'console_scripts', 'awx-manage')()&quot;, &quot; File \&quot;/var/lib/awx/venv/awx/lib64/python3.6/site-packages/awx/__init__.py\&quot;, line 142, in manage&quot;, &quot; execute_from_command_line(sys.argv)&quot;, &quot; File \&quot;/var/lib/awx/venv/awx/lib64/python3.6/site-packages/django/core/management/__init__.py\&quot;, line 381, in execute_from_command_line&quot;, &quot; utility.execute()&quot;, &quot; File \&quot;/var/lib/awx/venv/awx/lib64/python3.6/site-packages/django/core/management/__init__.py\&quot;, line 375, in execute&quot;, &quot; self.fetch_command(subcommand).run_from_argv(self.argv)&quot;, &quot; File \&quot;/var/lib/awx/venv/awx/lib64/python3.6/site-packages/django/core/management/base.py\&quot;, line 323, in run_from_argv&quot;, &quot; self.execute(*args, **cmd_options)&quot;, &quot; File \&quot;/var/lib/awx/venv/awx/lib64/python3.6/site-packages/django/core/management/base.py\&quot;, line 364, in execute&quot;, &quot; output = self.handle(*args, **options)&quot;, &quot; File \&quot;/var/lib/awx/venv/awx/lib64/python3.6/site-packages/django/core/management/base.py\&quot;, line 83, in wrapped&quot;, &quot; res = handle_func(*args, **kwargs)&quot;, &quot; File \&quot;/var/lib/awx/venv/awx/lib64/python3.6/site-packages/django/core/management/commands/migrate.py\&quot;, line 87, in handle&quot;, &quot; executor = MigrationExecutor(connection, self.migration_progress_callback)&quot;, &quot; File \&quot;/var/lib/awx/venv/awx/lib64/python3.6/site-packages/django/db/migrations/executor.py\&quot;, line 18, in __init__&quot;, &quot; self.loader = MigrationLoader(self.connection)&quot;, &quot; File \&quot;/var/lib/awx/venv/awx/lib64/python3.6/site-packages/django/db/migrations/loader.py\&quot;, line 49, in __init__&quot;, &quot; self.build_graph()&quot;, &quot; File \&quot;/var/lib/awx/venv/awx/lib64/python3.6/site-packages/django/db/migrations/loader.py\&quot;, line 212, in build_graph&quot;, &quot; self.applied_migrations = recorder.applied_migrations()&quot;, &quot; File \&quot;/var/lib/awx/venv/awx/lib64/python3.6/site-packages/django/db/migrations/recorder.py\&quot;, line 73, in applied_migrations&quot;, &quot; if self.has_table():&quot;, &quot; File \&quot;/var/lib/awx/venv/awx/lib64/python3.6/site-packages/django/db/migrations/recorder.py\&quot;, line 56, in has_table&quot;, &quot; return self.Migration._meta.db_table in self.connection.introspection.table_names(self.connection.cursor())&quot;, &quot; File \&quot;/var/lib/awx/venv/awx/lib64/python3.6/site-packages/django/db/backends/base/base.py\&quot;, line 256, in cursor&quot;, &quot; return self._cursor()&quot;, &quot; File \&quot;/var/lib/awx/venv/awx/lib64/python3.6/site-packages/django/db/backends/base/base.py\&quot;, line 233, in _cursor&quot;, &quot; self.ensure_connection()&quot;, &quot; File \&quot;/var/lib/awx/venv/awx/lib64/python3.6/site-packages/django/db/backends/base/base.py\&quot;, line 217, in ensure_connection&quot;, &quot; self.connect()&quot;, &quot; File \&quot;/var/lib/awx/venv/awx/lib64/python3.6/site-packages/django/db/utils.py\&quot;, line 89, in __exit__&quot;, &quot; raise dj_exc_value.with_traceback(traceback) from exc_value&quot;, &quot; File \&quot;/var/lib/awx/venv/awx/lib64/python3.6/site-packages/django/db/backends/base/base.py\&quot;, line 217, in ensure_connection&quot;, &quot; self.connect()&quot;, &quot; File \&quot;/var/lib/awx/venv/awx/lib64/python3.6/site-packages/django/db/backends/base/base.py\&quot;, line 195, in connect&quot;, &quot; self.connection = self.get_new_connection(conn_params)&quot;, &quot; File \&quot;/var/lib/awx/venv/awx/lib64/python3.6/site-packages/django/db/backends/postgresql/base.py\&quot;, line 178, in get_new_connection&quot;, &quot; connection = Database.connect(**conn_params)&quot;, &quot; File \&quot;/var/lib/awx/venv/awx/lib64/python3.6/site-packages/psycopg2/__init__.py\&quot;, line 130, in connect&quot;, &quot; conn = _connect(dsn, connection_factory=connection_factory, **kwasync)&quot;, &quot;django.db.utils.OperationalError: FATAL: password authentication failed for user \&quot;awx\&quot;&quot;, &quot;&quot;, &quot;command terminated with exit code 1&quot;], &quot;stdout&quot;: &quot;&quot;, &quot;stdout_lines&quot;: []} PLAY RECAP ******************************************************************************************************************************************************************************************************** localhost : ok=24 changed=10 unreachable=0 failed=1 skipped=47 rescued=0 ignored=3 ``` I can install when I've modified inventory as follows. ```diff # This will create or update a default admin (superuser) account in AWX, if not provided # then these default values are used -admin_user=admin +admin_user=awx admin_password=password ``` ##### ENVIRONMENT * AWX version: 7.0.0 * AWX install method: k8s * Ansible version: 2.8.4 * Operating System: CentOS 7.6.1810 * Web Browser: ##### STEPS TO REPRODUCE - setup k8s - update inventory file - exec `ansible-playbook -i inventory install.yml` &lt;!-- Please describe exactly how to reproduce the problem. --&gt; ##### EXPECTED RESULTS successfully installed &lt;!-- What did you expect to happen when running the steps above? --&gt; ##### ACTUAL RESULTS installer failed &lt;!-- What actually happened? --&gt; ##### ADDITIONAL INFORMATION &lt;!-- Include any links to sosreport, database dumps, screenshots or other information. --&gt;</DESCRIPTION>
  <REPONAME>awx</REPONAME>
  <TIMEDIFFERENCEDAYS>39</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #4700 from ryanpetrello/remove-iso-key add a management command for unsetting the isolated SSH key</MESSAGE>
    <SHA>011f62beba3bb3e810e567f2dc2998f67029441d</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Merge pull request #4737 from rooftopcellist/sat_include_port_381 Use port in rhsm.conf for subscriptions [3.8.1]</MESSAGE>
      <SHA>e6e8a1b4fd93626ab05aaf8b5ee89c4196b509e6</SHA>
      <PATCHEDFILES>
        <FILE>awx/main/utils/licensing.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
