<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>12992</ISSUENO>
  <ISSUEURL>https://github.com/ansible/awx/issues/12992</ISSUEURL>
  <TITLE>scm_url doesn't allow [IPV6]:portnum format</TITLE>
  <DESCRIPTION>### Please confirm the following - [X] I agree to follow this project's [code of conduct](https://docs.ansible.com/ansible/latest/community/code_of_conduct.html). - [X] I have checked the [current issues](https://github.com/ansible/awx/issues) for duplicates. - [X] I understand that AWX is open source software provided for free and that I might not receive a timely response. ### Bug Summary IPv6 addresses like `http://user:pass@[4444:5555:6666:7777:8888:11]:3000/sbf/foster.git` throws an error when attempting to sync a project with that scm_url `update_scm_url` is where the traceback is the issue is that we strip down the address and reform it, but when reforming we don't add the brackets back in. `netloc = u'@'.join(filter(None, [netloc, parts.hostname]))` parts.hostname does not include the brackets if the original url had brackets around the hostname, then we should re-add them back in ### AWX version awx: 21.5.1.dev244+g5b5aac675b.d20221003 ### Select the relevant components - [ ] UI - [X] API - [ ] Docs - [ ] Collection - [ ] CLI - [ ] Other ### Installation method docker development environment ### Modifications no ### Ansible version _No response_ ### Operating system _No response_ ### Web browser _No response_ ### Steps to reproduce create project with scm_url `http://user:pass@[4444:5555:6666:7777:8888:11]:3000/sbf/foster.git` attempt to launch a job ### Expected results job runs ### Actual results ```Traceback (most recent call last): File &quot;/awx_devel/awx/main/utils/common.py&quot;, line 249, in update_scm_url if scm_type not in ('git', 'svn', 'insights', 'archive'): File &quot;/usr/lib64/python3.9/urllib/parse.py&quot;, line 178, in port raise ValueError(message) from None ValueError: Port could not be cast to integer value as '5555:6666:7777:8888:11:3000' During handling of the above exception, another exception occurred: Traceback (most recent call last): File &quot;/awx_devel/awx/main/tasks/jobs.py&quot;, line 512, in run self.build_extra_vars_file(self.instance, private_data_dir) File &quot;/awx_devel/awx/main/tasks/jobs.py&quot;, line 1228, in build_extra_vars_file scm_url, extra_vars_new = self._build_scm_url_extra_vars(project_update) File &quot;/awx_devel/awx/main/tasks/jobs.py&quot;, line 1203, in _build_scm_url_extra_vars scm_url = update_scm_url(scm_type, scm_url, scp_format=True) File &quot;/awx_devel/awx/main/utils/common.py&quot;, line 249, in update_scm_url if scm_type not in ('git', 'svn', 'insights', 'archive'): ValueError: Invalid git URL``` ### Additional information _No response_</DESCRIPTION>
  <REPONAME>awx</REPONAME>
  <TIMEDIFFERENCEDAYS>1</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #12728 from john-westcott-iv/ig_fallback Adding prevent_instance_group_fallback</MESSAGE>
    <SHA>534763727f58b5e06153f6d0db01553bfcf7823a</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Better handle IPv6 in util function update_scm_url - Firstly -- add a bunch of unit tests for `update_scm_url`, because it previously had none and desperately needed them. - Secondly -- fix #12992 by adding back in IPv6 address brackets if they existed in the first place when the function was called. - Thirdly -- fix a related case where we disallowed IPv6 in URLs that did not include the scheme. Signed-off-by: Rick Elrod &lt;rick@elrod.me&gt;</MESSAGE>
      <SHA>c0dab09790ee066f982fb3c84c291b71093c679e</SHA>
      <PATCHEDFILES>
        <FILE>awx/main/tests/unit/utils/test_common.py</FILE>
        <FILE>awx/main/utils/common.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Better handle IPv6 in util function update_scm_url - Firstly -- add a bunch of unit tests for `update_scm_url`, because it previously had none and desperately needed them. - Secondly -- fix #12992 by adding back in IPv6 address brackets if they existed in the first place when the function was called. - Thirdly -- fix a related case where we disallowed IPv6 in URLs that did not include the scheme. Signed-off-by: Rick Elrod &lt;rick@elrod.me&gt;</MESSAGE>
      <SHA>1010112160306c713e730f9f150d623ad8b0791f</SHA>
      <PATCHEDFILES>
        <FILE>awx/main/tests/unit/utils/test_common.py</FILE>
        <FILE>awx/main/utils/common.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Better handle IPv6 in util function update_scm_url (#12995) - Firstly -- add a bunch of unit tests for `update_scm_url`, because it previously had none and desperately needed them. - Secondly -- fix #12992 by adding back in IPv6 address brackets if they existed in the first place when the function was called. - Thirdly -- fix a related case where we disallowed IPv6 in URLs that did not include the scheme. Signed-off-by: Rick Elrod &lt;rick@elrod.me&gt;</MESSAGE>
      <SHA>03eaeac459f80c96335a609e9700d3f4262950e5</SHA>
      <PATCHEDFILES>
        <FILE>awx/main/tests/unit/utils/test_common.py</FILE>
        <FILE>awx/main/utils/common.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
