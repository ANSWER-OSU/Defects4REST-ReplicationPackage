<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>736</ISSUENO>
  <ISSUEURL>https://github.com/getredash/redash/issues/736</ISSUEURL>
  <TITLE>Problem with creating new users</TITLE>
  <DESCRIPTION>Problems: 1. New users can't login 2. User list not showing 3. Impossible to add any user to any group How to repeat: 1. Add new user 2. Try to login ``` [2016-01-06 16:36:37,232: ERROR/MainProcess] Task redash.tasks.record_event[3ca6f961-65d7-44ec-b22e-b8a285d926f3] raised unexpected: KeyError('org_id',) Traceback (most recent call last): File &quot;/usr/local/lib/python2.7/dist-packages/celery/app/trace.py&quot;, line 240, in trace_task R = retval = fun(*args, **kwargs) File &quot;/opt/redash/redash.0.9.0.b1292/redash/tasks.py&quot;, line 31, in __call__ return super(BaseTask, self).__call__(*args, **kwargs) File &quot;/usr/local/lib/python2.7/dist-packages/celery/app/trace.py&quot;, line 437, in __protected_call__ return self.run(*args, **kwargs) File &quot;/opt/redash/redash.0.9.0.b1292/redash/tasks.py&quot;, line 301, in record_event models.Event.record(event) File &quot;/opt/redash/redash.0.9.0.b1292/redash/models.py&quot;, line 1007, in record org = event.pop('org_id') KeyError: 'org_id' ``` Solution is add new user to group, but it cannot be done through web. ``` update public.users set groups='{2}' where id=%NEW_USER_ID%; ```</DESCRIPTION>
  <REPONAME>redash</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Upgrade Sentry client to support new flask-login</MESSAGE>
    <SHA>07a709d59afb6ee80e87699955b06d07c4e1221b</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fix #736: user missing groups &amp; events missing ord_id</MESSAGE>
      <SHA>13252bb0af5c0b0876f4e67e4f0d9936663190d7</SHA>
      <PATCHEDFILES>
        <FILE>redash/authentication/__init__.py</FILE>
        <FILE>redash/handlers/alerts.py</FILE>
        <FILE>redash/handlers/base.py</FILE>
        <FILE>redash/handlers/events.py</FILE>
        <FILE>redash/handlers/groups.py</FILE>
        <FILE>redash/handlers/query_results.py</FILE>
        <FILE>redash/handlers/users.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fix #736: user missing groups &amp; events missing ord_id</MESSAGE>
      <SHA>21298040f75b6ac49c9f27ef4146af9d8cced9d0</SHA>
      <PATCHEDFILES>
        <FILE>authentication/__init__.py</FILE>
        <FILE>handlers/alerts.py</FILE>
        <FILE>handlers/base.py</FILE>
        <FILE>handlers/events.py</FILE>
        <FILE>handlers/groups.py</FILE>
        <FILE>handlers/query_results.py</FILE>
        <FILE>handlers/users.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
