<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>792</ISSUENO>
  <ISSUEURL>https://github.com/getredash/redash/issues/792</ISSUEURL>
  <TITLE>Cannot grant admin with manage.py</TITLE>
  <DESCRIPTION>Running: ``` cd /opt/redash/current ./bin/run ./manage.py users grant_admin &quot;user@domain.com&quot; ``` Produces the following error: ``` ubuntu@aws:/opt/redash/current$ sudo -u redash ./bin/run ./manage.py users grant_admin &quot;user@domain.com&quot; [2016-01-22 15:57:56,612][PID:31825][WARNING][redash.query_runner] GoogleSpreadsheet query runner enabled but not supported, not registering. Either disable or install missing dependencies. [2016-01-22 15:57:56,622][PID:31825][WARNING][redash.query_runner] MQL query runner enabled but not supported, not registering. Either disable or install missing dependencies. [2016-01-22 15:57:56,633][PID:31825][WARNING][redash.query_runner] InfluxDB query runner enabled but not supported, not registering. Either disable or install missing dependencies. [2016-01-22 15:57:56,633][PID:31825][WARNING][redash.query_runner] Presto query runner enabled but not supported, not registering. Either disable or install missing dependencies. [2016-01-22 15:57:56,634][PID:31825][WARNING][redash.query_runner] Vertica query runner enabled but not supported, not registering. Either disable or install missing dependencies. [2016-01-22 15:57:56,635][PID:31825][WARNING][redash.query_runner] TreasureData query runner enabled but not supported, not registering. Either disable or install missing dependencies. [2016-01-22 15:57:56,635][PID:31825][WARNING][redash.query_runner] Oracle query runner enabled but not supported, not registering. Either disable or install missing dependencies. [2016-01-22 15:57:56,846][PID:31825][ERROR][peewee] UPDATE &quot;users&quot; SET &quot;updated_at&quot; = %s, &quot;created_at&quot; = %s, &quot;org_id&quot; = %s, &quot;name&quot; = %s, &quot;email&quot; = %s, &quot;password_hash&quot; = %s, &quot;groups&quot; = %s, &quot;api_key&quot; = %s WHERE (&quot;users&quot;.&quot;id&quot; = %s) [datetime.datetime(2016, 1, 22, 15, 57, 56, 845456), datetime.datetime(2015, 7, 31, 13, 45, 9, 924407, tzinfo=psycopg2.tz.FixedOffsetTimezone(offset=0, name=None)), 1, u'User Name', u'user@domain.com', None, [6, 1, 2, 4, 3, 11, 'admin'], u'&lt;hash&gt;', 2] Traceback (most recent call last): File &quot;/usr/local/lib/python2.7/dist-packages/playhouse/postgres_ext.py&quot;, line 360, in execute_sql cursor.execute(sql, params or ()) DataError: invalid input syntax for integer: &quot;admin&quot; LINE 1: ...hash&quot; = NULL, &quot;groups&quot; = ARRAY[6, 1, 2, 4, 3, 11, 'admin'], ... ^ Traceback (most recent call last): File &quot;/opt/redash/redash.0.9.1.b1377/manage.py&quot;, line 58, in &lt;module&gt; manager.run() File &quot;/usr/local/lib/python2.7/dist-packages/flask_script/__init__.py&quot;, line 405, in run result = self.handle(sys.argv[0], sys.argv[1:]) File &quot;/usr/local/lib/python2.7/dist-packages/flask_script/__init__.py&quot;, line 384, in handle return handle(app, *positional_args, **kwargs) File &quot;/usr/local/lib/python2.7/dist-packages/flask_script/commands.py&quot;, line 145, in handle return self.run(*args, **kwargs) File &quot;/usr/local/lib/python2.7/dist-packages/flask/ctx.py&quot;, line 386, in __exit__ self.auto_pop(exc_value) File &quot;/usr/local/lib/python2.7/dist-packages/flask/ctx.py&quot;, line 374, in auto_pop self.pop(exc) File &quot;/usr/local/lib/python2.7/dist-packages/flask/ctx.py&quot;, line 341, in pop self.app.do_teardown_request(exc) File &quot;/usr/local/lib/python2.7/dist-packages/flask/app.py&quot;, line 1714, in do_teardown_request rv = func(exc) File &quot;/opt/redash/redash.0.9.1.b1377/redash/metrics/request.py&quot;, line 39, in calculate_metrics_on_exception calculate_metrics(MockResponse(500, '?', -1)) File &quot;/opt/redash/redash.0.9.1.b1377/redash/metrics/request.py&quot;, line 17, in calculate_metrics request_duration = (time.time() - g.start_time) * 1000 File &quot;/usr/local/lib/python2.7/dist-packages/werkzeug/local.py&quot;, line 343, in __getattr__ return getattr(self._get_current_object(), name) AttributeError: '_AppCtxGlobals' object has no attribute 'start_time' ``` It looks as though it is trying to add `'admin'` to an `integer[]`. I am currently running version `0.9.1+b1377`</DESCRIPTION>
  <REPONAME>redash</REPONAME>
  <TIMEDIFFERENCEDAYS>1</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #781 from woei66/master Amazon Linux bootstrap script: check nginx default directory</MESSAGE>
    <SHA>78ba6f27394aa8976fb587c04baa40073ae26ec3</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fix #792: can't grant admin with CLI</MESSAGE>
      <SHA>fed9d80fdb3a227e89007396f5c964c3186a3cf0</SHA>
      <PATCHEDFILES>
        <FILE>redash/cli/users.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Merge pull request #794 from getredash/hotfixes Fixes for #792, #785, #733 and additional logging for execute_query</MESSAGE>
      <SHA>4e9b60ac8202fc978398f59bfae88d34ddffb292</SHA>
      <PATCHEDFILES>
        <FILE>docs/setup.rst</FILE>
        <FILE>migrations/0003_update_data_source_config.py</FILE>
        <FILE>migrations/0009_add_api_key_to_user.py</FILE>
        <FILE>migrations/0011_migrate_bigquery_to_json.py</FILE>
        <FILE>migrations/0012_add_list_users_permission.py</FILE>
        <FILE>migrations/0014_add_alert_rearm_seconds.py</FILE>
        <FILE>migrations/0014_migrate_existing_es_to_kibana.py</FILE>
        <FILE>migrations/0015_add_schedule_query_permission.py</FILE>
        <FILE>rd_ui/app/scripts/controllers/users.js</FILE>
        <FILE>rd_ui/app/views/users/show.html</FILE>
        <FILE>redash/cli/users.py</FILE>
        <FILE>redash/tasks.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fix #792: can't grant admin with CLI</MESSAGE>
      <SHA>325a845225adcc95fd1f68eb21ff505472bf99b5</SHA>
      <PATCHEDFILES>
        <FILE>cli/users.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
