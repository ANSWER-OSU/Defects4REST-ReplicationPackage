<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>1668</ISSUENO>
  <ISSUEURL>https://github.com/getredash/redash/issues/1668</ISSUEURL>
  <TITLE>SAML group assignment doesn't seem to work</TITLE>
  <DESCRIPTION>According to the documentation, sending a `RedashGroups` attribute should set the user's groups. However, this doesn't seem to work. Adding `pprint` debugging in `saml_auth.py`, I can see the necessary attribute is being sent: ``` [2017-03-13 14:12:58,516][PID:923][INFO][saml2.response] Subject NameID: &lt;?xml version='1.0' encoding='UTF-8'?&gt; &lt;ns0:NameID xmlns:ns0=&quot;urn:oasis:names:tc:SAML:2.0:assertion&quot; Format=&quot;urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress&quot; NameQualifier=&quot;https://login.torchbox.com/idp/shibboleth&quot; SPNameQualifier=&quot;https://redash.torchbox.com/&quot;&gt;felicity@torchbox.com&lt;/ns0:NameID&gt; {'FirstName': ['Felicity'], 'LastName': ['Tarnell'], 'RedashGroups': ['wagtail', 'tech', 'developers', 'drupal', 'admin', 'sysadmin'], 'mail': ['felicity@torchbox.com']} [2017-03-13 14:13:00,362][PID:923][INFO][metrics] method=POST path=/saml/callback endpoint=saml_auth.idp_initiated status=302 content_type=text/html; charset=utf-8 content_length=209 duration=2076.67 query_count=4 query_duration=1527.05 ``` However, while the user is logged in correctly, they are not a member of any groups besides `default`. (I tried pre-creating a new group called `sysadmin`, which didn't make any difference; the `admin` group already exists anyway.)</DESCRIPTION>
  <REPONAME>redash</REPONAME>
  <TIMEDIFFERENCEDAYS>324</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #2231 from kravets-levko/feature/wide-table 100%-wide results table</MESSAGE>
    <SHA>a4d9ed5418193c7f463734c47af409a785053aaa</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>fix: commit saml user group assignment to the database Relevant tests were also modified to reload the user object from the database before asserting that the user belongs to correct groups. Fixes #1668.</MESSAGE>
      <SHA>fe2772e9db8edf3cc7fe8816c5efaecb279c113c</SHA>
      <PATCHEDFILES>
        <FILE>redash/models.py</FILE>
        <FILE>tests/models/test_users.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>fix: commit saml user group assignment to the database Relevant tests were also modified to reload the user object from the database before asserting that the user belongs to correct groups. Fixes #1668.</MESSAGE>
      <SHA>fc0e347c987034529b26ffcafd231bec129f4ebe</SHA>
      <PATCHEDFILES>
        <FILE>models.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
