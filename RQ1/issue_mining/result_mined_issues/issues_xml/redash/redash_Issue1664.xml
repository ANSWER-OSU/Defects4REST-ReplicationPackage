<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>1664</ISSUENO>
  <ISSUEURL>https://github.com/getredash/redash/issues/1664</ISSUEURL>
  <TITLE>Cannot download CSV from MongoDB Results when rows have missing columns</TITLE>
  <DESCRIPTION>This works fine in the Excel download however. ``` File &quot;/redash/handlers/query_results.py&quot;, line 172, in get response = self.make_csv_response(query_result) File &quot;/redash/handlers/query_results.py&quot;, line 199, in make_csv_response writer.writerow(row) File &quot;/usr/lib64/python2.7/csv.py&quot;, line 148, in writerow return self.writer.writerow(self._dict_to_list(rowdict)) File &quot;/usr/lib64/python2.7/csv.py&quot;, line 144, in _dict_to_list &quot;, &quot;.join(wrong_fields)) ValueError: dict contains fields not in fieldnames: _id ```</DESCRIPTION>
  <REPONAME>redash</REPONAME>
  <TIMEDIFFERENCEDAYS>62</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #1754 from getredash/fix_ds_new Fix: properties of data source were not reset when changing type.</MESSAGE>
    <SHA>24f3e071e393d1934d58929e04c9bf2560261e39</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>fix #1664</MESSAGE>
      <SHA>17b9f976c8176779c9f84e4a5dedafe1c61191b5</SHA>
      <PATCHEDFILES>
        <FILE>redash/models.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>fix #1664</MESSAGE>
      <SHA>f332ce4db08b35a09308148498ddfe003208784b</SHA>
      <PATCHEDFILES>
        <FILE>redash/models.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>fix #1664</MESSAGE>
      <SHA>b1772885d0478ee0dd9ff48cbeacdcca97a54a04</SHA>
      <PATCHEDFILES>
        <FILE>models.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
