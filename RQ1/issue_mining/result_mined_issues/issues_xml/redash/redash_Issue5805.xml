<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>5805</ISSUENO>
  <ISSUEURL>https://github.com/getredash/redash/issues/5805</ISSUEURL>
  <TITLE>Clean checkout M1 docker-compose up -d fails with ModuleNotFoundError: No module named 'Cython'</TITLE>
  <DESCRIPTION>&lt;!-- We use GitHub only for bug reports Anything else should be posted to https://discuss.redash.io For support, help &amp; questions use https://discuss.redash.io/c/support For feature requests &amp; ideas use https://discuss.redash.io/c/feature-requests **Found a security vulnerability?** Please email security@redash.io to report any security vulnerabilities. We will acknowledge receipt of your vulnerability and strive to send you regular updates about our progress. If you're curious about the status of your disclosure please feel free to email us again. If you want to encrypt your disclosure email, you can use this PGP key. --&gt; ### Issue Summary Clean checkout Apple M1 pro docker-compose up -d fails with ModuleNotFoundError: No module named 'Cython' on master(4186f8303ee28d5cde7ca248c57df9023eba6224) Docker desktop .6.0 (75818) ``` =&gt; ERROR [redash_worker stage-1 8/15] RUN if [ &quot;x$skip_ds_deps&quot; = &quot;x&quot; ] ; then pip install -r requirements_all_ds.txt ; else echo &quot;Skipping pip install -r requirements_all_ds.txt&quot; 4.0s ------ &gt; [redash_worker stage-1 8/15] RUN if [ &quot;x$skip_ds_deps&quot; = &quot;x&quot; ] ; then pip install -r requirements_all_ds.txt ; else echo &quot;Skipping pip install -r requirements_all_ds.txt&quot; ; fi: #17 0.555 Collecting google-api-python-client==1.7.11 #17 0.602 Downloading google-api-python-client-1.7.11.tar.gz (142 kB) #17 1.083 Collecting protobuf==3.17.3 #17 2.004 Downloading protobuf-3.17.3-cp37-cp37m-manylinux2014_aarch64.whl (922 kB) #17 2.127 Collecting gspread==3.1.0 #17 2.134 Downloading gspread-3.1.0-py3-none-any.whl (16 kB) #17 2.161 Collecting impyla==0.16.0 #17 2.168 Downloading impyla-0.16.0.tar.gz (235 kB) #17 2.390 Collecting influxdb==5.2.3 #17 2.396 Downloading influxdb-5.2.3-py2.py3-none-any.whl (73 kB) #17 2.434 Collecting mysqlclient==1.3.14 #17 2.440 Downloading mysqlclient-1.3.14.tar.gz (91 kB) #17 2.624 Collecting oauth2client==4.1.3 #17 2.630 Downloading oauth2client-4.1.3-py2.py3-none-any.whl (98 kB) #17 2.656 Collecting pyhive==0.6.1 #17 2.663 Downloading PyHive-0.6.1.tar.gz (41 kB) #17 3.278 Collecting pymongo[srv,tls]==3.9.0 #17 3.287 Downloading pymongo-3.9.0.tar.gz (701 kB) #17 3.574 Collecting vertica-python==0.9.5 #17 3.581 Downloading vertica_python-0.9.5-py2.py3-none-any.whl (137 kB) #17 3.621 Collecting td-client==1.0.0 #17 3.628 Downloading td_client-1.0.0-py3-none-any.whl (78 kB) #17 3.705 Collecting pymssql==2.1.4 #17 3.713 Downloading pymssql-2.1.4.tar.gz (691 kB) #17 3.927 ERROR: Command errored out with exit status 1: #17 3.927 command: /usr/local/bin/python -c 'import sys, setuptools, tokenize; sys.argv[0] = '&quot;'&quot;'/tmp/pip-install-yrvn6v20/pymssql/setup.py'&quot;'&quot;'; __file__='&quot;'&quot;'/tmp/pip-install-yrvn6v20/pymssql/setup.py'&quot;'&quot;';f=getattr(tokenize, '&quot;'&quot;'open'&quot;'&quot;', open)(__file__);code=f.read().replace('&quot;'&quot;'\r\n'&quot;'&quot;', '&quot;'&quot;'\n'&quot;'&quot;');f.close();exec(compile(code, __file__, '&quot;'&quot;'exec'&quot;'&quot;'))' egg_info --egg-base /tmp/pip-pip-egg-info-17xsw5as #17 3.927 cwd: /tmp/pip-install-yrvn6v20/pymssql/ #17 3.927 Complete output (7 lines): #17 3.927 /usr/local/lib/python3.7/site-packages/setuptools/dist.py:51: DistDeprecationWarning: Do not call this function #17 3.927 warnings.warn(&quot;Do not call this function&quot;, DistDeprecationWarning) #17 3.927 Traceback (most recent call last): #17 3.927 File &quot;&lt;string&gt;&quot;, line 1, in &lt;module&gt; #17 3.927 File &quot;/tmp/pip-install-yrvn6v20/pymssql/setup.py&quot;, line 88, in &lt;module&gt; #17 3.927 from Cython.Distutils import build_ext as _build_ext #17 3.927 ModuleNotFoundError: No module named 'Cython' #17 3.927 ---------------------------------------- #17 3.928 ERROR: Command errored out with exit status 1: python setup.py egg_info Check the logs for full command output. ------ failed to solve: executor failed running [/bin/sh -c if [ &quot;x$skip_ds_deps&quot; = &quot;x&quot; ] ; then pip install -r requirements_all_ds.txt ; else echo &quot;Skipping pip install -r requirements_all_ds.txt&quot; ; fi]: exit code: 1 ``` ### Steps to Reproduce 1. Git clone 2. Set .env with only a cookie var 3. docker-compose up -d Seems a dep is missing, or at least pip hell. ### Technical details: * Redash Version: 4186f8303ee28d5cde7ca248c57df9023eba6224 * Browser/OS: Safari * How did you install Redash: docker-compose up -d</DESCRIPTION>
  <REPONAME>redash</REPONAME>
  <TIMEDIFFERENCEDAYS>241</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Improve visibility of error message during schema retrieval (#5879) * handle query execution error in one place. increase ability to debug issues with schema retrieval * split message and details for error reporting Co-authored-by: Dmitriy Apollonin &lt;dmitriy.apollonin@aspireiq.com&gt;</MESSAGE>
    <SHA>5cf13afafe4a13c8db9da645d9667bc26fd118c5</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Build ARM docker image reference https://github.com/getredash/redash/issues/5805#issuecomment-1324096463</MESSAGE>
      <SHA>a61a0f6cf72bd76193086ae12be7055747590ebb</SHA>
      <PATCHEDFILES>
        <FILE>requirements_all_ds.txt</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
