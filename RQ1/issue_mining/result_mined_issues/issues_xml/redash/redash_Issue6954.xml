<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>6954</ISSUENO>
  <ISSUEURL>https://github.com/getredash/redash/issues/6954</ISSUEURL>
  <TITLE>DB upgrade from 8 -&gt; preview fails</TITLE>
  <DESCRIPTION>### Issue Summary Running in EKS, pulling latest preview and using LDAP auth. Getting the following error, during DB upgrade ``` [2024-05-08 02:18:27,791][PID:145][INFO][alembic.runtime.migration] Running upgrade e5c7a4e2df4d -&gt; d7d747033183, encrypt alert destinations Traceback (most recent call last): File &quot;./manage.py&quot;, line 9, in &lt;module&gt; manager() File &quot;/usr/local/lib/python3.8/site-packages/click/core.py&quot;, line 1130, in __call__ return self.main(*args, **kwargs) File &quot;/usr/local/lib/python3.8/site-packages/click/core.py&quot;, line 1055, in main rv = self.invoke(ctx) File &quot;/usr/local/lib/python3.8/site-packages/click/core.py&quot;, line 1657, in invoke return _process_result(sub_ctx.command.invoke(sub_ctx)) File &quot;/usr/local/lib/python3.8/site-packages/click/core.py&quot;, line 1657, in invoke return _process_result(sub_ctx.command.invoke(sub_ctx)) File &quot;/usr/local/lib/python3.8/site-packages/click/core.py&quot;, line 1404, in invoke return ctx.invoke(self.callback, **ctx.params) File &quot;/usr/local/lib/python3.8/site-packages/click/core.py&quot;, line 760, in invoke return __callback(*args, **kwargs) File &quot;/usr/local/lib/python3.8/site-packages/click/decorators.py&quot;, line 26, in new_func return f(get_current_context(), *args, **kwargs) File &quot;/usr/local/lib/python3.8/site-packages/flask/cli.py&quot;, line 357, in decorator return __ctx.invoke(f, *args, **kwargs) File &quot;/usr/local/lib/python3.8/site-packages/click/core.py&quot;, line 760, in invoke return __callback(*args, **kwargs) File &quot;/usr/local/lib/python3.8/site-packages/flask_migrate/cli.py&quot;, line 134, in upgrade _upgrade(directory, revision, sql, tag, x_arg) File &quot;/usr/local/lib/python3.8/site-packages/flask_migrate/__init__.py&quot;, line 95, in wrapped f(*args, **kwargs) File &quot;/usr/local/lib/python3.8/site-packages/flask_migrate/__init__.py&quot;, line 280, in upgrade command.upgrade(config, revision, sql=sql, tag=tag) File &quot;/usr/local/lib/python3.8/site-packages/alembic/command.py&quot;, line 403, in upgrade script.run_env() File &quot;/usr/local/lib/python3.8/site-packages/alembic/script/base.py&quot;, line 583, in run_env util.load_python_file(self.dir, &quot;env.py&quot;) File &quot;/usr/local/lib/python3.8/site-packages/alembic/util/pyfiles.py&quot;, line 95, in load_python_file module = load_module_py(module_id, path) File &quot;/usr/local/lib/python3.8/site-packages/alembic/util/pyfiles.py&quot;, line 113, in load_module_py spec.loader.exec_module(module) # type: ignore File &quot;&lt;frozen importlib._bootstrap_external&gt;&quot;, line 843, in exec_module File &quot;&lt;frozen importlib._bootstrap&gt;&quot;, line 219, in _call_with_frames_removed File &quot;migrations/env.py&quot;, line 93, in &lt;module&gt; run_migrations_online() File &quot;migrations/env.py&quot;, line 85, in run_migrations_online context.run_migrations() File &quot;&lt;string&gt;&quot;, line 8, in run_migrations File &quot;/usr/local/lib/python3.8/site-packages/alembic/runtime/environment.py&quot;, line 948, in run_migrations self.get_context().run_migrations(**kw) File &quot;/usr/local/lib/python3.8/site-packages/alembic/runtime/migration.py&quot;, line 627, in run_migrations step.migration_fn(**kw) File &quot;/app/migrations/versions/d7d747033183_encrypt_alert_destinations.py&quot;, line 60, in upgrade .values(encrypted_options=dest.options) File &quot;/usr/local/lib/python3.8/site-packages/sqlalchemy/sql/type_api.py&quot;, line 1278, in process return process_value(impl_processor(value), dialect) File &quot;/usr/local/lib/python3.8/site-packages/sqlalchemy/sql/sqltypes.py&quot;, line 946, in process value = bytes(value) TypeError: string argument without an encoding ```</DESCRIPTION>
  <REPONAME>redash</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Remove defaults set during schema upgrade/downgrade (#7068)</MESSAGE>
    <SHA>41142274710ce767510fbcf6e22bb1aee018821c</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Revert &quot;Removed unused configuration class (#6682)&quot; This reverts commit 97db4925317b65abefc957fe47cf83a95c772c53. Based on information in https://github.com/getredash/redash/issues/6954#issuecomment-2176999381</MESSAGE>
      <SHA>1476a99d04ad5fa836a50fd15c57cdf546b3d14f</SHA>
      <PATCHEDFILES>
        <FILE>migrations/versions/98af61feea92_add_encrypted_options_to_data_sources.py</FILE>
        <FILE>migrations/versions/d7d747033183_encrypt_alert_destinations.py</FILE>
        <FILE>redash/models/__init__.py</FILE>
        <FILE>redash/models/types.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
