<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>1538</ISSUENO>
  <ISSUEURL>https://github.com/getredash/redash/issues/1538</ISSUEURL>
  <TITLE>KeyError: 'properties' in Elasticsearch query runner</TITLE>
  <DESCRIPTION>Hello, I encount KeyError: 'properties' in Elasticsearch query runner. I'm using Bitnami version of Re:dash 0.12.0.2449 ### Mapping &lt;pre&gt; { &quot;tmp_index&quot;: { &quot;mappings&quot;: { &quot;_default_&quot;: { &quot;dynamic_templates&quot;: [ { ... } ] }, &quot;tmp_index&quot;: { &quot;dynamic_templates&quot;: [ { ... } ], &quot;properties&quot;: { ... } } } } } &lt;/pre&gt; Mappings of &quot;\_default_&quot; has no &quot;properties&quot; field. ### Work around &lt;pre&gt; --- /opt/redash-0.12.0.2449-0/apps/redash/htdocs/redash/query_runner/elasticsearch.py.old 2017-01-22 17:42:18.008000000 -0500 +++ /opt/redash-0.12.0.2449-0/apps/redash/htdocs/redash/query_runner/elasticsearch.py 2017-01-22 16:52:33.448000000 -0500 @@ -108,6 +108,8 @@ for index_name in mappings_data: index_mappings = mappings_data[index_name] for m in index_mappings.get(&quot;mappings&quot;, {}): + if &quot;properties&quot; not in index_mappings[&quot;mappings&quot;][m]: + continue for property_name in index_mappings[&quot;mappings&quot;][m][&quot;properties&quot;]: property_data = index_mappings[&quot;mappings&quot;][m][&quot;properties&quot;][property_name] if not property_name in mappings: &lt;/pre&gt; Thanks.</DESCRIPTION>
  <REPONAME>redash</REPONAME>
  <TIMEDIFFERENCEDAYS>3</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #1508 from stefanseifert/feature/jql-custom-fields [Jira JQL] Add: support custom JIRA fields and enhance value mapping</MESSAGE>
    <SHA>a9d5c7eead4013c6d2a1585af98bf8d3a8ded9a7</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fix issue #1538</MESSAGE>
      <SHA>e550697dd52a2ead56758e75152a6267f3863ec2</SHA>
      <PATCHEDFILES>
        <FILE>query_runner/elasticsearch.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
