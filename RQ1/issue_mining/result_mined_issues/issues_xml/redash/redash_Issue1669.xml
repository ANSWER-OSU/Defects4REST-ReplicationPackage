<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>1669</ISSUENO>
  <ISSUEURL>https://github.com/getredash/redash/issues/1669</ISSUEURL>
  <TITLE>SAML: Don't require signed assertions</TITLE>
  <DESCRIPTION>Currently Redash requires signed SAML assertions. This is mostly legacy functionality, and isn't needed when the response itself is signed. Most IdPs will not sign assertions by default (requiring special configuration), but will sign the response, as that's what the vast majority of SPs expect. In `saml_auth.py`: ``` 'want_assertions_signed': True, 'want_response_signed': False, ``` This should probably be reversed: ``` 'want_assertions_signed': False, 'want_response_signed': True, ```</DESCRIPTION>
  <REPONAME>redash</REPONAME>
  <TIMEDIFFERENCEDAYS>2212</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #2171 from mayconbordin/salesforce_api_version Added API version to salesforce query runner</MESSAGE>
    <SHA>0c05102fe725c572c19f6cf1ad30a81a31ba1a36</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>feat: make SAML signature requirements configurable These changes make it possible to configure if the SAML based authentication requires the IDP to sign individual assertions, whole response or both. These values can be configured both globally via environmental variables or through organization specific settings from the Admin UI / API. The two environmental variables provide global defaults for these values: * REDASH_SAML_WANT_ASSERTIONS_SIGNED * REDASH_SAML_WANT_RESPONSE_SIGNED If these variables are not present, they default to the previously hardcoded values (want_signed_assertions = True and want_response_signed = False). This is done to ensure existing installations do not break on upgrade. A test has been written to ensure this behavior persists. Alternatively, these two variables can be modified on per-organization basis from the Admin UI. These configurations override the global defaults set via the environment. Special care has been taken to ensure that it's not possible to disable signing requirements completely. If the two environmental variables are both disabled while SAML is enabled, the server will instruct the user to enable at least signing requirement and refuse to start. Similarly, the UI will not let the user to disable both signing requirements and the API will return a 400 response if signing requirements are going to be disabled. Tests have also been written to test the backend functionality. Closes #1669.</MESSAGE>
      <SHA>ed940a3ac842a73cd7a2a835e5f14bf546c86a42</SHA>
      <PATCHEDFILES>
        <FILE>client/app/pages/settings/organization.html</FILE>
        <FILE>client/app/pages/settings/organization.js</FILE>
        <FILE>redash/authentication/saml_auth.py</FILE>
        <FILE>redash/handlers/settings.py</FILE>
        <FILE>redash/settings/helpers.py</FILE>
        <FILE>redash/settings/organization.py</FILE>
        <FILE>tests/handlers/test_settings.py</FILE>
        <FILE>tests/models/test_organization.py</FILE>
        <FILE>tests/settings/__init__.py</FILE>
        <FILE>tests/settings/test_helpers.py</FILE>
        <FILE>tests/settings/test_organization.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Add auth_saml_sp_settings to allow configuring https://github.com/getredash/redash/issues/1669 (SAML: Don't require signed assertions)</MESSAGE>
      <SHA>96da0059f50bdac3900ae3fe27deec0412c5d022</SHA>
      <PATCHEDFILES>
        <FILE>redash/authentication/saml_auth.py</FILE>
        <FILE>redash/settings/organization.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
