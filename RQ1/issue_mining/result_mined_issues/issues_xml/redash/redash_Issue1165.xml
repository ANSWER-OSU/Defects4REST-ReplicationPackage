<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>1165</ISSUENO>
  <ISSUEURL>https://github.com/getredash/redash/issues/1165</ISSUEURL>
  <TITLE>[v0.11.0]Migration Error</TITLE>
  <DESCRIPTION>Migration error occurred. ### 0023_add_notification_destination.py https://github.com/getredash/redash/blob/master/migrations/0023_add_notification_destination.py#L30 insert notification_destination user_id is hard cording (user_id = 1).. ``` Apply new migrations? (make sure you have backup) [Y/n] Y Applying 0023_add_notification_destination.py... [stgredash01] run: sudo sudo -u redash PYTHONPATH=. bin/run python migrations/0023_add_notification_destination.py [stgredash01] out: sudo: unable to resolve host ip-10-0-91-221 [stgredash01] out: sudo: unable to resolve host ip-10-0-91-221 [stgredash01] out: [2016-07-01 13:22:35,867][PID:22392][WARNING][redash.query_runner] GoogleSpreadsheet query runner enabled but not supported, not registering. Either disable or install missing dependencies. [stgredash01] out: [2016-07-01 13:22:35,933][PID:22392][WARNING][redash.query_runner] Hive query runner enabled but not supported, not registering. Either disable or install missing dependencies. [stgredash01] out: [2016-07-01 13:22:35,935][PID:22392][WARNING][redash.query_runner] Vertica query runner enabled but not supported, not registering. Either disable or install missing dependencies. [stgredash01] out: [2016-07-01 13:22:35,936][PID:22392][WARNING][redash.query_runner] TreasureData query runner enabled but not supported, not registering. Either disable or install missing dependencies. [stgredash01] out: [2016-07-01 13:22:35,947][PID:22392][WARNING][redash.query_runner] Microsoft SQL Server query runner enabled but not supported, not registering. Either disable or install missing dependencies. [stgredash01] out: [2016-07-01 13:22:36,069][PID:22392][ERROR][peewee] INSERT INTO &quot;notification_destinations&quot; (&quot;org_id&quot;, &quot;user_id&quot;, &quot;name&quot;, &quot;type&quot;, &quot;options&quot;, &quot;created_at&quot;) VALUES (%s, %s, %s, %s, %s, %s) RETURNING &quot;id&quot; [1, 1, u'HipChat', u'hipchat', '{&quot;url&quot;: &quot;https://hipchat.com/v2/room/670754/notification?auth_token=3139ccbf0e8977454df1ac47345ff1&quot;}', datetime.datetime(2016, 7, 1, 13, 22, 36, 67469)] [stgredash01] out: Traceback (most recent call last): [stgredash01] out: File &quot;/usr/local/lib/python2.7/dist-packages/playhouse/postgres_ext.py&quot;, line 360, in execute_sql [stgredash01] out: cursor.execute(sql, params or ()) [stgredash01] out: IntegrityError: insert or update on table &quot;notification_destinations&quot; violates foreign key constraint &quot;notification_destinations_user_id_fkey&quot; [stgredash01] out: DETAIL: Key (user_id)=(1) is not present in table &quot;users&quot;. [stgredash01] out: [stgredash01] out: Traceback (most recent call last): [stgredash01] out: File &quot;migrations/0023_add_notification_destination.py&quot;, line 63, in &lt;module&gt; [stgredash01] out: options=options [stgredash01] out: File &quot;/usr/local/lib/python2.7/dist-packages/peewee.py&quot;, line 4001, in create [stgredash01] out: inst.save(force_insert=True) [stgredash01] out: File &quot;/opt/redash/redash.0.11.0.b2005/redash/models.py&quot;, line 99, in save [stgredash01] out: super(BaseModel, self).save(*args, **kwargs) [stgredash01] out: File &quot;/usr/local/lib/python2.7/dist-packages/peewee.py&quot;, line 4148, in save [stgredash01] out: pk_from_cursor = self.insert(**field_dict).execute() [stgredash01] out: File &quot;/usr/local/lib/python2.7/dist-packages/peewee.py&quot;, line 2858, in execute [stgredash01] out: cursor = self._execute() [stgredash01] out: File &quot;/opt/redash/redash.0.11.0.b2005/redash/metrics/database.py&quot;, line 50, in metered_execute [stgredash01] out: result = real_execute(self, *args, **kwargs) [stgredash01] out: File &quot;/usr/local/lib/python2.7/dist-packages/peewee.py&quot;, line 2371, in _execute [stgredash01] out: return self.database.execute_sql(sql, params, self.require_commit) [stgredash01] out: File &quot;/opt/redash/redash.0.11.0.b2005/redash/metrics/database.py&quot;, line 22, in execute_sql [stgredash01] out: result = super(MeteredPostgresqlExtDatabase, self).execute_sql(*args, **kwargs) [stgredash01] out: File &quot;/usr/local/lib/python2.7/dist-packages/playhouse/postgres_ext.py&quot;, line 369, in execute_sql [stgredash01] out: self.commit() [stgredash01] out: File &quot;/usr/local/lib/python2.7/dist-packages/peewee.py&quot;, line 2922, in __exit__ [stgredash01] out: reraise(new_type, new_type(*exc_value.args), traceback) [stgredash01] out: File &quot;/usr/local/lib/python2.7/dist-packages/playhouse/postgres_ext.py&quot;, line 360, in execute_sql [stgredash01] out: cursor.execute(sql, params or ()) [stgredash01] out: peewee.IntegrityError: insert or update on table &quot;notification_destinations&quot; violates foreign key constraint &quot;notification_destinations_user_id_fkey&quot; [stgredash01] out: DETAIL: Key (user_id)=(1) is not present in table &quot;users&quot;. ```</DESCRIPTION>
  <REPONAME>redash</REPONAME>
  <TIMEDIFFERENCEDAYS>2</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #1164 from darabos/patch-1 Docs: update permission documentation</MESSAGE>
    <SHA>cbe02218003cb095ee734a1b30c0b91ccfcef1cb</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fix #1165: don't use hard coded org/user.</MESSAGE>
      <SHA>860392be49a40fda2aab9e2acf26a6b98ceb69e4</SHA>
      <PATCHEDFILES>
        <FILE>migrations/0023_add_notification_destination.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
