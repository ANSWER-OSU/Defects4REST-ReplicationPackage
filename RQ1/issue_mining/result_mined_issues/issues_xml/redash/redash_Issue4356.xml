<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>4356</ISSUENO>
  <ISSUEURL>https://github.com/getredash/redash/issues/4356</ISSUEURL>
  <TITLE>Azure Data Warehouse through MS SQL (ODBC) runner doesn't work on a default docker image</TITLE>
  <DESCRIPTION>### Issue Summary [Default docker image](https://github.com/getredash/redash/blob/v8.0.0/Dockerfile) has neither pyodbc nor Microsoft ODBC Driver installed, so you can't query Azure Data Warehouse with default docker image, even if you enable pyodbc. ### Steps to Reproduce 1. Have Redash running in docker 2. Enable mssql_odbc query runner through env: `REDASH_ADDITIONAL_QUERY_RUNNERS: &quot;redash.query_runner.mssql_odbc&quot;` 3. It doesn't get registered: `[2019-11-13 13:29:19,823][PID:10][DEBUG][redash.query_runner] Microsoft SQL Server (ODBC) query runner enabled but not supported, not registering. Either disable or install missing dependencies.` 4. I found out why: a) `pyodbc==4.0.27` pypi package is missing in `requirements_all_ds.txt` b) Even if you put it in `requirements_all_ds.txt` , it can't be downloaded &amp; built by pip because you don't have `g++ unixodbc-dev` package installed c) Even if you get `g++ unixodbc-dev`, you still need Microsoft ODBC Driver installed: `msodbcsql17` 5. this line in Dockerfile fixes packages, you also have to add `pyodbc` to `requirements_all_ds.txt`: ```Dockerfile RUN curl https://packages.microsoft.com/keys/microsoft.asc | apt-key add - &amp;&amp; curl https://packages.microsoft.com/config/debian/10/prod.list &gt; /etc/apt/sources.list.d/mssql-release.list &amp;&amp; apt-get update &amp;&amp; ACCEPT_EULA=Y apt-get install -y msodbcsql17 g++ unixodbc-dev ``` So I see the main problem as: * You can't query Azure SQL/Data Warehouse straight out of the box Is it even possible to package all these dependencies into standard Redash docker image and make it work without apt-get and pyodbc troubles? That means accepting Microsoft's EULA, and some native dependencies, e.g. pyodbc builds itself from source. I haven't measured image size increase but `apt-get` writes `After this operation, 15.8 MB of additional disk space will be used` ```bash The license terms for this product can be downloaded from https://aka.ms/odbc131eula and found in /usr/share/doc/msodbcsql/LICENSE.TXT . By entering 'YES', you indicate that you accept the license terms. ``` The runner itself(#1906) works. I just had to spend 30 minutes to make it run in docker. ### Technical details: * Redash Version: 8 Thanks for the awesome v8 release!</DESCRIPTION>
  <REPONAME>redash</REPONAME>
  <TIMEDIFFERENCEDAYS>100</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Query Editor: Remove overflow visible from visualization (#4668)</MESSAGE>
    <SHA>d2cc2d20b6712230e0966f9259ad67b6d433db7e</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Enable ODBC and MS SQL ODBC support Closes #4356.</MESSAGE>
      <SHA>d01c9227a5bfd4ae90ae224cdec431642077b259</SHA>
      <PATCHEDFILES>
        <FILE>Dockerfile</FILE>
        <FILE>client/app/assets/images/db-logos/mssql_odbc.png</FILE>
        <FILE>redash/query_runner/mssql_odbc.py</FILE>
        <FILE>redash/settings/__init__.py</FILE>
        <FILE>requirements_all_ds.txt</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Enable ODBC and MS SQL ODBC support (#4676) Closes #4356.</MESSAGE>
      <SHA>f1a2f8cb889f7c460bf511e825b2ae291a0e67c8</SHA>
      <PATCHEDFILES>
        <FILE>Dockerfile</FILE>
        <FILE>client/app/assets/images/db-logos/mssql_odbc.png</FILE>
        <FILE>redash/query_runner/mssql_odbc.py</FILE>
        <FILE>redash/settings/__init__.py</FILE>
        <FILE>requirements_all_ds.txt</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
