<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>4270</ISSUENO>
  <ISSUEURL>https://github.com/seaweedfs/seaweedfs/issues/4270</ISSUEURL>
  <TITLE>filer api should return client error (4XX) code instead 500 if dir already exists</TITLE>
  <DESCRIPTION>Sponsors SeaweedFS via Patreon https://www.patreon.com/seaweedfs **Describe the bug** Right now if `dir` (filer.path) exists and `/POST` request is sent to that dir, filer returns `500 internal server error` with message `{&quot;error&quot;:&quot;dir /foo already exists&quot;}`. Ideally here filer should return Client Error (4XX) code like `409` instead of `500`. **System Setup** Setup contains empty storage with default settings started using below commands ``` weed master -mdir=&quot;.&quot; -ip=localhost weed volume -max=100 -mserver=&quot;localhost:9333&quot; -dir=&quot;./data&quot; weed filer -ip=localhost -port=8888 -master=localhost:9333 ``` Weed version is `version 30GB 3.33 ee7bf69c0396098bce2d030f24dba5085c392b7c linux amd64`. Below are steps to reproduce ``` curl -vvv -X POST &quot;http://localhost:8888/foo/&quot; * Trying 127.0.0.1:8888... * Connected to localhost (127.0.0.1) port 8888 (#0) &gt; POST /foo/ HTTP/1.1 &gt; Host: localhost:8888 &gt; User-Agent: curl/7.81.0 &gt; Accept: */* &gt; * Mark bundle as not supporting multiuse &lt; HTTP/1.1 201 Created &lt; Content-Type: application/json &lt; Server: SeaweedFS Filer 30GB 3.33 &lt; Date: Sun, 05 Mar 2023 07:25:46 GMT &lt; Content-Length: 14 &lt; * Connection #0 to host localhost left intact {&quot;name&quot;:&quot;foo&quot;} % curl -vvv -X POST &quot;http://localhost:8888/foo/&quot; * Trying 127.0.0.1:8888... * Connected to localhost (127.0.0.1) port 8888 (#0) &gt; POST /foo/ HTTP/1.1 &gt; Host: localhost:8888 &gt; User-Agent: curl/7.81.0 &gt; Accept: */* &gt; * Mark bundle as not supporting multiuse &lt; HTTP/1.1 500 Internal Server Error &lt; Content-Type: application/json &lt; Server: SeaweedFS Filer 30GB 3.33 &lt; Date: Sun, 05 Mar 2023 07:27:18 GMT &lt; Content-Length: 35 &lt; * Connection #0 to host localhost left intact {&quot;error&quot;:&quot;dir /foo already exists&quot;}% ``` **Expected behavior** filer should return Client Error (4XX) code like `409` instead of `500`</DESCRIPTION>
  <REPONAME>seaweedfs</REPONAME>
  <TIMEDIFFERENCEDAYS>3</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>added secret envs to filer (#4284)</MESSAGE>
    <SHA>889ecf5c9d14be3ef360fef9ee8542e167b97265</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>#4270 set http status code to 409 if dir already exists</MESSAGE>
      <SHA>4e52f3311e89d5115c5bc73544b1c51d79b7a15b</SHA>
      <PATCHEDFILES>
        <FILE>weed/server/filer_server_handlers_write_autochunk.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#4270 set http status code to 409 if dir already exists (#4287)</MESSAGE>
      <SHA>59706c89fb3d2ab325a36ef237e147f99d6d259e</SHA>
      <PATCHEDFILES>
        <FILE>weed/server/filer_server_handlers_write_autochunk.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
