<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>6136</ISSUENO>
  <ISSUEURL>https://github.com/seaweedfs/seaweedfs/issues/6136</ISSUEURL>
  <TITLE>Example nginx configuration does not work after upgrading to 3.75</TITLE>
  <DESCRIPTION>Using example configuration https://github.com/seaweedfs/seaweedfs/wiki/S3-Nginx-Proxy With version 3.73 it works fine Once upgrading to 3.75 (or 3.76 or 3.77) we get the following error: ``` $ rclone lsd dropbox: &lt;3&gt;ERROR : : error listing: SignatureDoesNotMatch: The request signature we calculated does not match the signature you provided. Check your key and signing method. status code: 403, request id: 1729085633541862383, host id: Failed to lsd with 2 errors: last error was: SignatureDoesNotMatch: The request signature we calculated does not match the signature you provided. Check your key and signing method. status code: 403, request id: 1729085633541862383, host id: ``` rclone config: ``` [dropbox] type = s3 provider = SeaweedFS env_auth = false access_key_id = xxxx secret_access_key = xxx endpoint = https://dropbox.my.domain acl = private ``` nginx config: ``` server { listen 443 ssl; listen [::]:443 ssl; http2 on; # Assumes that your subdomain is s3 # The regex will support path style as well as virtual-hosted style bucket URLs # path style: http://s3.yourdomain.com/mybucket # virtual-hosted style: http://mybucket.s3.yourdomain.com server_name ~^(?:(?&lt;bucket&gt;[^.]+)\.)dropbox\.my\.domain; ssl_protocols TLSv1.2 TLSv1.3; ssl_certificate /etc/ssl/private/xxxxxxxxxxxxx ssl_certificate_key /etc/ssl/private/xxxxxxxxxxx ignore_invalid_headers off; client_max_body_size 0; proxy_buffering off; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $remote_addr; proxy_set_header X-Forwarded-Proto $scheme; proxy_connect_timeout 300; proxy_http_version 1.1; proxy_set_header Connection &quot;&quot;; chunked_transfer_encoding off; # If bucket subdomain is not empty, # rewrite request to backend. if ($bucket != &quot;&quot;) { rewrite (.*) /$bucket$1 last; } location / { proxy_pass http://localhost:8333/; } } ```</DESCRIPTION>
  <REPONAME>seaweedfs</REPONAME>
  <TIMEDIFFERENCEDAYS>7</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>[helm] Allow setting notification.toml config (#6159) * [helm] Allow setting notification.toml config * [helm] Set notification config conditionally</MESSAGE>
    <SHA>a3b97bfe0317f3c948c7a09c42f48dce2d5a4146</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>remove X-Forwarded-For fix https://github.com/seaweedfs/seaweedfs/issues/6136</MESSAGE>
      <SHA>1c2b10303aab6961bc005dbf41df81209f839335</SHA>
      <PATCHEDFILES>
        <FILE>weed/s3api/auth_signature_v4.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
