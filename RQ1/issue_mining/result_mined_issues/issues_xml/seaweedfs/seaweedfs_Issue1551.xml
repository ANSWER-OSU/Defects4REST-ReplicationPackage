<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>1551</ISSUENO>
  <ISSUEURL>https://github.com/seaweedfs/seaweedfs/issues/1551</ISSUEURL>
  <TITLE>[Git 6e8c2bfd - 8000GB Build] ec.balance is using incorrect filenames</TITLE>
  <DESCRIPTION>I've been testing distribution and error handling, and have been forcing ec's with the following command: &gt; lock &gt; ec.encode -fullPercent=0.001 -quietFor=1s &gt; unlock This has been successfully creating ec shards, but when the balance is run, it's referencing the wrong filename. Excerpt from the log below: ``` Oct 21 22:24:39 bedb-master1 weed[8055]: I1021 22:24:39 8055 master_server.go:259] error: balance across racks collection fax-mke1 ec shards: copy 14.[7] 10.60.1.213:8080 =&gt; 10.60.31.211:8080 : rpc error: code = Unknown desc = VolumeEcShardsCopy volume 14: failed to copy /usr/local/seaweedvol/fax-mke1_14.ec07 file: receiving /usr/local/seaweedvol/fax-mke1_14.ec07: rpc error: code = Unknown desc = CopyFile not found ec volume id 14 ``` The 'fax-mke1_' prefix does not exist on the source volume server ``` root@mke1-vol3:/usr/local/seaweedvol# ls -al /usr/local/seaweedvol/*14.ec07 -rw-r--r-- 1 www-data www-data 1048576 Oct 21 22:12 /usr/local/seaweedvol/14.ec07 root@mke1-vol3:/usr/local/seaweedvol# ``` In fact, there is only one file that matches *14.ec07 (as you would expect), and that is not tagged with the fax-mke1 prefix. ``` [root@xrobau ansible]# ansible seaweed_volservers -i hosts -m shell -a 'ls -al /usr/local/seaweedvol/*14.ec07' 10.60.1.211 | FAILED | rc=2 &gt;&gt; ls: cannot access '/usr/local/seaweedvol/*14.ec07': No such file or directorynon-zero return code 10.60.1.212 | FAILED | rc=2 &gt;&gt; ls: cannot access '/usr/local/seaweedvol/*14.ec07': No such file or directorynon-zero return code 10.60.1.213 | CHANGED | rc=0 &gt;&gt; -rw-r--r-- 1 www-data www-data 1048576 Oct 21 22:12 /usr/local/seaweedvol/14.ec07 10.60.11.212 | FAILED | rc=2 &gt;&gt; ls: cannot access '/usr/local/seaweedvol/*14.ec07': No such file or directorynon-zero return code 10.60.11.211 | FAILED | rc=2 &gt;&gt; ls: cannot access '/usr/local/seaweedvol/*14.ec07': No such file or directorynon-zero return code 10.60.31.211 | CHANGED | rc=0 &gt;&gt; -rw-r--r-- 1 www-data www-data 0 Oct 22 03:24 /usr/local/seaweedvol/fax-mke1_14.ec07 [root@xrobau ansible]# ``` Note that a zero-byte file was CREATED, but never used. As a possible related point, that 'mke-fax1' collection was originally created using the s3 endpoint, but then was FUSE Mounted and rsync'ed data directly into it.</DESCRIPTION>
  <REPONAME>seaweedfs</REPONAME>
  <TIMEDIFFERENCEDAYS>25</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>shortcut for appending operations</MESSAGE>
    <SHA>f5ee19e0dbf761a0adbaa84c337e3ca35e605baf</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>UI fix on rendering EC volumes addressing UI problem with https://github.com/chrislusf/seaweedfs/issues/1551</MESSAGE>
      <SHA>4ff2ceee33e24bab025eaa9ce547783e6cbab2db</SHA>
      <PATCHEDFILES>
        <FILE>weed/storage/erasure_coding/ec_volume.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
