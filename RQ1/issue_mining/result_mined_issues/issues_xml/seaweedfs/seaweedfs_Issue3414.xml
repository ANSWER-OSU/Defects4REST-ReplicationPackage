<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>3414</ISSUENO>
  <ISSUEURL>https://github.com/seaweedfs/seaweedfs/issues/3414</ISSUEURL>
  <TITLE>Turn off output from fs.meta.load / Increase performance</TITLE>
  <DESCRIPTION>Sponsors SeaweedFS via Patreon https://www.patreon.com/seaweedfs Report issues here. Ask questions here https://stackoverflow.com/questions/tagged/seaweedfs Please ask questions in https://github.com/seaweedfs/seaweedfs/discussions example of a good issue report: https://github.com/seaweedfs/seaweedfs/issues/1005 example of a bad issue report: https://github.com/seaweedfs/seaweedfs/issues/1008 **Describe the bug** When saving meta data from `weed shell` it's very quick and silent. However when restoring meta data via `weed shell` `fs.meta.load` it's very chatty and outputs the list of files. I have 2.3GB of meta data and after 12hrs it's still scrolling away, I've given up restoring meta data and now reloading the cluster as it's quicker to copy the test data in again. I'm wondering if silencing the output or reducing the output to something like a percentage counter would help with speed? **System Setup** OS Ubuntu 22.04 for master, volume and filers. 3 x masters 3 x filers using CockroachDB or leveldb3 (2 different tests and not at the same time, both systems seem to take far too long to restore the meta data) 6 x volume servers filer.toml ``` [filer.options] recursive_delete = false [leveldb3] enabled = false dir = &quot;/var/seaweedfs/filer/filerldb3&quot; ``` Volume servers: ``` /usr/local/bin/weed -logtostderr volume \ -ip xxxx -ip.bind 0.0.0.0 \ -port 8080 -port.grpc 18080 \ -max 0 -index leveldb \ -dir /var/seaweedfs/volume \ -dataCenter=syd1 -rack=rack1 -mserver=xxxx:9333,xxxx:9333,xxxx:9333 ``` Masters: ``` /usr/local/bin/weed -logtostderr master \ -ip xxxx -ip.bind 0.0.0.0 \ -port 9333 -port.grpc 19333 \ -mdir=/var/seaweedfs/master -defaultReplication=001 \ -volumeSizeLimitMB=30000 \ -peers=xxxx:9333,xxxx:9333,xxxx:9333 ``` ``` weed version version 30GB 3.18 475185fb723b50e05f0afe39f7f529302bcee11a linux amd64 ``` **Expected behavior** Meta data should reload in a timely fashion, 12hrs+ for around 2TB of data is too slow. **Screenshots** If applicable, add screenshots to help explain your problem. **Additional context** I don't see any particular component as having a high load, there's plenty of available RAM, CPU and Disk IO. Hence why I'll looking at getting rid of the output first to see what effect that has. Thanks.</DESCRIPTION>
  <REPONAME>seaweedfs</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Allow postgresql to use standard environment variables for connection (#3413)</MESSAGE>
    <SHA>23d4e78f5599b87688b8b3c205b5bbab0388c26d</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>shell: fs.meta.load add quieter mode fix https://github.com/seaweedfs/seaweedfs/issues/3414</MESSAGE>
      <SHA>a0378eb1cf23086e3bc76eb4a3e70e7c66424186</SHA>
      <PATCHEDFILES>
        <FILE>weed/shell/command_fs_meta_load.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
