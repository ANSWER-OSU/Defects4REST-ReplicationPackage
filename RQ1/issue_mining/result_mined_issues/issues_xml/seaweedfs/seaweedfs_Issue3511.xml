<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>3511</ISSUENO>
  <ISSUEURL>https://github.com/seaweedfs/seaweedfs/issues/3511</ISSUEURL>
  <TITLE>[master] DATA RACE on Created Volume</TITLE>
  <DESCRIPTION>https://github.com/seaweedfs/seaweedfs/issues/3507 ``` master_1 | I0825 10:09:15.382114 volume_layout.go:391 Volume 2 becomes writable master_1 | I0825 10:09:15.382262 volume_growth.go:245 Created Volume 2 on topo:DefaultDataCenter:DefaultRack:volume:8080 master_1 | ================== master_1 | WARNING: DATA RACE master_1 | Read at 0x00c0001abb60 by goroutine 127: master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*VolumeLayout).HasGrowRequest() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/volume_layout.go:322 +0x3c master_1 | github.com/seaweedfs/seaweedfs/weed/server.(*MasterServer).Assign() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/server/master_grpc_server_volume.go:145 +0x9c4 master_1 | github.com/seaweedfs/seaweedfs/weed/pb/master_pb._Seaweed_Assign_Handler() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/pb/master_pb/master_grpc.pb.go:426 +0x25a master_1 | google.golang.org/grpc.(*Server).processUnaryRPC() master_1 | /go/pkg/mod/google.golang.org/grpc@v1.48.0/server.go:1295 +0x11c9 master_1 | google.golang.org/grpc.(*Server).handleStream() master_1 | /go/pkg/mod/google.golang.org/grpc@v1.48.0/server.go:1636 +0xff8 master_1 | google.golang.org/grpc.(*Server).serveStreams.func1.2() master_1 | /go/pkg/mod/google.golang.org/grpc@v1.48.0/server.go:932 +0xec master_1 | master_1 | Previous write at 0x00c0001abb60 by goroutine 126: master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*VolumeLayout).DoneGrowRequest() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/volume_layout.go:333 +0x325 master_1 | github.com/seaweedfs/seaweedfs/weed/server.(*MasterServer).ProcessGrowRequest.func1.2() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/server/master_grpc_server_volume.go:62 +0x299 master_1 | master_1 | Goroutine 127 (running) created at: master_1 | google.golang.org/grpc.(*Server).serveStreams.func1() master_1 | /go/pkg/mod/google.golang.org/grpc@v1.48.0/server.go:930 +0x4dd master_1 | google.golang.org/grpc/internal/transport.(*http2Server).operateHeaders() master_1 | /go/pkg/mod/google.golang.org/grpc@v1.48.0/internal/transport/http2_server.go:603 +0x3329 master_1 | google.golang.org/grpc/internal/transport.(*http2Server).HandleStreams() master_1 | /go/pkg/mod/google.golang.org/grpc@v1.48.0/internal/transport/http2_server.go:648 +0x378 master_1 | google.golang.org/grpc.(*Server).serveStreams() master_1 | /go/pkg/mod/google.golang.org/grpc@v1.48.0/server.go:916 +0x275 master_1 | google.golang.org/grpc.(*Server).handleRawConn.func1() master_1 | /go/pkg/mod/google.golang.org/grpc@v1.48.0/server.go:858 +0x64 master_1 | master_1 | Goroutine 126 (finished) created at: master_1 | github.com/seaweedfs/seaweedfs/weed/server.(*MasterServer).ProcessGrowRequest.func1() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/server/master_grpc_server_volume.go:52 +0x3eb master_1 | ================== ```</DESCRIPTION>
  <REPONAME>seaweedfs</REPONAME>
  <TIMEDIFFERENCEDAYS>4</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>3.24</MESSAGE>
    <SHA>b7a887fea16ecef7832a60818bf9b30e6600a258</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>avoid race conditions access to growRequestCount https://github.com/seaweedfs/seaweedfs/issues/3511</MESSAGE>
      <SHA>a9da6b206adaa2b32149b49bcc7f8f61ea1ef6c6</SHA>
      <PATCHEDFILES>
        <FILE>weed/topology/volume_layout.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>avoid race conditions access to growRequestCount (#3537) https://github.com/seaweedfs/seaweedfs/issues/3511</MESSAGE>
      <SHA>4966a3abc75524a28a91359b65ab3b9ca3e2bdf4</SHA>
      <PATCHEDFILES>
        <FILE>weed/topology/volume_layout.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
