<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>3567</ISSUENO>
  <ISSUEURL>https://github.com/seaweedfs/seaweedfs/issues/3567</ISSUEURL>
  <TITLE>[filer] filler entry is created when the file could not be replicated</TITLE>
  <DESCRIPTION>**Describe the bug** When trying to replace a file, the filler deleted the file due to a replication error ``` E0901 08:52:06.822605 filer_replication.go:107 replicate /buckets/jupyterhub-cloud/shared/OsK/df_test.csv: LookupFileId volume id 499: rpc error: code = Unavailable desc = error reading from server: read tcp 172.24.196.35:35436-&gt;172.19.38.164:19090: read: connection reset by peer E0901 08:53:57.476085 filer_replication.go:112 replicated /buckets/jupyterhub-cloud/shared/OsK/Ревью/df_test.csv E0901 08:53:57.702945 filer_replication.go:104 modify: /buckets/jupyterhub-cloud/shared/OsK/Ревью/df_test.csv E0901 08:54:01.456402 filer_util.go:65 delete entry /buckets/jupyterhub-cloud/shared/OsK/df_test.csv: directory:&quot;/buckets/jupyterhub-cloud/shared/OsK&quot; name:&quot;df_test.csv&quot; is_delete_data:true ignore_recursive_error:true ``` ``` Sep 1, 2022 @ 13:54:47.103 | s3-fast-api.query.consul-test/jupyterhub-cloud?delete | 200 | POST | 844 ``` **Expected behavior** Delete only the version of the file that could not be saved to volume file **System Setup** ``` 3.24 dev ``` ![Screenshot 2022-09-01 at 15 33 52](https://user-images.githubusercontent.com/9497591/187894396-d9692ff1-1e4c-41c1-a06a-f6c28cb7aaf8.png) ![Screenshot 2022-09-01 at 15 37 00](https://user-images.githubusercontent.com/9497591/187894720-7f00303b-a196-41e6-8fff-6ddd62e68c84.png)</DESCRIPTION>
  <REPONAME>seaweedfs</REPONAME>
  <TIMEDIFFERENCEDAYS>11</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>upload_content: upload close response.Body</MESSAGE>
    <SHA>4a4ef3cc3c24d0c86defe82445448a567316cc36</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>more error details in the log https://github.com/seaweedfs/seaweedfs/issues/3567</MESSAGE>
      <SHA>d6f87b3112057ebd00ce955dd61dc9ef955fffda</SHA>
      <PATCHEDFILES>
        <FILE>weed/server/common.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>more error details in the log (#3568) * more error details in the log https://github.com/seaweedfs/seaweedfs/issues/3567 * format message</MESSAGE>
      <SHA>82c2ce74dbaac3ae7056177dd1692c80c553b8d2</SHA>
      <PATCHEDFILES>
        <FILE>weed/server/common.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
