<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>2529</ISSUENO>
  <ISSUEURL>https://github.com/seaweedfs/seaweedfs/issues/2529</ISSUEURL>
  <TITLE>master_server.go:292] error: read buckets: get filer configuration: rpc error: code = Unavailable desc = connection error: desc = &quot;transport: Error while dialing dial tcp: lookup '' no such host</TITLE>
  <DESCRIPTION>Sponsors SeaweedFS via Patreon https://www.patreon.com/seaweedfs Report issues here. Ask questions here https://stackoverflow.com/questions/tagged/seaweedfs Please ask questions in https://github.com/chrislusf/seaweedfs/discussions **Describe the bug** Hello. I get an error in the leader master log periodically. ``` master_server.go:292] error: read buckets: get filer configuration: rpc error: code = Unavailable desc = connection error: desc = &quot;transport: Error while dialing dial tcp: lookup 10.193.86.149:8888,10.5.85.76:8888,10.193.86.150:8888,10.5.85.77: no such host&quot; ``` I think this is a bug in the admin scripts on the master. weed master logs ``` I1222 14:04:55 75146 master_server.go:290] executing: lock [] I1222 14:04:55 75146 master_server.go:290] executing: ec.balance [-force] balanceEcVolumes collections 16 balanceEcVolumes collection time-to-live balanceEcVolumes time-to-live balanceEcVolumes collection zabbixdb balanceEcVolumes zabbixdb balanceEcVolumes collection glt-uploads balanceEcVolumes glt-uploads balanceEcVolumes collection gld-uploads balanceEcVolumes gld-uploads balanceEcVolumes collection glt-packages balanceEcVolumes glt-packages balanceEcVolumes collection runners-cache balanceEcVolumes runners-cache balanceEcVolumes collection glt-artifacts balanceEcVolumes glt-artifacts balanceEcVolumes collection testmount balanceEcVolumes testmount balanceEcVolumes collection glt-lfs-objects balanceEcVolumes glt-lfs-objects balanceEcVolumes collection glt-terraform-state balanceEcVolumes glt-terraform-state balanceEcVolumes collection balanceEcVolumes balanceEcVolumes collection glt-pages balanceEcVolumes glt-pages I1222 14:04:55 75146 master_server.go:290] executing: ec.encode [-fullPercent=95 -quietFor=1h] collect volumes quiet for: 3600 seconds ec encode volumes: [] I1222 14:04:55 75146 master_server.go:290] executing: ec.rebuild [-force] rebuildEcVolumes collections 16 rebuildEcVolumes collection glt-uploads rebuildEcVolumes glt-uploads rebuildEcVolumes collection glt-pages rebuildEcVolumes glt-pages rebuildEcVolumes collection time-to-live rebuildEcVolumes time-to-live rebuildEcVolumes collection gld-uploads rebuildEcVolumes gld-uploads rebuildEcVolumes collection glt-artifacts rebuildEcVolumes glt-artifacts rebuildEcVolumes collection glt-terraform-state rebuildEcVolumes glt-terraform-state rebuildEcVolumes collection rebuildEcVolumes rebuildEcVolumes collection zabbixdb rebuildEcVolumes zabbixdb rebuildEcVolumes collection glt-packages rebuildEcVolumes glt-packages rebuildEcVolumes collection runners-cache rebuildEcVolumes runners-cache rebuildEcVolumes collection glt-lfs-objects rebuildEcVolumes glt-lfs-objects rebuildEcVolumes collection testmount rebuildEcVolumes testmount I1222 14:04:55 75146 master_server.go:290] executing: s3.clean.uploads [-timeAgo=24h] I1222 14:04:55 75146 master_server.go:292] error: read buckets: get filer configuration: rpc error: code = Unavailable desc = connection error: desc = &quot;transport: Error while dialing dial tcp: lookup 10.193.86.149:8888,10.5.85.76:8888,10.193.86.150:8888,10.5.85.77: no such host&quot; I1222 14:04:55 75146 master_server.go:290] executing: volume.balance [-force] hdd 0.12 0.23:0.01 hdd 0.12 0.23:0.06 hdd 0.12 0.23:0.09 hdd 0.12 0.23:0.09 hdd 0.12 0.23:0.11 hdd 0.01 0.03:0.01 hdd 0.01 0.03:0.01 hdd 0.01 0.03:0.01 hdd 0.02 0.03:0.02 hdd 0.01 0.02:0.01 hdd 0.02 0.04:0.01 hdd 0.02 0.04:0.01 hdd 0.02 0.04:0.01 hdd 0.42 0.46:0.36 hdd 0.42 0.46:0.41 hdd 0.42 0.46:0.42 hdd 0.42 0.46:0.42 hdd 0.20 0.22:0.19 hdd 0.20 0.22:0.19 hdd 0.20 0.22:0.19 hdd 0.20 0.22:0.20 I1222 14:04:55 75146 master_server.go:290] executing: volume.fix.replication [] I1222 14:04:55 75146 master_server.go:290] executing: unlock [] ``` master.toml ``` [master.maintenance] # periodically run these scripts are the same as running them from 'weed shell' scripts = &quot;&quot;&quot; lock ec.balance -force ec.encode -fullPercent=95 -quietFor=1h ec.rebuild -force s3.clean.uploads -timeAgo=24h volume.balance -force volume.deleteEmpty -quietFor=24h -force volume.fix.replication unlock &quot;&quot;&quot; sleep_minutes = 17 # sleep minutes between each script execution [master.filer] # used by maintenance scripts if the scripts needs to use fs related commands default = &quot;10.193.86.149:8888,10.5.85.76:8888,10.193.86.150:8888,10.5.85.77:8888&quot; [master.sequencer] type = &quot;raft&quot; # Choose [raft|snowflake] type for storing the file id sequence # when sequencer.type = snowflake, the snowflake id must be different from other masters # create this number of logical volumes if no more writable volumes # count_x means how many copies of data. # e.g.: # 000 has only one copy, copy_1 # 010 and 001 has two copies, copy_2 # 011 has only 3 copies, copy_3 [master.volume_growth] copy_1 = 7 # create 1 x 7 = 7 actual volumes copy_2 = 6 # create 2 x 6 = 12 actual volumes copy_3 = 3 # create 3 x 3 = 9 actual volumes copy_other = 1 # create n x 1 = n actual volumes # configuration flags for replication [master.replication] # any replication counts should be considered minimums. If you specify 010 and # have 3 different racks, that's still considered writable. Writes will still # try to replicate to all available volumes. You should only use this option # if you are doing your own replication or periodic sync of volumes. treat_replication_as_minimums = false ``` Maybe the command &quot;s3.clean.uploads -timeAgo = 24h&quot; gives this error? **System Setup** - List the command line to start &quot;weed master&quot;, &quot;weed volume&quot;, &quot;weed filer&quot;, &quot;weed s3&quot;, &quot;weed mount&quot;. - OS version - weed version version 30GB 2.82 c3b73ec23b9c7831e31503ebf3a64cc2f0a3c33d linux amd64 **Expected behavior** Work without mistakes. **Additional context** Second problem. Not all log messages are sent according to the glog format. Please correct the output of the messages. This will help parse them correctly.</DESCRIPTION>
  <REPONAME>seaweedfs</REPONAME>
  <TIMEDIFFERENCEDAYS>1</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>POSIX: check name is too long ENAMETOOLONG</MESSAGE>
    <SHA>cd1ad88f30419f330af22333e1621b92d3a9b695</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>master: remove hard coded filer settings in master.toml fix https://github.com/chrislusf/seaweedfs/issues/2529</MESSAGE>
      <SHA>826a7b307e37299528d7b3b2aa8f374800bd28b6</SHA>
      <PATCHEDFILES>
        <FILE>weed/command/scaffold/master.toml</FILE>
        <FILE>weed/server/master_grpc_server_cluster.go</FILE>
        <FILE>weed/server/master_server.go</FILE>
        <FILE>weed/shell/commands.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
