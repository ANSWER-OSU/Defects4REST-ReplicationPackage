<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>3514</ISSUENO>
  <ISSUEURL>https://github.com/seaweedfs/seaweedfs/issues/3514</ISSUEURL>
  <TITLE>[master] DATA RACE on adds volume id</TITLE>
  <DESCRIPTION>https://github.com/seaweedfs/seaweedfs/issues/3507 ``` volume_1 | I0825 10:41:47.232196 store.go:147 add volume 64 volume_1 | I0825 10:41:47.232755 volume_grpc_client_to_master.go:172 volume server volume:8080 adds volume 64 master_1 | ================== master_1 | WARNING: DATA RACE master_1 | Read at 0x00c0005fe3c0 by goroutine 3493: master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*DiskUsageCounts).addDiskUsageCounts() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/disk.go:103 +0x11e master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*NodeImpl).UpAdjustDiskUsageDelta() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/node.go:193 +0x119 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*Disk).doAddOrUpdateVolume() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/disk.go:165 +0x5c4 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*Disk).AddOrUpdateVolume() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/disk.go:149 +0xe4 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*DataNode).doAddOrUpdateVolume() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/data_node.go:58 +0x7a master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*DataNode).AddOrUpdateVolume() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/data_node.go:43 +0xe4 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*VolumeGrowth).grow() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/volume_growth.go:243 +0x224 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*VolumeGrowth).findAndGrow() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/volume_growth.go:115 +0xf1 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*VolumeGrowth).GrowByCountAndType() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/volume_growth.go:96 +0x1de master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*VolumeGrowth).AutomaticGrowByType() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/volume_growth.go:85 +0x11d master_1 | github.com/seaweedfs/seaweedfs/weed/server.(*MasterServer).ProcessGrowRequest.func1.2() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/server/master_grpc_server_volume.go:55 +0x1b7 master_1 | master_1 | Previous write at 0x00c0005fe3c0 by goroutine 109: master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*DiskUsageCounts).addDiskUsageCounts() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/disk.go:103 +0x153 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*NodeImpl).UpAdjustDiskUsageDelta() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/node.go:193 +0x119 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*DataNode).AdjustMaxVolumeCounts() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/data_node.go:150 +0x2a4 master_1 | github.com/seaweedfs/seaweedfs/weed/server.(*MasterServer).SendHeartbeat() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/server/master_grpc_server.go:135 +0x92b master_1 | github.com/seaweedfs/seaweedfs/weed/pb/master_pb._Seaweed_SendHeartbeat_Handler() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/pb/master_pb/master_grpc.pb.go:351 +0xc5 master_1 | google.golang.org/grpc.(*Server).processStreamingRPC() master_1 | /go/pkg/mod/google.golang.org/grpc@v1.48.0/server.go:1558 +0x1c01 master_1 | google.golang.org/grpc.(*Server).handleStream() master_1 | /go/pkg/mod/google.golang.org/grpc@v1.48.0/server.go:1640 +0xfae master_1 | google.golang.org/grpc.(*Server).serveStreams.func1.2() master_1 | /go/pkg/mod/google.golang.org/grpc@v1.48.0/server.go:932 +0xec master_1 | master_1 | Goroutine 3493 (running) created at: master_1 | github.com/seaweedfs/seaweedfs/weed/server.(*MasterServer).ProcessGrowRequest.func1() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/server/master_grpc_server_volume.go:52 +0x3eb master_1 | master_1 | Goroutine 109 (running) created at: master_1 | google.golang.org/grpc.(*Server).serveStreams.func1() master_1 | /go/pkg/mod/google.golang.org/grpc@v1.48.0/server.go:930 +0x4dd master_1 | google.golang.org/grpc/internal/transport.(*http2Server).operateHeaders() master_1 | /go/pkg/mod/google.golang.org/grpc@v1.48.0/internal/transport/http2_server.go:603 +0x3329 master_1 | google.golang.org/grpc/internal/transport.(*http2Server).HandleStreams() master_1 | /go/pkg/mod/google.golang.org/grpc@v1.48.0/internal/transport/http2_server.go:648 +0x378 master_1 | google.golang.org/grpc.(*Server).serveStreams() master_1 | /go/pkg/mod/google.golang.org/grpc@v1.48.0/server.go:916 +0x275 master_1 | google.golang.org/grpc.(*Server).handleRawConn.func1() master_1 | /go/pkg/mod/google.golang.org/grpc@v1.48.0/server.go:858 +0x64 master_1 | ================== master_1 | ================== master_1 | WARNING: DATA RACE master_1 | Read at 0x00c0005fe3f0 by goroutine 3493: master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*DiskUsageCounts).addDiskUsageCounts() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/disk.go:103 +0x11e master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*NodeImpl).UpAdjustDiskUsageDelta() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/node.go:193 +0x119 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*NodeImpl).UpAdjustDiskUsageDelta() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/node.go:196 +0x341 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*Disk).doAddOrUpdateVolume() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/disk.go:165 +0x5c4 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*Disk).AddOrUpdateVolume() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/disk.go:149 +0xe4 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*DataNode).doAddOrUpdateVolume() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/data_node.go:58 +0x7a master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*DataNode).AddOrUpdateVolume() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/data_node.go:43 +0xe4 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*VolumeGrowth).grow() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/volume_growth.go:243 +0x224 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*VolumeGrowth).findAndGrow() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/volume_growth.go:115 +0xf1 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*VolumeGrowth).GrowByCountAndType() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/volume_growth.go:96 +0x1de master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*VolumeGrowth).AutomaticGrowByType() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/volume_growth.go:85 +0x11d master_1 | github.com/seaweedfs/seaweedfs/weed/server.(*MasterServer).ProcessGrowRequest.func1.2() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/server/master_grpc_server_volume.go:55 +0x1b7 master_1 | master_1 | Previous write at 0x00c0005fe3f0 by goroutine 109: master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*DiskUsageCounts).addDiskUsageCounts() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/disk.go:103 +0x153 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*NodeImpl).UpAdjustDiskUsageDelta() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/node.go:193 +0x119 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*NodeImpl).UpAdjustDiskUsageDelta() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/node.go:196 +0x341 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*DataNode).AdjustMaxVolumeCounts() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/data_node.go:150 +0x2a4 master_1 | github.com/seaweedfs/seaweedfs/weed/server.(*MasterServer).SendHeartbeat() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/server/master_grpc_server.go:135 +0x92b master_1 | github.com/seaweedfs/seaweedfs/weed/pb/master_pb._Seaweed_SendHeartbeat_Handler() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/pb/master_pb/master_grpc.pb.go:351 +0xc5 master_1 | google.golang.org/grpc.(*Server).processStreamingRPC() master_1 | /go/pkg/mod/google.golang.org/grpc@v1.48.0/server.go:1558 +0x1c01 master_1 | google.golang.org/grpc.(*Server).handleStream() master_1 | /go/pkg/mod/google.golang.org/grpc@v1.48.0/server.go:1640 +0xfae master_1 | google.golang.org/grpc.(*Server).serveStreams.func1.2() master_1 | /go/pkg/mod/google.golang.org/grpc@v1.48.0/server.go:932 +0xec master_1 | master_1 | Goroutine 3493 (running) created at: master_1 | github.com/seaweedfs/seaweedfs/weed/server.(*MasterServer).ProcessGrowRequest.func1() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/server/master_grpc_server_volume.go:52 +0x3eb master_1 | master_1 | Goroutine 109 (running) created at: master_1 | google.golang.org/grpc.(*Server).serveStreams.func1() master_1 | /go/pkg/mod/google.golang.org/grpc@v1.48.0/server.go:930 +0x4dd master_1 | google.golang.org/grpc/internal/transport.(*http2Server).operateHeaders() master_1 | /go/pkg/mod/google.golang.org/grpc@v1.48.0/internal/transport/http2_server.go:603 +0x3329 master_1 | google.golang.org/grpc/internal/transport.(*http2Server).HandleStreams() master_1 | /go/pkg/mod/google.golang.org/grpc@v1.48.0/internal/transport/http2_server.go:648 +0x378 master_1 | google.golang.org/grpc.(*Server).serveStreams() master_1 | /go/pkg/mod/google.golang.org/grpc@v1.48.0/server.go:916 +0x275 master_1 | google.golang.org/grpc.(*Server).handleRawConn.func1() master_1 | /go/pkg/mod/google.golang.org/grpc@v1.48.0/server.go:858 +0x64 master_1 | ================== master_1 | ================== master_1 | WARNING: DATA RACE master_1 | Read at 0x00c0005fe430 by goroutine 3493: master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*DiskUsageCounts).addDiskUsageCounts() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/disk.go:105 +0x1cc master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*NodeImpl).UpAdjustDiskUsageDelta() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/node.go:193 +0x119 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*NodeImpl).UpAdjustDiskUsageDelta() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/node.go:196 +0x341 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*NodeImpl).UpAdjustDiskUsageDelta() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/node.go:196 +0x341 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*Disk).doAddOrUpdateVolume() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/disk.go:165 +0x5c4 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*Disk).AddOrUpdateVolume() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/disk.go:149 +0xe4 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*DataNode).doAddOrUpdateVolume() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/data_node.go:58 +0x7a master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*DataNode).AddOrUpdateVolume() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/data_node.go:43 +0xe4 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*VolumeGrowth).grow() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/volume_growth.go:243 +0x224 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*VolumeGrowth).findAndGrow() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/volume_growth.go:115 +0xf1 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*VolumeGrowth).GrowByCountAndType() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/volume_growth.go:96 +0x1de master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*VolumeGrowth).AutomaticGrowByType() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/volume_growth.go:85 +0x11d master_1 | github.com/seaweedfs/seaweedfs/weed/server.(*MasterServer).ProcessGrowRequest.func1.2() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/server/master_grpc_server_volume.go:55 +0x1b7 master_1 | master_1 | Previous write at 0x00c0005fe430 by goroutine 109: master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*DiskUsageCounts).addDiskUsageCounts() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/disk.go:105 +0x208 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*NodeImpl).UpAdjustDiskUsageDelta() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/node.go:193 +0x119 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*NodeImpl).UpAdjustDiskUsageDelta() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/node.go:196 +0x341 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*NodeImpl).UpAdjustDiskUsageDelta() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/node.go:196 +0x341 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*DataNode).AdjustMaxVolumeCounts() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/data_node.go:150 +0x2a4 master_1 | github.com/seaweedfs/seaweedfs/weed/server.(*MasterServer).SendHeartbeat() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/server/master_grpc_server.go:135 +0x92b master_1 | github.com/seaweedfs/seaweedfs/weed/pb/master_pb._Seaweed_SendHeartbeat_Handler() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/pb/master_pb/master_grpc.pb.go:351 +0xc5 master_1 | google.golang.org/grpc.(*Server).processStreamingRPC() master_1 | /go/pkg/mod/google.golang.org/grpc@v1.48.0/server.go:1558 +0x1c01 master_1 | google.golang.org/grpc.(*Server).handleStream() master_1 | /go/pkg/mod/google.golang.org/grpc@v1.48.0/server.go:1640 +0xfae master_1 | google.golang.org/grpc.(*Server).serveStreams.func1.2() master_1 | /go/pkg/mod/google.golang.org/grpc@v1.48.0/server.go:932 +0xec master_1 | master_1 | Goroutine 3493 (running) created at: master_1 | github.com/seaweedfs/seaweedfs/weed/server.(*MasterServer).ProcessGrowRequest.func1() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/server/master_grpc_server_volume.go:52 +0x3eb master_1 | master_1 | Goroutine 109 (running) created at: master_1 | google.golang.org/grpc.(*Server).serveStreams.func1() master_1 | /go/pkg/mod/google.golang.org/grpc@v1.48.0/server.go:930 +0x4dd master_1 | google.golang.org/grpc/internal/transport.(*http2Server).operateHeaders() master_1 | /go/pkg/mod/google.golang.org/grpc@v1.48.0/internal/transport/http2_server.go:603 +0x3329 master_1 | google.golang.org/grpc/internal/transport.(*http2Server).HandleStreams() master_1 | /go/pkg/mod/google.golang.org/grpc@v1.48.0/internal/transport/http2_server.go:648 +0x378 master_1 | google.golang.org/grpc.(*Server).serveStreams() master_1 | /go/pkg/mod/google.golang.org/grpc@v1.48.0/server.go:916 +0x275 master_1 | google.golang.org/grpc.(*Server).handleRawConn.func1() master_1 | /go/pkg/mod/google.golang.org/grpc@v1.48.0/server.go:858 +0x64 master_1 | ================== master_1 | ================== master_1 | WARNING: DATA RACE master_1 | Read at 0x00c0005fe438 by goroutine 3493: master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*DiskUsageCounts).addDiskUsageCounts() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/disk.go:106 +0x227 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*NodeImpl).UpAdjustDiskUsageDelta() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/node.go:193 +0x119 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*NodeImpl).UpAdjustDiskUsageDelta() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/node.go:196 +0x341 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*NodeImpl).UpAdjustDiskUsageDelta() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/node.go:196 +0x341 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*Disk).doAddOrUpdateVolume() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/disk.go:165 +0x5c4 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*Disk).AddOrUpdateVolume() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/disk.go:149 +0xe4 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*DataNode).doAddOrUpdateVolume() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/data_node.go:58 +0x7a master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*DataNode).AddOrUpdateVolume() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/data_node.go:43 +0xe4 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*VolumeGrowth).grow() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/volume_growth.go:243 +0x224 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*VolumeGrowth).findAndGrow() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/volume_growth.go:115 +0xf1 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*VolumeGrowth).GrowByCountAndType() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/volume_growth.go:96 +0x1de master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*VolumeGrowth).AutomaticGrowByType() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/volume_growth.go:85 +0x11d master_1 | github.com/seaweedfs/seaweedfs/weed/server.(*MasterServer).ProcessGrowRequest.func1.2() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/server/master_grpc_server_volume.go:55 +0x1b7 master_1 | master_1 | Previous write at 0x00c0005fe438 by goroutine 109: master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*DiskUsageCounts).addDiskUsageCounts() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/disk.go:106 +0x264 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*NodeImpl).UpAdjustDiskUsageDelta() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/node.go:193 +0x119 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*NodeImpl).UpAdjustDiskUsageDelta() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/node.go:196 +0x341 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*NodeImpl).UpAdjustDiskUsageDelta() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/node.go:196 +0x341 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*DataNode).AdjustMaxVolumeCounts() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/data_node.go:150 +0x2a4 master_1 | github.com/seaweedfs/seaweedfs/weed/server.(*MasterServer).SendHeartbeat() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/server/master_grpc_server.go:135 +0x92b master_1 | github.com/seaweedfs/seaweedfs/weed/pb/master_pb._Seaweed_SendHeartbeat_Handler() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/pb/master_pb/master_grpc.pb.go:351 +0xc5 master_1 | google.golang.org/grpc.(*Server).processStreamingRPC() master_1 | /go/pkg/mod/google.golang.org/grpc@v1.48.0/server.go:1558 +0x1c01 master_1 | google.golang.org/grpc.(*Server).handleStream() master_1 | /go/pkg/mod/google.golang.org/grpc@v1.48.0/server.go:1640 +0xfae master_1 | google.golang.org/grpc.(*Server).serveStreams.func1.2() master_1 | /go/pkg/mod/google.golang.org/grpc@v1.48.0/server.go:932 +0xec master_1 | master_1 | Goroutine 3493 (running) created at: master_1 | github.com/seaweedfs/seaweedfs/weed/server.(*MasterServer).ProcessGrowRequest.func1() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/server/master_grpc_server_volume.go:52 +0x3eb master_1 | master_1 | Goroutine 109 (running) created at: master_1 | google.golang.org/grpc.(*Server).serveStreams.func1() master_1 | /go/pkg/mod/google.golang.org/grpc@v1.48.0/server.go:930 +0x4dd master_1 | google.golang.org/grpc/internal/transport.(*http2Server).operateHeaders() master_1 | /go/pkg/mod/google.golang.org/grpc@v1.48.0/internal/transport/http2_server.go:603 +0x3329 master_1 | google.golang.org/grpc/internal/transport.(*http2Server).HandleStreams() master_1 | /go/pkg/mod/google.golang.org/grpc@v1.48.0/internal/transport/http2_server.go:648 +0x378 master_1 | google.golang.org/grpc.(*Server).serveStreams() master_1 | /go/pkg/mod/google.golang.org/grpc@v1.48.0/server.go:916 +0x275 master_1 | google.golang.org/grpc.(*Server).handleRawConn.func1() master_1 | /go/pkg/mod/google.golang.org/grpc@v1.48.0/server.go:858 +0x64 master_1 | ================== master_1 | ================== master_1 | WARNING: DATA RACE master_1 | Read at 0x00c0005fe4a0 by goroutine 3493: master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*DiskUsageCounts).addDiskUsageCounts() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/disk.go:107 +0x284 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*NodeImpl).UpAdjustDiskUsageDelta() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/node.go:193 +0x119 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*NodeImpl).UpAdjustDiskUsageDelta() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/node.go:196 +0x341 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*NodeImpl).UpAdjustDiskUsageDelta() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/node.go:196 +0x341 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*NodeImpl).UpAdjustDiskUsageDelta() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/node.go:196 +0x341 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*NodeImpl).UpAdjustDiskUsageDelta() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/node.go:196 +0x341 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*Disk).doAddOrUpdateVolume() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/disk.go:165 +0x5c4 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*Disk).AddOrUpdateVolume() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/disk.go:149 +0xe4 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*DataNode).doAddOrUpdateVolume() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/data_node.go:58 +0x7a master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*DataNode).AddOrUpdateVolume() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/data_node.go:43 +0xe4 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*VolumeGrowth).grow() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/volume_growth.go:243 +0x224 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*VolumeGrowth).findAndGrow() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/volume_growth.go:115 +0xf1 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*VolumeGrowth).GrowByCountAndType() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/volume_growth.go:96 +0x1de master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*VolumeGrowth).AutomaticGrowByType() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/volume_growth.go:85 +0x11d master_1 | github.com/seaweedfs/seaweedfs/weed/server.(*MasterServer).ProcessGrowRequest.func1.2() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/server/master_grpc_server_volume.go:55 +0x1b7 master_1 | master_1 | Previous write at 0x00c0005fe4a0 by goroutine 109: master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*DiskUsageCounts).addDiskUsageCounts() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/disk.go:107 +0x2c4 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*NodeImpl).UpAdjustDiskUsageDelta() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/node.go:193 +0x119 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*NodeImpl).UpAdjustDiskUsageDelta() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/node.go:196 +0x341 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*NodeImpl).UpAdjustDiskUsageDelta() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/node.go:196 +0x341 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*NodeImpl).UpAdjustDiskUsageDelta() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/node.go:196 +0x341 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*NodeImpl).UpAdjustDiskUsageDelta() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/node.go:196 +0x341 master_1 | github.com/seaweedfs/seaweedfs/weed/topology.(*DataNode).AdjustMaxVolumeCounts() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/topology/data_node.go:150 +0x2a4 master_1 | github.com/seaweedfs/seaweedfs/weed/server.(*MasterServer).SendHeartbeat() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/server/master_grpc_server.go:135 +0x92b master_1 | github.com/seaweedfs/seaweedfs/weed/pb/master_pb._Seaweed_SendHeartbeat_Handler() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/pb/master_pb/master_grpc.pb.go:351 +0xc5 master_1 | google.golang.org/grpc.(*Server).processStreamingRPC() master_1 | /go/pkg/mod/google.golang.org/grpc@v1.48.0/server.go:1558 +0x1c01 master_1 | google.golang.org/grpc.(*Server).handleStream() master_1 | /go/pkg/mod/google.golang.org/grpc@v1.48.0/server.go:1640 +0xfae master_1 | google.golang.org/grpc.(*Server).serveStreams.func1.2() master_1 | /go/pkg/mod/google.golang.org/grpc@v1.48.0/server.go:932 +0xec master_1 | master_1 | Goroutine 3493 (running) created at: master_1 | github.com/seaweedfs/seaweedfs/weed/server.(*MasterServer).ProcessGrowRequest.func1() master_1 | /go/src/github.com/seaweedfs/seaweedfs/weed/server/master_grpc_server_volume.go:52 +0x3eb master_1 | master_1 | Goroutine 109 (running) created at: master_1 | google.golang.org/grpc.(*Server).serveStreams.func1() master_1 | /go/pkg/mod/google.golang.org/grpc@v1.48.0/server.go:930 +0x4dd master_1 | google.golang.org/grpc/internal/transport.(*http2Server).operateHeaders() master_1 | /go/pkg/mod/google.golang.org/grpc@v1.48.0/internal/transport/http2_server.go:603 +0x3329 master_1 | google.golang.org/grpc/internal/transport.(*http2Server).HandleStreams() master_1 | /go/pkg/mod/google.golang.org/grpc@v1.48.0/internal/transport/http2_server.go:648 +0x378 master_1 | google.golang.org/grpc.(*Server).serveStreams() master_1 | /go/pkg/mod/google.golang.org/grpc@v1.48.0/server.go:916 +0x275 master_1 | google.golang.org/grpc.(*Server).handleRawConn.func1() master_1 | /go/pkg/mod/google.golang.org/grpc@v1.48.0/server.go:858 +0x64 master_1 | ================== master_1 | I0825 10:41:47.255734 volume_layout.go:391 Volume 64 becomes writable master_1 | I0825 10:41:47.255969 volume_growth.go:245 Created Volume 64 on topo:DefaultDataCenter:DefaultRack:volume:8080 ```</DESCRIPTION>
  <REPONAME>seaweedfs</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>minor: adjust ordering</MESSAGE>
    <SHA>a050fe6177952d6a92ee0bf8b74ee1b478f463f1</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>atomic add fix https://github.com/seaweedfs/seaweedfs/issues/3514</MESSAGE>
      <SHA>b7ee59f3572aa9f4d82411d4ebd227e0b056116b</SHA>
      <PATCHEDFILES>
        <FILE>weed/topology/disk.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
