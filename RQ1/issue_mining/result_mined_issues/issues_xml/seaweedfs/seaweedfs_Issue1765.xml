<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>1765</ISSUENO>
  <ISSUEURL>https://github.com/seaweedfs/seaweedfs/issues/1765</ISSUEURL>
  <TITLE>[weed mount] Cannot perceive write failure when no writable volume</TITLE>
  <DESCRIPTION>**Describe the bug** when there is no writable volume server, copy file to file system mounted by `weed mount`, no error message output below the copy command, file's metadata is written to filer store. This misled users and made they think that the copy command works. **System Setup** - List the command line to start &quot;weed master&quot;, &quot;weed volume&quot;, &quot;weed filer&quot;, &quot;weed s3&quot;, &quot;weed mount&quot;. ``` # setup root@dev-4:~/swfs# weed master -port=9333 -mdir=/tmp/master root@dev-4:~/swfs# weed volume -port=8080 -dir=/tmp/volume -max=3 -ip=127.0.0.1 -mserver=127.0.0.1:9333 root@dev-4:~/swfs# weed filer -port=8888 -ip=127.0.0.1 -master=127.0.0.1:9333 root@dev-4:~/swfs# weed mount -filer=127.0.0.1:8888 -cacheDir=/tmp/cache001 -dir=./mnt # shut down volume server use `ctrl + C` # copy a directory to ./mnt root@dev-4:~/swfs/mnt# cp -r /root/mydir ./ ``` - OS version `Ubuntu 18.04.4 LTS` - output of `weed version` `version 30GB 2.13 0e99531 linux amd64` - if using filer, show the content of `filer.toml` `default` **Expected behavior** output error message &amp; no metadata is written to filer store **Screenshots** ![image](https://user-images.githubusercontent.com/28077875/106119887-ab2d7500-6190-11eb-9876-044f87a21192.png) ![image](https://user-images.githubusercontent.com/28077875/106119668-6acdf700-6190-11eb-816d-715059ae1c48.png) **Additional context** Actually i deploy 1 master 、 1filer、 3 volume server in k8s，and replication is `002`. After shutting down a volume server, copy a directory containing some files and subdirectories to seaweed file system mounted by `weed mount`（can not work because there are only two online volume servers). There are some error messages below the copy command: ``` cp: failed to close './gemini-deploy/deployments/.git/FETCH_HEAD': Input/output error cp: failed to close './gemini-deploy/deployments/.git/objects/pack/pack-9478e6d33308f94e72fd38dd453797ccd336e19c.pack': Input/output error cp: failed to close './gemini-deploy/deployments/.git/objects/87/ecbacadd04041fcacae06b9c046a9fb38e1642': Input/output error cp: failed to close './gemini-deploy/deployments/.git/objects/1f/5581bebc24038154af768df5a1265cf68a22c1': Input/output error cp: failed to close './gemini-deploy/deployments/.git/objects/8a/b97b4f4bfe39da43799ff2481194ca6a670a81': Input/output error cp: failed to close './gemini-deploy/deployments/.git/objects/5f/13ade836541df7aca38e9e124ea50e8c3e2496': Input/output error ``` But not every file has an error message.</DESCRIPTION>
  <REPONAME>seaweedfs</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>replicate: incremental sink only contains new and updated files address https://github.com/chrislusf/seaweedfs/commit/da08402ba253fe5391f0152905f51f82c51fd527</MESSAGE>
    <SHA>9a06c35da40b9d4b5b687b7300fed4196020f375</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>mount: report error when Flush() The error in Release() is not working. See https://github.com/jaderhs/libfuse/blob/master/FAQ related to https://github.com/chrislusf/seaweedfs/issues/1765</MESSAGE>
      <SHA>cf252fc0cdbe2e65a1fcb4853ba2d125c47ab1a0</SHA>
      <PATCHEDFILES>
        <FILE>weed/filesys/dirty_page.go</FILE>
        <FILE>weed/filesys/filehandle.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
