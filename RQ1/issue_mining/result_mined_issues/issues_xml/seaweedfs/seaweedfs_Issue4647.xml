<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>4647</ISSUENO>
  <ISSUEURL>https://github.com/seaweedfs/seaweedfs/issues/4647</ISSUEURL>
  <TITLE>[shell] volume 1415 replication 100, but over replicated +3 (critical)</TITLE>
  <DESCRIPTION>Delete extra replicas, taking into account the replication factor, so that the replicas remain in different DCs. ``` I0707 05:13:12.448756 master_grpc_server.go:199 master see new volume 1415 from fast-volume-0.s3-fast-volume.service.dcvcs.consul:8080 volume 1415 replication 100, but over replicated +3 deleting volume 1415 from fast-volume-4.s3-fast-volume.service.dcix.consul:8080 ... volume 1415 replication 100 is not well placed [0xc001bed030 0xc001beed00] deleting volume 1415 from fast-volume-2.s3-fast-volume.service.dcvcs.consul:8080 ... ``` It is also necessary to handle such a case and, if the number of replicas is temporarily exceeded, write files to all.</DESCRIPTION>
  <REPONAME>seaweedfs</REPONAME>
  <TIMEDIFFERENCEDAYS>81</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>describe a topic</MESSAGE>
    <SHA>19505c1cf44ce7c95032b3b007a200862a5c5c47</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>fix: avoid deleting more than one replica https://github.com/seaweedfs/seaweedfs/issues/4647</MESSAGE>
      <SHA>a3ea8b1289478f6fc2ae419034d5da073ff13247</SHA>
      <PATCHEDFILES>
        <FILE>weed/shell/command_volume_fix_replication.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>fix: avoid deleting more than one replica (#4873) https://github.com/seaweedfs/seaweedfs/issues/4647 Co-authored-by: Konstantin Lebedev &lt;9497591+kmlebedev@users.noreply.github.co&gt;</MESSAGE>
      <SHA>df4ded758e245bbef43bea86d09acdd717fc6b41</SHA>
      <PATCHEDFILES>
        <FILE>weed/shell/command_volume_fix_replication.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>fix: avoid deleting one replica without sync https://github.com/seaweedfs/seaweedfs/issues/4647</MESSAGE>
      <SHA>1579b5b24175c7e4032153bc94cea2e5e5c49a45</SHA>
      <PATCHEDFILES>
        <FILE>weed/shell/command_volume_check_disk.go</FILE>
        <FILE>weed/shell/command_volume_fix_replication.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>fix: avoid deleting one replica without sync (#4875) * fix: avoid deleting one replica without sync https://github.com/seaweedfs/seaweedfs/issues/4647 * Update weed/shell/command_volume_fix_replication.go Co-authored-by: Chris Lu &lt;chrislusf@users.noreply.github.com&gt; * fix: revert this existing do option to positive --------- Co-authored-by: Konstantin Lebedev &lt;9497591+kmlebedev@users.noreply.github.co&gt; Co-authored-by: Chris Lu &lt;chrislusf@users.noreply.github.com&gt;</MESSAGE>
      <SHA>dd580190b465fa2d86a6d1492a9de5ee230e23dd</SHA>
      <PATCHEDFILES>
        <FILE>weed/shell/command_volume_check_disk.go</FILE>
        <FILE>weed/shell/command_volume_fix_replication.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>fix: avoid deleting more than one replica (#4873) https://github.com/seaweedfs/seaweedfs/issues/4647 Co-authored-by: Konstantin Lebedev &lt;9497591+kmlebedev@users.noreply.github.co&gt;</MESSAGE>
      <SHA>2fe57d45bdb6c718589da740c784787c4426a736</SHA>
      <PATCHEDFILES>
        <FILE>weed/shell/command_volume_fix_replication.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>fix: avoid deleting one replica without sync (#4875) * fix: avoid deleting one replica without sync https://github.com/seaweedfs/seaweedfs/issues/4647 * Update weed/shell/command_volume_fix_replication.go Co-authored-by: Chris Lu &lt;chrislusf@users.noreply.github.com&gt; * fix: revert this existing do option to positive --------- Co-authored-by: Konstantin Lebedev &lt;9497591+kmlebedev@users.noreply.github.co&gt; Co-authored-by: Chris Lu &lt;chrislusf@users.noreply.github.com&gt;</MESSAGE>
      <SHA>c4406d3c7af915edb7898e8bfe30af07be666015</SHA>
      <PATCHEDFILES>
        <FILE>weed/shell/command_volume_check_disk.go</FILE>
        <FILE>weed/shell/command_volume_fix_replication.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
