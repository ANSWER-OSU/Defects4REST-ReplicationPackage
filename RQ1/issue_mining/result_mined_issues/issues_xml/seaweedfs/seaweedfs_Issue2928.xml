<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>2928</ISSUENO>
  <ISSUEURL>https://github.com/seaweedfs/seaweedfs/issues/2928</ISSUEURL>
  <TITLE>[vacuum] rename /data/logs_447.cpd /data/logs-prod_447.dat: no such file or directory</TITLE>
  <DESCRIPTION>**Describe the bug** logs master ``` topology_vacuum.go:134] Error when committing vacuum 447 on slow-volume-19:8080: rpc error: code = Unknown desc = rename /data/logs_447.cpd: rename /data/logs_447.cpd /data/logs_447.dat: no such file or directory topology_vacuum.go:134] Error when committing vacuum 447 on slow-volume-13.:8080: rpc error: code = Unknown desc = rename /data/logs_447.cpd: rename /data/logs_447.cpd /data/logs_447.dat: no such file or directory ``` panic logs slow-volume-19 ``` Apr 17, 2022 @ 08:04:13.790 | I0417 03:04:13 1 volume_vacuum.go:95] Committing volume 447 vacuuming... Apr 17, 2022 @ 08:04:13.790 | E0417 03:04:13 1 volume_grpc_vacuum.go:66] commit volume 447: rename /data/logs_447.cpd: rename /data/logs_447.cpd /data/logs-prod_447.dat: no such file or directory Apr 17, 2022 @ 08:04:14.795 | panic: runtime error: invalid memory address or nil pointer dereference Apr 17, 2022 @ 08:04:14.795 | /go/src/github.com/chrislusf/seaweedfs/weed/server/volume_grpc_client_to_master.go:67 +0x24c Apr 17, 2022 @ 08:04:14.795 | created by github.com/chrislusf/seaweedfs/weed/server.NewVolumeServer Apr 17, 2022 @ 08:04:14.795 | github.com/chrislusf/seaweedfs/weed/storage.(*Volume).ToVolumeInformationMessage(0xc000b5c120) Apr 17, 2022 @ 08:04:14.795 | /go/src/github.com/chrislusf/seaweedfs/weed/server/volume_server.go:116 +0x985 Apr 17, 2022 @ 08:04:14.795 | /go/src/github.com/chrislusf/seaweedfs/weed/server/volume_grpc_client_to_master.go:201 +0x12e7 Apr 17, 2022 @ 08:04:14.795 | /go/src/github.com/chrislusf/seaweedfs/weed/storage/volume.go:270 +0x18e Apr 17, 2022 @ 08:04:14.795 | /go/src/github.com/chrislusf/seaweedfs/weed/storage/store.go:227 +0x82a Apr 17, 2022 @ 08:04:14.795 | - Apr 17, 2022 @ 08:04:14.795 | github.com/chrislusf/seaweedfs/weed/server.(*VolumeServer).doHeartbeat(0xc0003fa1e0, {0xc003c58180, 0x29a34fc}, {0x2fb0420, 0xc0002913a0}, 0x12a05f200) Apr 17, 2022 @ 08:04:14.795 | [signal SIGSEGV: segmentation violation code=0x1 addr=0x20 pc=0xee6e4e] Apr 17, 2022 @ 08:04:14.795 | github.com/chrislusf/seaweedfs/weed/storage.(*Store).CollectHeartbeat(0xc0007a84e0) Apr 17, 2022 @ 08:04:14.795 | github.com/chrislusf/seaweedfs/weed/storage.(*Volume).collectStatus(0xc000b5c120) Apr 17, 2022 @ 08:04:14.795 | /go/src/github.com/chrislusf/seaweedfs/weed/storage/volume.go:281 +0x33 Apr 17, 2022 @ 08:04:14.795 | goroutine 70 [running]: Apr 17, 2022 @ 08:04:14.795 | github.com/chrislusf/seaweedfs/weed/server.(*VolumeServer).heartbeat(0xc0003fa1e0) ``` ls ``` /data # ls -l *447* -rw-r--r-- 1 root 99 74004510256 Apr 17 04:12 logs_447.dat -rw-r--r-- 1 root 99 212466 Apr 17 04:12 logs_447.idx -rw-rw-r-- 1 root 99 57 Jun 21 2021 logs_447.vif ``` **System Setup** ```2.98```</DESCRIPTION>
  <REPONAME>seaweedfs</REPONAME>
  <TIMEDIFFERENCEDAYS>98</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>start filer local socket only on non windows fix https://github.com/chrislusf/seaweedfs/issues/2930</MESSAGE>
    <SHA>a69f0b62c2a22785b448a4cb29499b4d1410f1ca</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>avoid no such cpd or cpx file https://github.com/chrislusf/seaweedfs/issues/2928</MESSAGE>
      <SHA>c004d8b9078d7cf34454013a9236635f862149b0</SHA>
      <PATCHEDFILES>
        <FILE>weed/storage/volume_vacuum.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>fix: issue https://github.com/seaweedfs/seaweedfs/issues/2928</MESSAGE>
      <SHA>5ac11d65564dc9480804780736627d0b3efed53b</SHA>
      <PATCHEDFILES>
        <FILE>weed/storage/volume_vacuum.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
