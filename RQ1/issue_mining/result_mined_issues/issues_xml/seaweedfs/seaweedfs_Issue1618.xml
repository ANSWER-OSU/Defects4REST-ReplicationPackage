<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>1618</ISSUENO>
  <ISSUEURL>https://github.com/seaweedfs/seaweedfs/issues/1618</ISSUEURL>
  <TITLE>2.10/master: &quot;too many open files&quot; during web-UI activity</TITLE>
  <DESCRIPTION>``` + ulimit -Sn 16384 + ulimit -n 16384 + weed master -ip=192.168.0.204 -port=9333 -peers=server1:9333,server2:9333 -defaultReplication=001 [...] I1115 10:31:22 76619 master_server.go:192] adminScripts: lock volume.balance -force volume.fix.replication unlock I1115 10:31:22 76619 master.go:122] Start Seaweed Master 8000GB 2.10 at 0.0.0.0:9333 I1115 10:31:22 76619 raft_server.go:70] Starting RaftServer with 192.168.0.204:9333 I1115 10:31:22 76619 raft_server.go:129] current cluster leader: I1115 10:31:22 76619 master.go:146] Start Seaweed Master 8000GB 2.10 grpc server at 0.0.0.0:19333 I1115 10:31:23 76619 masterclient.go:74] existing leader is 192.168.0.3:9333 I1115 10:31:41 76619 masterclient.go:120] master masterClient failed to receive from 192.168.0.204:9333: EOF I1115 10:31:41 76619 masterclient.go:120] adminShell masterClient failed to receive from 192.168.0.204:9333: EOF 2020-11-15 10:31:49.426416 I | http: Accept error: accept tcp [::]:9333: accept4: too many open files; retrying in 5ms 2020-11-15 10:31:49.431561 I | http: Accept error: accept tcp [::]:9333: accept4: too many open files; retrying in 10ms 2020-11-15 10:31:49.441789 I | http: Accept error: accept tcp [::]:9333: accept4: too many open files; retrying in 20ms 2020-11-15 10:31:49.461925 I | http: Accept error: accept tcp [::]:9333: accept4: too many open files; retrying in 40ms 2020-11-15 10:31:49.502054 I | http: Accept error: accept tcp [::]:9333: accept4: too many open files; retrying in 80ms 2020-11-15 10:31:49.582186 I | http: Accept error: accept tcp [::]:9333: accept4: too many open files; retrying in 160ms 2020-11-15 10:31:49.742291 I | http: Accept error: accept tcp [::]:9333: accept4: too many open files; retrying in 320ms 2020-11-15 10:31:50.062433 I | http: Accept error: accept tcp [::]:9333: accept4: too many open files; retrying in 640ms 2020-11-15 10:31:50.702589 I | http: Accept error: accept tcp [::]:9333: accept4: too many open files; retrying in 1s 2020-11-15 10:31:51.702726 I | http: Accept error: accept tcp [::]:9333: accept4: too many open files; retrying in 1s 2020-11-15 10:31:52.702802 I | http: Accept error: accept tcp [::]:9333: accept4: too many open files; retrying in 1s 2020-11-15 10:31:53.702942 I | http: Accept error: accept tcp [::]:9333: accept4: too many open files; retrying in 1s 2020-11-15 10:31:54.703096 I | http: Accept error: accept tcp [::]:9333: accept4: too many open files; retrying in 1s 2020-11-15 10:31:55.703252 I | http: Accept error: accept tcp [::]:9333: accept4: too many open files; retrying in 1s 2020-11-15 10:31:56.703346 I | http: Accept error: accept tcp [::]:9333: accept4: too many open files; retrying in 1s 2020-11-15 10:31:57.704009 I | http: Accept error: accept tcp [::]:9333: accept4: too many open files; retrying in 1s 2020-11-15 10:31:58.704168 I | http: Accept error: accept tcp [::]:9333: accept4: too many open files; retrying in 1s 2020-11-15 10:31:59.704321 I | http: Accept error: accept tcp [::]:9333: accept4: too many open files; retrying in 1s I1115 10:32:00 76619 masterclient.go:120] adminShell masterClient failed to receive from 192.168.0.204:9333: EOF 2020-11-15 10:32:00.704509 I | http: Accept error: accept tcp [::]:9333: accept4: too many open files; retrying in 1s 2020-11-15 10:32:01.704658 I | http: Accept error: accept tcp [::]:9333: accept4: too many open files; retrying in 1s 2020-11-15 10:32:02.704792 I | http: Accept error: accept tcp [::]:9333: accept4: too many open files; retrying in 1s 2020-11-15 10:32:03.704949 I | http: Accept error: accept tcp [::]:9333: accept4: too many open files; retrying in 1s 2020-11-15 10:32:04.705086 I | http: Accept error: accept tcp [::]:9333: accept4: too many open files; retrying in 1s 2020-11-15 10:32:05.705232 I | http: Accept error: accept tcp [::]:9333: accept4: too many open files; retrying in 1s 2020-11-15 10:32:06.705346 I | http: Accept error: accept tcp [::]:9333: accept4: too many open files; retrying in 1s 2020-11-15 10:32:07.705486 I | http: Accept error: accept tcp [::]:9333: accept4: too many open files; retrying in 1s 2020-11-15 10:32:08.705621 I | http: Accept error: accept tcp [::]:9333: accept4: too many open files; retrying in 1s 2020-11-15 10:32:09.705813 I | http: Accept error: accept tcp [::]:9333: accept4: too many open files; retrying in 1s 2020-11-15 10:32:10.705973 I | http: Accept error: accept tcp [::]:9333: accept4: too many open files; retrying in 1s 2020-11-15 10:32:11.706270 I | http: Accept error: accept tcp [::]:9333: accept4: too many open files; retrying in 1s 2020-11-15 10:32:12.706451 I | http: Accept error: accept tcp [::]:9333: accept4: too many open files; retrying in 1s 2020-11-15 10:32:13.706619 I | http: Accept error: accept tcp [::]:9333: accept4: too many open files; retrying in 1s 2020-11-15 10:32:14.706780 I | http: Accept error: accept tcp [::]:9333: accept4: too many open files; retrying in 1s 2020-11-15 10:32:15.706941 I | http: Accept error: accept tcp [::]:9333: accept4: too many open files; retrying in 1s 2020-11-15 10:32:16.707079 I | http: Accept error: accept tcp [::]:9333: accept4: too many open files; retrying in 1s 2020-11-15 10:32:17.707296 I | http: Accept error: accept tcp [::]:9333: accept4: too many open files; retrying in 1s 2020-11-15 10:32:18.707450 I | http: Accept error: accept tcp [::]:9333: accept4: too many open files; retrying in 1s I1115 10:32:19 76619 masterclient.go:120] adminShell masterClient failed to receive from 192.168.0.204:9333: EOF ``` To reproduce refresh http://localhost:9333/ui/index.html few times in browser.</DESCRIPTION>
  <REPONAME>seaweedfs</REPONAME>
  <TIMEDIFFERENCEDAYS>24</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>go get github.com/chrislusf/raft@v1.0.2</MESSAGE>
    <SHA>57c770a7b4d67870b467ddba622a611615ad6f95</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>raft: grpc wait for ready related to https://github.com/chrislusf/seaweedfs/issues/1618 https://github.com/grpc/grpc/blob/master/doc/wait-for-ready.md https://github.com/chrislusf/raft/commit/7c64624a0692a6058b2482f4f2857a77274187f0</MESSAGE>
      <SHA>7cfa616843d88a5557d166cacfc64b9b3fce5e9c</SHA>
      <PATCHEDFILES>
        <FILE>go.mod</FILE>
        <FILE>go.sum</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
