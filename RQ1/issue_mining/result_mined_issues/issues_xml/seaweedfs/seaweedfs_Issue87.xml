<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>87</ISSUENO>
  <ISSUEURL>https://github.com/seaweedfs/seaweedfs/issues/87</ISSUEURL>
  <TITLE>weed fix loses (some) indices?</TITLE>
  <DESCRIPTION>I've got an .dat volume with .idx that I thought might be corrupt. So I backed it up and ran `weed fix ...` It produced an idx file that was smaller than the older one, but the weed volume seemed to come up fine. Unfortunately, it seemed like some things (I haven't confirmed if it's just some items or all) returned 404s, whereas the previous index worked. (Against the same .dat file).</DESCRIPTION>
  <REPONAME>seaweedfs</REPONAME>
  <TIMEDIFFERENCEDAYS>27</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Avoid wrong way to delete on replication failure Avoid wrong way to delete on replication failure. This deletion has bug to write. The better fix is not to use the deletion on failure at all.</MESSAGE>
    <SHA>853701cb6b13c0e56c0b9c242aa027003e32f6c2</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>adding special handling to recover data if possible For bug #87 and #93, add special handling to recover data if possible.</MESSAGE>
      <SHA>d48d76cb4f419a58539fb84c7a45c7eb863b854f</SHA>
      <PATCHEDFILES>
        <FILE>go/storage/volume.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Merge pull request #87 from chrislusf/master sync</MESSAGE>
      <SHA>34240606f78395345ca7f6d7fe66a223c9bdf072</SHA>
      <PATCHEDFILES>
        <FILE>.github/workflows/binaries_dev.yml</FILE>
        <FILE>backers.md</FILE>
        <FILE>docker/Dockerfile.go_build</FILE>
        <FILE>docker/Dockerfile.go_build_large</FILE>
        <FILE>k8s/helm_charts2/Chart.yaml</FILE>
        <FILE>k8s/helm_charts2/templates/filer-statefulset.yaml</FILE>
        <FILE>k8s/helm_charts2/values.yaml</FILE>
        <FILE>other/java/client/pom.xml</FILE>
        <FILE>other/java/client/pom.xml.deploy</FILE>
        <FILE>other/java/client/pom_debug.xml</FILE>
        <FILE>other/java/client/src/main/java/seaweedfs/client/RemoteUtil.java</FILE>
        <FILE>other/java/client/src/main/proto/filer.proto</FILE>
        <FILE>other/java/examples/pom.xml</FILE>
        <FILE>other/java/hdfs2/dependency-reduced-pom.xml</FILE>
        <FILE>other/java/hdfs2/pom.xml</FILE>
        <FILE>other/java/hdfs3/dependency-reduced-pom.xml</FILE>
        <FILE>other/java/hdfs3/pom.xml</FILE>
        <FILE>weed/Makefile</FILE>
        <FILE>weed/cluster/cluster.go</FILE>
        <FILE>weed/cluster/cluster_test.go</FILE>
        <FILE>weed/command/filer.go</FILE>
        <FILE>weed/command/filer_meta_tail.go</FILE>
        <FILE>weed/command/server.go</FILE>
        <FILE>weed/command/shell.go</FILE>
        <FILE>weed/filer/filechunk_manifest.go</FILE>
        <FILE>weed/filer/filechunks_read.go</FILE>
        <FILE>weed/filer/filechunks_read_test.go</FILE>
        <FILE>weed/filer/filer.go</FILE>
        <FILE>weed/filer/filer_delete_entry.go</FILE>
        <FILE>weed/filer/meta_aggregator.go</FILE>
        <FILE>weed/filer/read_remote.go</FILE>
        <FILE>weed/filer/redis2/universal_redis_store.go</FILE>
        <FILE>weed/filesys/dir_rename.go</FILE>
        <FILE>weed/filesys/file.go</FILE>
        <FILE>weed/iamapi/iamapi_handlers.go</FILE>
        <FILE>weed/iamapi/iamapi_management_handlers.go</FILE>
        <FILE>weed/iamapi/iamapi_server.go</FILE>
        <FILE>weed/messaging/broker/broker_grpc_server_discovery.go</FILE>
        <FILE>weed/pb/filer.proto</FILE>
        <FILE>weed/pb/filer_pb/filer.pb.go</FILE>
        <FILE>weed/pb/master.proto</FILE>
        <FILE>weed/pb/master_pb/master.pb.go</FILE>
        <FILE>weed/remote_storage/s3/s3_storage_client.go</FILE>
        <FILE>weed/s3api/auth_credentials.go</FILE>
        <FILE>weed/s3api/s3api_bucket_handlers.go</FILE>
        <FILE>weed/s3api/s3api_handlers.go</FILE>
        <FILE>weed/s3api/s3api_object_copy_handlers.go</FILE>
        <FILE>weed/s3api/s3api_object_handlers.go</FILE>
        <FILE>weed/s3api/s3api_object_handlers_postpolicy.go</FILE>
        <FILE>weed/s3api/s3api_object_multipart_handlers.go</FILE>
        <FILE>weed/s3api/s3api_object_tagging_handlers.go</FILE>
        <FILE>weed/s3api/s3api_objects_list_handlers.go</FILE>
        <FILE>weed/s3api/s3api_server.go</FILE>
        <FILE>weed/s3api/s3api_status_handlers.go</FILE>
        <FILE>weed/s3api/s3err/error_handler.go</FILE>
        <FILE>weed/s3api/stats.go</FILE>
        <FILE>weed/server/filer_grpc_server_remote.go</FILE>
        <FILE>weed/server/filer_grpc_server_rename.go</FILE>
        <FILE>weed/server/filer_server.go</FILE>
        <FILE>weed/server/filer_server_handlers_read.go</FILE>
        <FILE>weed/server/master_grpc_server.go</FILE>
        <FILE>weed/server/master_grpc_server_cluster.go</FILE>
        <FILE>weed/server/master_server.go</FILE>
        <FILE>weed/server/volume_grpc_copy.go</FILE>
        <FILE>weed/server/volume_grpc_tier_upload.go</FILE>
        <FILE>weed/server/volume_grpc_vacuum.go</FILE>
        <FILE>weed/shell/command_cluster_ps.go</FILE>
        <FILE>weed/shell/command_ec_encode.go</FILE>
        <FILE>weed/shell/command_remote_cache.go</FILE>
        <FILE>weed/shell/command_remote_meta_sync.go</FILE>
        <FILE>weed/shell/command_remote_mount.go</FILE>
        <FILE>weed/shell/command_remote_mount_buckets.go</FILE>
        <FILE>weed/shell/command_remote_unmount.go</FILE>
        <FILE>weed/shell/command_volume_fix_replication_test.go</FILE>
        <FILE>weed/shell/shell_liner.go</FILE>
        <FILE>weed/storage/backend/backend.go</FILE>
        <FILE>weed/storage/backend/s3_backend/s3_backend.go</FILE>
        <FILE>weed/storage/backend/s3_backend/s3_sessions.go</FILE>
        <FILE>weed/storage/backend/s3_backend/s3_upload.go</FILE>
        <FILE>weed/util/constants.go</FILE>
        <FILE>weed/wdclient/masterclient.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
