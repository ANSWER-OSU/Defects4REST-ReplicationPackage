<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>166</ISSUENO>
  <ISSUEURL>https://github.com/seaweedfs/seaweedfs/issues/166</ISSUEURL>
  <TITLE>when the former ttl(upload ttl, not assign ttl) expired, same file uploaded without ttl option, but it can't be downloaded</TITLE>
  <DESCRIPTION>``` # curl -F file=@start_master.sh http://192.168.23.70:18080/xxxx?ttl=1m {&quot;name&quot;:&quot;start_master.sh&quot;,&quot;size&quot;:645} // after 1m # curl -i http://192.168.23.70:18080/xxxx HTTP/1.1 404 Not Found Date: Fri, 10 Jul 2015 15:17:47 GMT Content-Length: 0 # curl -F file=@start_master.sh http://192.168.23.70:18080/xxxx {&quot;name&quot;:&quot;start_master.sh&quot;,&quot;size&quot;:645} # curl -i http://192.168.23.70:18080/xxxx HTTP/1.1 404 Not Found Date: Fri, 10 Jul 2015 15:18:12 GMT Content-Length: 0 ``` If I uploaded another file, it can be downloaded: ``` # curl -F file=@start_volume.sh http://192.168.23.70:18080/xxxx {&quot;name&quot;:&quot;start_volume.sh&quot;,&quot;size&quot;:411} # curl -i http://192.168.23.70:18080/xxxx HTTP/1.1 200 OK Accept-Ranges: bytes Content-Disposition: filename=&quot;start_volume.sh&quot; Content-Length: 411 Content-Type: text/x-sh; charset=utf-8 Etag: &quot;63bdc9b5&quot; Last-Modified: Fri, 10 Jul 2015 15:19:28 GMT Date: Fri, 10 Jul 2015 15:19:31 GMT &lt;...&gt; ``` I think if file unchanged but ttl changed, needle should be written to data file: ``` golang func (v *Volume) write(n *Needle) (size uint32, err error) { if v.isFileUnchanged(n) { size = n.DataSize glog.V(4).Infof(&quot;needle is unchanged!&quot;) return } ```</DESCRIPTION>
  <REPONAME>seaweedfs</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Avoid nil case when fixing data</MESSAGE>
    <SHA>a4d3f2da3d0c5bf19b6bd924df72d7b2484b9f79</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>skip isFileUnchanged checking since ttl always change skip checking since ttl always change. Fixing https://github.com/chrislusf/seaweedfs/issues/166</MESSAGE>
      <SHA>2c595d2d16629f7163587e1a08f2419c3df78ecc</SHA>
      <PATCHEDFILES>
        <FILE>go/storage/volume.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>fix ttl change detection https://github.com/chrislusf/seaweedfs/issues/166</MESSAGE>
      <SHA>320e946d5019b568c5877125681363d580a8593b</SHA>
      <PATCHEDFILES>
        <FILE>go/storage/volume.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
