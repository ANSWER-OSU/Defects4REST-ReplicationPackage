<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>4305</ISSUENO>
  <ISSUEURL>https://github.com/seaweedfs/seaweedfs/issues/4305</ISSUEURL>
  <TITLE>s3.bucket.list file count mismatch</TITLE>
  <DESCRIPTION>**Describe the bug** s3.bucket.list file count is not correct **System Setup** - weed server -s3 -ip.bind=0.0.0.0 -dir=/disk/data1/weed,/disk/data2/weed -master.defaultReplication=002 -master.peers=192.168.3.101:9333,192.168.3.102:9333,192.168.3.103:9333,192.168.3.104:9333,192.168.3.105:9333 - Ubuntu 22.04.1 LTS - version 30GB 3.43 3227e4175e2bf8df2ac8aeeff8cf73a819abc5a7 linux amd64 - content of `filer.toml` ``` [leveldb2] enabled = false dir = &quot;./filerldb2&quot; # directory to store level db files [tikv] enabled = true pdaddrs = &quot;pdhost1:2379, pdhost2:2379, pdhost3:2379&quot; ``` **Expected behavior** ``` &gt; fs.ls /buckets/kuro3 prometheus.yml redirect.html weed &gt; s3.bucket.list kuro3 size:67565992 file:22 ``` file count should be 3 **Screenshots** ![image](https://user-images.githubusercontent.com/12230174/224946805-9e45e296-35b9-4234-8015-61efb289116b.png) ![image](https://user-images.githubusercontent.com/12230174/224947463-8ca7b206-b065-4d5c-b62a-7adb847caa22.png) **Additional context** It seems that filer slices files into segments of 4MB, and `s3.bucket.list` counts each segment as a separate file.</DESCRIPTION>
  <REPONAME>seaweedfs</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>build(deps): bump golang.org/x/image from 0.5.0 to 0.6.0 (#4304) Bumps [golang.org/x/image](https://github.com/golang/image) from 0.5.0 to 0.6.0. - [Release notes](https://github.com/golang/image/releases) - [Commits](https://github.com/golang/image/compare/v0.5.0...v0.6.0) --- updated-dependencies: - dependency-name: golang.org/x/image dependency-type: direct:production update-type: version-update:semver-minor ... Signed-off-by: dependabot[bot] &lt;support@github.com&gt; Co-authored-by: dependabot[bot] &lt;49699333+dependabot[bot]@users.noreply.github.com&gt;</MESSAGE>
    <SHA>b12d9b859882226be4f1d3c2702824ae01724526</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>fix naming fix https://github.com/seaweedfs/seaweedfs/issues/4305</MESSAGE>
      <SHA>2268d382637e6ff3ce19d4ea9cd76ffd9e05b67e</SHA>
      <PATCHEDFILES>
        <FILE>weed/shell/command_s3_bucket_list.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
