<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>4971</ISSUENO>
  <ISSUEURL>https://github.com/nightscout/cgm-remote-monitor/issues/4971</ISSUEURL>
  <TITLE>Loop Basal Rate Actual Delivery vs Nightscout Day to Day Report</TITLE>
  <DESCRIPTION>EDITED: Anything in {} should be disregarded. Please see my later post (9/7/2019). I did not delete anything. Just added newline{ and }newline around incorrect assumptions. Please include the following information with your bug report: Is this a new bug with the latest release, have you seen this earlier? The reported basal values in Day-to-Day Report differ significantly for Omnipod Loop from the actual values. I believe this is an inconsistency in method for estimating basal from rate*time on NS vs Loop (actual insulin delivered). { Significant differences are noted for Omnipod which must cancel TB before initiating the next TB, so the period for the TB is typically just under a minute mark and NS rounds down the minute. } [Sep 12, 2019: EDITED to add examples from database records for &quot;eventType&quot;: &quot;Temp Basal&quot;,: old Loop code had &quot;duration&quot;: 4, new Loop code (after Sep 9, 2019, dev) has &quot;duration&quot;: 4.767875816424688, and new field: &quot;amount&quot;: 0.1, END EDIT ] See discussion here: https://loop.zulipchat.com/#narrow/stream/144182-development/topic/Nightscout.20daily.20total.20temp.20basal.20delivery/near/174760280 { I think that Mark Yeager is correct that the primary problem is rounding down the minutes for TB. He said: &quot;It seems the &quot;revert to programmed basal&quot; that Loop issues between temp basals (as @ps2 explained) results in a 4 minute increment in NS vs the 4min:57sec ? in Loop..&quot; } The other part of the problem is something I've noticed before - if you change your profile for scheduled basal, the day-to-day report changes because the intervals between TB are modified to new basal pattern. Which device / browser version was used to reproduce the bug? Running dev branch from https://github.com/LoopKit/LoopWorkspace Using Omnipod, iPhone 7 Running dev on Nightscout (0.12.4-dev) Does this happen every time you launch Nightscout, or sometimes? yes Steps how to reproduce (if you can’t reproduce the issue, please don’t report the issue / if we can't reproduce the bug, we can't fix) I am attempting to reproduce bug by taking the treatment report and doing rate * time and summing up to match the reported basal. { If I use an extra minute of Scheduled Basal between each TB reported by Loop plus the actual scheduled basal, I get close to the overestimate provided by NS. } I want to clean up the spreadsheet some to make it more understandable before posting it. Please include 1 or more screenshots of the issue appearing, ideally with an annotation on what's wrong I wanted to get this issue reported so people are aware. I will come back with more documentation (or maybe others can chime in). Loop knows how much basal insulin is delivered. Pete Schwamb says he is willing to work with NS developers to figure a method to have NS reporting be more accurate. My daily basal delivery over more than a week showed up as 8 to 13% too large on NS compared to what Loop / Apple Health / Tidepool reports. Several others checked and also found the discrepancy.</DESCRIPTION>
  <REPONAME>cgm-remote-monitor</REPONAME>
  <TIMEDIFFERENCEDAYS>526</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Fix for boluscalc issue (#5729) Boluscalc fix &amp; remove integer validation from BG input field</MESSAGE>
    <SHA>7283560e0728ee91234e28be06be930fa44ba648</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>incporarate ammount for effected temp basal rates See issue #4971 for more information. https://github.com/nightscout/cgm-remote-monitor/issues/4971 * Insulin pump vendors vary in the timing between insulin dosings. * When modifying temp basal rates every 5 minutes, the differences between dose timings inherent in the pump delivery mechanisms become noticeable. * Timing issue is mitigated by creating a model for each pump and calculating the impact of each timing difference. * The result is a new piece of data: the effected insulin rate over an arbitrary period of time, eg 4 minutes and 57 seconds. * The new piece of data is uploaded via the `amount` parameter for Loop users as of September 2019. This patch favors the `amount` parameter when calculating effected temp basal rates.</MESSAGE>
      <SHA>c161410f3b0d8b587f5a8ac55cc92532f6c9e136</SHA>
      <PATCHEDFILES>
        <FILE>lib/profilefunctions.js</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
