<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>7910</ISSUENO>
  <ISSUEURL>https://github.com/nightscout/cgm-remote-monitor/issues/7910</ISSUEURL>
  <TITLE>Issue with api v1 returning stale data</TITLE>
  <DESCRIPTION>I have a Mac OS X app that I made that pulls the latest CGM values from Nightscout using v1/entries - a user recently reported that their values are all showing as stale / old. When I looked into it, I can see that he's on the DEV branch of cgm-remote-monitor, and when I hit his v1/entries endpoint and compare to v2/properties it's clear that the v1 endpoint is no longer reporting up-to-date values. I have since upgraded my own instance and I can see the same behaviour. **To Reproduce** Steps to reproduce the behavior: 1. Go to api/v1/entries on a NS instance running 15.0 2. Look at the timestamps / epoc times and you will see they are multiple hours old versus the latest bgnow readings at api/v2/properties **Expected behavior** api/v1/entries should be up to date. - NS version 15.0 - My data comes from loop://iPhone but the other user's data comes from xDrip-DexcomG5 G6 Native - Not specific to a browser or device</DESCRIPTION>
  <REPONAME>cgm-remote-monitor</REPONAME>
  <TIMEDIFFERENCEDAYS>235</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #7905 from nightscout/wip/bewest/fix-timezone-test cheat for tests across different time zones</MESSAGE>
    <SHA>97a4ee7a01b65b8552e0ce35cb3c21baf6e030cb</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fixes #7910</MESSAGE>
      <SHA>32b2376bc99081b503527f79193dbc4684188c25</SHA>
      <PATCHEDFILES>
        <FILE>lib/api/entries/index.js</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Merge pull request #7911 from nightscout/wip/sulka/fix_entries_api Fixes #7910 LGTM, tests work, merging.</MESSAGE>
      <SHA>a4d07cd66e960f311c05934e3b78a9faf75cf657</SHA>
      <PATCHEDFILES>
        <FILE>lib/api/entries/index.js</FILE>
        <FILE>lib/server/entries.js</FILE>
        <FILE>tests/api.entries.test.js</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Squashed commit of the following: commit ec83b570bb64a09dc95203a4557c59324fe81dcd Merge: 867fc961 a09e586b Author: Sulka Haro &lt;sulka@sulka.net&gt; Date: Sun Feb 26 19:47:56 2023 +0200 Merge branch 'master' into dev commit 867fc9611e5d7136fd38c26174c10ac239f53ef9 Author: Marcin Juraszek &lt;mail@marcinjuraszek.com&gt; Date: Sun Feb 26 09:31:55 2023 -0800 Ensure indexes for Roles and Subjects collections as part of boot (#7902) * Allow DELETE via PATCH/UPDATE operation too * rollback wrong commit * Ensure indexes for Roles and Subjects collections as part of boot --------- Co-authored-by: Milos Kozak &lt;m.kozak@sysop.cz&gt; commit a4d07cd66e960f311c05934e3b78a9faf75cf657 Merge: 97a4ee7a d7f44324 Author: Ben West &lt;bewest@gmail.com&gt; Date: Sat Feb 25 09:26:06 2023 -0800 Merge pull request #7911 from nightscout/wip/sulka/fix_entries_api Fixes #7910 LGTM, tests work, merging. commit d7f44324d47a78dc9443bf963218c2a95e5dec90 Author: Sulka Haro &lt;sulka@sulka.net&gt; Date: Sat Feb 25 13:44:34 2023 +0200 * Add a unit test to check the /entries endpoint returns values in correct order * Fix a bug in CGM entry insertion, where entries that were inserted without a dateString but with a numeric date were always using the current time commit 32b2376bc99081b503527f79193dbc4684188c25 Author: Sulka Haro &lt;sulka@sulka.net&gt; Date: Sat Feb 25 11:20:45 2023 +0200 Fixes #7910 commit 97a4ee7a01b65b8552e0ce35cb3c21baf6e030cb Merge: ac1a7d1b 93df3c4f Author: Ben West &lt;bewest@gmail.com&gt; Date: Tue Feb 21 09:38:14 2023 -0800 Merge pull request #7905 from nightscout/wip/bewest/fix-timezone-test cheat for tests across different time zones commit 93df3c4f09a1553e97a616e5b49901c046982e5e Author: Ben West &lt;bewest@gmail.com&gt; Date: Tue Feb 21 09:29:44 2023 -0800 cheat for tests across different time zones There is a bug generating the window for time ranges across different timezones, which results in different queries wrapping around day boundaries. This provides the fixture with three variants of the queries, in some ways better documenting the bug, and allowing the tests to pass. commit ac1a7d1bd880426b96a6acb3d594d26f1a76a730 Author: Petr Ondrusek &lt;34578008+PetrOndrusek@users.noreply.github.com&gt; Date: Sat Feb 18 15:12:47 2023 +0100 Api3 remove auth token (#6863) * APIv3: removing authorization by accessToken from codebase and adjusting tests * APIv3: updating docs --------- Co-authored-by: Petr Ondrůšek &lt;petr.ondrusek@okin.eu&gt; Co-authored-by: Sulka Haro &lt;sulka@sulka.net&gt; commit 89d7eb6790707f273874191c6ff4f1ae216f9127 Author: Milos Kozak &lt;m.kozak@sysop.cz&gt; Date: Sat Feb 18 15:07:02 2023 +0100 Alarm sockets for api v3 (#7858) * Alarm sockets for api v3 * Migrate to alarm websockets * Fix unit tests --------- Co-authored-by: Sulka Haro &lt;sulka@sulka.net&gt; commit 4e1f36489e5e8f684715cb27134fa003774fa1f2 Author: Sulka Haro &lt;sulka@sulka.net&gt; Date: Sat Feb 18 10:26:56 2023 +0200 Fix loading JWT when auth subject has no permissions (#7894) * Fix an issue reported by Milos, when a JWT is loaded with a subject that has no permissions * Add unit test to cover this case commit 0f69153779c4eb6d700885ff1ff467fe2bba9ffb Author: Michael Kroes &lt;michael@kroes.email&gt; Date: Sat Feb 18 08:10:49 2023 +0100 Added charging state to the uploader battery pill when it's provided by AAPSClientV3. (#7873) Co-authored-by: Sulka Haro &lt;sulka@sulka.net&gt; commit d1fe8f50daec0df57fc14b68f44b552f8332788d Author: Michael Kroes &lt;michael@kroes.email&gt; Date: Sat Feb 18 08:00:04 2023 +0100 Fixed pushover callbacks not being processed (#7876) Co-authored-by: Sulka Haro &lt;sulka@sulka.net&gt; commit 27958924a2c04add7e2581a4cafd028bc2b19d4e Author: Sulka Haro &lt;sulka@sulka.net&gt; Date: Mon Feb 13 12:52:11 2023 +0200 Add event type to event on treatment notify if it's missing (#7888) commit adc70b7643ffbff82029cd25e815426a9f07e2ea Author: bjornoleh &lt;63544115+bjornoleh@users.noreply.github.com&gt; Date: Thu Feb 9 04:43:53 2023 +0100 Add logging limits to all services (mongo, nightscout and traefik) (#7884) Parameters defined in x-logging extension field with options: max-size: '10m' max-file: '5' commit 903669a185d2a5580b4af6d96a9166f0ee93ea2a Merge: 3b7528a8 a8059393 Author: Ben West &lt;bewest@gmail.com&gt; Date: Sat Jan 28 09:16:09 2023 -0800 Merge pull request #7857 from nightscout/wip/bewest/daytoday-redo-03 Wip/bewest/daytoday redo 03 commit a8059393711fd5db63561afe21a51c729ac57442 Author: Ben West &lt;bewest@gmail.com&gt; Date: Fri Jan 27 10:16:56 2023 -0800 fix test with fixtures both ways commit 664efe6486acfabee828a153a7d1ce93a268de9c Merge: 48d1ae39 5d3268ab Author: Ben West &lt;bewest@gmail.com&gt; Date: Fri Jan 27 08:07:48 2023 -0800 Merge branch 'wip/bewest/daytoday-redo-03' of github.com:nightscout/cgm-remote-monitor into wip/bewest/daytoday-redo-03 commit 48d1ae399b9636d61c5d2d27b4cd5ca6d2e10106 Author: Ben West &lt;bewest@gmail.com&gt; Date: Fri Jan 27 08:07:29 2023 -0800 tweak tests/logging commit 5d3268abac24c9ab44a0049ad4a2de25493fc824 Merge: b376239c 3b7528a8 Author: Ben West &lt;bewest@gmail.com&gt; Date: Fri Jan 27 08:01:37 2023 -0800 Merge branch 'dev' into wip/bewest/daytoday-redo-03 commit 3b7528a8edbacde907ce8472838865190271d0ef Author: Ben West &lt;bewest@gmail.com&gt; Date: Thu Jan 26 22:42:26 2023 -0800 minimum attempt to protect /api/v2/ endpoints (#7554) * minimum attempt to protect /api/v2/ endpoints These endpoints should be protected as reported in https://github.com/nightscout/cgm-remote-monitor/issues/7546. * remove spurious line Co-authored-by: Sulka Haro &lt;sulka@sulka.net&gt; commit d185cf63e8da21fc67603336238fafef71390fc2 Author: Sulka Haro &lt;sulka@sulka.net&gt; Date: Fri Jan 27 08:34:46 2023 +0200 Update Mongo URL parser to 1.0.2 to fix issues Scott H found (#7606) * Update Mongo URL parser to 1.0.2 to fix issues Scott H found * Reset the lockfile * Update lock to include new component commit b376239cf14e3bb433f0d3051fdf47a0e3d42e38 Merge: 10dd236c 250b808f Author: Ben West &lt;bewest@gmail.com&gt; Date: Thu Jan 26 13:09:57 2023 -0800 Merge branch 'dev' into wip/bewest/daytoday-redo-03 commit 10dd236cda32102534605183705f3bdc6e1b5cbf Author: Ben West &lt;bewest@gmail.com&gt; Date: Thu Jan 26 12:52:32 2023 -0800 daytoday: Align start of day with data across zones This change correctly aligns the name of the day in the current zone with the start of the data for the equivalent day in the profile's zone. This makes it so that viewing a day to day report in any timezone works going both east and west directions. commit f6b2d4f717d434655fd7051cc4d9416f983be0a9 Author: Ben West &lt;bewest@gmail.com&gt; Date: Thu Jan 26 11:43:43 2023 -0800 Revert &quot;Revert &quot;clock at the end of the day is 23:59:59.999&quot;&quot; This reverts commit a4f92713c4f9301392f51c675aa4a4433de48a35. commit a4f92713c4f9301392f51c675aa4a4433de48a35 Author: Ben West &lt;bewest@gmail.com&gt; Date: Thu Jan 26 11:42:36 2023 -0800 Revert &quot;clock at the end of the day is 23:59:59.999&quot; This reverts commit f51fac96230a885b543a75a123502c4ce2bf83c9. commit 8e0ec88893fcf14450566d901df99a477ad55548 Merge: 0ee0712c 6a543c8b Author: Ben West &lt;bewest@gmail.com&gt; Date: Tue Jan 24 11:00:16 2023 -0800 Merge branch 'wip/bewest/daytoday-redo-03' of github.com:nightscout/cgm-remote-monitor into wip/bewest/daytoday-redo-03 commit 0ee0712ca777ce06528562e0f3a231dfc46823f0 Author: Ben West &lt;bewest@gmail.com&gt; Date: Tue Jan 24 10:59:40 2023 -0800 redact console log lines commit 250b808f9eb0350b5f38b1f495035a50a5433d0b Author: Sulka Haro &lt;sulka@sulka.net&gt; Date: Tue Jan 24 20:54:18 2023 +0200 New Crowdin updates (#7808) * New translations en.json (German) * New translations en.json (Russian) commit 6a543c8bd9cbff6869123c60c767ecccc33b76a4 Merge: f51fac96 28e75a67 Author: Sulka Haro &lt;sulka@sulka.net&gt; Date: Tue Jan 24 20:15:54 2023 +0200 Merge branch 'dev' into wip/bewest/daytoday-redo-03 commit 28e75a67b48f7a7bdd6d8df5e00bf6efb2a9e668 Author: Sulka Haro &lt;sulka@sulka.net&gt; Date: Tue Jan 24 20:04:48 2023 +0200 Possibly fix Loop time zones not being recognised in profile editor and reports (#7833) * * Change profile editor so it works when client uploads profiles where string case doesn't match editor expectations * Re-enable culling down time zone data sent to client * Add a workaround to fix Loop uploading non-ISO compliant time zone identifier commit f51fac96230a885b543a75a123502c4ce2bf83c9 Author: Ben West &lt;bewest@gmail.com&gt; Date: Mon Jan 23 08:45:10 2023 -0800 clock at the end of the day is 23:59:59.999 Ensure that the test fixtures will return; the previous changes correctly forward the time to end of day across zones and datelines. One side effect is that the date formatted for the end of the day uses all the microseconds for the day as well. This changes the query from the form of 23:59:59.000Z to 23:59:59.999Z. This also ensures that anything that happens during that one second will be included rather than excluded. commit 8983713b741d0b65e16426256246c2884fe6e330 Author: Ben West &lt;bewest@gmail.com&gt; Date: Mon Jan 23 08:30:50 2023 -0800 ensure daily reports dates translate to profile timezone To illustrate the difference, I used chrome &quot;sensors&quot; feature to change my timezone to one that spans the dateline. &gt; moment.tz('2023-01-19', 'America/Los_Angeles').endOf('day').format( ) '2023-01-19T23:59:59-08:00' &gt; moment.tz(moment('2023-01-19'), 'America/Los_Angeles').endOf('day').format( ) '2023-01-18T23:59:59-08:00' The old code uses a string replacement, which is equivalent to the first test. This causes the dates on the reports to be off by one, as well as risks the data wrapping around the dateline so it can't be seen. For example, replacing &quot;23:59:59&quot; with &quot;00:00:00&quot; in the first example doesn't correctly wrap around the dateline. The patch introduces a way to parse the dates requested in the browser's time zone, and then translates them to the profile's timezone. The difference is shown in the second example above. With this change, the correct date label should be rendered, and the data should start at midnight without wrapping around the dateline. commit 0330e13e3354f448c6456f22f0693179000ee1d4 Author: Ben West &lt;bewest@gmail.com&gt; Date: Mon Jan 23 08:23:04 2023 -0800 ensure timezones assigned once in daily reports This fixes the label on the days in the daytoday charts. Passing a moment object that is already zoned prevents toLocaleDateString from reinterpreting the zone information when the date is already relative to the profile. This also ensures that the datefilter is adjusted to the profile's zone rather than truncating the time to the end or beginning of the day. This should prevent incorrectly wrapping arounnd the dateline. commit a47b3675a460580ef9bef8c541da44aea09107ba Author: Ben West &lt;bewest@gmail.com&gt; Date: Sun Jan 15 09:59:44 2023 -0800 pin start of day in profile's timezone This more closely mirrors logic in loopalyzer, as well as the intent from the surrounding code in reportclient.js. commit 0541e2a801aac9fb685b84a465daacbd87c63ff4 Author: Ben West &lt;bewest@gmail.com&gt; Date: Sat Jan 14 17:49:52 2023 -0800 daytoday reports are always in the profile's time zone Midnight for the profile should always be at the start of the day (midnight) for the chart. commit 0426b019cabba89cad99c864b1916cfc52c65619 Author: Sulka Haro &lt;sulka@sulka.net&gt; Date: Tue Jan 24 19:48:51 2023 +0200 Fix api v3 users seeing gaps in CGM data (#7853) * Change runtime cache to support item timestamp be defined in either mills or date field. * Fix typo * Return mills in v1 api when returning data from cache * Also parse created_at in the cache * Fix copy paste error commit 26a8cf17758b2e9adc8f819e11834d528f6bf2e3 Author: Sulka Haro &lt;sulka@sulka.net&gt; Date: Tue Jan 24 19:43:45 2023 +0200 Downgrade jsdom to version 11.11.0 (#7851) * rollback compatibility issues for tests Revert &quot;Bump jsonwebtoken from 8.5.1 to 9.0.0 (#7787)&quot; This rolls back changes to node_modules via package-lock.json as a result of new dependencies. More work is needed before involving these changes. Without this rollback, the tests do consistently complete within the allowed time in a reproducible way. * Test Github Actions with jsdom 11.11.0 * Upgrade github actions as requested by the actions runner * Lock generated using 6.14.18 * Upgrade actions/checkout@v2 to v3 * restore jsonwebtoken upgrade Co-authored-by: Ben West &lt;bewest@gmail.com&gt; commit 05de94e5a66167bea47dac76ab5e9c5b8484c678 Author: Sulka Haro &lt;sulka@sulka.net&gt; Date: Mon Jan 23 16:20:53 2023 +0200 Delete v3 api identifiers when cloning a record in profile editor (#7839) * Delete v3 api identifiers when cloning a record * Refactored to use lodash omit * Move cleaning logic to correct function, add _id to list of cleaned properties * Add back a line that was accidentally deleted * profileeditor: add created_at, srvModified too on save to simulate API v3 Co-authored-by: Milos Kozak &lt;m.kozak@sysop.cz&gt; commit c343719f05c7730bb24b3960943e420212233f27 Author: Milos Kozak &lt;m.kozak@sysop.cz&gt; Date: Tue Jan 17 14:06:38 2023 +0100 apiv3 fix patch operation (#7807) Co-authored-by: Sulka Haro &lt;sulka@sulka.net&gt; commit bc8ccc8578174a74496d9c82816083f7937a5cb7 Author: Sulka Haro &lt;sulka@sulka.net&gt; Date: Sun Jan 15 12:50:25 2023 +0200 Merge master to dev so Git is in sync (#7834) * Allow DELETE via PATCH/UPDATE operation too * rollback wrong commit Co-authored-by: Milos Kozak &lt;m.kozak@sysop.cz&gt; commit fd701e9ce5151508a664ddcae80571c30ccbb715 Author: Sulka Haro &lt;sulka@sulka.net&gt; Date: Thu Jan 12 07:59:41 2023 +0200 Fixes a bug introduced in #7273 (#7825) * Fixes a bug introduced in #7273 * Oops somehow managed to commit a wrong file version * Cleaner code based on feedback from Ben commit c1de8a5d84340beee9c2178dc6b9a2fb9b93ada7 Author: Sulka Haro &lt;sulka@sulka.net&gt; Date: Mon Jan 9 19:31:41 2023 +0200 Disabling some date magic from Careportal that's breaking date entry commit bdcb7065bc2dddceeaf1679d479ba72a1cae175a Author: Sulka Haro &lt;sulka@sulka.net&gt; Date: Fri Jan 6 12:09:34 2023 +0200 Generate package-lock with npm 6 to fix deployment issues on various cloud providers commit 3636f37427172dfb856a781cebc48a5884f24a79 Author: Sulka Haro &lt;sulka@sulka.net&gt; Date: Thu Jan 5 18:43:15 2023 +0200 Update actions/checkout action to v3 commit 30216aafdbb47681ce0d50549511265ee8e6491f Author: Sulka Haro &lt;sulka@sulka.net&gt; Date: Thu Jan 5 18:35:33 2023 +0200 Update codeQL actions to v2 commit 6bccede79e840232e80fcb861e0944c501d47693 Author: Sulka Haro &lt;sulka@sulka.net&gt; Date: Thu Jan 5 18:25:35 2023 +0200 Change automated tests to run against the major Mongo releases from last two years commit 8e5986423838d6d5e5a41ceee3392cf4f4cd1f5f Author: Sulka Haro &lt;sulka@sulka.net&gt; Date: Thu Jan 5 14:08:29 2023 +0200 Adding USE_NPM_INSTALL to the Heroku deploy file so new deploys work commit 3a0629578e84db7875893867a413608221cb0e22 Author: Sulka Haro &lt;sulka@sulka.net&gt; Date: Sun Jan 1 19:14:59 2023 +0200 Refactor moment to be loaded from ctx (#7331) * Experimental branch that replaces momentjs with dayjs in the client * Revert unintentional change * feat * Turns out dayjs is a no-go, but this has some good restructuring so submitting that commit e1f75cba6cc4fb7d5925388b3689851661414ed4 Author: Sulka Haro &lt;sulka@sulka.net&gt; Date: Sun Jan 1 13:26:46 2023 +0200 Change viewport scale to fix layout on iPhone (#7623) commit 2dfc471b8ae22f5371f0ec510870e2ec06344477 Author: Dion Nicolaas &lt;dion@nicolaas.net&gt; Date: Sun Jan 1 12:17:26 2023 +0100 Forwarded fix (#7593) * Use 'forwarded' always Getting the remote IP from the socket doesn't work behind a reverse proxy. 'Forwarded' is there to fix there, but wasn't used here. * Consistently use getRemoteIP() throughout Stay in line with other modules that do this * Use getRemoteIP consistently One more missing case; in this file it isn't helpful, but it is consistent with other files. Co-authored-by: Sulka Haro &lt;sulka@sulka.net&gt; commit ba7694055f835b5daa8859bc92783f1753072783 Author: Jörg Schömer &lt;joerg@joerg-schoemer.de&gt; Date: Sun Jan 1 12:05:17 2023 +0100 Fix Server error (#7784) * check if d1 is not nil before call getTime Co-authored-by: Sulka Haro &lt;sulka@sulka.net&gt; commit 6ad4ef18140d33936bf8795c628c698b90ced02c Author: Sulka Haro &lt;sulka@sulka.net&gt; Date: Sun Jan 1 12:57:57 2023 +0200 Update socket.io and uuid packages (#7793) * This commit updates the uuid and socket.io packages to latest versions and enables compression over websocket * Drop the compression threshold down to 512 bytes * Enable http compression down to 512 bytes and request long poll transport only, as per current release * Add the socket.io-client back in * Use polling with the NS client * Update express to latest in 4.x line, fix tests commit 68348227a46ed61a73da160612da43bf851f66b9 Author: Sulka Haro &lt;sulka@sulka.net&gt; Date: Sun Jan 1 12:47:13 2023 +0200 Update package-lock so it matches the package.json commit ad7706dd4a8014860fe781a25f42e6a43a72b5a9 Merge: 79e80c50 05bbc557 Author: Sulka Haro &lt;sulka@sulka.net&gt; Date: Sun Jan 1 12:45:56 2023 +0200 Merge branch 'master' into dev commit 79e80c5023c2500b0482b500a0b3af99348ef6d1 Author: Sulka Haro &lt;sulka@sulka.net&gt; Date: Fri Dec 30 22:39:03 2022 +0200 New Crowdin updates (#7238) * New translations en.json (Hungarian) * New translations en.json (Turkish) * New translations en.json (Hungarian) * New translations en.json (Turkish) * New translations en.json (Turkish) * New translations en.json (Arabic) * New translations en.json (Turkish) * New translations en.json (Slovak) * New translations en.json (Turkish) * New translations en.json (Turkish) * New translations en.json (Turkish) * New translations en.json (Turkish) * New translations en.json (Turkish) * New translations en.json (Turkish) * New translations en.json (Turkish) * New translations en.json (Turkish) * New translations en.json (Turkish) * New translations en.json (Hungarian) * New translations en.json (Turkish) * New translations en.json (Turkish) * New translations en.json (Estonian) * New translations en.json (Estonian) * New translations en.json (Estonian) * New translations en.json (Norwegian Bokmal) * New translations en.json (Portuguese, Brazilian) * New translations en.json (Italian) * New translations en.json (Italian) * New translations en.json (Portuguese, Brazilian) * New translations en.json (Portuguese, Brazilian) * New translations en.json (Portuguese, Brazilian) * New translations en.json (Portuguese, Brazilian) * New translations en.json (Ukrainian) * New translations en.json (Ukrainian) * New translations en.json (Ukrainian) * New translations en.json (Ukrainian) * New translations en.json (German) * New translations en.json (Spanish) * New translations en.json (Turkish) * New translations en.json (Turkish) * New translations en.json (Turkish) * New translations en.json (Estonian) * New translations en.json (Estonian) commit bd400466023925cce61c28dfb6f1379e2e0ad72f Author: Sulka Haro &lt;sulka@sulka.net&gt; Date: Fri Dec 30 22:15:48 2022 +0200 Change the SHA1 validation to be case insensitive (#7780) Co-authored-by: Ben West &lt;bewest@gmail.com&gt; commit 8594a2d21980065d180f21eeb2ac280aead0c7a9 Author: Sulka Haro &lt;sulka@sulka.net&gt; Date: Fri Dec 30 20:31:13 2022 +0200 Regenerated package-lock with newer NPM and fixed a unit test that broke as a result commit 4aa0657049e37927a8045147008cccec7c5e7092 Merge: 2c6ba281 bcfe437a Author: Ben West &lt;bewest@gmail.com&gt; Date: Wed Nov 16 09:53:39 2022 -0800 Merge pull request #7513 from gestrich/bugfix/remove-remote-override-otp Remove unused OTP field from Remote Override form. commit bcfe437adc37cb93427257f7f86f4a91253a2e5e Merge: 3213835a 2c6ba281 Author: Ben West &lt;bewest@gmail.com&gt; Date: Wed Nov 16 08:50:46 2022 -0800 Merge branch 'dev' into bugfix/remove-remote-override-otp commit 2c6ba281963fb75d0c97d05e275eee9e7b141399 Merge: 09c9f813 ed7fdf7c Author: Ben West &lt;bewest@gmail.com&gt; Date: Tue Nov 1 13:33:07 2022 -0700 Merge pull request #7647 from k2s/fix-empty-import-config Fix empty import config commit ed7fdf7c177a3ac04d3376aa74b80d6994ae6674 Author: Martin Minka &lt;martin.minka@gmail.com&gt; Date: Sat Oct 29 11:22:28 2022 +0200 fix don't print error about IMPORT_CONFIG if not defined commit e78a63f5d033b0ef04cd54f82c9f0f5071cdac19 Author: Martin Minka &lt;martin.minka@gmail.com&gt; Date: Sat Oct 29 11:21:44 2022 +0200 fix formatting of empty spaces commit 0fd05c230933b0fa07446df276b2047af59efdbb Author: Martin Minka &lt;martin.minka@gmail.com&gt; Date: Sat Oct 29 11:19:56 2022 +0200 fix webpack 5 in Lerna commit 09c9f8133197361acdbd41637991fbab426d0dfc Merge: 74ce49ce dbce9dbf Author: Ben West &lt;bewest@gmail.com&gt; Date: Sat Oct 1 14:34:01 2022 -0700 Merge pull request #7570 from nightscout/wip/bewest/code-ql-analysis codeql text/html injection in food.js commit dbce9dbfe97c41ad3e880353c3c27ca6e585edae Author: Ben West &lt;bewest@gmail.com&gt; Date: Sat Oct 1 14:24:57 2022 -0700 codeql text/html injection in food.js commit 74ce49ceac2090960f604eb8e8630c1f47a876ba Merge: 8706658b 1db40470 Author: Ben West &lt;bewest@gmail.com&gt; Date: Sat Oct 1 12:39:26 2022 -0700 Merge pull request #7569 from nightscout/wip/bewest/code-ql-analysis Wip/bewest/code ql analysis commit 1db40470cc9436c9147937cf8ea5d1309e7f6659 Author: Ben West &lt;bewest@gmail.com&gt; Date: Sat Oct 1 12:33:31 2022 -0700 avoid HTML injection See if this makes codeql happy. commit 2e1ee38234ef0458959b10f07f7cdd4f20843727 Author: Ben West &lt;bewest@gmail.com&gt; Date: Sat Oct 1 12:27:59 2022 -0700 inject text instead of HTML name Avoid HTML injection called out by CODEQL. commit 8706658b7ef6b6f553752791b17a0b7790fbc684 Merge: a8da747c aed99985 Author: Ben West &lt;bewest@gmail.com&gt; Date: Sat Oct 1 12:18:20 2022 -0700 Merge pull request #7526 from sulkaharo/new_cache_location New build artefact cache location commit aed99985c45929fc3895416d81cb50e7cc9a1d5c Merge: 2e4551ef a8da747c Author: Ben West &lt;bewest@gmail.com&gt; Date: Sat Oct 1 12:11:46 2022 -0700 Merge branch 'dev' into new_cache_location commit a8da747c89f7baebb647f5e3f823616e8caea84c Merge: 2e7f695a 64d93e6f Author: Ben West &lt;bewest@gmail.com&gt; Date: Sat Oct 1 12:10:27 2022 -0700 Merge pull request #7568 from nightscout/wip/bewest/PieterGit-dev20220815 Wip/bewest/pieter git dev20220815 commit 64d93e6fe3531b2600e68efa0c8a2f8058d3e0bf Author: Ben West &lt;bewest@gmail.com&gt; Date: Sat Oct 1 11:51:58 2022 -0700 allow any LTS version The '^' prefix makes this meaingless, there's no reason to refuse to run less than 16.16.0 if it's still some 16.x. commit 9f622c2b51a1ef7c813b0a145de2a5c2a5bd583d Merge: 2e7f695a 3c516d5b Author: Ben West &lt;bewest@gmail.com&gt; Date: Sat Oct 1 11:46:39 2022 -0700 Merge branch 'dev20220815' of github.com:PieterGit/cgm-remote-monitor into PieterGit-dev20220815 commit 2e7f695a3c5d12fb996f81663de8b4735a84b055 Author: Ben West &lt;bewest@gmail.com&gt; Date: Fri Sep 30 14:27:27 2022 -0700 initialize new dev area post-release commit 2e4551efe063c10d5a04030828db1e71956d9c25 Merge: 6978a900 df85fd23 Author: Sulka Haro &lt;sulka@sulka.net&gt; Date: Tue Aug 30 15:06:39 2022 +0300 Merge branch 'dev' into new_cache_location commit 6978a90083868ad11ccd180930c42d1c6878567b Author: Sulka Haro &lt;sulka@sulka.net&gt; Date: Tue Aug 30 13:16:29 2022 +0300 Fix package running the post script commit 6c03dcdc64e42aef60cb73ef41899c5fea0e9b2d Author: Sulka Haro &lt;sulka@sulka.net&gt; Date: Tue Aug 30 12:54:10 2022 +0300 Remove mkdir from package.json and change key generation to a post script commit ec3cf94355031990d6604d6cd7890f1e85b31c7f Author: Sulka Haro &lt;sulka@sulka.net&gt; Date: Tue Aug 30 12:49:01 2022 +0300 * Fix tests * Change | to &amp;&amp; in package.json commit a6eb1561e9711ed646c9e2c561347eb101db0584 Author: Sulka Haro &lt;sulka@sulka.net&gt; Date: Mon Aug 29 10:40:55 2022 +0300 Fix app.js commit 37a2a0d004343aabf516ef6ac75d6aaa729a8a33 Author: Sulka Haro &lt;sulka@sulka.net&gt; Date: Mon Aug 29 10:28:09 2022 +0300 Try .cache in node_modules commit 7b01d49577ca069dadf79e9822a8a6702954e626 Author: Sulka Haro &lt;sulka@sulka.net&gt; Date: Sun Aug 28 09:37:04 2022 +0300 Experimenting around changing build artefact location to go to node_modules, so the content is retained across cached builds in various PAAS environments commit 3c516d5baf8c0030c102211943c519df9709b518 Author: PieterGit &lt;pieterg@gmail.com&gt; Date: Tue Aug 16 15:49:49 2022 +0200 support &gt; 0.25% of browerslist, see if we can support iOS 9.3.x as well... commit 4a64be2aed1b6d8eef732b282433240456740085 Author: PieterGit &lt;pieterg@gmail.com&gt; Date: Tue Aug 16 15:13:04 2022 +0200 remove two critical vulnerabilities in npm packages. Remove codacy-coverage pacakge (see issue #7515 ). commit b7ee1bfb5af2b4339207f1e19a410ac4046a96e3 Author: PieterGit &lt;pieterg@gmail.com&gt; Date: Tue Aug 16 13:48:17 2022 +0200 upgrade mocha to 8.4.0 and nodemon to 2.0.19 and recreate package-lock.json with node v10.24.1 commit 652baedd3c168deddc0f0222f962a8e6979066d6 Author: PieterGit &lt;pieterg@gmail.com&gt; Date: Mon Aug 15 23:30:15 2022 +0200 update all webpack related plugins to latest version commit 0a81915c4f944ed942236c96b274e9c04e719dbf Author: PieterGit &lt;pieterg@gmail.com&gt; Date: Mon Aug 15 23:02:32 2022 +0200 drop Node 18 support for now commit fb4d4677557be71d17761e0244a8beb1f1d45a58 Author: PieterGit &lt;pieterg@gmail.com&gt; Date: Mon Aug 15 17:44:08 2022 +0200 update Node requirements. This is a follow up from https://github.com/nightscout/cgm-remote-monitor/pull/7417 since @bewest already merged his branch to dev add NodeJS 16.x support. drop NodeJS 12.x support.It reached End-of-Life status on 30 April 2022 allow NodeJS 18.x support to run for CI upgrade webpack and webpack-cli update browserlist and browser documentation, config is now at .browserslistrc update README.md for browsers and Node versions fix typos in comments in lib/client/hashauth.js and webpack/webpack.config from https://github.com/nightscout/cgm-remote-monitor/pull/7440 commit 3213835a5cba23247ec9e554db0d916523dbd6f8 Merge: a5fcc84c df85fd23 Author: Ben West &lt;bewest@gmail.com&gt; Date: Sun Aug 14 10:56:33 2022 -0700 Merge branch 'dev' into bugfix/remove-remote-override-otp commit a5fcc84c9cdb4eea890bac419792a3247b4b251d Merge: 1a83292e a5c67b5a Author: Ben West &lt;bewest@gmail.com&gt; Date: Sun Aug 14 10:41:22 2022 -0700 Merge branch 'dev' into bugfix/remove-remote-override-otp commit 1a83292ededecc6d71af7498c8f7f41873a9ba5d Author: Bill Gestrich &lt;3207996+gestrich@users.noreply.github.com&gt; Date: Sun Aug 14 06:48:20 2022 -0400 Remove unused OTP field from Remote Override form.</MESSAGE>
      <SHA>3cbd33cc26b8dabdfb8d816d4eb3fbb23e1a0093</SHA>
      <PATCHEDFILES>
        <FILE>.browserslistrc</FILE>
        <FILE>.github/workflows/codeql-analysis.yml</FILE>
        <FILE>.github/workflows/main.yml</FILE>
        <FILE>.nvmrc</FILE>
        <FILE>README.md</FILE>
        <FILE>app.json</FILE>
        <FILE>azuredeploy.json</FILE>
        <FILE>bundle/bundle.source.js</FILE>
        <FILE>docker-compose.yml</FILE>
        <FILE>lib/admin_plugins/cleanentriesdb.js</FILE>
        <FILE>lib/admin_plugins/cleanstatusdb.js</FILE>
        <FILE>lib/admin_plugins/cleantreatmentsdb.js</FILE>
        <FILE>lib/admin_plugins/index.js</FILE>
        <FILE>lib/api/entries/index.js</FILE>
        <FILE>lib/api/notifications-api.js</FILE>
        <FILE>lib/api/properties.js</FILE>
        <FILE>lib/api/treatments/index.js</FILE>
        <FILE>lib/api3/alarmSocket.js</FILE>
        <FILE>lib/api3/doc/alarmsockets.md</FILE>
        <FILE>lib/api3/doc/security.md</FILE>
        <FILE>lib/api3/doc/tutorial.md</FILE>
        <FILE>lib/api3/generic/patch/operation.js</FILE>
        <FILE>lib/api3/index.js</FILE>
        <FILE>lib/api3/security.js</FILE>
        <FILE>lib/api3/shared/operationTools.js</FILE>
        <FILE>lib/api3/storageSocket.js</FILE>
        <FILE>lib/api3/swagger.json</FILE>
        <FILE>lib/api3/swagger.yaml</FILE>
        <FILE>lib/authorization/index.js</FILE>
        <FILE>lib/authorization/storage.js</FILE>
        <FILE>lib/client/boluscalc.js</FILE>
        <FILE>lib/client/careportal.js</FILE>
        <FILE>lib/client/hashauth.js</FILE>
        <FILE>lib/client/index.js</FILE>
        <FILE>lib/data/dataloader.js</FILE>
        <FILE>lib/data/ddata.js</FILE>
        <FILE>lib/data/endpoints.js</FILE>
        <FILE>lib/food/food.js</FILE>
        <FILE>lib/plugins/ar2.js</FILE>
        <FILE>lib/plugins/basalprofile.js</FILE>
        <FILE>lib/plugins/batteryage.js</FILE>
        <FILE>lib/plugins/bgnow.js</FILE>
        <FILE>lib/plugins/cannulaage.js</FILE>
        <FILE>lib/plugins/cob.js</FILE>
        <FILE>lib/plugins/insulinage.js</FILE>
        <FILE>lib/plugins/iob.js</FILE>
        <FILE>lib/plugins/loop.js</FILE>
        <FILE>lib/plugins/openaps.js</FILE>
        <FILE>lib/plugins/pump.js</FILE>
        <FILE>lib/plugins/sensorage.js</FILE>
        <FILE>lib/plugins/treatmentnotify.js</FILE>
        <FILE>lib/plugins/upbat.js</FILE>
        <FILE>lib/plugins/virtAsstBase.js</FILE>
        <FILE>lib/plugins/xdripjs.js</FILE>
        <FILE>lib/profile/profileeditor.js</FILE>
        <FILE>lib/profilefunctions.js</FILE>
        <FILE>lib/report/reportclient.js</FILE>
        <FILE>lib/report_plugins/daytoday.js</FILE>
        <FILE>lib/sandbox.js</FILE>
        <FILE>lib/server/app.js</FILE>
        <FILE>lib/server/bootevent.js</FILE>
        <FILE>lib/server/cache.js</FILE>
        <FILE>lib/server/enclave.js</FILE>
        <FILE>lib/server/entries.js</FILE>
        <FILE>lib/server/server.js</FILE>
        <FILE>lib/server/websocket.js</FILE>
        <FILE>lib/utils.js</FILE>
        <FILE>package-lock.json</FILE>
        <FILE>package.json</FILE>
        <FILE>tests/admintools.test.js</FILE>
        <FILE>tests/api.entries.test.js</FILE>
        <FILE>tests/api.security.test.js</FILE>
        <FILE>tests/api3.create.test.js</FILE>
        <FILE>tests/api3.delete.test.js</FILE>
        <FILE>tests/api3.generic.workflow.test.js</FILE>
        <FILE>tests/api3.patch.test.js</FILE>
        <FILE>tests/api3.read.test.js</FILE>
        <FILE>tests/api3.renderer.test.js</FILE>
        <FILE>tests/api3.search.test.js</FILE>
        <FILE>tests/api3.security.test.js</FILE>
        <FILE>tests/api3.socket.test.js</FILE>
        <FILE>tests/api3.update.test.js</FILE>
        <FILE>tests/ar2.test.js</FILE>
        <FILE>tests/basalprofileplugin.test.js</FILE>
        <FILE>tests/bgnow.test.js</FILE>
        <FILE>tests/boluswizardpreview.test.js</FILE>
        <FILE>tests/cannulaage.test.js</FILE>
        <FILE>tests/cob.test.js</FILE>
        <FILE>tests/fixtures/api3/authSubject.js</FILE>
        <FILE>tests/fixtures/api3/instance.js</FILE>
        <FILE>tests/fixtures/headless.js</FILE>
        <FILE>tests/inithelper.js</FILE>
        <FILE>tests/insulinage.test.js</FILE>
        <FILE>tests/iob.test.js</FILE>
        <FILE>tests/loop.test.js</FILE>
        <FILE>tests/openaps.test.js</FILE>
        <FILE>tests/profile.test.js</FILE>
        <FILE>tests/pump.test.js</FILE>
        <FILE>tests/reports.test.js</FILE>
        <FILE>tests/sensorage.test.js</FILE>
        <FILE>tests/utils.test.js</FILE>
        <FILE>translations/ar_SA.json</FILE>
        <FILE>translations/de_DE.json</FILE>
        <FILE>translations/es_ES.json</FILE>
        <FILE>translations/et_EE.json</FILE>
        <FILE>translations/hu_HU.json</FILE>
        <FILE>translations/it_IT.json</FILE>
        <FILE>translations/nb_NO.json</FILE>
        <FILE>translations/pt_BR.json</FILE>
        <FILE>translations/ru_RU.json</FILE>
        <FILE>translations/sk_SK.json</FILE>
        <FILE>translations/tr_TR.json</FILE>
        <FILE>translations/uk_UA.json</FILE>
        <FILE>views/index.html</FILE>
        <FILE>webpack/webpack.config.js</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
