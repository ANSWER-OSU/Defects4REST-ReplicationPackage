<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>547</ISSUENO>
  <ISSUEURL>https://github.com/NatLibFi/Annif/issues/547</ISSUEURL>
  <TITLE>Configuration file format compatible with DVC</TITLE>
  <DESCRIPTION>To make it possible to use Annif productively in a [DVC](https://dvc.org/) workflow, it would be helpful if DVC tools could read parameters directly from the Annif configuration file. DVC can currently read parameters from YAML 1.2, JSON, TOML and Python files (see documentation for [dvc params](https://dvc.org/doc/command-reference/params)). Annif uses INI-style syntax (supported by [configparser](https://docs.python.org/3/library/configparser.html) Python standard library module) in the `projects.cfg` configuration file. This is similar to TOML, but not identical. I can think of at least these options for making the Annif configuration file DVC-compatible: 1. Support YAML configuration files as an alternative to the current format. 2. Support JSON configuration files as an alternative to the current format. 3. Support TOML configuration files as an alternative to the current format. 4. Adjust the current format slightly so that it becomes a valid subset of TOML. I think we can rule out 2., because JSON is not very nice as a configuration language because of its strict syntax and lack of support for comments. If we want a new configuration format, either YAML (option 1) or TOML (option 3) is better. For 4., AFAICT the main difference between the current syntax and TOML is that TOML requires string values to be quoted. So instead of this: ``` [tfidf-en] language=en backend=tfidf analyzer=snowball(english) limit=100 vocab=yso-en ``` the syntax must be ``` [tfidf-en] language=&quot;en&quot; backend=&quot;tfidf&quot; analyzer=&quot;snowball(english)&quot; limit=100 vocab=&quot;yso-en&quot; ``` (note that `limit` can be left as-is, as the value 100 is an integer, not a string) This syntax doesn't work with ConfigParser currently, because it includes the quotes as part of the value. But it would be simple to change the `optionxform` so that it drops any quotes from the value. The file name `projects.cfg` could still be a problem for DVC, which would probably expect the extension `.toml` so that it recognizes which syntax to use.</DESCRIPTION>
  <REPONAME>Annif</REPONAME>
  <TIMEDIFFERENCEDAYS>44</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #558 from NatLibFi/issue545-eval-metric-option Add --metric/-m option to eval command to select metric(s)</MESSAGE>
    <SHA>718bee3ebeaa9bfb77745e468e4328e1c3a9db63</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Allow string values to be quoted in the config file, similar to TOML syntax. Related to #547</MESSAGE>
      <SHA>1e9609c23cd75166252835b0f18526a2a1334887</SHA>
      <PATCHEDFILES>
        <FILE>annif/registry.py</FILE>
        <FILE>tests/projects.cfg</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Support TOML as a configuration file format alongside CFG/INI. Fixes #547</MESSAGE>
      <SHA>27f381b3fc45f947bbffc6667a03c9fa6620379a</SHA>
      <PATCHEDFILES>
        <FILE>annif/cli.py</FILE>
        <FILE>annif/default_config.py</FILE>
        <FILE>annif/registry.py</FILE>
        <FILE>setup.py</FILE>
        <FILE>tests/test_project.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Support TOML as a configuration file format alongside CFG/INI. Fixes #547</MESSAGE>
      <SHA>66dcebd2f85a21fb98cf87a83fef7e2343863f69</SHA>
      <PATCHEDFILES>
        <FILE>annif/cli.py</FILE>
        <FILE>annif/default_config.py</FILE>
        <FILE>annif/registry.py</FILE>
        <FILE>setup.py</FILE>
        <FILE>tests/projects.toml</FILE>
        <FILE>tests/test_project.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Support TOML as a configuration file format alongside CFG/INI. Fixes #547</MESSAGE>
      <SHA>b816e71d9f10fcc967397872f6fc2f4d5310c392</SHA>
      <PATCHEDFILES>
        <FILE>annif/cli.py</FILE>
        <FILE>annif/default_config.py</FILE>
        <FILE>annif/registry.py</FILE>
        <FILE>setup.py</FILE>
        <FILE>tests/projects.toml</FILE>
        <FILE>tests/test_project.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
