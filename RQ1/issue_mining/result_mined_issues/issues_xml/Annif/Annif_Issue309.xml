<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>309</ISSUENO>
  <ISSUEURL>https://github.com/NatLibFi/Annif/issues/309</ISSUEURL>
  <TITLE>Training from .key files with only subject labels fails</TITLE>
  <DESCRIPTION>As pointed out in #303, it's impossible to train from a directory with `.txt` and `.key` files which contain only subject labels but no URIs. Example traceback with `tfidf` backend: ``` Traceback (most recent call last): File &quot;/home/oisuomin/.local/share/virtualenvs/Annif-G8ShVyyO/bin/annif&quot;, line 11, in &lt;module&gt; load_entry_point('annif', 'console_scripts', 'annif')() File &quot;/home/oisuomin/.local/share/virtualenvs/Annif-G8ShVyyO/lib/python3.5/site-packages/click/core.py&quot;, line 764, in __call__ return self.main(*args, **kwargs) File &quot;/home/oisuomin/.local/share/virtualenvs/Annif-G8ShVyyO/lib/python3.5/site-packages/flask/cli.py&quot;, line 569, in main return super(FlaskGroup, self).main(*args, **kwargs) File &quot;/home/oisuomin/.local/share/virtualenvs/Annif-G8ShVyyO/lib/python3.5/site-packages/click/core.py&quot;, line 717, in main rv = self.invoke(ctx) File &quot;/home/oisuomin/.local/share/virtualenvs/Annif-G8ShVyyO/lib/python3.5/site-packages/click/core.py&quot;, line 1137, in invoke return _process_result(sub_ctx.command.invoke(sub_ctx)) File &quot;/home/oisuomin/.local/share/virtualenvs/Annif-G8ShVyyO/lib/python3.5/site-packages/click/core.py&quot;, line 956, in invoke return ctx.invoke(self.callback, **ctx.params) File &quot;/home/oisuomin/.local/share/virtualenvs/Annif-G8ShVyyO/lib/python3.5/site-packages/click/core.py&quot;, line 555, in invoke return callback(*args, **kwargs) File &quot;/home/oisuomin/.local/share/virtualenvs/Annif-G8ShVyyO/lib/python3.5/site-packages/click/decorators.py&quot;, line 17, in new_func return f(get_current_context(), *args, **kwargs) File &quot;/home/oisuomin/.local/share/virtualenvs/Annif-G8ShVyyO/lib/python3.5/site-packages/flask/cli.py&quot;, line 419, in decorator return __ctx.invoke(f, *args, **kwargs) File &quot;/home/oisuomin/.local/share/virtualenvs/Annif-G8ShVyyO/lib/python3.5/site-packages/click/core.py&quot;, line 555, in invoke return callback(*args, **kwargs) File &quot;/home/local/oisuomin/git/Annif/annif/cli.py&quot;, line 154, in run_train proj.train(documents) File &quot;/home/local/oisuomin/git/Annif/annif/project.py&quot;, line 197, in train self._create_vectorizer(corpus) File &quot;/home/local/oisuomin/git/Annif/annif/project.py&quot;, line 186, in _create_vectorizer self._vectorizer.fit((subj.text for subj in subjectcorpus.subjects)) File &quot;/home/oisuomin/.local/share/virtualenvs/Annif-G8ShVyyO/lib/python3.5/site-packages/sklearn/feature_extraction/text.py&quot;, line 1631, in fit X = super().fit_transform(raw_documents) File &quot;/home/oisuomin/.local/share/virtualenvs/Annif-G8ShVyyO/lib/python3.5/site-packages/sklearn/feature_extraction/text.py&quot;, line 1058, in fit_transform self.fixed_vocabulary_) File &quot;/home/oisuomin/.local/share/virtualenvs/Annif-G8ShVyyO/lib/python3.5/site-packages/sklearn/feature_extraction/text.py&quot;, line 989, in _count_vocab raise ValueError(&quot;empty vocabulary; perhaps the documents only&quot; ValueError: empty vocabulary; perhaps the documents only contain stop words ``` With `fasttext` backend: ``` Traceback (most recent call last): File &quot;/home/oisuomin/.local/share/virtualenvs/Annif-G8ShVyyO/bin/annif&quot;, line 11, in &lt;module&gt; load_entry_point('annif', 'console_scripts', 'annif')() File &quot;/home/oisuomin/.local/share/virtualenvs/Annif-G8ShVyyO/lib/python3.5/site-packages/click/core.py&quot;, line 764, in __call__ return self.main(*args, **kwargs) File &quot;/home/oisuomin/.local/share/virtualenvs/Annif-G8ShVyyO/lib/python3.5/site-packages/flask/cli.py&quot;, line 569, in main return super(FlaskGroup, self).main(*args, **kwargs) File &quot;/home/oisuomin/.local/share/virtualenvs/Annif-G8ShVyyO/lib/python3.5/site-packages/click/core.py&quot;, line 717, in main rv = self.invoke(ctx) File &quot;/home/oisuomin/.local/share/virtualenvs/Annif-G8ShVyyO/lib/python3.5/site-packages/click/core.py&quot;, line 1137, in invoke return _process_result(sub_ctx.command.invoke(sub_ctx)) File &quot;/home/oisuomin/.local/share/virtualenvs/Annif-G8ShVyyO/lib/python3.5/site-packages/click/core.py&quot;, line 956, in invoke return ctx.invoke(self.callback, **ctx.params) File &quot;/home/oisuomin/.local/share/virtualenvs/Annif-G8ShVyyO/lib/python3.5/site-packages/click/core.py&quot;, line 555, in invoke return callback(*args, **kwargs) File &quot;/home/oisuomin/.local/share/virtualenvs/Annif-G8ShVyyO/lib/python3.5/site-packages/click/decorators.py&quot;, line 17, in new_func return f(get_current_context(), *args, **kwargs) File &quot;/home/oisuomin/.local/share/virtualenvs/Annif-G8ShVyyO/lib/python3.5/site-packages/flask/cli.py&quot;, line 419, in decorator return __ctx.invoke(f, *args, **kwargs) File &quot;/home/oisuomin/.local/share/virtualenvs/Annif-G8ShVyyO/lib/python3.5/site-packages/click/core.py&quot;, line 555, in invoke return callback(*args, **kwargs) File &quot;/home/local/oisuomin/git/Annif/annif/cli.py&quot;, line 154, in run_train proj.train(documents) File &quot;/home/local/oisuomin/git/Annif/annif/project.py&quot;, line 198, in train self.backend.train(corpus, project=self) File &quot;/home/local/oisuomin/git/Annif/annif/backend/fasttext.py&quot;, line 108, in train self._create_model() File &quot;/home/local/oisuomin/git/Annif/annif/backend/fasttext.py&quot;, line 103, in _create_model self._model = fastText.train_supervised(trainpath, **params) File &quot;/home/oisuomin/.local/share/virtualenvs/Annif-G8ShVyyO/lib/python3.5/site-packages/fastText/FastText.py&quot;, line 343, in train_supervised fasttext.train(ft.f, a) ValueError: Empty vocabulary. Try a smaller -minCount value. ``` The problem seems to be that subject labels are not being converted to URIs internally, although they should.</DESCRIPTION>
  <REPONAME>Annif</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #296 from NatLibFi/use-VW-version-8.7 Use vw version 8.7</MESSAGE>
    <SHA>0fd6e749e228452db760c96473e5b01f436b77d8</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Add failing unit test for #309</MESSAGE>
      <SHA>135a3d58e1723a4c95656add6a6708d10933e3ae</SHA>
      <PATCHEDFILES>
        <FILE>tests/test_corpus.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Look up URIs/labels as necessary when creating Documents. Make sure test for #309 passes</MESSAGE>
      <SHA>5c97824e9660259ac0d55df63d3e4b3c23a8e17a</SHA>
      <PATCHEDFILES>
        <FILE>annif/corpus/document.py</FILE>
        <FILE>annif/corpus/types.py</FILE>
        <FILE>tests/test_corpus.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
