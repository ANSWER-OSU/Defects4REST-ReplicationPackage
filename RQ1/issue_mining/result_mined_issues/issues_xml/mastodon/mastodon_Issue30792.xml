<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>30792</ISSUENO>
  <ISSUEURL>https://github.com/mastodon/mastodon/issues/30792</ISSUEURL>
  <TITLE>LinkCrawlWorker Encoding::UndefinedConversionError</TITLE>
  <DESCRIPTION>### Steps to reproduce the problem Starting seeing a lot of these appear recently, connected to links posted by https://mastodon.social/@ukraineforum `&quot;\xC3&quot; from ASCII-8BIT to UTF-8 on https://ukraineforum.de/unterstaatssekret%C3%A4r-au%C3%9Fenministerium-gespr%C3%A4chen-kyjiw-eingetroffen-t160676.html?mtm_source=mastodon&amp;mtm_medium=social&amp;mtm_campaign=ma` Encoding fixes just added in #30780 did not cover these. ### Expected behaviour No encoding errors ### Actual behaviour Errors ### Detailed description ![CleanShot 2024-06-21 at 08 05 33@2x](https://github.com/mastodon/mastodon/assets/3002053/19bdeb63-4587-4d0f-b62b-b50a8eed5c2b) ### Mastodon instance vmst.io ### Mastodon version v4.3.0-alpha.4 ### Technical details - Mastodon 4.3.0-alpha.4+pr-30780 - Ruby 3.3.3p89 - PostgreSQL 16.3 - Redis 7.2.4 - OpenSearch 2.14.0 - libvips 8.15.2 - FFmpeg 7.0.1</DESCRIPTION>
  <REPONAME>mastodon</REPONAME>
  <TIMEDIFFERENCEDAYS>6</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>New Crowdin Translations (automated) (#30851) Co-authored-by: GitHub Actions &lt;noreply@github.com&gt;</MESSAGE>
    <SHA>6d1c1fd684d0f20691cba552b209b15d0107dfe4</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Catch encoding errors when creating link previews. This skips creation of link previews if any encoding errors occurr. See #30792</MESSAGE>
      <SHA>f5f8e61e4365a0bef0f1a7e44960f3c769168eca</SHA>
      <PATCHEDFILES>
        <FILE>app/services/fetch_link_card_service.rb</FILE>
        <FILE>spec/fixtures/requests/redirect_with_utf8_url.txt</FILE>
        <FILE>spec/services/fetch_link_card_service_spec.rb</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
