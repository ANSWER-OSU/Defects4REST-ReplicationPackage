<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>32540</ISSUENO>
  <ISSUEURL>https://github.com/mastodon/mastodon/issues/32540</ISSUEURL>
  <TITLE>Streaming healthcheck doesn't send headers to prevent caching</TITLE>
  <DESCRIPTION>### Steps to reproduce the problem Request to the streaming health check shouldn't be cached by intermediaries ### Expected behaviour Responses have appropriate cache control headers ### Actual behaviour They don't ### Detailed description Ask @ThisIsMissEm ### Mastodon instance _No response_ ### Mastodon version _No response_ ### Technical details If this is happening on your own Mastodon server, please fill out those: - Ruby version: (from `ruby --version`, eg. v3.3.5) - Node.js version: (from `node --version`, eg. v20.18.0)</DESCRIPTION>
  <REPONAME>mastodon</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Update rails to version 7.1.4.1 (#32542)</MESSAGE>
    <SHA>a0c7b317a727521a8c5d9c5af9a4d29107fd9a40</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fix missing or incorrect cache-control headers for Streaming server Fixes #32540. This was likely causing Cloudflare to cache the healthcheck endpoint.</MESSAGE>
      <SHA>d81b811d8acc609f0306348c2cd3a4e46ce64e53</SHA>
      <PATCHEDFILES>
        <FILE>streaming/index.js</FILE>
        <FILE>streaming/metrics.js</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
