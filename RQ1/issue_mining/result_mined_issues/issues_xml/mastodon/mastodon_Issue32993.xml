<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>32993</ISSUENO>
  <ISSUEURL>https://github.com/mastodon/mastodon/issues/32993</ISSUEURL>
  <TITLE>Duplicate notifications in notification groups in slow mode</TITLE>
  <DESCRIPTION>### Steps to reproduce the problem 1. Enable slow mode 2. Get some notifications in a group that is already displayed 3. Load the pending notifications ### Expected behaviour Older notifications are not re-added to the group ### Actual behaviour Loading pending notifications causes already-loaded notifications to be duplicated ### Detailed description This is because the logic in the following code does not distinguish between old and new notifications: https://github.com/mastodon/mastodon/blob/174c687ca0234285fac87d47196bbf0b1b606c33/app/javascript/mastodon/reducers/notification_groups.ts#L534-L543 ### Mastodon instance any ### Mastodon version v4.3.1 ### Browser name and version any ### Operating system any ### Technical details _No response_</DESCRIPTION>
  <REPONAME>mastodon</REPONAME>
  <TIMEDIFFERENCEDAYS>1</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Refactor `createNotificationGroupFromNotificationJSON` to not bypass typechecking</MESSAGE>
    <SHA>7fc6ce095929a328d70734f4552211a5f7cc3046</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fix duplicate notifications in notification groups when using slow mode Fixes #32993</MESSAGE>
      <SHA>10094597608e1dba000fd315518b839ae5a680fb</SHA>
      <PATCHEDFILES>
        <FILE>app/javascript/mastodon/models/notification_group.ts</FILE>
        <FILE>app/javascript/mastodon/reducers/notification_groups.ts</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
