<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>8494</ISSUENO>
  <ISSUEURL>https://github.com/DSpace/DSpace/issues/8494</ISSUEURL>
  <TITLE>Deleting bitstreams via the 6.x REST API leaves empty bundles</TITLE>
  <DESCRIPTION>Deleting the last bitstreams in a bundle via the REST API on DSpace 6.4 (including on demo.dspace.org) from either the `DELETE /items/{item id}/bitstreams/{bitstream id}` or `DELETE /bitstreams/{bitstream id}` endpoints leaves the bundle itself and the link between the bundle and the item, which results an empty bundle in the item bitstreams. This is mostly harmless but causes XMLUI to show a broken thumbnail. To reproduce the bug, add a bitstream in a bundle, then delete it through the REST API (all the item bitstreams in a bundle must be deleted): ```bash curl -X DELETE '{DOMAIN}/rest/bitstreams/{BITSTREAM_ID}' -H 'Cookie:JSESSIONID={JSESSIONID}' ``` The behavior can be confirmed by either looking at the `item2bundle` table in the database, which will show that the bundle is still there or from the XMLUI bitstreams edit form. **After deleting the last ORIGINAL bitstream (XMLUI edit bitstreams form):** &lt;img width=&quot;868&quot; alt=&quot;Screen Shot 2022-09-29 at 2 23 21 PM&quot; src=&quot;https://user-images.githubusercontent.com/20943086/193020060-8d05988e-d785-4ddc-80c6-f8352d27aa46.png&quot;&gt; **After deleting the last THUMBNAIL bitstream (XMLUI edit bitstreams form):** &lt;img width=&quot;855&quot; alt=&quot;Screen Shot 2022-09-29 at 2 27 41 PM&quot; src=&quot;https://user-images.githubusercontent.com/20943086/193020084-a00b1837-c924-4fb2-8d7a-3e0dd779baea.png&quot;&gt; **After deleting the last THUMBNAIL bitstream (XMLUI item view):** &lt;img width=&quot;824&quot; alt=&quot;Screen Shot 2022-09-29 at 2 28 19 PM&quot; src=&quot;https://user-images.githubusercontent.com/20943086/193020118-a963c951-12c7-40bd-b0f3-bdc26d527d15.png&quot;&gt; The suggested fix is to delete the bundle when there are no remaining bitstreams. https://github.com/DSpace/DSpace/pull/8497</DESCRIPTION>
  <REPONAME>DSpace</REPONAME>
  <TIMEDIFFERENCEDAYS>280</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #8492 from 4Science/CST-6938 Fixed error handling for invalid password during eperson creation</MESSAGE>
    <SHA>87cbca439ba955e38185679c240739cd26222dcc</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>https://github.com/DSpace/DSpace/issues/8494 REST API, delete the bundle when there are no remaining bitstreams</MESSAGE>
      <SHA>73c62b32d880912db2334e47116b59e3305a581a</SHA>
      <PATCHEDFILES>
        <FILE>dspace-api/src/main/java/org/dspace/content/BitstreamServiceImpl.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>https://github.com/DSpace/DSpace/issues/8494 REST API, delete the bundle when there are no remaining bitstreams</MESSAGE>
      <SHA>54cb62b3fdf7b7feb74cb404cabff5bd99018a04</SHA>
      <PATCHEDFILES>
        <FILE>dspace-api/src/main/java/org/dspace/content/BitstreamServiceImpl.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
