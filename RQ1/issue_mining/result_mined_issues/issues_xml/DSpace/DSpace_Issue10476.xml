<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>10476</ISSUENO>
  <ISSUEURL>https://github.com/DSpace/DSpace/issues/10476</ISSUEURL>
  <TITLE>[Docker] Cannot run CLI commands when JVM debugging enabled</TITLE>
  <DESCRIPTION>## Describe the bug This appears to be caused by / related to #10031. Should be fixed by #10487 On the `main` branch, I'm no longer able to run CLI commands in Docker when using the `dspace-test` image. This is the only image where we specify debugging options via `JAVA_TOOL_OPTIONS`: https://github.com/DSpace/DSpace/blob/main/Dockerfile.test#L72 ## To Reproduce Steps to reproduce the behavior: 1. Start up an image based on `dspace-test` using `main` branch 2. SSH into the running image by running `docker exec -it dspace /bin/bash` (where &quot;dspace&quot; is the image name) 3. Attempt to run one of our commandline scripts, e.g. `./bin/dspace index-discovery -b` The result will be an error which says something like this: ``` Picked up JAVA_TOOL_OPTIONS: -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=*:8000 ERROR: transport error 202: bind failed: Address already in use ERROR: JDWP Transport dt_socket failed to initialize, TRANSPORT_INIT(510) JDWP exit error AGENT_ERROR_TRANSPORT_INIT(197): No transports initialized [src/jdk.jdwp.agent/share/native/libjdwp/debugInit.c:744] ``` It's possible this is specific to Docker Desktop on Windows (which is what I'm using) I've verified that nothing is running on port 8000. It almost seems like this error comes from JDWP attempting to bind to port 8000, which is already &quot;in use&quot; by Docker because it is published/exposed (to allow for remote debugging). If I manually edit the `Dockerfile.test` file to **comment out** the `ENV JAVA_TOOL_OPTIONS` line (near the end of the file) and rebuild the Docker image, then CLI commands work. ## Expected behavior CLI commands should still work on the `dspace-test` image. ## Related work #10031</DESCRIPTION>
  <REPONAME>DSpace</REPONAME>
  <TIMEDIFFERENCEDAYS>7</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #9823 from bram-atmire/IndexClient-refactored Refactored IndexClient</MESSAGE>
    <SHA>1052915360bd4301733c21aeb15b5ae0f44e250a</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>#10476: Fix debug port conflicts in Dockerfile test env Reset JAVA_TOOL_OPTIONS in the launcher Include commented example of CLI debugging in launcher</MESSAGE>
      <SHA>1dcb880e00256fb6251d6c8d92907819f0fd7b5f</SHA>
      <PATCHEDFILES>
        <FILE>dspace/bin/dspace</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
