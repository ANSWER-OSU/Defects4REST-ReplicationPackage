<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>3461</ISSUENO>
  <ISSUEURL>https://github.com/DSpace/DSpace/issues/3461</ISSUEURL>
  <TITLE>[DS-84] Improve API for &quot;IgnoreAuthorization&quot; blocks - ID: 1687783</TITLE>
  <DESCRIPTION>&lt;i&gt;Imported from JIRA &lt;a href=&quot;https://jira.lyrasis.org/browse/DS-84&quot;&gt;[DS-84]&lt;/a&gt; created by bollini&lt;/i&gt; &lt;p&gt;The bug fix 1480496 (Cannot turn off &quot;ignore authorization&quot; flag!)&lt;br/&gt; has shown that the authorization method setIgnoreAuthorization() is not&lt;br/&gt; friendly. In fact if we have two blocks that require authorization check&lt;br/&gt; to false and these blocks are nested, as in the following example:&lt;br/&gt; ...&lt;span class=&quot;error&quot;&gt;&amp;#91;some java code here&amp;#93;&lt;/span&gt;...&lt;br/&gt; setIgnoreAuthorization(true) // start of first block&lt;br/&gt; ---my first block without authorization check&lt;br/&gt; ---my first block without authorization check&lt;br/&gt; ---my first block without authorization check&lt;br/&gt; ------setIgnoreAuthorization(true) // start of second block&lt;br/&gt; ------my second block without authorization check&lt;br/&gt; ------my second block without authorization check&lt;br/&gt; ------my second block without authorization check&lt;br/&gt; ------setIgnoreAuthorization(false) // end of second block&lt;br/&gt; ---other code in first block&lt;br/&gt; setIgnoreAuthorization(false) // end of first block&lt;br/&gt; ...&lt;br/&gt; the &quot;other code in first block&quot; is executed with authorization check and&lt;br/&gt; does not work. It will be really too easy to come up with this situation&lt;br/&gt; (actually possible for my patch automapper) with the new code called by&lt;br/&gt; the Event System, so it should be fixed.&lt;br/&gt; The simple solution, implemented in this patch, is to store the previous&lt;br/&gt; state of authorization check&lt;br/&gt; before changing it, and to restore it at the end of the &quot;special&quot; block.&lt;br/&gt; This patch:&lt;br/&gt; 1) add two methods: TurnOffAuthorizationSystem /&lt;br/&gt; RestoreAuthorizationSystem, with some code that can also be useful when the&lt;br/&gt; debug is on to see &quot;malformed&quot; (XML-like) authorization blocks (thanks to&lt;br/&gt; James Rutherford for some useful suggestions);&lt;br/&gt; 2) set the setIgnoreAuthoritation methods to deprecated.&lt;br/&gt; 3) refactor any call to setIgnoreAuthorization in dspace code to use the&lt;br/&gt; new methods&lt;/p&gt;</DESCRIPTION>
  <REPONAME>DSpace</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merged in task/glam7/GLAM-982 (pull request #3454) [GLAM-982] Approved-by: Giuseppe Digilio</MESSAGE>
    <SHA>cf965a2e684973e09db1c3315102b2bf44c777a9</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Merged in task/glam7/GLAM-1012 (pull request #3461) [GLAM-1012] update public metadata Approved-by: Giuseppe Digilio</MESSAGE>
      <SHA>d17c30804b9b5311a0b283f9ce37f76097b4a9ea</SHA>
      <PATCHEDFILES>
        <FILE>dspace/config/modules/public-metadata.cfg</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
