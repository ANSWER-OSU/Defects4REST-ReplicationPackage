<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>1169</ISSUENO>
  <ISSUEURL>https://github.com/flowable/flowable-engine/issues/1169</ISSUEURL>
  <TITLE>setTaskIdGenerator(new DbIdGenerator()) with H2 causes NPE</TITLE>
  <DESCRIPTION>HI, I was trying to set id generator for engine configuration as suggested in Upgrade notes in [6.3.1 blog post](https://blog.flowable.org/2018/05/22/flowable-6-3-1-release/), but code mentioned there doesn't set the generator for task ids. When I tried to set it like this: ```java @Bean public EngineConfigurationConfigurer&lt;SpringProcessEngineConfiguration&gt; processEngineDbIdGeneratorConfigurer() { return engineConfiguration -&gt; engineConfiguration .setTaskIdGenerator(new DbIdGenerator()); } ``` and with H2 being used as db it throws NPE: ``` 2018-07-04T08:04:36.763Z ERROR org.apache.catalina.core.ContainerBase.[Tomcat].[localhost].[/].[dispatcherServlet] [traceId:,parentId:,spanId:] - Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception [Request processing failed; nested exception is java.lang.NullPointerException] with root cause java.lang.NullPointerException: null at org.flowable.engine.impl.db.DbIdGenerator.getNewBlock(DbIdGenerator.java:44) ~[flowable-engine-6.3.1.jar:6.3.1] at org.flowable.engine.impl.db.DbIdGenerator.getNextId(DbIdGenerator.java:37) ~[flowable-engine-6.3.1.jar:6.3.1] at org.flowable.task.service.impl.persistence.entity.TaskEntityManagerImpl.insert(TaskEntityManagerImpl.java:207) ~[flowable-task-service-6.3.1.jar:6.3.1] at org.flowable.task.service.impl.persistence.entity.TaskEntityManagerImpl.insert(TaskEntityManagerImpl.java:38) ~[flowable-task-service-6.3.1.jar:6.3.1] at org.flowable.task.service.impl.TaskServiceImpl.insertTask(TaskServiceImpl.java:98) ~[flowable-task-service-6.3.1.jar:6.3.1] at org.flowable.engine.impl.util.TaskHelper.insertTask(TaskHelper.java:174) ~[flowable-engine-6.3.1.jar:6.3.1] at org.flowable.engine.impl.util.TaskHelper.insertTask(TaskHelper.java:149) ~[flowable-engine-6.3.1.jar:6.3.1] at org.flowable.engine.impl.bpmn.behavior.UserTaskActivityBehavior.execute(UserTaskActivityBehavior.java:220) ~[flowable-engine-6.3.1.jar:6.3.1] at org.flowable.engine.impl.agenda.ContinueProcessOperation.executeActivityBehavior(ContinueProcessOperation.java:258) ~[flowable-engine-6.3.1.jar:6.3.1] at org.flowable.engine.impl.agenda.ContinueProcessOperation.executeSynchronous(ContinueProcessOperation.java:155) ~[flowable-engine-6.3.1.jar:6.3.1] at org.flowable.engine.impl.agenda.ContinueProcessOperation.continueThroughFlowNode(ContinueProcessOperation.java:112) ~[flowable-engine-6.3.1.jar:6.3.1] at org.flowable.engine.impl.agenda.ContinueProcessOperation.continueThroughSequenceFlow(ContinueProcessOperation.java:305) ~[flowable-engine-6.3.1.jar:6.3.1] at org.flowable.engine.impl.agenda.ContinueProcessOperation.run(ContinueProcessOperation.java:78) ~[flowable-engine-6.3.1.jar:6.3.1] at org.flowable.engine.impl.interceptor.CommandInvoker.executeOperation(CommandInvoker.java:88) ~[flowable-engine-6.3.1.jar:6.3.1] at org.flowable.engine.impl.interceptor.CommandInvoker.executeOperations(CommandInvoker.java:72) ~[flowable-engine-6.3.1.jar:6.3.1] at org.flowable.engine.impl.interceptor.CommandInvoker.execute(CommandInvoker.java:56) ~[flowable-engine-6.3.1.jar:6.3.1] at org.flowable.engine.impl.interceptor.BpmnOverrideContextInterceptor.execute(BpmnOverrideContextInterceptor.java:25) ~[flowable-engine-6.3.1.jar:6.3.1] at org.flowable.common.engine.impl.interceptor.TransactionContextInterceptor.execute(TransactionContextInterceptor.java:53) ~[flowable-engine-common-6.3.1.jar:6.3.1] at org.flowable.common.engine.impl.interceptor.CommandContextInterceptor.execute(CommandContextInterceptor.java:71) ~[flowable-engine-common-6.3.1.jar:6.3.1] at org.flowable.idm.spring.SpringTransactionInterceptor$1.doInTransaction(SpringTransactionInterceptor.java:49) ~[flowable-idm-spring-6.3.1.jar:6.3.1] at org.springframework.transaction.support.TransactionTemplate.execute(TransactionTemplate.java:140) ~[spring-tx-5.0.6.RELEASE.jar:5.0.6.RELEASE] at org.flowable.idm.spring.SpringTransactionInterceptor.execute(SpringTransactionInterceptor.java:46) ~[flowable-idm-spring-6.3.1.jar:6.3.1] at org.flowable.common.engine.impl.interceptor.LogInterceptor.execute(LogInterceptor.java:30) ~[flowable-engine-common-6.3.1.jar:6.3.1] at org.flowable.common.engine.impl.cfg.CommandExecutorImpl.execute(CommandExecutorImpl.java:56) ~[flowable-engine-common-6.3.1.jar:6.3.1] at org.flowable.common.engine.impl.cfg.CommandExecutorImpl.execute(CommandExecutorImpl.java:51) ~[flowable-engine-common-6.3.1.jar:6.3.1] at org.flowable.engine.impl.RuntimeServiceImpl.startProcessInstanceByKey(RuntimeServiceImpl.java:105) ~[flowable-engine-6.3.1.jar:6.3.1] ... ```</DESCRIPTION>
  <REPONAME>flowable-engine</REPONAME>
  <TIMEDIFFERENCEDAYS>5</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>When I use StrongUuidGenerator to generate uuid,orderByDeploymentId() may be wrong. (#1173) You use orderByDeploymenTime() in [if] at line 83,but use orderByDeploymentId() in [else] at line 91.</MESSAGE>
    <SHA>42d3e68903db708d79744882368492f358fd730f</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>#1169 task id generator (#1175) * #1067(fix): taskId generator configuration based on he target engine configuration * #1067(test): test context clean up fix</MESSAGE>
      <SHA>170804e7eb4df86dd90870aa4e05670a9500092b</SHA>
      <PATCHEDFILES>
        <FILE>modules/flowable-cmmn-engine-configurator/src/main/java/org/flowable/cmmn/engine/configurator/CmmnEngineConfigurator.java</FILE>
        <FILE>modules/flowable-engine-configurator/src/main/java/org/flowable/engine/configurator/ProcessEngineConfigurator.java</FILE>
        <FILE>modules/flowable-spring-boot/flowable-spring-boot-starters/flowable-spring-boot-autoconfigure/src/test/java/org/flowable/test/spring/boot/app/AppEngineAutoConfigurationTest.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
