<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>2236</ISSUENO>
  <ISSUEURL>https://github.com/flowable/flowable-engine/issues/2236</ISSUEURL>
  <TITLE>JsonType: Switching variable from 'large' to 'small' json does not work</TITLE>
  <DESCRIPTION>When setting the value of a 'small' json variable (saved internally in the text column) to a 'large' value (saved as a 'byte array' internally), the text value does not get deleted. The JsonType variable type returns the 'small' value on the next call instead of the current value. It should be possible to change the payload size of a json variable.</DESCRIPTION>
  <REPONAME>flowable-engine</REPONAME>
  <TIMEDIFFERENCEDAYS>1</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Add Flowable 5 tests GitHub Workflow</MESSAGE>
    <SHA>0f5075618b69e5d366ce6ced7a89f7d9dae8058d</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fix issue when switching from small to large json values (#2236)</MESSAGE>
      <SHA>0b4a4babbefa7c664341aab8290ba7a5bfc2e758</SHA>
      <PATCHEDFILES>
        <FILE>modules/flowable-engine/src/test/java/org/flowable/engine/test/json/JsonTest.java</FILE>
        <FILE>modules/flowable-variable-service/src/main/java/org/flowable/variable/service/impl/types/JsonType.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fix issue when switching from small to large json values (#2236)</MESSAGE>
      <SHA>7e3ccf3b20e87310c37a3f01301d7d7175b30564</SHA>
      <PATCHEDFILES>
        <FILE>modules/flowable-engine/src/test/java/org/flowable/engine/test/json/JsonTest.java</FILE>
        <FILE>modules/flowable-variable-service/src/main/java/org/flowable/variable/service/impl/types/JsonType.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Make sure that VariableByteArrayRef is deleted when no bytes are set on it fixes #2236</MESSAGE>
      <SHA>c0dc36e8fdbcb9e0b21ac027ff3ebf0c5b51093c</SHA>
      <PATCHEDFILES>
        <FILE>modules/flowable-engine/src/test/java/org/flowable/engine/test/json/JsonTest.java</FILE>
        <FILE>modules/flowable-variable-service/src/main/java/org/flowable/variable/service/impl/persistence/VariableByteArrayRefTypeHandler.java</FILE>
        <FILE>modules/flowable-variable-service/src/main/java/org/flowable/variable/service/impl/persistence/entity/VariableByteArrayRef.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fix issue when switching from small to large json values (#2236)</MESSAGE>
      <SHA>db53b45427b2e59f83fe638fe195a9d5f4261ebe</SHA>
      <PATCHEDFILES>
        <FILE>modules/flowable-engine/src/test/java/org/flowable/engine/test/json/JsonTest.java</FILE>
        <FILE>modules/flowable-variable-service/src/main/java/org/flowable/variable/service/impl/types/JsonType.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Make sure that VariableByteArrayRef is deleted when no bytes are set on it fixes #2236</MESSAGE>
      <SHA>1ed50de922606f040e0e51eb56367e90e4c04a57</SHA>
      <PATCHEDFILES>
        <FILE>modules/flowable-engine/src/test/java/org/flowable/engine/test/json/JsonTest.java</FILE>
        <FILE>modules/flowable-variable-service/src/main/java/org/flowable/variable/service/impl/persistence/VariableByteArrayRefTypeHandler.java</FILE>
        <FILE>modules/flowable-variable-service/src/main/java/org/flowable/variable/service/impl/persistence/entity/VariableByteArrayRef.java</FILE>
        <FILE>modules/flowable-variable-service/src/main/resources/org/flowable/variable/service/db/mapping/entity/HistoricVariableInstance.xml</FILE>
        <FILE>modules/flowable-variable-service/src/main/resources/org/flowable/variable/service/db/mapping/entity/VariableInstance.xml</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Make sure that VariableByteArrayRef is deleted when no bytes are set on it fixes #2236</MESSAGE>
      <SHA>ecb368a55d2678f74fc7a315c6bf6588329c9f5c</SHA>
      <PATCHEDFILES>
        <FILE>modules/flowable-engine/src/test/java/org/flowable/engine/test/api/variables/SerializableVariableTest.java</FILE>
        <FILE>modules/flowable-engine/src/test/java/org/flowable/engine/test/json/JsonTest.java</FILE>
        <FILE>modules/flowable-variable-service/src/main/java/org/flowable/variable/service/impl/persistence/VariableByteArrayRefTypeHandler.java</FILE>
        <FILE>modules/flowable-variable-service/src/main/java/org/flowable/variable/service/impl/persistence/entity/VariableByteArrayRef.java</FILE>
        <FILE>modules/flowable-variable-service/src/main/resources/org/flowable/variable/service/db/mapping/entity/HistoricVariableInstance.xml</FILE>
        <FILE>modules/flowable-variable-service/src/main/resources/org/flowable/variable/service/db/mapping/entity/VariableInstance.xml</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
