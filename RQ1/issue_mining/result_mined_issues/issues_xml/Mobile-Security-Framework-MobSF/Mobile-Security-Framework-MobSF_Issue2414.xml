<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>2414</ISSUENO>
  <ISSUEURL>https://github.com/MobSF/Mobile-Security-Framework-MobSF/issues/2414</ISSUEURL>
  <TITLE>Incorect regexp rule for SharedPreference being world writable</TITLE>
  <DESCRIPTION>OS and Version: windows, running under docker, after running docker I see: OS Environment: Linux (ubuntu 22.04 Jammy Jellyfish) Linux-5.15.146.1-microsoft-standard-WSL2-x86_64-with-glibc2.35 Python Version: as in official docker image MobSF Version: v4.0.3 In my apk I get red entry for: The file or SharedPreference is World Writable. Any App can write to the file then the explanation: CWE: CWE-276: Incorrect Default Permissions OWASP Top 10: M2: Insecure Data Storage OWASP MASVS: MSTG-STORAGE-2 and code (its external huawei library) com/huawei/agconnect/datastore/core/AndroidSharedPrefUtil.java this is a relevant part of this file: public static void remove(String str, String str2) { Context context2 = context; if (context2 == null) { Log.e(TAG, &quot;context is `null`, please call ` AGConnectInstance.initialize()` first&quot;); } else { context2.getSharedPreferences(str, 0).edit().remove(str2).commit(); //&lt;&lt;highlited line&gt;&gt; } } The comment above is added by me to explain where the highlite is located. The problem is I dont see where it is that its world writable? In this line context2.getSharedPreferences(str, 0) usage mode is 0, and 0 is actually private It looks like https://developer.android.com/reference/android/content/Context#MODE_PRIVATE is used. the two which might indicate insecure usage would be 1 and 2: https://developer.android.com/reference/android/content/Context#MODE_WORLD_READABLE https://developer.android.com/reference/android/content/Context#MODE_WORLD_WRITEABLE I am not sure if huawei is using this AndroidSharedPrefUtil anywhere - but it probably does use is as proguard had not removed it. According to documentation, such insecure use would cause SecurityException to be thrown on android &gt;= 24, which I dont see. I checked the rules in: /mobsf/StaticAnalyzer/views/android/rules/android_rules.yaml and for: - id: android_world_writable regexp is: - \.getSharedPreferences\(.{0,50}2\) and if I paste to https://regex101.com/, this line: context2.getSharedPreferences(str, 0).edit().remove(str2).commit(); (with whitespaces) then above regexp matches this part: .getSharedPreferences(str, 0).edit().remove(str2) the 2 is taken from str2, so the regexp is wrong. A solution would be to use: \.getSharedPreferences\(.{0,50}?, 2\)</DESCRIPTION>
  <REPONAME>Mobile-Security-Framework-MobSF</REPONAME>
  <TIMEDIFFERENCEDAYS>10</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>[HOTFIX] AppSec PNW 2024, Deeplink Trigger Support for Android Dynamic Analyzer (#2402) * iOS Dynamic Analyzer String Compare Frida script improvement * Android Dynamic Analyzer Deeplink UI trigger support * Android &amp; iOS Dynamic Analyzer UI Improvements * Android &amp; iOS Dynamic Analyzer Bug fixes</MESSAGE>
    <SHA>a9de0335d44767b0c7c48bcff3a9f1d9f5d31c20</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fixes #2414</MESSAGE>
      <SHA>ef7171de91501642676cc3f6b548c846fe515c47</SHA>
      <PATCHEDFILES>
        <FILE>mobsf/StaticAnalyzer/views/android/rules/android_rules.yaml</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>[EFR][HOTFIX] Realtime Scan status and logs (#2416) * Realtime Scan Status in UI and PDF reports * Scan Status REST API &amp; tests * Fixes #2414 * Address #2413 * Code QA * Dependency and version bump</MESSAGE>
      <SHA>5b7c5c00751da45282a9a39ad65c86beadf73b18</SHA>
      <PATCHEDFILES>
        <FILE>mobsf/DynamicAnalyzer/views/android/analysis.py</FILE>
        <FILE>mobsf/DynamicAnalyzer/views/android/dynamic_analyzer.py</FILE>
        <FILE>mobsf/DynamicAnalyzer/views/android/report.py</FILE>
        <FILE>mobsf/DynamicAnalyzer/views/common/shared.py</FILE>
        <FILE>mobsf/DynamicAnalyzer/views/ios/analysis.py</FILE>
        <FILE>mobsf/DynamicAnalyzer/views/ios/report.py</FILE>
        <FILE>mobsf/MalwareAnalyzer/views/MalwareDomainCheck.py</FILE>
        <FILE>mobsf/MalwareAnalyzer/views/Trackers.py</FILE>
        <FILE>mobsf/MalwareAnalyzer/views/VirusTotal.py</FILE>
        <FILE>mobsf/MalwareAnalyzer/views/android/apkid.py</FILE>
        <FILE>mobsf/MalwareAnalyzer/views/android/permissions.py</FILE>
        <FILE>mobsf/MalwareAnalyzer/views/android/quark.py</FILE>
        <FILE>mobsf/MobSF/init.py</FILE>
        <FILE>mobsf/MobSF/security.py</FILE>
        <FILE>mobsf/MobSF/urls.py</FILE>
        <FILE>mobsf/MobSF/utils.py</FILE>
        <FILE>mobsf/MobSF/views/api/api_static_analysis.py</FILE>
        <FILE>mobsf/MobSF/views/authorization.py</FILE>
        <FILE>mobsf/MobSF/views/home.py</FILE>
        <FILE>mobsf/MobSF/views/scanning.py</FILE>
        <FILE>mobsf/StaticAnalyzer/models.py</FILE>
        <FILE>mobsf/StaticAnalyzer/tests.py</FILE>
        <FILE>mobsf/StaticAnalyzer/views/android/app.py</FILE>
        <FILE>mobsf/StaticAnalyzer/views/android/cert_analysis.py</FILE>
        <FILE>mobsf/StaticAnalyzer/views/android/code_analysis.py</FILE>
        <FILE>mobsf/StaticAnalyzer/views/android/converter.py</FILE>
        <FILE>mobsf/StaticAnalyzer/views/android/db_interaction.py</FILE>
        <FILE>mobsf/StaticAnalyzer/views/android/icon_analysis.py</FILE>
        <FILE>mobsf/StaticAnalyzer/views/android/jar_aar.py</FILE>
        <FILE>mobsf/StaticAnalyzer/views/android/kb/android_manifest_desc.py</FILE>
        <FILE>mobsf/StaticAnalyzer/views/android/kb/dvm_permissions.py</FILE>
        <FILE>mobsf/StaticAnalyzer/views/android/manifest_analysis.py</FILE>
        <FILE>mobsf/StaticAnalyzer/views/android/manifest_utils.py</FILE>
        <FILE>mobsf/StaticAnalyzer/views/android/network_security.py</FILE>
        <FILE>mobsf/StaticAnalyzer/views/android/playstore.py</FILE>
        <FILE>mobsf/StaticAnalyzer/views/android/rules/android_rules.yaml</FILE>
        <FILE>mobsf/StaticAnalyzer/views/android/so.py</FILE>
        <FILE>mobsf/StaticAnalyzer/views/android/static_analyzer.py</FILE>
        <FILE>mobsf/StaticAnalyzer/views/android/strings.py</FILE>
        <FILE>mobsf/StaticAnalyzer/views/android/views/find.py</FILE>
        <FILE>mobsf/StaticAnalyzer/views/android/views/manifest_view.py</FILE>
        <FILE>mobsf/StaticAnalyzer/views/android/views/source_tree.py</FILE>
        <FILE>mobsf/StaticAnalyzer/views/android/views/view_source.py</FILE>
        <FILE>mobsf/StaticAnalyzer/views/android/xapk.py</FILE>
        <FILE>mobsf/StaticAnalyzer/views/common/a.py</FILE>
        <FILE>mobsf/StaticAnalyzer/views/common/binary/lib_analysis.py</FILE>
        <FILE>mobsf/StaticAnalyzer/views/common/pdf.py</FILE>
        <FILE>mobsf/StaticAnalyzer/views/common/shared_func.py</FILE>
        <FILE>mobsf/StaticAnalyzer/views/ios/app_transport_security.py</FILE>
        <FILE>mobsf/StaticAnalyzer/views/ios/appstore.py</FILE>
        <FILE>mobsf/StaticAnalyzer/views/ios/binary_analysis.py</FILE>
        <FILE>mobsf/StaticAnalyzer/views/ios/binary_rule_matcher.py</FILE>
        <FILE>mobsf/StaticAnalyzer/views/ios/classdump.py</FILE>
        <FILE>mobsf/StaticAnalyzer/views/ios/code_analysis.py</FILE>
        <FILE>mobsf/StaticAnalyzer/views/ios/db_interaction.py</FILE>
        <FILE>mobsf/StaticAnalyzer/views/ios/dylib.py</FILE>
        <FILE>mobsf/StaticAnalyzer/views/ios/file_analysis.py</FILE>
        <FILE>mobsf/StaticAnalyzer/views/ios/icon_analysis.py</FILE>
        <FILE>mobsf/StaticAnalyzer/views/ios/kb/permission_analysis.py</FILE>
        <FILE>mobsf/StaticAnalyzer/views/ios/plist_analysis.py</FILE>
        <FILE>mobsf/StaticAnalyzer/views/ios/static_analyzer.py</FILE>
        <FILE>mobsf/StaticAnalyzer/views/ios/strings.py</FILE>
        <FILE>mobsf/StaticAnalyzer/views/ios/views/view_source.py</FILE>
        <FILE>mobsf/StaticAnalyzer/views/sast_engine.py</FILE>
        <FILE>mobsf/StaticAnalyzer/views/windows/db_interaction.py</FILE>
        <FILE>mobsf/StaticAnalyzer/views/windows/windows.py</FILE>
        <FILE>mobsf/templates/base/base_layout.html</FILE>
        <FILE>mobsf/templates/general/apidocs.html</FILE>
        <FILE>mobsf/templates/general/home.html</FILE>
        <FILE>mobsf/templates/pdf/android_report.html</FILE>
        <FILE>mobsf/templates/pdf/ios_report.html</FILE>
        <FILE>mobsf/templates/pdf/windows_report.html</FILE>
        <FILE>mobsf/templates/static_analysis/android_binary_analysis.html</FILE>
        <FILE>mobsf/templates/static_analysis/android_source_analysis.html</FILE>
        <FILE>mobsf/templates/static_analysis/ios_binary_analysis.html</FILE>
        <FILE>mobsf/templates/static_analysis/ios_source_analysis.html</FILE>
        <FILE>mobsf/templates/static_analysis/windows_binary_analysis.html</FILE>
        <FILE>poetry.lock</FILE>
        <FILE>pyproject.toml</FILE>
        <FILE>scripts/update_android_permissions.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
