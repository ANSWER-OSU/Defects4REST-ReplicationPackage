<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>2432</ISSUENO>
  <ISSUEURL>https://github.com/MobSF/Mobile-Security-Framework-MobSF/issues/2432</ISSUEURL>
  <TITLE>Frida API Monitor API is responding ERROR message for OK response</TITLE>
  <DESCRIPTION>&lt;!-- ## IMPORTANT --&gt; &lt;!-- Issues are ONLY for reporting BUGS. For support, feature requests, questions, queries, and discussions use our slack channel for limited support. Join MobSF Slack channel: https://join.slack.com/t/mobsf/shared_invite/zt-2huaz2nj9-ifViLV7g7w1xthx5D6rGhw --&gt; &lt;!-- If you see errors while running setup/run scripts, it is mostly because you haven't installed the required dependencies correctly. You will have to look into the errors and figure out what is causing them and solve them accordingly. Make sure you have installed all the required dependencies and their correct versions as per the latest documentation. If you still find yourself at a dead end, join MobSF Slack channel:https://join.slack.com/t/mobsf/shared_invite/zt-2huaz2nj9-ifViLV7g7w1xthx5D6rGhw Please do not post support/help request in GitHub issues, doing so will definitely waste our time get them closed without further response. --&gt; ## ENVIRONMENT ``` OS and Version: Ubuntu 20.04 Python Version: 3.11.9 MobSF Version: v4.0.7 ``` ## EXPLANATION OF THE ISSUE I write a method to start Frida Instrumentation ``` def start_Frida_instrument(host_url, api_key, file_hash, default_hooks='api_monitor,ssl_pinning_bypass,root_bypass,debugger_check_bypass', auxiliary_hooks='', frida_code=''): &quot;&quot;&quot; Start Frida to monitor API at runtime. @param host_url: @param api_key: @param file_hash: @return: &quot;&quot;&quot; print(&quot;Starting Frida API instrument...&quot;) api_url = host_url + &quot;/api/v1/frida/instrument&quot; headers = { &quot;Authorization&quot;: api_key } data = { &quot;hash&quot;: file_hash, &quot;default_hooks&quot;: default_hooks, &quot;auxiliary_hooks&quot;: auxiliary_hooks, &quot;frida_code&quot;: frida_code } try: response = requests.post(api_url, headers=headers, data=data) if response.status_code == 200: return response.json() else: return {&quot;error&quot;: response.json(), &quot;status_code&quot;: response.status_code} except Exception as e: return {&quot;error&quot;: str(e)} ``` However, when I execute this method, the response is **{'message': 'Failed to instrument app', 'status': 'ok'}**. Other methods I use are as follows: ``` def upload_file(host_url, api_key, file_path): &quot;&quot;&quot; Upload apk file to the server @param host_url: ip:port of the server @param api_key: API key of MobSF @param file_path: file path of the apk @return: &quot;&quot;&quot; print(&quot;Uploading file&quot;) multipart_data = MultipartEncoder(fields={'file': (file_path, open(file_path, 'rb'), 'application/octet-stream')}) headers = {'Content-Type': multipart_data.content_type, 'Authorization': api_key} response = requests.post(host_url + '/api/v1/upload', data=multipart_data, headers=headers) return response.text def scan_file(host_url, api_key, file_hash): print(&quot;Starting static scan...&quot;) api_url = f&quot;{host_url}/api/v1/scan&quot; headers = { &quot;Authorization&quot;: api_key, } data = { &quot;hash&quot;: file_hash, } try: response = requests.post(api_url, headers=headers, data=data) if response.status_code == 200: return response.json() else: return {&quot;error&quot;: response.text, &quot;status_code&quot;: response.status_code} except Exception as e: return {&quot;error&quot;: str(e)} def start_dynamic_analysis(host_url, api_key, file_hash, re_install=1, install=1): &quot;&quot;&quot; Start dynamic analysis. @param host_url: @param api_key: @param file_hash: @param re_install: @param install: @return: &quot;&quot;&quot; print(&quot;Starting dynamic analysis. Probably several minutes...&quot;) api_url = host_url + &quot;/api/v1/dynamic/start_analysis&quot; headers = { &quot;Authorization&quot;: api_key } data = { &quot;hash&quot;: file_hash, &quot;re_install&quot;: re_install, &quot;install&quot;: install } try: response = requests.post(api_url, headers=headers, data=data) if response.status_code == 200: return response.json() else: print({&quot;error&quot;: response.json(), &quot;status_code&quot;: response.status_code}) return None except Exception as e: return None ``` &lt;!-- If you see errors while running setup/run scripts, join MobSF Slack channel: https://join.slack.com/t/mobsf/shared_invite/zt-2huaz2nj9-ifViLV7g7w1xthx5D6rGhw to get limited support. --&gt; ## STEPS TO REPRODUCE THE ISSUE ``` 1. Upload an APK file via api. 2. Scan the APK and get the hash. 3. Start dynamic analysis via api. 4. Run the start_Frida_instrument method. ``` ## LOG FILE The info log is as follows: ``` [INFO] 10/Oct/2024 00:38:07 - Test Completed. Resuming HTTPS Proxy [INFO] 10/Oct/2024 00:38:07 - Installing MobSF RootCA [INFO] 10/Oct/2024 00:38:07 - Starting HTTPS Proxy on 1337 [INFO] 10/Oct/2024 00:38:07 - Starting Instrumentation [INFO] 10/Oct/2024 00:38:07 - Frida Server is already running [INFO] 10/Oct/2024 00:38:07 - Spawning com.FootballStadiumDesign.lukoni [ERROR] 10/Oct/2024 00:38:08 - Internal Server Error: /api/v1/frida/api_monitor [DEBUG] 10/Oct/2024 00:38:11 - [Frida] Loaded Frida Script - debugger_check_bypass [DEBUG] 10/Oct/2024 00:38:11 - [Frida] Loaded Frida Script - root_bypass [DEBUG] 10/Oct/2024 00:38:11 - [Frida] Loaded Frida Script - ssl_pinning_bypass [DEBUG] 10/Oct/2024 00:38:11 - [Frida] Loaded Frida Script - api_monitor [DEBUG] 10/Oct/2024 00:38:11 - [Frida] [SSL Pinning Bypass] okhttp CertificatePinner not found [DEBUG] 10/Oct/2024 00:38:11 - [Frida] [SSL Pinning Bypass] okhttp3 CertificatePinner not found [DEBUG] 10/Oct/2024 00:38:11 - [Frida] [SSL Pinning Bypass] DataTheorem trustkit not found [DEBUG] 10/Oct/2024 00:38:11 - [Frida] [SSL Pinning Bypass] Appcelerator PinningTrustManager not found [DEBUG] 10/Oct/2024 00:38:11 - [Frida] [SSL Pinning Bypass] Apache Cordova SSLCertificateChecker not found [DEBUG] 10/Oct/2024 00:38:11 - [Frida] [SSL Pinning Bypass] Wultra CertStore.validateFingerprint not found [DEBUG] 10/Oct/2024 00:38:11 - [Frida] [SSL Pinning Bypass] Xutils not found [DEBUG] 10/Oct/2024 00:38:11 - [Frida] [SSL Pinning Bypass] httpclientandroidlib not found [DEBUG] 10/Oct/2024 00:38:11 - [Frida] [SSL Pinning Bypass] Cronet not found [DEBUG] 10/Oct/2024 00:38:11 - [Frida] [SSL Pinning Bypass] certificatetransparency.CTInterceptorBuilder not found [DEBUG] 10/Oct/2024 00:38:11 - [Frida] [API Monitor] Cannot find org.apache.http.impl.client.AbstractHttpClient.execute [DEBUG] 10/Oct/2024 00:38:11 - [Frida] [API Monitor] Cannot find com.android.okhttp.internal.http.HttpURLConnectionImpl.getInputStream ``` &lt;!-- BEFORE POSTING YOUR ISSUE/BUG - These comments won't show up when you submit the issue. - GitHub issues ARE NOT FOR FEATURE REQUESTS, SUPPORT, DISCUSSIONS AND QUESTIONS! - If you have questions, use our slack channel. Join MobSF Slack channel: https://bit.ly/3mCMNOx - Reproduce issue in the latest master and try to add as much detail as possible. - Search this repository (top of the page) for the issue and it has not been fixed or reported already. - Once you open a bug, you should also provide additional information if requested. - Failure to do so in 25 days will result in closure of the bug without further communication. --&gt;</DESCRIPTION>
  <REPONAME>Mobile-Security-Framework-MobSF</REPONAME>
  <TIMEDIFFERENCEDAYS>18</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>[HOTFIX] dep bups + Fix #2424</MESSAGE>
    <SHA>fec37069f36a34bfdcb845f34a40452173d72298</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>[HOTFIX] Dockerfile and dependency upgrade, Bug Fixes (#2439) * Dockerfile: migrate from Ubuntu to Debian Bookworm * Update and MachO and ELF Analysis * Update docker compose with postgres * JDK bump to 22.0.2 * Python bump to 3.12 * Bump jadx, apktool, vd2svg, bundletool * Remove jadx from repo and download it dynamically during setup * Install jadx during docker build * Replace deprecated dependencies * Bump httptools * Postgres Support by default * Bump LIEF to latest, reintroduce PIE checks for ELF * Fixes #2430 #2432 #2395 * Bug Fixes</MESSAGE>
      <SHA>9b2a3c855260d01cfe1f6735c06838ee5dc8c001</SHA>
      <PATCHEDFILES>
        <FILE>.github/workflows/mobsf-test.yml</FILE>
        <FILE>.github/workflows/python-publish.yml</FILE>
        <FILE>Dockerfile</FILE>
        <FILE>README.md</FILE>
        <FILE>docker-compose.yml</FILE>
        <FILE>mobsf/DynamicAnalyzer/tools/webproxy.py</FILE>
        <FILE>mobsf/DynamicAnalyzer/views/android/analysis.py</FILE>
        <FILE>mobsf/DynamicAnalyzer/views/android/tests_frida.py</FILE>
        <FILE>mobsf/MobSF/init.py</FILE>
        <FILE>mobsf/MobSF/security.py</FILE>
        <FILE>mobsf/MobSF/settings.py</FILE>
        <FILE>mobsf/MobSF/tools_download.py</FILE>
        <FILE>mobsf/MobSF/utils.py</FILE>
        <FILE>mobsf/MobSF/views/authentication.py</FILE>
        <FILE>mobsf/MobSF/views/home.py</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/apktool_2.10.0.jar</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/bundletool-all-1.17.2.jar</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/LICENSE</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/NOTICE</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/README.md</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/bin/jadx</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/bin/jadx-gui</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/bin/jadx-gui.bat</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/bin/jadx.bat</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/lib/ST4-4.0.8.jar</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/lib/aapt2-proto-7.3.1-8691043.jar</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/lib/activation-1.1.jar</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/lib/antlr-2.7.7.jar</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/lib/antlr-3.5.2.jar</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/lib/antlr-runtime-3.5.2.jar</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/lib/apksig-7.3.1.jar</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/lib/asm-9.4.jar</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/lib/baksmali-2.5.2.jar</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/lib/checker-qual-3.8.0.jar</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/lib/commons-lang3-3.12.0.jar</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/lib/commons-text-1.10.0.jar</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/lib/dalvik-dx-11.0.0_r3.jar</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/lib/dexlib2-2.5.2.jar</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/lib/error_prone_annotations-2.5.1.jar</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/lib/failureaccess-1.0.1.jar</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/lib/flatlaf-2.6.jar</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/lib/flatlaf-extras-2.6.jar</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/lib/flatlaf-intellij-themes-2.6.jar</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/lib/gson-2.9.1.jar</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/lib/guava-30.1.1-jre.jar</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/lib/image-viewer-1.2.3.jar</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/lib/j2objc-annotations-1.3.jar</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/lib/jadx-cli-1.4.5.jar</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/lib/jadx-core-1.4.5.jar</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/lib/jadx-dex-input-1.4.5.jar</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/lib/jadx-gui-1.4.5.jar</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/lib/jadx-java-convert-1.4.5.jar</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/lib/jadx-java-input-1.4.5.jar</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/lib/jadx-plugins-api-1.4.5.jar</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/lib/jadx-smali-input-1.4.5.jar</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/lib/javax.mail-1.6.2.jar</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/lib/jcommander-1.82.jar</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/lib/jdwp-2.0.0.jar</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/lib/jfontchooser-1.0.5.jar</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/lib/jsr305-3.0.2.jar</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/lib/listenablefuture-9999.0-empty-to-avoid-conflict-with-guava.jar</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/lib/logback-classic-1.3.4.jar</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/lib/logback-core-1.3.4.jar</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/lib/mapping-io-0.4.0-SNAPSHOT.jar</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/lib/protobuf-java-3.21.8.jar</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/lib/r8-3.3.75.jar</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/lib/raung-common-0.0.2.jar</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/lib/raung-disasm-0.0.2.jar</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/lib/reactive-streams-1.0.3.jar</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/lib/rsyntaxtextarea-3.3.0.jar</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/lib/rxjava-2.2.21.jar</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/lib/rxjava2-swing-0.3.7.jar</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/lib/slf4j-api-2.0.3.jar</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/lib/smali-2.5.2.jar</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/lib/stringtemplate-3.2.1.jar</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/lib/svgSalamander-1.1.4.jar</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/jadx/lib/util-2.5.2.jar</FILE>
        <FILE>mobsf/StaticAnalyzer/tools/vd2svg-0.4.4.jar</FILE>
        <FILE>mobsf/StaticAnalyzer/views/android/converter.py</FILE>
        <FILE>mobsf/StaticAnalyzer/views/android/icon_analysis.py</FILE>
        <FILE>mobsf/StaticAnalyzer/views/android/jar_aar.py</FILE>
        <FILE>mobsf/StaticAnalyzer/views/android/manifest_utils.py</FILE>
        <FILE>mobsf/StaticAnalyzer/views/android/static_analyzer.py</FILE>
        <FILE>mobsf/StaticAnalyzer/views/android/xapk.py</FILE>
        <FILE>mobsf/StaticAnalyzer/views/common/binary/elf.py</FILE>
        <FILE>mobsf/StaticAnalyzer/views/common/binary/macho.py</FILE>
        <FILE>mobsf/templates/pdf/android_report.html</FILE>
        <FILE>mobsf/templates/static_analysis/android_binary_analysis.html</FILE>
        <FILE>poetry.lock</FILE>
        <FILE>pyproject.toml</FILE>
        <FILE>scripts/clean.bat</FILE>
        <FILE>scripts/dependencies.sh</FILE>
        <FILE>scripts/postgres_support.sh</FILE>
        <FILE>setup.bat</FILE>
        <FILE>setup.sh</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
