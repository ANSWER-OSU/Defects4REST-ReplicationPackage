<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>512</ISSUENO>
  <ISSUEURL>https://github.com/k8ssandra/management-api-for-apache-cassandra/issues/512</ISSUEURL>
  <TITLE>Dubious metric names in Prometheus</TITLE>
  <DESCRIPTION>While inspecting Cassandra related metrics in our Prometheus server, I noticed that some metrics were badly re-labelled from the Cassandra model to the Prometheus model leading to numerous Prometheus metric . For example: * org_apache_cassandra_metrics_connection_large_message_dropped_tasks_201_24_56_224_7000 * org_apache_cassandra_metrics_connection_large_message_dropped_tasks_201_24_110_239_7000 I'm using the new metric endpoint without any additional configuration. Impacted metrics are the following (I stripped the port, ip address, etc. to obtain expected metric name): ``` io_cassandrareaper_management_ICassandraManagementProxy_connections io_cassandrareaper_management_jmx_JmxCassandraManagementProxy_cpicassandracluster_repairStatusHandlers io_cassandrareaper_service_SegmentRunner_abort org_apache_cassandra_metrics_connection_gossip_message_completed_tasks org_apache_cassandra_metrics_connection_gossip_message_dropped_tasks org_apache_cassandra_metrics_connection_gossip_message_pending_tasks org_apache_cassandra_metrics_connection_large_message_completed_bytes org_apache_cassandra_metrics_connection_large_message_completed_tasks org_apache_cassandra_metrics_connection_large_message_dropped_bytes_due_to_error org_apache_cassandra_metrics_connection_large_message_dropped_bytes_due_to_overload org_apache_cassandra_metrics_connection_large_message_dropped_bytes_due_to_timeout org_apache_cassandra_metrics_connection_large_message_dropped_tasks org_apache_cassandra_metrics_connection_large_message_dropped_tasks_due_to_error org_apache_cassandra_metrics_connection_large_message_dropped_tasks_due_to_overload org_apache_cassandra_metrics_connection_large_message_dropped_tasks_due_to_timeout org_apache_cassandra_metrics_connection_large_message_pending_bytes org_apache_cassandra_metrics_connection_large_message_pending_tasks org_apache_cassandra_metrics_connection_small_message_completed_bytes org_apache_cassandra_metrics_connection_small_message_completed_tasks org_apache_cassandra_metrics_connection_small_message_dropped_bytes_due_to_error org_apache_cassandra_metrics_connection_small_message_dropped_bytes_due_to_overload org_apache_cassandra_metrics_connection_small_message_dropped_bytes_due_to_timeout org_apache_cassandra_metrics_connection_small_message_dropped_tasks org_apache_cassandra_metrics_connection_small_message_dropped_tasks_due_to_error org_apache_cassandra_metrics_connection_small_message_dropped_tasks_due_to_overload org_apache_cassandra_metrics_connection_small_message_dropped_tasks_due_to_timeout org_apache_cassandra_metrics_connection_small_message_pending_bytes org_apache_cassandra_metrics_connection_small_message_pending_tasks org_apache_cassandra_metrics_connection_timeouts_total org_apache_cassandra_metrics_connection_urgent_message_completed_bytes org_apache_cassandra_metrics_connection_urgent_message_completed_tasks org_apache_cassandra_metrics_connection_urgent_message_dropped_bytes_due_to_error org_apache_cassandra_metrics_connection_urgent_message_dropped_bytes_due_to_overload org_apache_cassandra_metrics_connection_urgent_message_dropped_bytes_due_to_timeout org_apache_cassandra_metrics_connection_urgent_message_dropped_tasks org_apache_cassandra_metrics_connection_urgent_message_dropped_tasks_due_to_error org_apache_cassandra_metrics_connection_urgent_message_dropped_tasks_due_to_overload org_apache_cassandra_metrics_connection_urgent_message_dropped_tasks_due_to_timeout org_apache_cassandra_metrics_connection_urgent_message_pending_bytes org_apache_cassandra_metrics_connection_urgent_message_pending_tasks org_apache_cassandra_metrics_hints_service_hint_delays org_apache_cassandra_metrics_hints_service_hint_delays_count org_apache_cassandra_metrics_hints_service_hints_created org_apache_cassandra_metrics_hints_service_hints_not_stored org_apache_cassandra_metrics_inbound_connection_corrupt_frames_recovered org_apache_cassandra_metrics_inbound_connection_corrupt_frames_unrecovered org_apache_cassandra_metrics_inbound_connection_error_bytes org_apache_cassandra_metrics_inbound_connection_error_count org_apache_cassandra_metrics_inbound_connection_expired_bytes org_apache_cassandra_metrics_inbound_connection_expired_count org_apache_cassandra_metrics_inbound_connection_processed_bytes org_apache_cassandra_metrics_inbound_connection_processed_count org_apache_cassandra_metrics_inbound_connection_received_bytes org_apache_cassandra_metrics_inbound_connection_received_count org_apache_cassandra_metrics_inbound_connection_scheduled_bytes org_apache_cassandra_metrics_inbound_connection_scheduled_count org_apache_cassandra_metrics_inbound_connection_throttled_count org_apache_cassandra_metrics_inbound_connection_throttled_nanos ``` None of those metrics seems documented in https://cassandra.apache.org/doc/stable/cassandra/operating/metrics.html#client-metrics but it's easy to find them in Cassandra source code. Should the default relabel configuration be updated to take those metrics into account or am I doing something wrong?</DESCRIPTION>
  <REPONAME>management-api-for-apache-cassandra</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Change relabeling rules for processing internode (inbound / outbound)â€¦ (#515) * Change relabeling rules for processing internode (inbound / outbound) metrics</MESSAGE>
    <SHA>ecb26749b296ab23f127a92e4707d63c72155b5a</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Release v0.1.83 * [BUGFIX] [#510](https://github.com/k8ssandra/management-api-for-apache-cassandra/issues/510) CDC is not working in the OSS images (at least not UBI) * [BUGFIX] [#507](https://github.com/k8ssandra/management-api-for-apache-cassandra/issues/507) Fix the SSLContext reloading in the initChannel when certificates have changed. * [FEATURE] [#511](https://github.com/k8ssandra/management-api-for-apache-cassandra/issues/511) Add DSE 6.8.50 and DSE 6.9.0-rc.3 to the build matrix * [BUGFIX] [#512](https://github.com/k8ssandra/management-api-for-apache-cassandra/issues/512) Add relabeling rules for internode connection metrics (inbound and outbound)</MESSAGE>
      <SHA>8594a4fbea95580e1d25e05b14e7dd971f538576</SHA>
      <PATCHEDFILES>
        <FILE>CHANGELOG.md</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
