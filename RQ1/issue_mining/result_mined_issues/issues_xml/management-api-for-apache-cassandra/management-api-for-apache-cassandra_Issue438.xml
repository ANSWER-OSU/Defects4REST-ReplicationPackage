<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>438</ISSUENO>
  <ISSUEURL>https://github.com/k8ssandra/management-api-for-apache-cassandra/issues/438</ISSUEURL>
  <TITLE>Add Cassandra 5.1 Agent</TITLE>
  <DESCRIPTION>Trying the latest nightly images results in ``` INFO [epollEventLoopGroup-5-4] 2023-12-15 00:10:02,807 RpcMethod50x.java:138 - Failed to execute method NodeOps.checkConsistencyLevel java.lang.reflect.InvocationTargetException: null at jdk.internal.reflect.GeneratedMethodAccessor15.invoke(Unknown Source) at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.base/java.lang.reflect.Method.invoke(Method.java:566) at com.datastax.mgmtapi.rpc.RpcMethod50x.execute(RpcMethod50x.java:130) at com.datastax.mgmtapi.rpc.RpcMethod50x.execute(RpcMethod50x.java:33) at com.datastax.mgmtapi.interceptors.QueryHandlerInterceptor.lambda$handle$1(QueryHandlerInterceptor.java:120) at com.datastax.mgmtapi.shims.CassandraAPI.handleRpcResult(CassandraAPI.java:73) at com.datastax.mgmtapi.interceptors.QueryHandlerInterceptor.handle(QueryHandlerInterceptor.java:120) at com.datastax.mgmtapi.interceptors.QueryHandlerInterceptor.intercept(QueryHandlerInterceptor.java:80) at org.apache.cassandra.cql3.QueryProcessor.process(QueryProcessor.java) at org.apache.cassandra.transport.messages.QueryMessage.execute(QueryMessage.java:116) at org.apache.cassandra.transport.Message$Request.execute(Message.java:256) at org.apache.cassandra.transport.UnixSocketServer50x$UnixSockMessage.channelRead0(UnixSocketServer50x.java:100) at org.apache.cassandra.transport.UnixSocketServer50x$UnixSockMessage.channelRead0(UnixSocketServer50x.java:79) at io.netty.channel.SimpleChannelInboundHandler.channelRead(SimpleChannelInboundHandler.java:99) at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444) at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420) at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412) at io.netty.handler.codec.MessageToMessageDecoder.channelRead(MessageToMessageDecoder.java:103) at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444) at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420) at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412) at io.netty.handler.codec.MessageToMessageDecoder.channelRead(MessageToMessageDecoder.java:103) at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444) at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420) at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412) at io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:346) at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:318) at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444) at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420) at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412) at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410) at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440) at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420) at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919) at io.netty.channel.epoll.AbstractEpollStreamChannel$EpollStreamUnsafe.epollInReady(AbstractEpollStreamChannel.java:800) at io.netty.channel.epoll.EpollDomainSocketChannel$EpollDomainUnsafe.epollInReady(EpollDomainSocketChannel.java:140) at io.netty.channel.epoll.EpollEventLoop.processReady(EpollEventLoop.java:509) at io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:407) at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997) at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74) at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) at java.base/java.lang.Thread.run(Thread.java:829) Caused by: java.lang.NoSuchMethodError: 'org.apache.cassandra.locator.TokenMetadata org.apache.cassandra.service.StorageService.getTokenMetadata()' at com.datastax.mgmtapi.shim.CassandraAPI50x.checkConsistencyLevel(CassandraAPI50x.java:112) at com.datastax.mgmtapi.NodeOpsProvider.checkConsistencyLevel(NodeOpsProvider.java:553) ``` ┆Issue is synchronized with this [Jira Story](https://datastax.jira.com/browse/MAPI-12) by [Unito](https://www.unito.io) ┆Issue Number: MAPI-12</DESCRIPTION>
  <REPONAME>management-api-for-apache-cassandra</REPONAME>
  <TIMEDIFFERENCEDAYS>458</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Update dependencies (#621) - Update Netty to 4.1.118.Final - Update Jackson to 2.18.3 - Update GUava to 33.4.0-jre - Update Maven plugin versions to accomodate</MESSAGE>
    <SHA>8688879dc954464fc000746b31ab5c064c79cc5f</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Release v0.1.100 * [ENHANCEMENT] [#620](https://github.com/k8ssandra/management-api-for-apache-cassandra/issues/620) Update Dependnecies * [BUGFIX] [#438](https://github.com/k8ssandra/management-api-for-apache-cassandra/issues/438) Add Cassandra 5.1 Agent * [BUGFIX] [#617](https://github.com/k8ssandra/management-api-for-apache-cassandra/issues/617) Fix Cassandra trunk builds</MESSAGE>
      <SHA>d553998ae31d378c558a3c15557500e5c4675606</SHA>
      <PATCHEDFILES>
        <FILE>CHANGELOG.md</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
