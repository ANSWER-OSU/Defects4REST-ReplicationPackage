<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>555</ISSUENO>
  <ISSUEURL>https://github.com/bbernhard/signal-cli-rest-api/issues/555</ISSUEURL>
  <TITLE>Fatal error: concurrent map read and write</TITLE>
  <DESCRIPTION>### The problem v0.85 has worked like a charm so far, except for this sudden error: ``` fatal error: concurrent map read and map write goroutine 34 [running]: github.com/bbernhard/signal-cli-rest-api/client.(*JsonRpc2Client).ReceiveData(0x4000280ea0, {0x4000580380, 0xf}) /tmp/signal-cli-rest-api-src/client/jsonrpc2.go:207 +0x43c created by github.com/bbernhard/signal-cli-rest-api/client.(*SignalClient).Init in goroutine 1 /tmp/signal-cli-rest-api-src/client/client.go:382 +0x248 goroutine 1 [IO wait]: internal/poll.runtime_pollWait(0x7f490c3d58, 0x72) /usr/local/go/src/runtime/netpoll.go:345 +0xa0 internal/poll.(*pollDesc).wait(0x7?, 0x2a67c?, 0x0) /usr/local/go/src/internal/poll/fd_poll_runtime.go:84 +0x28 internal/poll.(*pollDesc).waitRead(...) /usr/local/go/src/internal/poll/fd_poll_runtime.go:89 internal/poll.(*FD).Accept(0x400015e600) /usr/local/go/src/internal/poll/fd_unix.go:611 +0x250 net.(*netFD).accept(0x400015e600) /usr/local/go/src/net/fd_unix.go:172 +0x28 net.(*TCPListener).accept(0x400010e480) /usr/local/go/src/net/tcpsock_posix.go:159 +0x28 net.(*TCPListener).Accept(0x400010e480) /usr/local/go/src/net/tcpsock.go:327 +0x2c net/http.(*Server).Serve(0x400014e000, {0x8ca4c0, 0x400010e480}) /usr/local/go/src/net/http/server.go:3255 +0x2a8 net/http.(*Server).ListenAndServe(0x400014e000) /usr/local/go/src/net/http/server.go:3184 +0x84 net/http.ListenAndServe(...) /usr/local/go/src/net/http/server.go:3438 github.com/gin-gonic/gin.(*Engine).Run(0x40000be680, {0x0, 0x0, 0x0}) /go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:386 +0x1b0 main.main() /tmp/signal-cli-rest-api-src/main.go:374 +0x2a28 goroutine 8729 [select]: github.com/bbernhard/signal-cli-rest-api/api.wsPing(0x4000df02c0, 0x40001809c0) /tmp/signal-cli-rest-api-src/api/api.go:519 +0x70 created by github.com/bbernhard/signal-cli-rest-api/api.(*Api).Receive in goroutine 8696 /tmp/signal-cli-rest-api-src/api/api.go:564 +0x750 goroutine 49203 [IO wait]: internal/poll.runtime_pollWait(0x7f490c3788, 0x72) /usr/local/go/src/runtime/netpoll.go:345 +0xa0 internal/poll.(*pollDesc).wait(0x40003f8400?, 0x4001498000?, 0x0) /usr/local/go/src/internal/poll/fd_poll_runtime.go:84 +0x28 internal/poll.(*pollDesc).waitRead(...) /usr/local/go/src/internal/poll/fd_poll_runtime.go:89 internal/poll.(*FD).Read(0x40003f8400, {0x4001498000, 0x1000, 0x1000}) /usr/local/go/src/internal/poll/fd_unix.go:164 +0x200 net.(*netFD).Read(0x40003f8400, {0x4001498000?, 0x40013c8300?, 0x0?}) /usr/local/go/src/net/fd_posix.go:55 +0x28 net.(*conn).Read(0x400005c168, {0x4001498000?, 0x400040f398?, 0x4e8214?}) /usr/local/go/src/net/net.go:179 +0x34 bufio.(*Reader).fill(0x40016b1a40) /usr/local/go/src/bufio/bufio.go:110 +0xf8 bufio.(*Reader).Peek(0x40016b1a40, 0x2) /usr/local/go/src/bufio/bufio.go:148 +0x60 github.com/gorilla/websocket.(*Conn).read(0x40002846e0, 0xd40d0?) /go/pkg/mod/github.com/gorilla/websocket@v1.5.0/conn.go:371 +0x28 github.com/gorilla/websocket.(*Conn).advanceFrame(0x40002846e0) /go/pkg/mod/github.com/gorilla/websocket@v1.5.0/conn.go:809 +0x60 github.com/gorilla/websocket.(*Conn).NextReader(0x40002846e0) /go/pkg/mod/github.com/gorilla/websocket@v1.5.0/conn.go:1009 +0x8c github.com/gorilla/websocket.(*Conn).ReadMessage(0x400040f5a8?) /go/pkg/mod/github.com/gorilla/websocket@v1.5.0/conn.go:1093 +0x1c github.com/bbernhard/signal-cli-rest-api/api.wsPong(0x40002846e0, 0x0?) /tmp/signal-cli-rest-api-src/api/api.go:509 +0x8c github.com/bbernhard/signal-cli-rest-api/api.(*Api).Receive(0x400005c140, 0x4000018500) /tmp/signal-cli-rest-api-src/api/api.go:565 +0x75c github.com/gin-gonic/gin.(*Context).Next(...) /go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174 github.com/gin-gonic/gin.CustomRecoveryWithWriter.func1(0x4000018500) /go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/recovery.go:102 +0x84 github.com/gin-gonic/gin.(*Context).Next(...) /go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174 github.com/gin-gonic/gin.LoggerWithConfig.func1(0x4000018500) /go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/logger.go:240 +0xb4 github.com/gin-gonic/gin.(*Context).Next(...) /go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174 github.com/gin-gonic/gin.(*Engine).handleHTTPRequest(0x40000be680, 0x4000018500) /go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620 +0x518 github.com/gin-gonic/gin.(*Engine).ServeHTTP(0x40000be680, {0x8ca370, 0x40001362a0}, 0x4000156480) /go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576 +0x174 net/http.serverHandler.ServeHTTP({0x40015a86c0?}, {0x8ca370?, 0x40001362a0?}, 0x6?) /usr/local/go/src/net/http/server.go:3137 +0xbc net/http.(*conn).serve(0x40004d8630, {0x8cbea0, 0x4000510630}) /usr/local/go/src/net/http/server.go:2039 +0x508 created by net/http.(*Server).Serve in goroutine 1 /usr/local/go/src/net/http/server.go:3285 +0x3f0 goroutine 49192 [select]: github.com/bbernhard/signal-cli-rest-api/api.wsPing(0x40002846e0, 0x400139c180) /tmp/signal-cli-rest-api-src/api/api.go:519 +0x70 created by github.com/bbernhard/signal-cli-rest-api/api.(*Api).Receive in goroutine 49203 /tmp/signal-cli-rest-api-src/api/api.go:564 +0x750 goroutine 49202 [IO wait]: internal/poll.runtime_pollWait(0x7f490c3880, 0x72) /usr/local/go/src/runtime/netpoll.go:345 +0xa0 internal/poll.(*pollDesc).wait(0x40003f8380?, 0x4000f13000?, 0x0) /usr/local/go/src/internal/poll/fd_poll_runtime.go:84 +0x28 internal/poll.(*pollDesc).waitRead(...) /usr/local/go/src/internal/poll/fd_poll_runtime.go:89 internal/poll.(*FD).Read(0x40003f8380, {0x4000f13000, 0x1000, 0x1000}) /usr/local/go/src/internal/poll/fd_unix.go:164 +0x200 net.(*netFD).Read(0x40003f8380, {0x4000f13000?, 0x40013c82a0?, 0x0?}) /usr/local/go/src/net/fd_posix.go:55 +0x28 net.(*conn).Read(0x400005c0f8, {0x4000f13000?, 0x4000411398?, 0x4e8214?}) /usr/local/go/src/net/net.go:179 +0x34 bufio.(*Reader).fill(0x4000348240) /usr/local/go/src/bufio/bufio.go:110 +0xf8 bufio.(*Reader).Peek(0x4000348240, 0x2) /usr/local/go/src/bufio/bufio.go:148 +0x60 github.com/gorilla/websocket.(*Conn).read(0x40015b2b00, 0xd40d0?) /go/pkg/mod/github.com/gorilla/websocket@v1.5.0/conn.go:371 +0x28 github.com/gorilla/websocket.(*Conn).advanceFrame(0x40015b2b00) /go/pkg/mod/github.com/gorilla/websocket@v1.5.0/conn.go:809 +0x60 github.com/gorilla/websocket.(*Conn).NextReader(0x40015b2b00) /go/pkg/mod/github.com/gorilla/websocket@v1.5.0/conn.go:1009 +0x8c github.com/gorilla/websocket.(*Conn).ReadMessage(0x40004115a8?) /go/pkg/mod/github.com/gorilla/websocket@v1.5.0/conn.go:1093 +0x1c github.com/bbernhard/signal-cli-rest-api/api.wsPong(0x40015b2b00, 0x0?) /tmp/signal-cli-rest-api-src/api/api.go:509 +0x8c github.com/bbernhard/signal-cli-rest-api/api.(*Api).Receive(0x400005c140, 0x4000018400) /tmp/signal-cli-rest-api-src/api/api.go:565 +0x75c github.com/gin-gonic/gin.(*Context).Next(...) /go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174 github.com/gin-gonic/gin.CustomRecoveryWithWriter.func1(0x4000018400) /go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/recovery.go:102 +0x84 github.com/gin-gonic/gin.(*Context).Next(...) /go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174 github.com/gin-gonic/gin.LoggerWithConfig.func1(0x4000018400) /go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/logger.go:240 +0xb4 github.com/gin-gonic/gin.(*Context).Next(...) /go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174 github.com/gin-gonic/gin.(*Engine).handleHTTPRequest(0x40000be680, 0x4000018400) /go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620 +0x518 github.com/gin-gonic/gin.(*Engine).ServeHTTP(0x40000be680, {0x8ca370, 0x400135e380}, 0x4000156240) /go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576 +0x174 net/http.serverHandler.ServeHTTP({0x40015a85d0?}, {0x8ca370?, 0x400135e380?}, 0x6?) /usr/local/go/src/net/http/server.go:3137 +0xbc net/http.(*conn).serve(0x40004d85a0, {0x8cbea0, 0x4000510630}) /usr/local/go/src/net/http/server.go:2039 +0x508 created by net/http.(*Server).Serve in goroutine 1 /usr/local/go/src/net/http/server.go:3285 +0x3f0 goroutine 49184 [runnable]: github.com/sirupsen/logrus.FieldMap.resolve(...) /go/pkg/mod/github.com/sirupsen/logrus@v1.9.0/json_formatter.go:16 github.com/sirupsen/logrus.(*TextFormatter).Format(0x400008a240, 0x40002e63f0) /go/pkg/mod/github.com/sirupsen/logrus@v1.9.0/text_formatter.go:209 +0xccc github.com/sirupsen/logrus.(*Entry).write(0x40002e63f0) /go/pkg/mod/github.com/sirupsen/logrus@v1.9.0/entry.go:289 +0xd8 github.com/sirupsen/logrus.(*Entry).log(0x40002e6070, 0x5, {0x40001a24e0, 0x19b}) /go/pkg/mod/github.com/sirupsen/logrus@v1.9.0/entry.go:252 +0x43c github.com/sirupsen/logrus.(*Entry).Log(0x40002e6070, 0x5, {0x40004069c0?, 0x68fb40?, 0x4000091a01?}) /go/pkg/mod/github.com/sirupsen/logrus@v1.9.0/entry.go:304 +0x60 github.com/sirupsen/logrus.(*Logger).Log(0x1577860, 0x5, {0x40004069c0, 0x2, 0x2}) /go/pkg/mod/github.com/sirupsen/logrus@v1.9.0/logger.go:204 +0x60 github.com/sirupsen/logrus.(*Logger).Debug(...) /go/pkg/mod/github.com/sirupsen/logrus@v1.9.0/logger.go:222 github.com/sirupsen/logrus.Debug(...) /go/pkg/mod/github.com/sirupsen/logrus@v1.9.0/exported.go:99 github.com/bbernhard/signal-cli-rest-api/client.(*JsonRpc2Client).getRaw(0x4000280ea0, {0x783477, 0x4}, 0x40004c8000, {0x761d60, 0x40004fa000}) /tmp/signal-cli-rest-api-src/client/jsonrpc2.go:146 +0x56c github.com/bbernhard/signal-cli-rest-api/client.(*SignalClient).send(0x400015e280, {{0x40013d63b0, 0xd}, {0x40013fc9c0, 0x18d}, {0x40013aa770, 0x1, 0x1}, {0x15f21c0, 0x0, ...}, ...}) /tmp/signal-cli-rest-api-src/client/client.go:492 +0xf30 github.com/bbernhard/signal-cli-rest-api/client.(*SignalClient).SendV2(0x400015e280, {0x40013d63b0, 0xd}, {0x40013fc9c0, 0x18d}, {0x40013aa740?, 0x7f336a3488?, 0x40015b22c0?}, {0x15f21c0, 0x0, ...}, ...) /tmp/signal-cli-rest-api-src/client/client.go:774 +0x6f4 github.com/bbernhard/signal-cli-rest-api/api.(*Api).SendV2(0x400005c140, 0x4000492400) /tmp/signal-cli-rest-api-src/api/api.go:416 +0x1d4 github.com/gin-gonic/gin.(*Context).Next(...) /go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174 github.com/gin-gonic/gin.CustomRecoveryWithWriter.func1(0x4000492400) /go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/recovery.go:102 +0x84 github.com/gin-gonic/gin.(*Context).Next(...) /go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174 github.com/gin-gonic/gin.LoggerWithConfig.func1(0x4000492400) /go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/logger.go:240 +0xb4 github.com/gin-gonic/gin.(*Context).Next(...) /go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174 github.com/gin-gonic/gin.(*Engine).handleHTTPRequest(0x40000be680, 0x4000492400) /go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620 +0x518 github.com/gin-gonic/gin.(*Engine).ServeHTTP(0x40000be680, {0x8ca370, 0x400135e000}, 0x4000480480) /go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576 +0x174 net/http.serverHandler.ServeHTTP({0x8c85b8?}, {0x8ca370?, 0x400135e000?}, 0x6?) /usr/local/go/src/net/http/server.go:3137 +0xbc net/http.(*conn).serve(0x40004d8b40, {0x8cbea0, 0x4000510630}) /usr/local/go/src/net/http/server.go:2039 +0x508 created by net/http.(*Server).Serve in goroutine 1 /usr/local/go/src/net/http/server.go:3285 +0x3f0 goroutine 49206 [select]: github.com/bbernhard/signal-cli-rest-api/api.wsPing(0x40015b2b00, 0x400143e240) /tmp/signal-cli-rest-api-src/api/api.go:519 +0x70 created by github.com/bbernhard/signal-cli-rest-api/api.(*Api).Receive in goroutine 49202 /tmp/signal-cli-rest-api-src/api/api.go:564 +0x750 goroutine 49205 [select]: github.com/bbernhard/signal-cli-rest-api/api.(*Api).handleSignalReceive(0x400005c140, 0x40015b2b00, {0x4000234010, 0xd}, 0x400143e240) /tmp/signal-cli-rest-api-src/api/api.go:449 +0x114 created by github.com/bbernhard/signal-cli-rest-api/api.(*Api).Receive in goroutine 49202 /tmp/signal-cli-rest-api-src/api/api.go:563 +0x700 goroutine 49191 [select]: github.com/bbernhard/signal-cli-rest-api/api.(*Api).handleSignalReceive(0x400005c140, 0x40002846e0, {0x400159c010, 0xd}, 0x400139c180) /tmp/signal-cli-rest-api-src/api/api.go:449 +0x114 created by github.com/bbernhard/signal-cli-rest-api/api.(*Api).Receive in goroutine 49203 /tmp/signal-cli-rest-api-src/api/api.go:563 +0x700 goroutine 49193 [IO wait]: internal/poll.runtime_pollWait(0x7f490c33a8, 0x72) /usr/local/go/src/runtime/netpoll.go:345 +0xa0 internal/poll.(*pollDesc).wait(0x40003f8600?, 0x40013c8a01?, 0x0) /usr/local/go/src/internal/poll/fd_poll_runtime.go:84 +0x28 internal/poll.(*pollDesc).waitRead(...) /usr/local/go/src/internal/poll/fd_poll_runtime.go:89 internal/poll.(*FD).Read(0x40003f8600, {0x40013c8a01, 0x1, 0x1}) /usr/local/go/src/internal/poll/fd_unix.go:164 +0x200 net.(*netFD).Read(0x40003f8600, {0x40013c8a01?, 0x6769696943414b4b?, 0x61687320a1929ff0?}) /usr/local/go/src/net/fd_posix.go:55 +0x28 net.(*conn).Read(0x400005c228, {0x40013c8a01?, 0x939ff00a9380e293?, 0x40004cc128?}) /usr/local/go/src/net/net.go:179 +0x34 net/http.(*connReader).backgroundRead(0x40013c89f0) /usr/local/go/src/net/http/server.go:681 +0x40 created by net/http.(*connReader).startBackgroundRead in goroutine 49184 /usr/local/go/src/net/http/server.go:677 +0xc8 goroutine 8728 [select]: github.com/bbernhard/signal-cli-rest-api/api.(*Api).handleSignalReceive(0x400005c140, 0x4000df02c0, {0x4001010400, 0xd}, 0x40001809c0) /tmp/signal-cli-rest-api-src/api/api.go:449 +0x114 created by github.com/bbernhard/signal-cli-rest-api/api.(*Api).Receive in goroutine 8696 /tmp/signal-cli-rest-api-src/api/api.go:563 +0x700 goroutine 49185 [IO wait]: internal/poll.runtime_pollWait(0x7f490c3b68, 0x72) /usr/local/go/src/runtime/netpoll.go:345 +0xa0 internal/poll.(*pollDesc).wait(0x400015e400?, 0x40013c8be1?, 0x0) /usr/local/go/src/internal/poll/fd_poll_runtime.go:84 +0x28 internal/poll.(*pollDesc).waitRead(...) /usr/local/go/src/internal/poll/fd_poll_runtime.go:89 internal/poll.(*FD).Read(0x400015e400, {0x40013c8be1, 0x1, 0x1}) /usr/local/go/src/internal/poll/fd_unix.go:164 +0x200 net.(*netFD).Read(0x400015e400, {0x40013c8be1?, 0x40001ffd68?, 0x566180?}) /usr/local/go/src/net/fd_posix.go:55 +0x28 net.(*conn).Read(0x4000120000, {0x40013c8be1?, 0x400118cf88?, 0x4001550278?}) /usr/local/go/src/net/net.go:179 +0x34 net/http.(*connReader).backgroundRead(0x40013c8bd0) /usr/local/go/src/net/http/server.go:681 +0x40 created by net/http.(*connReader).startBackgroundRead in goroutine 49194 /usr/local/go/src/net/http/server.go:677 +0xc8 goroutine 8696 [IO wait]: internal/poll.runtime_pollWait(0x7f490c3978, 0x72) /usr/local/go/src/runtime/netpoll.go:345 +0xa0 internal/poll.(*pollDesc).wait(0x40003f8180?, 0x4000154000?, 0x0) /usr/local/go/src/internal/poll/fd_poll_runtime.go:84 +0x28 internal/poll.(*pollDesc).waitRead(...) /usr/local/go/src/internal/poll/fd_poll_runtime.go:89 internal/poll.(*FD).Read(0x40003f8180, {0x4000154000, 0x1000, 0x1000}) /usr/local/go/src/internal/poll/fd_unix.go:164 +0x200 net.(*netFD).Read(0x40003f8180, {0x4000154000?, 0x40015a80f0?, 0x0?}) /usr/local/go/src/net/fd_posix.go:55 +0x28 net.(*conn).Read(0x400005c0c0, {0x4000154000?, 0x4000201398?, 0x4e8214?}) /usr/local/go/src/net/net.go:179 +0x34 bufio.(*Reader).fill(0x40003dc2a0) /usr/local/go/src/bufio/bufio.go:110 +0xf8 bufio.(*Reader).Peek(0x40003dc2a0, 0x2) /usr/local/go/src/bufio/bufio.go:148 +0x60 github.com/gorilla/websocket.(*Conn).read(0x4000df02c0, 0xd40d0?) /go/pkg/mod/github.com/gorilla/websocket@v1.5.0/conn.go:371 +0x28 github.com/gorilla/websocket.(*Conn).advanceFrame(0x4000df02c0) /go/pkg/mod/github.com/gorilla/websocket@v1.5.0/conn.go:809 +0x60 github.com/gorilla/websocket.(*Conn).NextReader(0x4000df02c0) /go/pkg/mod/github.com/gorilla/websocket@v1.5.0/conn.go:1009 +0x8c github.com/gorilla/websocket.(*Conn).ReadMessage(0x40002015a8?) /go/pkg/mod/github.com/gorilla/websocket@v1.5.0/conn.go:1093 +0x1c github.com/bbernhard/signal-cli-rest-api/api.wsPong(0x4000df02c0, 0x0?) /tmp/signal-cli-rest-api-src/api/api.go:509 +0x8c github.com/bbernhard/signal-cli-rest-api/api.(*Api).Receive(0x400005c140, 0x40003da100) /tmp/signal-cli-rest-api-src/api/api.go:565 +0x75c github.com/gin-gonic/gin.(*Context).Next(...) /go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174 github.com/gin-gonic/gin.CustomRecoveryWithWriter.func1(0x40003da100) /go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/recovery.go:102 +0x84 github.com/gin-gonic/gin.(*Context).Next(...) /go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174 github.com/gin-gonic/gin.LoggerWithConfig.func1(0x40003da100) /go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/logger.go:240 +0xb4 github.com/gin-gonic/gin.(*Context).Next(...) /go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174 github.com/gin-gonic/gin.(*Engine).handleHTTPRequest(0x40000be680, 0x40003da100) /go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620 +0x518 github.com/gin-gonic/gin.(*Engine).ServeHTTP(0x40000be680, {0x8ca370, 0x40000e21c0}, 0x4000156360) /go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576 +0x174 net/http.serverHandler.ServeHTTP({0x40002a1470?}, {0x8ca370?, 0x40000e21c0?}, 0x6?) /usr/local/go/src/net/http/server.go:3137 +0xbc net/http.(*conn).serve(0x40001ee5a0, {0x8cbea0, 0x4000510630}) /usr/local/go/src/net/http/server.go:2039 +0x508 created by net/http.(*Server).Serve in goroutine 1 /usr/local/go/src/net/http/server.go:3285 +0x3f0 goroutine 49194 [chan receive]: github.com/bbernhard/signal-cli-rest-api/client.(*JsonRpc2Client).getRaw(0x4000280ea0, {0x7913ed, 0xc}, 0x400046a7f0, {0x7420e0, 0x4000f0e1e0}) /tmp/signal-cli-rest-api-src/client/jsonrpc2.go:143 +0x4b0 github.com/bbernhard/signal-cli-rest-api/client.(*SignalClient).SendReaction(0x400015e280, {0x4000234463, 0xd}, {0x400003a410, 0x42}, {0x40015a4cd0, 0x3}, {0x40015a4ce0, 0xe}, 0x19084568718, ...) /tmp/signal-cli-rest-api-src/client/client.go:1682 +0x228 github.com/bbernhard/signal-cli-rest-api/api.(*Api).SendReaction(0x400005c140, 0x4000492200) /tmp/signal-cli-rest-api-src/api/api.go:1431 +0x1e4 github.com/gin-gonic/gin.(*Context).Next(...) /go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174 github.com/gin-gonic/gin.CustomRecoveryWithWriter.func1(0x4000492200) /go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/recovery.go:102 +0x84 github.com/gin-gonic/gin.(*Context).Next(...) /go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174 github.com/gin-gonic/gin.LoggerWithConfig.func1(0x4000492200) /go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/logger.go:240 +0xb4 github.com/gin-gonic/gin.(*Context).Next(...) /go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174 github.com/gin-gonic/gin.(*Engine).handleHTTPRequest(0x40000be680, 0x4000492200) /go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620 +0x518 github.com/gin-gonic/gin.(*Engine).ServeHTTP(0x40000be680, {0x8ca370, 0x40001360e0}, 0x40004807e0) /go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576 +0x174 net/http.serverHandler.ServeHTTP({0x8c85b8?}, {0x8ca370?, 0x40001360e0?}, 0x6?) /usr/local/go/src/net/http/server.go:3137 +0xbc net/http.(*conn).serve(0x40015e47e0, {0x8cbea0, 0x4000510630}) /usr/local/go/src/net/http/server.go:2039 +0x508 created by net/http.(*Server).Serve in goroutine 1 /usr/local/go/src/net/http/server.go:3285 +0x3f0 ``` After that, the docker died. Similar to [this](https://github.com/bbernhard/signal-cli-rest-api/issues/493) issue, I had two tasks listening at the same time (which I hadn't before) EDIT: Also, I receive the same messages twice, if I set up two producer listeners from [signalbot](https://github.com/filipre/signalbot). That shouldn't be either, should it? ### Are you using the latest released version? - [x] Yes ### Have you read the troubleshooting page? - [X] Yes ### What type of installation are you running? signal-cli-rest-api Docker Container ### In which mode are you using the docker container? JSON-RPC Mode ### What's the architecture of your host system? x86-64 ### Additional information _No response_</DESCRIPTION>
  <REPONAME>signal-cli-rest-api</REPONAME>
  <TIMEDIFFERENCEDAYS>91</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>protect websocket write with mutex * Gorilla Websocket only allows one concurrent writer. As there are multiple goroutines that could write concurrently to the websocket, the websocket write needs to be protected by a Mutext. This is not particular nice, but a complete rewrite of the connection handling would be quite a lot of work. see #556</MESSAGE>
    <SHA>cd996e18141ac6f96007219818e7ecfa310f00c1</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>protect map write with mutex * in order to make the r.receivedResponsesById map goroutine-safe, a mutex was added. This is not particular nice, but rewriting the jsonrpc connection handling would be quite a lot of work and has a big regression potential. So, if it is not absolutely necessary, I'd like to avoid that. see #555</MESSAGE>
      <SHA>dc1efc1a14391ea0c1dc60c454af7300352e6efe</SHA>
      <PATCHEDFILES>
        <FILE>src/client/jsonrpc2.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
