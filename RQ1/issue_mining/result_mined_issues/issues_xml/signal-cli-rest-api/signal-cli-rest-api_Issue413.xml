<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>413</ISSUENO>
  <ISSUEURL>https://github.com/bbernhard/signal-cli-rest-api/issues/413</ISSUEURL>
  <TITLE>broken formatting when using styling with multicharacter emojis</TITLE>
  <DESCRIPTION>### The problem When sending multicharacter emojis (for example emojis that use a skin color modifier) and styling (bold, italic, etc.), something about the formatting breaks. Depending on the actual message, the emoji will break or the formatting is shifted. ### Are you using the latest released version? - [X] Yes ### Have you read the troubleshooting page? - [X] Yes ### What type of installation are you running? signal-cli-rest-api Docker Container ### In which mode are you using the docker container? json-rpc ### What's the architecture of your host system? x86-64 ### Additional information Multicharacter emoji without styling works. ```json { &quot;message&quot;: &quot;abcdefg&quot;, &quot;number&quot;: &quot;{{BOT_NUMBER}}&quot;, &quot;recipients&quot;: [ &quot;{{RECIPIENT_NUMBER}}&quot; ], &quot;text_mode&quot;:&quot;styled&quot; } ``` ![image](https://github.com/bbernhard/signal-cli-rest-api/assets/49568639/d1dc669e-6fc3-4954-8d29-a8b8997c7b5e) --- When using a multicharacter emoji and then some styled text, the styling is shifted to the left by two characters. The `bc` is now styled bold and `fg` is no longer styled bold. ```json { &quot;message&quot;: &quot;abc**defg**&quot;, &quot;number&quot;: &quot;{{BOT_NUMBER}}&quot;, &quot;recipients&quot;: [ &quot;{{RECIPIENT_NUMBER}}&quot; ], &quot;text_mode&quot;:&quot;styled&quot; } ``` ![image](https://github.com/bbernhard/signal-cli-rest-api/assets/49568639/bf334463-a88f-4d47-a7c6-0290b0b8473f) --- When the styling is less then two characters away, the emoji breaks. *two characters away* ```json { &quot;message&quot;: &quot;ab**cdefg**&quot;, &quot;number&quot;: &quot;{{BOT_NUMBER}}&quot;, &quot;recipients&quot;: [ &quot;{{RECIPIENT_NUMBER}}&quot; ], &quot;text_mode&quot;:&quot;styled&quot; } ``` ![image](https://github.com/bbernhard/signal-cli-rest-api/assets/49568639/c6efbf80-a323-416c-a82a-806a3213e3af) *one characters away* ```json { &quot;message&quot;: &quot;ab**cdefg**&quot;, &quot;number&quot;: &quot;{{BOT_NUMBER}}&quot;, &quot;recipients&quot;: [ &quot;{{RECIPIENT_NUMBER}}&quot; ], &quot;text_mode&quot;:&quot;styled&quot; } ``` ![image](https://github.com/bbernhard/signal-cli-rest-api/assets/49568639/dc0cc8da-c970-4b6c-9e72-3f2d2bc75031) *directly after* ```json { &quot;message&quot;: &quot;**abcdefg**&quot;, &quot;number&quot;: &quot;{{BOT_NUMBER}}&quot;, &quot;recipients&quot;: [ &quot;{{RECIPIENT_NUMBER}}&quot; ], &quot;text_mode&quot;:&quot;styled&quot; } ``` ![image](https://github.com/bbernhard/signal-cli-rest-api/assets/49568639/ff4ec511-b32f-489e-967e-3d7f575b1d14) --- Weirdly enough this behaves differently on the Signal Windows Client than on the Android App. The previous screenshots are from the Windows Client, the following from the Android App. In the notification, the issue is not present at all, I guess because the message is stripped of the formatting anyways. ![image](https://github.com/bbernhard/signal-cli-rest-api/assets/49568639/557301a0-ea9b-41ec-9ec6-d8bce3c0e168) Here's how the Android App behaves in the chat: ![image](https://github.com/bbernhard/signal-cli-rest-api/assets/49568639/4af4d379-ef07-4f9c-8586-a965405b3187)</DESCRIPTION>
  <REPONAME>signal-cli-rest-api</REPONAME>
  <TIMEDIFFERENCEDAYS>32</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>fixed small bug in cli client</MESSAGE>
    <SHA>8271d537463d7bcd94757d08397a1337695c402c</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>handle multicharacter emojis in textstyleparser see #413</MESSAGE>
      <SHA>07aee216726af14c3a538eec2aea41a71b07b4d9</SHA>
      <PATCHEDFILES>
        <FILE>src/utils/textstyleparser.go</FILE>
        <FILE>src/utils/textstyleparser_test.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
