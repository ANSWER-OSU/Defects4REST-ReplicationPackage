<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>26</ISSUENO>
  <ISSUEURL>https://github.com/bbernhard/signal-cli-rest-api/issues/26</ISSUEURL>
  <TITLE>Growing container size due to missing cleanup for /tmp/*.{jpg,mp4} files</TITLE>
  <DESCRIPTION>Thanks for providing this great glueing service, @bbernhard ! I [recently praised it in my stream ;-)](https://twitter.com/bentolor/status/1291370025014702081) I stumbled over a minor issue/annoyance: A `sudo docker container ls -s` reveals the following: ``` 58f27f04c663 bbernhard/signal-cli-rest-api &quot;signal-cli-rest-api&quot; 7 days ago Up 7 days 0.0.0.0:9922-&gt;8080/tcp signal-api 118MB (virtual 2.04GB) ``` On inspecting with `container diff` reports the following situation: ``` $ sudo docker container diff signal-api C /tmp A /tmp/10096571-0b51-41ac-84cc-44bd77a6fc4e.mp4 A /tmp/193791b7-a84c-4458-823d-6120b33c6b56.jpg … A /tmp/c37bebc6-c6a8-40b6-92c4-c770a97bdfeb.jpg A /tmp/dfbea440-7709-4600-9065-7ce02fe76ba7.jpg C /tmp/hsperfdata_root D /tmp/hsperfdata_root/57 A /tmp/2c1f1207-e9ca-47c7-b1c3-3a7dc064b792.jpg … ``` A container restart does not clean them up. After inspecting the code it seems there is also some sort of cleanup logic. Not sure where the fallthrough is lying: [func cleanupTmpFiles()](https://github.com/bbernhard/signal-cli-rest-api/blob/3b6957299209f14e2023268219e41fc32d5ec184/src/api/api.go#L84) For me it seems that nearly _no_ cleanup happened at all, because the file list more or less matches all media files I yet sent via the API?!</DESCRIPTION>
  <REPONAME>signal-cli-rest-api</REPONAME>
  <TIMEDIFFERENCEDAYS>39</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>fixed API documentation for send endpoints</MESSAGE>
    <SHA>d289b862d57be8d4082e2ff3e813fdccbbc9bc13</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Remove temporary files also on success * Up to now, the temporary files on the filesystem were only removed when an error occured - resulting in an ever growing docker container. This changeset makes sure that the temporary files also get removed on success. see #26</MESSAGE>
      <SHA>12d53dd098a8cf0432df5f2534b20279363e05cc</SHA>
      <PATCHEDFILES>
        <FILE>src/api/api.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Remove temporary files also on success * Up to now, the temporary files on the filesystem were only removed when an error occured - resulting in an ever growing docker container. This changeset makes sure that the temporary files also get removed on success. see #26</MESSAGE>
      <SHA>3a19c50466707ed0a3011f4ed5368dab5df2cc98</SHA>
      <PATCHEDFILES>
        <FILE>src/api/api.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
