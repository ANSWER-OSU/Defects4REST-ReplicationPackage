<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>27190</ISSUENO>
  <ISSUEURL>https://github.com/Dolibarr/dolibarr/issues/27190</ISSUEURL>
  <TITLE>Inventory : Setting it back to draft clears the inventory</TITLE>
  <DESCRIPTION>### Bug Bug: - Setting an inventory back to &quot;Draft&quot; will empty the inventory without confirmation I had problems with users inadvertently (or because they wanted to edit the label ) clicking the &quot;Back to draft&quot; button and therefore clearing the inventory ( and they had to start over the whole inventory). There is no confirmation, as soon as they click the button, the inventory is cleared. Expected behavior: - We should be able to edit the label of the inventory without clearing it. - Ask for confirmation before clearing Version : 18.0.4 ( I checked the code for the master branch, it does not appear to be fixed ) This file: https://github.com/Dolibarr/dolibarr/blob/develop/htdocs/product/inventory/card.php that button: ``` // Back to draft if ($object-&gt;status == $object::STATUS_VALIDATED) { if ($permissiontoadd) { print '&lt;a class=&quot;butAction&quot; href=&quot;'.$_SERVER['PHP_SELF'].'?id='.$object-&gt;id.'&amp;action=confirm_setdraft&amp;confirm=yes&amp;token='.newToken().'&quot;&gt;'.$langs-&gt;trans(&quot;SetToDraft&quot;).'&lt;/a&gt;'; } } ``` ### Environment Version 18.0.4 ### Environment OS _No response_ ### Environment Web server _No response_ ### Environment PHP _No response_ ### Environment Database _No response_ ### Environment URL(s) _No response_ ### Expected and actual behavior _No response_ ### Steps to reproduce the behavior _No response_ ### Attached files _No response_</DESCRIPTION>
  <REPONAME>dolibarr</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Fix debug v19 - &quot;Show more&quot; on ACE editor was broken</MESSAGE>
    <SHA>40d10299644dd143f987621b94c8bf1f980b8261</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fix #27190 Set inventory to draft and label</MESSAGE>
      <SHA>c8031a6f4f9d33f259d690e16cac4a894a2400e3</SHA>
      <PATCHEDFILES>
        <FILE>htdocs/product/inventory/card.php</FILE>
        <FILE>htdocs/product/inventory/class/inventory.class.php</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Merge branch 'develop' into Fix-#27190-inventory-setting-label</MESSAGE>
      <SHA>d05de60ec7984e62da653bc7cf18f8fd64eff1b5</SHA>
      <PATCHEDFILES>
        <FILE>dev/tools/spider.php</FILE>
        <FILE>htdocs/adherents/class/adherent.class.php</FILE>
        <FILE>htdocs/admin/security.php</FILE>
        <FILE>htdocs/admin/system/security.php</FILE>
        <FILE>htdocs/api/class/api_login.class.php</FILE>
        <FILE>htdocs/comm/action/card.php</FILE>
        <FILE>htdocs/comm/action/class/actioncomm.class.php</FILE>
        <FILE>htdocs/contact/class/contact.class.php</FILE>
        <FILE>htdocs/contact/consumption.php</FILE>
        <FILE>htdocs/core/ajax/check_notifications.php</FILE>
        <FILE>htdocs/core/js/lib_head.js.php</FILE>
        <FILE>htdocs/core/lib/files.lib.php</FILE>
        <FILE>htdocs/core/lib/functions.lib.php</FILE>
        <FILE>htdocs/core/modules/mrp/doc/pdf_vinci.modules.php</FILE>
        <FILE>htdocs/don/list.php</FILE>
        <FILE>htdocs/emailcollector/lib/emailcollector.lib.php</FILE>
        <FILE>htdocs/fichinter/class/fichinterstats.class.php</FILE>
        <FILE>htdocs/fourn/class/fournisseur.facture-rec.class.php</FILE>
        <FILE>htdocs/includes/ace/src/worker-html.js</FILE>
        <FILE>htdocs/langs/en_US/agenda.lang</FILE>
        <FILE>htdocs/langs/en_US/errors.lang</FILE>
        <FILE>htdocs/langs/fr_FR/errors.lang</FILE>
        <FILE>htdocs/main.inc.php</FILE>
        <FILE>htdocs/master.inc.php</FILE>
        <FILE>htdocs/modulebuilder/index.php</FILE>
        <FILE>htdocs/product/stock/class/mouvementstock.class.php</FILE>
        <FILE>htdocs/theme/eldy/global.inc.php</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Merge pull request #27193 from Hystepik/Fix-#27190-inventory-setting-label Fix #27190 Set inventory to draft and label</MESSAGE>
      <SHA>0d9f153786a09490992ae8f9319d43d17ea88507</SHA>
      <PATCHEDFILES>
        <FILE>htdocs/langs/en_US/products.lang</FILE>
        <FILE>htdocs/product/inventory/card.php</FILE>
        <FILE>htdocs/product/inventory/class/inventory.class.php</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
