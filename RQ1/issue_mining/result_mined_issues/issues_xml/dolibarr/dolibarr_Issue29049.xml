<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>29049</ISSUENO>
  <ISSUEURL>https://github.com/Dolibarr/dolibarr/issues/29049</ISSUEURL>
  <TITLE>IRPF reset when editing the label of a supplier invoice</TITLE>
  <DESCRIPTION>### Bug Problem: When there is a taxable person reversal invoice with IRPF and the label is edited, the IRPF is eliminated having the value 0. ![image](https://github.com/Dolibarr/dolibarr/assets/120027058/76410c6b-e37e-4fe2-a4db-f410872ebf4a) I edit the tag: ![image](https://github.com/Dolibarr/dolibarr/assets/120027058/6e7d82ea-ae62-4988-a82e-3e9154cbaf69) After editing the tag: ![image](https://github.com/Dolibarr/dolibarr/assets/120027058/442e63d0-e959-4e8c-a7d0-47ba1e48b903) Expected behavior: ![image](https://github.com/Dolibarr/dolibarr/assets/120027058/874c350c-8f30-43e8-bd54-46a8f10cc4de) Solution: Edit the file htdocs/fourn/class/fournisseur.facture.class.php. We look for the Update method: if (isset($this-&gt;localtax2)) { $this-&gt;total_localtax2 = trim($this-&gt;localtax2); } and we substitute: if (isset($this-&gt;total_localtax2)) { $this-&gt;total_localtax2 = trim($this-&gt;total_localtax2); } And that : $sql .= &quot; localtax2=&quot; . (isset($this-&gt;localtax2) ? ((float) $this-&gt;localtax2) : &quot;null&quot;) . &quot;,&quot;; For this: $sql .= &quot; localtax2=&quot; . (isset($this-&gt;total_localtax2) ? ((float) $this-&gt;total_localtax2) : &quot;null&quot;) . &quot;,&quot;; ### Dolibarr Version 19.0 ### Environment PHP 8.1 ### Environment Database MySQL or MariaDB 8.0.36-0ubuntu0.22.04.1 ### Steps to reproduce the behavior and expected behavior _No response_ ### Attached files _No response_</DESCRIPTION>
  <REPONAME>dolibarr</REPONAME>
  <TIMEDIFFERENCEDAYS>393</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Fix regression in IMAP collecting</MESSAGE>
    <SHA>1b98d99434cdd7e3b3bf99dca86de1cde5e3b7d0</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Update fournisseur.facture.class.php IRPF reset when editing the label of a supplier invoice #29049</MESSAGE>
      <SHA>0a2481c702a8c69f8410d51212ac62112f4a8838</SHA>
      <PATCHEDFILES>
        <FILE>htdocs/fourn/class/fournisseur.facture.class.php</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
