<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>25929</ISSUENO>
  <ISSUEURL>https://github.com/Dolibarr/dolibarr/issues/25929</ISSUEURL>
  <TITLE>error on api_proposals.class.php</TITLE>
  <DESCRIPTION>### Bug if call to endpoint /api/index.php/proposals/xxxxx/lines without sql filter this generate an exception The line 319 of file htdocs/comm/propal/class/api_proposals.class.php say: $this-&gt;propal-&gt;getLinesArray($sql); and $sql is not set this line would set into if at line 311 if (!empty($sqlfilters)) { ### Environment Version 18.0.1 ### Environment OS Ubuntu 22.04 ### Environment Web server Nginx ### Environment PHP 8.2 ### Environment Database mariadb 10 ### Environment URL(s) _No response_ ### Expected and actual behavior 2023/09/15 13:02:57 [error] 704889#704889: *47475930 FastCGI sent in stderr: &quot;PHP message: PHP Warning: Undefined variable $sql in /xxxxx/htdocs/comm/propal/class/api_proposals.class.php on line 319&quot; while reading response header from upstream, client: xxx.xxx.xxx.xx, server: xxxxxxxt, request: &quot;GET /api/index.php/proposals/nnnnn/lines HTTP/1.1&quot;, upstream: &quot;fastcgi://unix:/run/php/php8.2-fpm.sock:&quot;, host: &quot;xxxxxxx&quot; ### Steps to reproduce the behavior curl -X GET --header 'Accept: application/json' --header 'DOLAPIKEY: xxxxxx' 'https://xxxxxxx/api/index.php/proposals/nnnnnn/lines' ### Attached files _No response_</DESCRIPTION>
  <REPONAME>dolibarr</REPONAME>
  <TIMEDIFFERENCEDAYS>1</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge branch '17.0' of git@github.com:Dolibarr/dolibarr.git into 17.0</MESSAGE>
    <SHA>5a7226f2ecf810175d59d454e491a75a42ab2306</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fix #25929 : warning undefined var</MESSAGE>
      <SHA>3027f0fd908bb7e0ec02a41e4f770c6199eb4626</SHA>
      <PATCHEDFILES>
        <FILE>htdocs/comm/propal/class/api_proposals.class.php</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>FIX #25934 #25929</MESSAGE>
      <SHA>0d2d68dfc777285d6a9143155a3ade55846c8023</SHA>
      <PATCHEDFILES>
        <FILE>htdocs/comm/propal/class/api_proposals.class.php</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>FIX #25929 #25934</MESSAGE>
      <SHA>bb0c53996f8fd662ec34ece2caab40755d004c48</SHA>
      <PATCHEDFILES>
        <FILE>htdocs/comm/propal/class/api_proposals.class.php</FILE>
        <FILE>htdocs/comm/propal/class/propal.class.php</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
