<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>29594</ISSUENO>
  <ISSUEURL>https://github.com/Dolibarr/dolibarr/issues/29594</ISSUEURL>
  <TITLE>REST API PUT `/contacts/{id}`: `update` called with notrigger = 1</TITLE>
  <DESCRIPTION>### Bug Currently, the API endpoint for contact update bypasses triggers (notrigger = 1). The same is true for some other PUT endpoints (~~thirdparty for instance~~), but not all (contract, BOM, proposal, anything made with ModuleBuilder, etc.). **[edit]** I was wrong about `thirdparty` because Societe::update's 3rd parameter is `$call_trigger` and not `$notrigger` as is usually the case. So the 3rd parameter is `1` but it _does_ call the trigger. If the endpoint `PUT /contacts/{id}` was copy-pasted from the third party API, it could explain this issue because this detail is easy to overlook (I'm a good example of that). I assume this is on purpose, but I can't find the reason why, and it is inconsinstent (why notrigger for updating and not for creating, why some objects and not others). We are developing a feature using triggers to change information whenever a contact is created or updated, but because of this `notrigger`, we can't make it work in APIs. ### Dolibarr Version 17.0, 18.0, 19.0, develop, … ### Environment PHP any ### Environment Database _No response_ ### Steps to reproduce the behavior and expected behavior 1. Implement triggers CONTACT_MODIFY and CONTACT_CREATE (let's say they both do the same: they concatenate &quot;elloworld&quot; to the lastname of the contact) 2. create a contact with lastname &quot;h&quot; using Dolibarr interface →OK, its name is &quot;helloworld&quot; 3. edit the contact with lastname &quot;h&quot; using Dolibarr interface → OK, its name is &quot;helloworld&quot; 4. create a contact with lastname &quot;h&quot; using Dolibarr API POST /contacts → OK, its name is &quot;helloworld&quot; 5. update a contact with lastname &quot;h&quot;using Dolibarr API PUT /contacts/{id} → KO (its is still &quot;h&quot;) ### Attached files _No response_</DESCRIPTION>
  <REPONAME>dolibarr</REPONAME>
  <TIMEDIFFERENCEDAYS>10</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #448 from ATM-Consulting/17.0_koesio_FIX_data_rowid_for_soc_list_tr add FIX data rowid for soc list (backport V19)</MESSAGE>
    <SHA>58eba5a78334edecaf8f12370770f8dad7428115</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>NEW sprint 114 spé Koesio: passage du notrigger à 0 sur endpoint PUT /contacts/{id} https://github.com/Dolibarr/dolibarr/issues/29594</MESSAGE>
      <SHA>e4fab118af9659cd85bbad4819589c944c667c80</SHA>
      <PATCHEDFILES>
        <FILE>htdocs/societe/class/api_contacts.class.php</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>FIX: PUT /thirdparties/{id} and PUT /contacts/{id} should throw exception if update returns &lt; 0 + FIX some PHPDoc (types and throws) + FIX issue #29594: trigger should be called on contact update by API</MESSAGE>
      <SHA>3cace15878805040a6864c73ff3a1bf4e08d78ee</SHA>
      <PATCHEDFILES>
        <FILE>htdocs/societe/class/api_contacts.class.php</FILE>
        <FILE>htdocs/societe/class/api_thirdparties.class.php</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>FIX: PUT /thirdparties/{id} and PUT /contacts/{id} should throw exception if update returns &lt; 0 (#29596) + FIX some PHPDoc (types and throws) + FIX issue #29594: trigger should be called on contact update by API</MESSAGE>
      <SHA>cf6cbafa8c6b8b345ceb084aa285a505df3674b8</SHA>
      <PATCHEDFILES>
        <FILE>htdocs/societe/class/api_contacts.class.php</FILE>
        <FILE>htdocs/societe/class/api_thirdparties.class.php</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
