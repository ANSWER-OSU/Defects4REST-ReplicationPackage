<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>23227</ISSUENO>
  <ISSUEURL>https://github.com/Dolibarr/dolibarr/issues/23227</ISSUEURL>
  <TITLE>Retrieve the last insert id for a tag link breaks the import with PostgreSQL</TITLE>
  <DESCRIPTION>### Bug With a PostgreSQL database, when we we do an import simulation of a tag link (e.g. between a tag and a supllier), Dolibarr try to retrieve the last insert id of the SQL transaction. Since the insertion will be done in an association table, this cannot work. ### Environment Version 16 ### Environment OS Debian 10.13 ### Environment Web server Apache/2.4.38 ### Environment PHP 8.1.11 ### Environment Database PostgreSQL 14.4 ### Environment URL(s) /imports/import.php ### Expected and actual behavior **Expected behavior:** It should import the tag links. **Actual behavior:** It return an error like: ``` ERROR: 42P01: relation &quot;llx_categorie_fournisseur_rowid_seq&quot; does not exist LINE 1: SELECT currval('llx_categorie_fournisseur_rowid_seq') ^ LOCATION: RangeVarGetRelidExtended, namespace.c:433 ``` ### Steps to reproduce the behavior Import a tag link. ### Attached files _No response_</DESCRIPTION>
  <REPONAME>dolibarr</REPONAME>
  <TIMEDIFFERENCEDAYS>4</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Clean: sall/search_all become search_all for all quick searches.</MESSAGE>
    <SHA>1033991486a43bda029873b46a187189a5b0f38e</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>FIX #23227 Don't retrieve the last insert id during a tag link import</MESSAGE>
      <SHA>51ac803aee203d8f535e876e5903503f4bd2f264</SHA>
      <PATCHEDFILES>
        <FILE>htdocs/core/modules/import/import_csv.modules.php</FILE>
        <FILE>htdocs/core/modules/import/import_xlsx.modules.php</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Merge pull request #23228 from FlorentPoinsaut/patch-1 FIX #23227 Don't retrieve the last insert id during a tag link import</MESSAGE>
      <SHA>55e4ab2e23219b8b8b05321e9edcb48e55d46fd7</SHA>
      <PATCHEDFILES>
        <FILE>htdocs/core/modules/import/import_csv.modules.php</FILE>
        <FILE>htdocs/core/modules/import/import_xlsx.modules.php</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>FIX #23227 Don't retrieve the last insert id during a tag link import</MESSAGE>
      <SHA>5d0bf711005cea6ff87ed3b06540217381cd0412</SHA>
      <PATCHEDFILES>
        <FILE>htdocs/core/modules/import/import_csv.modules.php</FILE>
        <FILE>htdocs/core/modules/import/import_xlsx.modules.php</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
