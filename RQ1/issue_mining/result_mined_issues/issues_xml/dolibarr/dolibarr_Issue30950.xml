<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>30950</ISSUENO>
  <ISSUEURL>https://github.com/Dolibarr/dolibarr/issues/30950</ISSUEURL>
  <TITLE>Bad ref in supplier invoice created by Rest API from an invoice template</TITLE>
  <DESCRIPTION>### Bug When a supplier invoice is created from the Rest API with an invoice template, Dolibarr always add `_1` at the end of the ref. ### Dolibarr Version 19.0.1 ### Environment PHP _No response_ ### Environment Database _No response_ ### Steps to reproduce the behavior and expected behavior 1. Create an invoice template 2. Call the API with this body: ```json { &quot;date&quot;: &quot;1725235200&quot;, &quot;fac_rec&quot;: 1, &quot;ref_supplier&quot;: &quot;my_ref&quot;, &quot;socid&quot;: 1 } ``` ### Attached files _No response_</DESCRIPTION>
  <REPONAME>dolibarr</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge branch 'develop' of git@github.com:Dolibarr/dolibarr.git into develop</MESSAGE>
    <SHA>04ebf52bd04912b1ce19a5ac061ad1c388f785b2</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>FIX #30950 Bad ref in supplier invoice created by Rest API from an invoice template</MESSAGE>
      <SHA>e23eb9477d697078cead9520f2d470fa340d3883</SHA>
      <PATCHEDFILES>
        <FILE>htdocs/fourn/class/fournisseur.facture.class.php</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>FIX #30950 Bad ref in supplier invoice created by Rest API from an invoice template (#30951)</MESSAGE>
      <SHA>b4bcb243c08212a6090c715846316279da4859f5</SHA>
      <PATCHEDFILES>
        <FILE>htdocs/fourn/class/fournisseur.facture.class.php</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
