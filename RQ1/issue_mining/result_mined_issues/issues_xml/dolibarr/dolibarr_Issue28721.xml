<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>28721</ISSUENO>
  <ISSUEURL>https://github.com/Dolibarr/dolibarr/issues/28721</ISSUEURL>
  <TITLE>Ticket update function sets fk_statut to NULL</TITLE>
  <DESCRIPTION>### Bug The default value for fk_statut is set to null when it appears it ought to be set to zero(0). Ticket::update function: $sql .= &quot; fk_statut=&quot;.(isset($this-&gt;fk_statut) ? $this-&gt;fk_statut : &quot;null&quot;).&quot;,&quot;; Ticket::create function: $sql .= &quot; &quot;.(!isset($this-&gt;fk_statut) ? '0' : &quot;'&quot;.$this-&gt;db-&gt;escape($this-&gt;fk_statut).&quot;'&quot;).&quot;,&quot;; ### Dolibarr Version 18.0 ### Environment PHP PHP 7.x ### Environment Database 10.11.3-MariaDB-1 - Debian 12 ### Steps to reproduce the behavior and expected behavior Perform an update to a ticket that was just created using the &quot;$object&quot;. For example, I have an extra field named &quot;latestactivity&quot;. $object-&gt;array_options['options_latestactivity'] = $this-&gt;db-&gt;idate(dol_now()); $object-&gt;update($user, 1); // update with no trigger. ### Attached files _No response_</DESCRIPTION>
  <REPONAME>dolibarr</REPONAME>
  <TIMEDIFFERENCEDAYS>1</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Fix: Initialise array before assigning values (#28728) * Qual: Enable PhanUndeclaredVariableDim # Qual: Enable PhanUndeclaredVariableDim The notifications are fixed in the code so the detection no longer needs to be suppressed in the default flow * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Fix: initialise array before adding fields * Qual: Add type hint to array to avoid phan notification * Qual: Add type hint to array to avoid phan notification * Qual: Enable PhanParamSpecial1 (all resolved) * Qual: Ignore false PhanTypeArraySuspiciousNullable * Qual: Improve typing to fix PhanTypeArraySuspicious * Qual: Fix PhanTypeArraySuspicious by replacing null assignment with empty array * Qual: Fix PhanTypeArraySuspicious by testing as instancof DebugBar * Qual: Fix PhanTypeComparisonToArray with enhanced typing * Qual: Fix PhanTypeComparisonToArray with enhanced typing * Qual: Enable phan messages that no longer appear * Qual: Exclude phan stubs from codesniffer ruleset</MESSAGE>
    <SHA>0b19aa415c150f96d45ac90cc74970c8d48740ad</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Update ticket.class.php #28721 - Default for Ticket fk_statut in &quot;update&quot; function Correcting the default value for Ticket fk_statut to zero(0) instead of null based on the prescription from the create function.</MESSAGE>
      <SHA>ffc82296f546659491138402aa3e2a7b17985793</SHA>
      <PATCHEDFILES>
        <FILE>htdocs/ticket/class/ticket.class.php</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Update ticket.class.php #28721 - Default for Ticket fk_statut in &quot;update&quot; function (#28731) Correcting the default value for Ticket fk_statut to zero(0) instead of null based on the prescription from the create function.</MESSAGE>
      <SHA>ce30ccb004085c1709b8091cc502196afb23966d</SHA>
      <PATCHEDFILES>
        <FILE>htdocs/ticket/class/ticket.class.php</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
