<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>31374</ISSUENO>
  <ISSUEURL>https://github.com/Dolibarr/dolibarr/issues/31374</ISSUEURL>
  <TITLE>Bug: Sort by Type d'entité légale crashes</TITLE>
  <DESCRIPTION>### Bug Version: 20.0.1 Hello, In Tiers &gt; Liste Dolibarr is crashing when I try to sort by Type d'entité légale ``` Requête dernier accès en base en erreur: SELECT s.rowid, s.nom as name, s.name_alias, s.barcode, s.address, s.town, s.zip, s.datec, s.code_client, s.code_fournisseur, s.logo, s.entity, st.libelle as stcomm, st.picto as stcomm_picto, s.fk_stcomm as stcomm_id, s.fk_prospectlevel, s.prefix_comm, s.client, s.fournisseur, s.canvas, s.status as status, s.email, s.phone, s.phone_mobile, s.fax, s.url, s.siren as idprof1, s.siret as idprof2, s.ape as idprof3, s.idprof4 as idprof4, s.idprof5 as idprof5, s.idprof6 as idprof6, s.tva_intra, s.fk_pays, s.tms as date_modification, s.datec as date_creation, s.import_key, s.code_compta, s.code_compta_fournisseur, s.parent as fk_parent,s.price_level, s2.nom as name2, typent.code as typent_code, staff.code as staff_code, s.fk_forme_juridique as legalform_code, country.code as country_code, country.label as country_label, state.code_departement as state_code, state.nom as state_name, region.code_region as region_code, region.nom as region_name FROM llx_societe as s LEFT JOIN llx_societe as s2 ON s.parent = s2.rowid LEFT JOIN llx_c_country as country on (country.rowid = s.fk_pays) LEFT JOIN llx_c_typent as typent on (typent.id = s.fk_typent) LEFT JOIN llx_c_effectif as staff on (staff.id = s.fk_effectif) LEFT JOIN llx_c_departements as state on (state.rowid = s.fk_departement) LEFT JOIN llx_c_regions as region on (region.code_region = state.fk_region) LEFT JOIN llx_c_stcomm as st ON s.fk_stcomm = st.id WHERE s.entity IN (1) AND (s.status IN (1)) ORDER BY legalform.code ASC LIMIT 51 Code retour dernier accès en base en erreur: DB_ERROR_NOSUCHFIELD Information sur le dernier accès en base en erreur: Unknown column 'legalform.code' in 'order clause' ``` The problem is just after ORDER BY it's written legalform.code whereas earlier in the query it's s.fk_forme_juridique as legalform_code with an underscore so the correct query is `ORDER BY legalform_code` I don't know where to modify the code, so I open the ticket. ### Dolibarr Version 20.0.1 ### Environment PHP _No response_ ### Environment Database _No response_ ### Steps to reproduce the behavior and expected behavior _No response_ ### Attached files _No response_</DESCRIPTION>
  <REPONAME>dolibarr</REPONAME>
  <TIMEDIFFERENCEDAYS>1</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>CSS</MESSAGE>
    <SHA>ffcc1ee11cca714ce946784d66116c63cca1ea05</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>fix sql close #31374</MESSAGE>
      <SHA>4bd9a35844d4c9b25a90b69643533138ba84f9b7</SHA>
      <PATCHEDFILES>
        <FILE>htdocs/societe/list.php</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>fix sql close #31374 (#31379)</MESSAGE>
      <SHA>24722c10cf2d41ade756ce6e23940a732c5327ea</SHA>
      <PATCHEDFILES>
        <FILE>htdocs/societe/list.php</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
