<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>23415</ISSUENO>
  <ISSUEURL>https://github.com/Dolibarr/dolibarr/issues/23415</ISSUEURL>
  <TITLE>REST BOM API - It's able to have a wrong value on the 'ref' Field</TITLE>
  <DESCRIPTION>### Bug It's able to have a wrong value on the 'ref' Field by adding or updating a BOM. ### Environment Version 18 ### Environment OS _No response_ ### Environment Web server _No response_ ### Environment PHP PHP 8.1.10 ### Environment Database _No response_ ### Environment URL(s) _No response_ ### Expected and actual behavior **Actual behavior / Problems:** - **If you update a BOM with the API you can change the the status from DRAFT to a other Status, with the same ref e.g. '(PROV54)'** - Currently the 'ref' Field is required. So you can not use the Dolibarr NextNum Generator. **Expected behavior** - If no 'ref' is set on create and the status is 0 (DRAFT) then create a ref '(PROF...)'. - If no 'ref' is set on create and the status is grater then &gt; 0, then create a 'ref' with number generator. - If 'ref' is set, use the value from the REST-Call. ### Steps to reproduce the behavior _No response_ ### Attached files _No response_</DESCRIPTION>
  <REPONAME>dolibarr</REPONAME>
  <TIMEDIFFERENCEDAYS>2</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Debug bad params</MESSAGE>
    <SHA>6df4795dedd2abe07b6f0a846ab74ed99ec5af5a</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fix: #23415 correct numbering on 'ref'.</MESSAGE>
      <SHA>78b12c8298ca412e5ddd1c5d193fccdd9ee7fd41</SHA>
      <PATCHEDFILES>
        <FILE>htdocs/bom/class/api_boms.class.php</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Merge pull request #23416 from Humml87/develop_REST_BOM_Ref_NextNum Fix: #23415 REST BOM API - It's able to have a wrong value on the 'ref' Field</MESSAGE>
      <SHA>93f5c69b1c66f57784af9311f9284604b7d45e02</SHA>
      <PATCHEDFILES>
        <FILE>htdocs/bom/class/api_boms.class.php</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fix: #23415 correct numbering on 'ref'.</MESSAGE>
      <SHA>75a29a40f33fc8679a75e6ad5a84be2db7eb086c</SHA>
      <PATCHEDFILES>
        <FILE>htdocs/bom/class/api_boms.class.php</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
