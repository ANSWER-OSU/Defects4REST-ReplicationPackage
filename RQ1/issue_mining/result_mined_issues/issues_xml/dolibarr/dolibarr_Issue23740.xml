<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>23740</ISSUENO>
  <ISSUEURL>https://github.com/Dolibarr/dolibarr/issues/23740</ISSUEURL>
  <TITLE>pgsql: function sum(character varying) does not exist</TITLE>
  <DESCRIPTION>### Bug Error messages in /ticket/stats/index.php?idmenu=5525&amp;mainmenu=ticket&amp;leftmenu= Upgraded from 13.0.3 via 14.0.5 and 15.0.5 to 16.0.3 ### Environment Version 16.0.3 ### Environment OS Debian 11 ### Environment Web server Apache 2.4.54-1 ### Environment PHP 7.4.33 ### Environment Database psql (13.9 (Debian 13.9-0+deb11u1), server 9.6.15) ### Environment URL(s) /ticket/stats/index.php ### Expected and actual behavior Display ticket statistiks for never used statistik module... Errors on top: Das System hat einen technischen Fehler festgestellt. Diese Informationen können für Diagnosezwecke nützlich sein (Sie können die Option $dolibarr_main_prod auf '1' setzen, um sensible Informationen auszublenden): Datum: 20230131185547 Dolibarr: 16.0.3 - https://www.dolibarr.org Funktionslevel: 0 PHP: 7.4.33 Server: Apache OS: Linux server 5.10.0-15-amd64 #1 SMP Debian 5.10.120-1 (2022-06-09) x86_64 UserAgent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/109.0 Angefragte URL: /erp/ticket/stats/index.php?idmenu=5525&amp;mainmenu=ticket&amp;leftmenu= Referer: https://server/erp/ticket/list.php?mode=mine&amp;search_fk_status=non_closed&amp;idmenu=5524&amp;mainmenu=ticket&amp;leftmenu= Menüverwaltung: eldy_menu.php Module/Anwendungen: user, syslog, accounting, banque, cron, commande, clicktodial, notification, fckeditor, facture, service, product, tax, import, projet, workflow, societe, ticket, agenda Datenbank Type Manager: pgsql Letzter Fehlerhafter Datenbankzugriff: SELECT date_format(datec,'%m') as dm, sum(timing) FROM llx_ticket WHERE date_format(datec,'%Y') = '2021' AND fk_statut &gt; 0 AND entity = 1 GROUP BY dm ORDER BY dm DESC Rückgabewert des letzten fehlerhaften Datenbankzugriff: DB_ERROR_42883 Information zum letzten fehlerhaften Datenbankzugriff: ERROR: 42883: function sum(character varying) does not exist\nLINE 1: SELECT date_format(datec,'%m') as dm, sum(timing) FROM llx_t...\n ^\nHINT: No function matches the given name and argument types. You might need to add explicit type casts.\nLOCATION: ParseFuncOrColumn, parse_func.c:523 Das System hat einen technischen Fehler festgestellt. Diese Informationen können für Diagnosezwecke nützlich sein (Sie können die Option $dolibarr_main_prod auf '1' setzen, um sensible Informationen auszublenden): Datum: 20230131185547 Dolibarr: 16.0.3 - https://www.dolibarr.org Funktionslevel: 0 PHP: 7.4.33 Server: Apache OS: Linux server 5.10.0-15-amd64 #1 SMP Debian 5.10.120-1 (2022-06-09) x86_64 UserAgent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/109.0 Angefragte URL: /erp/ticket/stats/index.php?idmenu=5525&amp;mainmenu=ticket&amp;leftmenu= Referer: https://server/erp/ticket/list.php?mode=mine&amp;search_fk_status=non_closed&amp;idmenu=5524&amp;mainmenu=ticket&amp;leftmenu= Menüverwaltung: eldy_menu.php Module/Anwendungen: user, syslog, accounting, banque, cron, commande, clicktodial, notification, fckeditor, facture, service, product, tax, import, projet, workflow, societe, ticket, agenda Datenbank Type Manager: pgsql Letzter Fehlerhafter Datenbankzugriff: SELECT date_format(datec,'%m') as dm, sum(timing) FROM llx_ticket WHERE date_format(datec,'%Y') = '2022' AND fk_statut &gt; 0 AND entity = 1 GROUP BY dm ORDER BY dm DESC Rückgabewert des letzten fehlerhaften Datenbankzugriff: DB_ERROR_42883 Information zum letzten fehlerhaften Datenbankzugriff: ERROR: 42883: function sum(character varying) does not exist\nLINE 1: SELECT date_format(datec,'%m') as dm, sum(timing) FROM llx_t...\n ^\nHINT: No function matches the given name and argument types. You might need to add explicit type casts.\nLOCATION: ParseFuncOrColumn, parse_func.c:523 Das System hat einen technischen Fehler festgestellt. Diese Informationen können für Diagnosezwecke nützlich sein (Sie können die Option $dolibarr_main_prod auf '1' setzen, um sensible Informationen auszublenden): Datum: 20230131185547 Dolibarr: 16.0.3 - https://www.dolibarr.org Funktionslevel: 0 PHP: 7.4.33 Server: Apache OS: Linux server 5.10.0-15-amd64 #1 SMP Debian 5.10.120-1 (2022-06-09) x86_64 UserAgent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/109.0 Angefragte URL: /erp/ticket/stats/index.php?idmenu=5525&amp;mainmenu=ticket&amp;leftmenu= Referer: https://server/erp/ticket/list.php?mode=mine&amp;search_fk_status=non_closed&amp;idmenu=5524&amp;mainmenu=ticket&amp;leftmenu= Menüverwaltung: eldy_menu.php Module/Anwendungen: user, syslog, accounting, banque, cron, commande, clicktodial, notification, fckeditor, facture, service, product, tax, import, projet, workflow, societe, ticket, agenda Datenbank Type Manager: pgsql Letzter Fehlerhafter Datenbankzugriff: SELECT date_format(datec,'%m') as dm, sum(timing) FROM llx_ticket WHERE date_format(datec,'%Y') = '2023' AND fk_statut &gt; 0 AND entity = 1 GROUP BY dm ORDER BY dm DESC Rückgabewert des letzten fehlerhaften Datenbankzugriff: DB_ERROR_42883 Information zum letzten fehlerhaften Datenbankzugriff: ERROR: 42883: function sum(character varying) does not exist\nLINE 1: SELECT date_format(datec,'%m') as dm, sum(timing) FROM llx_t...\n ^\nHINT: No function matches the given name and argument types. You might need to add explicit type casts.\nLOCATION: ParseFuncOrColumn, parse_func.c:523 Das System hat einen technischen Fehler festgestellt. Diese Informationen können für Diagnosezwecke nützlich sein (Sie können die Option $dolibarr_main_prod auf '1' setzen, um sensible Informationen auszublenden): Datum: 20230131185547 Dolibarr: 16.0.3 - https://www.dolibarr.org Funktionslevel: 0 PHP: 7.4.33 Server: Apache OS: Linux server 5.10.0-15-amd64 #1 SMP Debian 5.10.120-1 (2022-06-09) x86_64 UserAgent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/109.0 Angefragte URL: /erp/ticket/stats/index.php?idmenu=5525&amp;mainmenu=ticket&amp;leftmenu= Referer: https://server/erp/ticket/list.php?mode=mine&amp;search_fk_status=non_closed&amp;idmenu=5524&amp;mainmenu=ticket&amp;leftmenu= Menüverwaltung: eldy_menu.php Module/Anwendungen: user, syslog, accounting, banque, cron, commande, clicktodial, notification, fckeditor, facture, service, product, tax, import, projet, workflow, societe, ticket, agenda Datenbank Type Manager: pgsql Letzter Fehlerhafter Datenbankzugriff: SELECT date_format(datec,'%m') as dm, avg(timing) FROM llx_ticket WHERE date_format(datec,'%Y') = '2021' AND fk_statut &gt; 0 AND entity = 1 GROUP BY dm ORDER BY dm DESC Rückgabewert des letzten fehlerhaften Datenbankzugriff: DB_ERROR_42883 Information zum letzten fehlerhaften Datenbankzugriff: ERROR: 42883: function avg(character varying) does not exist\nLINE 1: SELECT date_format(datec,'%m') as dm, avg(timing) FROM llx_t...\n ^\nHINT: No function matches the given name and argument types. You might need to add explicit type casts.\nLOCATION: ParseFuncOrColumn, parse_func.c:523 Das System hat einen technischen Fehler festgestellt. Diese Informationen können für Diagnosezwecke nützlich sein (Sie können die Option $dolibarr_main_prod auf '1' setzen, um sensible Informationen auszublenden): Datum: 20230131185547 Dolibarr: 16.0.3 - https://www.dolibarr.org Funktionslevel: 0 PHP: 7.4.33 Server: Apache OS: Linux server 5.10.0-15-amd64 #1 SMP Debian 5.10.120-1 (2022-06-09) x86_64 UserAgent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/109.0 Angefragte URL: /erp/ticket/stats/index.php?idmenu=5525&amp;mainmenu=ticket&amp;leftmenu= Referer: https://server/erp/ticket/list.php?mode=mine&amp;search_fk_status=non_closed&amp;idmenu=5524&amp;mainmenu=ticket&amp;leftmenu= Menüverwaltung: eldy_menu.php Module/Anwendungen: user, syslog, accounting, banque, cron, commande, clicktodial, notification, fckeditor, facture, service, product, tax, import, projet, workflow, societe, ticket, agenda Datenbank Type Manager: pgsql Letzter Fehlerhafter Datenbankzugriff: SELECT date_format(datec,'%m') as dm, avg(timing) FROM llx_ticket WHERE date_format(datec,'%Y') = '2022' AND fk_statut &gt; 0 AND entity = 1 GROUP BY dm ORDER BY dm DESC Rückgabewert des letzten fehlerhaften Datenbankzugriff: DB_ERROR_42883 Information zum letzten fehlerhaften Datenbankzugriff: ERROR: 42883: function avg(character varying) does not exist\nLINE 1: SELECT date_format(datec,'%m') as dm, avg(timing) FROM llx_t...\n ^\nHINT: No function matches the given name and argument types. You might need to add explicit type casts.\nLOCATION: ParseFuncOrColumn, parse_func.c:523 Das System hat einen technischen Fehler festgestellt. Diese Informationen können für Diagnosezwecke nützlich sein (Sie können die Option $dolibarr_main_prod auf '1' setzen, um sensible Informationen auszublenden): Datum: 20230131185547 Dolibarr: 16.0.3 - https://www.dolibarr.org Funktionslevel: 0 PHP: 7.4.33 Server: Apache OS: Linux server 5.10.0-15-amd64 #1 SMP Debian 5.10.120-1 (2022-06-09) x86_64 UserAgent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/109.0 Angefragte URL: /erp/ticket/stats/index.php?idmenu=5525&amp;mainmenu=ticket&amp;leftmenu= Referer: https://server/erp/ticket/list.php?mode=mine&amp;search_fk_status=non_closed&amp;idmenu=5524&amp;mainmenu=ticket&amp;leftmenu= Menüverwaltung: eldy_menu.php Module/Anwendungen: user, syslog, accounting, banque, cron, commande, clicktodial, notification, fckeditor, facture, service, product, tax, import, projet, workflow, societe, ticket, agenda Datenbank Type Manager: pgsql Letzter Fehlerhafter Datenbankzugriff: SELECT date_format(datec,'%m') as dm, avg(timing) FROM llx_ticket WHERE date_format(datec,'%Y') = '2023' AND fk_statut &gt; 0 AND entity = 1 GROUP BY dm ORDER BY dm DESC Rückgabewert des letzten fehlerhaften Datenbankzugriff: DB_ERROR_42883 Information zum letzten fehlerhaften Datenbankzugriff: ERROR: 42883: function avg(character varying) does not exist\nLINE 1: SELECT date_format(datec,'%m') as dm, avg(timing) FROM llx_t...\n ^\nHINT: No function matches the given name and argument types. You might need to add explicit type casts.\nLOCATION: ParseFuncOrColumn, parse_func.c:523 Das System hat einen technischen Fehler festgestellt. Diese Informationen können für Diagnosezwecke nützlich sein (Sie können die Option $dolibarr_main_prod auf '1' setzen, um sensible Informationen auszublenden): Datum: 20230131185547 Dolibarr: 16.0.3 - https://www.dolibarr.org Funktionslevel: 0 PHP: 7.4.33 Server: Apache OS: Linux server 5.10.0-15-amd64 #1 SMP Debian 5.10.120-1 (2022-06-09) x86_64 UserAgent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/109.0 Angefragte URL: /erp/ticket/stats/index.php?idmenu=5525&amp;mainmenu=ticket&amp;leftmenu= Referer: https://server/erp/ticket/list.php?mode=mine&amp;search_fk_status=non_closed&amp;idmenu=5524&amp;mainmenu=ticket&amp;leftmenu= Menüverwaltung: eldy_menu.php Module/Anwendungen: user, syslog, accounting, banque, cron, commande, clicktodial, notification, fckeditor, facture, service, product, tax, import, projet, workflow, societe, ticket, agenda Datenbank Type Manager: pgsql Letzter Fehlerhafter Datenbankzugriff: SELECT date_format(datec,'%Y') as year, count(*) as nb, sum(timing) as total, avg(timing) as avg FROM llx_ticket WHERE fk_statut &gt; 0 AND entity = 1 GROUP BY year ORDER BY year DESC Rückgabewert des letzten fehlerhaften Datenbankzugriff: DB_ERROR_42883 Information zum letzten fehlerhaften Datenbankzugriff: ERROR: 42883: function sum(character varying) does not exist\nLINE 1: ... date_format(datec,'%Y') as year, count(*) as nb, sum(timing...\n ^\nHINT: No function matches the given name and argument types. You might need to add explicit type casts.\nLOCATION: ParseFuncOrColumn, parse_func.c:523 ### Steps to reproduce the behavior Open statistik page of ticket module ### Attached files [dolibar.log.txt](https://github.com/Dolibarr/dolibarr/files/10549969/dolibar.log.txt)</DESCRIPTION>
  <REPONAME>dolibarr</REPONAME>
  <TIMEDIFFERENCEDAYS>135</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #25054 from FHenry/15_fix_css fix: css declaration</MESSAGE>
    <SHA>e26bfb40631a12facf6afb9803ef5bb8242ee47f</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fix #23740 ticket stats can't show amounts</MESSAGE>
      <SHA>e6b8f7271e9265333191a3b37ec91a963ee4bef5</SHA>
      <PATCHEDFILES>
        <FILE>htdocs/ticket/stats/index.php</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Merge pull request #25071 from atm-maxime/fix_ticket_stats_wrongsql Fix #23740 ticket stats can't show amounts</MESSAGE>
      <SHA>9948e4585d4031c7f93d2d6219e2cefb41ce0073</SHA>
      <PATCHEDFILES>
        <FILE>htdocs/ticket/stats/index.php</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
