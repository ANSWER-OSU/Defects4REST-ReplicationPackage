<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>23281</ISSUENO>
  <ISSUEURL>https://github.com/Dolibarr/dolibarr/issues/23281</ISSUEURL>
  <TITLE>Bug: Error when deselecting default permissions</TITLE>
  <DESCRIPTION>### Bug When you try to delete a default permission under Setup -&gt; Security, you get an error. Access to this page this way (POST method or GET with a sensible value for 'action' parameter) is refused by CSRF protection in main.inc.php. Token not provided. If you access your server behind a proxy using url rewriting and the parameter is provided by caller, you might check that all HTTP header are propagated (or add the line $dolibarr_nocsrfcheck=1 into your conf.php file or MAIN_SECURITY_CSRF_WITH_TOKEN to 0 instead of 2 into setup). ### Environment Version Dolibarr 16.0.3 ### Environment OS Mac OS 13.0 ### Environment Web server Apache 2.4.46 ### Environment PHP PHP 7.4.21 ### Environment Database MySQL 5.7.34 ### Environment URL(s) /admin/perms.php ### Expected and actual behavior In version 16.0.3, if you do not have MAIN_SECURITY_CSRF_WITH_TOKEN = 1 defined, you will get an error message when you try to disable a default permission. I would imagine that you should be able to disable a default permission, with or without the MAIN_SECURITY_CSRF_WITH_TOKEN constant. ### Steps to reproduce the behavior Remove MAIN_SECURITY_CSRF_WITH_TOKEN from the Other Setup items. Enable and then disable a default permission under Setup -&gt; Security. ### Attached files _No response_</DESCRIPTION>
  <REPONAME>dolibarr</REPONAME>
  <TIMEDIFFERENCEDAYS>6</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge branch '16.0' of git@github.com:Dolibarr/dolibarr.git into 17.0</MESSAGE>
    <SHA>088e70a9db0b7e564960b420ecc06a02d83300ee</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>FIX #23281</MESSAGE>
      <SHA>3bc86c48417aa6831d537e96aabc1f714adc1dcc</SHA>
      <PATCHEDFILES>
        <FILE>htdocs/admin/perms.php</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Merge pull request #23312 from ksar-ksar/patch-19 FIX #23281</MESSAGE>
      <SHA>6cb364faf898ea7e446a9d515b7d88e8c46735a5</SHA>
      <PATCHEDFILES>
        <FILE>htdocs/admin/perms.php</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
