<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>27203</ISSUENO>
  <ISSUEURL>https://github.com/Dolibarr/dolibarr/issues/27203</ISSUEURL>
  <TITLE>Avoid ugly messages / eventMessage not displayed</TITLE>
  <DESCRIPTION>### Bug If a plugin or another core bug send to setEventMessage something which's not a string, you'll see an ugly message in the footer like `Fatal error: Uncaught TypeError: preg_match(): Argument #2 ($subject) must be of type string, __PHP_Incomplete_Class given in /home/asheuroptw/erpdev/htdocs/core/lib/functions.lib.php:8309 Stack trace: #0 /home/asheuroptw/erpdev/htdocs/core/lib/functions.lib.php(8309): preg_match(‹ /class=« error »/… ›, Object(__PHP_Incomplete_Class)) #1 /home/asheuroptw/erpdev/htdocs/core/lib/functions.lib.php(8184): dol_htmloutput_mesg(‹ ›, Array, ‹ error ›) #2 /home/asheuroptw/erpdev/htdocs/main.inc.php(3182): dol_htmloutput_events(0) #3 /home/asheuroptw/erpdev/htdocs/compta/facture/card.php(5762): llxFooter() #4 {main} thrown in /home/asheuroptw/erpdev/htdocs/core/lib/functions.lib.php on line 8309` And the other Eventmessages, even if ther'e Ok, are not displayed That's because the type of string message isn't controlled ### Environment Version All ### Environment OS All ### Environment Web server _No response_ ### Environment PHP _No response_ ### Environment Database _No response_ ### Environment URL(s) _No response_ ### Expected and actual behavior _No response_ ### Steps to reproduce the behavior _No response_ ### Attached files _No response_</DESCRIPTION>
  <REPONAME>dolibarr</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Fix css</MESSAGE>
    <SHA>6f721a4704ac7af0d4440ffb29df736ebe532fad</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fix #27203 avoid ugly messages</MESSAGE>
      <SHA>e7071dd8c43a881831124f2155e33a769c2cb892</SHA>
      <PATCHEDFILES>
        <FILE>htdocs/core/lib/functions.lib.php</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fix #27203 avoid ugly messages</MESSAGE>
      <SHA>b5d4b53597766a85d163294cd258c4bacda561c1</SHA>
      <PATCHEDFILES>
        <FILE>htdocs/core/lib/functions.lib.php</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fix #27203 avoid ugly messages</MESSAGE>
      <SHA>dc74eaa3fc5dce1022bf2357429b2aab32fc2110</SHA>
      <PATCHEDFILES>
        <FILE>htdocs/core/lib/functions.lib.php</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Merge pull request #27204 from vmaury/fix_27203_uglymessages Fix #27203 avoid ugly messages</MESSAGE>
      <SHA>75be304b848c3d1519f776e45d5b6cdd7ebe95ad</SHA>
      <PATCHEDFILES>
        <FILE>htdocs/core/lib/functions.lib.php</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
