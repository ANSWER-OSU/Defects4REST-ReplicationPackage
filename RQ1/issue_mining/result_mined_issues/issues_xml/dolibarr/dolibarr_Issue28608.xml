<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>28608</ISSUENO>
  <ISSUEURL>https://github.com/Dolibarr/dolibarr/issues/28608</ISSUEURL>
  <TITLE>COMMERCIAL PROPOSAL NUMBERING \</TITLE>
  <DESCRIPTION>### Bug Greetings to the team that provides us end user with a great product, thank you! Commercial proposal numbering and online signature. Reproduced in both 18.0.4 in production and 19.0.0 in test, I made a discover regarding Commercial proposal numbering and online signature. In configuration of the “COMMERCIAL PROPOSALS MODULE SETUP», I have added a numbering mask containing a space: Proposal {000+22}. This works fine in all other modules and situations, except from tab, Commercial proposal and Link for online signature. In line 77 of the code of /core/lib/signature.lib.php, there is a str_replace. To me it looks like it removes space/blank in the proposal ref. When this blank/space is removed, the online signature form fails in displaying all the information. ### Dolibarr Version 19.0 develop ### Environment PHP 8.1.27 ### Environment Database MySQL or MariaDB 5.7.44-cll-lve ### Steps to reproduce the behavior and expected behavior If the mask of Commercial proposal numbering contains a blank/white space, then the online signature form does not show the name of the customer and amount. ### Attached files [Setup COMMERCIAL PROPOSAL NUMBERING MODELS.pdf](https://github.com/Dolibarr/dolibarr/files/14474153/Setup.COMMERCIAL.PROPOSAL.NUMBERING.MODELS.pdf)</DESCRIPTION>
  <REPONAME>dolibarr</REPONAME>
  <TIMEDIFFERENCEDAYS>7</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>css</MESSAGE>
    <SHA>581378f24d8ed57fd9f678bff906a86e0b649007</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Update signature.lib.php Fix for #28608 28608</MESSAGE>
      <SHA>0854f272153fbb5f4bda03239600de0d06cc4f30</SHA>
      <PATCHEDFILES>
        <FILE>htdocs/core/lib/signature.lib.php</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Update payments.lib.php Fix for #28608</MESSAGE>
      <SHA>e310ecfa39537b5d71eccdec061a2984b95af495</SHA>
      <PATCHEDFILES>
        <FILE>htdocs/core/lib/payments.lib.php</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>FIX: online signature (#28608) Update signature.lib.php If Commercial proposal numbering contains a mask that’s includes a space, that will affect the result of the online signature form. When generating the online signature form, the code in signature.lib.php line 77, will remove any existing space in the Commercial proposal numbering. The result is that the online signature form will miss data in field “Third-party” and “Amount”.</MESSAGE>
      <SHA>6573b5a89d6db403b14f299167e6ed0ce8eec2f5</SHA>
      <PATCHEDFILES>
        <FILE>htdocs/core/lib/signature.lib.php</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>FIX: online signature (#28608) Update payments.lib.php If Commercial proposal numbering contains a mask that’s includes a space, that will affect the result of the online signature form. When generating the online signature form, the code in core/lib/payments.lib.ph, will remove any existing space in the Commercial proposal numbering.</MESSAGE>
      <SHA>b7ebabcf6503567e7e8b2831afcad59719fe256e</SHA>
      <PATCHEDFILES>
        <FILE>htdocs/core/lib/payments.lib.php</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>FIX: online signature partly fails if commercial proposal numbering contains a mask that’s includes a space (#28608) (#28742) * FIX: online signature (#28608) Update signature.lib.php If Commercial proposal numbering contains a mask that’s includes a space, that will affect the result of the online signature form. When generating the online signature form, the code in signature.lib.php line 77, will remove any existing space in the Commercial proposal numbering. The result is that the online signature form will miss data in field “Third-party” and “Amount”. * FIX: online signature (#28608) Update payments.lib.php If Commercial proposal numbering contains a mask that’s includes a space, that will affect the result of the online signature form. When generating the online signature form, the code in core/lib/payments.lib.ph, will remove any existing space in the Commercial proposal numbering.</MESSAGE>
      <SHA>a8a2f0ff7308ca478251999da63950d4f1c02374</SHA>
      <PATCHEDFILES>
        <FILE>htdocs/core/lib/payments.lib.php</FILE>
        <FILE>htdocs/core/lib/signature.lib.php</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
