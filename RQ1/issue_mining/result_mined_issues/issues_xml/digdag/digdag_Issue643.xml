<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>643</ISSUENO>
  <ISSUEURL>https://github.com/treasure-data/digdag/issues/643</ISSUEURL>
  <TITLE>symbolic link causes NoSuchFileException</TITLE>
  <DESCRIPTION>after creating a symbolic link(no job is calling symbolic link, seems might be somewhere with verifying files), in Web UI, getting errors below: &gt; 2017-09-06 12:16:10.169 +1000 [ERROR] (0088@[0:testing]+testing+testing+job1) io.digdag.core.agent.OperatorManager: Task failed with unexpected error: /tmp/digdag-tempdir1542790697699403398/workspace/+testing+testing+job1_1760033870796559295/0.sh &gt; java.nio.file.NoSuchFileException: /tmp/digdag-tempdir1542790697699403398/workspace/+testing+testing+job1_1760033870796559295/0.sh &gt; at sun.nio.fs.UnixException.translateToIOException(UnixException.java:86) &gt; at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:102) &gt; at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:107) &gt; at sun.nio.fs.UnixFileAttributeViews$Posix.setMode(UnixFileAttributeViews.java:238) &gt; at sun.nio.fs.UnixFileAttributeViews$Posix.setPermissions(UnixFileAttributeViews.java:260) &gt; at java.nio.file.Files.setPosixFilePermissions(Files.java:2045) &gt; at io.digdag.core.archive.ProjectArchives.extractArchive(ProjectArchives.java:82) &gt; at io.digdag.core.archive.ProjectArchives.extractTarArchive(ProjectArchives.java:40) &gt; at io.digdag.core.archive.ProjectArchives.extractTarArchive(ProjectArchives.java:33) &gt; at io.digdag.core.agent.ExtractArchiveWorkspaceManager.withExtractedArchive(ExtractArchiveWorkspaceManager.java:34) &gt; at io.digdag.core.agent.OperatorManager.runWithHeartbeat(OperatorManager.java:135) &gt; at io.digdag.core.agent.OperatorManager.run(OperatorManager.java:119) &gt; at io.digdag.core.agent.MultiThreadAgent.lambda$null$0(MultiThreadAgent.java:127) &gt; at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) &gt; at java.util.concurrent.FutureTask.run(FutureTask.java:266) &gt; at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) &gt; at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) &gt; at java.lang.Thread.run(Thread.java:748) steps to replicate this issue: mkdir testing cd testing touch 1.sh ln -s ./1.sh 0.sh testing.dig ``` _export: workflow_name: workflow1 schedule: minutes_interval&gt;: 5 skip_on_overtime: true +testing: +job1: sh&gt;: ./1.sh ``` digdag push testing go to web UI, run it. digdag download also fails: &gt; digdag download testing &gt; 2017-09-06 12:19:25 +1000: Digdag v0.9.13 &gt; testing/testing.dig &gt; testing/0.sh -&gt; 1.sh &gt; error: /tmp/t2/testing/0.sh (no such file)</DESCRIPTION>
  <REPONAME>digdag</REPONAME>
  <TIMEDIFFERENCEDAYS>17</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #640 from treasure-data/add-contributors Add contributors to release notes</MESSAGE>
    <SHA>5d235dc9d281d2d50f6a2193ad2a312ec51d18ca</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Skip set permission if extract file is symlink. Fix #643. digdag download command sometimes extracts symbolic link file before extract regular file. In this case, NoSuchFileException raise. For avoiding it, skip set permission if the target is a symbolic link file.</MESSAGE>
      <SHA>42c83cd4ece7f6afca157f0ad647a0cceb9c5fdd</SHA>
      <PATCHEDFILES>
        <FILE>digdag-core/src/main/java/io/digdag/core/archive/ProjectArchives.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
