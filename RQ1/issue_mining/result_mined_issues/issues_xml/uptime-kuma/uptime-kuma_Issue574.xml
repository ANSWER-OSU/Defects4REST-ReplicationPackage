<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>574</ISSUENO>
  <ISSUEURL>https://github.com/louislam/uptime-kuma/issues/574</ISSUEURL>
  <TITLE>[Discussion][Dev] node-sqlite3 does not support worker_threads</TITLE>
  <DESCRIPTION>While trying to implement scheduled jobs (for auto clear old statistics), I ran into an issue with sqlite crashing in native code. Turns out sqlite3 &gt; 5.0 breaks when running in worker_threads (see [node-sqlite3#1381](https://github.com/mapbox/node-sqlite3/issues/1381)). So here are my options: - Drop the use of `worker_threads`. For me this isn't ideal. Although there isn't a strong need for running background jobs in another thread for now, any future CPU-intensive work (like generating reports) would benefit greatly from it. It also helps with modularization since we can ensure each background job acquire it's own db connection. But not using threading does have benefit of a more simple implementation. - Switch to `better-sqlite3`, since I tested it seems to work fine on a worker. From the READMEs it also looks like an all-round better library. Searching the repo I see that the project briefly switched to better-sqlite3 before switching back, but I don't know the reasoning behind. Is there any specific issues users encountered?</DESCRIPTION>
  <REPONAME>uptime-kuma</REPONAME>
  <TIMEDIFFERENCEDAYS>3</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge remote-tracking branch 'origin/master'</MESSAGE>
    <SHA>fef26f3d5e76b585f0d03f6e2e440e8b97a0e8ed</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>update modded node-sqlite3 to 6.0.0</MESSAGE>
      <SHA>a8badb027db309f02f53d0fd5e1dd543a0abfa5e</SHA>
      <PATCHEDFILES>
        <FILE>package-lock.json</FILE>
        <FILE>package.json</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
