<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>56</ISSUENO>
  <ISSUEURL>https://github.com/louislam/uptime-kuma/issues/56</ISSUEURL>
  <TITLE>Implementing the retries enhancement</TITLE>
  <DESCRIPTION>I've been looking at the code responsible for sending notifications when a service goes down mentioned in #21. It looks like this would be quite reasonable to implement, as such I am writing a draft and am curious to see if ends up being any good. I've had the issue many times now since using Uptime Kuma that my services get marked as down and I get a notification, when it was just a pinging issue. I would actually try and implement this myself if that is welcome, however I am currently quite busy and don't know if I can follow up in a timely enough matter before someone else picks it up. But making a draft is potentially helpful for the developer who ends up implementing it. The steps would pretty much include (if I'm not mistaken, I only had 30 min or so to look at the codebase) - **[BACKEND]** add a field to the monitor called &quot;maxRetries&quot; which holds the maximum amount of retries allowed before a service will go &quot;down&quot; and trigger notifications - **[BACKEND]** Create a new monitor.status value (for example `2`, indicating that the service is currently &quot;disrupted&quot;) - **[BACKEND]** keep track of the threshold by storing the amount of failed retries with the monitor ID in an array or KV data structure (easy) or in-memory database (more sophisticated). And also update the status to the new value (instead of it being `0` if the service has not reached `maxRetries`. I believe this should go here in the catch section of the polling try block https://github.com/louislam/uptime-kuma/blob/b3bff8d7357d75d3871aa68bc71db35dd79506a9/server/model/monitor.js#L112 - **[BACKEND]** make the modifications here and in similar places below https://github.com/louislam/uptime-kuma/blob/b3bff8d7357d75d3871aa68bc71db35dd79506a9/server/model/monitor.js#L121 to incorporate the notification triggering only when the threshold has been reached - **[FRONTEND]** Add the retries field to the monitor edit page - **[FRONTEND]** _Optional: Indicate that the service is potentially disrupted by displaying the retry count. This could add bloat to the UI experience, so not sure if that makes sense._ I also never worked with bean, so it's possible that a manual data migration would be necessary if a new field is added to the database. The documentation lists that bean [does not have migration? ](https://redbean-node.whatsticker.online/Migration) Does anyone know how @louislam is solving the migration task? I think this would describe the minimum valuable product. Using the configured monitor ping interval doesn't require too many changes and requires little modification in the codebase. What do you think? Also I apologize that this issue is such a mess, I accidentally hit enter instead of backspace when editing the title so I essentially had to write the draft while the issue already existed</DESCRIPTION>
  <REPONAME>uptime-kuma</REPONAME>
  <TIMEDIFFERENCEDAYS>5</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>fix if notification throw exception, the heartbeat is not stored in to the db.</MESSAGE>
    <SHA>03b3bb5b30a80e4970ebffee92225e71c7f6990e</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Merge pull request #86 from Spiritreader/master Implement retries (#56)</MESSAGE>
      <SHA>248b5292dc34386184d08b4a74a380f7a0690724</SHA>
      <PATCHEDFILES>
        <FILE>.dockerignore</FILE>
        <FILE>.gitignore</FILE>
        <FILE>db/kuma.db</FILE>
        <FILE>db/patch3.sql</FILE>
        <FILE>server/model/monitor.js</FILE>
        <FILE>server/server.js</FILE>
        <FILE>src/assets/vars.scss</FILE>
        <FILE>src/components/HeartbeatBar.vue</FILE>
        <FILE>src/components/Status.vue</FILE>
        <FILE>src/components/Uptime.vue</FILE>
        <FILE>src/mixins/socket.js</FILE>
        <FILE>src/pages/DashboardHome.vue</FILE>
        <FILE>src/pages/EditMonitor.vue</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
