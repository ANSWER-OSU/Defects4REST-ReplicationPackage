<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>145</ISSUENO>
  <ISSUEURL>https://github.com/spring-petclinic/spring-petclinic-rest/issues/145</ISSUEURL>
  <TITLE>Bad Request Error while trying to get pet for a specific owner</TITLE>
  <DESCRIPTION>The `GET/api/owners/{id}/pets/{petId}` endpoint seems to be returning an incorrect response or handling errors improperly. This issue was encountered while attempting to retrieve specific pet for a given owner. cURL: ```bash curl -X 'GET' \ 'http://localhost:9966/petclinic/api/owners/1/pets/1' \ -H 'accept: application/json' ``` Response on Swagger-ui: `Error: response status is 400` I tried to debug code and found out that it comes from `OwnerRestController` : ```java @RestController @RequestMapping(&quot;/api&quot;) public class OwnerRestController implements OwnersApi { // ... @PreAuthorize(&quot;hasRole(@roles.OWNER_ADMIN)&quot;) @Override public ResponseEntity&lt;PetDto&gt; getOwnersPet(Integer ownerId, Integer petId) { Owner owner = this.clinicService.findOwnerById(ownerId); Pet pet = this.clinicService.findPetById(petId); if (owner == null || pet == null) { return new ResponseEntity&lt;&gt;(HttpStatus.NOT_FOUND); } else { if (!pet.getOwner().equals(owner)) { return new ResponseEntity&lt;&gt;(HttpStatus.BAD_REQUEST); } else { return new ResponseEntity&lt;&gt;(petMapper.toPetDto(pet), HttpStatus.OK); } } } } ``` The problem is here : `if (!pet.getOwner().equals(owner)) {}`: the `equals()` check returns `false`. Ive checked the entity Owner class and found out that it doesn't have `equals` and `hashcode()` (same for Pet entity class), which is not recommended !</DESCRIPTION>
  <REPONAME>spring-petclinic-rest</REPONAME>
  <TIMEDIFFERENCEDAYS>26</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Bump MySQL support from 5.7 to 8.4 and align spring profile with the official Spring Petclinic version (#142)</MESSAGE>
    <SHA>99291bdaac983827717312f0a79cf26ae5aa7165</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fix #145 bad request on GET /api/owners/{id}/pets/{petId}</MESSAGE>
      <SHA>29a3295a4bbd74b939663d8ff94db3059859bcdc</SHA>
      <PATCHEDFILES>
        <FILE>src/main/java/org/springframework/samples/petclinic/rest/controller/OwnerRestController.java</FILE>
        <FILE>src/test/java/org/springframework/samples/petclinic/rest/controller/OwnerRestControllerTests.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fix #145 404 error for both: owner and pet not found</MESSAGE>
      <SHA>fcb05f16738afe726e93d0e9c71ec2fbda6abf88</SHA>
      <PATCHEDFILES>
        <FILE>src/main/java/org/springframework/samples/petclinic/rest/controller/OwnerRestController.java</FILE>
        <FILE>src/test/java/org/springframework/samples/petclinic/rest/controller/OwnerRestControllerTests.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fix #145 404 error for both: update the OAS description</MESSAGE>
      <SHA>2081ddbbf99d83f945c46f23b48210da5ebb9f04</SHA>
      <PATCHEDFILES>
        <FILE>src/main/resources/openapi.yml</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fix #145 404 error for both: refactoring by introducing a Owner::getPet(Integer petId) method</MESSAGE>
      <SHA>adfdc7d51ab4db6b419aa229ea517a3708f8d4a1</SHA>
      <PATCHEDFILES>
        <FILE>src/main/java/org/springframework/samples/petclinic/model/Owner.java</FILE>
        <FILE>src/main/java/org/springframework/samples/petclinic/rest/controller/OwnerRestController.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fix #145 bad request on GET /api/owners/{id}/pets/{petId} (#150) * Fix #145 bad request on GET /api/owners/{id}/pets/{petId} * Fix #145 404 error for both: owner and pet not found * Fix #145 404 error for both: update the OAS description * Fix #145 404 error for both: refactoring by introducing a Owner::getPet(Integer petId) method</MESSAGE>
      <SHA>072f200378107f06953f486a1f3f761bebd42986</SHA>
      <PATCHEDFILES>
        <FILE>src/main/java/org/springframework/samples/petclinic/model/Owner.java</FILE>
        <FILE>src/main/java/org/springframework/samples/petclinic/rest/controller/OwnerRestController.java</FILE>
        <FILE>src/main/resources/openapi.yml</FILE>
        <FILE>src/test/java/org/springframework/samples/petclinic/rest/controller/OwnerRestControllerTests.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
