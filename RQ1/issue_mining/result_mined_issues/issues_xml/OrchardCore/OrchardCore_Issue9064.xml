<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>9064</ISSUENO>
  <ISSUEURL>https://github.com/OrchardCMS/OrchardCore/issues/9064</ISSUEURL>
  <TITLE>WorkflowTypeIndex not available for subsequent recipe steps?</TITLE>
  <DESCRIPTION>### Describe the bug I was using build 15800 for a while, and during that time, I built a web app that I could completely recreate on a fresh local tenant using a recipe via Blank recipe + Package Import. It would turn on a set of features, define content types, define workflows, and then create content items with forms that submit to the workflows. I then updated to build 16039. Now, when I create a Blank tenant and run the recipe to recreate the app locally (for regression testing purposes), I find that the &quot;Package Import&quot; process fails when attempting to create the content items. The error I get is... `SQLite Error 1: 'no such table: WorkflowTypeIndex'.` This never happened previously, so I'm wondering if something changed to where the indexes' creation has been delayed or something? I would have thought the index would be created when the feature is turned on, which would have been completed at the end of the Feature recipe step, so the subsequent `content` step would be executing with the index already existing. Is there something I'm missing? The recipe steps I have are... 1. Feature - &quot;Application.Default&quot;, - [CustomFormWidgets] - &quot;OrchardCore.Liquid&quot;, - &quot;OrchardCore.Scripting&quot;, - &quot;OrchardCore.Workflows&quot;, - &quot;OrchardCore.Workflows.Http&quot;, - [CustomLiquidFilters] - &quot;OrchardCore.Microsoft.Authentication.AzureAD&quot;, - &quot;OrchardCore.Resources&quot;, - &quot;OrchardCore.Email&quot;, - &quot;OrchardCore.Users&quot;, - &quot;OrchardCore.Users.Registration&quot;, - [CustomAuthentication], - [CustomWorkflowActivities], - &quot;OrchardCore.Settings&quot;, - &quot;OrchardCore.Admin&quot;, - &quot;OrchardCore.Templates&quot;, - &quot;OrchardCore.Contents&quot;, - &quot;OrchardCore.ContentTypes&quot;, - &quot;OrchardCore.Alias&quot;, - &quot;OrchardCore.Autoroute&quot;, - &quot;OrchardCore.Shortcodes&quot;, - &quot;OrchardCore.ContentFields&quot;, - &quot;OrchardCore.ContentPreview&quot;, - &quot;OrchardCore.Deployment&quot;, - &quot;OrchardCore.Contents.Deployment.AddToDeploymentPlan&quot;, - &quot;OrchardCore.Contents.FileContentDefinition&quot;, - &quot;OrchardCore.CustomSettings&quot;, - &quot;OrchardCore.Deployment.Remote&quot;, - &quot;OrchardCore.Diagnostics&quot;, - &quot;OrchardCore.DynamicCache&quot;, - &quot;OrchardCore.Widgets&quot;, - &quot;OrchardCore.Features&quot;, - &quot;OrchardCore.Feeds&quot;, - &quot;OrchardCore.Flows&quot;, - &quot;OrchardCore.Forms&quot;, - &quot;OrchardCore.HomeRoute&quot;, - &quot;OrchardCore.Html&quot;, - &quot;OrchardCore.Indexing&quot;, - &quot;OrchardCore.Layers&quot;, - &quot;OrchardCore.Lists&quot;, - &quot;OrchardCore.Lucene&quot;, - &quot;OrchardCore.Markdown&quot;, - &quot;OrchardCore.Media&quot;, - &quot;OrchardCore.Title&quot;, - &quot;OrchardCore.Menu&quot;, - &quot;OrchardCore.Navigation&quot;, - &quot;OrchardCore.Recipes&quot;, - &quot;OrchardCore.Roles&quot;, - &quot;OrchardCore.Shortcodes.Templates&quot;, - &quot;OrchardCore.Taxonomies&quot;, - &quot;OrchardCore.Taxonomies.ContentsAdminList&quot;, - &quot;OrchardCore.Themes&quot;, - &quot;TheAdmin&quot;, - [CustomAdminTheme], - [CustomFrontendTheme] 2. WorkflowType 3. Templates 4. ContentDefinition 5. Themes 6. CustomStepToRefreshWorkflowHttpRequestTokens 7. content - main menu - side menu - form1 - form2 The recipe executes successfully if I just remove the last `content` step, but it fails if the `content` step is included. Aside from the forms having some custom shortcodes in an HtmlBodyPart, they are typical run-of-the-mill forms without any custom functionality. This leads me to think the problem lies somewhere else, especially since it all worked fine before updating to the latest dev build. I also wondered if maybe the recipe deployment plan made from a 15800 build was having issues being imported into a 16039 build? But the content/format looked largely the same. ### To Reproduce Steps to reproduce the behavior: 1. Have similar recipe steps executed on a Blank fresh tenant with a SQLite database? Not sure how best to reproduce it. ### Expected behavior Able to successfully import content.</DESCRIPTION>
  <REPONAME>OrchardCore</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Fixes #9039 View Buffer OutOfRangeException (#9062)</MESSAGE>
    <SHA>dbb566a07cae64b8713f488add45f41e52b22b8c</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fixes #8785 #8967 #9064 Use DeferredTask in ContentStep (#9046)</MESSAGE>
      <SHA>3df1b7bc744b1c5cd9810ccc976167711070d27e</SHA>
      <PATCHEDFILES>
        <FILE>src/OrchardCore.Modules/OrchardCore.ContentFields/Startup.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Contents/Recipes/ContentStep.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Workflows/Http/Startup.cs</FILE>
        <FILE>src/OrchardCore.Themes/TheComingSoonTheme/Recipes/comingsoon.recipe.json</FILE>
        <FILE>src/OrchardCore/OrchardCore.Abstractions/Extensions/ExtensionEntry.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.Abstractions/Extensions/Features/CompositeFeaturesProvider.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.Abstractions/Extensions/Features/FeatureEntry.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.Abstractions/Extensions/Features/IFeatureInfo.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.Abstractions/Extensions/Features/InternalFeatureInfo.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.Abstractions/Extensions/IExtensionInfo.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.Abstractions/Extensions/IExtensionManager.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.Abstractions/Extensions/InternalExtensionInfo.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.Abstractions/Extensions/NotFoundExtensionInfo.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.Abstractions/Modules/Manifest/FeatureAttribute.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.Abstractions/Modules/RequireFeaturesAttribute.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.Abstractions/Shell/Scope/ShellScope.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.ResourceManagement/ResourceDictionary.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore/Extensions/ExtensionInfo.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore/Extensions/ExtensionManager.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore/Extensions/Features/FeatureInfo.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore/Extensions/Features/FeaturesProvider.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore/Extensions/Features/TypeFeatureProvider.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore/Shell/Builders/CompositionStrategy.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore/Shell/ShellStateUpdater.cs</FILE>
        <FILE>test/OrchardCore.Tests/Apis/Lucene/LuceneQueryTests.cs</FILE>
        <FILE>test/OrchardCore.Tests/DisplayManagement/Decriptors/DefaultShapeTableManagerTests.cs</FILE>
        <FILE>test/OrchardCore.Tests/Shell/ShellContainerFactoryTests.cs</FILE>
        <FILE>test/OrchardCore.Tests/Stubs/StubExtensionManager.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
