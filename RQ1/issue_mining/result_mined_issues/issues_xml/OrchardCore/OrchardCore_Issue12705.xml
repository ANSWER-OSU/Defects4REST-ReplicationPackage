<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>12705</ISSUENO>
  <ISSUEURL>https://github.com/OrchardCMS/OrchardCore/issues/12705</ISSUEURL>
  <TITLE>Reset Password bug</TITLE>
  <DESCRIPTION>### Describe the bug: Reset password doesn't work as expected when `RequireUniqueEmail` is false. When trying to reset the password it changes the password of the first user found. The problem occurs when a new user is created with the same email. [See related lines here](https://github.com/OrchardCMS/OrchardCore/blob/f6368bf1d9bfa5c91b31c37371777ce85e39124e/src/OrchardCore/OrchardCore.Users.Core/Services/UserService.cs#L197) ### Related bug: Change password operation from the dashboard produces the same result. [See here](https://github.com/OrchardCMS/OrchardCore/blob/f6368bf1d9bfa5c91b31c37371777ce85e39124e/src/OrchardCore.Modules/OrchardCore.Users/Controllers/AdminController.cs#L507) ### To Reproduce 1. `services.Configure&lt;IdentityOptions&gt;(o =&gt; o.User.RequireUniqueEmail = false);` 2. Create 2 users from code with the same emails 3. Try to reset passwords ### Expected behavior Should check the `RequireUniqueEmail` option. In case of `false` value have to find another way how user should identify herself/himself (username?).</DESCRIPTION>
  <REPONAME>OrchardCore</REPONAME>
  <TIMEDIFFERENCEDAYS>542</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Fix Issue-15709: Fix NullReferenceException in CacheTicketStore.RenewAsync method (#15711)</MESSAGE>
    <SHA>70cc05569429b5b69536ed17c0d35d107db2a66e</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Convert FogotPassword views to shapes Fix #15702 Fix #12705</MESSAGE>
      <SHA>9a6ad961d7883946451885e5b11d515dce05e796</SHA>
      <PATCHEDFILES>
        <FILE>src/OrchardCore.Modules/OrchardCore.ReCaptcha/Drivers/ReCaptchaForgotPasswordFormDisplayDriver.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.ReCaptcha/Drivers/ReCaptchaLoginFormDisplayDriver.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.ReCaptcha/ReCaptchaLoginFilter.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.ReCaptcha/Startup.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.ReCaptcha/Views/FormReCaptcha.Edit.cshtml</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Users/Controllers/ResetPasswordController.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Users/Drivers/ForgotPasswordFormDisplayDriver.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Users/Drivers/LoginFormDisplayDriver.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Users/Startup.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Users/ViewModels/ForgotPasswordViewModel.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Users/Views/ForgotPasswordForm.Edit.cshtml</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Users/Views/ForgotPasswordFormIdentifier.Edit.cshtml</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Users/Views/ResetPassword/ForgotPassword.cshtml</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Users/Views/ResetPassword/ForgotPasswordConfirmation.cshtml</FILE>
        <FILE>src/OrchardCore/OrchardCore.Users.Core/Models/ForgotPasswordForm.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.Users.Core/Services/UserService.cs</FILE>
        <FILE>src/docs/releases/1.9.0.md</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
