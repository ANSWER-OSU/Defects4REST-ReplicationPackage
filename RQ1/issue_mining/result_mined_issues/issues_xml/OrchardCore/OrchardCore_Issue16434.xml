<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>16434</ISSUENO>
  <ISSUEURL>https://github.com/OrchardCMS/OrchardCore/issues/16434</ISSUEURL>
  <TITLE>Sitemap import/export does not work</TITLE>
  <DESCRIPTION>### Describe the bug I've found two STJ problems with sitemap import &amp; export. Both are related to polymorphic deserialization so it's the same bug. 1. If you try to export a new site map, the sitemap source will only contain the `Id` property, all other details are lost. It seems like the object is serialized as just `SitemapSource` instead of the derived type `ContentTypesSitemapSource`. See in the repro below. 2. When the site tries to parse a recipe from OC 1.8 containing the `&quot;Sitemaps&quot;` step, it throws the following, even before the recipe is executed. You can find the example error and the JSON that causes it below: ### Orchard Core version The latest `main` branch and 2.0.0-preview-18268 Cloudsmith package. ### To Reproduce Steps to reproduce the export error: 1. Create a site (example using Blog recipe). 2. Enable the &quot;Sitemaps&quot; feature. 3. Go to Admin &gt; Configuration &gt; SEO &gt; Sitemaps. 4. Add a sitemap and a &quot;Sitemap Content Types&quot; source (I unchecked &quot;Index All Content Types&quot; and picked just Page and BlogPost). 5. Go to Admin &gt; Configuration &gt; Import/Export &gt; Deployment Plans. 6. Create a deployment plan and add the &quot;All Sitemaps&quot; step. 7. Execute the deployment and open the resulting JSON. 8. Observe, that the `SitemapSources` is missing all details (expected something similar to the JSON in the logs section instead): ```json { &quot;name&quot;: &quot;&quot;, &quot;displayName&quot;: &quot;&quot;, &quot;description&quot;: &quot;&quot;, &quot;author&quot;: &quot;&quot;, &quot;website&quot;: &quot;&quot;, &quot;version&quot;: &quot;&quot;, &quot;issetuprecipe&quot;: false, &quot;categories&quot;: [], &quot;tags&quot;: [], &quot;steps&quot;: [ { &quot;name&quot;: &quot;Sitemaps&quot;, &quot;data&quot;: [ { &quot;SitemapId&quot;: &quot;4g45p23q02vgpvm40vznd49t56&quot;, &quot;Name&quot;: &quot;Sitemap&quot;, &quot;Enabled&quot;: true, &quot;Path&quot;: &quot;sitemap.xml&quot;, &quot;SitemapSources&quot;: [ { &quot;Id&quot;: &quot;4nqc3qwb76te707aq12qapkh4y&quot; } ], &quot;Identifier&quot;: &quot;4vtsxzdvm15qmxv5fbttrhh054&quot; } ] } ] } ```` 9. Go to Admin &gt; Configuration &gt; Import/Export &gt; JSON Import 10. Paste the freshly exported site map. 11. Observe the error message **Unexpected error occurred while executing the 'Sitemaps' step.** 12. Observe the error in the log: Unable to import a recipe from JSON input. OrchardCore.Recipes.Models.RecipeExecutionException: Deserialization of types without a parameterless constructor, a singular parameterized constructor, or a parameterized constructor annotated with 'JsonConstructorAttribute' is not supported. Type 'OrchardCore.Sitemaps.Models.SitemapType'. Path: $ | LineNumber: 0 | BytePositionInLine: 1. ### Expected behavior If possible, import from OC 1.x recipe should work. If that's not feasible, a note should be added into the release notes breaking changes section. Export should include all ### Logs and screenshots If applicable, add log files, browser console logs, and screenshots (or screen recording videos) to help explain your problem. This is example sitemap recipe from OC 1.8 that used to work: ```json { &quot;name&quot;: &quot;Redacted.Sitemaps&quot;, &quot;displayName&quot;: &quot;Redacted - Content - Sitemaps Definition&quot;, &quot;description&quot;: &quot;Sitemaps for Redacted site.&quot;, &quot;author&quot;: &quot;Lombiq&quot;, &quot;version&quot;: &quot;1.0&quot;, &quot;categories&quot;: [ &quot;content&quot; ], &quot;tags&quot;: [ &quot;sitemaps&quot; ], &quot;steps&quot;: [ { &quot;name&quot;: &quot;Sitemaps&quot;, &quot;data&quot;: [ { &quot;$type&quot;: &quot;OrchardCore.Sitemaps.Models.Sitemap, OrchardCore.Sitemaps.Abstractions&quot;, &quot;SitemapId&quot;: &quot;4vbscpv3kgcnz192hnwwggh0d7&quot;, &quot;Name&quot;: &quot;Sitemap&quot;, &quot;Enabled&quot;: true, &quot;Path&quot;: &quot;sitemap.xml&quot;, &quot;SitemapSources&quot;: [ { &quot;$type&quot;: &quot;OrchardCore.Sitemaps.Models.ContentTypesSitemapSource, OrchardCore.Sitemaps.Abstractions&quot;, &quot;IndexAll&quot;: false, &quot;LimitItems&quot;: false, &quot;ChangeFrequency&quot;: 0, &quot;Priority&quot;: 5, &quot;ContentTypes&quot;: [ { &quot;ContentTypeName&quot;: &quot;BlogPost&quot;, &quot;ChangeFrequency&quot;: 0, &quot;Priority&quot;: 0 }, { &quot;ContentTypeName&quot;: &quot;Page&quot;, &quot;ChangeFrequency&quot;: 0, &quot;Priority&quot;: 0 } ], &quot;Id&quot;: &quot;45naf8my0kdgd3tsf5vwtf94xq&quot; } ], &quot;Identifier&quot;: &quot;4mg5ntbxrs9c57w8nybtgvyvcf&quot; } ] } ] } ``` This is the error log that shows up now: ``` 2024-07-12 16:21:28.3105|test|00-6c4d175cf6fcafcbc633522a4d8c5e63-82c762aa10e7f9c7-00||OrchardCore.Setup.Services.SetupService|ERROR|Unable to import a recipe during setup. OrchardCore.Recipes.Models.RecipeExecutionException: Deserialization of types without a parameterless constructor, a singular parameterized constructor, or a parameterized constructor annotated with 'JsonConstructorAttribute' is not supported. Type 'OrchardCore.Sitemaps.Models.SitemapType'. Path: $ | LineNumber: 0 | BytePositionInLine: 1. ---&gt; System.NotSupportedException: Deserialization of types without a parameterless constructor, a singular parameterized constructor, or a parameterized constructor annotated with 'JsonConstructorAttribute' is not supported. Type 'OrchardCore.Sitemaps.Models.SitemapType'. Path: $ | LineNumber: 0 | BytePositionInLine: 1. ---&gt; System.NotSupportedException: Deserialization of types without a parameterless constructor, a singular parameterized constructor, or a parameterized constructor annotated with 'JsonConstructorAttribute' is not supported. Type 'OrchardCore.Sitemaps.Models.SitemapType'. --- End of inner exception stack trace --- at System.Text.Json.ThrowHelper.ThrowNotSupportedException(ReadStack&amp; state, Utf8JsonReader&amp; reader, NotSupportedException ex) at System.Text.Json.ThrowHelper.ThrowNotSupportedException_DeserializeNoConstructor(Type type, Utf8JsonReader&amp; reader, ReadStack&amp; state) at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryRead(Utf8JsonReader&amp; reader, Type typeToConvert, JsonSerializerOptions options, ReadStack&amp; state, T&amp; value) at System.Text.Json.Serialization.JsonConverter`1.TryRead(Utf8JsonReader&amp; reader, Type typeToConvert, JsonSerializerOptions options, ReadStack&amp; state, T&amp; value, Boolean&amp; isPopulatedValue) at System.Text.Json.Serialization.JsonConverter`1.ReadCore(Utf8JsonReader&amp; reader, JsonSerializerOptions options, ReadStack&amp; state) at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.Deserialize(Utf8JsonReader&amp; reader, ReadStack&amp; state) at System.Text.Json.JsonSerializer.ReadFromSpan[TValue](ReadOnlySpan`1 utf8Json, JsonTypeInfo`1 jsonTypeInfo, Nullable`1 actualByteCount) at System.Text.Json.JsonSerializer.ReadFromNode[TValue](JsonNode node, JsonTypeInfo`1 jsonTypeInfo) at System.Text.Json.JsonSerializer.Deserialize[TValue](JsonNode node, JsonSerializerOptions options) at System.Text.Json.Nodes.JNode.ToObject[T](JsonNode jsonNode, JsonSerializerOptions options) at OrchardCore.Sitemaps.Recipes.SitemapsStep.ExecuteAsync(RecipeExecutionContext context) at OrchardCore.Recipes.Services.RecipeExecutor.&lt;&gt;c__DisplayClass8_0.&lt;&lt;ExecuteStepAsync&gt;b__0&gt;d.MoveNext() ```</DESCRIPTION>
  <REPONAME>OrchardCore</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Fix ExpandoObject property access (#16432) Fix #16431</MESSAGE>
    <SHA>4d4f20f3a9d9d5314b487cdb720d544a8401643d</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fix Sitemap Import/Export Fix #16434</MESSAGE>
      <SHA>bd3e7c81b3e3e065cd198de7c8af08c94eb6cbd6</SHA>
      <PATCHEDFILES>
        <FILE>src/OrchardCore.Modules/OrchardCore.Sitemaps/Deployment/AllSitemapsDeploymentSource.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Sitemaps/Deployment/AllSitemapsDeploymentStep.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Sitemaps/Recipes/SitemapsStep.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fix Sitemap Import/Export (#16436) Fix #16434</MESSAGE>
      <SHA>08bf6c315388a2406deafcfdb3bbc38870b286a3</SHA>
      <PATCHEDFILES>
        <FILE>src/OrchardCore.Modules/OrchardCore.Sitemaps/Deployment/AllSitemapsDeploymentSource.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Sitemaps/Deployment/AllSitemapsDeploymentStep.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Sitemaps/Recipes/SitemapsStep.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
