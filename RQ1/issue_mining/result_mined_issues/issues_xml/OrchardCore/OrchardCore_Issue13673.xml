<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>13673</ISSUENO>
  <ISSUEURL>https://github.com/OrchardCMS/OrchardCore/issues/13673</ISSUEURL>
  <TITLE>Enabling &quot;OrchardCore.OpenId.Validation&quot; feature while using custom Authority value in the server throws an exception</TITLE>
  <DESCRIPTION>### Describe the bug When using **OpenId Server** feature along with **OpenId Validation** and using custom Authority value, the following exception is thrown ``` InvalidOperationException: The issuer attached to the static configuration must be the same as the one configured in the validation options. ``` ### To Reproduce Steps to reproduce the behavior: 1. Enable the OpenId Server and the Validation 2. Set a new value in the `Authority` settings in server settings. 3. The site become useless and you'll get the above exception. ### Workaround To work around this issue I did the following steps If the sure is not usable and there is a white-page/exception follow the next 5 steps. If the site is still usable, skip the first 2 steps, and start at step 3. 1. Use any RDBMS (like SQL Server Management Studio) tool to update the database directly. Update the the site settings document record by setting `Authority` to `null` in the OpenId Server settings. 2. Restart your app to force the app to read the updates you made in the database. 3. Make sure the `Deployment` feature is enable. 4. Go to **Configuratons** &gt;&gt; **Import/Export** &gt;&gt; **Import Recipe** and execute the following recipe ``` { &quot;steps&quot;: [ { &quot;name&quot;: &quot;OpenIdValidationSettings&quot;, &quot;Authority&quot;: &quot;The custom authority domain name you want to use like https://www.custom-name.com&quot; } ] } ``` 5. I went back to the OpenID Server settings and set the Authority value to the same value I used in the Authority above.</DESCRIPTION>
  <REPONAME>OrchardCore</REPONAME>
  <TIMEDIFFERENCEDAYS>28</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Include icons.svg for Trumbowyg (#13782)</MESSAGE>
    <SHA>b07fa08283db8b6dbc601a5a35b0ecf752b2c913</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fix OpenId Configuration initialization. Fix #13673</MESSAGE>
      <SHA>6c0fe06d5154ce1027b69db61c0c45d74fd744d6</SHA>
      <PATCHEDFILES>
        <FILE>src/OrchardCore.Modules/OrchardCore.OpenId/Configuration/OpenIdValidationConfiguration.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.OpenId/Views/NavigationItemText-openid.Id.cshtml</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
