<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>10364</ISSUENO>
  <ISSUEURL>https://github.com/OrchardCMS/OrchardCore/issues/10364</ISSUEURL>
  <TITLE>Redirect URL encoding issue on Azure</TITLE>
  <DESCRIPTION>### Describe the bug When publishing this ```Admin/Contents/ContentItems/{ContentItemId}/Edit?returnUrl={greek or unicode characters}``` the redirect goes to ```{some encoded or strange characters url}``` and of course we are getting page not found... It happens on Azure, not on local dev env.. Both on .net 3.1 and 5 ### To Reproduce Steps to reproduce the behavior: 1. Publish a blogpost with permalink that contains non English characters 2. Edit this blogpost and have a redirect url the above permalink 3. See error ### Expected behavior Non English characters should not be encoded ### Screenshots ![image](https://user-images.githubusercontent.com/1871551/135157414-d94bc6cb-204d-4168-a227-99f32a9571e7.png) ![image](https://user-images.githubusercontent.com/1871551/135157480-a3afe5a2-6880-45e1-a34e-8b3092ae6b87.png) ![image](https://user-images.githubusercontent.com/1871551/135157557-c0b8e4b8-6374-4dd7-8ac7-02842742d629.png)</DESCRIPTION>
  <REPONAME>OrchardCore</REPONAME>
  <TIMEDIFFERENCEDAYS>1</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Cypress 8.5.0 (#10357)</MESSAGE>
    <SHA>5fab7399d9283629bf8e3f46723ac203c20f6752</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Encode redirect urls Fixes #10364</MESSAGE>
      <SHA>12199fcbb57235ab5554b2d1afedef07ac51e822</SHA>
      <PATCHEDFILES>
        <FILE>src/OrchardCore.Modules/OrchardCore.AutoSetup/AutoSetupMiddleware.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.ContentLocalization/Controllers/ContentCulturePickerController.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.ContentTypes/Controllers/AdminController.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Contents/Controllers/AdminController.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Contents/Deployment/AddToDeploymentPlan/AddToDeploymentPlanController.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Demo/Controllers/TodoController.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Deployment.Remote/Controllers/ExportRemoteInstanceController.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Features/Controllers/AdminController.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.OpenId/Controllers/ApplicationController.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.OpenId/Controllers/ScopeController.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Placements/Controllers/AdminController.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Templates/Controllers/TemplateController.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Tenants/Controllers/AdminController.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Users/Controllers/AccountController.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Users/Controllers/AdminController.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Users/Controllers/ChangeEmailController.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Users/Controllers/RegistrationController.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Users/Controllers/ResetPasswordController.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Workflows/Controllers/ActivityController.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Workflows/Controllers/WorkflowTypeController.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Workflows/Http/Activities/HttpRedirectTask.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Encode redirect urls (#10368) Fixes #10364</MESSAGE>
      <SHA>ea7b21b53e5b3f6037dc9590ff68338d04521f73</SHA>
      <PATCHEDFILES>
        <FILE>src/OrchardCore.Modules/OrchardCore.ContentLocalization/Controllers/ContentCulturePickerController.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.ContentTypes/Controllers/AdminController.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Contents/Controllers/AdminController.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Contents/Deployment/AddToDeploymentPlan/AddToDeploymentPlanController.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Demo/Controllers/TodoController.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Deployment.Remote/Controllers/ExportRemoteInstanceController.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Features/Controllers/AdminController.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.OpenId/Controllers/ApplicationController.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.OpenId/Controllers/ScopeController.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Placements/Controllers/AdminController.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Templates/Controllers/TemplateController.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Tenants/Controllers/AdminController.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Users/Controllers/AccountController.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Users/Controllers/AdminController.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Users/Controllers/ChangeEmailController.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Users/Controllers/RegistrationController.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Users/Controllers/ResetPasswordController.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Workflows/Controllers/ActivityController.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Workflows/Controllers/WorkflowTypeController.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Workflows/Http/Activities/HttpRedirectTask.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
