<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>10986</ISSUENO>
  <ISSUEURL>https://github.com/OrchardCMS/OrchardCore/issues/10986</ISSUEURL>
  <TITLE>Improve BagPart</TITLE>
  <DESCRIPTION>### Is your feature request related to a problem? Please describe. When creating multiple similar items into a BagPart, it would be nice to have a clone function. ### Describe the solution you'd like Add a button to clone an item in a bag by adding a button next to the delete button. Also, when there is only one item type that can be added, instead of showing `Add Item`, show `Add [ItemDisplayText]. This just saved 1 extra click X the amount of items to add. The view will look something like this ``` @using OrchardCore.Flows.Models; @using OrchardCore.Flows.ViewModels; @using OrchardCore.Mvc.Utilities; @model BagPartEditViewModel @inject IContentManager ContentManager @inject OrchardCore.ContentManagement.Metadata.IContentDefinitionManager ContentDefinitionManager @inject OrchardCore.ContentManagement.Display.IContentItemDisplayManager ContentItemDisplayManager @{ var widgetTemplatePlaceholderId = Html.Id(&quot;widgetTemplatePlaceholder&quot;); var htmlFieldPrefix = ViewContext.ViewData.TemplateInfo.HtmlFieldPrefix; var parentContentType = Model.BagPart.ContentItem.ContentType; string partName = ((dynamic)Model).Metadata.Name; var totalItems = Model.ContainedContentTypeDefinitions.Count(); } &lt;script asp-name=&quot;jQuery-ui&quot; at=&quot;Foot&quot;&gt;&lt;/script&gt; &lt;div class=&quot;form-group&quot;&gt; &lt;div id=&quot;@widgetTemplatePlaceholderId&quot; class=&quot;widget-template-placeholder widget-template-placeholder-bagpart bagpart-@partName.HtmlClassify() row mx-0&quot; data-buildeditorurl=&quot;@Url.Action(&quot;BuildEditor&quot;, &quot;Admin&quot;, new { area = &quot;OrchardCore.Flows&quot; })&quot;&gt; @{ var index = 0; foreach (var widget in Model.BagPart.ContentItems) { //Create a Card Shape dynamic contentCard = await New.ContentCard( // FOR Updater CollectionShape: Model, //Shape Specific CollectionShapeType: nameof(BagPart), ContentItem: widget, BuildEditor: true, ParentContentType: parentContentType, CollectionPartName: partName, //Card Specific Properties TargetId: widgetTemplatePlaceholderId, Inline: false, CanMove: true, CanDelete: true, //Input hidden //Prefixes HtmlFieldPrefix: htmlFieldPrefix, PrefixValue: htmlFieldPrefix + '-' + (index++).ToString(), PrefixesId: Html.IdFor(x =&gt; x.Prefixes), PrefixesName: Html.NameFor(x =&gt; x.Prefixes), //Content Types ContentTypesId: Html.IdFor(x =&gt; x.ContentTypes), ContentTypesName: Html.NameFor(x =&gt; x.ContentTypes), //Content Items ContentItemsId: Html.IdFor(x =&gt; x.ContentItems), ContentItemsName: Html.NameFor(x =&gt; x.ContentItems) ); @await DisplayAsync(contentCard) } } &lt;/div&gt; @if (totalItems == 1) { var type = Model.ContainedContentTypeDefinitions.First(); &lt;a class=&quot;btn btn-primary add-widget btn-sm&quot; data-target-id=&quot;@widgetTemplatePlaceholderId&quot; data-html-field-prefix=&quot;@htmlFieldPrefix&quot; data-prefixes-name=&quot;@Html.NameFor(x =&gt; x.Prefixes)&quot; data-contenttypes-name=&quot;@Html.NameFor(x =&gt; x.ContentTypes)&quot; data-contentitems-name=&quot;@Html.NameFor(x =&gt; x.ContentItems)&quot; data-widget-type=&quot;@type.Name&quot; data-flowmetadata=&quot;false&quot; data-parent-content-type=&quot;@parentContentType&quot; data-part-name=&quot;@partName&quot; href=&quot;javascript:;&quot;&gt;@type.DisplayName&lt;/a&gt; } else if (totalItems &gt; 1) { &lt;div class=&quot;btn-group btn-bag-add&quot;&gt; &lt;button type=&quot;button&quot; class=&quot;btn btn-primary btn-sm dropdown-toggle&quot; data-toggle=&quot;dropdown&quot; aria-haspopup=&quot;true&quot; aria-expanded=&quot;false&quot;&gt; @T[&quot;Add Item&quot;] &lt;/button&gt; &lt;div class=&quot;dropdown-menu&quot;&gt; @foreach (var type in Model.ContainedContentTypeDefinitions) { &lt;a class=&quot;dropdown-item add-widget btn-sm&quot; data-target-id=&quot;@widgetTemplatePlaceholderId&quot; data-html-field-prefix=&quot;@htmlFieldPrefix&quot; data-prefixes-name=&quot;@Html.NameFor(x =&gt; x.Prefixes)&quot; data-contenttypes-name=&quot;@Html.NameFor(x =&gt; x.ContentTypes)&quot; data-contentitems-name=&quot;@Html.NameFor(x =&gt; x.ContentItems)&quot; data-widget-type=&quot;@type.Name&quot; data-flowmetadata=&quot;false&quot; data-parent-content-type=&quot;@parentContentType&quot; data-part-name=&quot;@partName&quot; href=&quot;javascript:;&quot;&gt;@type.DisplayName&lt;/a&gt; } &lt;/div&gt; &lt;/div&gt; } @* Rendered only once in case multiple BagPart (or FlowPart) are on the page *@ @if (Context.Items[&quot;BagPart.Edit&quot;] == null) { Context.Items[&quot;BagPart.Edit&quot;] = new object(); &lt;script asp-src=&quot;~/OrchardCore.Flows/Scripts/flows.edit.min.js&quot; debug-src=&quot;~/OrchardCore.Flows/Scripts/flows.edit.js&quot; at=&quot;Foot&quot; depends-on=&quot;admin&quot;&gt;&lt;/script&gt; &lt;style asp-src=&quot;~/OrchardCore.Widgets/Styles/widgetslist.edit.min.css&quot; debug-src=&quot;~/OrchardCore.Widgets/Styles/widgetslist.edit.css&quot;&gt;&lt;/style&gt; &lt;style asp-src=&quot;~/OrchardCore.Flows/Styles/flows.edit.min.css&quot; debug-src=&quot;~/OrchardCore.Flows/Styles/flows.edit.css&quot;&gt;&lt;/style&gt; } @* Rendered only once per type to initialize the scripts its editor will need *@ @foreach (var type in Model.ContainedContentTypeDefinitions) { @if (Context.Items[&quot;BagPart.Edit:&quot; + type.Name] == null) { Context.Items[&quot;BagPart.Edit:&quot; + type.Name] = new object(); // Render a mock widget so that its resources are included in the page var contentItem = await ContentManager.NewAsync(type.Name); await DisplayAsync(await ContentItemDisplayManager.BuildEditorAsync(contentItem, Model.Updater, true, &quot;&quot;, Guid.NewGuid().ToString(&quot;n&quot;))); } } &lt;script at=&quot;Foot&quot;&gt; @*Only apply sortable if element is present in dom, do not call sortable on scripts for mock widgets *@ if ($('#@widgetTemplatePlaceholderId').length == 1) { $(&quot;#@widgetTemplatePlaceholderId&quot;).sortable({ handle: &quot;.widget-editor-handle&quot;, cursor: &quot;move&quot;, opacity: 0.7, tolerance: &quot;pointer&quot;, placeholder: { element: function(currentItem) { return $('&lt;div class=&quot;widget-dragdrop-placeholder&quot;&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;')[0]; }, update: function (container, p) { return; } }, toleranceElement: '&gt; div', start: function (event, ui) { widgetDragItem = ui.item; lastContainer = ui.item.parent(); lastContainer.toggleClass('widget-dropzone-hint'); widgetDragItem.find('.card').first().toggleClass('border-primary'); var classList = widgetDragItem.attr('class').split(' '); $.each(classList, function (id, item) { if (item.indexOf('col-md-') === 0) ui.placeholder.addClass(item); }); }, stop: function (event, ui) { lastContainer.toggleClass('widget-dropzone-hint'); widgetDragItem.find('.card').first().toggleClass('border-primary'); //clear the global variables widgetDragItem = null; lastContainer = null; widgetItemSourceId = null; widgetItemDestId = null; $(document).trigger('contentpreview:render'); }, over: function (event, ui) { var $self = $(this); if (lastContainer[0] != this) { lastContainer.toggleClass('widget-dropzone-hint'); lastContainer = $self; $self.toggleClass('widget-dropzone-hint'); } } }); } &lt;/script&gt; &lt;/div&gt; ```</DESCRIPTION>
  <REPONAME>OrchardCore</REPONAME>
  <TIMEDIFFERENCEDAYS>182</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge branch 'OrchardCMS:main' into main</MESSAGE>
    <SHA>295b392002b90fac1d91904a9ffe60f2ea07b8cd</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fix #11254 and partially fix #10986</MESSAGE>
      <SHA>27f62422fce446a837c39ad0f66c79ef342aac61</SHA>
      <PATCHEDFILES>
        <FILE>src/OrchardCore.Modules/OrchardCore.Flows/Drivers/BagPartDisplayDriver.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Flows/Views/BagPart.Edit.cshtml</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Widgets/Views/ContentCard.Frame.cshtml</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
