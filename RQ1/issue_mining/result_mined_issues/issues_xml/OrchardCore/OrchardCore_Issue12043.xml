<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>12043</ISSUENO>
  <ISSUEURL>https://github.com/OrchardCMS/OrchardCore/issues/12043</ISSUEURL>
  <TITLE>Workflow ScriptTask Error: Property 'map' of object is not a function</TITLE>
  <DESCRIPTION>Script: ``` js var userList=['admin'] log('Error',&quot;userList:&quot;+JSON.stringify(userList)) var getMailBoxParams=userList.map(x=&gt;`'${x}'`); var mailListResult=executeQuery(&quot;QueryUserEmailByUserName&quot;,{userNames:getMailBoxParams.join(',')}) var staticEmail=[{&quot;Email&quot;:&quot;HUARUI2219@QQ.COM&quot;}] log('Error',&quot;staticEmail map:&quot;+JSON.stringify(staticEmail.map(x=&gt;x.Email))) log('Error',&quot;mailListResult:&quot;+JSON.stringify(mailListResult)) log('Error',&quot;mailListResult:&quot;+JSON.stringify(mailListResult.map(x=&gt;x.Email))) var allMailStr= mailListResult.map(x=&gt;`${x.Email}`).join(&quot;;&quot;) setProperty(&quot;mailList&quot;,allMailStr) setOutcome('Done'); ``` log output ``` log &gt; userList:[&quot;admin&quot;] &gt; staticEmail map:[&quot;xxx@QQ.COM&quot;] &gt; mailListResult:[{&quot;Email&quot;:&quot;xxx@QQ.COM&quot;}] &gt;ERROR|An unhandled error occurred while executing an activity. Workflow ID: '16883'. Activity: '446k3gcdes9xs00j9pxmmy6hnj', 'ScriptTask'. Putting the workflow in the faulted state. Jint.Runtime.JavaScriptException: Cannot read property 'map' of undefined at :9:67 at :9:67 ```</DESCRIPTION>
  <REPONAME>OrchardCore</REPONAME>
  <TIMEDIFFERENCEDAYS>4</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>use ToArray to Fix JSON.Stringify, array.Map()</MESSAGE>
    <SHA>e0e380c3dbb952a1596896190d94153cffc37536</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>use ToArray to Fix js array.Map() #12043</MESSAGE>
      <SHA>b7c2dd754ae77b8da23c85f9f934a660d4610427</SHA>
      <PATCHEDFILES>
        <FILE>src/OrchardCore.Modules/OrchardCore.Queries/QueryGlobalMethodProvider.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
