<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>12106</ISSUENO>
  <ISSUEURL>https://github.com/OrchardCMS/OrchardCore/issues/12106</ISSUEURL>
  <TITLE>Allow case-insensitive tenant names in ShellHost</TITLE>
  <DESCRIPTION>### Is your feature request related to a problem? Please describe. In a mobile version, I created a page when a user can login to a specific tenant by providing the `tenant name`, `username`, `password`. To identify which tenant the user is trying to access I user `_shellHost.TryGetSettings(tenantName, out settings)` which looks up the tenant by name. The issue here is if the user does not provide a case sensitive tenant name, the `ShellHost` does not find anything. ### Describe the solution you'd like It would be helpful if user case insensitive to find tenants. We can easily achieve this by storing the tenant key as lowercase and when we get/remove the tenant we will also use lowercase so no matter what the value is, we treat it the same. @jtkech is there an issue from making this change? I can push a PR if no issue with doing this. For example the line [if (!_shellContexts.TryAdd(settings.Name, new ShellContext.PlaceHolder { Settings = settings }))] (https://github.com/OrchardCMS/OrchardCore/blob/51f0db7ac0d621fe3ecc415e707df58f81883c00/src/OrchardCore/OrchardCore/Shell/ShellHost.cs#L197) will become something like this instead `if (!_shellContexts.TryAdd(settings.Name.ToLower(), new ShellContext.PlaceHolder { Settings = settings }))` Obviosly, we have to make the same change on `TryGetValue` and `TryRemove` ### Describe alternatives you've considered I did the following ``` private ShellSettings GetSettings(string tenantName) { if (_shellHost.TryGetSettings(tenantName, out ShellSettings settings)) { return settings; } var shells = _shellHost.ListShellContexts(); var tenant = shells.FirstOrDefault(x =&gt; x.Settings != null &amp;&amp; x.Settings.Name.Equals(tenantName, StringComparison.OrdinalIgnoreCase)); if (tenant != null) { return tenant.Settings; } return null; } ```</DESCRIPTION>
  <REPONAME>OrchardCore</REPONAME>
  <TIMEDIFFERENCEDAYS>4</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>NLog.Web.AspNetCore 5.1.0 (#12036)</MESSAGE>
    <SHA>c255456bf1d9093d13447e17485a23a1253f3e9b</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Allow invariant tenant names in ShellHost Fix #12106</MESSAGE>
      <SHA>82f4630174864d9e58a87060c5fc1aa0a9d3aeb3</SHA>
      <PATCHEDFILES>
        <FILE>src/OrchardCore.Modules/OrchardCore.OpenId/Controllers/ScopeController.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.OpenId/Drivers/OpenIdValidationSettingsDisplayDriver.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Tenants/Controllers/AdminController.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.Abstractions/Shell/Extensions/ShellHostExtensions.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore/Shell/Distributed/DistributedShellHostedService.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore/Shell/ShellHost.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Add support for case-insensitive tenant names in ShellHost. Fix #12106</MESSAGE>
      <SHA>6e7a39d263e472b99165d05c2cdffc0e81a640d2</SHA>
      <PATCHEDFILES>
        <FILE>src/OrchardCore/OrchardCore/Shell/ShellHost.cs</FILE>
        <FILE>test/OrchardCore.Tests/Shell/ShellHostTests.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
