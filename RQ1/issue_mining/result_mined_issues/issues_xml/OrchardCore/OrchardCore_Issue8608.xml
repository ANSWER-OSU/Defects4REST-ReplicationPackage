<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>8608</ISSUENO>
  <ISSUEURL>https://github.com/OrchardCMS/OrchardCore/issues/8608</ISSUEURL>
  <TITLE>Adding Widget without layer breaks site</TITLE>
  <DESCRIPTION>### Adding Widget without layer breaks site There is no restriction in admin from creating a widget not assigned to any layer. Adding such widget breaks the site : ![Capture d’écran 2021-02-16 151630](https://user-images.githubusercontent.com/7600804/108074882-fa691600-7069-11eb-9da3-a34f39c3e2eb.png) ### To Reproduce Steps to reproduce the behavior: 1. Setup a new CMS instance with &quot;Blank&quot; template 2. Go to Content &gt; Content Definition &gt; Content Types and create a widget (eg. Html widget) 3. Go to Design &gt; Settings &gt; Zones and add a Zone (eg. Footer) 4. Go to Design &gt; Widgets and click &quot;Add Widget&quot; (note the message &quot;Please create a layer before adding Widgets&quot; but it's still possible to create one) 5. Fill the form and Publish your widget 6. Open your site : its broken ### Expected behavior - Don't allow to publish widget without layer - Don't throw if layer is missing</DESCRIPTION>
  <REPONAME>OrchardCore</REPONAME>
  <TIMEDIFFERENCEDAYS>1</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Make deployment steps orderable (UI only) (#8617)</MESSAGE>
    <SHA>a354e19b1389c8fd71365935afbd4b64e70ba108</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fixes #8608 Adding Widget without layer breaks site (#8610)</MESSAGE>
      <SHA>f443382671d2b1f262ef8054796ec0e650ed5f65</SHA>
      <PATCHEDFILES>
        <FILE>src/OrchardCore.Modules/OrchardCore.Layers/Drivers/LayerMetadataWelder.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Layers/Services/LayerFilter.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Layers/Views/Admin/Index.cshtml</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Layers/Views/LayerMetadata.Edit.cshtml</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
