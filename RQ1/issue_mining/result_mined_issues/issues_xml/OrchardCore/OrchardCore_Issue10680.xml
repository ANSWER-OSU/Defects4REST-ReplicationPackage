<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>10680</ISSUENO>
  <ISSUEURL>https://github.com/OrchardCMS/OrchardCore/issues/10680</ISSUEURL>
  <TITLE>Multiple GetMedia calls when adding a folder</TITLE>
  <DESCRIPTION>When you click OK on the new Media Folder name dialog the first thing it does after creating the new folder is emits 'beforeFolderAdded' which loads the folder we are currently on. Then it emits the 'folderAdded' which selects the new folder (triggering a load of the new folder through the watcher) It appears that both requests are in flight at the same time, and we are seeing that occasionally the beforeFolderAdded request comes in last and then makes it appear as if the new folder has all the contents of the previously selected folder. ```javascript bus.$on('addFolder', function (target, folder) { if (self.model == target) { bus.$emit('beforeFolderAdded', self.model); if (self.children !== null) { self.children.push(folder); } folder.parent = self.model; bus.$emit('folderAdded', folder); } }); ``` It wasn't immediately obvious to me why we load the folder before adding a new folder. Can we just not do that? Or do we need some code to ensure we don't load the out of date data of the first request.</DESCRIPTION>
  <REPONAME>OrchardCore</REPONAME>
  <TIMEDIFFERENCEDAYS>6</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>VS2019 is not supported (#10695)</MESSAGE>
    <SHA>dc12848cc71dc35f471a834e5c6e91f85ea60378</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Removed beforeFolderAdded to stop multiple calls to fetch folders. Issue #10680</MESSAGE>
      <SHA>1905f24169cadcdc98f67a5360dfb3655923bfb6</SHA>
      <PATCHEDFILES>
        <FILE>src/OrchardCore.Modules/OrchardCore.Media/Assets/js/MediaApp/app.js</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Media/Assets/js/MediaApp/folderComponent.js</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
