<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>17725</ISSUENO>
  <ISSUEURL>https://github.com/OrchardCMS/OrchardCore/issues/17725</ISSUEURL>
  <TITLE>Error when trying to import recipe that sets custom user settings.</TITLE>
  <DESCRIPTION>### Describe the bug Error when trying to import recipe that sets custom user settings. ### Orchard Core version 2.1.6 ### To Reproduce 1. Go to '/Admin/DeploymentPlan/Import/Index' 2. Select your recipe and import 3. See error ### Expected behavior I would expect the custom settings to set free from error. I used this same structure in older versions and it worked. ### Logs and screenshots Here is a sample recipe: ``` { &quot;name&quot;: &quot;Create Custom Settings&quot;, &quot;displayName&quot;: &quot;&quot;, &quot;description&quot;: &quot;Last updated: 08.05.2024&quot;, &quot;author&quot;: &quot;Test&quot;, &quot;website&quot;: &quot;&quot;, &quot;version&quot;: &quot;1&quot;, &quot;issetuprecipe&quot;: false, &quot;categories&quot;: [], &quot;tags&quot;: [], &quot;steps&quot;: [ { &quot;name&quot;: &quot;custom-user-settings&quot;, &quot;custom-user-settings&quot;: [ { &quot;userId&quot;: &quot;4rhe8cxd8vnjk0prqx6bbtw1wg&quot;, &quot;user-custom-user-settings&quot;: [ { &quot;ContentType&quot;: &quot;MySettings&quot;, &quot;MySettings&quot;: { &quot;MyField&quot;: { &quot;Text&quot;: &quot;MyValue&quot; } } } ] } ] } ] } ``` After clicking the import button I get this message on the interface: &gt; The import failed with the following errors: Unexpected error occurred while executing the 'custom-user-settings' step. Here is the stacktrace: ``` OrchardCore.Deployment.Controllers.ImportController|ERROR|Unable to import a deployment package. OrchardCore.Recipes.Models.RecipeExecutionException: The node already has a parent. ---&gt; System.InvalidOperationException: The node already has a parent. at System.Text.Json.ThrowHelper.ThrowInvalidOperationException_NodeAlreadyHasParent() at System.Text.Json.Nodes.JsonObject.SetItem(String propertyName, JsonNode value) at OrchardCore.Users.Recipes.CustomUserSettingsStep.HandleAsync(RecipeExecutionContext context) at OrchardCore.Recipes.Services.RecipeExecutor.&lt;&gt;c__DisplayClass8_0.&lt;&lt;ExecuteStepAsync&gt;b__0&gt;d.MoveNext() --- End of stack trace from previous location --- at OrchardCore.Environment.Shell.Scope.ShellScope.UsingAsync(Func`2 execute, Boolean activateShell) at OrchardCore.Environment.Shell.Scope.ShellScope.UsingAsync(Func`2 execute, Boolean activateShell) at OrchardCore.Environment.Shell.Scope.ShellScope.UsingAsync(Func`2 execute, Boolean activateShell) at OrchardCore.Environment.Shell.Scope.ShellScope.UsingAsync(Func`2 execute, Boolean activateShell) at OrchardCore.Environment.Shell.Scope.ShellScope.UsingAsync(Func`2 execute, Boolean activateShell) at OrchardCore.Recipes.Services.RecipeExecutor.ExecuteStepAsync(RecipeExecutionContext recipeStep) at OrchardCore.Recipes.Services.RecipeExecutor.ExecuteAsync(String executionId, RecipeDescriptor recipeDescriptor, IDictionary`2 environment, CancellationToken cancellationToken) --- End of inner exception stack trace --- at OrchardCore.Recipes.Services.RecipeExecutor.ExecuteAsync(String executionId, RecipeDescriptor recipeDescriptor, IDictionary`2 environment, CancellationToken cancellationToken) at OrchardCore.Recipes.Services.RecipeExecutor.ExecuteAsync(String executionId, RecipeDescriptor recipeDescriptor, IDictionary`2 environment, CancellationToken cancellationToken) at OrchardCore.Recipes.Services.RecipeExecutor.ExecuteAsync(String executionId, RecipeDescriptor recipeDescriptor, IDictionary`2 environment, CancellationToken cancellationToken) at OrchardCore.Recipes.Services.RecipeDeploymentTargetHandler.ImportFromFileAsync(IFileProvider fileProvider) at OrchardCore.Deployment.Core.Services.DeploymentManager.ImportDeploymentPackageAsync(IFileProvider deploymentPackage) at OrchardCore.Deployment.Controllers.ImportController.Import(IFormFile importedPackage) at OrchardCore.Recipes.Services.RecipeExecutor.ExecuteAsync(String executionId, RecipeDescriptor recipeDescriptor, IDictionary`2 environment, CancellationToken cancellationToken) at OrchardCore.Recipes.Services.RecipeExecutor.ExecuteAsync(String executionId, RecipeDescriptor recipeDescriptor, IDictionary`2 environment, CancellationToken cancellationToken) at OrchardCore.Recipes.Services.RecipeExecutor.ExecuteAsync(String executionId, RecipeDescriptor recipeDescriptor, IDictionary`2 environment, CancellationToken cancellationToken) at OrchardCore.Recipes.Services.RecipeDeploymentTargetHandler.ImportFromFileAsync(IFileProvider fileProvider) at OrchardCore.Deployment.Core.Services.DeploymentManager.ImportDeploymentPackageAsync(IFileProvider deploymentPackage) at OrchardCore.Deployment.Controllers.ImportController.Import(IFormFile importedPackage) ```</DESCRIPTION>
  <REPONAME>OrchardCore</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Fix media resource dependencies (#17720)</MESSAGE>
    <SHA>9bf2991e770e17047fc08173271bab561b11ae8d</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fix a bug in the Custom User Settings Fix #17725</MESSAGE>
      <SHA>3fcd1eb56fed53215e5597feff0e7a41612d80cd</SHA>
      <PATCHEDFILES>
        <FILE>src/OrchardCore.Modules/OrchardCore.Users/Recipes/CustomUserSettingsStep.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fix a bug in the Custom User Settings Fix #17725</MESSAGE>
      <SHA>47378509767a7872d49ce4235e40777300ccd0c2</SHA>
      <PATCHEDFILES>
        <FILE>src/OrchardCore.Modules/OrchardCore.Users/Recipes/CustomUserSettingsStep.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
