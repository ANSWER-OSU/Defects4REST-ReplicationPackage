<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>11953</ISSUENO>
  <ISSUEURL>https://github.com/OrchardCMS/OrchardCore/issues/11953</ISSUEURL>
  <TITLE>InvalidOperationException when using responseWrite scripting method</TITLE>
  <DESCRIPTION>I'm getting **InvalidOperationException** when using **responseWrite** scripting method. ``` info: Microsoft.AspNetCore.Hosting.Diagnostics[1] Request starting HTTP/1.1 GET https://localhost:5001/workflows/Invoke?token=CfDJ8Eccv2rzJ8pOsQGIv-oI-6cWwyOvjunMaqTWq_jcEcY0NkLbf5JNyYB2ZbY1fj27bFXUunUUNKXl2FSfHa4zfffO0VytS91u4s7j3ozewqW_M_JPrPST0i4urJCrPTzFKoIvKA95lC1Pl0SashQXbhL_9TaWCOiK6YaNYRwGWkGY8jf8HENyNCOWm3aqD8PCDO2lpbnTr4ky9_GWDQTkMrbxTkqYMVQE41AM-0ez343a - - Microsoft.AspNetCore.Hosting.Diagnostics: Information: Request starting HTTP/1.1 GET https://localhost:5001/workflows/Invoke?token=CfDJ8Eccv2rzJ8pOsQGIv-oI-6cWwyOvjunMaqTWq_jcEcY0NkLbf5JNyYB2ZbY1fj27bFXUunUUNKXl2FSfHa4zfffO0VytS91u4s7j3ozewqW_M_JPrPST0i4urJCrPTzFKoIvKA95lC1Pl0SashQXbhL_9TaWCOiK6YaNYRwGWkGY8jf8HENyNCOWm3aqD8PCDO2lpbnTr4ky9_GWDQTkMrbxTkqYMVQE41AM-0ez343a - - OrchardCore.Modules.ModularTenantRouterMiddleware: Information: Begin Routing Request info: OrchardCore.Modules.ModularTenantRouterMiddleware[0] Begin Routing Request Microsoft.AspNetCore.Routing.EndpointMiddleware: Information: Executing endpoint 'OrchardCore.Workflows.Http.Controllers.HttpWorkflowController.Invoke (OrchardCore.Workflows)' info: Microsoft.AspNetCore.Routing.EndpointMiddleware[0] Executing endpoint 'OrchardCore.Workflows.Http.Controllers.HttpWorkflowController.Invoke (OrchardCore.Workflows)' Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker: Information: Route matched with {area = &quot;OrchardCore.Workflows&quot;, action = &quot;Invoke&quot;, controller = &quot;HttpWorkflow&quot;}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Invoke(System.String) on controller OrchardCore.Workflows.Http.Controllers.HttpWorkflowController (OrchardCore.Workflows). info: Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker[3] Route matched with {area = &quot;OrchardCore.Workflows&quot;, action = &quot;Invoke&quot;, controller = &quot;HttpWorkflow&quot;}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Invoke(System.String) on controller OrchardCore.Workflows.Http.Controllers.HttpWorkflowController (OrchardCore.Workflows). OrchardCore.Workflows.Http.Controllers.HttpWorkflowController: Debug: Invoking new workflow of type '4qcvrdnwpnck85v99s6cypg3ws' with start activity '4vpxs6hpwaxc45qzeqzbqh95dh' dbug: OrchardCore.Workflows.Http.Controllers.HttpWorkflowController[0] Invoking new workflow of type '4qcvrdnwpnck85v99s6cypg3ws' with start activity '4vpxs6hpwaxc45qzeqzbqh95dh' Microsoft.AspNetCore.Mvc.Infrastructure.ObjectResultExecutor: Information: Executing AcceptedResult, writing value of type 'null'. info: Microsoft.AspNetCore.Mvc.Infrastructure.ObjectResultExecutor[1] Executing AcceptedResult, writing value of type 'null'. Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker: Information: Executed action OrchardCore.Workflows.Http.Controllers.HttpWorkflowController.Invoke (OrchardCore.Workflows) in 17.1947ms info: Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker[2] Executed action OrchardCore.Workflows.Http.Controllers.HttpWorkflowController.Invoke (OrchardCore.Workflows) in 17.1947ms Microsoft.AspNetCore.Routing.EndpointMiddleware: Information: Executed endpoint 'OrchardCore.Workflows.Http.Controllers.HttpWorkflowController.Invoke (OrchardCore.Workflows)' info: Microsoft.AspNetCore.Routing.EndpointMiddleware[1] Executed endpoint 'OrchardCore.Workflows.Http.Controllers.HttpWorkflowController.Invoke (OrchardCore.Workflows)' Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddleware: Error: An unhandled exception has occurred while executing the request. System.InvalidOperationException: StatusCode cannot be set because the response has already started. at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ThrowResponseAlreadyStartedException(String value) at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.Microsoft.AspNetCore.Http.Features.IHttpResponseFeature.set_StatusCode(Int32 value) at Microsoft.AspNetCore.Http.DefaultHttpResponse.set_StatusCode(Int32 value) at Microsoft.AspNetCore.Mvc.ObjectResult.OnFormatting(ActionContext context) at Microsoft.AspNetCore.Mvc.AcceptedResult.OnFormatting(ActionContext context) at Microsoft.AspNetCore.Mvc.Infrastructure.ObjectResultExecutor.ExecuteAsyncCore(ActionContext context, ObjectResult result, Type objectType, Object value) at Microsoft.AspNetCore.Mvc.Infrastructure.ObjectResultExecutor.ExecuteAsync(ActionContext context, ObjectResult result) at Microsoft.AspNetCore.Mvc.ObjectResult.ExecuteResultAsync(ActionContext context) at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.ResultNext[TFilter,TFilterAsync](State&amp; next, Scope&amp; scope, Object&amp; state, Boolean&amp; isCompleted) at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.InvokeNextResultFilterAsync[TFilter,TFilterAsync]() --- End of stack trace from previous location --- at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResultExecutedContextSealed context) at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.ResultNext[TFilter,TFilterAsync](State&amp; next, Scope&amp; scope, Object&amp; state, Boolean&amp; isCompleted) at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.InvokeResultFilters() --- End of stack trace from previous location --- at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.&lt;InvokeNextResourceFilter&gt;g__Awaited|25_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted) at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResourceExecutedContextSealed context) at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Next(State&amp; next, Scope&amp; scope, Object&amp; state, Boolean&amp; isCompleted) at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.InvokeFilterPipelineAsync() --- End of stack trace from previous location --- at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.&lt;InvokeAsync&gt;g__Logged|17_1(ResourceInvoker invoker) at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.&lt;InvokeAsync&gt;g__Logged|17_1(ResourceInvoker invoker) at Microsoft.AspNetCore.Routing.EndpointMiddleware.&lt;Invoke&gt;g__AwaitRequestTask|6_0(Endpoint endpoint, Task requestTask, ILogger logger) at SixLabors.ImageSharp.Web.Middleware.ImageSharpMiddleware.Invoke(HttpContext httpContext, Boolean retry) at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context) at OrchardCore.Apis.GraphQL.GraphQLMiddleware.Invoke(HttpContext context, IAuthorizationService authorizationService, IAuthenticationService authenticationService, ISchemaFactory schemaService) at OrchardCore.Liquid.ScriptsMiddleware.Invoke(HttpContext httpContext) at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context) at Microsoft.AspNetCore.Localization.RequestLocalizationMiddleware.Invoke(HttpContext context) at OrchardCore.Diagnostics.DiagnosticsStartupFilter.&lt;&gt;c__DisplayClass3_0.&lt;&lt;Configure&gt;b__1&gt;d.MoveNext() --- End of stack trace from previous location --- at Microsoft.AspNetCore.Diagnostics.StatusCodePagesMiddleware.Invoke(HttpContext context) at OrchardCore.ContentPreview.PreviewStartupFilter.&lt;&gt;c.&lt;&lt;Configure&gt;b__1_1&gt;d.MoveNext() --- End of stack trace from previous location --- at OrchardCore.Modules.ModularTenantRouterMiddleware.Invoke(HttpContext httpContext) at OrchardCore.Modules.ModularTenantContainerMiddleware.&lt;&gt;c__DisplayClass4_0.&lt;&lt;Invoke&gt;b__0&gt;d.MoveNext() --- End of stack trace from previous location --- at OrchardCore.Environment.Shell.Scope.ShellScope.UsingAsync(Func`2 execute, Boolean activateShell) at OrchardCore.Environment.Shell.Scope.ShellScope.UsingAsync(Func`2 execute, Boolean activateShell) at OrchardCore.Environment.Shell.Scope.ShellScope.UsingAsync(Func`2 execute, Boolean activateShell) at OrchardCore.Environment.Shell.Scope.ShellScope.UsingAsync(Func`2 execute, Boolean activateShell) at OrchardCore.Modules.ModularTenantContainerMiddleware.Invoke(HttpContext httpContext) at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddleware.Invoke(HttpContext context) fail: Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddleware[1] An unhandled exception has occurred while executing the request. System.InvalidOperationException: StatusCode cannot be set because the response has already started. at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ThrowResponseAlreadyStartedException(String value) at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.Microsoft.AspNetCore.Http.Features.IHttpResponseFeature.set_StatusCode(Int32 value) at Microsoft.AspNetCore.Http.DefaultHttpResponse.set_StatusCode(Int32 value) at Microsoft.AspNetCore.Mvc.ObjectResult.OnFormatting(ActionContext context) at Microsoft.AspNetCore.Mvc.AcceptedResult.OnFormatting(ActionContext context) at Microsoft.AspNetCore.Mvc.Infrastructure.ObjectResultExecutor.ExecuteAsyncCore(ActionContext context, ObjectResult result, Type objectType, Object value) at Microsoft.AspNetCore.Mvc.Infrastructure.ObjectResultExecutor.ExecuteAsync(ActionContext context, ObjectResult result) at Microsoft.AspNetCore.Mvc.ObjectResult.ExecuteResultAsync(ActionContext context) at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.ResultNext[TFilter,TFilterAsync](State&amp; next, Scope&amp; scope, Object&amp; state, Boolean&amp; isCompleted) at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.InvokeNextResultFilterAsync[TFilter,TFilterAsync]() --- End of stack trace from previous location --- at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResultExecutedContextSealed context) at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.ResultNext[TFilter,TFilterAsync](State&amp; next, Scope&amp; scope, Object&amp; state, Boolean&amp; isCompleted) at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.InvokeResultFilters() --- End of stack trace from previous location --- at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.&lt;InvokeNextResourceFilter&gt;g__Awaited|25_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted) at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResourceExecutedContextSealed context) at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Next(State&amp; next, Scope&amp; scope, Object&amp; state, Boolean&amp; isCompleted) at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.InvokeFilterPipelineAsync() --- End of stack trace from previous location --- at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.&lt;InvokeAsync&gt;g__Logged|17_1(ResourceInvoker invoker) at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.&lt;InvokeAsync&gt;g__Logged|17_1(ResourceInvoker invoker) at Microsoft.AspNetCore.Routing.EndpointMiddleware.&lt;Invoke&gt;g__AwaitRequestTask|6_0(Endpoint endpoint, Task requestTask, ILogger logger) at SixLabors.ImageSharp.Web.Middleware.ImageSharpMiddleware.Invoke(HttpContext httpContext, Boolean retry) at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context) at OrchardCore.Apis.GraphQL.GraphQLMiddleware.Invoke(HttpContext context, IAuthorizationService authorizationService, IAuthenticationService authenticationService, ISchemaFactory schemaService) at OrchardCore.Liquid.ScriptsMiddleware.Invoke(HttpContext httpContext) at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context) at Microsoft.AspNetCore.Localization.RequestLocalizationMiddleware.Invoke(HttpContext context) at OrchardCore.Diagnostics.DiagnosticsStartupFilter.&lt;&gt;c__DisplayClass3_0.&lt;&lt;Configure&gt;b__1&gt;d.MoveNext() --- End of stack trace from previous location --- at Microsoft.AspNetCore.Diagnostics.StatusCodePagesMiddleware.Invoke(HttpContext context) at OrchardCore.ContentPreview.PreviewStartupFilter.&lt;&gt;c.&lt;&lt;Configure&gt;b__1_1&gt;d.MoveNext() --- End of stack trace from previous location --- at OrchardCore.Modules.ModularTenantRouterMiddleware.Invoke(HttpContext httpContext) at OrchardCore.Modules.ModularTenantContainerMiddleware.&lt;&gt;c__DisplayClass4_0.&lt;&lt;Invoke&gt;b__0&gt;d.MoveNext() --- End of stack trace from previous location --- at OrchardCore.Environment.Shell.Scope.ShellScope.UsingAsync(Func`2 execute, Boolean activateShell) at OrchardCore.Environment.Shell.Scope.ShellScope.UsingAsync(Func`2 execute, Boolean activateShell) at OrchardCore.Environment.Shell.Scope.ShellScope.UsingAsync(Func`2 execute, Boolean activateShell) at OrchardCore.Environment.Shell.Scope.ShellScope.UsingAsync(Func`2 execute, Boolean activateShell) at OrchardCore.Modules.ModularTenantContainerMiddleware.Invoke(HttpContext httpContext) at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddleware.Invoke(HttpContext context) Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddleware: Warning: The response has already started, the error page middleware will not be executed. warn: Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddleware[2] The response has already started, the error page middleware will not be executed. fail: Microsoft.AspNetCore.Server.Kestrel[13] Connection id &quot;0HMITFOP71NAH&quot;, Request id &quot;0HMITFOP71NAH:00000002&quot;: An unhandled exception was thrown by the application. System.InvalidOperationException: StatusCode cannot be set because the response has already started. at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ThrowResponseAlreadyStartedException(String value) at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.Microsoft.AspNetCore.Http.Features.IHttpResponseFeature.set_StatusCode(Int32 value) at Microsoft.AspNetCore.Http.DefaultHttpResponse.set_StatusCode(Int32 value) at Microsoft.AspNetCore.Mvc.ObjectResult.OnFormatting(ActionContext context) at Microsoft.AspNetCore.Mvc.AcceptedResult.OnFormatting(ActionContext context) at Microsoft.AspNetCore.Mvc.Infrastructure.ObjectResultExecutor.ExecuteAsyncCore(ActionContext context, ObjectResult result, Type objectType, Object value) at Microsoft.AspNetCore.Mvc.Infrastructure.ObjectResultExecutor.ExecuteAsync(ActionContext context, ObjectResult result) at Microsoft.AspNetCore.Mvc.ObjectResult.ExecuteResultAsync(ActionContext context) at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.ResultNext[TFilter,TFilterAsync](State&amp; next, Scope&amp; scope, Object&amp; state, Boolean&amp; isCompleted) at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.InvokeNextResultFilterAsync[TFilter,TFilterAsync]() --- End of stack trace from previous location --- at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResultExecutedContextSealed context) at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.ResultNext[TFilter,TFilterAsync](State&amp; next, Scope&amp; scope, Object&amp; state, Boolean&amp; isCompleted) at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.InvokeResultFilters() --- End of stack trace from previous location --- at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.&lt;InvokeNextResourceFilter&gt;g__Awaited|25_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted) at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResourceExecutedContextSealed context) at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Next(State&amp; next, Scope&amp; scope, Object&amp; state, Boolean&amp; isCompleted) at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.InvokeFilterPipelineAsync() --- End of stack trace from previous location --- at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.&lt;InvokeAsync&gt;g__Logged|17_1(ResourceInvoker invoker) at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.&lt;InvokeAsync&gt;g__Logged|17_1(ResourceInvoker invoker) at Microsoft.AspNetCore.Routing.EndpointMiddleware.&lt;Invoke&gt;g__AwaitRequestTask|6_0(Endpoint endpoint, Task requestTask, ILogger logger) at SixLabors.ImageSharp.Web.Middleware.ImageSharpMiddleware.Invoke(HttpContext httpContext, Boolean retry) at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context) at OrchardCore.Apis.GraphQL.GraphQLMiddleware.Invoke(HttpContext context, IAuthorizationService authorizationService, IAuthenticationService authenticationService, ISchemaFactory schemaService) at OrchardCore.Liquid.ScriptsMiddleware.Invoke(HttpContext httpContext) at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context) at Microsoft.AspNetCore.Localization.RequestLocalizationMiddleware.Invoke(HttpContext context) at OrchardCore.Diagnostics.DiagnosticsStartupFilter.&lt;&gt;c__DisplayClass3_0.&lt;&lt;Configure&gt;b__1&gt;d.MoveNext() --- End of stack trace from previous location --- at Microsoft.AspNetCore.Diagnostics.StatusCodePagesMiddleware.Invoke(HttpContext context) at OrchardCore.ContentPreview.PreviewStartupFilter.&lt;&gt;c.&lt;&lt;Configure&gt;b__1_1&gt;d.MoveNext() --- End of stack trace from previous location --- at OrchardCore.Modules.ModularTenantRouterMiddleware.Invoke(HttpContext httpContext) at OrchardCore.Modules.ModularTenantContainerMiddleware.&lt;&gt;c__DisplayClass4_0.&lt;&lt;Invoke&gt;b__0&gt;d.MoveNext() --- End of stack trace from previous location --- at OrchardCore.Environment.Shell.Scope.ShellScope.UsingAsync(Func`2 execute, Boolean activateShell) at OrchardCore.Environment.Shell.Scope.ShellScope.UsingAsync(Func`2 execute, Boolean activateShell) at OrchardCore.Environment.Shell.Scope.ShellScope.UsingAsync(Func`2 execute, Boolean activateShell) at OrchardCore.Environment.Shell.Scope.ShellScope.UsingAsync(Func`2 execute, Boolean activateShell) at OrchardCore.Modules.ModularTenantContainerMiddleware.Invoke(HttpContext httpContext) at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddleware.Invoke(HttpContext context) at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddleware.Invoke(HttpContext context) at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application) Microsoft.AspNetCore.Server.Kestrel: Error: Connection id &quot;0HMITFOP71NAH&quot;, Request id &quot;0HMITFOP71NAH:00000002&quot;: An unhandled exception was thrown by the application. System.InvalidOperationException: StatusCode cannot be set because the response has already started. at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ThrowResponseAlreadyStartedException(String value) at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.Microsoft.AspNetCore.Http.Features.IHttpResponseFeature.set_StatusCode(Int32 value) at Microsoft.AspNetCore.Http.DefaultHttpResponse.set_StatusCode(Int32 value) at Microsoft.AspNetCore.Mvc.ObjectResult.OnFormatting(ActionContext context) at Microsoft.AspNetCore.Mvc.AcceptedResult.OnFormatting(ActionContext context) at Microsoft.AspNetCore.Mvc.Infrastructure.ObjectResultExecutor.ExecuteAsyncCore(ActionContext context, ObjectResult result, Type objectType, Object value) at Microsoft.AspNetCore.Mvc.Infrastructure.ObjectResultExecutor.ExecuteAsync(ActionContext context, ObjectResult result) at Microsoft.AspNetCore.Mvc.ObjectResult.ExecuteResultAsync(ActionContext context) at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.ResultNext[TFilter,TFilterAsync](State&amp; next, Scope&amp; scope, Object&amp; state, Boolean&amp; isCompleted) at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.InvokeNextResultFilterAsync[TFilter,TFilterAsync]() --- End of stack trace from previous location --- at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResultExecutedContextSealed context) at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.ResultNext[TFilter,TFilterAsync](State&amp; next, Scope&amp; scope, Object&amp; state, Boolean&amp; isCompleted) at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.InvokeResultFilters() --- End of stack trace from previous location --- at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.&lt;InvokeNextResourceFilter&gt;g__Awaited|25_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted) at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResourceExecutedContextSealed context) at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Next(State&amp; next, Scope&amp; scope, Object&amp; state, Boolean&amp; isCompleted) at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.InvokeFilterPipelineAsync() --- End of stack trace from previous location --- at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.&lt;InvokeAsync&gt;g__Logged|17_1(ResourceInvoker invoker) at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.&lt;InvokeAsync&gt;g__Logged|17_1(ResourceInvoker invoker) at Microsoft.AspNetCore.Routing.EndpointMiddleware.&lt;Invoke&gt;g__AwaitRequestTask|6_0(Endpoint endpoint, Task requestTask, ILogger logger) at SixLabors.ImageSharp.Web.Middleware.ImageSharpMiddleware.Invoke(HttpContext httpContext, Boolean retry) at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context) at OrchardCore.Apis.GraphQL.GraphQLMiddleware.Invoke(HttpContext context, IAuthorizationService authorizationService, IAuthenticationService authenticationService, ISchemaFactory schemaService) at OrchardCore.Liquid.ScriptsMiddleware.Invoke(HttpContext httpContext) at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context) at Microsoft.AspNetCore.Localization.RequestLocalizationMiddleware.Invoke(HttpContext context) at OrchardCore.Diagnostics.DiagnosticsStartupFilter.&lt;&gt;c__DisplayClass3_0.&lt;&lt;Configure&gt;b__1&gt;d.MoveNext() --- End of stack trace from previous location --- at Microsoft.AspNetCore.Diagnostics.StatusCodePagesMiddleware.Invoke(HttpContext context) at OrchardCore.ContentPreview.PreviewStartupFilter.&lt;&gt;c.&lt;&lt;Configure&gt;b__1_1&gt;d.MoveNext() --- End of stack trace from previous location --- at OrchardCore.Modules.ModularTenantRouterMiddleware.Invoke(HttpContext httpContext) at OrchardCore.Modules.ModularTenantContainerMiddleware.&lt;&gt;c__DisplayClass4_0.&lt;&lt;Invoke&gt;b__0&gt;d.MoveNext() --- End of stack trace from previous location --- at OrchardCore.Environment.Shell.Scope.ShellScope.UsingAsync(Func`2 execute, Boolean activateShell) at OrchardCore.Environment.Shell.Scope.ShellScope.UsingAsync(Func`2 execute, Boolean activateShell) at OrchardCore.Environment.Shell.Scope.ShellScope.UsingAsync(Func`2 execute, Boolean activateShell) at OrchardCore.Environment.Shell.Scope.ShellScope.UsingAsync(Func`2 execute, Boolean activateShell) at OrchardCore.Modules.ModularTenantContainerMiddleware.Invoke(HttpContext httpContext) at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddleware.Invoke(HttpContext context) at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddleware.Invoke(HttpContext context) at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application) Microsoft.AspNetCore.Hosting.Diagnostics: Information: Request finished HTTP/1.1 GET https://localhost:5001/workflows/Invoke?token=CfDJ8Eccv2rzJ8pOsQGIv-oI-6cWwyOvjunMaqTWq_jcEcY0NkLbf5JNyYB2ZbY1fj27bFXUunUUNKXl2FSfHa4zfffO0VytS91u4s7j3ozewqW_M_JPrPST0i4urJCrPTzFKoIvKA95lC1Pl0SashQXbhL_9TaWCOiK6YaNYRwGWkGY8jf8HENyNCOWm3aqD8PCDO2lpbnTr4ky9_GWDQTkMrbxTkqYMVQE41AM-0ez343a - - - 200 - - 237.3082ms info: Microsoft.AspNetCore.Hosting.Diagnostics[2] Request finished HTTP/1.1 GET https://localhost:5001/workflows/Invoke?token=CfDJ8Eccv2rzJ8pOsQGIv-oI-6cWwyOvjunMaqTWq_jcEcY0NkLbf5JNyYB2ZbY1fj27bFXUunUUNKXl2FSfHa4zfffO0VytS91u4s7j3ozewqW_M_JPrPST0i4urJCrPTzFKoIvKA95lC1Pl0SashQXbhL_9TaWCOiK6YaNYRwGWkGY8jf8HENyNCOWm3aqD8PCDO2lpbnTr4ky9_GWDQTkMrbxTkqYMVQE41AM-0ez343a - - - 200 - - 237.3082ms info: OrchardCore.Modules.ModularBackgroundService[0] Start processing background task 'OrchardCore.Workflows.Timers.TimerBackgroundTask' on tenant 'Default'. OrchardCore.Modules.ModularBackgroundService: Information: Start processing background task 'OrchardCore.Workflows.Timers.TimerBackgroundTask' on tenant 'Default'. info: OrchardCore.Modules.ModularBackgroundService[0] Finished processing background task 'OrchardCore.Workflows.Timers.TimerBackgroundTask' on tenant 'Default'. OrchardCore.Modules.ModularBackgroundService: Information: Finished processing background task 'OrchardCore.Workflows.Timers.TimerBackgroundTask' on tenant 'Default'. ``` you can try to repro this issue, using simple workflow: ``` { &quot;name&quot;: &quot;&quot;, &quot;displayName&quot;: &quot;&quot;, &quot;description&quot;: &quot;&quot;, &quot;author&quot;: &quot;&quot;, &quot;website&quot;: &quot;&quot;, &quot;version&quot;: &quot;&quot;, &quot;issetuprecipe&quot;: false, &quot;categories&quot;: [], &quot;tags&quot;: [], &quot;steps&quot;: [ { &quot;name&quot;: &quot;Feature&quot;, &quot;enable&quot;: [ &quot;Application.Default&quot;, &quot;TryOrchardCore.Web&quot;, &quot;OrchardCore.Settings&quot;, &quot;OrchardCore.Admin&quot;, &quot;OrchardCore.Liquid&quot;, &quot;OrchardCore.Contents&quot;, &quot;OrchardCore.ContentTypes&quot;, &quot;OrchardCore.Templates&quot;, &quot;OrchardCore.Alias&quot;, &quot;OrchardCore.Autoroute&quot;, &quot;OrchardCore.Resources&quot;, &quot;OrchardCore.Features&quot;, &quot;OrchardCore.Scripting&quot;, &quot;OrchardCore.Recipes&quot;, &quot;OrchardCore.Shortcodes&quot;, &quot;OrchardCore.ContentFields&quot;, &quot;OrchardCore.Users&quot;, &quot;OrchardCore.ContentPreview&quot;, &quot;OrchardCore.Deployment&quot;, &quot;OrchardCore.CustomSettings&quot;, &quot;OrchardCore.Deployment.Remote&quot;, &quot;OrchardCore.Diagnostics&quot;, &quot;OrchardCore.DynamicCache&quot;, &quot;OrchardCore.Widgets&quot;, &quot;OrchardCore.Flows&quot;, &quot;OrchardCore.HomeRoute&quot;, &quot;OrchardCore.Html&quot;, &quot;OrchardCore.Rules&quot;, &quot;OrchardCore.Layers&quot;, &quot;OrchardCore.Lists&quot;, &quot;OrchardCore.Markdown&quot;, &quot;OrchardCore.Media&quot;, &quot;OrchardCore.Title&quot;, &quot;OrchardCore.Menu&quot;, &quot;OrchardCore.Navigation&quot;, &quot;OrchardCore.Placements&quot;, &quot;OrchardCore.Queries&quot;, &quot;OrchardCore.Roles&quot;, &quot;OrchardCore.Security&quot;, &quot;OrchardCore.Shortcodes.Templates&quot;, &quot;OrchardCore.Themes&quot;, &quot;OrchardCore.Workflows&quot;, &quot;OrchardCore.Workflows.Http&quot;, &quot;SafeMode&quot;, &quot;TheAdmin&quot;, &quot;TheAgencyTheme&quot; ] }, { &quot;name&quot;: &quot;WorkflowType&quot;, &quot;data&quot;: [ { &quot;WorkflowTypeId&quot;: &quot;4qcvrdnwpnck85v99s6cypg3ws&quot;, &quot;Name&quot;: &quot;responseWriteTest&quot;, &quot;IsEnabled&quot;: true, &quot;IsSingleton&quot;: false, &quot;LockTimeout&quot;: 0, &quot;LockExpiration&quot;: 0, &quot;DeleteFinishedWorkflows&quot;: true, &quot;Activities&quot;: [ { &quot;ActivityId&quot;: &quot;4vpxs6hpwaxc45qzeqzbqh95dh&quot;, &quot;Name&quot;: &quot;HttpRequestEvent&quot;, &quot;X&quot;: 0, &quot;Y&quot;: 0, &quot;IsStart&quot;: true, &quot;Properties&quot;: { &quot;ActivityMetadata&quot;: { &quot;Title&quot;: null }, &quot;HttpMethod&quot;: &quot;GET&quot;, &quot;Url&quot;: &quot;/mv33qwd2/workflows/Invoke?token=CfDJ8ERCgEhYWqBJtj7bUEDc0fqUPbpgxfg6fGm5_29QA9X0adxzwJYSBMqpF7lqjVg57ZwZ4YWHONHLTaJxdnsv0Cg07i6xZpqyttyqYbUzYg50oc86WgCB4XlH3MFREe90ITOBeiQEKsfTASx_dlkmCpDY28Y-VQwbMqYmtd7LfNAHUOZk9NUS7B2ptdaJ1ehrnKyljz2DuJRJBGGTCfp37MtTo4BfOFPsOEqz7a2F15MH&quot;, &quot;ValidateAntiforgeryToken&quot;: false, &quot;TokenLifeSpan&quot;: 0 } }, { &quot;ActivityId&quot;: &quot;407yt6pq132en6n1p71art555v&quot;, &quot;Name&quot;: &quot;ScriptTask&quot;, &quot;X&quot;: 460, &quot;Y&quot;: 10, &quot;IsStart&quot;: false, &quot;Properties&quot;: { &quot;ActivityMetadata&quot;: { &quot;Title&quot;: null }, &quot;AvailableOutcomes&quot;: [ &quot;Done&quot; ], &quot;Script&quot;: { &quot;Expression&quot;: &quot;responseWrite(\&quot;&lt;h1&gt;hello world&lt;/h1&gt;\&quot;);\r\nsetOutcome('Done');&quot; } } } ], &quot;Transitions&quot;: [ { &quot;Id&quot;: 0, &quot;SourceActivityId&quot;: &quot;4vpxs6hpwaxc45qzeqzbqh95dh&quot;, &quot;SourceOutcomeName&quot;: &quot;Done&quot;, &quot;DestinationActivityId&quot;: &quot;407yt6pq132en6n1p71art555v&quot; } ] } ] } ] } ``` (You may need to regenerate HttpRequestEvent url.)</DESCRIPTION>
  <REPONAME>OrchardCore</REPONAME>
  <TIMEDIFFERENCEDAYS>657</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>ReadAsByteArray</MESSAGE>
    <SHA>7cb451d3a8f3cc3ac3125a6124f1ece1c6dbdf50</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>same fix as for #11953</MESSAGE>
      <SHA>70f054a8f439389a76a69335e556753570c33615</SHA>
      <PATCHEDFILES>
        <FILE>src/OrchardCore.Modules/OrchardCore.Workflows/Http/Scripting/HttpMethodsProvider.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
