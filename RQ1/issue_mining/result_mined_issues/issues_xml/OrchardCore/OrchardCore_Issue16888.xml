<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>16888</ISSUENO>
  <ISSUEURL>https://github.com/OrchardCMS/OrchardCore/issues/16888</ISSUEURL>
  <TITLE>Azure email provider can't handle display names in email addresses</TITLE>
  <DESCRIPTION>### Describe the bug The Azure email provider surfaces an exception from `Azure.Communication.Email` when it passes in email addresses that include a display name to the constructor of the `EmailAddress` class in `AzureEmailProviderBase`. ### Orchard Core version 2.0 ### To Reproduce 1. Configure the application to use Azure Email Communication Services and enable the `Orchard.Email.Azure` feature. 2. Use the email test settings screen (`/Admin/Email/Test`) and provide an email address in the `Display Name &lt;email@domain.com&gt;` format in any of the fields that accept an email address. ### Expected behavior The provider should deconstruct such email addresses and use the other overload of the `AzureEmailProviderBase` constructor which accepts a separate display name parameter too. `Orchard.Email.Smtp` handles this correctly, because MimeKit takes care of deconstructing such email addresses. The display name for the sender field is simply dropped, because the SDK doesn't support it: https://github.com/Azure/azure-sdk-for-net/issues/43847</DESCRIPTION>
  <REPONAME>OrchardCore</REPONAME>
  <TIMEDIFFERENCEDAYS>12</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Cleanup OptionsFluidParser Helper (#16872) Co-authored-by: Zoltán Lehóczky &lt;zoltan.lehoczky@lombiq.com&gt;</MESSAGE>
    <SHA>50d67e38132cffe60b63544271a26ae66d8242ac</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Email.Azure: Deconstructing email addresses that include a display name (#16888)</MESSAGE>
      <SHA>6381885d00ad4c60640f03478f4306fa9eaf3d4d</SHA>
      <PATCHEDFILES>
        <FILE>src/OrchardCore.Modules/OrchardCore.Email.Azure/Services/AzureEmailProviderBase.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Merge remote-tracking branch 'origin/main' into BenedekFarkas/#16888</MESSAGE>
      <SHA>8f07a141dbe1a6b5e6719828781b67b2bdd505d6</SHA>
      <PATCHEDFILES>
        <FILE>src/OrchardCore.Modules/OrchardCore.Email/Manifest.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.Data.YesSql/DbConnectionValidator.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.Data.YesSql/OrchardCoreBuilderExtensions.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.Data.YesSql/SqliteHelper.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.Setup.Core/OrchardCore.Setup.Core.csproj</FILE>
        <FILE>src/OrchardCore/OrchardCore.Setup.Core/SetupService.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Merge remote-tracking branch 'origin/main' into BenedekFarkas/#16888</MESSAGE>
      <SHA>8d394f8b3fb51a833413cdfa9f465a15a49269a1</SHA>
      <PATCHEDFILES>
        <FILE>src/docs/requirements.txt</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Merge branch 'main' into BenedekFarkas/#16888</MESSAGE>
      <SHA>d12332e0a35cde70d42a973711facde12e181f9a</SHA>
      <PATCHEDFILES>
        <FILE>.all-contributorsrc</FILE>
        <FILE>.github/ISSUE_TEMPLATE/bug_report.md</FILE>
        <FILE>.github/ISSUE_TEMPLATE/feature_request.md</FILE>
        <FILE>.github/ISSUE_TEMPLATE/thanks.md</FILE>
        <FILE>OrchardCore.sln</FILE>
        <FILE>mkdocs.yml</FILE>
        <FILE>src/OrchardCore.Cms.Web/appsettings.json</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.AuditTrail/package-lock.json</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.ContentTypes/Editors/ContentTypeSettingsDisplayDriver.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.DataProtection.Azure/BlobModularTenantEvents.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Flows/Views/BagPart.Edit.cshtml</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Media/Services/MediaOptionsConfiguration.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Resources/ResourceManagementOptionsConfiguration.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Resources/package-lock.json</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Resources/package.json</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Resources/wwwroot/Scripts/Sortable.js</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Resources/wwwroot/Scripts/Sortable.min.js</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Search.Elasticsearch/Controllers/AdminController.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Search.Elasticsearch/Extensions/ElasticsearchOptionsExtensions.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Search.Elasticsearch/Startup.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Search.Elasticsearch/ViewModels/IndexInfoViewModel.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Search.Elasticsearch/Views/Admin/Index.cshtml</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Search.Elasticsearch/Views/Admin/IndexInfo.cshtml</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.UrlRewriting/AdminMenu.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.UrlRewriting/Assets.json</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.UrlRewriting/Assets/js/admin-ui.js</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.UrlRewriting/Assets/js/sortable-rules.js</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.UrlRewriting/Controllers/AdminController.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.UrlRewriting/Drivers/RewriteRulesDisplayDriver.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.UrlRewriting/Drivers/UrlRedirectRuleDisplayDriver.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.UrlRewriting/Drivers/UrlRewriteRuleDisplayDriver.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.UrlRewriting/Endpoints/Rules/SortRulesEndpoint.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.UrlRewriting/Manifest.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.UrlRewriting/OrchardCore.UrlRewriting.csproj</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.UrlRewriting/Recipes/UrlRewritingStep.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.UrlRewriting/Services/ResourceManagementOptionsConfiguration.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.UrlRewriting/Services/UrlRewritingPermissionProvider.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.UrlRewriting/Startup.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.UrlRewriting/ViewModels/EditRewriteRuleViewModel.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.UrlRewriting/ViewModels/ListRewriteRuleViewModel.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.UrlRewriting/ViewModels/RewriteRuleAction.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.UrlRewriting/ViewModels/RewriteRuleEntry.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.UrlRewriting/ViewModels/RewriteRuleOptions.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.UrlRewriting/ViewModels/RewriteRuleViewModel.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.UrlRewriting/ViewModels/UrlRedirectRuleViewModel.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.UrlRewriting/ViewModels/UrlRewriteRuleViewModel.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.UrlRewriting/Views/Admin/Create.cshtml</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.UrlRewriting/Views/Admin/Edit.cshtml</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.UrlRewriting/Views/Admin/Index.cshtml</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.UrlRewriting/Views/NavigationItemText-urlrewriting.Id.cshtml</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.UrlRewriting/Views/RewriteRule.Buttons.SummaryAdmin.cshtml</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.UrlRewriting/Views/RewriteRule.DefaultMeta.SummaryAdmin.cshtml</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.UrlRewriting/Views/RewriteRule.DefaultTags.SummaryAdmin.cshtml</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.UrlRewriting/Views/RewriteRule.Edit.cshtml</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.UrlRewriting/Views/RewriteRule.Fields.Edit.cshtml</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.UrlRewriting/Views/RewriteRule.Fields.SummaryAdmin.cshtml</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.UrlRewriting/Views/RewriteRule.Link.cshtml</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.UrlRewriting/Views/RewriteRule.SummaryAdmin.cshtml</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.UrlRewriting/Views/UrlRedirectRule.Edit.cshtml</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.UrlRewriting/Views/UrlRewriteRule.Edit.cshtml</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.UrlRewriting/Views/_ViewImports.cshtml</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.UrlRewriting/wwwroot/Scripts/admin-ui.js</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.UrlRewriting/wwwroot/Scripts/admin-ui.min.js</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.UrlRewriting/wwwroot/Scripts/sortable-rules.js</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.UrlRewriting/wwwroot/Scripts/sortable-rules.min.js</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Users/Controllers/AdminTwoFactorAuthenticationController.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Users/Drivers/UserDisplayDriver.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Users/Drivers/UserRegistrationAdminDisplayDriver.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Users/Drivers/UserTwoFactorDisplayDriver.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Users/Extensions/ControllerExtensions.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Users/Liquid/UserFilters.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Users/Services/TwoFactorPermissionProvider.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Users/Startup.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Users/TwoFactorAuthenticationStartup.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Users/Views/Items/UserSendConfirmationActionsMenu.cshtml</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Users/Views/TemplateUserConfirmEmail.cshtml</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Users/Views/User.SummaryAdmin.cshtml</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Users/Views/UserActionsMenu.cshtml</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Users/Views/UserButtons.cshtml</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Users/Views/UserTwoFactorActionsMenu.cshtml</FILE>
        <FILE>src/OrchardCore/OrchardCore.Abstractions/Json/Extensions/JsonNodeExtensions.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.Abstractions/Modules/Extensions/StringBuilderExtensions.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.Abstractions/OrchardCoreConstants.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.Application.Cms.Core.Targets/OrchardCore.Application.Cms.Core.Targets.csproj</FILE>
        <FILE>src/OrchardCore/OrchardCore.DisplayManagement/Descriptors/PlacementInfo.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.DisplayManagement/Views/ShapeResult.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.Search.Elasticsearch.Abstractions/ElasticsearchOptions.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.Search.Elasticsearch.Core/ElasticsearchConstants.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.Search.Elasticsearch.Core/Services/ElasticIndexManager.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.Shells.Azure/Services/BlobShellsFileStore.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.UrlRewriting.Abstractions/IRewriteRuleHandler.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.UrlRewriting.Abstractions/IRewriteRulesManager.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.UrlRewriting.Abstractions/IRewriteRulesStore.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.UrlRewriting.Abstractions/IUrlRewriteRuleSource.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.UrlRewriting.Abstractions/Models/DeletedRewriteRuleContext.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.UrlRewriting.Abstractions/Models/DeletingRewriteRuleContext.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.UrlRewriting.Abstractions/Models/InitializedRewriteRuleContext.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.UrlRewriting.Abstractions/Models/InitializingRewriteRuleContext.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.UrlRewriting.Abstractions/Models/LoadedRewriteRuleContext.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.UrlRewriting.Abstractions/Models/RewriteRule.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.UrlRewriting.Abstractions/Models/RewriteRuleContextBase.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.UrlRewriting.Abstractions/Models/RewriteValidateResult.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.UrlRewriting.Abstractions/Models/SavedRewriteRuleContext.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.UrlRewriting.Abstractions/Models/SavingRewriteRuleContext.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.UrlRewriting.Abstractions/Models/UpdatedRewriteRuleContext.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.UrlRewriting.Abstractions/Models/UpdatingRewriteRuleContext.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.UrlRewriting.Abstractions/Models/ValidatedRewriteRuleContext.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.UrlRewriting.Abstractions/Models/ValidatingRewriteRuleContext.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.UrlRewriting.Abstractions/OrchardCore.UrlRewriting.Abstractions.csproj</FILE>
        <FILE>src/OrchardCore/OrchardCore.UrlRewriting.Core/Extensions/ApplicationBuilderExtensions.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.UrlRewriting.Core/Extensions/ServiceCollectionExtensions.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.UrlRewriting.Core/Handlers/RewriteRuleHandler.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.UrlRewriting.Core/Handlers/RewriteRuleHandlerBase.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.UrlRewriting.Core/Handlers/UrlRedirectRuleHandler.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.UrlRewriting.Core/Handlers/UrlRewriteRuleHandler.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.UrlRewriting.Core/Models/QueryStringPolicy.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.UrlRewriting.Core/Models/RedirectType.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.UrlRewriting.Core/Models/RewriteRulesDocument.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.UrlRewriting.Core/Models/UrlRedirectSourceMetadata.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.UrlRewriting.Core/Models/UrlRewriteSourceMetadata.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.UrlRewriting.Core/OrchardCore.UrlRewriting.Core.csproj</FILE>
        <FILE>src/OrchardCore/OrchardCore.UrlRewriting.Core/PatternHelper.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.UrlRewriting.Core/Rules/ExcludeUrlPrefixRule.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.UrlRewriting.Core/ServiceCollectionExtensions.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.UrlRewriting.Core/Services/RewriteOptionsConfiguration.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.UrlRewriting.Core/Services/RewriteRulesManager.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.UrlRewriting.Core/Services/RewriteRulesStore.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.UrlRewriting.Core/Services/UrlRedirectRuleSource.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.UrlRewriting.Core/Services/UrlRewriteRuleSource.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.UrlRewriting.Core/UrlRewritingPermissions.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.Users.Core/CommonPermissions.cs</FILE>
        <FILE>src/docs/community/contributors/README.md</FILE>
        <FILE>src/docs/reference/README.md</FILE>
        <FILE>src/docs/reference/modules/Media/README.md</FILE>
        <FILE>src/docs/reference/modules/UrlRewriting/README.md</FILE>
        <FILE>src/docs/releases/2.1.0.md</FILE>
        <FILE>src/docs/requirements.txt</FILE>
        <FILE>test/OrchardCore.Tests/DisplayManagement/ShapeResultTests.cs</FILE>
        <FILE>test/OrchardCore.Tests/DisplayManagement/Stubs/GroupDisplayDriverStub.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
