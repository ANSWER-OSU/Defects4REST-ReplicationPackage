<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>2988</ISSUENO>
  <ISSUEURL>https://github.com/apache/apisix/issues/2988</ISSUEURL>
  <TITLE>Carry SNI while doing SSL handshaking with upstream</TITLE>
  <DESCRIPTION>So far we don't enable the [SNI extension](https://en.wikipedia.org/wiki/Server_Name_Indication) when communicating with upstream. If upstream server depends on SNI to select proper certificate, then the TLS/SSL handshaking will fail. So we should carry the SNI extension. Nginx has a directive named `proxy_ssl_server_name`. ``` Syntax: proxy_ssl_server_name on | off; proxy_ssl_server_name off; http, server, location ``` Enables or disables passing of the server name through TLS Server Name Indication extension (SNI, RFC 6066) when establishing a connection with the proxied HTTPS server. So we can add this directive into `apisix/cli/ngx_tpl.lua`.</DESCRIPTION>
  <REPONAME>apisix</REPONAME>
  <TIMEDIFFERENCEDAYS>49</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>chore: require more environment info (#3418)</MESSAGE>
    <SHA>5250592b38375fad398174309062146f4172a20a</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>feat: allow to pass SNI in HTTPS proxy (#3420) Fix #2988</MESSAGE>
      <SHA>da62190d952811477cf9d0e7e1c9b455794263f3</SHA>
      <PATCHEDFILES>
        <FILE>apisix/cli/ngx_tpl.lua</FILE>
        <FILE>conf/config-default.yaml</FILE>
        <FILE>t/APISIX.pm</FILE>
        <FILE>t/node/proxy_https.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
