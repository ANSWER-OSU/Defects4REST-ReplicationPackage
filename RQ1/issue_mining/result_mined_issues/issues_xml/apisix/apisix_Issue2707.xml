<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>2707</ISSUENO>
  <ISSUEURL>https://github.com/apache/apisix/issues/2707</ISSUEURL>
  <TITLE>bug: Enable http-logger plugin in the route will cause an error log</TITLE>
  <DESCRIPTION>### Issue description Enable http-logger plugin in the route will cause an error log. ### Environment * apisix version (cmd: `apisix version`): master * OS: ### Minimal test code / Steps to reproduce the issue 1. set the route ```shell curl http://127.0.0.1:9080/apisix/admin/routes/1 -H 'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1' -X PUT -d ' { &quot;plugins&quot;: { &quot;http-logger&quot;: { &quot;uri&quot;: &quot;127.0.0.1:9797/postendpoint?param=1&quot; } }, &quot;upstream&quot;: { &quot;type&quot;: &quot;roundrobin&quot;, &quot;nodes&quot;: { &quot;127.0.0.1:9797&quot;: 1 } }, &quot;uri&quot;: &quot;/test&quot; }' ``` 2. request the route ``` curl 127.0.0.1:9080/test ``` 3. ` $ cat error.log 2020/11/11 16:45:09 [error] 41367#2352668: *2007998 lua entry thread aborted: runtime error: /Users/idbeta/1106/apisix/apisix/plugins/http-logger.lua:103: bad argument #1 to 'connect' (string expected, got nil) stack traceback: coroutine 0: [C]: in function 'connect' /Users/idbeta/1106/apisix/apisix/plugins/http-logger.lua:103: in function 'func' /Users/idbeta/1106/apisix/apisix/utils/batch-processor.lua:59: in function &lt;/Users/idbeta/1106/apisix/apisix/utils/batch-processor.lua:54&gt;, context: ngx.timer, client: 127.0.0.1, server: 0.0.0.0:9080 `</DESCRIPTION>
  <REPONAME>apisix</REPONAME>
  <TIMEDIFFERENCEDAYS>2</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>ci: self host openid configuration (#2698) Also split long test</MESSAGE>
    <SHA>a2fa3ff89d886020a317f7e7f024756296e9861d</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>fix(http-logger): validate uri Close #2707.</MESSAGE>
      <SHA>7c97d9193e2d2d197beb3dcf62357a26884fb974</SHA>
      <PATCHEDFILES>
        <FILE>apisix/plugins/http-logger.lua</FILE>
        <FILE>apisix/schema_def.lua</FILE>
        <FILE>doc/plugins/http-logger.md</FILE>
        <FILE>doc/zh-cn/plugins/http-logger.md</FILE>
        <FILE>t/plugin/http-logger.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
