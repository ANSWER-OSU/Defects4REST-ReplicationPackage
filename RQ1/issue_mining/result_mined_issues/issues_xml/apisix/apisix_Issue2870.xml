<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>2870</ISSUENO>
  <ISSUEURL>https://github.com/apache/apisix/issues/2870</ISSUEURL>
  <TITLE>bug: update plugin config for route does not take effect</TITLE>
  <DESCRIPTION>### Issue description Update the plugin config for route, and then access to the route, the plugin config is not updated. ### Environment * apisix version (cmd: `apisix version`): master source * OS: macOS ### Minimal test code / Steps to reproduce the issue 1. create route ```sh $ curl http://127.0.0.1:9180/apisix/admin/routes/1 -H 'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1' -X PUT -i -d ' { &quot;uri&quot;: &quot;/opentracing&quot;, &quot;plugins&quot;: { &quot;http-logger&quot;: { &quot;uri&quot;: &quot;http://172.16.238.20:1982/hello&quot;, &quot;batch_max_size&quot;: 1, &quot;max_retry_count&quot;: 1, &quot;retry_delay&quot;: 2, &quot;buffer_duration&quot;: 2, &quot;inactive_timeout&quot;: 2, &quot;name&quot;: &quot;http logger&quot;, &quot;timeout&quot;: 3, &quot;concat_method&quot;: &quot;json&quot; } }, &quot;upstream&quot;: { &quot;type&quot;: &quot;roundrobin&quot;, &quot;nodes&quot;: [{ &quot;host&quot;: &quot;172.16.238.20&quot;, &quot;port&quot;: 1981, &quot;weight&quot;: 1 }] } }' ``` 2. access the route ```sh $ curl http://127.0.0.1:9080/opentracing ``` 3. update the route ```sh $ curl http://127.0.0.1:9180/apisix/admin/routes/1 -H 'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1' -X PUT -i -d ' { &quot;uri&quot;: &quot;/opentracing&quot;, &quot;plugins&quot;: { &quot;http-logger&quot;: { &quot;uri&quot;: &quot;http://172.16.238.20:8888/hello&quot;, &quot;batch_max_size&quot;: 1, &quot;max_retry_count&quot;: 1, &quot;retry_delay&quot;: 2, &quot;buffer_duration&quot;: 2, &quot;inactive_timeout&quot;: 2, &quot;name&quot;: &quot;http logger&quot;, &quot;timeout&quot;: 3, &quot;concat_method&quot;: &quot;json&quot; } }, &quot;upstream&quot;: { &quot;type&quot;: &quot;roundrobin&quot;, &quot;nodes&quot;: [{ &quot;host&quot;: &quot;172.16.238.20&quot;, &quot;port&quot;: 1980, &quot;weight&quot;: 1 }] } }' ``` 4. access the route again ```sh $ curl http://127.0.0.1:9080/opentracing ``` ### What's the actual result? (including assertion message &amp; call stack if applicable) upstream has changed to `172.16.238.20:1980` but log is still pushed to `http://172.16.238.20:1982/hello` ### What's the expected result? log should push to `http://172.16.238.20:8888/hello`</DESCRIPTION>
  <REPONAME>apisix</REPONAME>
  <TIMEDIFFERENCEDAYS>4</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>fix: Basic auth plugin should run in rewrite phase. (#2905)</MESSAGE>
    <SHA>c140d0eddc775637eecf7cbe4a5ccf6fe28bf364</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>fix: fixed the non effective config update in http-logger (#2901) * change: changed log level when delete stale batch processor objects close #2870</MESSAGE>
      <SHA>fa30c102e0ec8a0732e165292809f535cb0d51e7</SHA>
      <PATCHEDFILES>
        <FILE>apisix/plugins/http-logger.lua</FILE>
        <FILE>apisix/plugins/tcp-logger.lua</FILE>
        <FILE>t/plugin/http-logger.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
