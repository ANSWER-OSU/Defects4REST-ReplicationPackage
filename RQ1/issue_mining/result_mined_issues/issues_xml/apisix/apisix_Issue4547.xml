<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>4547</ISSUENO>
  <ISSUEURL>https://github.com/apache/apisix/issues/4547</ISSUEURL>
  <TITLE>bug: 404 route not found if URI contains %0A</TITLE>
  <DESCRIPTION>### Issue description If URI contains %0A, will cause route match failed. ### Environment * apisix version (cmd: `apisix version`): 2.6 ### Minimal test code / Steps to reproduce the issue Bug report without steps to reproduce will be ignored or closed. 1. create a route ``` curl http://127.0.0.1:9080/apisix/admin/routes/31 -H 'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1' -X PUT -i -d ' { &quot;uri&quot;: &quot;*&quot;, &quot;hosts&quot;: [&quot;foo.com&quot;], &quot;methods&quot;: [&quot;PUT&quot;, &quot;GET&quot;], &quot;enable_websocket&quot;: true, &quot;upstream&quot;: { &quot;type&quot;: &quot;roundrobin&quot;, &quot;nodes&quot;: { &quot;httpbin.org&quot;: 1 } } }' ``` 2. have a try with normal request ``` curl -i http://127.0.0.1:9080/ip -H &quot;Host:foo.com&quot; ``` It will be success. ``` HTTP/1.1 200 OK Content-Type: application/json Content-Length: 45 Connection: keep-alive Date: Tue, 06 Jul 2021 14:47:10 GMT Access-Control-Allow-Origin: * Access-Control-Allow-Credentials: true Server: APISIX/2.6 { &quot;origin&quot;: &quot;172.19.0.1, 114.220.17.103&quot; } ``` 3. If URI contains %0A ``` curl -i http://127.0.0.1:9080/ip%0AVega -H &quot;Host:foo.com&quot; ``` will get 404 ``` HTTP/1.1 404 Not Found Date: Tue, 06 Jul 2021 14:35:51 GMT Content-Type: text/plain; charset=utf-8 Transfer-Encoding: chunked Connection: keep-alive Server: APISIX/2.6 {&quot;error_msg&quot;:&quot;404 Route Not Found&quot;} ``` ### What's the expected result? Expect normal routing, and upstream returns 404 ``` &lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 3.2 Final//EN&quot;&gt; &lt;title&gt;404 Not Found&lt;/title&gt; &lt;h1&gt;Not Found&lt;/h1&gt; &lt;p&gt;The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.&lt;/p&gt; ```</DESCRIPTION>
  <REPONAME>apisix</REPONAME>
  <TIMEDIFFERENCEDAYS>2</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>docs: fix the valid value interval of `max_breaker_sec` (#4539)</MESSAGE>
    <SHA>220fb832b28acd4208a67ad96449625e6a534ae4</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>fix: upgrade lua-resty-radixtree to 2.8.1 Now we can match uri with newline. Fix #4547. Signed-off-by: spacewander &lt;spacewanderlzx@gmail.com&gt;</MESSAGE>
      <SHA>5f0cd36ba67367ad8aa884111f47dd20d54f6834</SHA>
      <PATCHEDFILES>
        <FILE>rockspec/apisix-master-0.rockspec</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
