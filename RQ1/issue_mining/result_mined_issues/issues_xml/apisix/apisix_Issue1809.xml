<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>1809</ISSUENO>
  <ISSUEURL>https://github.com/apache/apisix/issues/1809</ISSUEURL>
  <TITLE>request help: Health Checks can support Backup server?</TITLE>
  <DESCRIPTION>### Issue description health Check plugin in base on Kong `lua-resty-healthcheck`. I need a function that can mark an upstream server as backup. It will be passed requests when only the primary servers are unavailable. ##LIKE NGINX UPSTREAM CONFIG ``` upstream testproxy { server 192.168.1.14:8080; server 192.168.1.200:8080 backup; } ``` USE nginx upstream on http://nginx.org/en/docs/http/ngx_http_upstream_module.html ### Environment * apisix version (cmd: `apisix version`): 1.4 * OS: centos7</DESCRIPTION>
  <REPONAME>apisix</REPONAME>
  <TIMEDIFFERENCEDAYS>245</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>ci: ensure the fuzzing work under Python3 (#3747) Signed-off-by: spacewander &lt;spacewanderlzx@gmail.com&gt;</MESSAGE>
    <SHA>4820ad93e5fc0550addbd7029a20eab6b7ea800e</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>feat: let balancer support priority Fix #1809 Signed-off-by: spacewander &lt;spacewanderlzx@gmail.com&gt;</MESSAGE>
      <SHA>404e7010571bd143b2bce0e4cbbf34cd04faa1fd</SHA>
      <PATCHEDFILES>
        <FILE>apisix/balancer.lua</FILE>
        <FILE>apisix/balancer/chash.lua</FILE>
        <FILE>apisix/balancer/ewma.lua</FILE>
        <FILE>apisix/balancer/least_conn.lua</FILE>
        <FILE>apisix/balancer/priority.lua</FILE>
        <FILE>apisix/balancer/roundrobin.lua</FILE>
        <FILE>apisix/schema_def.lua</FILE>
        <FILE>apisix/upstream.lua</FILE>
        <FILE>apisix/utils/upstream.lua</FILE>
        <FILE>docs/en/latest/admin-api.md</FILE>
        <FILE>docs/zh/latest/admin-api.md</FILE>
        <FILE>t/node/priority-balancer/health-checker.t</FILE>
        <FILE>t/node/priority-balancer/sanity.t</FILE>
        <FILE>t/node/upstream-discovery.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>feat: let balancer support priority Fix #1809 Signed-off-by: spacewander &lt;spacewanderlzx@gmail.com&gt;</MESSAGE>
      <SHA>79f6e87ebbfb0428b458cb0992193bdb2b492149</SHA>
      <PATCHEDFILES>
        <FILE>apisix/balancer.lua</FILE>
        <FILE>apisix/balancer/chash.lua</FILE>
        <FILE>apisix/balancer/ewma.lua</FILE>
        <FILE>apisix/balancer/least_conn.lua</FILE>
        <FILE>apisix/balancer/priority.lua</FILE>
        <FILE>apisix/balancer/roundrobin.lua</FILE>
        <FILE>apisix/schema_def.lua</FILE>
        <FILE>apisix/upstream.lua</FILE>
        <FILE>apisix/utils/upstream.lua</FILE>
        <FILE>docs/en/latest/admin-api.md</FILE>
        <FILE>docs/en/latest/control-api.md</FILE>
        <FILE>docs/zh/latest/admin-api.md</FILE>
        <FILE>t/admin/balancer.t</FILE>
        <FILE>t/control/healthcheck.t</FILE>
        <FILE>t/discovery/consul_kv.t</FILE>
        <FILE>t/node/priority-balancer/health-checker.t</FILE>
        <FILE>t/node/priority-balancer/sanity.t</FILE>
        <FILE>t/node/upstream-discovery.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>feat: let balancer support priority (#3755) Fix #1809 Signed-off-by: spacewander &lt;spacewanderlzx@gmail.com&gt;</MESSAGE>
      <SHA>8dcbe4e00d9a6f47a4c7b3f5e126c0362511e132</SHA>
      <PATCHEDFILES>
        <FILE>apisix/balancer.lua</FILE>
        <FILE>apisix/balancer/chash.lua</FILE>
        <FILE>apisix/balancer/ewma.lua</FILE>
        <FILE>apisix/balancer/least_conn.lua</FILE>
        <FILE>apisix/balancer/priority.lua</FILE>
        <FILE>apisix/balancer/roundrobin.lua</FILE>
        <FILE>apisix/schema_def.lua</FILE>
        <FILE>apisix/upstream.lua</FILE>
        <FILE>apisix/utils/upstream.lua</FILE>
        <FILE>docs/en/latest/admin-api.md</FILE>
        <FILE>docs/en/latest/control-api.md</FILE>
        <FILE>docs/zh/latest/admin-api.md</FILE>
        <FILE>t/admin/balancer.t</FILE>
        <FILE>t/control/healthcheck.t</FILE>
        <FILE>t/discovery/consul_kv.t</FILE>
        <FILE>t/node/priority-balancer/health-checker.t</FILE>
        <FILE>t/node/priority-balancer/sanity.t</FILE>
        <FILE>t/node/upstream-discovery.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
