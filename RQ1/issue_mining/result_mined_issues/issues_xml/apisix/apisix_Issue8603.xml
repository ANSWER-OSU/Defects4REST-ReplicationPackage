<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>8603</ISSUENO>
  <ISSUEURL>https://github.com/apache/apisix/issues/8603</ISSUEURL>
  <TITLE>bug: cannot disable plugins in apisix/2.15.1</TITLE>
  <DESCRIPTION>### Current Behavior When using Apache APISIX `2.15.1`, users cannot disable a plugin when setting the `disable` field to `true`. For instance, a CORS plugin config like the below will still be effective: ```json { &quot;allow_credential&quot;: false, &quot;allow_headers&quot;: &quot;*&quot;, &quot;allow_origins&quot;: &quot;*&quot;, &quot;expose_headers&quot;: &quot;*&quot;, &quot;allow_methods&quot;: &quot;GET&quot;, &quot;disable&quot;: true, &quot;max_age&quot;: 5 } ``` This is due to a broken change introduced in APISIX `2.15.1` (see https://github.com/apache/apisix/pull/8162), which causes the original `disable` field useless, and if you want to disable a plugin, you have to edit a new field `_meta.disable`. This is a **broken change**, and should not be backported to the LTS release directly. The backward compatibility should be kept. ### Expected Behavior The `disable` field should be in effective in APISIX `2.15.1`. ### Error Logs No error logs. ### Steps to Reproduce ### Create a route with a CORS plugin ```shell curl http://127.0.0.1:9080/apisix/admin/routes -d '{ &quot;uri&quot;: &quot;/get&quot;, &quot;host&quot;: &quot;test.httpbin.org&quot;, &quot;upstream&quot;: { &quot;type&quot;: &quot;roundrobin&quot;, &quot;nodes&quot;: [ {&quot;host&quot;: &quot;httpbin.org&quot;, &quot;port&quot;: 80, &quot;weight&quot;: 100} ] }, &quot;plugins&quot;: { &quot;cors&quot;: { &quot;allow_credential&quot;: false, &quot;allow_headers&quot;: &quot;*&quot;, &quot;allow_origins&quot;: &quot;*&quot;, &quot;expose_headers&quot;: &quot;*&quot;, &quot;allow_methods&quot;: &quot;GET&quot;, &quot;disable&quot;: true, &quot;max_age&quot;: 5 } } }` ``` ### Send a request ```shell curl http://127.0.0.1:9080/get -H 'Host: test.httpbin.org' -H 'Origin: a.com' -v ``` Response headers will be: ```shell &lt; HTTP/1.1 200 OK &lt; Content-Type: application/json &lt; Content-Length: 344 &lt; Connection: keep-alive &lt; Date: Wed, 04 Jan 2023 03:53:26 GMT &lt; Access-Control-Allow-Origin: * &lt; Access-Control-Allow-Credentials: true &lt; Server: APISIX/2.15.1 &lt; Access-Control-Allow-Methods: GET &lt; Access-Control-Max-Age: 5 &lt; Access-Control-Expose-Headers: * &lt; Access-Control-Allow-Headers: * ``` The CORS plugin was diabled, but still, CORS related headers were shown. ### Environment - APISIX version (run `apisix version`): `2.15.1 - Operating system (run `uname -a`): - OpenResty / Nginx version (run `openresty -V` or `nginx -V`): - etcd version, if relevant (run `curl http://127.0.0.1:9090/v1/server_info`): - APISIX Dashboard version, if relevant: - Plugin runner version, for issues related to plugin runners: - LuaRocks version, for installation issues (run `luarocks --version`):</DESCRIPTION>
  <REPONAME>apisix</REPONAME>
  <TIMEDIFFERENCEDAYS>163</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>feat: proxy-mirror plugin resolve host (#7861) (#8356) Co-authored-by: Strangevy &lt;strangevy@foxmail.com&gt; Fixes https://github.com/apache/apisix/issues/8351</MESSAGE>
    <SHA>e3bdf277f7539cadf95e12859981e43f82aa8469</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>fix: use previous way to disable plugins Fix #8603 Signed-off-by: spacewander &lt;spacewanderlzx@gmail.com&gt;</MESSAGE>
      <SHA>ce2816a73e519cc2174391627aa1b1e4f90a4735</SHA>
      <PATCHEDFILES>
        <FILE>apisix/plugin.lua</FILE>
        <FILE>t/plugin/plugin2.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>fix: use previous way to disable plugins (#8609) Fixes https://github.com/apache/apisix/issues/8603</MESSAGE>
      <SHA>e1c3008c9eb7a336390d436ef9ffae6628f498d6</SHA>
      <PATCHEDFILES>
        <FILE>apisix/plugin.lua</FILE>
        <FILE>t/plugin/plugin2.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
