<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>3719</ISSUENO>
  <ISSUEURL>https://github.com/apache/apisix/issues/3719</ISSUEURL>
  <TITLE>I switched the resolver to lua-resty-dns-client， I found a problem. At present, after using this dns client, upstream services can implement dns search, but in plugins, when resty.http is used to generate requests, dns search cannot be implemented. Is there a way to deal with this?</TITLE>
  <DESCRIPTION>I switched the resolver to lua-resty-dns-client， I found a problem. At present, after using this dns client, upstream services can implement dns search, but in plugins, when resty.http is used to generate requests, dns search cannot be implemented. Is there a way to deal with this? _Originally posted by @ShaoZeMing in https://github.com/apache/apisix/issues/3442#issuecomment-787993963_</DESCRIPTION>
  <REPONAME>apisix</REPONAME>
  <TIMEDIFFERENCEDAYS>63</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>ci: cancel duplicate workflow to reduce CI queue time (#4050)</MESSAGE>
    <SHA>0a8670041a6e9ea51f808c60bd4f375f656900e8</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>feat: patch tcp.sock.connect to use our DNS resolver Fix #3719 Signed-off-by: spacewander &lt;spacewanderlzx@gmail.com&gt;</MESSAGE>
      <SHA>c8dca33bfe68c64e2b18a07bc8dc18927894df72</SHA>
      <PATCHEDFILES>
        <FILE>apisix/core/utils.lua</FILE>
        <FILE>apisix/init.lua</FILE>
        <FILE>apisix/patch.lua</FILE>
        <FILE>apisix/plugins/traffic-split.lua</FILE>
        <FILE>t/misc/patch.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>feat: patch tcp.sock.connect to use our DNS resolver Fix #3719 Signed-off-by: spacewander &lt;spacewanderlzx@gmail.com&gt;</MESSAGE>
      <SHA>748cedfd756d7d5524df3cf0ef33073d9e45b714</SHA>
      <PATCHEDFILES>
        <FILE>apisix/core/utils.lua</FILE>
        <FILE>apisix/init.lua</FILE>
        <FILE>apisix/patch.lua</FILE>
        <FILE>apisix/plugins/traffic-split.lua</FILE>
        <FILE>t/misc/patch.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>feat: patch tcp.sock.connect to use our DNS resolver Fix #3719 Signed-off-by: spacewander &lt;spacewanderlzx@gmail.com&gt;</MESSAGE>
      <SHA>b5e77bae064a15797731ff03b2139a11591f3516</SHA>
      <PATCHEDFILES>
        <FILE>apisix/core.lua</FILE>
        <FILE>apisix/core/resolver.lua</FILE>
        <FILE>apisix/core/utils.lua</FILE>
        <FILE>apisix/init.lua</FILE>
        <FILE>apisix/patch.lua</FILE>
        <FILE>apisix/plugins/traffic-split.lua</FILE>
        <FILE>t/misc/patch.t</FILE>
        <FILE>t/node/route-domain-with-local-dns.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>feat: patch tcp.sock.connect to use our DNS resolver Fix #3719 Signed-off-by: spacewander &lt;spacewanderlzx@gmail.com&gt;</MESSAGE>
      <SHA>22ef69825f63d5c1534b14293181ed000f906789</SHA>
      <PATCHEDFILES>
        <FILE>apisix/core.lua</FILE>
        <FILE>apisix/core/resolver.lua</FILE>
        <FILE>apisix/core/utils.lua</FILE>
        <FILE>apisix/init.lua</FILE>
        <FILE>apisix/patch.lua</FILE>
        <FILE>apisix/plugins/traffic-split.lua</FILE>
        <FILE>t/misc/patch.t</FILE>
        <FILE>t/node/route-domain-with-local-dns.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
