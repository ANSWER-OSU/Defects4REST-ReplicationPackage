<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>1202</ISSUENO>
  <ISSUEURL>https://github.com/apache/apisix/issues/1202</ISSUEURL>
  <TITLE>bug: prometheus and zipkin do not support global_rule</TITLE>
  <DESCRIPTION>### Issue description The global_rule plugin is not executed during the log phase ### Environment * apisix version (cmd: `apisix version`): * OS: ### Minimal test code / Steps to reproduce the issue 1. global_rule add prometheus 2.requst &quot;/apisix/prometheus/metrics&quot; ### What's the actual result? (including assertion message &amp; call stack if applicable) only exist nginx_http_current_connections ### What's the expected result? prometheus and zipkin work normally</DESCRIPTION>
  <REPONAME>apisix</REPONAME>
  <TIMEDIFFERENCEDAYS>20</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>test: wait a longer time. (#1323)</MESSAGE>
    <SHA>8d745c744154fdcff132611707aff987e38ea82c</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>feature: run log plugins in the global rule Close #1202.</MESSAGE>
      <SHA>21c08934130fdf9d4c32fbc08eeb6cc08b1d1e66</SHA>
      <PATCHEDFILES>
        <FILE>lua/apisix.lua</FILE>
        <FILE>t/plugin/prometheus.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>feature: run log plugins in the global rule Close #1202.</MESSAGE>
      <SHA>feacea8a2f47424a2345cdb73e067656121c988e</SHA>
      <PATCHEDFILES>
        <FILE>lua/apisix.lua</FILE>
        <FILE>t/plugin/prometheus.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>feature: run log plugins in the global rule (#1333) * feature: run log plugins in the global rule Close #1202. * register path as hello3 to avoid conflicts with other test case</MESSAGE>
      <SHA>be348805eaea2b588004b13021b96be35205ff0e</SHA>
      <PATCHEDFILES>
        <FILE>lua/apisix.lua</FILE>
        <FILE>t/plugin/prometheus.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>feature: run log plugins in the global rule (#1333) * feature: run log plugins in the global rule Close #1202. * register path as hello3 to avoid conflicts with other test case</MESSAGE>
      <SHA>3952e824a1df033bb4785ee8d9206af29f3c691a</SHA>
      <PATCHEDFILES>
        <FILE>lua/apisix.lua</FILE>
        <FILE>t/plugin/prometheus.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
