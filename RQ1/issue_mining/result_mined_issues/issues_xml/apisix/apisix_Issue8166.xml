<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>8166</ISSUENO>
  <ISSUEURL>https://github.com/apache/apisix/issues/8166</ISSUEURL>
  <TITLE>help request: proxy grpc sometimes occurs 502</TITLE>
  <DESCRIPTION>### Description hello: we have two apisix env(such as A and B), when we use apisix to proxy grpc service, A always OK, but in B, when you first time send a request. It returns 502, but the following request all returns 200. and I also found that when we send a request in B, after a whileï¼Œsend request again, then the first request always return 502, the following return 200. I am confused of such thing. because A and B env apisix version and depends are same. when 502 occurs. the following error occurs: ` [error] 20620#20620: *327238 no connection data found for keepalive http2 connection while sending request to upstream ` I want to get some idea from you. what causes it and how to solve it. hope yours. thanks. ### Environment - APISIX version (run `apisix version`): v2.12.0 - Operating system (run `uname -a`): the problem env is :Linux 3.10.0-1160.36.2.el7.x86_64. the good env is: Linux 3.10.0-957.21.3.el7.x86_64 - OpenResty / Nginx version (run `openresty -V` or `nginx -V`): nginx version: openresty/1.21.4.1 - etcd version, if relevant (run `curl http://127.0.0.1:9090/v1/server_info`): 3.5.0 - APISIX Dashboard version, if relevant: - Plugin runner version, for issues related to plugin runners: - LuaRocks version, for installation issues (run `luarocks --version`):</DESCRIPTION>
  <REPONAME>apisix</REPONAME>
  <TIMEDIFFERENCEDAYS>43</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>docs: add Configure mTLS for client to APISIX (EN) (#8460)</MESSAGE>
    <SHA>1da09bf4442e2a2cafd309ecd6297551342a4cb8</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>fix: proxy grpc sometimes occurs 502 (#8364) Co-authored-by: soulbird &lt;zhaothree@gmail.com&gt; Fixes https://github.com/apache/apisix/issues/8166</MESSAGE>
      <SHA>5eb0aadd3a9c426110ef3c3db4ca036950c45f35</SHA>
      <PATCHEDFILES>
        <FILE>apisix/balancer.lua</FILE>
        <FILE>ci/centos7-ci.sh</FILE>
        <FILE>ci/linux_openresty_common_runner.sh</FILE>
        <FILE>t/grpc_server_example/go.mod</FILE>
        <FILE>t/grpc_server_example/go.sum</FILE>
        <FILE>t/grpc_server_example/main.go</FILE>
        <FILE>t/node/upstream-keepalive-pool.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>fix: proxy grpc sometimes occurs 502 (#8364) Co-authored-by: soulbird &lt;zhaothree@gmail.com&gt; Fixes https://github.com/apache/apisix/issues/8166</MESSAGE>
      <SHA>697b95514a181d6cc19c5025de80aca27a117c56</SHA>
      <PATCHEDFILES>
        <FILE>apisix/balancer.lua</FILE>
        <FILE>ci/centos7-ci.sh</FILE>
        <FILE>ci/linux_openresty_common_runner.sh</FILE>
        <FILE>t/grpc_server_example/go.mod</FILE>
        <FILE>t/grpc_server_example/go.sum</FILE>
        <FILE>t/grpc_server_example/main.go</FILE>
        <FILE>t/node/upstream-keepalive-pool.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>fix: proxy grpc sometimes occurs 502 (#8364) Co-authored-by: soulbird &lt;zhaothree@gmail.com&gt; Fixes https://github.com/apache/apisix/issues/8166</MESSAGE>
      <SHA>39391dc6b92685813391f151cfa9a9886029cf6f</SHA>
      <PATCHEDFILES>
        <FILE>apisix/balancer.lua</FILE>
        <FILE>ci/centos7-ci.sh</FILE>
        <FILE>ci/linux_openresty_common_runner.sh</FILE>
        <FILE>t/grpc_server_example/go.mod</FILE>
        <FILE>t/grpc_server_example/go.sum</FILE>
        <FILE>t/grpc_server_example/main.go</FILE>
        <FILE>t/node/upstream-keepalive-pool.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
