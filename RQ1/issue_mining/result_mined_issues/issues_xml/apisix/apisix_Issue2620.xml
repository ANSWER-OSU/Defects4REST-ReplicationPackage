<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>2620</ISSUENO>
  <ISSUEURL>https://github.com/apache/apisix/issues/2620</ISSUEURL>
  <TITLE>request help: we need to support multi-nodes in upstream when pass_host == node</TITLE>
  <DESCRIPTION>### Issue description In our current version, upstream can choose not to transparently transmit the host of the original request, but we also impose a restriction. When `pass_host == node`, upstream can only have one node. We hope to get rid of this restriction. When upstream chooses not to transparently transmit the host (`pass_host == node`), each node transmits downwards according to its own host. ### Environment * apisix version : 2.0 * OS:</DESCRIPTION>
  <REPONAME>apisix</REPONAME>
  <TIMEDIFFERENCEDAYS>190</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>perf(ext-plugin): use a better API to create byte vector (#4195) Signed-off-by: spacewander &lt;spacewanderlzx@gmail.com&gt;</MESSAGE>
    <SHA>bfd69df8a9bfe63b931be7388fbf9e421ffe5c2a</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>feat: support passing different host headers in multiple nodes Fix #2620 Fix #4197 Signed-off-by: spacewander &lt;spacewanderlzx@gmail.com&gt;</MESSAGE>
      <SHA>46c125e35bb7e3e66c63436806184b49d60f82a0</SHA>
      <PATCHEDFILES>
        <FILE>apisix/balancer.lua</FILE>
        <FILE>apisix/init.lua</FILE>
        <FILE>apisix/upstream.lua</FILE>
        <FILE>t/admin/upstream.t</FILE>
        <FILE>t/node/upstream.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>feat: support passing different host headers in multiple nodes Fix #2620 Fix #4197 Signed-off-by: spacewander &lt;spacewanderlzx@gmail.com&gt;</MESSAGE>
      <SHA>2c211154577dde720394df4f39c525985bcdf007</SHA>
      <PATCHEDFILES>
        <FILE>apisix/balancer.lua</FILE>
        <FILE>apisix/init.lua</FILE>
        <FILE>apisix/upstream.lua</FILE>
        <FILE>t/admin/upstream.t</FILE>
        <FILE>t/node/upstream.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>feat: support passing different host headers in multiple nodes (#4208) Fix #2620 Fix #4197 Signed-off-by: spacewander &lt;spacewanderlzx@gmail.com&gt;</MESSAGE>
      <SHA>045c35140fa5b21d1f447030be3769eea3f13e14</SHA>
      <PATCHEDFILES>
        <FILE>apisix/balancer.lua</FILE>
        <FILE>apisix/init.lua</FILE>
        <FILE>apisix/upstream.lua</FILE>
        <FILE>t/admin/upstream.t</FILE>
        <FILE>t/node/upstream.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
