<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>1574</ISSUENO>
  <ISSUEURL>https://github.com/apache/apisix/issues/1574</ISSUEURL>
  <TITLE>feature: prometheus plugin `apisix_http_status` metric `route` tag Improve recognition</TITLE>
  <DESCRIPTION>### Issue description metric like this: apisix_http_status{code=&quot;200&quot;,route=&quot;00000000000000000030&quot;,service=&quot;&quot;,node=&quot;10.30.30.35&quot;} The value of the route tag needs to be changed to the real route value instead of route id. and add host field. like this: apisix_http_status{code=&quot;200&quot;,route=&quot;/*&quot;, host=&quot;www.apisix.com&quot;, node=&quot;10.30.30.35&quot;} It is more convenient to query the QPS of the specified route of the domain name</DESCRIPTION>
  <REPONAME>apisix</REPONAME>
  <TIMEDIFFERENCEDAYS>169</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>doc: correct the doc of plugin ip-restriction (#2420)</MESSAGE>
    <SHA>85ed4cc576f202f5730b0e96a0e759eb7c6a38fc</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>feature: prometheus plugin `apisix_http_status` metric `route` tag Improve recognition #1574 fix #1574 the code is done. todo: Modifying test cases</MESSAGE>
      <SHA>2e86f36f1721dc8b86915274909a181c6c1b5be7</SHA>
      <PATCHEDFILES>
        <FILE>apisix/http/router/radixtree_host_uri.lua</FILE>
        <FILE>apisix/http/router/radixtree_uri.lua</FILE>
        <FILE>apisix/plugins/prometheus/exporter.lua</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>feature: prometheus plugin `apisix_http_status` metric `route` tag Improve recognition #1574 fix #1574</MESSAGE>
      <SHA>ebdad45d96972e1f5ae21745bf5ab9ca6ffcdc62</SHA>
      <PATCHEDFILES>
        <FILE>apisix/plugins/prometheus/exporter.lua</FILE>
        <FILE>t/plugin/prometheus.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>feature: prometheus plugin `apisix_http_status` metric `route` tag Improve recognition (#1574) fix #1574</MESSAGE>
      <SHA>e0e25c3f39ac13ee6b7a0e4ee61c46e1a20a449a</SHA>
      <PATCHEDFILES>
        <FILE>apisix/http/router/radixtree_host_uri.lua</FILE>
        <FILE>apisix/http/router/radixtree_uri.lua</FILE>
        <FILE>apisix/plugins/prometheus/exporter.lua</FILE>
        <FILE>t/plugin/prometheus.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
