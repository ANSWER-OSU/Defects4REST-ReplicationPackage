<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>6329</ISSUENO>
  <ISSUEURL>https://github.com/apache/apisix/issues/6329</ISSUEURL>
  <TITLE>request help: opentelemetry-plugin report no data to otel-collecotor</TITLE>
  <DESCRIPTION>### Issue description I see the opentelemetry-plugin is merge to branch master, and I try to test it. use otel-collecotor 4317 port, when i make run with plugin config like this, is somewhere a bug? BTW, the java service send trace data success, so it is not the collector question. ``` plugins: # plugin list (sorted by priority) - opentelemetry # priority: -1200 plugin_attr: opentelemetry: trace_id_source: x-request-id resource: service.name: APISIX collector: address: 127.0.0.1:4317 request_timeout: 3 batch_span_processor: drop_on_queue_full: false max_queue_size: 1024 batch_timeout: 2 inactive_timeout: 1 max_export_batch_size: 2 ``` In error.log, I have got error in error.log. ``` 2022/02/15 22:11:23 [error] 73677#10524709: *337752 [lua] http_client.lua:41: do_request(): request failed: closed, context: ngx.timer, client: 127.0.0.1, server: 0.0.0.0:9080 2022/02/15 22:11:23 [error] 73677#10524709: *337752 lua entry thread aborted: runtime error: ...deps/share/lua/5.1/opentelemetry/trace/exporter/otlp.lua:24: assertion failed! stack traceback: coroutine 0: [C]: in function 'assert' ...deps/share/lua/5.1/opentelemetry/trace/exporter/otlp.lua:24: in function 'export_spans' ...are/lua/5.1/opentelemetry/trace/batch_span_processor.lua:18: in function 'process_batches' ...are/lua/5.1/opentelemetry/trace/batch_span_processor.lua:46: in function &lt;...are/lua/5.1/opentelemetry/trace/batch_span_processor.lua:29&gt;, context: ngx.timer, client: 127.0.0.1, server: 0.0.0.0:9080 ``` this plugin fail send trace data to otel-collector. ### Environment - apisix version (cmd: `apisix version`): 2.12.0 - OS (cmd: `uname -a`): centos - OpenResty / Nginx version (cmd: `nginx -V` or `openresty -V`): - etcd version, if have (cmd: run `curl http://127.0.0.1:9090/v1/server_info` to get the info from server-info API): - apisix-dashboard version, if have: - the plugin runner version, if the issue is about a plugin runner (cmd: depended on the kind of runner): - luarocks version, if the issue is about installation (cmd: `luarocks --version`): @yangxikun please have a look, brother.</DESCRIPTION>
  <REPONAME>apisix</REPONAME>
  <TIMEDIFFERENCEDAYS>2</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>fix(hmac-auth): hmac-auth plugin sort array param (#6314)</MESSAGE>
    <SHA>f37fc0eb77abbf7fdf98ea40ce706d75e5582a4b</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>fix: batch_span_processor export zero length spans. close #6329</MESSAGE>
      <SHA>906e12f14914a7e6d0fe52b3f454d79141afbb7e</SHA>
      <PATCHEDFILES>
        <FILE>rockspec/apisix-master-0.rockspec</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
