<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>2501</ISSUENO>
  <ISSUEURL>https://github.com/apache/apisix/issues/2501</ISSUEURL>
  <TITLE>[discuss]: How to distinguish whether the 5xx status code (eg 500) comes from upstream or apisix</TITLE>
  <DESCRIPTION>### Issue description When our http request gets an error status code `5XX`, for example: 500. How do we know if this status comes from `upstream` or `apisix`. To know the source of the error status code, I think that in the response phase (`header_filter`), we can determine that the upstream response code is equal to `5XX`. When it is equal to `5XX`, we can set relevant headers in the response header to achieve our goal.</DESCRIPTION>
  <REPONAME>apisix</REPONAME>
  <TIMEDIFFERENCEDAYS>35</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>feat(docs): remove non existing image (#2805)</MESSAGE>
    <SHA>4d290172146ba6fea372a2e224f6a8947a8fce6c</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>feat: How to distinguish whether the 5xx status code (eg 500) comes from upstream or apisix. close #2501</MESSAGE>
      <SHA>3498b807c21f79dc52255e9ac07c6623621c46a2</SHA>
      <PATCHEDFILES>
        <FILE>apisix/init.lua</FILE>
        <FILE>t/lib/server.lua</FILE>
        <FILE>t/node/upstream-status-5xx.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>feat: How to distinguish whether the 5xx status code (eg 500) comes from upstream or apisix. close #2501</MESSAGE>
      <SHA>b10b036dafee37f144d2a559afdead730e893c2f</SHA>
      <PATCHEDFILES>
        <FILE>apisix/init.lua</FILE>
        <FILE>t/lib/server.lua</FILE>
        <FILE>t/node/upstream-status-5xx.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>feat: How to distinguish whether the 5xx status code (eg 500) comes from upstream or apisix (#2817) close #2501</MESSAGE>
      <SHA>d7e59113d5ac8740bc48a784bf186cada6978813</SHA>
      <PATCHEDFILES>
        <FILE>apisix/init.lua</FILE>
        <FILE>doc/README.md</FILE>
        <FILE>doc/debug-function.md</FILE>
        <FILE>doc/zh-cn/README.md</FILE>
        <FILE>doc/zh-cn/debug-function.md</FILE>
        <FILE>t/lib/server.lua</FILE>
        <FILE>t/node/upstream-status-5xx.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
