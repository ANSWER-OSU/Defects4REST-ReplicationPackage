<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>2850</ISSUENO>
  <ISSUEURL>https://github.com/apache/apisix/issues/2850</ISSUEURL>
  <TITLE>bug: manager-api should not allow create consumers with two more auth plugin</TITLE>
  <DESCRIPTION># Bug report ## Describe the bug Same as adminAPI, manager-api should not allow create consumers with more than one auth plugins, but now it is allowed. ## How to Reproduce ```testcase { caseDesc: &quot;create consumers with two auth plugin&quot;, Object: MangerApiExpect(t), Path: &quot;/apisix/admin/consumers&quot;, Method: http.MethodPut, Body: `{ &quot;username&quot;: &quot;case_11&quot;, &quot;plugins&quot;: { &quot;jwt-auth&quot;: { &quot;key&quot;: &quot;a36c3049b36249a3c9f8891cb127243c&quot;, &quot;secret&quot;: &quot;e71829c351aa4242c2719cbfbe671c09&quot; }, &quot;key-auth&quot;: { &quot;key&quot;: &quot;auth-one&quot; } } }`, Headers: map[string]string{&quot;Authorization&quot;: token}, ExpectStatus: http.StatusBadRequest, ExpectBody: &quot;scheme validate failed&quot;, }, ```</DESCRIPTION>
  <REPONAME>apisix</REPONAME>
  <TIMEDIFFERENCEDAYS>5</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>ci: make it work under OpenResty 1.19 (#2768)</MESSAGE>
    <SHA>44855ec1a79efae931151a2f578531cb3f123133</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>feat: allow create consumers with multiple auth plugins Fix #2850</MESSAGE>
      <SHA>59fd03f7096f936cc762783ac74b2862b1bdaae4</SHA>
      <PATCHEDFILES>
        <FILE>apisix/admin/consumers.lua</FILE>
        <FILE>apisix/consumer.lua</FILE>
        <FILE>apisix/init.lua</FILE>
        <FILE>doc/admin-api.md</FILE>
        <FILE>doc/zh-cn/admin-api.md</FILE>
        <FILE>t/config-center-yaml/stream-route.t</FILE>
        <FILE>t/node/consumer-plugin.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>feat: allow create consumers with multiple auth plugins Fix #2850</MESSAGE>
      <SHA>8b2cce465a5cea5b87d700f4d9967ed55bb3a7de</SHA>
      <PATCHEDFILES>
        <FILE>apisix/admin/consumers.lua</FILE>
        <FILE>apisix/consumer.lua</FILE>
        <FILE>apisix/init.lua</FILE>
        <FILE>doc/admin-api.md</FILE>
        <FILE>doc/zh-cn/admin-api.md</FILE>
        <FILE>t/config-center-yaml/stream-route.t</FILE>
        <FILE>t/node/consumer-plugin.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>feat: allow create consumers with multiple auth plugins (#2898) Fix #2850</MESSAGE>
      <SHA>a63b6b8c6e08d8af2327450dbdd1d73a92c27393</SHA>
      <PATCHEDFILES>
        <FILE>apisix/admin/consumers.lua</FILE>
        <FILE>apisix/consumer.lua</FILE>
        <FILE>apisix/init.lua</FILE>
        <FILE>doc/admin-api.md</FILE>
        <FILE>doc/zh-cn/admin-api.md</FILE>
        <FILE>t/config-center-yaml/stream-route.t</FILE>
        <FILE>t/node/consumer-plugin.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
