<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>9287</ISSUENO>
  <ISSUEURL>https://github.com/apache/apisix/issues/9287</ISSUEURL>
  <TITLE>bug: consumer used wolf-rbac auth, consumer other plugins not used</TITLE>
  <DESCRIPTION>### Current Behavior consumer used wolf-rbac auth, consumer other plugins ineffective ### Expected Behavior consumer used wolf-rbac auth, consumer other plugins effect Location: /test_is_redirect ### Error Logs _No response_ ### Steps to Reproduce 1. create route curl -H &quot;X-API-KEY: edd1c9f034335f136f87ad84b625c8f1&quot; &quot;http://127.0.0.1:9180/apisix/admin/routes/1&quot; -X PUT -d &quot;{\&quot;methods\&quot;: [\&quot;GET\&quot;],\&quot;host\&quot;: \&quot;example1.com\&quot;,\&quot;uri\&quot;: \&quot;/*\&quot;,\&quot;upstream\&quot;: {\&quot;type\&quot;: \&quot;roundrobin\&quot;,\&quot;nodes\&quot;: {\&quot;127.0.0.1:80\&quot;: 1}}, \&quot;plugins\&quot;:{\&quot;wolf-rbac\&quot;:{}} }&quot; 2. create consumer curl http://127.0.0.1:9180/apisix/admin/consumers -H 'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1' -X PUT -d ' { &quot;username&quot;: &quot;foo&quot;, &quot;plugins&quot;: { &quot;wolf-rbac&quot;:{&quot;server&quot;:&quot;http://192.168.216.128:12180&quot;,&quot;header_prefix&quot;:&quot;X-&quot;, &quot;appid&quot;: &quot;test10&quot;}, &quot;redirect&quot;: {&quot;uri&quot;: &quot;/test_is_redirect&quot;, &quot;ret_code&quot;: 301} } }' 3. request curl -v -H&quot;Authorization: V1#test10#eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MjAsInVzZXJuYW1lIjoiZm9vIiwibWFuYWdlciI6IiIsInZlcnNpb24iOjIsImFwcGlkIjoidGVzdDEwIiwiaWF0IjoxNjgxMTk2NjczLCJleHAiOjE2ODM3ODg2NzN9.9wvUFijW3rMRU6bcL9eQDvPpWYRqfswxQ3QCYb1VUY0&quot; -H&quot;Host: example1.com&quot; http://127.0.0.1:9080/ 4. Expected response header Location: Location: /test_is_redirect ### Environment - APISIX version (3.2.0): - Operating system (Linux centos7-17 3.10.0-1160.45.1.el7.x86_64 #1 SMP Wed Oct 13 17:20:51 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux): - OpenResty / Nginx version (nginx version: openresty/1.21.4.1 built by gcc 9.3.1 20200408 (Red Hat 9.3.1-2) (GCC) built with OpenSSL 1.1.1s 1 Nov 2022 TLS SNI support enabled configure arguments: --prefix=/usr/local/openresty/nginx --with-cc-opt='-O2 -DAPISIX_BASE_VER=1.21.4.1.7 -DNGX_GRPC_CLI_ENGINE_PATH=/usr/local/openresty/libgrpc_engine.so -DNGX_HTTP_GRPC_CLI_ENGINE_PATH=/usr/local/openresty/libgrpc_engine.so -DNGX_LUA_ABORT_AT_PANIC -I/usr/local/openresty/zlib/include -I/usr/local/openresty/pcre/include -I/usr/local/openresty/openssl111/include' --add-module=../ngx_devel_kit-0.3.1 --add-module=../echo-nginx-module-0.62 --add-module=../xss-nginx-module-0.06 --add-module=../ngx_coolkit-0.2 --add-module=../set-misc-nginx-module-0.33 --add-module=../form-input-nginx-module-0.12 --add-module=../encrypted-session-nginx-module-0.09 --add-module=../srcache-nginx-module-0.32 --add-module=../ngx_lua-0.10.21 --add-module=../ngx_lua_upstream-0.07 --add-module=../headers-more-nginx-module-0.33 --add-module=../array-var-nginx-module-0.05 --add-module=../memc-nginx-module-0.19 --add-module=../redis2-nginx-module-0.15 --add-module=../redis-nginx-module-0.3.9 --add-module=../ngx_stream_lua-0.0.11 --with-ld-opt='-Wl,-rpath,/usr/local/openresty/luajit/lib -Wl,-rpath,/usr/local/openresty/wasmtime-c-api/lib -L/usr/local/openresty/zlib/lib -L/usr/local/openresty/pcre/lib -L/usr/local/openresty/openssl111/lib -Wl,-rpath,/usr/local/openresty/zlib/lib:/usr/local/openresty/pcre/lib:/usr/local/openresty/openssl111/lib' --add-module=/tmp/tmp.xYfSxgSEeh/openresty-1.21.4.1/../mod_dubbo-1.0.2 --add-module=/tmp/tmp.xYfSxgSEeh/openresty-1.21.4.1/../ngx_multi_upstream_module-1.1.1 --add-module=/tmp/tmp.xYfSxgSEeh/openresty-1.21.4.1/../apisix-nginx-module-1.12.0 --add-module=/tmp/tmp.xYfSxgSEeh/openresty-1.21.4.1/../apisix-nginx-module-1.12.0/src/stream --add-module=/tmp/tmp.xYfSxgSEeh/openresty-1.21.4.1/../apisix-nginx-module-1.12.0/src/meta --add-module=/tmp/tmp.xYfSxgSEeh/openresty-1.21.4.1/../wasm-nginx-module-0.6.4 --add-module=/tmp/tmp.xYfSxgSEeh/openresty-1.21.4.1/../lua-var-nginx-module-v0.5.3 --add-module=/tmp/tmp.xYfSxgSEeh/openresty-1.21.4.1/../grpc-client-nginx-module-v0.4.2 --with-poll_module --with-pcre-jit --with-stream --with-stream_ssl_module --with-stream_ssl_preread_module --with-http_v2_module --without-mail_pop3_module --without-mail_imap_module --without-mail_smtp_module --with-http_stub_status_module --with-http_realip_module --with-http_addition_module --with-http_auth_request_module --with-http_secure_link_module --with-http_random_index_module --with-http_gzip_static_module --with-http_sub_module --with-http_dav_module --with-http_flv_module --with-http_mp4_module --with-http_gunzip_module --with-threads --with-compat --with-stream --with-http_ssl_module): - etcd version, if relevant ({&quot;id&quot;:&quot;49f998e4-52dd-40b3-ad8d-0280dec80351&quot;,&quot;hostname&quot;:&quot;centos7-17&quot;,&quot;boot_time&quot;:1681188802,&quot;etcd_version&quot;:&quot;3.4.0&quot;,&quot;version&quot;:&quot;3.2.0&quot;}): - APISIX Dashboard version, if relevant: - Plugin runner version, for issues related to plugin runners: - LuaRocks version, for installation issues (/usr/local/bin/luarocks 3.8.0 LuaRocks main command-line interface):</DESCRIPTION>
  <REPONAME>apisix</REPONAME>
  <TIMEDIFFERENCEDAYS>65</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>fix(proxy-cache): bypass when method mismatch cache_method (#7111) Co-authored-by: soulbird &lt;zhaothree@gmail.com&gt;</MESSAGE>
    <SHA>c49ef095538cfa107bbf763f63d2a019cb0a9f7e</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>fix(wolf-rbac): other plugin not effective when consumer used wolf-rbac (#9287)</MESSAGE>
      <SHA>bfd5311cba889d75bb27466f6b8f12e82f9d78fe</SHA>
      <PATCHEDFILES>
        <FILE>apisix/plugins/wolf-rbac.lua</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>fix(wolf-rbac): other plugin in consumer not effective when consumer used wolf-rbac plugin (#9287)</MESSAGE>
      <SHA>96c4db6c7314c318252ece94e939dcd127e23e45</SHA>
      <PATCHEDFILES>
        <FILE>apisix/plugins/wolf-rbac.lua</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>fix(wolf-rbac): other plugin in consumer not effective when consumer used wolf-rbac plugin (#9287)</MESSAGE>
      <SHA>4f17c2b3996ec39cb760f6e031077c855855b4a1</SHA>
      <PATCHEDFILES>
        <FILE>apisix/plugins/wolf-rbac.lua</FILE>
        <FILE>t/plugin/wolf-rbac.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>fix(wolf-rbac): other plugin in consumer not effective when consumer used wolf-rbac plugin (#9287)</MESSAGE>
      <SHA>191f3e6e361655d660290f5bb11f4b7c2387db41</SHA>
      <PATCHEDFILES>
        <FILE>apisix/plugins/wolf-rbac.lua</FILE>
        <FILE>t/plugin/wolf-rbac.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>fix(wolf-rbac): other plugin in consumer not effective when consumer used wolf-rbac plugin (#9287)</MESSAGE>
      <SHA>23ea876178d486899d93e54ef86bb5eca37b7ad2</SHA>
      <PATCHEDFILES>
        <FILE>apisix/plugins/wolf-rbac.lua</FILE>
        <FILE>t/plugin/wolf-rbac.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>fix(wolf-rbac): other plugin in consumer not effective when consumer used wolf-rbac plugin (#9287)</MESSAGE>
      <SHA>3a412122b61ef1b4ee4ddebfe680b7237270dbd3</SHA>
      <PATCHEDFILES>
        <FILE>apisix/plugins/wolf-rbac.lua</FILE>
        <FILE>t/plugin/wolf-rbac.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>fix(wolf-rbac): other plugin in consumer not effective when consumer used wolf-rbac plugin (#9287)</MESSAGE>
      <SHA>dbb6c95ca1b1864424c9d433f2409948c31283b5</SHA>
      <PATCHEDFILES>
        <FILE>apisix/plugins/wolf-rbac.lua</FILE>
        <FILE>t/plugin/wolf-rbac.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>fix(wolf-rbac): other plugin in consumer not effective when consumer used wolf-rbac plugin (#9287)</MESSAGE>
      <SHA>fc69f3a61ee880c8641be8e026c181ed684abe18</SHA>
      <PATCHEDFILES>
        <FILE>apisix/plugins/wolf-rbac.lua</FILE>
        <FILE>t/plugin/wolf-rbac.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>fix(wolf-rbac): other plugin in consumer not effective when consumer used wolf-rbac plugin (#9287)</MESSAGE>
      <SHA>97beacf3170cf0e64380f98ac28898eecfe4c041</SHA>
      <PATCHEDFILES>
        <FILE>apisix/plugins/wolf-rbac.lua</FILE>
        <FILE>t/plugin/wolf-rbac.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>fix(wolf-rbac): other plugin in consumer not effective when consumer used wolf-rbac plugin (#9287) (#9298)</MESSAGE>
      <SHA>f100cff361770e5ea3cf98ff294c2090543d5090</SHA>
      <PATCHEDFILES>
        <FILE>apisix/plugins/wolf-rbac.lua</FILE>
        <FILE>t/plugin/wolf-rbac.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Merge branch 'upstream/master' into github/master * upstream/master: (42 commits) fix: add `rust-check` target to the makefile for deps pre-checking (#9453) test: remove duplicate `proto` unit test file and tweak test case title (#9445) feat: proxy-mirror add grpc and grpcs support (#9388) test: replace all httpbin upstream (#9452) fix: 404 error in ci test (#9447) fix: body-transformer plugin return raw body anytime (#9446) fix(ci): fips: ensure apisix compiles with openssl3 (#9427) chore(deps): bump actions/stale from 7 to 8 (#9159) chore(deps): bump actions/setup-node from 3.5.1 to 3.6.0 (#8625) chore(test): split the access log of apisix and test server (#8819) docs: fix grammar (#9395) fix(wolf-rbac): other plugin in consumer not effective when consumer used wolf-rbac plugin (#9287) (#9298) docs: use shell instead of Python to configure protos resources (#9414) docs: add guide to authenticate websocket connections (#9369) docs: updated Stream Proxy doc (#9367) feat: proxy_rewrite support miltiple regex pattern matching (#9194) feat: route-level MTLS (#9322) ci: tcp logger with real logger server (#9392) fix: always parse domain when host is domain name (#9332) docs: CHANGELOG.md Chinese docs lint (#9411) ...</MESSAGE>
      <SHA>416f76857148bd884ed9a8b53555f71c19dc57b5</SHA>
      <PATCHEDFILES>
        <FILE>.asf.yaml</FILE>
        <FILE>.github/actions/autocorrect</FILE>
        <FILE>.github/workflows/doc-lint.yml</FILE>
        <FILE>.github/workflows/fips.yml</FILE>
        <FILE>.github/workflows/gm.yml</FILE>
        <FILE>.github/workflows/lint.yml</FILE>
        <FILE>.github/workflows/stale.yml</FILE>
        <FILE>.gitmodules</FILE>
        <FILE>CHANGELOG.md</FILE>
        <FILE>Makefile</FILE>
        <FILE>apisix/cli/ngx_tpl.lua</FILE>
        <FILE>apisix/core/ctx.lua</FILE>
        <FILE>apisix/core/response.lua</FILE>
        <FILE>apisix/core/version.lua</FILE>
        <FILE>apisix/discovery/consul/init.lua</FILE>
        <FILE>apisix/init.lua</FILE>
        <FILE>apisix/plugin.lua</FILE>
        <FILE>apisix/plugins/batch-requests.lua</FILE>
        <FILE>apisix/plugins/body-transformer.lua</FILE>
        <FILE>apisix/plugins/forward-auth.lua</FILE>
        <FILE>apisix/plugins/limit-count.lua</FILE>
        <FILE>apisix/plugins/limit-count/init.lua</FILE>
        <FILE>apisix/plugins/limit-count/limit-count-local.lua</FILE>
        <FILE>apisix/plugins/limit-count/limit-count-redis-cluster.lua</FILE>
        <FILE>apisix/plugins/limit-count/limit-count-redis.lua</FILE>
        <FILE>apisix/plugins/proxy-cache/init.lua</FILE>
        <FILE>apisix/plugins/proxy-mirror.lua</FILE>
        <FILE>apisix/plugins/proxy-rewrite.lua</FILE>
        <FILE>apisix/plugins/response-rewrite.lua</FILE>
        <FILE>apisix/plugins/traffic-split.lua</FILE>
        <FILE>apisix/plugins/wolf-rbac.lua</FILE>
        <FILE>apisix/plugins/workflow.lua</FILE>
        <FILE>apisix/schema_def.lua</FILE>
        <FILE>apisix/secret.lua</FILE>
        <FILE>apisix/ssl.lua</FILE>
        <FILE>apisix/ssl/router/radixtree_sni.lua</FILE>
        <FILE>benchmark/fake-apisix/conf/nginx.conf</FILE>
        <FILE>ci/init-plugin-test-service.sh</FILE>
        <FILE>ci/linux_openresty_common_runner.sh</FILE>
        <FILE>ci/pod/docker-compose.plugin.yml</FILE>
        <FILE>ci/pod/keycloak/kcadm_configure_cas.sh</FILE>
        <FILE>ci/pod/keycloak/kcadm_configure_university.sh</FILE>
        <FILE>ci/pod/keycloak/server.crt.pem</FILE>
        <FILE>ci/pod/keycloak/server.key.pem</FILE>
        <FILE>ci/pod/vector/vector.toml</FILE>
        <FILE>conf/config-default.yaml</FILE>
        <FILE>docs/assets/images/skip-mtls.png</FILE>
        <FILE>docs/en/latest/admin-api.md</FILE>
        <FILE>docs/en/latest/building-apisix.md</FILE>
        <FILE>docs/en/latest/config.json</FILE>
        <FILE>docs/en/latest/getting-started/README.md</FILE>
        <FILE>docs/en/latest/getting-started/key-authentication.md</FILE>
        <FILE>docs/en/latest/getting-started/load-balancing.md</FILE>
        <FILE>docs/en/latest/plugins/consumer-restriction.md</FILE>
        <FILE>docs/en/latest/plugins/forward-auth.md</FILE>
        <FILE>docs/en/latest/plugins/grpc-transcode.md</FILE>
        <FILE>docs/en/latest/plugins/limit-count.md</FILE>
        <FILE>docs/en/latest/plugins/prometheus.md</FILE>
        <FILE>docs/en/latest/plugins/proxy-mirror.md</FILE>
        <FILE>docs/en/latest/plugins/proxy-rewrite.md</FILE>
        <FILE>docs/en/latest/stream-proxy.md</FILE>
        <FILE>docs/en/latest/terminology/secret.md</FILE>
        <FILE>docs/en/latest/tutorials/client-to-apisix-mtls.md</FILE>
        <FILE>docs/en/latest/tutorials/expose-api.md</FILE>
        <FILE>docs/en/latest/tutorials/websocket-authentication.md</FILE>
        <FILE>docs/zh/latest/CHANGELOG.md</FILE>
        <FILE>docs/zh/latest/admin-api.md</FILE>
        <FILE>docs/zh/latest/building-apisix.md</FILE>
        <FILE>docs/zh/latest/config.json</FILE>
        <FILE>docs/zh/latest/discovery/dns.md</FILE>
        <FILE>docs/zh/latest/discovery/kubernetes.md</FILE>
        <FILE>docs/zh/latest/discovery/nacos.md</FILE>
        <FILE>docs/zh/latest/getting-started.md</FILE>
        <FILE>docs/zh/latest/installation-guide.md</FILE>
        <FILE>docs/zh/latest/plugins/authz-casdoor.md</FILE>
        <FILE>docs/zh/latest/plugins/authz-keycloak.md</FILE>
        <FILE>docs/zh/latest/plugins/aws-lambda.md</FILE>
        <FILE>docs/zh/latest/plugins/batch-requests.md</FILE>
        <FILE>docs/zh/latest/plugins/clickhouse-logger.md</FILE>
        <FILE>docs/zh/latest/plugins/cors.md</FILE>
        <FILE>docs/zh/latest/plugins/dubbo-proxy.md</FILE>
        <FILE>docs/zh/latest/plugins/fault-injection.md</FILE>
        <FILE>docs/zh/latest/plugins/file-logger.md</FILE>
        <FILE>docs/zh/latest/plugins/forward-auth.md</FILE>
        <FILE>docs/zh/latest/plugins/gm.md</FILE>
        <FILE>docs/zh/latest/plugins/grpc-transcode.md</FILE>
        <FILE>docs/zh/latest/plugins/http-logger.md</FILE>
        <FILE>docs/zh/latest/plugins/key-auth.md</FILE>
        <FILE>docs/zh/latest/plugins/limit-count.md</FILE>
        <FILE>docs/zh/latest/plugins/log-rotate.md</FILE>
        <FILE>docs/zh/latest/plugins/loggly.md</FILE>
        <FILE>docs/zh/latest/plugins/proxy-cache.md</FILE>
        <FILE>docs/zh/latest/plugins/proxy-mirror.md</FILE>
        <FILE>docs/zh/latest/plugins/proxy-rewrite.md</FILE>
        <FILE>docs/zh/latest/plugins/redirect.md</FILE>
        <FILE>docs/zh/latest/plugins/request-id.md</FILE>
        <FILE>docs/zh/latest/plugins/skywalking.md</FILE>
        <FILE>docs/zh/latest/plugins/traffic-split.md</FILE>
        <FILE>docs/zh/latest/terminology/router.md</FILE>
        <FILE>docs/zh/latest/terminology/secret.md</FILE>
        <FILE>docs/zh/latest/tutorials/client-to-apisix-mtls.md</FILE>
        <FILE>docs/zh/latest/tutorials/expose-api.md</FILE>
        <FILE>docs/zh/latest/tutorials/observe-your-api.md</FILE>
        <FILE>rockspec/apisix-3.3.0-0.rockspec</FILE>
        <FILE>t/APISIX.pm</FILE>
        <FILE>t/admin/plugins.t</FILE>
        <FILE>t/admin/proto.t</FILE>
        <FILE>t/admin/protos.t</FILE>
        <FILE>t/admin/routes4.t</FILE>
        <FILE>t/admin/ssl4.t</FILE>
        <FILE>t/admin/upstream4.t</FILE>
        <FILE>t/certs/vector_logs_ca.crt</FILE>
        <FILE>t/certs/vector_logs_ca.key</FILE>
        <FILE>t/certs/vector_logs_server.crt</FILE>
        <FILE>t/certs/vector_logs_server.key</FILE>
        <FILE>t/config-center-yaml/route-upstream.t</FILE>
        <FILE>t/core/response.t</FILE>
        <FILE>t/debug/debug-mode.t</FILE>
        <FILE>t/discovery/consul.t</FILE>
        <FILE>t/discovery/consul_dump.t</FILE>
        <FILE>t/gm/gm.t</FILE>
        <FILE>t/lib/server.lua</FILE>
        <FILE>t/node/client-mtls.t</FILE>
        <FILE>t/node/merge-route.t</FILE>
        <FILE>t/node/route-domain.t</FILE>
        <FILE>t/node/upstream-domain.t</FILE>
        <FILE>t/node/upstream.t</FILE>
        <FILE>t/plugin/authz-casdoor.t</FILE>
        <FILE>t/plugin/authz-keycloak.t</FILE>
        <FILE>t/plugin/authz-keycloak2.t</FILE>
        <FILE>t/plugin/authz-keycloak3.t</FILE>
        <FILE>t/plugin/batch-requests-grpc.t</FILE>
        <FILE>t/plugin/body-transformer.t</FILE>
        <FILE>t/plugin/ext-plugin/http-req-call.t</FILE>
        <FILE>t/plugin/forward-auth.t</FILE>
        <FILE>t/plugin/grpc-transcode2.t</FILE>
        <FILE>t/plugin/ip-restriction.t</FILE>
        <FILE>t/plugin/jwt-auth3.t</FILE>
        <FILE>t/plugin/limit-count-redis-cluster3.t</FILE>
        <FILE>t/plugin/limit-count-redis.t</FILE>
        <FILE>t/plugin/limit-count-redis3.t</FILE>
        <FILE>t/plugin/limit-count-redis4.t</FILE>
        <FILE>t/plugin/limit-count5.t</FILE>
        <FILE>t/plugin/openid-connect.t</FILE>
        <FILE>t/plugin/proxy-mirror.t</FILE>
        <FILE>t/plugin/proxy-mirror3.t</FILE>
        <FILE>t/plugin/proxy-rewrite.t</FILE>
        <FILE>t/plugin/proxy-rewrite3.t</FILE>
        <FILE>t/plugin/response-rewrite.t</FILE>
        <FILE>t/plugin/tcp-logger.t</FILE>
        <FILE>t/plugin/traffic-split.t</FILE>
        <FILE>t/plugin/wolf-rbac.t</FILE>
        <FILE>t/router/radixtree-sni2.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>fix(wolf-rbac): other plugin in consumer not effective when consumer used wolf-rbac plugin (#9287) (#9298)</MESSAGE>
      <SHA>455fafa89e964e64b2ad82646a44f34b5da24eff</SHA>
      <PATCHEDFILES>
        <FILE>apisix/plugins/wolf-rbac.lua</FILE>
        <FILE>t/plugin/wolf-rbac.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
