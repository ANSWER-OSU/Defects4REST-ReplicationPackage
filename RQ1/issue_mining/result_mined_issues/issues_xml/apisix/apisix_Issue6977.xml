<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>6977</ISSUENO>
  <ISSUEURL>https://github.com/apache/apisix/issues/6977</ISSUEURL>
  <TITLE>help request: lsof command not found while launching</TITLE>
  <DESCRIPTION>### Description Launch `apisix` failed via `systemctl start apisix`, I got the logs like ```shell May 03 15:00:00 lvs systemd[1]: Starting apisix... May 03 15:00:00 lvs apisix[13574]: /usr/local/openresty/luajit/bin/luajit ./apisix/cli/apisix.lua start May 03 15:00:01 lvs apisix[13574]: sh: lsof: command not found May 03 15:00:01 lvs apisix[13574]: nginx.pid exists but there's no corresponding process with pid 3876 , the file will be overwritten May 03 15:00:02 lvs systemd[1]: Started apisix. ``` 1. `lsof: command not found` `lsof` tool not existed in minimal centos 7 environment. Better to check `/proc/pid` directory exist or not via [lfs. attributes](https://keplerproject.github.io/luafilesystem/manual.html#reference). https://github.com/apache/apisix/blob/cc88a8db0ba64e1cb351e389ca5ec64c516073d6/rockspec/apisix-2.13.1-0.rockspec#L51 2. It should `return` while checking pid failed, log `nginx.pid exists but there's no corresponding process with pid` shouldn't output. https://github.com/apache/apisix/blob/cc88a8db0ba64e1cb351e389ca5ec64c516073d6/apisix/cli/ops.lua#L723-L738 ### Environment - APISIX version (run `apisix version`): 2.13.1 - Operating system (run `uname -a`): Linux lvs 3.10.0-327.4.5.el7.x86_64 - OpenResty / Nginx version (run `openresty -V` or `nginx -V`): - etcd version, if relevant (run `curl http://127.0.0.1:9090/v1/server_info`): - APISIX Dashboard version, if relevant: - Plugin runner version, for issues related to plugin runners: - LuaRocks version, for installation issues (run `luarocks --version`):</DESCRIPTION>
  <REPONAME>apisix</REPONAME>
  <TIMEDIFFERENCEDAYS>17</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>docs: replace all apisix-openresty to apisix-base (#6998)</MESSAGE>
    <SHA>0d1280cde7fcd463f2e86941935e053561bcf331</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>feat(ops): check process running with posix.signal insteadof lsof * remove shell command lsof dependency resolve #6977 * use signal SIGNONE(0) check process running or not Signed-off-by: kwanhur &lt;huang_hua2012@163.com&gt;</MESSAGE>
      <SHA>608fc5e070c302a205c2e7a15cbc35ec9b7e7b7d</SHA>
      <PATCHEDFILES>
        <FILE>apisix/cli/ops.lua</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>feat(ops): check process running with posix.signal insteadof lsof * remove shell command lsof dependency resolve #6977 * use signal SIGNONE(0) check process running or not Signed-off-by: kwanhur &lt;huang_hua2012@163.com&gt;</MESSAGE>
      <SHA>68908cf4e91a4eeb60e9296cb35211b9c40d9197</SHA>
      <PATCHEDFILES>
        <FILE>apisix/cli/ops.lua</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>feat(ops): check process running with posix.signal insteadof lsof * remove shell command lsof dependency resolve #6977 * use signal SIGNONE(0) check process running or not Signed-off-by: kwanhur &lt;huang_hua2012@163.com&gt;</MESSAGE>
      <SHA>e89793977e560f1ce29b4b9c3f76c979e01b20ab</SHA>
      <PATCHEDFILES>
        <FILE>apisix/cli/ops.lua</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>feat(ops): check process running with posix.signal insteadof lsof * remove shell command lsof dependency resolve #6977 * use signal SIGNONE(0) check process running or not Signed-off-by: kwanhur &lt;huang_hua2012@163.com&gt;</MESSAGE>
      <SHA>9bab5b903dcb973698e430825e5200f3447e6f04</SHA>
      <PATCHEDFILES>
        <FILE>apisix/cli/ops.lua</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
