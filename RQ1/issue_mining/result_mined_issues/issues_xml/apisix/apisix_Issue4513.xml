<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>4513</ISSUENO>
  <ISSUEURL>https://github.com/apache/apisix/issues/4513</ISSUEURL>
  <TITLE>bug: nacos discovery not support base auth include `%` chars.</TITLE>
  <DESCRIPTION>### Issue description e.g. discovery.nacos.host will be `&quot;http://${username}:${password}@${host1}:${port1}&quot;` ,if username or passowrd has `@` should be replace `%40` (ref https://stackoverflow.com/a/6718568) but apsix 2.7 regular expression is `[a-zA-Z0-9-_.:\@]` https://github.com/apache/apisix/blob/174044e60cfbad6f8aa023200f3be145f5249ed1/apisix/discovery/nacos.lua#L45 will throw exception ``` 2021/07/01 09:27:09 [error] 54#54: init_worker_by_lua error: /usr/local/apisix/apisix/discovery/nacos.lua:312: invalid nacos configuration: property &quot;host&quot; validation failed: failed to validate item 1: failed to match pattern &quot;^http(s)?:\\/\\/[a-zA-Z0-9-_.:\\@]+$&quot; with &quot;https://admin:%40123%40@nacos.xxx.xxx:443&quot; ``` ### Environment Bug report without environment information will be ignored or closed. * apisix version (cmd: `apisix version`): 2.7-alpine * OS (cmd: `uname -a`): ubuntu 16.04 LTS * OpenResty / Nginx version (cmd: `nginx -V` or `openresty -V`): * etcd version, if have (cmd: run `curl http://127.0.0.1:9090/v1/server_info` to get the info from server-info API): * apisix-dashboard version, if have: * luarocks version, if the issue is about installation (cmd: `luarocks --version`): ### Minimal test code / Steps to reproduce the issue Bug report without steps to reproduce will be ignored or closed. 1. 2. 3. ### What's the actual result? (including assertion message &amp; call stack if applicable) ### What's the expected result?</DESCRIPTION>
  <REPONAME>apisix</REPONAME>
  <TIMEDIFFERENCEDAYS>18</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>test: update request to adapt server's change (#4624)</MESSAGE>
    <SHA>098401747135e2395bc12d26f29fe6fa0f3a2a2d</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>fix: host pattern for nacos host Fix #4513 Signed-off-by: spacewander &lt;spacewanderlzx@gmail.com&gt;</MESSAGE>
      <SHA>41c5eb691529b4663b2dc474cde2af5e2da216b7</SHA>
      <PATCHEDFILES>
        <FILE>apisix/discovery/nacos.lua</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
