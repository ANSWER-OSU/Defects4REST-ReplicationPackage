<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>18269</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/18269</ISSUEURL>
  <TITLE>[e2e] network bind to HostIP: unexpected source IP</TITLE>
  <DESCRIPTION>Infrequent, but persistent enough to merit filing: ``` podman run network bind to HostIP ... # podman [options] run --network slirp4netns:outbound_addr=10.88.0.1,allow_host_loopback=true -dt quay.io/libpod/alpine:latest nc -w 2 10.0.2.2 32975 Ncat: Version 7.93 ( https://nmap.org/ncat ) Ncat: Listening on :::32975 Ncat: Listening on 0.0.0.0:32975 Ncat: Connection from 10.128.0.96. &lt;----- SURPRISE! Ncat: Connection from 10.128.0.96:43257. &lt;----- HERE TOO ... Expected &lt;string&gt;: Ncat: Version 7.93 ( https://nmap.org/ncat ) Ncat: Listening on :::32975 Ncat: Listening on 0.0.0.0:32975 Ncat: Connection from 10.128.0.96. Ncat: Connection from 10.128.0.96:43257. to contain substring &lt;string&gt;: 10.88.0.1 ``` podman and podman-remote. Only **root**, never rootless. f37 and debian. It _appears_ to be a consistent failure within a CI run (if it fails once, it fails on all ginkgo retries) but please grain-of-salt this: my flake logger only gets single-flakes under rare conditions. It does appear reasonable that once the surprise interface appears, it will linger. The source address is always `10.128.0.x`. On Fedora, the string `10.128.0` does not appear anywhere else in the logs, only in the flakes. On **Debian**, though, the full (same) source IP appears in various tests that `cat /etc/hosts`: ``` 10.128.0.96 cirrus-task-6474821115052032.c.libpod-218412.internal cirrus-task-6474821115052032 ``` I think instrumenting the e2e tests to run `ip a` (on the host) might offer troubleshooting hints on future failures. If I can't find a fix or workaround for this flake, I'll look into doing that. ### Podman run networking [It] podman run network bind to HostIP * debian-12 : int podman debian-12 root host * PR #17656 * [02-28-2023 10:06](https://api.cirrus-ci.com/v1/artifact/task/5378607913107456/html/int-podman-debian-12-root-host.log.html#t--podman-run-network-bind-to-HostIP--1) * [02-28-2023 10:06](https://api.cirrus-ci.com/v1/artifact/task/5378607913107456/html/int-podman-debian-12-root-host.log.html#t--podman-run-network-bind-to-HostIP--2) * [02-28-2023 10:06](https://api.cirrus-ci.com/v1/artifact/task/5378607913107456/html/int-podman-debian-12-root-host.log.html#t--podman-run-network-bind-to-HostIP--3) * debian-12 : int podman debian-12 root host boltdb * PR #18268 * [04-19 11:13](https://api.cirrus-ci.com/v1/artifact/task/6474821115052032/html/int-podman-debian-12-root-host-boltdb.log.html#t--podman-run-network-bind-to-HostIP--1) * [04-19 11:13](https://api.cirrus-ci.com/v1/artifact/task/6474821115052032/html/int-podman-debian-12-root-host-boltdb.log.html#t--podman-run-network-bind-to-HostIP--2) * [04-19 11:13](https://api.cirrus-ci.com/v1/artifact/task/6474821115052032/html/int-podman-debian-12-root-host-boltdb.log.html#t--podman-run-network-bind-to-HostIP--3) * PR #18024 * [04-03 11:11](https://api.cirrus-ci.com/v1/artifact/task/6685258146381824/html/int-podman-debian-12-root-host-boltdb.log.html#t--podman-run-network-bind-to-HostIP--1) * [04-03 11:11](https://api.cirrus-ci.com/v1/artifact/task/6685258146381824/html/int-podman-debian-12-root-host-boltdb.log.html#t--podman-run-network-bind-to-HostIP--2) * [04-03 11:11](https://api.cirrus-ci.com/v1/artifact/task/6685258146381824/html/int-podman-debian-12-root-host-boltdb.log.html#t--podman-run-network-bind-to-HostIP--3) * debian-12 : int podman debian-12 root host sqlite * PR #17831 * [03-27 18:26](https://api.cirrus-ci.com/v1/artifact/task/6225479884079104/html/int-podman-debian-12-root-host-sqlite.log.html#t--podman-run-network-bind-to-HostIP--1) * fedora-37 : int podman fedora-37 root host boltdb * PR #18242 * [04-18 09:59](https://api.cirrus-ci.com/v1/artifact/task/6465689142165504/html/int-podman-fedora-37-root-host-boltdb.log.html#t--podman-run-network-bind-to-HostIP--1) * [04-18 09:59](https://api.cirrus-ci.com/v1/artifact/task/6465689142165504/html/int-podman-fedora-37-root-host-boltdb.log.html#t--podman-run-network-bind-to-HostIP--2) * [04-18 09:59](https://api.cirrus-ci.com/v1/artifact/task/6465689142165504/html/int-podman-fedora-37-root-host-boltdb.log.html#t--podman-run-network-bind-to-HostIP--3) * fedora-37 : int podman fedora-37 root host sqlite * PR #17890 * [03-22-2023 10:31](https://api.cirrus-ci.com/v1/artifact/task/4582580100530176/html/int-podman-fedora-37-root-host-sqlite.log.html#t--podman-run-network-bind-to-HostIP--1) * [03-22-2023 10:31](https://api.cirrus-ci.com/v1/artifact/task/4582580100530176/html/int-podman-fedora-37-root-host-sqlite.log.html#t--podman-run-network-bind-to-HostIP--2) * [03-22-2023 10:31](https://api.cirrus-ci.com/v1/artifact/task/4582580100530176/html/int-podman-fedora-37-root-host-sqlite.log.html#t--podman-run-network-bind-to-HostIP--3) * fedora-37 : int remote fedora-37 root host sqlite [remote] * PR #17846 * [03-18-2023 20:04](https://api.cirrus-ci.com/v1/artifact/task/5779356664987648/html/int-remote-fedora-37-root-host-sqlite.log.html#t--podman-run-network-bind-to-HostIP--1) * [03-18-2023 20:04](https://api.cirrus-ci.com/v1/artifact/task/5779356664987648/html/int-remote-fedora-37-root-host-sqlite.log.html#t--podman-run-network-bind-to-HostIP--2) * [03-18-2023 20:04](https://api.cirrus-ci.com/v1/artifact/task/5779356664987648/html/int-remote-fedora-37-root-host-sqlite.log.html#t--podman-run-network-bind-to-HostIP--3)</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #18268 from edsantiago/bindingtest_fail_early bindings tests: bail out early on image errors</MESSAGE>
    <SHA>911be1cbcb0ad654a8e10666262bdcee50ee54e0</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>e2e networking test: better way to get host IP uber/jaeger-client-go library is deprecated. Remove it. Only place it's used is in one e2e test, a test that is flaking in a way that suggests that the HostIP() weighting heuristic from that module was not actually getting the best outgoing IP address. So, switch to using what seems to be the current best practice. No need to make it reusable, since it's only used in one place. Oh, also remove undesired &quot;-dt&quot; from two &quot;podman run&quot;s. In one it's harmless, in the other it would cause a test failure under some circumstances. Closes: #18269 (optimistic, aren't I?) Signed-off-by: Ed Santiago &lt;santiago@redhat.com&gt;</MESSAGE>
      <SHA>a089f1b5c39887c82019d3648906484084f82f8d</SHA>
      <PATCHEDFILES>
        <FILE>go.mod</FILE>
        <FILE>go.sum</FILE>
        <FILE>test/e2e/run_networking_test.go</FILE>
        <FILE>vendor/github.com/uber/jaeger-client-go/LICENSE</FILE>
        <FILE>vendor/github.com/uber/jaeger-client-go/log/logger.go</FILE>
        <FILE>vendor/github.com/uber/jaeger-client-go/thrift-gen/agent/GoUnusedProtection__.go</FILE>
        <FILE>vendor/github.com/uber/jaeger-client-go/thrift-gen/agent/agent-consts.go</FILE>
        <FILE>vendor/github.com/uber/jaeger-client-go/thrift-gen/agent/agent.go</FILE>
        <FILE>vendor/github.com/uber/jaeger-client-go/thrift-gen/jaeger/GoUnusedProtection__.go</FILE>
        <FILE>vendor/github.com/uber/jaeger-client-go/thrift-gen/jaeger/jaeger-consts.go</FILE>
        <FILE>vendor/github.com/uber/jaeger-client-go/thrift-gen/jaeger/jaeger.go</FILE>
        <FILE>vendor/github.com/uber/jaeger-client-go/thrift-gen/zipkincore/GoUnusedProtection__.go</FILE>
        <FILE>vendor/github.com/uber/jaeger-client-go/thrift-gen/zipkincore/zipkincore-consts.go</FILE>
        <FILE>vendor/github.com/uber/jaeger-client-go/thrift-gen/zipkincore/zipkincore.go</FILE>
        <FILE>vendor/github.com/uber/jaeger-client-go/thrift/.nocover</FILE>
        <FILE>vendor/github.com/uber/jaeger-client-go/thrift/README.md</FILE>
        <FILE>vendor/github.com/uber/jaeger-client-go/thrift/application_exception.go</FILE>
        <FILE>vendor/github.com/uber/jaeger-client-go/thrift/binary_protocol.go</FILE>
        <FILE>vendor/github.com/uber/jaeger-client-go/thrift/client.go</FILE>
        <FILE>vendor/github.com/uber/jaeger-client-go/thrift/compact_protocol.go</FILE>
        <FILE>vendor/github.com/uber/jaeger-client-go/thrift/configuration.go</FILE>
        <FILE>vendor/github.com/uber/jaeger-client-go/thrift/context.go</FILE>
        <FILE>vendor/github.com/uber/jaeger-client-go/thrift/exception.go</FILE>
        <FILE>vendor/github.com/uber/jaeger-client-go/thrift/header_context.go</FILE>
        <FILE>vendor/github.com/uber/jaeger-client-go/thrift/header_protocol.go</FILE>
        <FILE>vendor/github.com/uber/jaeger-client-go/thrift/header_transport.go</FILE>
        <FILE>vendor/github.com/uber/jaeger-client-go/thrift/logger.go</FILE>
        <FILE>vendor/github.com/uber/jaeger-client-go/thrift/memory_buffer.go</FILE>
        <FILE>vendor/github.com/uber/jaeger-client-go/thrift/messagetype.go</FILE>
        <FILE>vendor/github.com/uber/jaeger-client-go/thrift/numeric.go</FILE>
        <FILE>vendor/github.com/uber/jaeger-client-go/thrift/processor_factory.go</FILE>
        <FILE>vendor/github.com/uber/jaeger-client-go/thrift/protocol.go</FILE>
        <FILE>vendor/github.com/uber/jaeger-client-go/thrift/protocol_exception.go</FILE>
        <FILE>vendor/github.com/uber/jaeger-client-go/thrift/protocol_factory.go</FILE>
        <FILE>vendor/github.com/uber/jaeger-client-go/thrift/response_helper.go</FILE>
        <FILE>vendor/github.com/uber/jaeger-client-go/thrift/rich_transport.go</FILE>
        <FILE>vendor/github.com/uber/jaeger-client-go/thrift/serializer.go</FILE>
        <FILE>vendor/github.com/uber/jaeger-client-go/thrift/server_transport.go</FILE>
        <FILE>vendor/github.com/uber/jaeger-client-go/thrift/simple_json_protocol.go</FILE>
        <FILE>vendor/github.com/uber/jaeger-client-go/thrift/simple_server.go</FILE>
        <FILE>vendor/github.com/uber/jaeger-client-go/thrift/transport.go</FILE>
        <FILE>vendor/github.com/uber/jaeger-client-go/thrift/transport_exception.go</FILE>
        <FILE>vendor/github.com/uber/jaeger-client-go/thrift/transport_factory.go</FILE>
        <FILE>vendor/github.com/uber/jaeger-client-go/thrift/type.go</FILE>
        <FILE>vendor/github.com/uber/jaeger-client-go/utils/http_json.go</FILE>
        <FILE>vendor/github.com/uber/jaeger-client-go/utils/localip.go</FILE>
        <FILE>vendor/github.com/uber/jaeger-client-go/utils/rand.go</FILE>
        <FILE>vendor/github.com/uber/jaeger-client-go/utils/rate_limiter.go</FILE>
        <FILE>vendor/github.com/uber/jaeger-client-go/utils/reconnecting_udp_conn.go</FILE>
        <FILE>vendor/github.com/uber/jaeger-client-go/utils/udp_client.go</FILE>
        <FILE>vendor/github.com/uber/jaeger-client-go/utils/utils.go</FILE>
        <FILE>vendor/modules.txt</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
