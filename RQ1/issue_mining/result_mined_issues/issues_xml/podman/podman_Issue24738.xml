<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>24738</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/24738</ISSUEURL>
  <TITLE>Error: database graph driver &quot;&quot; does not match our graph driver &quot;overlay&quot;: database configuration mismatch</TITLE>
  <DESCRIPTION>### Issue Description Since November, a server has been logging this error when attempting an auto-update cronjob: &gt; podman[895410]: Error: database graph driver &quot;&quot; does not match our graph driver &quot;overlay&quot;: database configuration mismatch During this time period my distro upgraded from 5.2.1 to 5.2.2. I am now running 5.2.5. ### Steps to reproduce the issue Since November, a server has been logging an error when attempting an auto-update cronjob. Steps to reproduce the issue 1. Use podman with auto-update cronjob ### Describe the results you received &gt; podman[895410]: Error: database graph driver &quot;&quot; does not match our graph driver &quot;overlay&quot;: database configuration mismatch During this time period my distro upgraded from 5.2.1 to 5.2.2. I am now running 5.2.5. ### Describe the results you expected I expected the cronjob to succeed ### podman info output ```yaml $ podman info host: arch: arm64 buildahVersion: 1.37.5 cgroupControllers: - cpu - memory - pids cgroupManager: systemd cgroupVersion: v2 conmon: package: conmon_2.1.12-3_arm64 path: /usr/bin/conmon version: 'conmon version 2.1.12, commit: unknown' cpuUtilization: idlePercent: 99.64 systemPercent: 0.17 userPercent: 0.19 cpus: 8 databaseBackend: sqlite distribution: codename: trixie distribution: debian version: unknown eventLogger: journald freeLocks: 2036 hostname: hubble idMappings: gidmap: - container_id: 0 host_id: 1000 size: 1 - container_id: 1 host_id: 100000 size: 65536 uidmap: - container_id: 0 host_id: 1000 size: 1 - container_id: 1 host_id: 100000 size: 65536 kernel: 6.11.0 linkmode: dynamic logDriver: journald memFree: 3758686208 memTotal: 16489906176 networkBackend: netavark networkBackendInfo: backend: netavark dns: package: aardvark-dns_1.12.2-1_arm64 path: /usr/lib/podman/aardvark-dns version: aardvark-dns 1.12.2 package: netavark_1.12.1-3_arm64 path: /usr/lib/podman/netavark version: netavark 1.12.1 ociRuntime: name: runc package: runc_1.1.15+ds1-1_arm64 path: /usr/bin/runc version: |- runc version 1.1.15+ds1 commit: 1.1.15+ds1-1 spec: 1.2.0 go: go1.23.2 libseccomp: 2.5.5 os: linux pasta: executable: /usr/bin/pasta package: passt_0.0~git20241030.ee7d0b6-1_arm64 version: | pasta 0.0~git20241030.ee7d0b6-1 Copyright Red Hat GNU General Public License, version 2 or later &lt;https://www.gnu.org/licenses/old-licenses/gpl-2.0.html&gt; This is free software: you are free to change and redistribute it. There is NO WARRANTY, to the extent permitted by law. remoteSocket: exists: true path: /run/user/1000/podman/podman.sock rootlessNetworkCmd: pasta security: apparmorEnabled: false capabilities: CAP_CHOWN,CAP_DAC_OVERRIDE,CAP_FOWNER,CAP_FSETID,CAP_KILL,CAP_NET_BIND_SERVICE,CAP_SETFCAP,CAP_SETGID,CAP_SETPCAP,CAP_SETUID,CAP_SYS_CHROOT rootless: true seccompEnabled: true seccompProfilePath: /usr/share/containers/seccomp.json selinuxEnabled: false serviceIsRemote: false slirp4netns: executable: /usr/bin/slirp4netns package: slirp4netns_1.2.1-1+b2_arm64 version: |- slirp4netns version 1.2.1 commit: 09e31e92fa3d2a1d3ca261adaeb012c8d75a8194 libslirp: 4.8.0 SLIRP_CONFIG_VERSION_MAX: 5 libseccomp: 2.5.5 swapFree: 0 swapTotal: 0 uptime: 1477h 41m 29.00s (Approximately 61.54 days) variant: v8 plugins: authorization: null log: - k8s-file - none - passthrough - journald network: - bridge - macvlan - ipvlan volume: - local registries: search: - docker.io store: configFile: /home/joel/.config/containers/storage.conf containerStore: number: 7 paused: 0 running: 7 stopped: 0 graphDriverName: overlay graphOptions: {} graphRoot: /home/joel/.local/share/containers/storage graphRootAllocated: 111714734080 graphRootUsed: 105411731456 graphStatus: Backing Filesystem: extfs Native Overlay Diff: &quot;true&quot; Supports d_type: &quot;true&quot; Supports shifting: &quot;false&quot; Supports volatile: &quot;true&quot; Using metacopy: &quot;false&quot; imageCopyTmpDir: /var/tmp imageStore: number: 7 runRoot: /run/user/1000/containers transientStore: false volumePath: /home/joel/.local/share/containers/storage/volumes version: APIVersion: 5.2.5 Built: 1729890366 BuiltTime: Sat Oct 26 07:36:06 2024 GitCommit: &quot;&quot; GoVersion: go1.23.2 Os: linux OsArch: linux/arm64 Version: 5.2.5 ``` ### Podman in a container No ### Privileged Or Rootless Rootless ### Upstream Latest Release Yes ### Additional environment details Debian testing ### Additional information I upgraded to the latest version 5.3.1. The error is now: ``` Dec 03 09:26:41 hubble systemd[1]: Starting podman-restart.service - Podman Start All Containers With Restart Policy Set To Always... Dec 03 09:26:41 hubble podman[959599]: time=&quot;2024-12-03T09:26:41+10:30&quot; level=info msg=&quot;/usr/bin/podman filtering at log level info&quot; Dec 03 09:26:41 hubble podman[959599]: time=&quot;2024-12-03T09:26:41+10:30&quot; level=info msg=&quot;Using sqlite as database backend&quot; Dec 03 09:26:41 hubble podman[959599]: Error: database graph driver &quot;&quot; does not match our graph driver &quot;overlay&quot;: database configuration mismatch Dec 03 09:26:41 hubble systemd[1]: podman-restart.service: Main process exited, code=exited, status=125/n/a ``` The top hit on DDG for this issue is https://github.com/containers/podman/issues/7396, which was closed.</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>70</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #24774 from containers/renovate/golang.org-x-tools-0.x fix(deps): update module golang.org/x/tools to v0.28.0</MESSAGE>
    <SHA>8ff491b0d9109a293847bb6a612fa195094fd6ca</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>In SQLite state, use defaults for empty-string checks As part of our database init, we perform a check of the current values for a few fields (graph driver, graph root, static dir, and a few more) to validate that Libpod is being started with a sane &amp; sensible config, and the user's containers can actually be expected to work. Basically, we take the current runtime config and compare against values cached in the database from the first time Podman was run. We've had some issues with this logic before this year around symlink resolution, but this is a new edge case. Somehow, the database is being loaded with the empty string for some fields (at least graph driver) which is causing comparisons to fail because we will never compare against &quot;&quot; for those fields - we insert the default value instead, assuming we have one. Having a value of &quot;&quot; in the database largely invalidates the check so arguably we could just drop it, but what BoltDB did - and what SQLite does after this patch - is to use the default value for comparison instead of &quot;&quot;. This should still catch some edge cases, and shouldn't be too harmful. What this does not do is identify or solve the reason that we are seeing the empty string in the database at all. From my read on the logic, it must mean that the graph driver is explicitly set to &quot;&quot; in the c/storage config at the time Podman is first run and I'm not precisely sure how that happens. Fixes #24738 Signed-off-by: Matt Heon &lt;mheon@redhat.com&gt;</MESSAGE>
      <SHA>5ab154f0f0e79f267244f17bbf767ef607d6f5d2</SHA>
      <PATCHEDFILES>
        <FILE>libpod/sqlite_state.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>In SQLite state, use defaults for empty-string checks As part of our database init, we perform a check of the current values for a few fields (graph driver, graph root, static dir, and a few more) to validate that Libpod is being started with a sane &amp; sensible config, and the user's containers can actually be expected to work. Basically, we take the current runtime config and compare against values cached in the database from the first time Podman was run. We've had some issues with this logic before this year around symlink resolution, but this is a new edge case. Somehow, the database is being loaded with the empty string for some fields (at least graph driver) which is causing comparisons to fail because we will never compare against &quot;&quot; for those fields - we insert the default value instead, assuming we have one. Having a value of &quot;&quot; in the database largely invalidates the check so arguably we could just drop it, but what BoltDB did - and what SQLite does after this patch - is to use the default value for comparison instead of &quot;&quot;. This should still catch some edge cases, and shouldn't be too harmful. What this does not do is identify or solve the reason that we are seeing the empty string in the database at all. From my read on the logic, it must mean that the graph driver is explicitly set to &quot;&quot; in the c/storage config at the time Podman is first run and I'm not precisely sure how that happens. Fixes #24738 Signed-off-by: Matt Heon &lt;mheon@redhat.com&gt;</MESSAGE>
      <SHA>7df556ccefbaa57c7cc36657eee21191ed6b9ba6</SHA>
      <PATCHEDFILES>
        <FILE>libpod/sqlite_state.go</FILE>
        <FILE>test/e2e/info_test.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>In SQLite state, use defaults for empty-string checks As part of our database init, we perform a check of the current values for a few fields (graph driver, graph root, static dir, and a few more) to validate that Libpod is being started with a sane &amp; sensible config, and the user's containers can actually be expected to work. Basically, we take the current runtime config and compare against values cached in the database from the first time Podman was run. We've had some issues with this logic before this year around symlink resolution, but this is a new edge case. Somehow, the database is being loaded with the empty string for some fields (at least graph driver) which is causing comparisons to fail because we will never compare against &quot;&quot; for those fields - we insert the default value instead, assuming we have one. Having a value of &quot;&quot; in the database largely invalidates the check so arguably we could just drop it, but what BoltDB did - and what SQLite does after this patch - is to use the default value for comparison instead of &quot;&quot;. This should still catch some edge cases, and shouldn't be too harmful. What this does not do is identify or solve the reason that we are seeing the empty string in the database at all. From my read on the logic, it must mean that the graph driver is explicitly set to &quot;&quot; in the c/storage config at the time Podman is first run and I'm not precisely sure how that happens. Fixes #24738 Signed-off-by: Matt Heon &lt;mheon@redhat.com&gt;</MESSAGE>
      <SHA>1e04b52db6929b1bda73e8271cefb9795bcc6efa</SHA>
      <PATCHEDFILES>
        <FILE>libpod/sqlite_state.go</FILE>
        <FILE>test/e2e/info_test.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>In SQLite state, use defaults for empty-string checks As part of our database init, we perform a check of the current values for a few fields (graph driver, graph root, static dir, and a few more) to validate that Libpod is being started with a sane &amp; sensible config, and the user's containers can actually be expected to work. Basically, we take the current runtime config and compare against values cached in the database from the first time Podman was run. We've had some issues with this logic before this year around symlink resolution, but this is a new edge case. Somehow, the database is being loaded with the empty string for some fields (at least graph driver) which is causing comparisons to fail because we will never compare against &quot;&quot; for those fields - we insert the default value instead, assuming we have one. Having a value of &quot;&quot; in the database largely invalidates the check so arguably we could just drop it, but what BoltDB did - and what SQLite does after this patch - is to use the default value for comparison instead of &quot;&quot;. This should still catch some edge cases, and shouldn't be too harmful. What this does not do is identify or solve the reason that we are seeing the empty string in the database at all. From my read on the logic, it must mean that the graph driver is explicitly set to &quot;&quot; in the c/storage config at the time Podman is first run and I'm not precisely sure how that happens. Fixes #24738 Signed-off-by: Matt Heon &lt;mheon@redhat.com&gt;</MESSAGE>
      <SHA>b54620d0d89db9083b7925bd7c9da8d420cf04ea</SHA>
      <PATCHEDFILES>
        <FILE>libpod/sqlite_state.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>In SQLite state, use defaults for empty-string checks As part of our database init, we perform a check of the current values for a few fields (graph driver, graph root, static dir, and a few more) to validate that Libpod is being started with a sane &amp; sensible config, and the user's containers can actually be expected to work. Basically, we take the current runtime config and compare against values cached in the database from the first time Podman was run. We've had some issues with this logic before this year around symlink resolution, but this is a new edge case. Somehow, the database is being loaded with the empty string for some fields (at least graph driver) which is causing comparisons to fail because we will never compare against &quot;&quot; for those fields - we insert the default value instead, assuming we have one. Having a value of &quot;&quot; in the database largely invalidates the check so arguably we could just drop it, but what BoltDB did - and what SQLite does after this patch - is to use the default value for comparison instead of &quot;&quot;. This should still catch some edge cases, and shouldn't be too harmful. What this does not do is identify or solve the reason that we are seeing the empty string in the database at all. From my read on the logic, it must mean that the graph driver is explicitly set to &quot;&quot; in the c/storage config at the time Podman is first run and I'm not precisely sure how that happens. Fixes #24738 Signed-off-by: Matt Heon &lt;mheon@redhat.com&gt;</MESSAGE>
      <SHA>1614605af8af02a1e24898a637db243d94aebc90</SHA>
      <PATCHEDFILES>
        <FILE>libpod/sqlite_state.go</FILE>
        <FILE>test/system/005-info.bats</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>In SQLite state, use defaults for empty-string checks As part of our database init, we perform a check of the current values for a few fields (graph driver, graph root, static dir, and a few more) to validate that Libpod is being started with a sane &amp; sensible config, and the user's containers can actually be expected to work. Basically, we take the current runtime config and compare against values cached in the database from the first time Podman was run. We've had some issues with this logic before this year around symlink resolution, but this is a new edge case. Somehow, the database is being loaded with the empty string for some fields (at least graph driver) which is causing comparisons to fail because we will never compare against &quot;&quot; for those fields - we insert the default value instead, assuming we have one. Having a value of &quot;&quot; in the database largely invalidates the check so arguably we could just drop it, but what BoltDB did - and what SQLite does after this patch - is to use the default value for comparison instead of &quot;&quot;. This should still catch some edge cases, and shouldn't be too harmful. What this does not do is identify or solve the reason that we are seeing the empty string in the database at all. From my read on the logic, it must mean that the graph driver is explicitly set to &quot;&quot; in the c/storage config at the time Podman is first run and I'm not precisely sure how that happens. Fixes #24738 Signed-off-by: Matt Heon &lt;mheon@redhat.com&gt;</MESSAGE>
      <SHA>34e3f2250e59a8b79301efa555a4b79102037baa</SHA>
      <PATCHEDFILES>
        <FILE>libpod/sqlite_state.go</FILE>
        <FILE>test/system/005-info.bats</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>In SQLite state, use defaults for empty-string checks As part of our database init, we perform a check of the current values for a few fields (graph driver, graph root, static dir, and a few more) to validate that Libpod is being started with a sane &amp; sensible config, and the user's containers can actually be expected to work. Basically, we take the current runtime config and compare against values cached in the database from the first time Podman was run. We've had some issues with this logic before this year around symlink resolution, but this is a new edge case. Somehow, the database is being loaded with the empty string for some fields (at least graph driver) which is causing comparisons to fail because we will never compare against &quot;&quot; for those fields - we insert the default value instead, assuming we have one. Having a value of &quot;&quot; in the database largely invalidates the check so arguably we could just drop it, but what BoltDB did - and what SQLite does after this patch - is to use the default value for comparison instead of &quot;&quot;. This should still catch some edge cases, and shouldn't be too harmful. What this does not do is identify or solve the reason that we are seeing the empty string in the database at all. From my read on the logic, it must mean that the graph driver is explicitly set to &quot;&quot; in the c/storage config at the time Podman is first run and I'm not precisely sure how that happens. Fixes #24738 Signed-off-by: Matt Heon &lt;mheon@redhat.com&gt;</MESSAGE>
      <SHA>6c42f8f0c83e51c8630968c30361f37b9e1aea28</SHA>
      <PATCHEDFILES>
        <FILE>libpod/sqlite_state.go</FILE>
        <FILE>test/system/005-info.bats</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>In SQLite state, use defaults for empty-string checks As part of our database init, we perform a check of the current values for a few fields (graph driver, graph root, static dir, and a few more) to validate that Libpod is being started with a sane &amp; sensible config, and the user's containers can actually be expected to work. Basically, we take the current runtime config and compare against values cached in the database from the first time Podman was run. We've had some issues with this logic before this year around symlink resolution, but this is a new edge case. Somehow, the database is being loaded with the empty string for some fields (at least graph driver) which is causing comparisons to fail because we will never compare against &quot;&quot; for those fields - we insert the default value instead, assuming we have one. Having a value of &quot;&quot; in the database largely invalidates the check so arguably we could just drop it, but what BoltDB did - and what SQLite does after this patch - is to use the default value for comparison instead of &quot;&quot;. This should still catch some edge cases, and shouldn't be too harmful. What this does not do is identify or solve the reason that we are seeing the empty string in the database at all. From my read on the logic, it must mean that the graph driver is explicitly set to &quot;&quot; in the c/storage config at the time Podman is first run and I'm not precisely sure how that happens. Fixes #24738 Signed-off-by: Matt Heon &lt;mheon@redhat.com&gt;</MESSAGE>
      <SHA>b1418b80750bc29edca4c43cc177124585f85e9c</SHA>
      <PATCHEDFILES>
        <FILE>libpod/sqlite_state.go</FILE>
        <FILE>test/system/005-info.bats</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>In SQLite state, use defaults for empty-string checks As part of our database init, we perform a check of the current values for a few fields (graph driver, graph root, static dir, and a few more) to validate that Libpod is being started with a sane &amp; sensible config, and the user's containers can actually be expected to work. Basically, we take the current runtime config and compare against values cached in the database from the first time Podman was run. We've had some issues with this logic before this year around symlink resolution, but this is a new edge case. Somehow, the database is being loaded with the empty string for some fields (at least graph driver) which is causing comparisons to fail because we will never compare against &quot;&quot; for those fields - we insert the default value instead, assuming we have one. Having a value of &quot;&quot; in the database largely invalidates the check so arguably we could just drop it, but what BoltDB did - and what SQLite does after this patch - is to use the default value for comparison instead of &quot;&quot;. This should still catch some edge cases, and shouldn't be too harmful. What this does not do is identify or solve the reason that we are seeing the empty string in the database at all. From my read on the logic, it must mean that the graph driver is explicitly set to &quot;&quot; in the c/storage config at the time Podman is first run and I'm not precisely sure how that happens. Fixes #24738 Signed-off-by: Matt Heon &lt;mheon@redhat.com&gt;</MESSAGE>
      <SHA>cb53abca28df7a5917ede057957788d6b35580dd</SHA>
      <PATCHEDFILES>
        <FILE>libpod/sqlite_state.go</FILE>
        <FILE>test/system/005-info.bats</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>In SQLite state, use defaults for empty-string checks As part of our database init, we perform a check of the current values for a few fields (graph driver, graph root, static dir, and a few more) to validate that Libpod is being started with a sane &amp; sensible config, and the user's containers can actually be expected to work. Basically, we take the current runtime config and compare against values cached in the database from the first time Podman was run. We've had some issues with this logic before this year around symlink resolution, but this is a new edge case. Somehow, the database is being loaded with the empty string for some fields (at least graph driver) which is causing comparisons to fail because we will never compare against &quot;&quot; for those fields - we insert the default value instead, assuming we have one. Having a value of &quot;&quot; in the database largely invalidates the check so arguably we could just drop it, but what BoltDB did - and what SQLite does after this patch - is to use the default value for comparison instead of &quot;&quot;. This should still catch some edge cases, and shouldn't be too harmful. What this does not do is identify or solve the reason that we are seeing the empty string in the database at all. From my read on the logic, it must mean that the graph driver is explicitly set to &quot;&quot; in the c/storage config at the time Podman is first run and I'm not precisely sure how that happens. Fixes #24738 Signed-off-by: Matt Heon &lt;mheon@redhat.com&gt;</MESSAGE>
      <SHA>e24c8d997f9beffcb358689c17fbf8621e61ee45</SHA>
      <PATCHEDFILES>
        <FILE>libpod/sqlite_state.go</FILE>
        <FILE>test/system/005-info.bats</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>In SQLite state, use defaults for empty-string checks As part of our database init, we perform a check of the current values for a few fields (graph driver, graph root, static dir, and a few more) to validate that Libpod is being started with a sane &amp; sensible config, and the user's containers can actually be expected to work. Basically, we take the current runtime config and compare against values cached in the database from the first time Podman was run. We've had some issues with this logic before this year around symlink resolution, but this is a new edge case. Somehow, the database is being loaded with the empty string for some fields (at least graph driver) which is causing comparisons to fail because we will never compare against &quot;&quot; for those fields - we insert the default value instead, assuming we have one. Having a value of &quot;&quot; in the database largely invalidates the check so arguably we could just drop it, but what BoltDB did - and what SQLite does after this patch - is to use the default value for comparison instead of &quot;&quot;. This should still catch some edge cases, and shouldn't be too harmful. What this does not do is identify or solve the reason that we are seeing the empty string in the database at all. From my read on the logic, it must mean that the graph driver is explicitly set to &quot;&quot; in the c/storage config at the time Podman is first run and I'm not precisely sure how that happens. Fixes #24738 Signed-off-by: Matt Heon &lt;mheon@redhat.com&gt;</MESSAGE>
      <SHA>3d344ffd2673586f70abb8aee362cdbb2af1aa11</SHA>
      <PATCHEDFILES>
        <FILE>libpod/sqlite_state.go</FILE>
        <FILE>test/system/005-info.bats</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
