<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>19504</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/19504</ISSUEURL>
  <TITLE>e2e: podman top with ps(1): race between run -d and top</TITLE>
  <DESCRIPTION>Infrequent, but seen twice in the last two days: ``` [It] podman top with ps(1) options $ podman [options] run -d registry.fedoraproject.org/fedora-minimal:34 sleep inf 522994a6b9a7d80063d324615deed494ecf3bd0053102c83b6c15b7d85a6736c $ podman [options] top 522994a6b9a7d80063d324615deed494ecf3bd0053102c83b6c15b7d85a6736c aux [no output, which causes test to fail] ``` Should be a simple fix: maybe add `podman wait --condition=running`, or maybe add an `echo READY` + `WaitForReady`. Filing as placeholder because I won't have time to get to it until next week. Also need to add annotations to the `len &gt; 1` assertions, something like &quot;number of output lines from top&quot;, because those are really hard to debug. (Alternatively, figure out a way to use `string...).To(HaveLen(Numerically(&gt;1))`). * fedora-38 : int podman fedora-38 rootless host sqlite * [08-03 20:34](https://api.cirrus-ci.com/v1/artifact/task/4722756869160960/html/int-podman-fedora-38-rootless-host-sqlite.log.html#t--Podman-top-podman-top-with-ps-1--options--1) in Podman top podman top with ps(1) options * rawhide : int podman rawhide rootless host sqlite * [08-03 13:22](https://api.cirrus-ci.com/v1/artifact/task/4915858598789120/html/int-podman-rawhide-rootless-host-sqlite.log.html#t--Podman-top-podman-top-with-ps-1--options--1) in Podman top podman top with ps(1) options</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>10</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #19573 from edsantiago/env-tests systests: tests for --env and --env-file</MESSAGE>
    <SHA>a60bafea489c1e0d266283d629ae693b763388a7</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>fix podman top missing output flake Sometimes there is no output displayed from the podman top command but no error is shown either. Looking at the code I think the issue here is that we do not wait for the output reader to end as it runs in a different goroutine. Thus the last lines of output might be missing. The fix is simply to wait for said goroutine to finish before returning. While at it also fix the missing scanner error check and return the read errors back to the caller. [NO NEW TESTS NEEDED] It is a flake. Fixes #19504 Signed-off-by: Paul Holzinger &lt;pholzing@redhat.com&gt;</MESSAGE>
      <SHA>4b80492bd2709727ba3897c964015f7eb0b21aa7</SHA>
      <PATCHEDFILES>
        <FILE>libpod/container_top_linux.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
