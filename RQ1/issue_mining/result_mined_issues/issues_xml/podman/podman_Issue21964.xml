<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>21964</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/21964</ISSUEURL>
  <TITLE>Podman v5.0.0-RC4 Machine init command results in error cannot find policy.json</TITLE>
  <DESCRIPTION>### Issue Description `podman machine init` command with podman v5.0.0-rc4 bits on windows with hyperv throws an error: ``` Error: failed to pull quay.io/baude/stage-podman-machine-image@sha256:6a47d33056736e2d9c68845a10fe7f5a6120d6fc0445288afcfbd0fbdbea2228: obtaining signature policy: open C:\Program Files\RedHat\Podman\podman.exe\policy.json: The system cannot find the path specified. ``` Related issue: https://github.com/containers/podman/issues/21855 ### Steps to reproduce the issue Steps to reproduce the issue 1. Install Podman (v5.0.0-rc4) from the setup.exe installer 2. Set `CONTAINERS_MACHINE_PROVIDER` to `hyperv` 3. `podman machine init` ### Describe the results you received ``` Error: failed to pull quay.io/baude/stage-podman-machine-image@sha256:6a47d33056736e2d9c68845a10fe7f5a6120d6fc0445288afcfbd0fbdbea2228: obtaining signature policy: open C:\Program Files\RedHat\Podman\podman.exe\policy.json: The system cannot find the path specified. ``` ### Describe the results you expected Podman machine created ### podman info output ```yaml podman info OS: windows/amd64 provider: hyperv version: 5.0.0-rc4 Cannot connect to Podman. Please verify your connection to the Linux system using `podman system connection list`, or try `podman machine init` and `podman machine start` to manage a new Linux VM Error: unable to connect to Podman socket: Get &quot;http://d/v5.0.0/libpod/_ping&quot;: dial unix /run/podman/podman.sock: connect: A socket operation encountered a dead network. ``` ### Podman in a container No ### Privileged Or Rootless None ### Upstream Latest Release Yes ### Additional environment details Windows 10 Professional CONTAINERS_MACHINE_PROVIDER=hyperv ### Additional information Whole command run with debugging on: ``` podman machine init --log-level=debug time=&quot;2024-03-06T22:48:42+01:00&quot; level=info msg=&quot;C:\\Program Files\\RedHat\\Podman\\podman.exe filtering at log level debug&quot; time=&quot;2024-03-06T22:48:42+01:00&quot; level=debug msg=&quot;Using Podman machine with `hyperv` virtualization provider&quot; time=&quot;2024-03-06T22:48:42+01:00&quot; level=debug msg=&quot;socket length for C:\\Users\\Ondrej\\.config\\containers\\podman\\machine\\hyperv is 56&quot; time=&quot;2024-03-06T22:48:42+01:00&quot; level=debug msg=&quot;socket length for C:\\Users\\Ondrej\\.local\\share\\containers\\podman\\machine\\hyperv is 61&quot; time=&quot;2024-03-06T22:48:42+01:00&quot; level=debug msg=&quot;socket length for C:\\Users\\Ondrej\\.local\\share\\containers\\podman\\machine\\hyperv\\cache is 67&quot; time=&quot;2024-03-06T22:48:42+01:00&quot; level=debug msg=&quot;socket length for C:\\Users\\Ondrej\\AppData\\Local\\Temp\\podman is 41&quot; time=&quot;2024-03-06T22:48:42+01:00&quot; level=debug msg=&quot;socket length for C:\\Users\\Ondrej\\.config\\containers\\podman\\machine\\hyperv is 56&quot; time=&quot;2024-03-06T22:48:42+01:00&quot; level=debug msg=&quot;socket length for C:\\Users\\Ondrej\\.local\\share\\containers\\podman\\machine\\hyperv is 61&quot; time=&quot;2024-03-06T22:48:42+01:00&quot; level=debug msg=&quot;socket length for C:\\Users\\Ondrej\\.local\\share\\containers\\podman\\machine\\hyperv\\cache is 67&quot; time=&quot;2024-03-06T22:48:42+01:00&quot; level=debug msg=&quot;socket length for C:\\Users\\Ondrej\\AppData\\Local\\Temp\\podman is 41&quot; time=&quot;2024-03-06T22:48:42+01:00&quot; level=debug msg=&quot;socket length for C:\\Users\\Ondrej\\.config\\containers\\podman\\machine\\hyperv\\podman-machine-default.json is 84&quot; time=&quot;2024-03-06T22:48:42+01:00&quot; level=debug msg=&quot;socket length for C:\\Users\\Ondrej\\.local\\share\\containers\\podman\\machine\\hyperv\\podman-machine-default-amd64.vhdx is 95&quot; time=&quot;2024-03-06T22:48:42+01:00&quot; level=debug msg=&quot;Using registries.d directory /etc/containers/registries.d&quot; time=&quot;2024-03-06T22:48:42+01:00&quot; level=debug msg=&quot;Loading registries configuration \&quot;/etc/containers/registries.conf\&quot;&quot; time=&quot;2024-03-06T22:48:42+01:00&quot; level=debug msg=&quot;Trying to access \&quot;quay.io/baude/stage-podman-machine-image:5.0\&quot;&quot; time=&quot;2024-03-06T22:48:42+01:00&quot; level=debug msg=&quot;No credentials matching quay.io/baude/stage-podman-machine-image found in C:\\Users\\Ondrej\\.config\\containers\\auth.json&quot; time=&quot;2024-03-06T22:48:42+01:00&quot; level=debug msg=&quot;No credentials matching quay.io/baude/stage-podman-machine-image found in C:\\Users\\Ondrej\\.config\\containers\\auth.json&quot; time=&quot;2024-03-06T22:48:42+01:00&quot; level=debug msg=&quot;No credentials matching quay.io/baude/stage-podman-machine-image found in C:\\Users\\Ondrej\\.docker\\config.json&quot; time=&quot;2024-03-06T22:48:42+01:00&quot; level=debug msg=&quot;No credentials matching quay.io/baude/stage-podman-machine-image found in C:\\Users\\Ondrej\\.dockercfg&quot; time=&quot;2024-03-06T22:48:42+01:00&quot; level=debug msg=&quot;No credentials for quay.io/baude/stage-podman-machine-image found&quot; time=&quot;2024-03-06T22:48:42+01:00&quot; level=debug msg=&quot; No signature storage configuration found for quay.io/baude/stage-podman-machine-image:5.0, using built-in default file://C:%5CUsers%5COndrej%5C.local%5Cshare%5Ccontainers%5Csigstore&quot; time=&quot;2024-03-06T22:48:42+01:00&quot; level=debug msg=&quot;Looking for TLS certificates and private keys in \\etc\\docker\\certs.d\\quay.io&quot; time=&quot;2024-03-06T22:48:42+01:00&quot; level=debug msg=&quot;GET https://quay.io/v2/&quot; time=&quot;2024-03-06T22:48:42+01:00&quot; level=debug msg=&quot;Ping https://quay.io/v2/ status 401&quot; time=&quot;2024-03-06T22:48:42+01:00&quot; level=debug msg=&quot;GET https://quay.io/v2/auth?scope=repository%3Abaude%2Fstage-podman-machine-image%3Apull&amp;service=quay.io&quot; time=&quot;2024-03-06T22:48:43+01:00&quot; level=debug msg=&quot;Increasing token expiration to: 60 seconds&quot; time=&quot;2024-03-06T22:48:43+01:00&quot; level=debug msg=&quot;GET https://quay.io/v2/baude/stage-podman-machine-image/manifests/5.0&quot; time=&quot;2024-03-06T22:48:43+01:00&quot; level=debug msg=&quot;Content-Type from manifest GET is \&quot;application/vnd.oci.image.index.v1+json\&quot;&quot; time=&quot;2024-03-06T22:48:43+01:00&quot; level=debug msg=&quot;found image in digest: \&quot;sha256:6a47d33056736e2d9c68845a10fe7f5a6120d6fc0445288afcfbd0fbdbea2228\&quot;&quot; time=&quot;2024-03-06T22:48:43+01:00&quot; level=debug msg=&quot;GET https://quay.io/v2/baude/stage-podman-machine-image/manifests/sha256:6a47d33056736e2d9c68845a10fe7f5a6120d6fc0445288afcfbd0fbdbea2228&quot; time=&quot;2024-03-06T22:48:43+01:00&quot; level=debug msg=&quot;Content-Type from manifest GET is \&quot;application/vnd.oci.image.manifest.v1+json\&quot;&quot; time=&quot;2024-03-06T22:48:43+01:00&quot; level=debug msg=&quot;original artifact file name: podman-machine-daily.x86_64.hyperv.vhdx.zst&quot; time=&quot;2024-03-06T22:48:43+01:00&quot; level=debug msg=&quot;GET https://quay.io/v2/baude/stage-podman-machine-image/manifests/sha256:6a47d33056736e2d9c68845a10fe7f5a6120d6fc0445288afcfbd0fbdbea2228&quot; time=&quot;2024-03-06T22:48:43+01:00&quot; level=debug msg=&quot;Content-Type from manifest GET is \&quot;application/vnd.oci.image.manifest.v1+json\&quot;&quot; time=&quot;2024-03-06T22:48:43+01:00&quot; level=debug msg=&quot;original artifact file name: podman-machine-daily.x86_64.hyperv.vhdx.zst&quot; time=&quot;2024-03-06T22:48:43+01:00&quot; level=debug msg=&quot;socket length for C:\\Users\\Ondrej\\.local\\share\\containers\\podman\\machine\\hyperv\\cache\\6a47d33056736e2d9c68845a10fe7f5a6120d6fc0445288afcfbd0fbdbea2228.vhdx.zst is 141&quot; time=&quot;2024-03-06T22:48:43+01:00&quot; level=debug msg=&quot;socket length for C:\\Users\\Ondrej\\.local\\share\\containers\\podman\\machine\\hyperv\\cache\\6a47d33056736e2d9c68845a10fe7f5a6120d6fc0445288afcfbd0fbdbea2228 is 132&quot; Error: failed to pull quay.io/baude/stage-podman-machine-image@sha256:6a47d33056736e2d9c68845a10fe7f5a6120d6fc0445288afcfbd0fbdbea2228: obtaining signature policy: open C:\Program Files\RedHat\Podman\podman.exe\policy.json: The system cannot find the path specified. time=&quot;2024-03-06T22:48:43+01:00&quot; level=debug msg=&quot;Shutting down engines&quot; ```</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>5</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #21960 from Luap99/machine-strongunits machine: make more use of strongunits</MESSAGE>
    <SHA>56e0f063bd280318a861d1c7f816160c31fdf7bb</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>pkg/machine: fix relative DefaultPolicyJSONPath When we set a relative path (i.e. &quot;.&quot;) it should be resolved next to binary so we need to get the base dir. If we join it directly like it did before you get a path like .../podman/policy.json where podman is the podman executable so it is not a directory and thus could not contain the policy.json file. ref #21964 Signed-off-by: Paul Holzinger &lt;pholzing@redhat.com&gt;</MESSAGE>
      <SHA>2ba3a2d56dcd5b8af6b1cdb7e2d61887a440ce80</SHA>
      <PATCHEDFILES>
        <FILE>pkg/machine/ocipull/policy.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
