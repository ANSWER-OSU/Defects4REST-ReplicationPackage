<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>17244</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/17244</ISSUEURL>
  <TITLE>[Bug]: ignition_linux.go failed on systemd-free Linux due to lack of `timedatectl` executable</TITLE>
  <DESCRIPTION>### Issue Description My machine is Artix Linux, based on Arch Linux and using OpenRC instead of systemd. `getLocalTimeZone` in [`ignition_linux.go`](https://github.com/containers/podman/blob/52d5f367b144f755dd20b18d88c5f79bc6b0c3fe/pkg/machine/ignition_linux.go) executes `timedatectl`, which is a part of systemd. Therefore, it failed in my env, and `.ign` was not created. ### Steps to reproduce the issue Steps to reproduce the issue 1. Use systemd-free Linux. 2. Install Podman and run `podman machine init` ### Describe the results you received 1. The error was: ```console Extracting compressed file Image resized. Error: exec: &quot;timedatectl&quot;: executable file not found in $PATH ``` 2. Additionally, since `podman-machine-default.ign` was not created, running `podman machine start` in the next step also failed with the error: ```console Starting machine &quot;podman-machine-default&quot; Waiting for VM ... Error: qemu exited unexpectedly with exit code 1, stderr: qemu-system-x86_64: -fw_cfg name=opt/com.coreos/config,file=/home/(...)/.config/containers/podman/machine/qemu/podman-machine-default.ign: can't load /home/(...)/.config/containers/podman/machine/qemu/podman-machine-default.ign: Failed to open file “/home/(...)/.config/containers/podman/machine/qemu/podman-machine-default.ign”: No such file or directory ``` ### Describe the results you expected `podman machine init` is successful with systemd-free Linux. ### podman info output ```shell OS: Artix Linux with OpenRC x86_64 Podman: 4.3.1 ``` ### Podman in a container No ### Privileged Or Rootless Rootless ### Upstream Latest Release Yes ### Additional environment details \- ### Additional information I made a custom Rust script to print my timezone named &quot;timedatectl&quot;. After it built and placed in `$PATH`, `podman machine init` succeeded. The `.ign` file was created with content written. In my opinion, on systemd-free Linux, `exec.Command(&quot;timedatectl&quot;, &quot;show&quot;, &quot;--property=Timezone&quot;).Output()` should be replaced with `exec.Command(&quot;cat&quot;, &quot;/etc/timezone&quot;).Output()` in `ignition_linux.go`. For example: ```go var output o, err := exec.Command(&quot;pidof&quot;, &quot;systemd&quot;).Output() if string(o) == &quot;1\n&quot; || err != nil { // default output, err = exec.Command(&quot;timedatectl&quot;, &quot;show&quot;, &quot;--property=Timezone&quot;).Output() } else { // systemd-free output, err = exec.Command(&quot;cat&quot;, &quot;/etc/timezone&quot;).Output() } ```</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>3</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #17266 from n1hility/fix-image-path Fix usage of absolute windows paths with --image-path</MESSAGE>
    <SHA>b7987ca2ba2177c7adb01127c68f7745666e6248</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Merge pull request #17264 from nabbisen/17244-timedatectl_doesnt_exist_on_systemd_free_linux fix #17244: use /etc/timezone where `timedatectl` is missing on Linux</MESSAGE>
      <SHA>1f9d2f40237e194cf0e28026ea2406b319cffdcf</SHA>
      <PATCHEDFILES>
        <FILE>pkg/machine/ignition_linux.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>fix #17244: use /etc/timezone where `timedatectl` is missing on Linux Signed-off-by: nabbisen &lt;nabbisen@scqr.net&gt;</MESSAGE>
      <SHA>4b93af759604a9ee2a72c150a5c9eaf4653a577a</SHA>
      <PATCHEDFILES>
        <FILE>pkg/machine/ignition_linux.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>fix #17244: use /etc/timezone where `timedatectl` is missing on Linux [NO NEW TESTS NEEDED] Signed-off-by: nabbisen &lt;nabbisen@scqr.net&gt; Signed-off-by: Valentin Rothberg &lt;vrothberg@redhat.com&gt;</MESSAGE>
      <SHA>9eb9607076f37e5f737c15783b89017de36b742d</SHA>
      <PATCHEDFILES>
        <FILE>pkg/machine/ignition_linux.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Merge pull request #17280 from vrothberg/cherry-pick-17264-to-v4.4 [v4.4] fix #17244: use /etc/timezone where `timedatectl` is missing on Linux</MESSAGE>
      <SHA>1878d04f8e714bb003eda9052a8d9825c0d41d81</SHA>
      <PATCHEDFILES>
        <FILE>pkg/machine/ignition_linux.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
