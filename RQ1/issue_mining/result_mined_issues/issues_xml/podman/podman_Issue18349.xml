<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>18349</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/18349</ISSUEURL>
  <TITLE>&quot;sudo podman system reset&quot; deletes current working directory</TITLE>
  <DESCRIPTION>### Issue Description I just figured out that `sudo podman system reset` deletes the current working directory. This is on btrfs with the btrfs storage driver on Debian 12 bookworm. When I found this bug my current working directory was my home directory :( ### Steps to reproduce the issue Steps to reproduce the issue: Only try in an empty directory for test! 1. `mkdir test` 2. `cd test` 3. `sudo podman system reset` 4. `cd ..` 5. `ls -l` ### Describe the results you received Well, the working directory at the time of the reset is gone. ### Describe the results you expected podman shouldn't touch the working directory. ### podman info output ```yaml host: arch: amd64 buildahVersion: 1.28.2 cgroupControllers: - cpuset - cpu - io - memory - hugetlb - pids - rdma - misc cgroupManager: systemd cgroupVersion: v2 conmon: package: conmon_2.1.6+ds1-1_amd64 path: /usr/bin/conmon version: 'conmon version 2.1.6, commit: unknown' cpuUtilization: idlePercent: 94.3 systemPercent: 2.1 userPercent: 3.61 cpus: 4 distribution: codename: bookworm distribution: debian version: &quot;12&quot; eventLogger: journald hostname: desktop idMappings: gidmap: null uidmap: null kernel: 6.2.11 linkmode: dynamic logDriver: journald memFree: 7669645312 memTotal: 16706768896 networkBackend: netavark ociRuntime: name: crun package: crun_1.8.1-1+b1_amd64 path: /usr/bin/crun version: |- crun version 1.8.1 commit: f8a096be060b22ccd3d5f3ebe44108517fbf6c30 rundir: /run/crun spec: 1.0.0 +SYSTEMD +SELINUX +APPARMOR +CAP +SECCOMP +EBPF +YAJL os: linux remoteSocket: path: /run/podman/podman.sock security: apparmorEnabled: false capabilities: CAP_CHOWN,CAP_DAC_OVERRIDE,CAP_FOWNER,CAP_FSETID,CAP_KILL,CAP_NET_BIND_SERVICE,CAP_SETFCAP,CAP_SETGID,CAP_SETPCAP,CAP_SETUID,CAP_SYS_CHROOT rootless: false seccompEnabled: true seccompProfilePath: /usr/share/containers/seccomp.json selinuxEnabled: false serviceIsRemote: false slirp4netns: executable: /usr/bin/slirp4netns package: slirp4netns_1.2.0-1_amd64 version: |- slirp4netns version 1.2.0 commit: 656041d45cfca7a4176f6b7eed9e4fe6c11e8383 libslirp: 4.7.0 SLIRP_CONFIG_VERSION_MAX: 4 libseccomp: 2.5.4 swapFree: 25769799680 swapTotal: 25769799680 uptime: 0h 59m 32.00s plugins: authorization: null log: - k8s-file - none - passthrough - journald network: - bridge - macvlan volume: - local registries: {} store: configFile: /etc/containers/storage.conf containerStore: number: 0 paused: 0 running: 0 stopped: 0 graphDriverName: btrfs graphOptions: {} graphRoot: /var/lib/containers/storage/btrfs graphRootAllocated: 127497404416 graphRootUsed: 16362708992 graphStatus: Build Version: Btrfs v6.2 Library Version: &quot;102&quot; imageCopyTmpDir: /var/tmp imageStore: number: 0 runRoot: /home/jan volumePath: /var/lib/containers/storage/btrfs/volumes version: APIVersion: 4.3.1 Built: 0 BuiltTime: Thu Jan 1 01:00:00 1970 GitCommit: &quot;&quot; GoVersion: go1.19.6 Os: linux OsArch: linux/amd64 Version: 4.3.1 ``` ### Podman in a container No ### Privileged Or Rootless None ### Upstream Latest Release No ### Additional environment details Debian 12 bookworm btrfs as backing filesystem with btrfs storage driver ### Additional information I'm also observing the directories &quot;btrfs-containers&quot;, &quot;btrfs-layers&quot;, &quot;btrfs-locks&quot; being created in random places around my filesystem. I have tried this on Fedora CoreOS also with btrfs filesystem and driver and have not observed the issue. I'm also not observing this issue with rootless podman.</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>31</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #18328 from ashley-cui/stop Recover from failed podman machine start</MESSAGE>
    <SHA>3b85ab354aef57c75e31683607f2499607ba6f52</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>system reset: show graphRoot/runRoot before removal system reset it says it will delete containers, images, networks, etc... However it will also delete the graphRoot and runRoot directories. Normally this is not an issue, however in same cases these directories were set to the users home directory or some other important system directory. As first step simply show the directories that are configured and thus will be deleted by reset. As future step we could implement some safeguard will will not delete some known important directories however I tried to keep it simple for now. [NO NEW TESTS NEEDED] see #18349 and #18295 Signed-off-by: Paul Holzinger &lt;pholzing@redhat.com&gt;</MESSAGE>
      <SHA>6aaf6a28435c1308b181832a0e1184a4a614066b</SHA>
      <PATCHEDFILES>
        <FILE>cmd/podman/system/reset.go</FILE>
        <FILE>docs/source/markdown/podman-system-reset.1.md</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>[v3.4] system reset: show graphRoot/runRoot before removal Backport of commit 6aaf6a28435c. system reset it says it will delete containers, images, networks, etc... However it will also delete the graphRoot and runRoot directories. Normally this is not an issue, however in same cases these directories were set to the users home directory or some other important system directory. As first step simply show the directories that are configured and thus will be deleted by reset. As future step we could implement some safeguard will will not delete some known important directories however I tried to keep it simple for now. [NO NEW TESTS NEEDED] see #18349, #18295, and #19870 Signed-off-by: Valentin Rothberg &lt;vrothberg@redhat.com&gt;</MESSAGE>
      <SHA>a34dbdc53ff8e06f696730e084f2133408b2a567</SHA>
      <PATCHEDFILES>
        <FILE>cmd/podman/system/reset.go</FILE>
        <FILE>docs/source/markdown/podman-system-reset.1.md</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>[v4.3] system reset: show graphRoot/runRoot before removal Backport of commit 6aaf6a28435c. system reset it says it will delete containers, images, networks, etc... However it will also delete the graphRoot and runRoot directories. Normally this is not an issue, however in same cases these directories were set to the users home directory or some other important system directory. As first step simply show the directories that are configured and thus will be deleted by reset. As future step we could implement some safeguard will will not delete some known important directories however I tried to keep it simple for now. [NO NEW TESTS NEEDED] see #18349 and #18295 Signed-off-by: Paul Holzinger &lt;pholzing@redhat.com&gt; Signed-off-by: Valentin Rothberg &lt;vrothberg@redhat.com&gt;</MESSAGE>
      <SHA>88204ef82de515e65c5b68cc89598c5c8db95cba</SHA>
      <PATCHEDFILES>
        <FILE>cmd/podman/system/reset.go</FILE>
        <FILE>docs/source/markdown/podman-system-reset.1.md</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
