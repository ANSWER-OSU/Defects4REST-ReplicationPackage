<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>16365</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/16365</ISSUEURL>
  <TITLE>Required testing tools missing from `CONTRIBUTING.md`</TITLE>
  <DESCRIPTION>**Is this a BUG REPORT or FEATURE REQUEST? (leave only one on its own line)** /kind bug **Description** **Steps to reproduce the issue:** 1. Follow the instructions in [CONTRIBUTING.md](https://github.com/containers/podman/blob/a30c9ef752d956f884b13a4132cb2081dc7072b3/CONTRIBUTING.md) 2. Try to run `make test` or `make localsystem`. **Describe the results you received:** Running the tests fails, because the testing tool `bats` isn't installed on the system: ``` $ make localsystem # Wipe existing config, database, and cache: start with clean slate. rm -f -rf /home/user/.local/share/containers /home/user/.config/containers if timeout -v 1 true; then PODMAN=/home/user/podman/bin/podman bats test/system/; else echo &quot;Skipping localsystem: 'timeout -v' unavailable'&quot;; fi /bin/sh: 1: bats: not found make: *** [Makefile:576: localsystem] Error 127 ``` **Describe the results you expected:** Tests should complete successfully. **Additional information you deem important (e.g. issue happens only occasionally):** On Ubuntu systems, `bats` can be installed using `sudo apt-get install bats`. This could be added to `CONTRIBUTING.md`, perhaps in the section starting at line 107: https://github.com/containers/podman/blob/fa19f57ebe8223bbb44e1948a997cb62cc292d15/CONTRIBUTING.md?plain=1#L107-L111 edited to add: - It looks like `buildah` is another tool the tests expect to be installed, which isn't mentioned in the installation instructions or in `CONTRIBUTING.md`. If `buildah` isn't installed, then at least one of the system tests from `make localsystem` fails: ``` ✗ podman rm container from storage (in test file test/system/055-rm.bats, line 45) `external_cid=$(buildah from $IMAGE)' failed with status 127 $ /home/vagrant/podman/bin/podman rm -t 0 --all --force --ignore $ /home/vagrant/podman/bin/podman ps --all --external --format {{.ID}} {{.Names}} $ /home/vagrant/podman/bin/podman images --all --format {{.Repository}}:{{.Tag}} {{.ID}} quay.io/libpod/testimage:20221018 f5a99120db64 $ /home/vagrant/podman/bin/podman create --name 3cgBbCzjbDDsNpNlTE9yXdLRzwMIS4 quay.io/libpod/testimage:20221018 /bin/true 65d8ec846ce494b1b982c786a16f029b8ebb62a5053b6ffb454d67b9c89a7171 /tmp/bats.62994.src: line 45: buildah: command not found # [teardown] $ /home/vagrant/podman/bin/podman pod rm -t 0 --all --force --ignore $ /home/vagrant/podman/bin/podman rm -t 0 --all --force --ignore 65d8ec846ce494b1b982c786a16f029b8ebb62a5053b6ffb454d67b9c89a7171 $ /home/vagrant/podman/bin/podman network prune --force $ /home/vagrant/podman/bin/podman volume rm -a -f ``` edited again: other tools used by `make localsystem` which aren't mentioned in `CONTRIBUTING.md`, and the absence of which causes test failures, include the following: - `htpasswd`, used [here](https://github.com/containers/podman/blob/main/test/system/150-login.bats#L77): https://github.com/containers/podman/blob/33858c1cf85d635a6b84346719b1353a091c353c/test/system/150-login.bats#L77 Not having it installed results in the following failure: ``` podman login [start registry]220/401 ✗ podman login [start registry] (in test file test/system/150-login.bats, line 77) `htpasswd -Bbn ${PODMAN_LOGIN_USER} ${PODMAN_LOGIN_PASS} \' failed with status 127 $ /home/vagrant/podman/bin/podman rm -t 0 --all --force --ignore $ /home/vagrant/podman/bin/podman ps --all --external --format {{.ID}} {{.Names}} $ /home/vagrant/podman/bin/podman images --all --format {{.Repository}}:{{.Tag}} {{.ID}} quay.io/libpod/testimage:20221018 f5a99120db64 $ /home/vagrant/podman/bin/podman --storage-driver=vfs --root /tmp/podman_bats_login.4t0wEJ/root --runroot /tmp/podman_bats_login.4t0wEJ/runroot pull quay.io/libpod/r egistry:2.8 Trying to pull quay.io/libpod/registry:2.8... Getting image source signatures Copying blob sha256:3b494d572400cf4b26beff6a89af57b70fbc1d7a2c1aa7a0d7b67c756bdaed61 Copying blob sha256:88ce0e919729180f43f37c386397ee7df6154e172f4f104c7196572d2eb88919 Copying blob sha256:0fec280ccc88586d94f581861ff02b7e9c16fc128e61be7315365e18efa9994f Copying blob sha256:40e059520d199e1a1a259089077f2a0c879951c9a4540490bad3a0d7714c6ae7 Copying blob sha256:d637f99b74411f98a3d6a4e4f9a496eac649828eac5253d596eac97128af1aaf Copying config sha256:d3241e050fc981849fc396c054aa87da6b1e2d748ee46cd3e71bf89050881631 Writing manifest to image destination Storing signatures d3241e050fc981849fc396c054aa87da6b1e2d748ee46cd3e71bf89050881631 Generating a RSA private key ..................................................++++ ........................++++ writing new private key to '/tmp/podman_bats_login.4t0wEJ/auth/domain.key' ----- /tmp/bats.252649.src: line 77: htpasswd: command not found # [teardown] $ /home/vagrant/podman/bin/podman pod rm -t 0 --all --force --ignore $ /home/vagrant/podman/bin/podman rm -t 0 --all --force --ignore $ /home/vagrant/podman/bin/podman network prune --force $ /home/vagrant/podman/bin/podman volume rm -a -f ``` On Ubuntu, it can be installed with `sudo apt install apache2-utils`. - `socat`, which is used throughout [test/system/260-sdnotify.bats](https://github.com/containers/podman/blob/33858c1cf85d635a6b84346719b1353a091c353c/test/system/260-sdnotify.bats), and the absence of which causes (inter alia) this failure: ``` sdnotify : ignore308/401 ✗ sdnotify : ignore (from function `_stop_socat' in file test/system/260-sdnotify.bats, line 63, in test file test/system/260-sdnotify.bats, line 103) `_stop_socat' failed $ /home/vagrant/podman/bin/podman rm -t 0 --all --force --ignore $ /home/vagrant/podman/bin/podman ps --all --external --format {{.ID}} {{.Names}} $ /home/vagrant/podman/bin/podman images --all --format {{.Repository}}:{{.Tag}} {{.ID}} quay.io/libpod/testimage:20221018 f5a99120db64 /tmp/bats.281271.src: line 50: exec: socat: not found $ /home/vagrant/podman/bin/podman create --rm --sdnotify=ignore quay.io/libpod/testimage:20221018 printenv NOTIFY_SOCKET 391ede2ae98c613150bc01148d29ef2980c12545edadbe11df5df8da31dba00b $ /home/vagrant/podman/bin/podman container inspect 391ede2ae98c613150bc01148d29ef2980c12545edadbe11df5df8da31dba00b --format {{.Config.SdNotifyMode}} {{.Config.SdNotifySocket}} ignore $ /home/vagrant/podman/bin/podman start --attach 391ede2ae98c613150bc01148d29ef2980c12545edadbe11df5df8da31dba00b [ rc=1 (expected) ] /tmp/bats.281271.src: line 63: kill: (281355) - No such process /tmp/bats.281271.src: line 63: kill: (281355) - No such process # [teardown] $ /home/vagrant/podman/bin/podman pod rm -t 0 --all --force --ignore $ /home/vagrant/podman/bin/podman rm -t 0 --all --force --ignore $ /home/vagrant/podman/bin/podman network prune --force $ /home/vagrant/podman/bin/podman volume rm -a -f ``` On Ubuntu, it can be installed with `sudo apt install socat`. **Output of `podman version`:** N/A **Output of `podman info`:** N/A **Package info (e.g. output of `rpm -q podman` or `apt list podman` or `brew info podman`):** N/A **Have you tested with the latest version of Podman and have you checked the Podman Troubleshooting Guide? (https://github.com/containers/podman/blob/main/troubleshooting.md)** Yes **Additional environment details (AWS, VirtualBox, physical, etc.):** Build environment: Ubuntu 20.04.4, running kernel 5.4.0-122-generic on x86-64.</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>1</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #16349 from austinvazquez/update-github-actions-packages Upgrade GitHub actions packages from v2 to v3</MESSAGE>
    <SHA>38ffed69278c6941950f008bbddf795779927641</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>docs: offer advice on installing test dependencies Basically, acknowledge the need for dependencies and link to Fedora specfile which is the only sane place to find such a list. Closes: #16365 Signed-off-by: Ed Santiago &lt;santiago@redhat.com&gt;</MESSAGE>
      <SHA>d1f3dd9e5be1e40d1b757a5af2a53e57848b5f9a</SHA>
      <PATCHEDFILES>
        <FILE>CONTRIBUTING.md</FILE>
        <FILE>test/README.md</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
