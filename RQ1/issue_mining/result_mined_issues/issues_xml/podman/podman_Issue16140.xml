<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>16140</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/16140</ISSUEURL>
  <TITLE>joining network namespace: unknown FS magic</TITLE>
  <DESCRIPTION>Wow! This one has been hiding for months, perhaps longer. It seems to trigger often in int-test cleanup, where we do no error checking. I just noticed it in a real-live test failure: ``` $ podman [options] ps -q time=&quot;2022-10-12T12:18:08Z&quot; level=error msg=&quot;Joining network namespace for container &lt;ID&gt;: retrieving network namespace at /run/user/6026/netns/netns-UUID: unknown FS magic on \&quot;/run/user/6026/netns/netns-UUID\&quot;: 1021994&quot; Error: joining network namespace of container &lt;ID&gt;: retrieving network namespace at /run/user/6026/netns/netns-&lt;UUID&gt;: unknown FS magic on &quot;/run/user/6026/netns/netns-&lt;UUID&gt;&quot;: 1021994 [AfterEach] Podman pod kill ``` Only one log to show right now, [ubuntu rootless](https://api.cirrus-ci.com/v1/artifact/task/6174187956994048/html/int-podman-ubuntu-2204-rootless-host.log.html#t--podman-pod-kill-latest-pod--1). This log file also shows three other instances of the problem, all of them non-fatal because they happen in cleanup. Search in-page for &quot;fs magic&quot;.</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>65</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #16817 from Luap99/no-CNI libpod: remove CNI word were no longer applicable</MESSAGE>
    <SHA>fd7049b1876eb60857be2d58780d55ffb28396cc</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>libpod: move NetNS into state db instead of extra bucket This should simplify the db logic. We no longer need a extra db bucket for the netns, it is still supported in read only mode for backwards compat. The old version required us to always open the netns before we could attach it to the container state struct which caused problem in some cases were the netns was no longer valid. Now we use the netns as string throughout the code, this allow us to only open it when needed reducing possible errors. [NO NEW TESTS NEEDED] Existing tests should cover it and it is only a flake so hard to reproduce the error. Fixes #16140 Signed-off-by: Paul Holzinger &lt;pholzing@redhat.com&gt;</MESSAGE>
      <SHA>0bc3d35791a86e53bedadd72afff2c0d53a290f2</SHA>
      <PATCHEDFILES>
        <FILE>libpod/boltdb_state.go</FILE>
        <FILE>libpod/boltdb_state_freebsd.go</FILE>
        <FILE>libpod/boltdb_state_internal.go</FILE>
        <FILE>libpod/boltdb_state_linux.go</FILE>
        <FILE>libpod/container.go</FILE>
        <FILE>libpod/container_freebsd.go</FILE>
        <FILE>libpod/container_internal.go</FILE>
        <FILE>libpod/container_internal_freebsd.go</FILE>
        <FILE>libpod/container_internal_linux.go</FILE>
        <FILE>libpod/container_linux.go</FILE>
        <FILE>libpod/networking_common.go</FILE>
        <FILE>libpod/networking_freebsd.go</FILE>
        <FILE>libpod/networking_linux.go</FILE>
        <FILE>libpod/networking_pasta_linux.go</FILE>
        <FILE>libpod/networking_slirp4netns.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
