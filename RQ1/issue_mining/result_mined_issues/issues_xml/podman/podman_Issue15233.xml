<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>15233</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/15233</ISSUEURL>
  <TITLE>Conflicting `--uidmap` and `--userns` documentation</TITLE>
  <DESCRIPTION>&lt;!-- --------------------------------------------------- BUG REPORT INFORMATION --------------------------------------------------- Use the commands below to provide key information from your environment: You do NOT have to include this information if this is a FEATURE REQUEST **NOTE** A large number of issues reported against Podman are often found to already be fixed in more current versions of the project. Before reporting an issue, please verify the version you are running with `podman version` and compare it to the latest release documented on the top of Podman's [README.md](../README.md). If they differ, please update your version of Podman to the latest possible and retry your command before creating an issue. Also, there is a running list of known issues in the [Podman Troubleshooting Guide](https://github.com/containers/podman/blob/main/troubleshooting.md), please reference that page before opening a new issue. If you are filing a bug against `podman build`, please instead file a bug against Buildah (https://github.com/containers/buildah/issues). Podman build executes Buildah to perform container builds, and as such the Buildah maintainers are best equipped to handle these bugs. --&gt; **Is this a BUG REPORT or FEATURE REQUEST? (leave only one on its own line)** /kind bug **Description** &lt;!-- Briefly describe the problem you are having in a few paragraphs. --&gt; **Steps to reproduce the issue:** The manual page `podman-create` describes the `--userns` option with _&quot;This option is incompatible with --gidmap, --uidmap, --subuidname and --subgidname.&quot;_. However, creating a container with only `--userns` fails: ``` $ podman create -it --name podtest11 --userns=private opensuse/leap:latest Error: must provide at least one UID or GID mapping to configure a user namespace ``` Only if `--uidmap`, which is supposedly incompatible, is added, the command will execute: ``` $ podman create -it --name podtest11 --uidmap=0:1001:8192 --userns=private opensuse/leap:latest a1a746729cb558c2c6aef6bc265e187db8458b277ac7f19eb956129444689716 ``` **Describe the results you received:** `Error: must provide at least one UID or GID mapping to configure a user namespace` **Describe the results you expected:** The `podman create` call should either work without the conflicting options, or the documentation on the various options should be clarified, in order to understand why the combination is incompatible, albeit it seemingly being required. **Additional information you deem important (e.g. issue happens only occasionally):** There are possibly other parts of the documentation where similar conflicts are referenced - the `--userns` one is the one that stood out to me first. **Output of `podman version`:** ``` podman version 4.1.1 ``` **Output of `podman info`:** ``` podman info host: arch: amd64 buildahVersion: 1.26.1 cgroupControllers: - cpuset - cpu - io - memory - hugetlb - pids - rdma - misc cgroupManager: systemd cgroupVersion: v2 conmon: package: conmon-2.1.2-1.1.x86_64 path: /usr/bin/conmon version: 'conmon version 2.1.2, commit: unknown' cpuUtilization: idlePercent: 97.24 systemPercent: 0.28 userPercent: 2.48 cpus: 2 distribution: distribution: '&quot;opensuse-tumbleweed&quot;' version: &quot;20220804&quot; eventLogger: journald hostname: tumbleweed01 idMappings: gidmap: null uidmap: null kernel: 5.18.15-1-default linkmode: dynamic logDriver: journald memFree: 119758848 memTotal: 2067652608 networkBackend: cni ociRuntime: name: runc package: runc-1.1.3-2.1.x86_64 path: /usr/bin/runc version: |- runc version 1.1.3 commit: v1.1.3-0-ga916309fff0f spec: 1.0.2-dev go: go1.18.3 libseccomp: 2.5.4 os: linux remoteSocket: path: /run/podman/podman.sock security: apparmorEnabled: true capabilities: CAP_AUDIT_WRITE,CAP_CHOWN,CAP_DAC_OVERRIDE,CAP_FOWNER,CAP_FSETID,CAP_KILL,CAP_MKNOD,CAP_NET_BIND_SERVICE,CAP_NET_RAW,CAP_SETFCAP,CAP_SETGID,CAP_SETPCAP,CAP_SETUID,CAP_SYS_CHROOT rootless: false seccompEnabled: true seccompProfilePath: /etc/containers/seccomp.json selinuxEnabled: false serviceIsRemote: false slirp4netns: executable: /usr/bin/slirp4netns package: slirp4netns-1.1.11-1.6.x86_64 version: |- slirp4netns version 1.1.11 commit: unknown libslirp: 4.7.0 SLIRP_CONFIG_VERSION_MAX: 3 libseccomp: 2.5.4 swapFree: 1627389952 swapTotal: 2148507648 uptime: 12h 58m 38.64s (Approximately 0.50 days) plugins: log: - k8s-file - none - passthrough - journald network: - bridge - macvlan - ipvlan volume: - local registries: search: - registry.opensuse.org - registry.suse.com - docker.io store: configFile: /etc/containers/storage.conf containerStore: number: 11 paused: 0 running: 11 stopped: 0 graphDriverName: btrfs graphOptions: {} graphRoot: /var/lib/containers/storage graphRootAllocated: 29525803008 graphRootUsed: 11188219904 graphStatus: Build Version: Btrfs v5.18.1 Library Version: &quot;102&quot; imageCopyTmpDir: /var/tmp imageStore: number: 2 runRoot: /var/run/containers/storage volumePath: /var/lib/containers/storage/volumes version: APIVersion: 4.1.1 Built: 1656633600 BuiltTime: Fri Jul 1 02:00:00 2022 GitCommit: &quot;&quot; GoVersion: go1.16.15 Os: linux OsArch: linux/amd64 Version: 4.1.1 ``` **Package info (e.g. output of `rpm -q podman` or `apt list podman`):** ``` podman-4.1.1-2.1.x86_64 ``` **Have you tested with the latest version of Podman and have you checked the Podman Troubleshooting Guide? (https://github.com/containers/podman/blob/main/troubleshooting.md)** Yes **Additional environment details (AWS, VirtualBox, physical, etc.):**</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #15182 from cevich/remove_disused_envar Cirrus: Remove disused env. var.</MESSAGE>
    <SHA>635293ed149a6680c5999360ce39daf4625bfa92</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>cmd: refuse --userns if a mapping is specified if an explicit mapping is specified, do not accept `--userns` since it overriden to &quot;private&quot;. Closes: https://github.com/containers/podman/issues/15233 Signed-off-by: Giuseppe Scrivano &lt;gscrivan@redhat.com&gt;</MESSAGE>
      <SHA>2e3a192bb0968e0c07627165de429bd9942af88d</SHA>
      <PATCHEDFILES>
        <FILE>cmd/podman/containers/create.go</FILE>
        <FILE>test/e2e/run_userns_test.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>cmd: refuse --userns if a mapping is specified if an explicit mapping is specified, do not accept `--userns` since it overriden to &quot;private&quot;. Closes: https://github.com/containers/podman/issues/15233 Signed-off-by: Giuseppe Scrivano &lt;gscrivan@redhat.com&gt;</MESSAGE>
      <SHA>fa1085ed01e2b901bfd3963ea4e1952a9d27a694</SHA>
      <PATCHEDFILES>
        <FILE>cmd/podman/containers/create.go</FILE>
        <FILE>test/e2e/run_userns_test.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
