<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>18216</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/18216</ISSUEURL>
  <TITLE>Allow podman-remote push to accept the --digestfile flag</TITLE>
  <DESCRIPTION>### Feature request description When using Tekton Chains to sign images generated through Tekton the outputs of Image_digest and Image URL are used by Tekton chains to generate attestation and to cosign the images. When using podman-remote especially when accessing a build server to build and push the process can be completed successfully but I cannot gain the digest information without doing a work around like scp or another back to the Tekton task. ### Suggest potential solution If we were to enable the flag to record the sha and write it to the system running podman-remote the problem would be resolved. I'm unsure if it could be grabbed from stdout of the podman-remote push. ### Have you considered any alternatives? Using podman-remote save to save the image to the pipeline allows for a potential breach of trust. ### Additional context This could be incredibly helpful for GitHub actions as well as Tekton/Tekton chains to build different architectures without needing a full kubernetes cluster of that architecture just a single VM</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>5</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>rename ImagePushReport to ImagePushStream The Report will be used in a future change as a new return value for the internal Push API. Note: this change is only breaking internal APIs while user-facing external ones remain unchanges. Signed-off-by: Valentin Rothberg &lt;vrothberg@redhat.com&gt;</MESSAGE>
    <SHA>00fdfa063610a480cddf15e3cf6151731cf8db51</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>support `--digestfile` for remote push Wire in support for writing the digest of the pushed image to a user-specified file. Requires some massaging of _internal_ APIs and the extension of the push endpoint to integrate the raw manifest (i.e., in bytes) in the stream. Closes: #18216 Signed-off-by: Valentin Rothberg &lt;vrothberg@redhat.com&gt;</MESSAGE>
      <SHA>1f1525f2e184882c2c3b0f02f353e44fd468238e</SHA>
      <PATCHEDFILES>
        <FILE>cmd/podman/images/push.go</FILE>
        <FILE>cmd/podman/manifest/push.go</FILE>
        <FILE>docs/source/markdown/options/digestfile.md</FILE>
        <FILE>pkg/api/handlers/compat/images_push.go</FILE>
        <FILE>pkg/api/handlers/libpod/images_push.go</FILE>
        <FILE>pkg/bindings/images/push.go</FILE>
        <FILE>pkg/bindings/images/types.go</FILE>
        <FILE>pkg/bindings/images/types_push_options.go</FILE>
        <FILE>pkg/domain/entities/engine_image.go</FILE>
        <FILE>pkg/domain/entities/images.go</FILE>
        <FILE>pkg/domain/infra/abi/images.go</FILE>
        <FILE>pkg/domain/infra/tunnel/images.go</FILE>
        <FILE>test/e2e/push_test.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
