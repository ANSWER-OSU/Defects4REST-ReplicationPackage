<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>23671</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/23671</ISSUEURL>
  <TITLE>podman mount: yet another race: layer not known</TITLE>
  <DESCRIPTION>Triggered in [parallel system tests](https://api.cirrus-ci.com/v1/artifact/task/6309819978612736/html/sys-podman-fedora-40-root-host-sqlite.log.html#t--00058p) with precious little to go on. I've reproduced via: ```console Window 1: # while :;do printf &quot;FROM quay.io/libpod/testimage:20240123\nRUN date\n&quot; | bin/podman build -t foo -;bin/podman rmi foo;done ``` ```console Window 2: # while :;do bin/podman mount --notruncate || break;done ... Error: layer not known ``` Took almost an hour to fail on 1mt. main @ 7899358ec9463c3a490664d9c948199ba9778ece (includes #23645)</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>42</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #24062 from ygalblum/quadlet-restore-dir-order Quadlet - make sure the order of the UnitsDir is deterministic</MESSAGE>
    <SHA>87dcf9d9d22afaeccdcbe0aebb7f21ef9d38dd31</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>podman mount: ignore ErrLayerUnknown When we check for a storage container mount we normally expect a ErrContainerUnknown when it does not exists. However during we check if it is actually mounted we also can get ErrLayerUnknown when the contianer was removed between the Container and Mount checks as they do not happen under the same lock. Fixes #23671 Signed-off-by: Paul Holzinger &lt;pholzing@redhat.com&gt;</MESSAGE>
      <SHA>5c3019e0288830e77ac19ad330ab77a2277be4ae</SHA>
      <PATCHEDFILES>
        <FILE>pkg/domain/infra/abi/containers.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>podman mount: some better error wrapping As shown in #23671 these functions can return the raw error without any useful context to the user which makes it hard to understand where things went wrong. Simply add some context to some error paths here. Signed-off-by: Paul Holzinger &lt;pholzing@redhat.com&gt;</MESSAGE>
      <SHA>1950555b2646fc5a49d5ce66b4b375b386ec063b</SHA>
      <PATCHEDFILES>
        <FILE>libpod/runtime_ctr.go</FILE>
        <FILE>pkg/domain/infra/abi/containers.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
