<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>15580</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/15580</ISSUEURL>
  <TITLE>docker-compose up --force-recreate fails with 'Network [..] needs to be recreated - option &quot;isolate&quot; has changed'</TITLE>
  <DESCRIPTION>/kind bug **Description** Since updating podman to 4.2.0 I'm unable to use `docker-compose up -d --force-recreate` when the containers are already running **Steps to reproduce the issue:** 1. Have minimal docker-compose.yml e.g. ``` version: &quot;3.8&quot; services: redis: image: &quot;redis:alpine&quot; ports: - &quot;127.0.0.1:6379:6379&quot; ``` 2. first run of `docker-compose up -d --force-recreate` as there are no containers running 3. second run of `docker-compose up -d --force-recreate` fails with ``` ERROR: Network &quot;recreatebug_default&quot; needs to be recreated - option &quot;isolate&quot; has changed ``` **Describe the results you received:** Unable to force recreate running containers defined in a docker-compose file. **Describe the results you expected:** Able to force recreate running containers (worked with podman 4.0.2) **Additional notes** The network must have been created by podman 4.2.0 to have ```json &quot;Options&quot;: { &quot;isolate&quot;: &quot;true&quot; }, ``` Networks created without this options don't cause this error. **Output of `docker-compose version`:** ``` docker-compose version 1.29.2, build unknown docker-py version: 5.0.3 CPython version: 3.10.6 OpenSSL version: OpenSSL 3.0.5 5 Jul 2022 ``` **Output of `podman version`:** ``` Client: Podman Engine Version: 4.2.0 API Version: 4.2.0 Go Version: go1.18.4 Built: Thu Aug 11 16:42:17 2022 OS/Arch: linux/amd64 ``` **Output of `podman info`:** ``` host: arch: amd64 buildahVersion: 1.27.0 cgroupControllers: - cpu - io - memory - pids cgroupManager: systemd cgroupVersion: v2 conmon: package: conmon-2.1.0-2.fc36.x86_64 path: /usr/bin/conmon version: 'conmon version 2.1.0, commit: ' cpuUtilization: idlePercent: 98.14 systemPercent: 0.42 userPercent: 1.44 cpus: 20 distribution: distribution: fedora variant: workstation version: &quot;36&quot; eventLogger: journald hostname: base idMappings: gidmap: - container_id: 0 host_id: 1000 size: 1 - container_id: 1 host_id: 100000 size: 65536 uidmap: - container_id: 0 host_id: 1000 size: 1 - container_id: 1 host_id: 100000 size: 65536 kernel: 5.19.4-200.fc36.x86_64 linkmode: dynamic logDriver: journald memFree: 6905892864 memTotal: 33489911808 networkBackend: cni ociRuntime: name: crun package: crun-1.5-1.fc36.x86_64 path: /usr/bin/crun version: |- crun version 1.5 commit: 54ebb8ca8bf7e6ddae2eb919f5b82d1d96863dea spec: 1.0.0 +SYSTEMD +SELINUX +APPARMOR +CAP +SECCOMP +EBPF +CRIU +YAJL os: linux remoteSocket: exists: true path: /run/user/1000/podman/podman.sock security: apparmorEnabled: false capabilities: CAP_CHOWN,CAP_DAC_OVERRIDE,CAP_FOWNER,CAP_FSETID,CAP_KILL,CAP_NET_BIND_SERVICE,CAP_SETFCAP,CAP_SETGID,CAP_SETPCAP,CAP_SETUID,CAP_SYS_CHROOT rootless: true seccompEnabled: true seccompProfilePath: /usr/share/containers/seccomp.json selinuxEnabled: true serviceIsRemote: false slirp4netns: executable: /usr/bin/slirp4netns package: slirp4netns-1.2.0-0.2.beta.0.fc36.x86_64 version: |- slirp4netns version 1.2.0-beta.0 commit: 477db14a24ff1a3de3a705e51ca2c4c1fe3dda64 libslirp: 4.6.1 SLIRP_CONFIG_VERSION_MAX: 3 libseccomp: 2.5.3 swapFree: 8589930496 swapTotal: 8589930496 uptime: 3h 36m 51.00s (Approximately 0.12 days) plugins: authorization: null log: - k8s-file - none - passthrough - journald network: - bridge - macvlan - ipvlan volume: - local registries: search: - localhost - registry.fedoraproject.org - registry.access.redhat.com - docker.io - quay.io store: configFile: /home/vinz/.config/containers/storage.conf containerStore: number: 14 paused: 0 running: 12 stopped: 2 graphDriverName: overlay graphOptions: {} graphRoot: /home/vinz/.local/share/containers/storage graphRootAllocated: 998483427328 graphRootUsed: 462067011584 graphStatus: Backing Filesystem: btrfs Native Overlay Diff: &quot;true&quot; Supports d_type: &quot;true&quot; Using metacopy: &quot;false&quot; imageCopyTmpDir: /var/tmp imageStore: number: 1137 runRoot: /run/user/1000/containers volumePath: /home/vinz/.local/share/containers/storage/volumes version: APIVersion: 4.2.0 Built: 1660228937 BuiltTime: Thu Aug 11 16:42:17 2022 GitCommit: &quot;&quot; GoVersion: go1.18.4 Os: linux OsArch: linux/amd64 Version: 4.2.0 ``` **Package info (e.g. output of `rpm -q podman` or `apt list podman`):** ``` podman-4.2.0-2.fc36.x86_64 ``` **Have you tested with the latest version of Podman and have you checked the Podman Troubleshooting Guide? (https://github.com/containers/podman/blob/main/troubleshooting.md)** Yes **Additional environment details (AWS, VirtualBox, physical, etc.):**</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>25</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #15900 from rhatdan/VENDOR Update vendor of containers(image, common, buildah, storage)</MESSAGE>
    <SHA>40e8bcb8482f2a1f60b93524ceda05770d20739e</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>compat API: network inspect do not show isolate option We force the isolate option on new newtworks because that is the docker behavior. However when we inspect them they should not be displayed to the caller since they have no idea about it and docker-compose throws an error because of that. Fixes #15580 Signed-off-by: Paul Holzinger &lt;pholzing@redhat.com&gt;</MESSAGE>
      <SHA>52656887e1cd3476a18765aa81a7804fceb861b4</SHA>
      <PATCHEDFILES>
        <FILE>pkg/api/handlers/compat/networks.go</FILE>
        <FILE>test/compose/uptwice/docker-compose.yml</FILE>
        <FILE>test/compose/uptwice/teardown.sh</FILE>
        <FILE>test/compose/uptwice/tests.sh</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
