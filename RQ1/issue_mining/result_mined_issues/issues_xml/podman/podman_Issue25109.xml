<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>25109</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/25109</ISSUEURL>
  <TITLE>quadlet (podman-systemd.unit) support for --retry and --retry-delay for image pulls</TITLE>
  <DESCRIPTION>### Feature request description [Currently](https://github.com/containers/podman/blob/02dd3e123fdf02b47f02f21af551400656b87185/docs/source/markdown/podman-systemd.unit.5.md) there doesn't seem to be support for image pull retry and retry-delay for systemd.unit files. This is a feature request to add those features. ### Suggest potential solution Support for controlling retries from a systemd unit container file. ### Have you considered any alternatives? No. ### Additional context An example where I have seen an issue is with [this](https://github.com/coreos/coreos-assembler/blob/7dd4b4d388ba533275f9e9815ba0bbcaa4c7d0db/mantle/cmd/kola/resources/iscsi_butane_setup.yaml#L93-L117) unit. The error that I got was: ``` Trying to pull quay.io/coreos-assembler/coreos-assembler:latest... Pulling image //quay.io/coreos-assembler/coreos-assembler:latest inside systemd: setting pull timeout to 5m0s Error: copying system image from manifest list: determining manifest MIME type for docker://quay.io/coreos-assembler/coreos-assembler:latest: reading manifest sha256:9d5c60213547ca29dda408ed4b26313d0d5ff390b9beb0cbdfdc2d6866b33eb9 in quay.io/coreos-assembler/coreos-assembler: received unexpected HTTP status: 502 Bad Gateway ``` I would expect to be able to configure things such that this error was retried. The `setting pull timeout to 5m0s` suggests the code related to this is in https://github.com/containers/common/blob/34a90afcdc6d30277beeda3988c9a816d15160b9/libimage/copier.go#L378</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>61</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #25669 from flouthoc/skip-buildah-test buildah-bud,remote: skip `bud-with-mount-cache-like-buildkit` for `podman-remote`</MESSAGE>
    <SHA>ffcad3c36d1040373d9ef67b615a25127b8d2239</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Add support for Retry= and RetryDelay= to Podman Quadlet. This commit adds new Retry= and RetryDelay= options to quadlet.go which result in --retry and --retry-delay usage in podman run command. This allows configuring the retry logic in .container systemd files. Fixes: #25109 Signed-off-by: Jan Kaluza &lt;jkaluza@redhat.com&gt;</MESSAGE>
      <SHA>6568701caaa496d459708b5238b3d26e4c56cf23</SHA>
      <PATCHEDFILES>
        <FILE>docs/source/markdown/podman-systemd.unit.5.md</FILE>
        <FILE>pkg/systemd/quadlet/quadlet.go</FILE>
        <FILE>test/e2e/quadlet_test.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Add support for Retry= and RetryDelay= to Podman Quadlet. This commit adds new Retry= and RetryDelay= options to quadlet.go which result in --retry and --retry-delay usage in podman run command. This allows configuring the retry logic in .container systemd files. Fixes: #25109 Signed-off-by: Jan Kaluza &lt;jkaluza@redhat.com&gt;</MESSAGE>
      <SHA>7e4316515c6abd4dc2a1b57edb127e243a94eac2</SHA>
      <PATCHEDFILES>
        <FILE>docs/source/markdown/podman-systemd.unit.5.md</FILE>
        <FILE>pkg/systemd/quadlet/quadlet.go</FILE>
        <FILE>test/e2e/quadlet/retry.container</FILE>
        <FILE>test/e2e/quadlet_test.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Add support for Retry= and RetryDelay= to Podman Quadlet. This commit adds new Retry= and RetryDelay= options to quadlet.go which result in --retry and --retry-delay usage in podman run, image and build commands. This allows configuring the retry logic in the systemd files. Fixes: #25109 Signed-off-by: Jan Kaluza &lt;jkaluza@redhat.com&gt;</MESSAGE>
      <SHA>35b11c0c6cefb30b67df5903f2dc059b9c675437</SHA>
      <PATCHEDFILES>
        <FILE>docs/source/markdown/podman-systemd.unit.5.md</FILE>
        <FILE>pkg/systemd/quadlet/quadlet.go</FILE>
        <FILE>test/e2e/quadlet/retry.build</FILE>
        <FILE>test/e2e/quadlet/retry.container</FILE>
        <FILE>test/e2e/quadlet/retry.image</FILE>
        <FILE>test/e2e/quadlet_test.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Add support for Retry= and RetryDelay= to Podman Quadlet. This commit adds new Retry= and RetryDelay= options to quadlet.go which result in --retry and --retry-delay usage in podman run, image and build commands. This allows configuring the retry logic in the systemd files. Fixes: #25109 Signed-off-by: Jan Kaluza &lt;jkaluza@redhat.com&gt;</MESSAGE>
      <SHA>08a1c6d91e96e00eb3b16b52e9f7d93b1ef0f7e9</SHA>
      <PATCHEDFILES>
        <FILE>docs/source/markdown/podman-systemd.unit.5.md</FILE>
        <FILE>pkg/systemd/quadlet/quadlet.go</FILE>
        <FILE>test/e2e/quadlet/retry.build</FILE>
        <FILE>test/e2e/quadlet/retry.container</FILE>
        <FILE>test/e2e/quadlet/retry.image</FILE>
        <FILE>test/e2e/quadlet_test.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
