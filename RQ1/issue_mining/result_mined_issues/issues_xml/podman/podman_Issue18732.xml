<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>18732</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/18732</ISSUEURL>
  <TITLE>[systest] quadlet exit-code propagation test is racy</TITLE>
  <DESCRIPTION>New tests from #18671 seems to race: `podman wait &lt;service-container&gt;` is flaking. Maybe the container is being run with `--rm`? ``` not ok 359 quadlet - exit-code propagation ... $ podman container inspect --format {{.KubeExitCodePropagation}} xxx-service [&quot;all&quot; or &quot;none&quot; are the values I've seen so far, suggesting that it's not a problem with one specific form of the test] $ podman wait xxx-service Error: no container with name or ID &quot;xxx-service&quot; found: no such container ``` Both failures are in rootless, but I suspect that's just coincidence. There's nothing about this that seems rootless-only. * fedora-38 : sys podman fedora-38 rootless host boltdb * [05-27 22:46](https://api.cirrus-ci.com/v1/artifact/task/6185662005641216/html/sys-podman-fedora-38-rootless-host-boltdb.log.html#t--00359) * [05-27 10:52](https://api.cirrus-ci.com/v1/artifact/task/6153056090324992/html/sys-podman-fedora-38-rootless-host-boltdb.log.html#t--00359)</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>1</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #18741 from containers/renovate/github.com-burntsushi-toml-1.x fix(deps): update module github.com/burntsushi/toml to v1.3.0</MESSAGE>
    <SHA>c9c5cb22241824bea6dc8bed0d678a20fab24187</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>systests: fix race in quadlet tests The new exit-code propagation test is racy: 'podman wait' can fail if the service container has already been cleaned up by systemd. Solution: run the inspect and wait tests opportunistically, i.e., only if those commands succeed. If they fail, confirm that they fail with ENOSUCHCONTAINER. This may silently lose us some coverage ... but none of it is important. The important test, systemctl final status, remains. Also, as drive-bys: - add a FIXME comment documenting another race condition that I'm not bothering to fix right now - give distinct names to unit files, for readability in test failures Fixes: #18732 Signed-off-by: Ed Santiago &lt;santiago@redhat.com&gt;</MESSAGE>
      <SHA>72d4cede295404d35169e37e85d7628dbeef19f5</SHA>
      <PATCHEDFILES>
        <FILE>test/system/252-quadlet.bats</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
