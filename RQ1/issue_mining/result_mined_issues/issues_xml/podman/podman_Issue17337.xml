<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>17337</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/17337</ISSUEURL>
  <TITLE>[Feature]: Ignore userns=keep-id in rootful mode, instead of erroring out</TITLE>
  <DESCRIPTION>### Feature request description Currently, specifying `--userns=keep-id` in `podman run` results in a hard error: ``` $ sudo podman run --userns=keep-id alpine echo hi Error: keep-id is only supported in rootless mode ``` Setting the `PODMAN_USERNS=keep-id` environment variable has the same effect. I'm in the process of setting up a reusable VS Code Dev container, where I can specify docker/podman run arguments needed for the container. userns=keep-id is required to get the container working for rootless users (to give them access to the files they are working on, which reside on the host with their local UID/GID). At the same time, I don't control how users have set up their podman; they might be using it in rootful or rootless mode. (Many are tricked into the rootful mode by the [Windows installation instructions](https://github.com/containers/podman/blob/main/docs/tutorials/podman-for-windows.md), which effectively state: use rootful if you run into some issues. And since there seems to be no down-side, they just go with the &quot;safe route&quot;.) That's where I'm stuck: I want to get a command-line that works for both rootful and rootless invocations, but with &quot;--userns=keep-id&quot; erroring out, I can't find the magic invocation that works in any case. ### Suggest potential solution If &quot;--userns=keep-id&quot; or `PODMAN_USERNS` is specified in rootful mode, ignore it (and warn about it), but do not error out. ### Have you considered any alternatives? The alternatives require assembling a command-line or an environment variable conditionally depending on podman being rootful or rootless mode, which typically requires a wrapper script. Or (and that's what we do today) we have to document that the user needs to add a flag or a configuration file depending on how they're using podman. ### Additional context Add any other context or screenshots about the feature request here.</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #17274 from giuseppe/idmap-rootfs libpod: support idmap for --rootfs</MESSAGE>
    <SHA>78458e0f89387d9541e4fe925192b7b966c6f37f</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>libpod: allow userns=keep-id for root copy the current mapping into a new user namespace, and run into a separate user namespace. Closes: https://github.com/containers/podman/issues/17337 Signed-off-by: Giuseppe Scrivano &lt;gscrivan@redhat.com&gt;</MESSAGE>
      <SHA>de63ad70442585790d34693169558fc6e897b3fd</SHA>
      <PATCHEDFILES>
        <FILE>docs/source/markdown/options/userns.container.md</FILE>
        <FILE>pkg/specgen/generate/namespaces.go</FILE>
        <FILE>pkg/util/utils.go</FILE>
        <FILE>test/e2e/run_userns_test.go</FILE>
        <FILE>test/system/170-run-userns.bats</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
