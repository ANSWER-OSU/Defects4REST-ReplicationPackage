<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>20943</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/20943</ISSUEURL>
  <TITLE>podman compose ignore -c (or --connection) parameter</TITLE>
  <DESCRIPTION>### Issue Description I have 2 machine called podman-machine-default and test. Only the one is started. If I `run podman -c test compose up` -d I got: Error: machine podman-machine-default is not running but in state stopped ### Steps to reproduce the issue Steps to reproduce the issue 1. Stop default machine 2. Start machine test 3. run podman -c test compose up -d ### Describe the results you received Error: machine podman-machine-default is not running but in state stopped ### Describe the results you expected compose project should start ### podman info output ```yaml host: arch: amd64 buildahVersion: 1.32.0 cgroupControllers: [] cgroupManager: cgroupfs cgroupVersion: v1 conmon: package: conmon-2.1.7-2.fc38.x86_64 path: /usr/bin/conmon version: 'conmon version 2.1.7, commit: ' cpuUtilization: idlePercent: 99.79 systemPercent: 0.11 userPercent: 0.11 cpus: 12 databaseBackend: boltdb distribution: distribution: fedora variant: container version: &quot;38&quot; eventLogger: journald freeLocks: 2048 hostname: DESKTOP-JEFF idMappings: gidmap: - container_id: 0 host_id: 1000 size: 1 - container_id: 1 host_id: 524288 size: 65536 uidmap: - container_id: 0 host_id: 1000 size: 1 - container_id: 1 host_id: 524288 size: 65536 kernel: 5.15.133.1-microsoft-standard-WSL2 linkmode: dynamic logDriver: journald memFree: 15970234368 memTotal: 16646295552 networkBackend: netavark networkBackendInfo: backend: netavark dns: package: aardvark-dns-1.8.0-1.fc38.x86_64 path: /usr/libexec/podman/aardvark-dns version: aardvark-dns 1.8.0 package: netavark-1.8.0-2.fc38.x86_64 path: /usr/libexec/podman/netavark version: netavark 1.8.0 ociRuntime: name: crun package: crun-1.11.2-1.fc38.x86_64 path: /usr/bin/crun version: |- crun version 1.11.2 commit: ab0edeef1c331840b025e8f1d38090cfb8a0509d rundir: /run/user/1000/crun spec: 1.0.0 +SYSTEMD +SELINUX +APPARMOR +CAP +SECCOMP +EBPF +CRIU +LIBKRUN +WASM:wasmedge +YAJL os: linux pasta: executable: /usr/bin/pasta package: passt-0^20231107.g56d9f6d-1.fc38.x86_64 version: | pasta 0^20231107.g56d9f6d-1.fc38.x86_64 Copyright Red Hat GNU General Public License, version 2 or later &lt;https://www.gnu.org/licenses/old-licenses/gpl-2.0.html&gt; This is free software: you are free to change and redistribute it. There is NO WARRANTY, to the extent permitted by law. remoteSocket: exists: true path: /run/user/1000/podman/podman.sock security: apparmorEnabled: false capabilities: CAP_CHOWN,CAP_DAC_OVERRIDE,CAP_FOWNER,CAP_FSETID,CAP_KILL,CAP_NET_BIND_SERVICE,CAP_SETFCAP,CAP_SETGID,CAP_SETPCAP,CAP_SETUID,CAP_SYS_CHROOT rootless: true seccompEnabled: true seccompProfilePath: /usr/share/containers/seccomp.json selinuxEnabled: false serviceIsRemote: true slirp4netns: executable: /usr/bin/slirp4netns package: slirp4netns-1.2.2-1.fc38.x86_64 version: |- slirp4netns version 1.2.2 commit: 0ee2d87523e906518d34a6b423271e4826f71faf libslirp: 4.7.0 SLIRP_CONFIG_VERSION_MAX: 4 libseccomp: 2.5.3 swapFree: 4294967296 swapTotal: 4294967296 uptime: 0h 10m 19.00s variant: &quot;&quot; plugins: authorization: null log: - k8s-file - none - passthrough - journald network: - bridge - macvlan - ipvlan volume: - local registries: search: - docker.io store: configFile: /home/user/.config/containers/storage.conf containerStore: number: 0 paused: 0 running: 0 stopped: 0 graphDriverName: overlay graphOptions: {} graphRoot: /home/user/.local/share/containers/storage graphRootAllocated: 1081101176832 graphRootUsed: 619859968 graphStatus: Backing Filesystem: extfs Native Overlay Diff: &quot;true&quot; Supports d_type: &quot;true&quot; Supports shifting: &quot;false&quot; Supports volatile: &quot;true&quot; Using metacopy: &quot;false&quot; imageCopyTmpDir: /var/tmp imageStore: number: 0 runRoot: /run/user/1000/containers transientStore: false volumePath: /home/user/.local/share/containers/storage/volumes version: APIVersion: 4.7.2 Built: 1698762611 BuiltTime: Tue Oct 31 15:30:11 2023 GitCommit: &quot;&quot; GoVersion: go1.20.10 Os: linux OsArch: linux/amd64 Version: 4.7.2 ``` ### Podman in a container No ### Privileged Or Rootless None ### Upstream Latest Release Yes ### Additional environment details Additional environment details ### Additional information Additional information like issue happens only occasionally or issue happens with a particular architecture or on a particular setting</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>81</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>podman compose: build for all arches Machine only works on amd64 and arm64 but the compose command can still be used without machine so split out the machine only logic to make it build for all arches. [NO NEW TESTS NEEDED] Fixes #21757 Signed-off-by: Paul Holzinger &lt;pholzing@redhat.com&gt;</MESSAGE>
    <SHA>6d3571dcf5009bdd036978054760a59aa8990862</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>podman compose: correctly accept --connection/--url Make the logic here much simpler, we already pass all the conection info before so just use the parsed URL here. Fixes #20943 Signed-off-by: Paul Holzinger &lt;pholzing@redhat.com&gt;</MESSAGE>
      <SHA>3cada04099ee4c02bf31d86861d4b257eb54bed6</SHA>
      <PATCHEDFILES>
        <FILE>cmd/podman/compose.go</FILE>
        <FILE>cmd/podman/compose_machine.go</FILE>
        <FILE>cmd/podman/compose_machine_unsupported.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
