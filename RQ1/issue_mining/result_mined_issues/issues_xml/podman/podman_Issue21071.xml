<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>21071</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/21071</ISSUEURL>
  <TITLE>Handling the extra space in /etc/subuid/gid more efficiently</TITLE>
  <DESCRIPTION>### Issue Description Came across a problem where we were not able to identify an extra space that was added to /etc/subuid or /etc/subgid for the user podman. [podman@atomic-test ~]$ cat /etc/subuid cloud-user:100000:65536 podman:165536:65536 [podman@atomic-test ~] Though entry appeared to be sane, every command execution was failing as if there was no entry [podman@atomic-test ~]$ podman run -dt registry.access.redhat.com/ubi8 Trying to pull registry.access.redhat.com/ubi8:latest... Getting image source signatures Checking if image destination supports signatures Copying blob b4e744f5f131 done Error: copying system image from manifest list: writing blob: adding layer with blob &quot;sha256:b4e744f5f131fb2db0dd7649806f286ecaa3fcda18dc9a4245d83e902100ccb3&quot;: processing tar file(potentially insufficient UIDs or GIDs available in user namespace (requested 0:5 for /usr/bin/write): Check /etc/subuid and /etc/subgid if configured locally and run &quot;podman system migrate&quot;: lchown /usr/bin/write: invalid argument): exit status 1 The space is visible with tr [podman@atomic-test ~]$ cat /etc/subuid | tr &quot; &quot; &quot;*&quot; | tr &quot;\t&quot; &quot;&amp;&quot; cloud-user:100000:65536 podman:165536:65536* ### Steps to reproduce the issue Steps to reproduce the issue 1. For a non root user, add an extra space in /etc/subuid and /etc/subgid 2. run any podman commands as the non root user 3. ### Describe the results you received podman run fails as if there is no entry in /etc/subuid example &quot;processing tar file(potentially insufficient UIDs or GIDs available in user namespace (requested 0:5 for /usr/bin/write):&quot; ### Describe the results you expected Handle the extra space after user entry in /etc/subuid/gid more efficiently ### podman info output ```yaml host: arch: amd64 buildahVersion: 1.31.3 cgroupControllers: - memory - pids cgroupManager: systemd cgroupVersion: v2 conmon: package: conmon-2.1.8-1.el9.x86_64 path: /usr/bin/conmon version: 'conmon version 2.1.8, commit: aadb7c890ac6283eb4666d92690238e5fbdec5c7' cpuUtilization: idlePercent: 99.96 systemPercent: 0.01 userPercent: 0.02 cpus: 4 databaseBackend: boltdb distribution: distribution: '&quot;rhel&quot;' version: &quot;9.3&quot; eventLogger: journald freeLocks: 2048 hostname: atomic-test idMappings: gidmap: - container_id: 0 host_id: 1001 size: 1 uidmap: - container_id: 0 host_id: 1001 size: 1 kernel: 5.14.0-284.30.1.el9_2.x86_64 linkmode: dynamic logDriver: journald memFree: 11033755648 memTotal: 12263870464 networkBackend: netavark networkBackendInfo: backend: netavark dns: package: aardvark-dns-1.7.0-1.el9.x86_64 path: /usr/libexec/podman/aardvark-dns version: aardvark-dns 1.7.0 package: netavark-1.7.0-1.el9.x86_64 path: /usr/libexec/podman/netavark version: netavark 1.7.0 ociRuntime: name: crun package: crun-1.8.7-1.el9.x86_64 path: /usr/bin/crun version: |- crun version 1.8.7 commit: 53a9996ce82d1ee818349bdcc64797a1fa0433c4 rundir: /run/user/1001/crun spec: 1.0.0 +SYSTEMD +SELINUX +APPARMOR +CAP +SECCOMP +EBPF +CRIU +YAJL os: linux pasta: executable: /usr/bin/pasta package: passt-0^20230818.g0af928e-4.el9.x86_64 version: | pasta 0^20230818.g0af928e-4.el9.x86_64 Copyright Red Hat GNU Affero GPL version 3 or later &lt;https://www.gnu.org/licenses/agpl-3.0.html&gt; This is free software: you are free to change and redistribute it. There is NO WARRANTY, to the extent permitted by law. remoteSocket: path: /run/user/1001/podman/podman.sock security: apparmorEnabled: false capabilities: CAP_NET_RAW,CAP_CHOWN,CAP_DAC_OVERRIDE,CAP_FOWNER,CAP_FSETID,CAP_KILL,CAP_NET_BIND_SERVICE,CAP_SETFCAP,CAP_SETGID,CAP_SETPCAP,CAP_SETUID,CAP_SYS_CHROOT rootless: true seccompEnabled: true seccompProfilePath: /usr/share/containers/seccomp.json selinuxEnabled: true serviceIsRemote: false slirp4netns: executable: /usr/bin/slirp4netns package: slirp4netns-1.2.1-1.el9.x86_64 version: |- slirp4netns version 1.2.1 commit: 09e31e92fa3d2a1d3ca261adaeb012c8d75a8194 libslirp: 4.4.0 SLIRP_CONFIG_VERSION_MAX: 3 libseccomp: 2.5.2 swapFree: 0 swapTotal: 0 uptime: 25h 8m 1.00s (Approximately 1.04 days) plugins: authorization: null log: - k8s-file - none - passthrough - journald network: - bridge - macvlan - ipvlan volume: - local registries: search: - registry.access.redhat.com - registry.redhat.io - docker.io store: configFile: /home/rrajaram/.config/containers/storage.conf containerStore: number: 0 paused: 0 running: 0 stopped: 0 graphDriverName: overlay graphOptions: {} graphRoot: /home/rrajaram/.local/share/containers/storage graphRootAllocated: 20728229888 graphRootUsed: 13536980992 graphStatus: Backing Filesystem: xfs Native Overlay Diff: &quot;true&quot; Supports d_type: &quot;true&quot; Using metacopy: &quot;false&quot; imageCopyTmpDir: /var/tmp imageStore: number: 0 runRoot: /run/user/1001/containers transientStore: false volumePath: /home/rrajaram/.local/share/containers/storage/volumes version: APIVersion: 4.6.1 Built: 1701529524 BuiltTime: Sat Dec 2 10:05:24 2023 GitCommit: &quot;&quot; GoVersion: go1.20.10 Os: linux OsArch: linux/amd64 Version: 4.6.1 ``` ### Podman in a container No ### Privileged Or Rootless Rootless ### Upstream Latest Release No ### Additional environment details podman-4.6.1-7.el9_3.x86_64 on RHEL 9.3 ### Additional information Additional information like issue happens only occasionally or issue happens with a particular architecture or on a particular setting</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>33</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #21316 from containers/renovate/dawidd6-action-send-mail-3.x [skip-ci] Update dawidd6/action-send-mail action to v3.10.0</MESSAGE>
    <SHA>d084146864ece25796250e826cfd873b8166fda0</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Warn about whitespace in /etc/subuid and /etc/subgid files Fixes: https://github.com/containers/podman/issues/21071 Signed-off-by: Daniel J Walsh &lt;dwalsh@redhat.com&gt;</MESSAGE>
      <SHA>d792cc448e48cba2829db378d65a0e6f4ae84f15</SHA>
      <PATCHEDFILES>
        <FILE>docs/source/markdown/podman.1.md</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
