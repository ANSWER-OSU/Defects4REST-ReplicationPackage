<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>17927</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/17927</ISSUEURL>
  <TITLE>Can't access published (host) ports - Netavark</TITLE>
  <DESCRIPTION>### Issue Description Apologize if I've gone down a path the wrong way. Very briefly: trying to migrate network services in singleton containers, need them to be accessible at fixed IP and usually via https, and also on a dedicated Ethernet interface. Have assumed the way to do this: podman, Netavark, create a separate network with the macvlan driver. However, attempting to run containers, published ports (e.g., `--publish=443:5601`) are ignored. 5601 is accessible and operates normally. Very difficult to work around (one of the containers is for syslog, so 514 needs to work). ### Steps to reproduce the issue Steps to reproduce the issue 1. Verify `network_backend = &quot;netavark&quot;` set in `/etc/containers/containers.conf`. 2. Create a network, bound to eno2 on the host: `podman network create --driver=macvlan -o parent=eno2 --ipv6 containernet0` (also with IPv4 and IPv6 `--subnet`, `--ip-range`, and `--gateway`). 3. Run dwalsh's example Apache container: `podman run --user=root -d -p 80:8080 --name testapa --network=containernet0 --ip=192.168.0.99 registry.access.redhat.com/ubi8/httpd-24:latest` - run by root user. 4. Check connectivity: from another (or the same) host, `curl http://192.168.0.99` ### Describe the results you received Describe the results you received `curl: (7) Failed to connect to 192.168.0.99 port 80: Connection refused` Tested with `podman run`, with `--user=root`, and `--privileged` and with neither. ### Describe the results you expected Describe the results you expected The RHEL test page. Note that this _is_ the result from `curl http://192.168.0.99:8080` ### podman info output ```yaml (This is RHEL 9.1, podman-4.2.0-11.el9_1.x86_64) host: arch: amd64 buildahVersion: 1.27.3 cgroupControllers: - cpuset - cpu - io - memory - hugetlb - pids - rdma - misc cgroupManager: systemd cgroupVersion: v2 conmon: package: conmon-2.1.4-1.el9.x86_64 path: /usr/bin/conmon version: 'conmon version 2.1.4, commit: 56561007b6a59ea175ee9a67384639721499e160' cpuUtilization: idlePercent: 89.71 systemPercent: 2.12 userPercent: 8.17 cpus: 4 distribution: distribution: '&quot;rhel&quot;' version: &quot;9.1&quot; eventLogger: journald hostname: five.kmpeterson.net idMappings: gidmap: null uidmap: null kernel: 5.14.0-162.18.1.el9_1.x86_64 linkmode: dynamic logDriver: journald memFree: 14828531712 memTotal: 33225539584 networkBackend: netavark ociRuntime: name: crun package: crun-1.5-1.el9.x86_64 path: /usr/bin/crun version: |- crun version 1.5 commit: 54ebb8ca8bf7e6ddae2eb919f5b82d1d96863dea spec: 1.0.0 +SYSTEMD +SELINUX +APPARMOR +CAP +SECCOMP +EBPF +CRIU +YAJL os: linux remoteSocket: exists: true path: /run/podman/podman.sock security: apparmorEnabled: false capabilities: CAP_NET_RAW,CAP_CHOWN,CAP_DAC_OVERRIDE,CAP_FOWNER,CAP_FSETID,CAP_KILL,CAP_NET_BIND_SERVICE,CAP_SETFCAP,CAP_SETGID,CAP_SETPCAP,CAP_SETUID,CAP_SYS_CHROOT rootless: false seccompEnabled: true seccompProfilePath: /usr/share/containers/seccomp.json selinuxEnabled: true serviceIsRemote: false slirp4netns: executable: /usr/bin/slirp4netns package: slirp4netns-1.2.0-2.el9_0.x86_64 version: |- slirp4netns version 1.2.0 commit: 656041d45cfca7a4176f6b7eed9e4fe6c11e8383 libslirp: 4.4.0 SLIRP_CONFIG_VERSION_MAX: 3 libseccomp: 2.5.2 swapFree: 16814960640 swapTotal: 16814960640 uptime: 3h 6m 55.00s (Approximately 0.12 days) plugins: authorization: null log: - k8s-file - none - passthrough - journald network: - bridge - macvlan volume: - local registries: search: - registry.access.redhat.com - registry.redhat.io - docker.io store: configFile: /etc/containers/storage.conf containerStore: number: 10 paused: 0 running: 9 stopped: 1 graphDriverName: overlay graphOptions: overlay.mountopt: nodev,metacopy=on graphRoot: /var/lib/containers/storage graphRootAllocated: 34342961152 graphRootUsed: 10065133568 graphStatus: Backing Filesystem: xfs Native Overlay Diff: &quot;false&quot; Supports d_type: &quot;true&quot; Using metacopy: &quot;true&quot; imageCopyTmpDir: /var/tmp imageStore: number: 48 runRoot: /run/containers/storage volumePath: /var/lib/containers/storage/volumes version: APIVersion: 4.2.0 Built: 1675767401 BuiltTime: Tue Feb 7 05:56:41 2023 GitCommit: &quot;&quot; GoVersion: go1.18.9 Os: linux OsArch: linux/amd64 Version: 4.2.0 ``` ### Podman in a container No ### Privileged Or Rootless Privileged ### Upstream Latest Release No ### Additional environment details Additional environment details ### Additional information - Attempting to specify the IP as part of the `--publish` parameter for the port generates `Error: cannot listen on the TCP port: listen tcp4 192.168.0.99:80: bind: cannot assign requested address`. - Same results using IPv6 addresses. - I have the impression that podman would have to be run as root in order to bind to an external IP, so I have not attempted to do any of this work as a non-privileged user. So, - I have been trying to figure out whether it would be possible to redirect the port with nftables. However, interestingly, _nothing_ is configured as far as I can tell in this environment by podman with firewalld or iptables or nftables - which I suppose might be expected, but makes it difficult to see what rules might be created and start from there. - I'd work around this issue that way if I could.</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>207</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #20403 from containers/renovate/k8s.io-kubernetes-1.x fix(deps): update module k8s.io/kubernetes to v1.28.3</MESSAGE>
    <SHA>30b14b33ae4ffad67b40a408d52e888b40ef78df</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>network: document ports and macvlan interaction The network backend will ignore ports for macvlan and ipvlan networks so they do not do anything. No warning or error is shown because containers may be later connected to a bridge network in which case they would be useful. Fixes #17927 Signed-off-by: Paul Holzinger &lt;pholzing@redhat.com&gt;</MESSAGE>
      <SHA>ca9efb0cda26478d51eeb71dd27d0c9a40c5b7b1</SHA>
      <PATCHEDFILES>
        <FILE>docs/source/markdown/options/publish.md</FILE>
        <FILE>docs/source/markdown/podman-network-create.1.md</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
