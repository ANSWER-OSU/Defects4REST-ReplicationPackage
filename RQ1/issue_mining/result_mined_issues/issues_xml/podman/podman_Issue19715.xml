<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>19715</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/19715</ISSUEURL>
  <TITLE>kube play with sdnotify=conmon: Error: Closing notify proxy: close unixgram: use of closed network connection</TITLE>
  <DESCRIPTION>```console $ cat &gt;/tmp/foo.yaml &lt;&lt;EOF apiVersion: v1 kind: Pod metadata: labels: app: test name: test_pod annotations: io.containers.sdnotify: conmon spec: restartPolicy: Never containers: - name: ctr1 image: quay.io/libpod/testimage:20221018 command: - true EOF $ bin/podman kube play /tmp/foo.yaml ERRO[0001] Closing notify proxy &quot;/dev/shm/-podman-notify-proxy.sock146894828&quot;: close unixgram /dev/shm/-podman-notify-proxy.sock146894828: use of closed network connection Pod: 2c0e114741a88f943b8483f56e57d604620cd12c03334080e3a9ea92555a1246 Container: ade31f15fdc15685d03586067948d1d2d5a5c1e11c90938e5484f6050b9680d2 ``` 100% reproducible on my f38 laptop, not a flake. This is the source of the .sock file: https://github.com/containers/podman/blob/7bd60867debb18bb71d6a1c02f6d7c7ad66ec664/pkg/systemd/notifyproxy/notifyproxy.go#L66-L69</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>1</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #19730 from edsantiago/you_say_hello_and_i_say_goodbye Revert &quot;Remove `hello` multi-arch image build&quot;</MESSAGE>
    <SHA>4d5bef98f5c442c5ac4e50adb75b5982ca0bd13b</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>kube: notifyproxy: close once Do not close a notifyproxy more than once. Also polish the backend a bit to reflect ealier changes from commit 4fa307f. Fixes: #19715 Signed-off-by: Valentin Rothberg &lt;vrothberg@redhat.com&gt;</MESSAGE>
      <SHA>a5f6a4a3bfee3d6d421c044747e6fda9cba45990</SHA>
      <PATCHEDFILES>
        <FILE>pkg/domain/infra/abi/play.go</FILE>
        <FILE>pkg/systemd/notifyproxy/notifyproxy.go</FILE>
        <FILE>test/system/260-sdnotify.bats</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
