<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>16360</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/16360</ISSUEURL>
  <TITLE>Podman socket: Build API produces different results then Docker's Build API</TITLE>
  <DESCRIPTION>&lt;!-- --------------------------------------------------- BUG REPORT INFORMATION --------------------------------------------------- Use the commands below to provide key information from your environment: You do NOT have to include this information if this is a FEATURE REQUEST **NOTE** A large number of issues reported against Podman are often found to already be fixed in more current versions of the project. Before reporting an issue, please verify the version you are running with `podman version` and compare it to the latest release documented on the top of Podman's [README.md](../README.md). If they differ, please update your version of Podman to the latest possible and retry your command before creating an issue. Also, there is a running list of known issues in the [Podman Troubleshooting Guide](https://github.com/containers/podman/blob/main/troubleshooting.md), please reference that page before opening a new issue. If you are filing a bug against `podman build`, please instead file a bug against Buildah (https://github.com/containers/buildah/issues). Podman build executes Buildah to perform container builds, and as such the Buildah maintainers are best equipped to handle these bugs. --&gt; **Is this a BUG REPORT or FEATURE REQUEST? (leave only one on its own line)** /kind bug **Description** &lt;!-- Briefly describe the problem you are having in a few paragraphs. --&gt; As i am migrating from OL7 -&gt; OL8 (RHEL based), i am wanting to keep my current code working - for that i am relying on podman socket to keep my docker-compose / docker py usage functional. Docker-compose seems fine but docker-py is not, there is an issue where the return values from the build API is different: https://github.com/containers/podman/blob/40e8bcb8482f2a1f60b93524ceda05770d20739e/pkg/api/handlers/compat/images_build.go#L803 The final response includes 2 lines rather than a single line, as this `aux` object is added. This isn't really an issue and i can workaround it, but was wondering if it would be changed to be in line with docker API. **Steps to reproduce the issue:** 1. Use docker py to build an image with docker and podman socket 2. See that the final response from the api is different **Describe the results you received:** {&quot;aux&quot;:{&quot;ID&quot;:&quot;sha256:2d49cc4bc02bb457a9459736c461c52944e68e2a40cf2bb1207494b2b72c5f82&quot;}}\n{&quot;stream&quot;:&quot;Successfully built 2d49cc4bc02b\\n&quot;}\n **Describe the results you expected:** {&quot;stream&quot;:&quot;Successfully built 2d49cc4bc02b\\n&quot;}\n **Additional information you deem important (e.g. issue happens only occasionally):** **Output of `podman version`:** ``` Client: Podman Engine Version: 4.1.1 API Version: 4.1.1 Go Version: go1.17.12 Built: Wed Oct 26 15:12:06 2022 OS/Arch: linux/amd64 ``` **Output of `podman info`:** ``` host: arch: amd64 buildahVersion: 1.26.2 cgroupControllers: [] cgroupManager: cgroupfs cgroupVersion: v1 conmon: package: conmon-2.1.3-1.module+el8.6.0+20857+bf01bdf2.x86_64 path: /usr/bin/conmon version: 'conmon version 2.1.3, commit: 0e2e290c54cc97af44a8b96f004ff81e8abd8956' cpuUtilization: idlePercent: 98.48 systemPercent: 0.21 userPercent: 1.31 cpus: 104 distribution: distribution: '&quot;ol&quot;' variant: server version: &quot;8.6&quot; eventLogger: file hostname: cicd-bm-standard-ol8 idMappings: gidmap: - container_id: 0 host_id: 1001 size: 1 - container_id: 1 host_id: 165536 size: 65536 uidmap: - container_id: 0 host_id: 1001 size: 1 - container_id: 1 host_id: 165536 size: 65536 kernel: 5.4.17-2136.310.7.1.el8uek.x86_64 linkmode: dynamic logDriver: k8s-file memFree: 630402412544 memTotal: 809608286208 networkBackend: cni ociRuntime: name: runc package: runc-1.1.3-2.module+el8.6.0+20857+bf01bdf2.x86_64 path: /usr/bin/runc version: |- runc version 1.1.3 spec: 1.0.2-dev go: go1.17.12 libseccomp: 2.5.2 os: linux remoteSocket: path: /run/user/1001/podman/podman.sock security: apparmorEnabled: false capabilities: CAP_NET_RAW,CAP_CHOWN,CAP_DAC_OVERRIDE,CAP_FOWNER,CAP_FSETID,CAP_KILL,CAP_NET_BIND_SERVICE,CAP_SETFCAP,CAP_SETGID,CAP_SETPCAP,CAP_SETUID,CAP_SYS_CHROOT rootless: true seccompEnabled: true seccompProfilePath: /usr/share/containers/seccomp.json selinuxEnabled: false serviceIsRemote: false slirp4netns: executable: /bin/slirp4netns package: slirp4netns-1.2.0-2.module+el8.6.0+20857+bf01bdf2.x86_64 version: |- slirp4netns version 1.2.0 commit: 656041d45cfca7a4176f6b7eed9e4fe6c11e8383 libslirp: 4.4.0 SLIRP_CONFIG_VERSION_MAX: 3 libseccomp: 2.5.2 swapFree: 8539598848 swapTotal: 8539598848 uptime: 4h 35m 58.6s (Approximately 0.17 days) plugins: log: - k8s-file - none - passthrough - journald network: - bridge - macvlan - ipvlan volume: - local registries: search: - container-registry.oracle.com - docker.io store: configFile: /home/oracle/.config/containers/storage.conf containerStore: number: 0 paused: 0 running: 0 stopped: 0 graphDriverName: overlay graphOptions: {} graphRoot: /home/oracle/.local/share/containers/storage graphRootAllocated: 2187084447744 graphRootUsed: 178915131392 graphStatus: Backing Filesystem: xfs Native Overlay Diff: &quot;false&quot; Supports d_type: &quot;true&quot; Using metacopy: &quot;false&quot; imageCopyTmpDir: /var/tmp imageStore: number: 0 runRoot: /run/user/1001/containers volumePath: /home/oracle/.local/share/containers/storage/volumes version: APIVersion: 4.1.1 Built: 1666797126 BuiltTime: Wed Oct 26 15:12:06 2022 GitCommit: &quot;&quot; GoVersion: go1.17.12 Os: linux OsArch: linux/amd64 Version: 4.1.1 ``` **Package info (e.g. output of `rpm -q podman` or `apt list podman` or `brew info podman`):** ``` podman-4.1.1-7.module+el8.6.0+20857+bf01bdf2.x86_64 ``` Have tested with OL9 which is 4.2.x podman **Additional environment details (AWS, VirtualBox, physical, etc.):** Cloud based vm</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>6</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #16372 from dfr/version-4.4 version bump to 4.4.0-dev</MESSAGE>
    <SHA>d319860bcf13fcdc15715593bcd3c13c6b31dae9</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Docker compat build api - make sure only one line appears per flush Closes #16360 Signed-off-by: Jake Torrance &lt;jake.torrance@oracle.com&gt; Signed-off-by: Jake Torrance &lt;jaket1234@hotmail.com&gt;</MESSAGE>
      <SHA>cdb00332dac3ce9b2ebc76e65afe0347a941cc15</SHA>
      <PATCHEDFILES>
        <FILE>pkg/api/handlers/compat/images_build.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
