<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>17778</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/17778</ISSUEURL>
  <TITLE>Build image `pull` field type mismatch with Docker</TITLE>
  <DESCRIPTION>### Issue Description Docker accepts any string value for the `pull` field to indicate the image should be pulled:https://docs.docker.com/engine/api/v1.42/#tag/Image/operation/ImageBuild Podman expects the value to equal either boolean `true` or string `true`: https://docs.podman.io/en/latest/_static/api.html?version=v4.4#tag/images/operation/ImageBuildLibpod Applications that align with Docker's spec are unable to switch to Podman as building an image with this field fails. ### Steps to reproduce the issue 1. POST to the create image endpoint with `pull` set to a string, such as `always`. ### Describe the results you received No response stream received ### Describe the results you expected Expected a response stream ### podman info output ```yaml host: arch: amd64 buildahVersion: 1.29.0 cgroupControllers: - memory - pids cgroupManager: systemd cgroupVersion: v2 conmon: package: conmon_2:2.1.7-0debian9999+obs15.6_amd64 path: /usr/bin/conmon version: 'conmon version 2.1.7, commit: ' cpuUtilization: idlePercent: 87.46 systemPercent: 5.69 userPercent: 6.84 cpus: 2 distribution: codename: jammy distribution: ubuntu version: &quot;22.04&quot; eventLogger: journald hostname: fv-az646-90 idMappings: gidmap: - container_id: 0 host_id: 123 size: 1 - container_id: 1 host_id: 165536 size: 65536 uidmap: - container_id: 0 host_id: 1001 size: 1 - container_id: 1 host_id: 165536 size: 65536 kernel: 5.15.0-1034-azure linkmode: dynamic logDriver: journald memFree: 4857856000 memTotal: 7281278976 networkBackend: netavark ociRuntime: number: 0 paused: 0 running: 0 stopped: 0 graphDriverName: overlay graphOptions: {} graphRoot: /home/runner/.local/share/containers/storage graphRootAllocated: 89297309696 graphRootUsed: 58336636928 graphStatus: Backing Filesystem: extfs Native Overlay Diff: &quot;true&quot; Supports d_type: &quot;true&quot; Using metacopy: &quot;false&quot; imageCopyTmpDir: /var/tmp imageStore: number: 0 runRoot: /run/user/1001/containers transientStore: false volumePath: /home/runner/.local/share/containers/storage/volumes version: APIVersion: 4.4.2 Built: 0 BuiltTime: Thu Jan 1 00:00:00 1970 GitCommit: &quot;&quot; GoVersion: go1.19.6 Os: linux OsArch: linux/amd64 Version: 4.4.2 ``` ### Podman in a container Yes ### Privileged Or Rootless Rootless ### Upstream Latest Release Yes ### Additional environment details `DOCKER_HOST=unix:///run/user/$(id -u)/podman/podman.sock` ### Additional information _No response_</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>63</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #18571 from containers/renovate/github.com-onsi-ginkgo-v2-2.x fix(deps): update module github.com/onsi/ginkgo/v2 to v2.9.5</MESSAGE>
    <SHA>e2d1ad1fb2f59d7fe9685485bb69f6ff7987d74f</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>compat,build: pull must accept string `pull` parameter in `build` must accept string just like docker. Ref: https://docs.docker.com/engine/api/v1.42/#tag/Image/operation/ImageBuild Closes: https://github.com/containers/podman/issues/17778 Signed-off-by: Aditya R &lt;arajan@redhat.com&gt;</MESSAGE>
      <SHA>5b148a0a68360892f57603b77e73c69e32fb7b7e</SHA>
      <PATCHEDFILES>
        <FILE>pkg/api/handlers/compat/images_build.go</FILE>
        <FILE>pkg/api/server/register_images.go</FILE>
        <FILE>test/apiv2/10-images.at</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Revert &quot;compat,build: pull must accept string&quot; This reverts commit 5b148a0a68360892f57603b77e73c69e32fb7b7e. Reverting to treating the `pull` query parameter as a boolean. Because of deceiving Docker API documentation it was assumed that the parameter is pull-policy, however that is not true. Docker does treat `pull` as a boolean. What is interesting is that Docker indeed accepts strings like `always` or `never` however Docekr both of these strings treat as `true`, not as pull-policy. As matter of the fact it seems there is no such a thing as pull-policy in Docker. More context https://github.com/containers/podman/issues/17778#issuecomment-1673931925 Signed-off-by: Matej Vasek &lt;mvasek@redhat.com&gt;</MESSAGE>
      <SHA>4cb2d48ca42ee697c6dda3b00752059cc655e0a8</SHA>
      <PATCHEDFILES>
        <FILE>pkg/api/handlers/compat/images_build.go</FILE>
        <FILE>pkg/api/server/register_images.go</FILE>
        <FILE>test/apiv2/10-images.at</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
