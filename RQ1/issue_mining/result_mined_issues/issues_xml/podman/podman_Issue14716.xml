<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>14716</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/14716</ISSUEURL>
  <TITLE>flake: podman run --network bridge (range): bind: address already in use</TITLE>
  <DESCRIPTION>``` [+1375s] not ok 339 podman run port forward range # $ podman run --network bridge -p 5353-5355:5353-5355 -d quay.io/libpod/testimage:20210610 sleep inf # Error: rootlessport listen tcp 0.0.0.0:5355: bind: address already in use # [ rc=126 (** EXPECTED 0 **) ] ``` First instance is on 04-28. ### [sys] 339 podman run port forward range * fedora-35 : sys podman fedora-35 rootless host * PR #14584 * [06-14 10:51](https://storage.googleapis.com/cirrus-ci-6707778565701632-fcae48/artifacts/containers/podman/5204228376363008/html/sys-podman-fedora-35-rootless-host.log.html#t--00339) ### [sys] 333 podman run port forward range * fedora-35 : sys remote fedora-35 root host [remote] * PR #14342 * [05-24 09:53](https://storage.googleapis.com/cirrus-ci-6707778565701632-fcae48/artifacts/containers/podman/4809215066767360/html/sys-remote-fedora-35-root-host.log.html#t--00333) * fedora-36 : sys podman fedora-36 root host * PR #14333 * [05-24 17:30](https://storage.googleapis.com/cirrus-ci-6707778565701632-fcae48/artifacts/containers/podman/6508695407296512/html/sys-podman-fedora-36-root-host.log.html#t--00333) * fedora-36 : sys remote fedora-36 rootless host [remote] * PR #14342 * [05-24 09:52](https://storage.googleapis.com/cirrus-ci-6707778565701632-fcae48/artifacts/containers/podman/6498064927031296/html/sys-remote-fedora-36-rootless-host.log.html#t--00333) ### [sys] 330 podman run port forward range * fedora-35 : sys podman fedora-35 root host * PR #14016 * [05-10 12:23](https://storage.googleapis.com/cirrus-ci-6707778565701632-fcae48/artifacts/containers/podman/6172513217544192/html/sys-podman-fedora-35-root-host.log.html#t--00330) * fedora-35 : sys podman fedora-35 rootless host * PR #14180 * [05-10 12:13](https://storage.googleapis.com/cirrus-ci-6707778565701632-fcae48/artifacts/containers/podman/6215372427755520/html/sys-podman-fedora-35-rootless-host.log.html#t--00330) * fedora-36 : sys podman fedora-36 rootless host * PR #14250 * [05-15 16:11](https://storage.googleapis.com/cirrus-ci-6707778565701632-fcae48/artifacts/containers/podman/5600280698945536/html/sys-podman-fedora-36-rootless-host.log.html#t--00330) * PR #14095 * [05-04 10:56](https://storage.googleapis.com/cirrus-ci-6707778565701632-fcae48/artifacts/containers/podman/6440799574425600/html/sys-podman-fedora-36-rootless-host.log.html#t--00330) ### [sys] 327 podman run port forward range * fedora-36 : sys remote fedora-36 root host [remote] * PR #14045 * [04-28 14:21](https://storage.googleapis.com/cirrus-ci-6707778565701632-fcae48/artifacts/containers/podman/5038390998466560/html/sys-remote-fedora-36-root-host.log.html#t--00327) ...but if we include those where `rootlessport` does not appear in the error message, there's one more on 04-12: ### [sys] 315 podman run port forward range * fedora-35 : sys podman fedora-35 root host * PR #13814 * [04-12 07:19](https://storage.googleapis.com/cirrus-ci-6707778565701632-fcae48/artifacts/containers/podman/5377967302901760/html/sys-podman-fedora-35-root-host.log.html#t--00315) ...and if we include some slightly-different slirp error messages: ``` # Error: from slirp4netns while setting up port redirection: map[desc:bad request: add_hostfwd: slirp_add_hostfwd failed] ``` ...then we have three more: ### [sys] 340 podman run port forward range * fedora-36 : sys remote fedora-36 rootless host [remote] * PR #14619 * [06-16 12:42](https://storage.googleapis.com/cirrus-ci-6707778565701632-fcae48/artifacts/containers/podman/5320170179657728/html/sys-remote-fedora-36-rootless-host.log.html#t--00340) ### [sys] 326 podman run port forward range * fedora-35 : sys podman fedora-35 rootless host * PR #13942 * [04-25 15:48](https://storage.googleapis.com/cirrus-ci-6707778565701632-fcae48/artifacts/containers/podman/6595064196497408/html/sys-podman-fedora-35-rootless-host.log.html#t--00326) ### [sys] 325 podman run port forward range * fedora-35 : sys remote fedora-35 root host [remote] * PR #13988 * [04-24 07:40](https://storage.googleapis.com/cirrus-ci-6707778565701632-fcae48/artifacts/containers/podman/5997095093010432/html/sys-remote-fedora-35-root-host.log.html#t--00325)</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>3</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #14685 from mheon/gitlab Followon to #14559</MESSAGE>
    <SHA>3176b3fe011aa3323ba192e90efe516d0701e46e</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fix &quot;podman run port forward range&quot; flake The test must ensure that all ports in the range are free not just the first. This flakes often because port 5355 is always in use by systemd-resolved on fedora. Fixes #14716 Signed-off-by: Paul Holzinger &lt;pholzing@redhat.com&gt;</MESSAGE>
      <SHA>345778ece0eac49fe49e68a2dd2bb301c975c5af</SHA>
      <PATCHEDFILES>
        <FILE>test/system/150-login.bats</FILE>
        <FILE>test/system/500-networking.bats</FILE>
        <FILE>test/system/helpers.bash</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
