<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>24803</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/24803</ISSUEURL>
  <TITLE>Debian rootless integration tests fail remote tests that are supposed to raise an error</TITLE>
  <DESCRIPTION>### Issue Description Debian rootless integration tests fail remote tests that are supposed to raise an error. For instance, this one: https://github.com/containers/podman/blob/v5.3/test/e2e/system_dial_stdio_test.go The reason appears to be that the testsuite installs the `podman` Distro package, which comes with the systemd unit `/usr/lib/systemd/user/podman.socket` to make rootless podman as a system service work out of the box. That's awesome, but it appears this test particular asserts that this fails. Maybe this test could be written in a way that skips the test in this situation? As a sidenote, the Debian autopkgtest run &quot;as-installed&quot; package tests. I've written a small test invocation script that runs the upstream integration tests to revalidate fresh rebuilds of podman with potentially updated dependencies. ### Privileged Or Rootless Rootless ### Upstream Latest Release Yes ### Additional environment details Additional environment details ### Additional information Additional information like issue happens only occasionally or issue happens with a particular architecture or on a particular setting</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>9</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>shell completion: respect CONTAINERS_REGISTRIES_CONF Found in debian testing where by default there are no unqualified search registries installed. As such the test failed as the FIXME said. Now there is no need for the test to assume anything. Instead set our own config via CONTAINERS_REGISTRIES_CONF then we can do exact matches, except that env was not read in the shell completion code so move some code around to make it read the var in the same way as podman login/logout. Signed-off-by: Paul Holzinger &lt;git@holzinger.dev&gt;</MESSAGE>
    <SHA>153a9758889b5e6978115a13fb8b0133a4f25315</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>test/system: remove system dial-stdio test This test a pretty much useless, it checks that a connection attempt on the default socket fails. But this is incorrect as the socket is outside of the test control as such it might be ready to accept connections as thus the test can fail locally or as reported here in the debian tests. Given that a simple connection fails does not add any value I opted to remove it. Fixes #24803 Signed-off-by: Paul Holzinger &lt;git@holzinger.dev&gt;</MESSAGE>
      <SHA>87297256841125cc7c841753ef097d09c381d696</SHA>
      <PATCHEDFILES>
        <FILE>test/e2e/system_dial_stdio_test.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>test/system: remove system dial-stdio test This test a pretty much useless, it checks that a connection attempt on the default socket fails. But this is incorrect as the socket is outside of the test control as such it might be ready to accept connections as thus the test can fail locally or as reported here in the debian tests. Given that a simple connection fails does not add any value I opted to remove it. Fixes #24803 Signed-off-by: Paul Holzinger &lt;git@holzinger.dev&gt;</MESSAGE>
      <SHA>f94d398ba92e6ddd66f9e76202dd5fba0e031241</SHA>
      <PATCHEDFILES>
        <FILE>test/e2e/system_dial_stdio_test.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
