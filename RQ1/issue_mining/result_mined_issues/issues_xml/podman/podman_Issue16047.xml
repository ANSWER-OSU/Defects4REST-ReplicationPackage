<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>16047</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/16047</ISSUEURL>
  <TITLE>podman-kube@.service template: container exists, it shouldn't</TITLE>
  <DESCRIPTION>``` $ podman container exists f87e402febb6-service #/vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv #| FAIL: exit code is 0; expected 1 #\^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ ``` Relevant code: https://github.com/containers/podman/blob/43a8f1ae555018b5514af61ed789648afc79a589/test/system/250-systemd.bats#L436-L437 My understanding of systemd is that `systemctl stop` shouldn't return until the unit is really truly stopped? Is this a real bug, or a test bug? (It's easy to add a `wait` to the test, but my gut tells me that's not the right thing to do). * ubuntu-2204 : sys podman ubuntu-2204 rootless host * PR #13808 * [09-28 22:46](https://api.cirrus-ci.com/v1/artifact/task/4748300137005056/html/sys-podman-ubuntu-2204-rootless-host.log.html#t--00292) * PR #15873 * [09-22 16:56](https://api.cirrus-ci.com/v1/artifact/task/4934893649002496/html/sys-podman-ubuntu-2204-rootless-host.log.html#t--00290) * PR #15593 * [09-06 12:14](https://api.cirrus-ci.com/v1/artifact/task/5983584950419456/html/sys-podman-ubuntu-2204-rootless-host.log.html#t--00285)</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>91</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #16697 from rhatdan/pod stop reporting errors removing containers that don't exist</MESSAGE>
    <SHA>a55bdfaf104e256ac76ee23b0fb0ee576e88516d</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>test/system/250-systemd.bats: fix flake Fix a flake in the kube-template test. After stopping the service, we want to make sure that the service container gets removed. However, ther is a small race window. `systemctl stop` will return when the service container _exits_. In between that and the `container exists` check, the service container may have not yet been removed. Hence, add a loop to account for that race. Fixes: #16047 Signed-off-by: Valentin Rothberg &lt;vrothberg@redhat.com&gt;</MESSAGE>
      <SHA>3ca0e46c15ca342e62c35c8267fde78b63b2d768</SHA>
      <PATCHEDFILES>
        <FILE>test/system/250-systemd.bats</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
