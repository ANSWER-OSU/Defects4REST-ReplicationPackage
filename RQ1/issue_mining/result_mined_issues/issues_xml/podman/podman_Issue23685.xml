<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>23685</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/23685</ISSUEURL>
  <TITLE>CI: podman stop: timeout</TITLE>
  <DESCRIPTION>One-off. I think I've seen this one before, but have no way to find it because I didn't file it. ``` [+0242s] • [FAILED] [92.098 seconds] TOP-LEVEL [AfterEach] Podman UserNS support podman --userns=container:CTR .... $ podman [options] run --rm --userns=container:userns-ctr --net=container:userns-ctr alpine cat /proc/self/uid_map 0 0 1 1 2 4998 ← Exit [It] podman --userns=container:CTR - /var/tmp/go/src/github.com[/containers/podman/test/e2e/run_userns_test.go:324](https://github.com/containers/podman/blob/fc30620cdb11b011ee396222795af415feda8b03/test/e2e/run_userns_test.go#L324) @ 08/19/24 15:33:35.557 (1.09s) → Enter [AfterEach] TOP-LEVEL - /var/tmp/go/src/github.com[/containers/podman/test/e2e/common_test.go:122](https://github.com/containers/podman/blob/fc30620cdb11b011ee396222795af415feda8b03/test/e2e/common_test.go#L122) @ 08/19/24 15:33:35.558 $ podman [options] stop --all -t 0 SIGABRT: abort PC=0x4820e1 m=0 sigcode=0 goroutine 0 gp=0x2d7c440 m=0 mp=0x2d7f5e0 [idle]: runtime.futex(0x2d7f720, 0x80, 0x0, 0x0, 0x0, 0x0) /usr/lib/go-1.22/src/runtime/sys_linux_amd64.s:557 +0x21 fp=0x7ffd4f5dc8a0 sp=0x7ffd4f5dc898 pc=0x4820e1 runtime.futexsleep(0x7ffd4f5dc918?, 0x417030?, 0x455607?) /usr/lib/go-1.22/src/runtime/os_linux.go:69 +0x30 fp=0x7ffd4f5dc8f0 sp=0x7ffd4f5dc8a0 pc=0x441610 runtime.notesleep(0x2d7f720) /usr/lib/go-1.22/src/runtime/lock_futex.go:170 +0x87 fp=0x7ffd4f5dc928 sp=0x7ffd4f5dc8f0 pc=0x4171c7 runtime.mPark(...) /usr/lib/go-1.22/src/runtime/proc.go:1761 runtime.stopm() ``` In [debian rootless](https://api.cirrus-ci.com/v1/artifact/task/6333888472023040/html/int-podman-debian-13-rootless-host-sqlite.log.html#t--Podman-UserNS-support-podman-userns-container-CTR--1), and not in any of my test PRs</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>30</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>vendor latest c/common To include the pkg/netns changes. Signed-off-by: Paul Holzinger &lt;pholzing@redhat.com&gt;</MESSAGE>
    <SHA>f6bda786edb4b85981ace7004d2817a81eb39ce6</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>libpod: setupNetNS() correctly mount netns The netns dir has a special logic to bind mout itself and make itslef shared. This code here didn't which lead to catastrophic bug during netns unmounting as we were unable to unmount the netns as the mount got duplicated and had the wrong parent mount. This caused us to loop forever trying to remove the file. Fixes https://issues.redhat.com/browse/RHEL-59620 Fixes #23685 Signed-off-by: Paul Holzinger &lt;pholzing@redhat.com&gt;</MESSAGE>
      <SHA>792796183f92946a6722c084b1ba9e7c602eefd0</SHA>
      <PATCHEDFILES>
        <FILE>libpod/networking_linux.go</FILE>
        <FILE>test/system/550-pause-process.bats</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>libpod: setupNetNS() correctly mount netns The netns dir has a special logic to bind mout itself and make itslef shared. This code here didn't which lead to catastrophic bug during netns unmounting as we were unable to unmount the netns as the mount got duplicated and had the wrong parent mount. This caused us to loop forever trying to remove the file. Fixes https://issues.redhat.com/browse/RHEL-59620 Fixes #23685 Signed-off-by: Paul Holzinger &lt;pholzing@redhat.com&gt;</MESSAGE>
      <SHA>a995b6db5d4e66abebe2f05ac6b34512f2b6c671</SHA>
      <PATCHEDFILES>
        <FILE>libpod/networking_linux.go</FILE>
        <FILE>test/system/550-pause-process.bats</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>libpod: setupNetNS() correctly mount netns The netns dir has a special logic to bind mout itself and make itslef shared. This code here didn't which lead to catastrophic bug during netns unmounting as we were unable to unmount the netns as the mount got duplicated and had the wrong parent mount. This caused us to loop forever trying to remove the file. Fixes https://issues.redhat.com/browse/RHEL-59620 Fixes #23685 Fixes https://issues.redhat.com/browse/RHEL-59703 (backport) Signed-off-by: Paul Holzinger &lt;pholzing@redhat.com&gt;</MESSAGE>
      <SHA>74ef32a2ee17411131906e3eca5d29f6e1eda977</SHA>
      <PATCHEDFILES>
        <FILE>libpod/networking_linux.go</FILE>
        <FILE>test/system/550-pause-process.bats</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
