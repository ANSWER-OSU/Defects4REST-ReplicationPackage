<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>23334</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/23334</ISSUEURL>
  <TITLE>race: completion: cannot get cgroup path unless container is running</TITLE>
  <DESCRIPTION>Another parallel-system-test flake, seen in [f39 root](https://api.cirrus-ci.com/v1/artifact/task/4568876212551680/html/sys-podman-fedora-39-root-host-boltdb.log.html): ``` &lt;+036ms&gt; # # podman pod stats --no-stream --format {{&quot;\n&quot;}} &lt;+198ms&gt; # Error: cannot get cgroup path unless container e3c650c8438160f0c2728fc4ed589bc6c06546e6abfba38db49d5d15b9325310 is running: container is stopped &lt;+016ms&gt; # [ rc=125 ] # #/vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv # #| FAIL: podman pod stats --format '{{&quot;\n&quot;}}' # #| expected: = '' # #| actual: Error: cannot get cgroup path unless container e3c650c8438160f0c2728fc4ed589bc6c06546e6abfba38db49d5d15b9325310 is running: container is stopped # #\^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ ```</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>3</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #23323 from Luap99/machine-decompress-empty pkg/machine/compression: skip decompress bar for empty file</MESSAGE>
    <SHA>8a53e8eb677f4b10f31f69714ab0f3f964e508cd</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>podman stats: fix race when ctr process exists stats read from the cgroup, and in order to know the cgroup we check the pid for the cgroup. However there is a window where the pid exited and podman did not yet updated its internal state. In this case the code returns ErrCtrStopped so we should ignore this error as well. Fixes #23334 Signed-off-by: Paul Holzinger &lt;pholzing@redhat.com&gt;</MESSAGE>
      <SHA>55749af0c7c7d8fed8e095a649d216450313fbdb</SHA>
      <PATCHEDFILES>
        <FILE>pkg/domain/infra/abi/containers.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>podman pod stats: fix race when ctr process exits Like commit 55749af0c7 but for podman *pod* stats not the normal podman stats. We must ignore ErrCtrStopped here as well as this will happen when the container process exited. While at it remove a useless argument from the function as it was always nil and restructure the logic flow to make it easier to read. Fixes #23334 Signed-off-by: Paul Holzinger &lt;pholzing@redhat.com&gt;</MESSAGE>
      <SHA>55b6e4c3e8bf10994a419cb314eaa296670d1d7d</SHA>
      <PATCHEDFILES>
        <FILE>libpod/pod.go</FILE>
        <FILE>pkg/domain/infra/abi/pods_stats.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
