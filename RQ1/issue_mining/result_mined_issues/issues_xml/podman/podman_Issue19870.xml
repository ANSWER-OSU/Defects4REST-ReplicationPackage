<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>19870</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/19870</ISSUEURL>
  <TITLE>podman system reset deletes user directory?!?</TITLE>
  <DESCRIPTION>### Issue Description `podman system reset` just wiped my entire home directory. ### Steps to reproduce the issue ``` $ sudo podman system reset WARNING! This will remove: - all containers - all pods - all images - all build cache Are you sure you want to continue? [y/N] y ERRO[0066] unlinkat /home/myusername: device or resource busy ERRO[0066] unlinkat /home/myusername: device or resource busy $ ls -lh /home/myusername total 0 ``` ### Describe the results you received I will set up my machine from scratch I guess... ### Describe the results you expected Container stuff being deleted, not my computer. ### podman info output ```yaml Rootless (This is what I wanted to fix): ❯ podman info Error: 'overlay' is not supported over zfs, a mount_program is required: backing file system is unsupported for this graph driver ``` With root: ``` ❯ sudo podman info host: arch: amd64 buildahVersion: 1.23.1 cgroupControllers: - cpuset - cpu - io - memory - hugetlb - pids - rdma - misc cgroupManager: systemd cgroupVersion: v2 conmon: package: 'conmon: /usr/bin/conmon' path: /usr/bin/conmon version: 'conmon version 2.0.25, commit: unknown' cpus: 16 distribution: codename: jammy distribution: ubuntu version: &quot;22.04&quot; eventLogger: journald hostname: BN02WT3 idMappings: gidmap: null uidmap: null kernel: 6.2.0-32-generic linkmode: dynamic logDriver: journald memFree: 24536809472 memTotal: 32839950336 ociRuntime: name: crun package: 'crun: /usr/bin/crun' path: /usr/bin/crun version: |- crun version 0.17 commit: 0e9229ae34caaebcb86f1fde18de3acaf18c6d9a spec: 1.0.0 +SYSTEMD +SELINUX +APPARMOR +CAP +SECCOMP +EBPF +YAJL os: linux remoteSocket: exists: true path: /run/podman/podman.sock security: apparmorEnabled: true capabilities: CAP_CHOWN,CAP_DAC_OVERRIDE,CAP_FOWNER,CAP_FSETID,CAP_KILL,CAP_NET_BIND_SERVICE,CAP_SETFCAP,CAP_SETGID,CAP_SETPCAP,CAP_SETUID,CAP_SYS_CHROOT rootless: false seccompEnabled: true seccompProfilePath: /usr/share/containers/seccomp.json selinuxEnabled: false serviceIsRemote: false slirp4netns: executable: /usr/bin/slirp4netns package: 'slirp4netns: /usr/bin/slirp4netns' version: |- slirp4netns version 1.0.1 commit: 6a7b16babc95b6a3056b33fb45b74a6f62262dd4 libslirp: 4.6.1 swapFree: 2147479552 swapTotal: 2147479552 uptime: 40m 40.82s plugins: log: - k8s-file - none - journald network: - bridge - macvlan volume: - local registries: {} store: configFile: /etc/containers/storage.conf containerStore: number: 0 paused: 0 running: 0 stopped: 0 graphDriverName: zfs graphOptions: {} graphRoot: /home/myusername graphStatus: Compression: lz4 Parent Dataset: rpool/USERDATA/myusername_ac0sfr Parent Quota: &quot;no&quot; Space Available: &quot;421820657664&quot; Space Used By Parent: &quot;93089792&quot; Zpool: rpool Zpool Health: ONLINE imageStore: number: 0 runRoot: /home/myusername volumePath: /var/lib/containers/storage/volumes version: APIVersion: 3.4.4 Built: 0 BuiltTime: Thu Jan 1 01:00:00 1970 GitCommit: &quot;&quot; GoVersion: go1.18.1 OsArch: linux/amd64 Version: 3.4.4 ``` ``` ### Podman in a container No ### Privileged Or Rootless None ### Upstream Latest Release Yes ### Additional environment details Ubuntu 22, this was a fresh installation of Podman (`sudo apt install podman`) because I thought it would be a feasible replacement of docker (which was uninstalled beforehand). When I write above that I wanted to fix a specific error, I essentially wanted to [follow this guide](https://www.jwillikers.com/podman-with-btrfs-and-zfs), however, I did not really make it towards the part where I would configure the storage driver, because step 1 is the system reset... ### Additional information _No response_</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #18229 from cevich/v3.4_remove_ci [v3.4] Cirrus: Disable CI</MESSAGE>
    <SHA>f287c0b2706c65d73555b7052c7c60a72ed510df</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>[v3.4] system reset: show graphRoot/runRoot before removal Backport of commit 6aaf6a28435c. system reset it says it will delete containers, images, networks, etc... However it will also delete the graphRoot and runRoot directories. Normally this is not an issue, however in same cases these directories were set to the users home directory or some other important system directory. As first step simply show the directories that are configured and thus will be deleted by reset. As future step we could implement some safeguard will will not delete some known important directories however I tried to keep it simple for now. [NO NEW TESTS NEEDED] see #18349, #18295, and #19870 Signed-off-by: Valentin Rothberg &lt;vrothberg@redhat.com&gt;</MESSAGE>
      <SHA>a34dbdc53ff8e06f696730e084f2133408b2a567</SHA>
      <PATCHEDFILES>
        <FILE>cmd/podman/system/reset.go</FILE>
        <FILE>docs/source/markdown/podman-system-reset.1.md</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>[v4.4] system reset: show graphRoot/runRoot before removal Backport of commit 6aaf6a2. system reset it says it will delete containers, images, networks, etc... However it will also delete the graphRoot and runRoot directories. Normally this is not an issue, however in same cases these directories were set to the users home directory or some other important system directory. As first step simply show the directories that are configured and thus will be deleted by reset. As future step we could implement some safeguard will will not delete some known important directories however I tried to keep it simple for now. [NO NEW TESTS NEEDED] see #18349, #18295, and #19870 Signed-off-by: Paul Holzinger &lt;pholzing@redhat.com&gt; Signed-off-by: Valentin Rothberg &lt;vrothberg@redhat.com&gt;</MESSAGE>
      <SHA>49803be9ad497eb0457b47ceb7ffcabbc502bc30</SHA>
      <PATCHEDFILES>
        <FILE>cmd/podman/system/reset.go</FILE>
        <FILE>docs/source/markdown/podman-system-reset.1.md</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
