<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>22246</ISSUENO>
  <ISSUEURL>https://github.com/containers/podman/issues/22246</ISSUEURL>
  <TITLE>e2e: kube play, huge annotation: podman rm hangs</TITLE>
  <DESCRIPTION>Seeing a new flake recently, so far only in podman-remote root. Not OS-specific: ``` Podman kube play test with annotation size within limits .... # podman-remote [options] kube play /var/tmp/pme2e-1564132875/pm3097852031/kube.yaml [works fine] ← Exit [It] test with annotation size within limits → Enter [AfterEach] TOP-LEVEL # podman-remote [options] stop --all -t 0 [works fine] # podman-remote [options] pod rm -fa -t 0 [FAILED] Timed out after 90.000s. ``` * debian-13 : int remote debian-13 root host sqlite [remote] * [04-02 12:13](https://api.cirrus-ci.com/v1/artifact/task/6139292626452480/html/int-remote-debian-13-root-host-sqlite.log.html#t--Podman-kube-play-test-with-annotation-size-within-limits--1) in TOP-LEVEL [AfterEach] Podman kube play test with annotation size within limits * [04-01 13:30](https://api.cirrus-ci.com/v1/artifact/task/5682052488495104/html/int-remote-debian-13-root-host-sqlite.log.html#t--Podman-kube-play-test-with-annotation-size-within-limits--1) in TOP-LEVEL [AfterEach] Podman kube play test with annotation size within limits * [03-26 14:32](https://api.cirrus-ci.com/v1/artifact/task/5092261734645760/html/int-remote-debian-13-root-host-sqlite.log.html#t--Podman-kube-play-test-with-annotation-size-within-limits--1) in TOP-LEVEL [AfterEach] Podman kube play test with annotation size within limits * fedora-39 : int remote fedora-39 root host sqlite [remote] * [04-02 08:52](https://api.cirrus-ci.com/v1/artifact/task/4904182371581952/html/int-remote-fedora-39-root-host-sqlite.log.html#t--Podman-kube-play-test-with-annotation-size-within-limits--1) in TOP-LEVEL [AfterEach] Podman kube play test with annotation size within limits * rawhide : int remote rawhide root host sqlite [remote] * [04-02 21:12](https://api.cirrus-ci.com/v1/artifact/task/6674818871853056/html/int-remote-rawhide-root-host-sqlite.log.html#t--Podman-kube-play-test-with-annotation-size-within-limits--1) in TOP-LEVEL [AfterEach] Podman kube play test with annotation size within limits | x | x | x | x | x | x | | ---: | ---: | ---: | ---: | ---: | ---: | | int(5) | remote(5) | debian-13(3) | root(5) | host(5) | sqlite(5) | | | | rawhide(1) | | | | | | | fedora-39(1) | | | |</DESCRIPTION>
  <REPONAME>podman</REPONAME>
  <TIMEDIFFERENCEDAYS>135</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #23519 from Luap99/netns-cleanup update c/common to add some netns cleanup fixes</MESSAGE>
    <SHA>734c4b98d4fa006521a10515c0e9d3f4281bc2da</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>test/e2e: on test failures dump server stack strace To debug #22246 Signed-off-by: Paul Holzinger &lt;pholzing@redhat.com&gt;</MESSAGE>
      <SHA>c3453dd325eab123fb8215932739418156f981b8</SHA>
      <PATCHEDFILES>
        <FILE>test/e2e/common_test.go</FILE>
        <FILE>test/e2e/libpod_suite_remote_test.go</FILE>
        <FILE>test/e2e/libpod_suite_test.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>libpod: remove UpdateContainerStatus() There are two major problems with UpdateContainerStatus() First, it can deadlock when the the state json is to big as it tries to read stderr until EOF but it will never hit EOF as long as the runtime process is alive. This means if the runtime json is to big to git into the pipe buffer we deadlock ourselves. Second, the function modifies the container state struct and even adds and exit code to the db however when it is called from the stop() code path we will be unlocked here. While the first problem is easy to fix the second one not so much. And when we cannot update the state there is no point in reading the from runtime in the first place as such remove the function as it does more harm then good. And add some warnings the the functions that might be called unlocked. Fixes #22246 Signed-off-by: Paul Holzinger &lt;pholzing@redhat.com&gt;</MESSAGE>
      <SHA>ddece758a46b0cea2e5b59ff8e7181f2066dd8b7</SHA>
      <PATCHEDFILES>
        <FILE>libpod/oci.go</FILE>
        <FILE>libpod/oci_conmon_common.go</FILE>
        <FILE>libpod/oci_missing.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>test/e2e: on test failures dump server stack strace To debug #22246 Signed-off-by: Paul Holzinger &lt;pholzing@redhat.com&gt;</MESSAGE>
      <SHA>80fc34e2c1245c75c4c671cb269e091e3000387c</SHA>
      <PATCHEDFILES>
        <FILE>test/e2e/common_test.go</FILE>
        <FILE>test/e2e/libpod_suite_remote_test.go</FILE>
        <FILE>test/e2e/libpod_suite_test.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>test/e2e: on test failures dump server stack strace To debug #22246 Signed-off-by: Paul Holzinger &lt;pholzing@redhat.com&gt;</MESSAGE>
      <SHA>394f68d05408bf32c786081d38b9fadfdec059a4</SHA>
      <PATCHEDFILES>
        <FILE>test/e2e/common_test.go</FILE>
        <FILE>test/e2e/libpod_suite_remote_test.go</FILE>
        <FILE>test/e2e/libpod_suite_test.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>test/e2e: on test failures dump server stack strace To debug #22246 Signed-off-by: Paul Holzinger &lt;pholzing@redhat.com&gt;</MESSAGE>
      <SHA>79c75ffac1bf9223f5bfa5fec70e1e684f859f72</SHA>
      <PATCHEDFILES>
        <FILE>test/e2e/common_test.go</FILE>
        <FILE>test/e2e/libpod_suite_remote_test.go</FILE>
        <FILE>test/e2e/libpod_suite_test.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
