<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>65</ISSUENO>
  <ISSUEURL>https://github.com/strapdata/elassandra/issues/65</ISSUEURL>
  <TITLE>java.io.IOException: from is a reserved keyword</TITLE>
  <DESCRIPTION>Bonjour Vincent, Using latest build, I am attempting to create custom index mapping including ```object``` types resulting in a faceted issue - filing them together as they seem two faces of the same coin so to speak. ### java.io.IOException: from is a reserved keyword ``` PUT watcher { &quot;mappings&quot;: { &quot;watch&quot;: { &quot;properties&quot;: { &quot;id&quot;: { &quot;type&quot;: &quot;string&quot;, &quot;index&quot;: &quot;not_analyzed&quot; }, &quot;condition&quot;: { &quot;type&quot;:&quot;object&quot;, &quot;enabled&quot;: false }, &quot;input&quot;: { &quot;type&quot;:&quot;object&quot;, &quot;enabled&quot;: false }, &quot;transform&quot;: { &quot;type&quot;:&quot;object&quot;, &quot;enabled&quot;: false } } } } } ``` followed by a document creation attempt: ``` PUT watcher/watch/test_watch_random { &quot;disabled&quot;: false, &quot;id&quot;: &quot;test_watch_random&quot;, &quot;trigger&quot;: { &quot;schedule&quot;: { &quot;later&quot;: &quot;every 5 minutes&quot; } }, &quot;input&quot;: { &quot;search&quot;: { &quot;request&quot;: { &quot;index&quot;: [], &quot;body&quot;: {} } } }, &quot;condition&quot;: { &quot;script&quot;: { &quot;script&quot;: &quot;payload.hits.total &gt; 100&quot; } }, &quot;transform&quot;: {}, &quot;actions&quot;: { &quot;email_admin&quot;: { &quot;throttle_period&quot;: &quot;15m&quot;, &quot;email&quot;: { &quot;to&quot;: &quot;alarm@localhost&quot;, &quot;from&quot;: &quot;sentinl@localhost&quot;, &quot;subject&quot;: &quot;Sentinl Alarm&quot;, &quot;priority&quot;: &quot;high&quot;, &quot;body&quot;: &quot;Found {{payload.hits.total}} Events&quot; } } } } ``` The first response of Elassandra is: ``` { &quot;error&quot;: { &quot;root_cause&quot;: [ { &quot;type&quot;: &quot;runtime_exception&quot;, &quot;reason&quot;: &quot;java.io.IOException: from is a reserved keyword&quot; } ], &quot;type&quot;: &quot;runtime_exception&quot;, &quot;reason&quot;: &quot;java.io.IOException: from is a reserved keyword&quot;, &quot;caused_by&quot;: { &quot;type&quot;: &quot;i_o_exception&quot;, &quot;reason&quot;: &quot;from is a reserved keyword&quot;, &quot;caused_by&quot;: { &quot;type&quot;: &quot;configuration_exception&quot;, &quot;reason&quot;: &quot;from is a reserved keyword&quot; } } }, &quot;status&quot;: 500 } ``` with logs: ``` 2016-12-26 08:51:11,257 WARN [elasticsearch[127.0.0.1][http_server_worker][T#3]{New I/O worker #53}] BytesRestResponse.java:134 convert path: /watcher2/watch/test_watch_random, params: {index=watcher2, id=test_watch_random, type=watch} java.lang.RuntimeException: java.io.IOException: from is a reserved keyword at org.elassandra.cluster.InternalCassandraClusterService$BlockingActionListener.waitForUpdate(InternalCassandraClusterService.java:1820) at org.elassandra.cluster.InternalCassandraClusterService.blockingMappingUpdate(InternalCassandraClusterService.java:1842) at org.elassandra.cluster.InternalCassandraClusterService.upsertDocument(InternalCassandraClusterService.java:1879) at org.elassandra.cluster.InternalCassandraClusterService.insertDocument(InternalCassandraClusterService.java:1852) at org.elasticsearch.action.index.TransportXIndexAction.innerExecute(TransportXIndexAction.java:85) at org.elasticsearch.action.index.TransportIndexAction.doExecute(TransportIndexAction.java:120) at org.elasticsearch.action.index.TransportIndexAction.doExecute(TransportIndexAction.java:66) at org.elasticsearch.action.support.TransportAction.execute(TransportAction.java:137) at org.elasticsearch.action.support.TransportAction.execute(TransportAction.java:85) at org.elasticsearch.client.node.NodeClient.doExecute(NodeClient.java:58) at org.elasticsearch.client.support.AbstractClient.execute(AbstractClient.java:359) at org.elasticsearch.client.FilterClient.doExecute(FilterClient.java:52) at org.elasticsearch.rest.BaseRestHandler$HeadersAndContextCopyClient.doExecute(BaseRestHandler.java:88) at org.elasticsearch.client.support.AbstractClient.execute(AbstractClient.java:359) at org.elasticsearch.client.support.AbstractClient.index(AbstractClient.java:371) at org.elasticsearch.rest.action.index.RestIndexAction.handleRequest(RestIndexAction.java:105) at org.elasticsearch.rest.BaseRestHandler.handleRequest(BaseRestHandler.java:54) at org.elasticsearch.rest.RestController.executeHandler(RestController.java:198) at org.elasticsearch.rest.RestController.dispatchRequest(RestController.java:158) at org.elasticsearch.http.HttpServer.internalDispatchRequest(HttpServer.java:153) at org.elasticsearch.http.HttpServer$Dispatcher.dispatchRequest(HttpServer.java:101) at org.elasticsearch.http.netty.NettyHttpServerTransport.dispatchRequest(NettyHttpServerTransport.java:451) at org.elasticsearch.http.netty.HttpRequestHandler.messageReceived(HttpRequestHandler.java:61) at org.jboss.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:70) at org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564) at org.jboss.netty.channel.DefaultChannelPipeline$DefaultChannelHandlerContext.sendUpstream(DefaultChannelPipeline.java:791) at org.elasticsearch.http.netty.pipelining.HttpPipeliningHandler.messageReceived(HttpPipeliningHandler.java:60) at org.jboss.netty.channel.SimpleChannelHandler.handleUpstream(SimpleChannelHandler.java:88) at org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564) at org.jboss.netty.channel.DefaultChannelPipeline$DefaultChannelHandlerContext.sendUpstream(DefaultChannelPipeline.java:791) at org.jboss.netty.handler.codec.http.HttpChunkAggregator.messageReceived(HttpChunkAggregator.java:145) at org.jboss.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:70) at org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564) at org.jboss.netty.channel.DefaultChannelPipeline$DefaultChannelHandlerContext.sendUpstream(DefaultChannelPipeline.java:791) at org.jboss.netty.handler.codec.http.HttpContentDecoder.messageReceived(HttpContentDecoder.java:108) at org.jboss.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:70) at org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564) at org.jboss.netty.channel.DefaultChannelPipeline$DefaultChannelHandlerContext.sendUpstream(DefaultChannelPipeline.java:791) at org.jboss.netty.channel.Channels.fireMessageReceived(Channels.java:296) at org.jboss.netty.handler.codec.frame.FrameDecoder.unfoldAndFireMessageReceived(FrameDecoder.java:459) at org.jboss.netty.handler.codec.replay.ReplayingDecoder.callDecode(ReplayingDecoder.java:536) at org.jboss.netty.handler.codec.replay.ReplayingDecoder.messageReceived(ReplayingDecoder.java:435) at org.jboss.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:70) at org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564) at org.jboss.netty.channel.DefaultChannelPipeline$DefaultChannelHandlerContext.sendUpstream(DefaultChannelPipeline.java:791) at org.elasticsearch.common.netty.OpenChannelsHandler.handleUpstream(OpenChannelsHandler.java:75) at org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564) at org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:559) at org.jboss.netty.channel.Channels.fireMessageReceived(Channels.java:268) at org.jboss.netty.channel.Channels.fireMessageReceived(Channels.java:255) at org.jboss.netty.channel.socket.nio.NioWorker.read(NioWorker.java:88) at org.jboss.netty.channel.socket.nio.AbstractNioWorker.process(AbstractNioWorker.java:108) at org.jboss.netty.channel.socket.nio.AbstractNioSelector.run(AbstractNioSelector.java:337) at org.jboss.netty.channel.socket.nio.AbstractNioWorker.run(AbstractNioWorker.java:89) at org.jboss.netty.channel.socket.nio.NioWorker.run(NioWorker.java:178) at org.jboss.netty.util.ThreadRenamingRunnable.run(ThreadRenamingRunnable.java:108) at org.jboss.netty.util.internal.DeadLockProofWorker$1.run(DeadLockProofWorker.java:42) at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) at java.lang.Thread.run(Thread.java:745) Caused by: java.io.IOException: from is a reserved keyword at org.elassandra.cluster.InternalCassandraClusterService.updateTableSchema(InternalCassandraClusterService.java:1185) at org.elasticsearch.cluster.metadata.MetaDataMappingService$PutMappingExecutor.applyRequest(MetaDataMappingService.java:391) at org.elasticsearch.cluster.metadata.MetaDataMappingService$PutMappingExecutor.execute(MetaDataMappingService.java:280) at org.elasticsearch.cluster.service.InternalClusterService.runTasksForExecutor(InternalClusterService.java:540) at org.elasticsearch.cluster.service.InternalClusterService$UpdateTask.run(InternalClusterService.java:902) at org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.runAndClean(PrioritizedEsThreadPoolExecutor.java:231) at org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.run(PrioritizedEsThreadPoolExecutor.java:194) ... 3 common frames omitted Caused by: org.apache.cassandra.exceptions.ConfigurationException: from is a reserved keyword at org.elassandra.cluster.InternalCassandraClusterService.buildUDT(InternalCassandraClusterService.java:795) at org.elassandra.cluster.InternalCassandraClusterService.buildCql(InternalCassandraClusterService.java:744) at org.elassandra.cluster.InternalCassandraClusterService.buildUDT(InternalCassandraClusterService.java:772) at org.elassandra.cluster.InternalCassandraClusterService.buildCql(InternalCassandraClusterService.java:744) at org.elassandra.cluster.InternalCassandraClusterService.buildUDT(InternalCassandraClusterService.java:772) at org.elassandra.cluster.InternalCassandraClusterService.buildCql(InternalCassandraClusterService.java:744) at org.elassandra.cluster.InternalCassandraClusterService.updateTableSchema(InternalCassandraClusterService.java:1093) ... 9 common frames omitted ``` Interestingly, attempting the very same insert unchanged, works: ``` { &quot;_index&quot;: &quot;watcher&quot;, &quot;_type&quot;: &quot;watch&quot;, &quot;_id&quot;: &quot;test_watch_random&quot;, &quot;_version&quot;: 1, &quot;_shards&quot;: { &quot;total&quot;: 1, &quot;successful&quot;: 1, &quot;failed&quot;: 0 }, &quot;created&quot;: true } ``` and gets indexed correctly: ``` GET watcher/_search { &quot;took&quot;: 5, &quot;timed_out&quot;: false, &quot;_shards&quot;: { &quot;total&quot;: 1, &quot;successful&quot;: 1, &quot;failed&quot;: 0 }, &quot;hits&quot;: { &quot;total&quot;: 1, &quot;max_score&quot;: 1, &quot;hits&quot;: [ { &quot;_index&quot;: &quot;watcher&quot;, &quot;_type&quot;: &quot;watch&quot;, &quot;_id&quot;: &quot;test_watch_random&quot;, &quot;_score&quot;: 1, &quot;_source&quot;: { &quot;input&quot;: &quot;{\&quot;search\&quot;:{\&quot;request\&quot;:{\&quot;index\&quot;:[],\&quot;body\&quot;:{}}}}&quot;, &quot;condition&quot;: &quot;{\&quot;script\&quot;:{\&quot;script\&quot;:\&quot;payload.hits.total &gt; 100\&quot;}}&quot;, &quot;transform&quot;: &quot;{}&quot;, &quot;id&quot;: &quot;test_name&quot; } } ] } } ``` ### Pure Object documents not searchable Attempting to create a mapping without an &quot;enabled&quot; field seems to fail harder - the above mapping/document without the &quot;string&quot; id field is accepted but returns no search results afterwards. Here's an adapted example to reproduce: ``` PUT watcher_fail { &quot;mappings&quot;: { &quot;watch&quot;: { &quot;properties&quot;: { &quot;condition&quot;: { &quot;type&quot;:&quot;object&quot;, &quot;enabled&quot;: false }, &quot;input&quot;: { &quot;type&quot;:&quot;object&quot;, &quot;enabled&quot;: false }, &quot;transform&quot;: { &quot;type&quot;:&quot;object&quot;, &quot;enabled&quot;: false } } } } } ``` followed by a document creation attempt: ``` PUT watcher_fail/watch/this_doc_will_be_missing { &quot;trigger&quot;: { &quot;schedule&quot;: { &quot;later&quot;: &quot;every 5 minutes&quot; } }, &quot;input&quot;: { &quot;search&quot;: { &quot;request&quot;: { &quot;index&quot;: [], &quot;body&quot;: {} } } }, &quot;condition&quot;: { &quot;script&quot;: { &quot;script&quot;: &quot;payload.hits.total &gt; 100&quot; } }, &quot;transform&quot;: {}, &quot;actions&quot;: { &quot;email_admin&quot;: { &quot;throttle_period&quot;: &quot;15m&quot;, &quot;email&quot;: { &quot;to&quot;: &quot;alarm@localhost&quot;, &quot;from&quot;: &quot;sentinl@localhost&quot;, &quot;subject&quot;: &quot;Sentinl Alarm&quot;, &quot;priority&quot;: &quot;high&quot;, &quot;body&quot;: &quot;Found {{payload.hits.total}} Events&quot; } } } } ``` The above document should get accepted, but will never be available in search: ``` GET watcher_fail/_search ```</DESCRIPTION>
  <REPONAME>elassandra</REPONAME>
  <TIMEDIFFERENCEDAYS>2</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Release 2.4.2-2</MESSAGE>
    <SHA>0ea3e0c001091114cff0e6904431efffef946de1</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Remove FROM from the reserved keyword #65 from is a reserved keyword #65</MESSAGE>
      <SHA>5c3e730cb5a503bd154c46abf2ad37c4dbfcc688</SHA>
      <PATCHEDFILES>
        <FILE>core/src/main/java/org/elassandra/cluster/InternalCassandraClusterService.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
