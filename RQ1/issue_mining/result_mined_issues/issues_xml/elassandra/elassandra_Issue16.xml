<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>16</ISSUENO>
  <ISSUEURL>https://github.com/strapdata/elassandra/issues/16</ISSUEURL>
  <TITLE>Elasticsearch geo_point causes ERROR during insert into Elassandra with CURL</TITLE>
  <DESCRIPTION>Hi, I'm trying to run the Kibana Getting Started tutorial with Elassandra 2.1.1-8 and Kibana 4.3.3 (linux-x64). To accomplish the Map Visualization I have launched the following command: *****\* ELASTICSEARCH COORDINATES DEFINITION ****** `curl -XPUT http://localhost:9200/logstash_20150520 -d ' { &quot;mappings&quot;: { &quot;log&quot;: { &quot;properties&quot;: { &quot;geo&quot;: { &quot;properties&quot;: { &quot;coordinates&quot;: { &quot;type&quot;: &quot;geo_point&quot; } } } } } } } '; ` and then I've done a bulk insert with the following command: *****\* ELASTICSEARCH BULK INSERT ****** `curl -XPOST 'localhost:9200/_bulk?pretty' --data-binary @logs.jsonl ` The bulk fails with the following ERROR (from system.log): ###### ######## START ERROR 2016-04-28 13:08:41,244 ERROR [elasticsearch[localhost][index][T#4]] InternalCassandraClusterService.java:1479 insertDocument [localhost] [logstash_20150520].[log] failed to parse field geo={dest=IN, src=R U, coordinates={lon=-87.44675972, lat=31.01621528}, srcdest=RU:IN} java.lang.ClassCastException: null 2016-04-28 13:08:41,244 DEBUG [elasticsearch[localhost][index][T#4]] TransportReplicationAction.java:604 performOnPrimary [localhost] [logstash_20150520][0], node[c7610fa4-e08b-405b-b855-c682a935543a], [P] , v[1], s[STARTED], a[id=B0BPlnTrS2-fmliQ7rwABw]: Failed to execute [index {[logstash_20150520][log][test], source[ { &quot;@timestamp&quot; : &quot;2015-05-01T15:57:34.915Z&quot;, &quot;ip&quot; : &quot;166.114.155.140&quot;, &quot;extension&quot; : &quot;jpg&quot;, &quot;response&quot; : &quot;200&quot;, &quot;geo&quot; : { &quot;coordinates&quot; : { &quot;lat&quot; : 31.01621528, &quot;lon&quot; : -87.44675972 }, &quot;src&quot; : &quot;RU&quot;, &quot;dest&quot; : &quot;IN&quot;, &quot;srcdest&quot; : &quot;RU:IN&quot; }, &quot;@tags&quot; : [&quot;success&quot;, &quot;info&quot;], &quot;utc_time&quot; : &quot;2015-05-20T15:57:34.915Z&quot;, &quot;referer&quot; : &quot;http://twitter.com/success/ellison-onizuka&quot;, &quot;agent&quot; : &quot;Mozilla/5.0 (X11; Linux i686) AppleWebKit/534.24 (KHTML, like Gecko) Chrome/11.0.696.50 Safari/534.24&quot;, &quot;clientip&quot; : &quot;166.114.155.140&quot;, &quot;bytes&quot; : 6839, &quot;host&quot; : &quot;media-for-the-masses.theacademyofperformingartsandscience.org&quot;, &quot;request&quot; : &quot;/uploads/laurel-b-clark.jpg&quot;, &quot;url&quot; : &quot;https://media-for-the-masses.theacademyofperformingartsandscience.org/uploads/laurel-b-clark.jpg&quot;, &quot;@message&quot; : &quot;166.114.155.140 - - [2015-05-20T15:57:34.915Z] \&quot;GET /uploads/laurel-b-clark.jpg HTTP/1.1\&quot; 200 6839 \&quot;-\&quot; \&quot;Mozilla/5.0 (X11; Linux i686) AppleWebKit/534.24 (KHTML, like Gecko) Chrome/11.0.696.50 Safari/534.24\&quot;&quot;, &quot;spaces&quot; : &quot;this is a thing with lots of spaces wwwwoooooo&quot;, &quot;xss&quot; : &quot;&lt;script&gt;console.log(\&quot;xss\&quot;)&lt;/script&gt;&quot;, &quot;headings&quot; : [&quot;&lt;h3&gt;daniel-burbank&lt;/h5&gt;&quot;, &quot;http://twitter.com/success/john-grunsfeld&quot;], &quot;links&quot; : [&quot;terry-virts@www.slate.com&quot;, &quot;http://www.slate.com/info/curtis-brown&quot;, &quot;www.www.slate.com&quot;], &quot;relatedContent&quot; : [], &quot;machine&quot; : { &quot;os&quot; : &quot;win xp&quot;, &quot;ram&quot; : 32212254720 }, &quot;@version&quot; : &quot;1&quot; }]}] java.lang.ClassCastException: null 2016-04-28 13:08:41,244 TRACE [elasticsearch[localhost][index][T#4]] TransportReplicationAction.java:542 finishAsFailed [localhost] operation failed java.lang.ClassCastException: null 2016-04-28 13:08:41,244 TRACE [elasticsearch[localhost][index][T#4]] ChildMemoryCircuitBreaker.java:182 addWithoutBreaking [localhost] [request] Adjusted breaker by [16440] bytes, now [16440] 2016-04-28 13:08:41,245 INFO [elasticsearch[localhost][index][T#4]] BytesRestResponse.java:131 convert /logstash_20150520/log/test Params: {id=test, index=logstash_20150520, type=log} java.lang.ClassCastException: null ###### ######## END ERROR These are the index definition of Elasticsearch and the Keyspace definition of Cassandra *****\* ELASTICSEARCH INDEX ****** &quot;logstash_20150520&quot; : { &quot;state&quot; : &quot;open&quot;, &quot;settings&quot; : { &quot;index&quot; : { &quot;creation_date&quot; : &quot;1461776568462&quot;, &quot;uuid&quot; : &quot;yx1IPFnmT5icKYTcMfZh7w&quot;, &quot;number_of_replicas&quot; : &quot;0&quot;, &quot;number_of_shards&quot; : &quot;1&quot;, &quot;version&quot; : { &quot;created&quot; : &quot;2010199&quot; } } }, &quot;mappings&quot; : { &quot;log&quot; : { &quot;properties&quot; : { &quot;spaces&quot; : { &quot;type&quot; : &quot;string&quot; }, &quot;relatedContent&quot; : { &quot;properties&quot; : { &quot;articleTag&quot; : { &quot;type&quot; : &quot;string&quot; }, &quot;twitterCard&quot; : { &quot;type&quot; : &quot;string&quot; }, &quot;ogImageHeight&quot; : { &quot;type&quot; : &quot;string&quot; }, &quot;articlePublished_time&quot; : { &quot;format&quot; : &quot;strict_date_optional_time||epoch_millis&quot;, &quot;type&quot; : &quot;date&quot; }, &quot;twitterSite&quot; : { &quot;type&quot; : &quot;string&quot; }, &quot;ogDescription&quot; : { &quot;type&quot; : &quot;string&quot; }, &quot;url&quot; : { &quot;type&quot; : &quot;string&quot; }, &quot;articleModified_time&quot; : { &quot;format&quot; : &quot;strict_date_optional_time||epoch_millis&quot;, &quot;type&quot; : &quot;date&quot; }, &quot;ogType&quot; : { &quot;type&quot; : &quot;string&quot; }, &quot;twitterImage&quot; : { &quot;type&quot; : &quot;string&quot; }, &quot;ogImageWidth&quot; : { &quot;type&quot; : &quot;string&quot; }, &quot;ogUrl&quot; : { &quot;type&quot; : &quot;string&quot; }, &quot;ogTitle&quot; : { &quot;type&quot; : &quot;string&quot; }, &quot;ogImage&quot; : { &quot;type&quot; : &quot;string&quot; }, &quot;twitterTitle&quot; : { &quot;type&quot; : &quot;string&quot; }, &quot;ogSite_name&quot; : { &quot;type&quot; : &quot;string&quot; }, &quot;twitterDescription&quot; : { &quot;type&quot; : &quot;string&quot; }, &quot;articleSection&quot; : { &quot;type&quot; : &quot;string&quot; } } }, &quot;@message&quot; : { &quot;type&quot; : &quot;string&quot; }, &quot;bytes&quot; : { &quot;type&quot; : &quot;long&quot; }, &quot;geo&quot; : { &quot;properties&quot; : { &quot;dest&quot; : { &quot;type&quot; : &quot;string&quot; }, &quot;src&quot; : { &quot;type&quot; : &quot;string&quot; }, &quot;coordinates&quot; : { &quot;type&quot; : &quot;geo_point&quot; }, &quot;srcdest&quot; : { &quot;type&quot; : &quot;string&quot; } } }, &quot;host&quot; : { &quot;type&quot; : &quot;string&quot; }, &quot;clientip&quot; : { &quot;type&quot; : &quot;string&quot; }, &quot;@tags&quot; : { &quot;type&quot; : &quot;string&quot; }, &quot;xss&quot; : { &quot;type&quot; : &quot;string&quot; }, &quot;utc_time&quot; : { &quot;format&quot; : &quot;strict_date_optional_time||epoch_millis&quot;, &quot;type&quot; : &quot;date&quot; }, &quot;links&quot; : { &quot;type&quot; : &quot;string&quot; }, &quot;machine&quot; : { &quot;properties&quot; : { &quot;os&quot; : { &quot;type&quot; : &quot;string&quot; }, &quot;ram&quot; : { &quot;type&quot; : &quot;long&quot; } } }, &quot;@version&quot; : { &quot;type&quot; : &quot;string&quot; }, &quot;agent&quot; : { &quot;type&quot; : &quot;string&quot; }, &quot;url&quot; : { &quot;type&quot; : &quot;string&quot; }, &quot;memory&quot; : { &quot;type&quot; : &quot;long&quot; }, &quot;phpmemory&quot; : { &quot;type&quot; : &quot;long&quot; }, &quot;ip&quot; : { &quot;type&quot; : &quot;string&quot; }, &quot;response&quot; : { &quot;type&quot; : &quot;string&quot; }, &quot;extension&quot; : { &quot;type&quot; : &quot;string&quot; }, &quot;headings&quot; : { &quot;type&quot; : &quot;string&quot; }, &quot;@timestamp&quot; : { &quot;format&quot; : &quot;strict_date_optional_time||epoch_millis&quot;, &quot;type&quot; : &quot;date&quot; }, &quot;request&quot; : { &quot;type&quot; : &quot;string&quot; }, &quot;referer&quot; : { &quot;type&quot; : &quot;string&quot; } } } }, &quot;aliases&quot; : [ ] }, *****\* CASSANDRA KEYSPACE ****** CREATE KEYSPACE logstash_20150520 WITH replication = {'class': 'NetworkTopologyStrategy', 'dc1': '1'} AND durable_writes = true; CREATE TYPE logstash_20150520.log_geo_coordinates ( lat double, lon double ); CREATE TYPE logstash_20150520.log_geo ( coordinates frozen&lt;list&lt;frozen&lt;log_geo_coordinates&gt;&gt;&gt;, srcdest frozen&lt;list&lt;text&gt;&gt;, dest frozen&lt;list&lt;text&gt;&gt;, src frozen&lt;list&lt;text&gt;&gt; ); CREATE TYPE logstash_20150520.log_machine ( ram frozen&lt;list&lt;bigint&gt;&gt;, os frozen&lt;list&lt;text&gt;&gt; ); CREATE TYPE logstash_20150520.&quot;log_relatedContent&quot; ( &quot;ogDescription&quot; frozen&lt;list&lt;text&gt;&gt;, &quot;twitterDescription&quot; frozen&lt;list&lt;text&gt;&gt;, &quot;ogSite_name&quot; frozen&lt;list&lt;text&gt;&gt;, &quot;articleSection&quot; frozen&lt;list&lt;text&gt;&gt;, &quot;articlePublished_time&quot; frozen&lt;list&lt;timestamp&gt;&gt;, &quot;twitterSite&quot; frozen&lt;list&lt;text&gt;&gt;, &quot;ogTitle&quot; frozen&lt;list&lt;text&gt;&gt;, &quot;twitterTitle&quot; frozen&lt;list&lt;text&gt;&gt;, &quot;twitterImage&quot; frozen&lt;list&lt;text&gt;&gt;, &quot;ogImageHeight&quot; frozen&lt;list&lt;text&gt;&gt;, &quot;articleModified_time&quot; frozen&lt;list&lt;timestamp&gt;&gt;, url frozen&lt;list&lt;text&gt;&gt;, &quot;ogType&quot; frozen&lt;list&lt;text&gt;&gt;, &quot;ogUrl&quot; frozen&lt;list&lt;text&gt;&gt;, &quot;ogImageWidth&quot; frozen&lt;list&lt;text&gt;&gt;, &quot;ogImage&quot; frozen&lt;list&lt;text&gt;&gt;, &quot;twitterCard&quot; frozen&lt;list&lt;text&gt;&gt;, &quot;articleTag&quot; frozen&lt;list&lt;text&gt;&gt; ); CREATE TABLE logstash_20150520.log ( &quot;_id&quot; text PRIMARY KEY, &quot;@message&quot; list&lt;text&gt;, &quot;@tags&quot; list&lt;text&gt;, &quot;@timestamp&quot; list&lt;timestamp&gt;, &quot;@version&quot; list&lt;text&gt;, agent list&lt;text&gt;, bytes list&lt;bigint&gt;, clientip list&lt;text&gt;, extension list&lt;text&gt;, geo list&lt;frozen&lt;log_geo&gt;&gt;, headings list&lt;text&gt;, host list&lt;text&gt;, ip list&lt;text&gt;, links list&lt;text&gt;, machine list&lt;frozen&lt;log_machine&gt;&gt;, memory list&lt;bigint&gt;, phpmemory list&lt;bigint&gt;, referer list&lt;text&gt;, &quot;relatedContent&quot; list&lt;frozen&lt;log_relatedContent&gt;&gt;, request list&lt;text&gt;, response list&lt;text&gt;, spaces list&lt;text&gt;, url list&lt;text&gt;, utc_time list&lt;timestamp&gt;, xss list&lt;text&gt; ) WITH bloom_filter_fp_chance = 0.01 AND caching = '{&quot;keys&quot;:&quot;ALL&quot;, &quot;rows_per_partition&quot;:&quot;NONE&quot;}' AND comment = 'Auto-created by Elassandra' AND compaction = {'class': 'org.apache.cassandra.db.compaction.SizeTieredCompactionStrategy'} AND compression = {'sstable_compression': 'org.apache.cassandra.io.compress.LZ4Compressor'} AND dclocal_read_repair_chance = 0.1 AND default_time_to_live = 0 AND gc_grace_seconds = 864000 AND max_index_interval = 2048 AND memtable_flush_period_in_ms = 0 AND min_index_interval = 128 AND read_repair_chance = 0.0 AND speculative_retry = '99.0PERCENTILE'; CREATE CUSTOM INDEX elastic_log_xss_idx ON logstash_20150520.log (xss) USING 'org.elasticsearch.cassandra.ElasticSecondaryIndex'; CREATE CUSTOM INDEX elastic_log_host_idx ON logstash_20150520.log (host) USING 'org.elasticsearch.cassandra.ElasticSecondaryIndex'; CREATE CUSTOM INDEX elastic_log__message_idx ON logstash_20150520.log (&quot;@message&quot;) USING 'org.elasticsearch.cassandra.ElasticSecondaryIndex'; CREATE CUSTOM INDEX elastic_log_extension_idx ON logstash_20150520.log (extension) USING 'org.elasticsearch.cassandra.ElasticSecondaryIndex'; CREATE CUSTOM INDEX elastic_log_clientip_idx ON logstash_20150520.log (clientip) USING 'org.elasticsearch.cassandra.ElasticSecondaryIndex'; CREATE CUSTOM INDEX elastic_log_spaces_idx ON logstash_20150520.log (spaces) USING 'org.elasticsearch.cassandra.ElasticSecondaryIndex'; CREATE CUSTOM INDEX elastic_log_bytes_idx ON logstash_20150520.log (bytes) USING 'org.elasticsearch.cassandra.ElasticSecondaryIndex'; CREATE CUSTOM INDEX elastic_log_url_idx ON logstash_20150520.log (url) USING 'org.elasticsearch.cassandra.ElasticSecondaryIndex'; CREATE CUSTOM INDEX elastic_log__version_idx ON logstash_20150520.log (&quot;@version&quot;) USING 'org.elasticsearch.cassandra.ElasticSecondaryIndex'; CREATE CUSTOM INDEX elastic_log_geo_idx ON logstash_20150520.log (geo) USING 'org.elasticsearch.cassandra.ElasticSecondaryIndex'; CREATE CUSTOM INDEX elastic_log_ip_idx ON logstash_20150520.log (ip) USING 'org.elasticsearch.cassandra.ElasticSecondaryIndex'; CREATE CUSTOM INDEX elastic_log_relatedContent_idx ON logstash_20150520.log (&quot;relatedContent&quot;) USING 'org.elasticsearch.cassandra.ElasticSecondaryIndex'; CREATE CUSTOM INDEX elastic_log_memory_idx ON logstash_20150520.log (memory) USING 'org.elasticsearch.cassandra.ElasticSecondaryIndex'; CREATE CUSTOM INDEX elastic_log__tags_idx ON logstash_20150520.log (&quot;@tags&quot;) USING 'org.elasticsearch.cassandra.ElasticSecondaryIndex'; CREATE CUSTOM INDEX elastic_log_request_idx ON logstash_20150520.log (request) USING 'org.elasticsearch.cassandra.ElasticSecondaryIndex'; CREATE CUSTOM INDEX elastic_log_machine_idx ON logstash_20150520.log (machine) USING 'org.elasticsearch.cassandra.ElasticSecondaryIndex'; CREATE CUSTOM INDEX elastic_log_response_idx ON logstash_20150520.log (response) USING 'org.elasticsearch.cassandra.ElasticSecondaryIndex'; CREATE CUSTOM INDEX elastic_log_headings_idx ON logstash_20150520.log (headings) USING 'org.elasticsearch.cassandra.ElasticSecondaryIndex'; CREATE CUSTOM INDEX elastic_log_referer_idx ON logstash_20150520.log (referer) USING 'org.elasticsearch.cassandra.ElasticSecondaryIndex'; CREATE CUSTOM INDEX elastic_log_links_idx ON logstash_20150520.log (links) USING 'org.elasticsearch.cassandra.ElasticSecondaryIndex'; CREATE CUSTOM INDEX elastic_log__timestamp_idx ON logstash_20150520.log (&quot;@timestamp&quot;) USING 'org.elasticsearch.cassandra.ElasticSecondaryIndex'; CREATE CUSTOM INDEX elastic_log_phpmemory_idx ON logstash_20150520.log (phpmemory) USING 'org.elasticsearch.cassandra.ElasticSecondaryIndex'; CREATE CUSTOM INDEX elastic_log_utc_time_idx ON logstash_20150520.log (utc_time) USING 'org.elasticsearch.cassandra.ElasticSecondaryIndex'; CREATE CUSTOM INDEX elastic_log_agent_idx ON logstash_20150520.log (agent) USING 'org.elasticsearch.cassandra.ElasticSecondaryIndex'; Maybe I'm doing something wrong? If I don't run the command for the geo_point creation on the Elasticsearch index, the bulk insert goes well but lat and lon are simply doubles (not geo coordinates) and kibana can't show them over the Map. Thanks. Alberto</DESCRIPTION>
  <REPONAME>elassandra</REPONAME>
  <TIMEDIFFERENCEDAYS>12</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Schema management refactoring</MESSAGE>
    <SHA>71b324108f7af25b8b488a076304b24631f6970e</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Add jenkins CI (#16)</MESSAGE>
      <SHA>44ed3f59e2a5e7f74f08436bba201f350ab90860</SHA>
      <PATCHEDFILES>
        <FILE>build.gradle</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
