<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>183</ISSUENO>
  <ISSUEURL>https://github.com/strapdata/elassandra/issues/183</ISSUEURL>
  <TITLE>Elasticsearch refuses to work when listen_address differs from broadcast_address</TITLE>
  <DESCRIPTION>I'm using Elassandra 5.5.0.14 (installed via .deb), and I setup up an 3-node cluster. However, when I try to run the example: ``` $ curl -XPUT 'http://whirlpool-elassandra-fmt01-01-15-1.f3w.net:9200/twitter/doc/1?pretty' -H 'Content-Type: application/json' -d ' &gt; { &gt; &quot;user&quot;: &quot;Poulpy&quot;, &gt; &quot;post_date&quot;: &quot;2017/10/4 13:12:00&quot;, &gt; &quot;message&quot;: &quot;Elassandra adds dynamic mapping to Cassandra&quot; &gt; }' ``` The terminal is stuck, and the `system.log` emits: ``` 2018-04-08 09:01:46,502 INFO [elasticsearch[64.71.145.11][clusterService#updateTask][T#1]] MigrationManager.java:331 announceNewKeyspace Create new Keyspace: KeyspaceMetadata{name=twitter, params=KeyspaceParams{durable_writes=true, replication=ReplicationParams{class=org.apache.cassandra.locator.NetworkTopologyStrategy, fmt01=1}}, tables=[], views=[], functions=[], types=[]} 2018-04-08 09:01:50,264 WARN [elasticsearch[64.71.145.11][clusterService#updateTask][T#1]] IndexRoutingTable.java:380 &lt;init&gt; Keyspace not available: java.lang.AssertionError 2018-04-08 09:01:50,273 ERROR [elasticsearch[64.71.145.11][clusterService#updateTask][T#1]] ClusterService.java:1542 publishAndApplyChanges Cassandra issue: java.lang.NullPointerException: null at org.elassandra.discovery.CassandraDiscovery.isNormal(CassandraDiscovery.java:519) at org.elassandra.discovery.CassandraDiscovery.access$900(CassandraDiscovery.java:90) at org.elassandra.discovery.CassandraDiscovery$MetaDataVersionAckListener.lambda$new$0(CassandraDiscovery.java:479) at java.lang.Iterable.forEach(Iterable.java:75) at org.elassandra.discovery.CassandraDiscovery$MetaDataVersionAckListener.&lt;init&gt;(CassandraDiscovery.java:476) at org.elasticsearch.cluster.service.ClusterService.publishAndApplyChanges(ClusterService.java:1487) at org.elasticsearch.cluster.service.BaseClusterService.runTasks(BaseClusterService.java:583) at org.elasticsearch.cluster.service.BaseClusterService$ClusterServiceTaskBatcher.run(BaseClusterService.java:263) at org.elasticsearch.cluster.service.TaskBatcher.runIfNotProcessed(TaskBatcher.java:150) at org.elasticsearch.cluster.service.TaskBatcher$BatchedTask.run(TaskBatcher.java:188) at org.elasticsearch.cluster.service.BaseClusterService$ClusterServiceTaskBatcher$UpdateTask.run(BaseClusterService.java:266) at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:569) at org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.runAndClean(PrioritizedEsThreadPoolExecutor.java:247) at org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.run(PrioritizedEsThreadPoolExecutor.java:210) at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) at java.lang.Thread.run(Thread.java:748) ``` Eventually, `curl` returns an error: ``` { &quot;error&quot; : { &quot;root_cause&quot; : [ { &quot;type&quot; : &quot;index_not_found_exception&quot;, &quot;reason&quot; : &quot;no such index&quot;, &quot;resource.type&quot; : &quot;index_expression&quot;, &quot;resource.id&quot; : &quot;twitter&quot;, &quot;index_uuid&quot; : &quot;_na_&quot;, &quot;index&quot; : &quot;twitter&quot; } ], &quot;type&quot; : &quot;index_not_found_exception&quot;, &quot;reason&quot; : &quot;no such index&quot;, &quot;resource.type&quot; : &quot;index_expression&quot;, &quot;resource.id&quot; : &quot;twitter&quot;, &quot;index_uuid&quot; : &quot;_na_&quot;, &quot;index&quot; : &quot;twitter&quot; }, &quot;status&quot; : 404 } ``` `/_cluster/state`: ``` { &quot;cluster_name&quot; : &quot;Whirlpool&quot;, &quot;version&quot; : 10, &quot;state_uuid&quot; : &quot;UY-PxoWiTIGw6xrSep9jLw&quot;, &quot;master_node&quot; : &quot;81923937-6b7b-4f4e-836c-728a69aa50f3&quot;, &quot;blocks&quot; : { }, &quot;nodes&quot; : { &quot;a9ade22a-4ffb-47bd-9087-c8e635af995c&quot; : { &quot;name&quot; : &quot;2001:470:1:298:c:a:a:0&quot;, &quot;status&quot; : &quot;ALIVE&quot;, &quot;ephemeral_id&quot; : &quot;a9ade22a-4ffb-47bd-9087-c8e635af995c&quot;, &quot;transport_address&quot; : &quot;64.71.145.10:9300&quot;, &quot;attributes&quot; : { &quot;rack&quot; : &quot;01-15&quot;, &quot;dc&quot; : &quot;fmt01&quot; } }, &quot;3be98785-40dc-44d9-b13f-06603e4f0f5d&quot; : { &quot;name&quot; : &quot;2001:470:1:298:c:a:a:1&quot;, &quot;status&quot; : &quot;ALIVE&quot;, &quot;ephemeral_id&quot; : &quot;3be98785-40dc-44d9-b13f-06603e4f0f5d&quot;, &quot;transport_address&quot; : &quot;64.71.145.11:9300&quot;, &quot;attributes&quot; : { &quot;rack&quot; : &quot;01-15&quot;, &quot;dc&quot; : &quot;fmt01&quot; } }, &quot;81923937-6b7b-4f4e-836c-728a69aa50f3&quot; : { &quot;name&quot; : &quot;64.71.145.12&quot;, &quot;status&quot; : &quot;ALIVE&quot;, &quot;ephemeral_id&quot; : &quot;81923937-6b7b-4f4e-836c-728a69aa50f3&quot;, &quot;transport_address&quot; : &quot;64.71.145.12:9300&quot;, &quot;attributes&quot; : { &quot;rack&quot; : &quot;01-15&quot;, &quot;dc&quot; : &quot;fmt01&quot; } } }, &quot;metadata&quot; : { &quot;version&quot; : 0, &quot;cluster_uuid&quot; : &quot;a9ade22a-4ffb-47bd-9087-c8e635af995c&quot;, &quot;templates&quot; : { }, &quot;indices&quot; : { }, &quot;index-graveyard&quot; : { &quot;tombstones&quot; : [ ] } }, &quot;routing_table&quot; : { &quot;indices&quot; : { } }, &quot;routing_nodes&quot; : { &quot;unassigned&quot; : [ ], &quot;nodes&quot; : { &quot;3be98785-40dc-44d9-b13f-06603e4f0f5d&quot; : [ ], &quot;a9ade22a-4ffb-47bd-9087-c8e635af995c&quot; : [ ], &quot;81923937-6b7b-4f4e-836c-728a69aa50f3&quot; : [ ] } } } ``` `nodetool describecluster`: ``` # nodetool describecluster Cluster Information: Name: Whirlpool Snitch: org.apache.cassandra.locator.GossipingPropertyFileSnitch DynamicEndPointSnitch: enabled Partitioner: org.apache.cassandra.dht.Murmur3Partitioner Schema versions: 3d4b194d-69e2-3d97-b0d0-ae36e5587409: [2001:470:1:298:c:a:a:0, 2001:470:1:298:c:a:a:1, 2001:470:1:298:c:a:a:2] ``` Please advise.</DESCRIPTION>
  <REPONAME>elassandra</REPONAME>
  <TIMEDIFFERENCEDAYS>26</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>#187 refactoring of partitionDelete</MESSAGE>
    <SHA>b879987392f2b6530578a5a4ca5a274e6c0af7ed</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fix #183 properly</MESSAGE>
      <SHA>8ffee9e62e48c83212b3ee8c5750983d0bba90a4</SHA>
      <PATCHEDFILES>
        <FILE>core/src/main/java/org/elassandra/discovery/CassandraDiscovery.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
