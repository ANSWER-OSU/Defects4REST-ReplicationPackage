<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>14983</ISSUENO>
  <ISSUEURL>https://github.com/TryGhost/Ghost/issues/14983</ISSUEURL>
  <TITLE>[Content API] Url set to 404 for tags when using multiple fields</TITLE>
  <DESCRIPTION>### Issue Summary When using multiple [fields](https://ghost.org/docs/content-api/#fields) on the Content API, the tag URLs are set to `https://demo.ghost.io/404/` instead of their corresponding URL. ### Steps to Reproduce ✅ https://demo.ghost.io/ghost/api/content/tags/?key=22444f78447824223cefc48062&amp;filter=visibility%3Apublic&amp;fields=name ```json { &quot;tags&quot;: [ { &quot;name&quot;: &quot;Fables&quot; }, { &quot;name&quot;: &quot;Fiction&quot; }, { &quot;name&quot;: &quot;Getting Started&quot; }, { &quot;name&quot;: &quot;Speeches&quot; } ], &quot;meta&quot;: { &quot;pagination&quot;: { &quot;page&quot;: 1, &quot;limit&quot;: 15, &quot;pages&quot;: 1, &quot;total&quot;: 8, &quot;next&quot;: null, &quot;prev&quot;: null } } } ``` ✅ https://demo.ghost.io/ghost/api/content/tags/?key=22444f78447824223cefc48062&amp;filter=visibility%3Apublic&amp;fields=url ```json { &quot;tags&quot;: [ { &quot;url&quot;: &quot;https://demo.ghost.io/tag/fables/&quot; }, { &quot;url&quot;: &quot;https://demo.ghost.io/tag/fiction/&quot; }, { &quot;url&quot;: &quot;https://demo.ghost.io/tag/getting-started/&quot; }, { &quot;url&quot;: &quot;https://demo.ghost.io/tag/speeches/&quot; } ], &quot;meta&quot;: { &quot;pagination&quot;: { &quot;page&quot;: 1, &quot;limit&quot;: 15, &quot;pages&quot;: 1, &quot;total&quot;: 8, &quot;next&quot;: null, &quot;prev&quot;: null } } } ``` ❌ https://demo.ghost.io/ghost/api/content/tags/?key=22444f78447824223cefc48062&amp;filter=visibility%3Apublic&amp;fields=name,url ❌ https://demo.ghost.io/ghost/api/content/tags/?key=22444f78447824223cefc48062&amp;filter=visibility%3Apublic&amp;fields=url,name ❌ https://demo.ghost.io/ghost/api/content/tags/?key=22444f78447824223cefc48062&amp;filter=visibility%3Apublic&amp;fields=name%2Curl ❌ https://demo.ghost.io/ghost/api/content/tags/?key=22444f78447824223cefc48062&amp;filter=visibility%3Apublic&amp;fields=url%2Cname ```json { &quot;tags&quot;: [ { &quot;name&quot;: &quot;Fables&quot;, &quot;url&quot;: &quot;https://demo.ghost.io/404/&quot; }, { &quot;name&quot;: &quot;Fiction&quot;, &quot;url&quot;: &quot;https://demo.ghost.io/404/&quot; }, { &quot;name&quot;: &quot;Getting Started&quot;, &quot;url&quot;: &quot;https://demo.ghost.io/404/&quot; }, { &quot;name&quot;: &quot;Speeches&quot;, &quot;url&quot;: &quot;https://demo.ghost.io/404/&quot; } ], &quot;meta&quot;: { &quot;pagination&quot;: { &quot;page&quot;: 1, &quot;limit&quot;: 15, &quot;pages&quot;: 1, &quot;total&quot;: 8, &quot;next&quot;: null, &quot;prev&quot;: null } } } ``` ### Ghost Version 5.2.3 ### Node.js Version 16 ### How did you install Ghost? Docker ### Database type MySQL 8 ### Browser &amp; OS version _No response_ ### Relevant log / error output _No response_ ### Code of Conduct - [X] I agree to be friendly and polite to people in this repository</DESCRIPTION>
  <REPONAME>Ghost</REPONAME>
  <TIMEDIFFERENCEDAYS>10</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Updated support email verification flow (#15029) refs https://github.com/TryGhost/Team/issues/584 The current support email verification flow uses an API endpoint as verification URL inside the emails. This is a bad pattern, and also has the side effect that it shows a JSON error if something goes wrong. To fix this, this commit updates the whole flow to use the same pattern as newsletters: - You can update the `members_support_address` setting directly via the edit endpoint of settings. - Changes to that (and future 'guarded' email properties) are blocked and generate verification emails automatically. - When an email verification has been sent, the meta property `sent_email_verification` is set. Other changes: - Underlying, the implementation of email verificaton has moved from the (old) members service to the settings BREAD service. This makes it easier to add extra email addresses in settings later on that are not related to 'members'. - Now you can update the `members_support_address` by updating the settings directly, so the `updateMembersEmail` endpoint has been deprecated and is mapped to the new behaviour. - The SingleUseTokenProvider threw a `UnauthorizedError` error if a token was expired or invalid. Those errors are caught by the admin app, and causes it to do a page reload (making the error message and modals invisible). To fix that, I've swapped it with a validation error. Future changes: - Existing emails that have been sent 24h before this change is applied, still use the `validateMembersEmailUpdate` API endpoint. This endpoint has not been removed for now, to not break those emails. In a future release, we should remove this. Changes to admin: https://github.com/TryGhost/Admin/pull/2426</MESSAGE>
    <SHA>c6621dc17d86981b68b779ffb9589d70b0d58d7e</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fixed tag url field when explicitly querying fields refs https://github.com/TryGhost/Ghost/issues/14983 The url field of tags is read dynamically from the url service, rather than from the database. The lookup requires the id of the tag, which was missing from the model when asking for explicit fields which didn't include id. By adding the id as a default column to fetch, we know for sure that we will always have the necessary data to read the url.</MESSAGE>
      <SHA>feaf5d0c917a36444ea00843395b40f108dfba96</SHA>
      <PATCHEDFILES>
        <FILE>core/server/models/tag.js</FILE>
        <FILE>test/e2e-api/content/tags.test.js</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
