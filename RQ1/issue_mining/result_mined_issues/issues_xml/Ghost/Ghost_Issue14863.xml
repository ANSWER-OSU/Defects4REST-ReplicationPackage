<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>14863</ISSUENO>
  <ISSUEURL>https://github.com/TryGhost/Ghost/issues/14863</ISSUEURL>
  <TITLE>Ghost URL cannot be set to an ipv6 address</TITLE>
  <DESCRIPTION>### Issue Summary The URL cannot be set to an ipv6 address, because ghost percent encodes the bracketed portion of the host. ### Steps to Reproduce Start a docker container with the url set to a properly formatted ipv6 address like `-e url='http://[ffff::]:2368'`. Notice that the Home and About links at the top are not clickable. Inspect them and see that the URL is badly formatted: the host portion should not be percent encoded. If we edit the IP to be literal brackets the link will work. ![image](https://user-images.githubusercontent.com/4633048/169271824-57dd3d2e-e341-41fb-bc1f-b92707c09540.png) ### Ghost Version 4.47.4 ### Node.js Version v14.19.3 ### How did you install Ghost? docker ### Database type SQLite3 ### Browser &amp; OS version _No response_ ### Relevant log / error output _No response_ ### Code of Conduct - [X] I agree to be friendly and polite to people in this repository</DESCRIPTION>
  <REPONAME>Ghost</REPONAME>
  <TIMEDIFFERENCEDAYS>112</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Added snapshot tests to ghost_head helper (#15327) refs https://github.com/TryGhost/Team/issues/1795 - Snapshots help us detect unexpected changes in the `&lt;head&gt;` of all sites (e.g., newly introduced script tags) - Added ghost_head tests for comment count helper</MESSAGE>
    <SHA>6bffa893b18b3454660662a0c0f9d3487da1e9cb</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fixed square brackets being % encoded in URLs (#14977) fixes: #14863 refs: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURI#encoding_for_ipv6 - added a simple Regex replace for the percent-encoded square brackets to get them back to non-encoded - a preferred solution might be using new URL(), but that causes other issues. The regex solves the immediate need.</MESSAGE>
      <SHA>dc84983550cd09c915cd87104a1f80c1df93e5eb</SHA>
      <PATCHEDFILES>
        <FILE>ghost/core/core/frontend/helpers/url.js</FILE>
        <FILE>ghost/core/test/unit/frontend/helpers/url.test.js</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
