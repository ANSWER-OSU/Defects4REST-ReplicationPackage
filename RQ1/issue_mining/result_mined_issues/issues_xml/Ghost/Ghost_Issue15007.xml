<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>15007</ISSUENO>
  <ISSUEURL>https://github.com/TryGhost/Ghost/issues/15007</ISSUEURL>
  <TITLE>Cannot get reading time from API via ?fields param</TITLE>
  <DESCRIPTION>### Issue Summary When making a request to the Content API for posts and including `reading_time` as a field, it is not returned. ### Steps to Reproduce Request the demo site with `reading_time`: https://demo.ghost.io/ghost/api/canary/content/posts/?key=22444f78447824223cefc48062&amp;fields=title,url,reading_time Note that it does work if you include the `html` field, which reading time is calculated based on. https://demo.ghost.io/ghost/api/canary/content/posts/?key=22444f78447824223cefc48062&amp;fields=title,url,reading_time,html ### Ghost Version 5.2 ### Node.js Version 14 ### How did you install Ghost? ghost cli ### Database type MySQL 8 ### Browser &amp; OS version N/a ### Relevant log / error output ```shell n/a ``` ### Code of Conduct - [X] I agree to be friendly and polite to people in this repository</DESCRIPTION>
  <REPONAME>Ghost</REPONAME>
  <TIMEDIFFERENCEDAYS>590</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Fixed returning reading_time when html field is not sent - The logic to add the reading_time attribute has been moved to serializers/output/mappers/posts.js - Added a new method `getPostHtmlById` in posts-service.js, used to get the html field of a post - The mapper will use the `html` field from the attributes if it's been requested via query params, otherwise it'll fetch it using getPostHtmlById</MESSAGE>
    <SHA>74b2f6e9faa2093c0058a13c829d15d2fbdb9a6b</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Added e2e test &quot;Can return reading_time without using the html&quot; refs #15007</MESSAGE>
      <SHA>73fcd4d9675263b999cdf2492a226bc9eebfa119</SHA>
      <PATCHEDFILES>
        <FILE>test/e2e-api/content/__snapshots__/posts.test.js.snap</FILE>
        <FILE>test/e2e-api/content/posts.test.js</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fixed returning reading_time when html field is not sent refs #15007 - Added `requiredForReadingTime` to force-adding the `html` column when `reading_time` has been requested without `html` - Edited the extra-attrs util to delete the `html` attribute when it's not been requested together with `reading_time` and viceversa - Added e2e test in the post content API tests suite</MESSAGE>
      <SHA>017c22190817a1eab4c3d506bc9fe103e2027266</SHA>
      <PATCHEDFILES>
        <FILE>core/server/api/endpoints/utils/serializers/output/utils/extra-attrs.js</FILE>
        <FILE>core/server/models/base/plugins/crud.js</FILE>
        <FILE>test/e2e-api/content/__snapshots__/posts.test.js.snap</FILE>
        <FILE>test/e2e-api/content/posts.test.js</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
