<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>7750</ISSUENO>
  <ISSUEURL>https://github.com/vercel/vercel/issues/7750</ISSUEURL>
  <TITLE>[Monorepo Detection] Add readdir and chdir functions to DetectorFilesystem</TITLE>
  <DESCRIPTION>In order to support various `fs` operations for monorepo detection, the team needs to add two new abstract functions to `DetectorFilesystem` in order to traverse down into children directories * readdir * chdir ```ts interface Stat { name: string path: string type: &quot;file&quot; | &quot;dir&quot; } export abstract class DetectorFilesystem { ... /** * Returns a list of Stat objects from the current working directory. * * @example * * const url = &quot;https://github.com/vercel/front&quot; * const fs = new GitDetectorFilesystem(...) // based on url * * // calls &quot;https://api.github.com/repos/vercel/front/contents&quot; behind the scenes * await fs.readdir() =&gt; [ * { name: &quot;docs&quot;, path: &quot;docs&quot;, type: &quot;dir&quot; }, * { name: &quot;front&quot;, path: &quot;front&quot;, type: &quot;dir&quot; }, * ..., * { name: &quot;package.json&quot;, path: &quot;package.json&quot;, type: &quot;file&quot; }, * ] */ protected abstract _readdir(name: string): Promise&lt;Stat[]&gt;; /** * Changes the current directory to the specified path and returns a new instance of DetectorFilesystem. * * @example * * my-repo * |-- backend * | |-- api-1 * | |-- api-2 * | |-- package.json // workspaces: [&quot;api-1&quot;, &quot;api-2&quot;] * | |-- yarn.lock * |-- frontend * | |-- nextjs-app * | |-- gatsby-app * | |-- package.json * | |-- pnpm-workspaces.yaml // packages: [&quot;nextjs-app&quot;, &quot;gatsby-app&quot;] * * const fs = new (...) // based on &quot;my-repo&quot; as the root * const backendFs = fs.chdir(&quot;backend&quot;) * const frontendFs = fs.chdir(&quot;frontend&quot;) * * const backendWorkspaceManager = detectFramework({ fs: backendFs, frameworkList: workspaceManagers }) // &quot;yarn&quot; * const frontendWorkspaceManager = detectFramework({ fs: frontendFs, frameworkList: workspaceManagers }) // &quot;pnpm&quot; */ protected abstract _chdir(name: string): DetectorFilesystem ... } ```</DESCRIPTION>
  <REPONAME>vercel</REPONAME>
  <TIMEDIFFERENCEDAYS>5</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Publish Stable - @vercel/build-utils@2.17.0 - vercel@24.2.1 - @vercel/client@11.0.1 - @vercel/frameworks@0.9.0 - @vercel/go@1.4.1 - @vercel/node@1.15.1 - @vercel/python@2.3.1 - @vercel/redwood@0.8.1 - @vercel/ruby@1.3.4 - @vercel/static-build@0.24.1</MESSAGE>
    <SHA>15c7ad241a44d037ceed0101b89e3a73f09fab2b</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>[build-utils] Add readdir and chdir functions to DetectorFilesystem (#7751) In order to support various `fs` operations for monorepo detection, the team needs to add two new abstract functions to `DetectorFilesystem` in order to traverse down into children directories * readdir * chdir ```ts interface Stat { name: string path: string type: &quot;file&quot; | &quot;dir&quot; } export abstract class DetectorFilesystem { ... /** * Returns a list of Stat objects from the current working directory. * * @example * * const url = &quot;https://github.com/vercel/front&quot; * const fs = new GitDetectorFilesystem(...) // based on url * * // calls &quot;https://api.github.com/repos/vercel/front/contents&quot; behind the scenes * await fs.readdir() =&gt; [ * { name: &quot;docs&quot;, path: &quot;docs&quot;, type: &quot;dir&quot; }, * { name: &quot;front&quot;, path: &quot;front&quot;, type: &quot;dir&quot; }, * ..., * { name: &quot;package.json&quot;, path: &quot;package.json&quot;, type: &quot;file&quot; }, * ] */ protected abstract _readdir(name: string): Promise&lt;Stat[]&gt;; /** * Changes the current directory to the specified path and returns a new instance of DetectorFilesystem. * * @example * * my-repo * |-- backend * | |-- api-1 * | |-- api-2 * | |-- package.json // workspaces: [&quot;api-1&quot;, &quot;api-2&quot;] * | |-- yarn.lock * |-- frontend * | |-- nextjs-app * | |-- gatsby-app * | |-- package.json * | |-- pnpm-workspaces.yaml // packages: [&quot;nextjs-app&quot;, &quot;gatsby-app&quot;] * * const fs = new (...) // based on &quot;my-repo&quot; as the root * const backendFs = fs.chdir(&quot;backend&quot;) * const frontendFs = fs.chdir(&quot;frontend&quot;) * * const backendWorkspaceManager = detectFramework({ fs: backendFs, frameworkList: workspaceManagers }) // &quot;yarn&quot; * const frontendWorkspaceManager = detectFramework({ fs: frontendFs, frameworkList: workspaceManagers }) // &quot;pnpm&quot; */ protected abstract _chdir(name: string): DetectorFilesystem ... } ``` ### Related Issues &gt; Related to https://github.com/vercel/vercel/issues/7750 ### Checklist &lt;!-- Please keep your PR as a Draft until the checklist is complete --&gt; #### Tests - [x] The code changed/added as part of this PR has been covered with tests - [x] All tests pass locally with `yarn test-unit` #### Code Review - [x] This PR has a concise title and thorough description useful to a reviewer - [x] Issue from task tracker has a link to this PR</MESSAGE>
      <SHA>505050b92313265adde6ae6041fe9cd29dd6168d</SHA>
      <PATCHEDFILES>
        <FILE>packages/build-utils/src/detectors/filesystem.ts</FILE>
        <FILE>packages/build-utils/test/unit.framework-detector.test.ts</FILE>
        <FILE>packages/build-utils/test/utils/fixture-filesystem.ts</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
