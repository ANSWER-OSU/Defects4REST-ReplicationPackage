<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>3099</ISSUENO>
  <ISSUEURL>https://github.com/vercel/vercel/issues/3099</ISSUEURL>
  <TITLE>Latest `now@16.3.0` broke `--local-config`</TITLE>
  <DESCRIPTION>Hi! Maybe someone already posted this but the last version of `now` broke deployments. It searching for a `build` in `package.json` but I think it's confusing the `package.json` from the workspace and doesn't think about the `package.json` for the actual builder. ``` &gt; Error! Your `package.json` file is missing a `build` property inside the `script` property. More details: https://zeit.co/docs/v2/advanced/platform/frequently-asked-questions#missing-build-script error Command failed with exit code 1. ``` I use a `json` file for `now --local-config` who specify the correct package. I didn't made a deployment since last week. And yes, there is a `build` into the `package.json` of the package. Everything were working perfectly fine during the last few months (even my last deployment last week), since this morning it's impossible with the latest version of `now`. I just updated this morning and now it's impossible to deploy. Even simple simples boilerplates from github. :/ Hope you'll fix it soon! Thx a lot for everything EDIT: Right now, I've downgrade to the 16.2.0 version to be able to deploy I've tested the 16.3.0 and there definitely an issue there :) Good luck to the team to fix it!</DESCRIPTION>
  <REPONAME>vercel</REPONAME>
  <TIMEDIFFERENCEDAYS>1</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Revert &quot;[tests] Add test all script&quot; since it runs on commit (#3108) Reverts #3106 from @MAPESO The tests seem to be running on each commit which is going to slow down development.</MESSAGE>
    <SHA>0af87dc2bef14e1368342482cf416e32055021b3</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>[now-cli][now-client] Add parameter `nowConfig` for custom now.json (#3110) When now-client was implemented, it did not work with `--local-config` flag from now-cli because the only parameters it looks at are the files in a directory. This fixes the regression in now@16.3.0 so that now-client can accept an optional `nowConfig` object or fallback to the `now.json` file. Fixes #3099 Fixes #3105 Fixes #3107 Fixes #3109 [PRODUCT-350] #close [PRODUCT-350]: https://zeit.atlassian.net/browse/PRODUCT-350</MESSAGE>
      <SHA>2791338e04b1cc1f5dafa355aa223d153e26e971</SHA>
      <PATCHEDFILES>
        <FILE>packages/now-cli/src/util/deploy/process-deployment.ts</FILE>
        <FILE>packages/now-cli/src/util/get-config.ts</FILE>
        <FILE>packages/now-cli/src/util/index.js</FILE>
        <FILE>packages/now-cli/test/helpers/prepare.js</FILE>
        <FILE>packages/now-cli/test/integration.js</FILE>
        <FILE>packages/now-client/src/create-deployment.ts</FILE>
        <FILE>packages/now-client/src/deploy.ts</FILE>
        <FILE>packages/now-client/src/types.ts</FILE>
        <FILE>packages/now-client/src/upload.ts</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>[now-cli][now-client] Fix `--local-config` flag and `files` key (#3117) This PR is a followup to #3110 that fixes the first deployment when using the `--local-config` flag and also fixes v1 deployments using the [`files`](https://zeit.co/docs/v1/features/configuration/#files-(array)) key. The tests have been adjusted so we don't regress in both cases. Fixes #3099 Fixes #3105 Fixes #3107 Fixes #3109 [PRODUCT-350] #close [PRODUCT-350]: https://zeit.atlassian.net/browse/PRODUCT-350</MESSAGE>
      <SHA>d9bb6c8a54b298b2cbd8420b366e7a4ae7029dcc</SHA>
      <PATCHEDFILES>
        <FILE>packages/now-cli/test/helpers/prepare.js</FILE>
        <FILE>packages/now-cli/test/integration.js</FILE>
        <FILE>packages/now-client/src/create-deployment.ts</FILE>
        <FILE>packages/now-client/src/deploy.ts</FILE>
        <FILE>packages/now-client/src/types.ts</FILE>
        <FILE>packages/now-client/src/utils/index.ts</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>[now-cli][now-client] Add parameter `nowConfig` for custom now.json (#3110) When now-client was implemented, it did not work with `--local-config` flag from now-cli because the only parameters it looks at are the files in a directory. This fixes the regression in now@16.3.0 so that now-client can accept an optional `nowConfig` object or fallback to the `now.json` file. Fixes #3099 Fixes #3105 Fixes #3107 Fixes #3109 [PRODUCT-350] #close [PRODUCT-350]: https://zeit.atlassian.net/browse/PRODUCT-350</MESSAGE>
      <SHA>6716fdd49b32e9ca30c1dee15f6b326b0cde46bf</SHA>
      <PATCHEDFILES>
        <FILE>packages/now-cli/src/util/deploy/process-deployment.ts</FILE>
        <FILE>packages/now-cli/src/util/get-config.ts</FILE>
        <FILE>packages/now-cli/src/util/index.js</FILE>
        <FILE>packages/now-cli/test/helpers/prepare.js</FILE>
        <FILE>packages/now-cli/test/integration.js</FILE>
        <FILE>packages/now-client/src/create-deployment.ts</FILE>
        <FILE>packages/now-client/src/deploy.ts</FILE>
        <FILE>packages/now-client/src/types.ts</FILE>
        <FILE>packages/now-client/src/upload.ts</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>[now-cli][now-client] Fix `--local-config` flag and `files` key (#3117) This PR is a followup to #3110 that fixes the first deployment when using the `--local-config` flag and also fixes v1 deployments using the [`files`](https://zeit.co/docs/v1/features/configuration/#files-(array)) key. The tests have been adjusted so we don't regress in both cases. Fixes #3099 Fixes #3105 Fixes #3107 Fixes #3109 [PRODUCT-350] #close [PRODUCT-350]: https://zeit.atlassian.net/browse/PRODUCT-350</MESSAGE>
      <SHA>e6692bb79b34a195f9d27007f2cdc256b1b2f3d8</SHA>
      <PATCHEDFILES>
        <FILE>packages/now-cli/test/helpers/prepare.js</FILE>
        <FILE>packages/now-cli/test/integration.js</FILE>
        <FILE>packages/now-client/src/create-deployment.ts</FILE>
        <FILE>packages/now-client/src/deploy.ts</FILE>
        <FILE>packages/now-client/src/types.ts</FILE>
        <FILE>packages/now-client/src/utils/index.ts</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
