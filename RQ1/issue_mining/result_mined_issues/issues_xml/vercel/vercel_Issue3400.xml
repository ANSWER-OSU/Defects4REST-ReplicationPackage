<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>3400</ISSUENO>
  <ISSUEURL>https://github.com/vercel/vercel/issues/3400</ISSUEURL>
  <TITLE>Error: EISDIR: illegal operation on a directory when deploying on Now</TITLE>
  <DESCRIPTION>A couple issues with now + next.js seem to be caused by this module when run with yarn workspaces and tracing out of the workspace root. Running locally is not an issue, but it fails on zeit now. - https://spectrum.chat/zeit/now/deployment-failed-error-eisdir-illegal-operation-on-a-directory~1610db37-38fa-4ac8-ab9f-dc25888ef18b - https://spectrum.chat/zeit/now/error-deploying-next-js-monorepo-on-now~99acb8f4-1648-4422-91ea-ca243195fbc4 [My log](https://gist.github.com/darknoon/bfa10f31b0f9054ce735a784fe12f10f)</DESCRIPTION>
  <REPONAME>vercel</REPONAME>
  <TIMEDIFFERENCEDAYS>36</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Fix unused pre-commit package overriding husky (#3405) Saw my `pre-commit` hook wasn't being triggered after running `yarn` and noticed it was due to an un-used `pre-commit` dependency in `now-cli` overriding the changes to my `.git/hooks/pre-commit` file done by `husky` **Note**: you will probably need to run `yarn install --force` after this is applied before the correct `pre-commit` changes are applied by `husky`</MESSAGE>
    <SHA>17687e9bcd9fa32e271849505fd666093d1788a8</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>[now-next] Handle symlinks in createPseudoLayer (#3404) This makes sure to handle symlinks created in mono repos while creating the zip for a lambda based page in Next.js Fixes #3400</MESSAGE>
      <SHA>500014f2fc4ef1d8348e01ba44ec1cd9889cd625</SHA>
      <PATCHEDFILES>
        <FILE>packages/now-build-utils/src/index.ts</FILE>
        <FILE>packages/now-next/src/index.ts</FILE>
        <FILE>packages/now-next/src/utils.ts</FILE>
        <FILE>packages/now-next/test/fixtures/09-yarn-workspaces/.gitignore</FILE>
        <FILE>packages/now-next/test/fixtures/09-yarn-workspaces/lerna.json</FILE>
        <FILE>packages/now-next/test/fixtures/09-yarn-workspaces/now.json</FILE>
        <FILE>packages/now-next/test/fixtures/09-yarn-workspaces/package.json</FILE>
        <FILE>packages/now-next/test/fixtures/09-yarn-workspaces/packages/common/dist/index.d.ts</FILE>
        <FILE>packages/now-next/test/fixtures/09-yarn-workspaces/packages/common/dist/index.js</FILE>
        <FILE>packages/now-next/test/fixtures/09-yarn-workspaces/packages/common/dist/index.js.map</FILE>
        <FILE>packages/now-next/test/fixtures/09-yarn-workspaces/packages/common/package.json</FILE>
        <FILE>packages/now-next/test/fixtures/09-yarn-workspaces/packages/common/src/index.ts</FILE>
        <FILE>packages/now-next/test/fixtures/09-yarn-workspaces/packages/common/tsconfig.json</FILE>
        <FILE>packages/now-next/test/fixtures/09-yarn-workspaces/packages/common/tsconfig.tsbuildinfo</FILE>
        <FILE>packages/now-next/test/fixtures/09-yarn-workspaces/packages/web/next-env.d.ts</FILE>
        <FILE>packages/now-next/test/fixtures/09-yarn-workspaces/packages/web/next.config.js</FILE>
        <FILE>packages/now-next/test/fixtures/09-yarn-workspaces/packages/web/package.json</FILE>
        <FILE>packages/now-next/test/fixtures/09-yarn-workspaces/packages/web/pages/_app.tsx</FILE>
        <FILE>packages/now-next/test/fixtures/09-yarn-workspaces/packages/web/pages/index.tsx</FILE>
        <FILE>packages/now-next/test/fixtures/09-yarn-workspaces/packages/web/tsconfig.json</FILE>
        <FILE>packages/now-next/test/fixtures/09-yarn-workspaces/yarn.lock</FILE>
        <FILE>packages/now-node/src/index.ts</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
