<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>11976</ISSUENO>
  <ISSUEURL>https://github.com/vercel/vercel/issues/11976</ISSUEURL>
  <TITLE>[Bug] Vercel failed to build go serverless functions with go &gt;= 1.21</TITLE>
  <DESCRIPTION>Currently, vercel fails to build any golang serverless functions when using go1.21 or later, it outputs: ``` go: module . listed in go.work file requires go &gt;= 1.21, but go.work lists go 1.18; to update it: go work use go: module ../../../.. listed in go.work file requires go &gt;= 1.21, but go.work lists go 1.18; to update it: go work use Error: Command failed: go build -ldflags -s -w -o ./vercel-dev-server-go ./... go: module . listed in go.work file requires go &gt;= 1.21, but go.work lists go 1.18; to update it: go work use go: module ../../../.. listed in go.work file requires go &gt;= 1.21, but go.work lists go 1.18; to update it: go work use Error: Command failed: go build -ldflags -s -w -o ./vercel-dev-server-go ./... ``` I believe it's caused by vercel's `go.work` generation here: https://github.com/vercel/vercel/blob/4052e9b8c61df1bd3d716bfa7a10417834992f46/packages/go/src/index.ts#L785-L790 where it should include the go directive (e.g. `go 1.21.0`) at the top of the generated `go.work` file.</DESCRIPTION>
  <REPONAME>vercel</REPONAME>
  <TIMEDIFFERENCEDAYS>94</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>[cli] derive `vercel alias` subcommand config from subcommand structs (#12474) - **[cli] derive `vercel alias` subcommand config from subcommand structs** - **add changeset**</MESSAGE>
    <SHA>f4f1a43b880af3ae597d4ae29486301bf0aefeac</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>[cli] fix missing go directive of go.work (#11976)</MESSAGE>
      <SHA>d293aa39cabde37f3894b19f01f8e22d0f519de3</SHA>
      <PATCHEDFILES>
        <FILE>packages/go/src/index.ts</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>[cli] fix missing go directive of go.work (#11976)</MESSAGE>
      <SHA>27d7310f055fc7bba27e4cbd4188dc0a49f4be8f</SHA>
      <PATCHEDFILES>
        <FILE>.changeset/dirty-dingos-wave.md</FILE>
        <FILE>packages/go/src/index.ts</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>[cli] fix missing go directive of go.work (#11976)</MESSAGE>
      <SHA>4bf58ec712a09ddf35377966f72d41661cbeebbc</SHA>
      <PATCHEDFILES>
        <FILE>.changeset/dirty-dingos-wave.md</FILE>
        <FILE>packages/go/src/index.ts</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Go work missing go version declaration in dev mode (#12574) The go.work file used on `vercel dev` is missing the go version declaration causing 502 errors on functions in dev that work as expected in production. discussed in https://github.com/vercel/vercel/issues/11976 This appears to only trigger when external packages are used that require go versions later than 1.20. `➜ cli git:(main) ✗ pnpm vercel dev --cwd=../../../domain-assist/ &gt; vercel@38.0.0 vercel /Users/eprosimon/Developer/golang-dev-error/vercel/packages/cli &gt; ts-node ./src/index.ts &quot;dev&quot; &quot;--cwd=../../../domain-assist/&quot; Vercel CLI 38.0.0 &gt; Running Dev Command “next dev --port $PORT” ▲ Next.js 15.0.2 - Local: http://localhost:3000 ✓ Starting... &gt; Ready! Available at http://localhost:3000 ✓ Ready in 1035ms Writing go.work contents: use (. &lt;------------------------------------------------------- . ../../../.. ) go: module . listed in go.work file requires go &gt;= 1.23.3, but go.work implicitly requires go 1.18; to update it: go work use go: module ../../../.. listed in go.work file requires go &gt;= 1.23.3, but go.work implicitly requires go 1.18; to update it: go work use Error: Command failed: go build -ldflags -s -w -o ./vercel-dev-server-go ./...`</MESSAGE>
      <SHA>56f525724428856f717b4f3fb12fd45b98f7f561</SHA>
      <PATCHEDFILES>
        <FILE>.changeset/kind-carpets-sleep.md</FILE>
        <FILE>packages/cli/test/dev/fixtures/go-external-module/api/go.mod</FILE>
        <FILE>packages/cli/test/dev/fixtures/go-external-module/api/go.sum</FILE>
        <FILE>packages/cli/test/dev/fixtures/go-external-module/api/index.go</FILE>
        <FILE>packages/cli/test/dev/fixtures/go-external-module/package.json</FILE>
        <FILE>packages/cli/test/dev/fixtures/handle-miss-hide-dir-list/.gitignore</FILE>
        <FILE>packages/cli/test/dev/fixtures/nested-tsconfig/tsconfig.json</FILE>
        <FILE>packages/cli/test/dev/integration-2.test.ts</FILE>
        <FILE>packages/go/src/index.ts</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
