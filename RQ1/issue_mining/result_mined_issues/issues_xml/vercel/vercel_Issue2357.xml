<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>2357</ISSUENO>
  <ISSUEURL>https://github.com/vercel/vercel/issues/2357</ISSUEURL>
  <TITLE>Deployment fails when Creat React App is added with React Snap</TITLE>
  <DESCRIPTION>I am trying to use the create-react-app's `now.json` template to deploy my application. However to pre-render my pages i am using react-snap. The build fails, on the server and i get the following error ``` $ react-snap 2019-05-16T22:47:04.236Z Error: Failed to launch chrome! /tmp/77102a3b/node_modules/puppeteer/.local-chromium/linux-656675/chrome-linux/chrome: error while loading shared libraries: libX11.so.6: cannot open shared object file: No such file or directory TROUBLESHOOTING: https://github.com/GoogleChrome/puppeteer/blob/master/docs/troubleshooting.md at onClose (/tmp/77102a3b/node_modules/puppeteer/lib/Launcher.js:342:14) at Interface.helper.addEventListener (/tmp/77102a3b/node_modules/puppeteer/lib/Launcher.js:331:50) at emitNone (events.js:111:20) at Interface.emit (events.js:208:7) at Interface.close (readline.js:370:8) at Socket.onend (readline.js:149:10) at emitNone (events.js:111:20) at Socket.emit (events.js:208:7) at endReadableNT (_stream_readable.js:1064:12) at _combinedTickCallback (internal/process/next_tick.js:138:11) 2019-05-16T22:47:04.253Z error Command failed with exit code 1. ``` My Package.json ```json &quot;scripts&quot;: { &quot;start&quot;: &quot;node scripts/start.js&quot;, &quot;build&quot;: &quot;node scripts/build.js&quot;, &quot;stage&quot;: &quot;yarn run build &amp;&amp; cp src/netlify/_redirects build/.&quot;, &quot;test&quot;: &quot;node scripts/test.js&quot;, &quot;now-dev&quot;: &quot;node scripts/start.js&quot;, &quot;now-build&quot;: &quot;yarn run build&quot;, &quot;postbuild&quot;: &quot;react-snap&quot;, } ``` My now.json ``` { &quot;version&quot;: 2, &quot;name&quot;: &quot;jsvault&quot;, &quot;builds&quot;: [ { &quot;src&quot;: &quot;package.json&quot;, &quot;use&quot;: &quot;@now/static-build&quot;, &quot;config&quot;: { &quot;distDir&quot;: &quot;build&quot; } }, { &quot;src&quot;: &quot;build/**.*.js&quot;, &quot;use&quot;: &quot;@now/node&quot; } ], &quot;routes&quot;: [ { &quot;src&quot;: &quot;/static/(.*)&quot;, &quot;headers&quot;: { &quot;cache-control&quot;: &quot;s-maxage=31536000,immutable&quot; }, &quot;dest&quot;: &quot;/static/$1&quot; }, { &quot;src&quot;: &quot;/favicon.ico&quot;, &quot;dest&quot;: &quot;/favicon.ico&quot; }, { &quot;src&quot;: &quot;/asset-manifest.json&quot;, &quot;dest&quot;: &quot;/asset-manifest.json&quot; }, { &quot;src&quot;: &quot;/manifest.json&quot;, &quot;dest&quot;: &quot;/manifest.json&quot; }, { &quot;src&quot;: &quot;/precache-manifest.(.*)&quot;, &quot;dest&quot;: &quot;/precache-manifest.$1&quot; }, { &quot;src&quot;: &quot;/service-worker.js&quot;, &quot;headers&quot;: { &quot;cache-control&quot;: &quot;s-maxage=0&quot; }, &quot;dest&quot;: &quot;/service-worker.js&quot; }, { &quot;src&quot;: &quot;/(.*)&quot;, &quot;headers&quot;: { &quot;cache-control&quot;: &quot;s-maxage=0&quot; }, &quot;dest&quot;: &quot;/index.html&quot; } ], &quot;build&quot;: { &quot;env&quot;: { &quot;NODE_ENV&quot;: &quot;production&quot; } } } ``` So react-snap basically opens pupetter and parses the pages, and throws out an index.html I even tried adding 2 builders something like so ```json &quot;builds&quot;: [ { &quot;src&quot;: &quot;package.json&quot;, &quot;use&quot;: &quot;@now/static-build&quot;, &quot;config&quot;: { &quot;distDir&quot;: &quot;build&quot; } }, { &quot;src&quot;: &quot;build/**.*.js&quot;, &quot;use&quot;: &quot;@now/node&quot; } ], ``` But to no avail. Am i doing anyting wrong? or is such a combo not possible? I dont mind downgrading to version 1 so that it works, if thats the issue</DESCRIPTION>
  <REPONAME>vercel</REPONAME>
  <TIMEDIFFERENCEDAYS>308</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Publish Canary - @now/build-utils@2.1.2-canary.2 - @now/next@2.4.1-canary.4 - @now/static-build@0.14.13-canary.5</MESSAGE>
    <SHA>9b9037de91bed61a4e283fcccc26451963928beb</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>[now-static-build] Add test for puppeteer during build (#3911) We recently updated the build image to add the necessary dependencies so that `puppeteer` can run during the build step. This PR adds a test that takes a screenshot and prints metrics during a static build. This is necessary to support `react-snap` (along with a few flags in `package.json`). ```json { &quot;reactSnap&quot;: { &quot;puppeteerArgs&quot;: [ &quot;--no-sandbox&quot;, &quot;--disable-setuid-sandbox&quot; ] } } ``` - Fixes https://github.com/zeit/now-builders/issues/517 - Fixes #2357</MESSAGE>
      <SHA>a4de9272e7ae112816109981499fa8d1e8039a2c</SHA>
      <PATCHEDFILES>
        <FILE>packages/now-static-build/test/fixtures/51-puppeteer-build/build.js</FILE>
        <FILE>packages/now-static-build/test/fixtures/51-puppeteer-build/now.json</FILE>
        <FILE>packages/now-static-build/test/fixtures/51-puppeteer-build/package.json</FILE>
        <FILE>packages/now-static-build/test/fixtures/51-puppeteer-build/probe.js</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
