<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>293</ISSUENO>
  <ISSUEURL>https://github.com/vercel/vercel/issues/293</ISSUEURL>
  <TITLE>now --deploy docker does not exit</TITLE>
  <DESCRIPTION>I am running the command in GitLab EE CI. The deployment completes successfully, however, it remains hanging. ```bash $ now --docker --token $ZEIT_TOKEN --alias applaudience-showtime-data-sources-worker --no-clipboard --debug &gt; [debug] Forcing `deploymentType` = `docker` &gt; [debug] ignoring invalid file &quot;/builds/applaudience/showtime-data-sources-worker/.npmrc&quot; &gt; [debug] locating files /builds/applaudience/showtime-data-sources-worker: 14.850ms &gt; [debug] Getting files: 25.960ms &gt; [debug] Computing hashes: 4.339ms &gt; [debug] /now/create: 1725.716ms https://applaudienceshowtime-data-sources-worker-....now.sh&gt; [debug] closing agent ``` The box running the deployment is Docker `node:7` image. ```yaml release: image: node:7 stage: release only: - master@applaudience/showtime-data-sources-worker script: - export NPM_CONFIG_LOGLEVEL=warn - export NPM_CONFIG_DEPTH=0 - npm install now -g - now --docker --token $ZEIT_TOKEN --alias applaudience-showtime-data-sources-worker --no-clipboard --debug ``` I cannot replicate the same behaviour on OSX.</DESCRIPTION>
  <REPONAME>vercel</REPONAME>
  <TIMEDIFFERENCEDAYS>644</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>[now-go] Add missing await to `getExportedFunctionName()` (#285) This fixes a subtle bug in the `getExportedFunctionName()` helper function. It wasn't actually causing any issues in production, since the `index.js` file also does `await` on the return value of this function so it was still resolving the promise properly, but this is more correct and fixes the associated `debug()` call.</MESSAGE>
    <SHA>e026ddf805719a1613d61103561774ca88857890</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fix `packAndDeploy()` for usage with `@now/node` (#293) * Fix `packAndDeploy()` for usage with `@now/node` Since the prepublish script for `@now/node` writes other stuff to stdout, so relying on `npm pack` outputting the tarball name is not reliable. Instead, just `glob()` for a `*.tgz` file and expect that to be the output package tarball. Fixes error: ``` Error: ENOENT: no such file or directory, open '/home/circleci/repo/packages/now-node/&gt; @now/node@0.5.2-canary.2 prepublish /home/circleci/repo/packages/now-node &gt; npm run build &gt; @now/node@0.5.2-canary.2 build /home/circleci/repo/packages/now-node &gt; ./build.sh '/home/circleci/repo/packages/now-node-bridge/bridge.d.ts' -&gt; 'src/bridge.d.ts' now-node-0.5.2-canary.2.tgz' ``` * Make the `tgzPath` be absolute * 'ignore' -&gt; 'inherit'</MESSAGE>
      <SHA>616bad8a3dd4dcb6c40714022f9d67cfba7a8259</SHA>
      <PATCHEDFILES>
        <FILE>test/lib/deployment/test-deployment.js</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
