<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>7908</ISSUENO>
  <ISSUEURL>https://github.com/vercel/vercel/issues/7908</ISSUEURL>
  <TITLE>@vercel/node: Support ESM with TS</TITLE>
  <DESCRIPTION>Add support for ESM in Serverless Functions. AWS Lambda [supports ESM](https://aws.amazon.com/blogs/compute/using-node-js-es-modules-and-top-level-await-in-aws-lambda/) by having a `package.json` file with `{&quot;type&quot;:&quot;module&quot;}`. This is already possible with Build Output v3 ([SvelteKit](https://github.com/sveltejs/kit/blob/master/packages/adapter-vercel/index.js#L470) and [Astro](https://github.com/withastro/astro/blob/main/packages/integrations/vercel/src/serverless/adapter.ts#L49-L51) use this method), and it could be great to have something similar for standalone `api/` functions. --- Related issues - #7540</DESCRIPTION>
  <REPONAME>vercel</REPONAME>
  <TIMEDIFFERENCEDAYS>218</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>[tests] Turbo should use full logs when listing tests (#9172) In PR #9168, the output mode was changed so it doesnt print logs when the result is cached. However, we need the output for the dry run where we list all relevant tests. So the flag was added to that one script only to avoid this skipped problem: ![skipped](https://user-images.githubusercontent.com/229881/210870102-a597d1b9-f007-41ba-8e1d-f53aa765b740.png)</MESSAGE>
    <SHA>6215c516e7ef4ae1a94041e15ef875cdad0c749d</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>[node] Fix ESM output from TS source (#7954) - Depends on https://github.com/vercel/nft/pull/297 - Fixes #7908 - Fixes #6194 This PR bumps `@vercel/nft` (for production) and `ts-node` (for development) to fix ESM behavior. Because Node.js cannot dynamically set [loader hooks](https://nodejs.org/docs/latest-v18.x/api/esm.html#loaders) once a process is started, I had to change the way `ts-node` is registered by using environment variables such as `NODE_OPTIONS`. Most of the logic for TS and ESM was pulled out of the child process and into the parent. Co-authored-by: Ethan Arrowood &lt;ethan.arrowood@vercel.com&gt;</MESSAGE>
      <SHA>feceeef7b70e7532cd85f1c6dfcc00474a006aeb</SHA>
      <PATCHEDFILES>
        <FILE>packages/cli/test/dev/fixtures/41-tsconfig-jsx/package.json</FILE>
        <FILE>packages/cli/test/dev/fixtures/force-module-commonjs/tsconfig.json</FILE>
        <FILE>packages/next/package.json</FILE>
        <FILE>packages/node/package.json</FILE>
        <FILE>packages/node/src/dev-server.ts</FILE>
        <FILE>packages/node/src/index.ts</FILE>
        <FILE>packages/node/src/typescript.ts</FILE>
        <FILE>packages/node/test/fixtures/06-ts-esm/api/proxy.ts</FILE>
        <FILE>packages/node/test/fixtures/06-ts-esm/package.json</FILE>
        <FILE>packages/node/test/fixtures/06-ts-esm/probes.json</FILE>
        <FILE>packages/node/test/fixtures/06-ts-esm/tsconfig.json</FILE>
        <FILE>packages/node/test/fixtures/18-nested-tsconfig/tsconfig.json</FILE>
        <FILE>packages/redwood/package.json</FILE>
        <FILE>packages/remix/package.json</FILE>
        <FILE>yarn.lock</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
