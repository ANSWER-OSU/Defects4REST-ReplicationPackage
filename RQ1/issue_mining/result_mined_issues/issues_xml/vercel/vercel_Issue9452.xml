<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>9452</ISSUENO>
  <ISSUEURL>https://github.com/vercel/vercel/issues/9452</ISSUEURL>
  <TITLE>[gatsby-plugin-vercel-builder] Gatsby builds are not being cached increasing build time</TITLE>
  <DESCRIPTION>I think this change has increased the build times of one of my medium sized projects (couple hundred pages). After this change was released, the build times more than doubled from around 4 minutes to 9+. The major problem is that the site utilizes a source plugin and there are tasks such as `Running gatsby.IMAGE_CDN jobs` and `gatsby-plugin-sharp.IMAGE_PROCESSING` which are very time consuming and need to run again. Is it possible to specify the version of `@vercel/gatsby-plugin-vercel-builder` used for the build? I'd like to somehow test using `v1.0.3`. I tried adding the package in `package.json` but then it runs twice and throws an error. See [this commit](https://github.com/vercel/vercel/commit/aa6b957b23101cff6c265bd4baa1c06a3fd1f1bd)</DESCRIPTION>
  <REPONAME>vercel</REPONAME>
  <TIMEDIFFERENCEDAYS>275</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>[node] Handle multi-protocol in Edge Functions (#9502) Co-authored-by: Chris Barber &lt;chris.barber@vercel.com&gt; Co-authored-by: Sean Massa &lt;EndangeredMassa@gmail.com&gt; fix #9501</MESSAGE>
    <SHA>af7b34aa45e04021c757bd71e1f67b59d2b687b6</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>[gatsby-plugin-vercel-builder] link instead of move (#9673) When creating the `./vercel/output/static` dir... **Moving the `public` dir** is what currently happens. This causes Gatsby to believe that the build was not complete: &gt; info We've detected that the Gatsby cache is incomplete (the .cache directory exists but the public directory does not). As a precaution, we're deleting your site's cache to ensure there's no stale data. **Copying the `public` dir** is not an option because it can cause a build to run out of space. **Symlinking the `public` dir** would work, but it would require more changes throughout the system to make sure the symlink was followed properly. **Hard Linking the `public` dir's files** is the best option. This PR links the directories instead of moving them. We did look for a library that already does the `hardlinkFileTree` thing, but couldn't find one. --- **Testing** This was manually tested with real deployments. --- * paired with @TooTallNate * [user report](https://github.com/vercel/vercel/issues/9452#issuecomment-1432858615)</MESSAGE>
      <SHA>ffdca76155a62a8832887d1e30d9ece58a87c616</SHA>
      <PATCHEDFILES>
        <FILE>packages/build-utils/src/hard-link-dir.ts</FILE>
        <FILE>packages/build-utils/src/index.ts</FILE>
        <FILE>packages/gatsby-plugin-vercel-builder/src/helpers/static.ts</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
