<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>18768</ISSUENO>
  <ISSUEURL>https://github.com/netbox-community/netbox/issues/18768</ISSUEURL>
  <TITLE>Unable to remove a secondary MAC address from an interface</TITLE>
  <DESCRIPTION>### Deployment Type Self-hosted ### NetBox Version v4.2.4 ### Python Version 3.11 ### Steps to Reproduce All operations were done in the WebUI. 1. Create a virtual interface X and assign it to a virtual machine (virtualization/interfaces). 2. Create two MAC addresses A and B (dcim/mac-addresses). 3. Edit MAC address A and assign it to X. 4. Edit MAC address B and also assign it to X. 5. Edit virtual interface X and set A as primary MAC address. 6. Edit MAC address B and remove the assignment to X. ### Expected Behavior I expected on step 6 that the MAC address object gets unassigned from the interface so it can be assigned to another interface. ### Observed Behavior An Error was shown with the message &quot;Cannot unassign MAC Address while it is designated as the primary MAC for an object&quot;. The MAC address to be unassigned was NOT the primary MAC address.</DESCRIPTION>
  <REPONAME>netbox</REPONAME>
  <TIMEDIFFERENCEDAYS>3</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Fixes #15924: Fix API interface patch tagged all mode (#18759) * Fixes: #15924 - Prevent API payload from allowing tagged_vlans while interface mode is set to taged-all * Prevent cleanup of tagged_vlans when no tagged_vlans set on interface * Fix test errors * Remove accidental debug statements * Update validation to model clean method instead of serializer * Remove clearing of tagged vlans from `save()` * Make changes to validation to account for M2M not being available under model in addition to not being able to check incoming vlans under same model. * Optimize untagged vlan check * Re-ordering statements in validators * Forgot to call super().clean() * Adjust logic for form and serializer. Add tests * Fix test failure * Fix ruff errors * Fix test by removing now invalid test * Update serializer, form and tests * Optimize API test for vlan fields * Optimize API serializer logic --------- Co-authored-by: Daniel Sheppard &lt;dans@dansheps.com&gt;</MESSAGE>
    <SHA>63a167f1302582b065be74a6021f828e6404d7e4</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fixes #18768: allow removing secondary MACAddress from interface</MESSAGE>
      <SHA>e133346521049dbac6bb4174047ff8da2a552311</SHA>
      <PATCHEDFILES>
        <FILE>netbox/dcim/models/devices.py</FILE>
        <FILE>netbox/dcim/tests/test_models.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fixes #18768: allow removing secondary MACAddress from interface</MESSAGE>
      <SHA>e86dba8fc8addb73215721492f3072c84f3c76e8</SHA>
      <PATCHEDFILES>
        <FILE>netbox/dcim/models/devices.py</FILE>
        <FILE>netbox/dcim/tests/test_models.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fixes #18768: allow removing secondary MACAddress from interface</MESSAGE>
      <SHA>5f30f95c5e2f67462b7afc5080e3f36482568048</SHA>
      <PATCHEDFILES>
        <FILE>netbox/dcim/models/devices.py</FILE>
        <FILE>netbox/dcim/tests/test_models.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
