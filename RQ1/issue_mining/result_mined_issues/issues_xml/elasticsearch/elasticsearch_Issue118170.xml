<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>118170</ISSUENO>
  <ISSUEURL>https://github.com/elastic/elasticsearch/issues/118170</ISSUEURL>
  <TITLE>[CI] DebPreservationTests test40RestartOnUpgrade failing</TITLE>
  <DESCRIPTION>**Build Scans:** - [elasticsearch-periodic-packaging #4919 / ubuntu-1804_packaging-tests-unix](https://gradle-enterprise.elastic.co/s/rn2zksv2gv4i6) - [elasticsearch-pull-request #45013 / ubuntu-1804_packages_packaging-tests-unix](https://gradle-enterprise.elastic.co/s/tfp7yqb5revtc) - [elasticsearch-periodic-packaging #4913 / ubuntu-1804_packaging-tests-unix](https://gradle-enterprise.elastic.co/s/ljpftjup6yfp2) **Reproduction Line:** ``` null ``` **Applicable branches:** main **Reproduces locally?:** N/A **Failure History:** [See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&amp;_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.packaging.test.DebPreservationTests),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(test40RestartOnUpgrade),title:'Test',type:optionsListControl))))) **Failure Message:** ``` java.lang.RuntimeException: Elasticsearch (with x-pack) did not start ``` **Issue Reasons:** - [main] 2 consecutive failures in step ubuntu-1804_packaging-tests-unix - [main] 3 failures in test test40RestartOnUpgrade (2.2% fail rate in 138 executions) - [main] 2 failures in step ubuntu-1804_packaging-tests-unix (100.0% fail rate in 2 executions) - [main] 2 failures in pipeline elasticsearch-periodic-packaging (50.0% fail rate in 4 executions) **Note:** This issue was created using new test triage automation. Please report issues or feedback to es-delivery.</DESCRIPTION>
  <REPONAME>elasticsearch</REPONAME>
  <TIMEDIFFERENCEDAYS>20</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Ignore cancellation exceptions (#117657) Today, when an ES|QL task encounters an exception, we trigger a cancellation on the root task, causing child tasks to fail due to cancellation. We chose not to include cancellation exceptions in the output, as they are unhelpful and add noise during problem analysis. However, these exceptions are still slipping through via RefCountingListener. This change addresses the issue by introducing ESQLRefCountingListener, ensuring that no cancellation exceptions are returned.</MESSAGE>
    <SHA>3ae2330630e5f5d0fa62e4c41288a6dbae47678f</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Mute org.elasticsearch.packaging.test.DebPreservationTests test40RestartOnUpgrade #118170</MESSAGE>
      <SHA>4f030efcd50781fe6e624dc08046b834786edb4a</SHA>
      <PATCHEDFILES>
        <FILE>muted-tests.yml</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
