<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>125157</ISSUENO>
  <ISSUEURL>https://github.com/elastic/elasticsearch/issues/125157</ISSUEURL>
  <TITLE>Add ability to bypass default vector oversampling and rescoring</TITLE>
  <DESCRIPTION>### Description It is now possible to set a default oversample &amp; rescore parameter for a given quantized index: https://github.com/elastic/elasticsearch/pull/124581 However, it is possible that at query time, users may want to bypass that default oversampling and disable oversampling for particular queries. Consequently, we should add a specialized floating point value for query time rescore_vector parameters. I suggest that the value `oversample: 0` indicates no oversampling is desired, and will override any index level defaults for oversampling.</DESCRIPTION>
  <REPONAME>elasticsearch</REPONAME>
  <TIMEDIFFERENCEDAYS>8</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>[ES|QL] Make numberOfChannels consistent with layout map by removing duplicated ChannelSet (#125636) * make numberOfChannels consistent with layout</MESSAGE>
    <SHA>80125a4bac31f54cc86fdee26ef0ac5dfa61eee3</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Allow zero for rescore_vector.oversample to indicate by-passing oversample and rescoring (#125599) This allows a `rescore_vector: {oversample: 0}` to indicate bypassing oversampling and rescoring. This is useful for: - Updating a quantized mapping to turn off automatic rescoring - Bypassing oversampling at query time in an ad-hoc manner if its on by default in the mapping closes: https://github.com/elastic/elasticsearch/issues/125157</MESSAGE>
      <SHA>009a86a0e32231eab5b911f9364202639bb6cc47</SHA>
      <PATCHEDFILES>
        <FILE>docs/changelog/125599.yaml</FILE>
        <FILE>docs/reference/elasticsearch/mapping-reference/dense-vector.md</FILE>
        <FILE>docs/reference/query-languages/query-dsl/query-dsl-knn-query.md</FILE>
        <FILE>rest-api-spec/src/yamlRestTest/resources/rest-api-spec/test/search.vectors/41_knn_search_bbq_hnsw.yml</FILE>
        <FILE>rest-api-spec/src/yamlRestTest/resources/rest-api-spec/test/search.vectors/41_knn_search_byte_quantized.yml</FILE>
        <FILE>rest-api-spec/src/yamlRestTest/resources/rest-api-spec/test/search.vectors/41_knn_search_half_byte_quantized.yml</FILE>
        <FILE>server/src/main/java/org/elasticsearch/TransportVersions.java</FILE>
        <FILE>server/src/main/java/org/elasticsearch/index/IndexVersions.java</FILE>
        <FILE>server/src/main/java/org/elasticsearch/index/mapper/MapperFeatures.java</FILE>
        <FILE>server/src/main/java/org/elasticsearch/index/mapper/vectors/DenseVectorFieldMapper.java</FILE>
        <FILE>server/src/main/java/org/elasticsearch/search/vectors/RescoreVectorBuilder.java</FILE>
        <FILE>server/src/test/java/org/elasticsearch/index/mapper/vectors/DenseVectorFieldMapperTests.java</FILE>
        <FILE>server/src/test/java/org/elasticsearch/index/mapper/vectors/DenseVectorFieldTypeTests.java</FILE>
        <FILE>server/src/test/java/org/elasticsearch/search/vectors/AbstractKnnVectorQueryBuilderTestCase.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Allow zero for rescore_vector.oversample to indicate by-passing oversample and rescoring (#125599) This allows a `rescore_vector: {oversample: 0}` to indicate bypassing oversampling and rescoring. This is useful for: - Updating a quantized mapping to turn off automatic rescoring - Bypassing oversampling at query time in an ad-hoc manner if its on by default in the mapping closes: https://github.com/elastic/elasticsearch/issues/125157</MESSAGE>
      <SHA>3142206c84a291ab58d2b90e61fe33fa19f942e2</SHA>
      <PATCHEDFILES>
        <FILE>docs/changelog/125599.yaml</FILE>
        <FILE>docs/reference/elasticsearch/mapping-reference/dense-vector.md</FILE>
        <FILE>docs/reference/query-languages/query-dsl/query-dsl-knn-query.md</FILE>
        <FILE>rest-api-spec/src/yamlRestTest/resources/rest-api-spec/test/search.vectors/41_knn_search_bbq_hnsw.yml</FILE>
        <FILE>rest-api-spec/src/yamlRestTest/resources/rest-api-spec/test/search.vectors/41_knn_search_byte_quantized.yml</FILE>
        <FILE>rest-api-spec/src/yamlRestTest/resources/rest-api-spec/test/search.vectors/41_knn_search_half_byte_quantized.yml</FILE>
        <FILE>server/src/main/java/org/elasticsearch/TransportVersions.java</FILE>
        <FILE>server/src/main/java/org/elasticsearch/index/IndexVersions.java</FILE>
        <FILE>server/src/main/java/org/elasticsearch/index/mapper/MapperFeatures.java</FILE>
        <FILE>server/src/main/java/org/elasticsearch/index/mapper/vectors/DenseVectorFieldMapper.java</FILE>
        <FILE>server/src/main/java/org/elasticsearch/search/vectors/RescoreVectorBuilder.java</FILE>
        <FILE>server/src/test/java/org/elasticsearch/index/mapper/vectors/DenseVectorFieldMapperTests.java</FILE>
        <FILE>server/src/test/java/org/elasticsearch/index/mapper/vectors/DenseVectorFieldTypeTests.java</FILE>
        <FILE>server/src/test/java/org/elasticsearch/search/vectors/AbstractKnnVectorQueryBuilderTestCase.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>[8.19] Allow zero for rescore_vector.oversample to indicate by-passing oversample and rescoring (#125599) (#127662) * Allow zero for rescore_vector.oversample to indicate by-passing oversample and rescoring (#125599) This allows a `rescore_vector: {oversample: 0}` to indicate bypassing oversampling and rescoring. This is useful for: - Updating a quantized mapping to turn off automatic rescoring - Bypassing oversampling at query time in an ad-hoc manner if its on by default in the mapping closes: https://github.com/elastic/elasticsearch/issues/125157 (cherry picked from commit 009a86a0e32231eab5b911f9364202639bb6cc47) * Adding versions for bwc for #125599 (#127663) blocks: #127662 This adds bwc versions for #125599 * fixing versioning for merge</MESSAGE>
      <SHA>d12f7576c324fa597c82ba4d0b9592e252165599</SHA>
      <PATCHEDFILES>
        <FILE>docs/changelog/125599.yaml</FILE>
        <FILE>rest-api-spec/src/yamlRestTest/resources/rest-api-spec/test/search.vectors/41_knn_search_bbq_hnsw.yml</FILE>
        <FILE>rest-api-spec/src/yamlRestTest/resources/rest-api-spec/test/search.vectors/41_knn_search_byte_quantized.yml</FILE>
        <FILE>rest-api-spec/src/yamlRestTest/resources/rest-api-spec/test/search.vectors/41_knn_search_half_byte_quantized.yml</FILE>
        <FILE>server/src/main/java/org/elasticsearch/TransportVersions.java</FILE>
        <FILE>server/src/main/java/org/elasticsearch/index/IndexVersions.java</FILE>
        <FILE>server/src/main/java/org/elasticsearch/index/mapper/MapperFeatures.java</FILE>
        <FILE>server/src/main/java/org/elasticsearch/index/mapper/vectors/DenseVectorFieldMapper.java</FILE>
        <FILE>server/src/main/java/org/elasticsearch/search/vectors/RescoreVectorBuilder.java</FILE>
        <FILE>server/src/test/java/org/elasticsearch/index/mapper/vectors/DenseVectorFieldMapperTests.java</FILE>
        <FILE>server/src/test/java/org/elasticsearch/index/mapper/vectors/DenseVectorFieldTypeTests.java</FILE>
        <FILE>server/src/test/java/org/elasticsearch/search/vectors/AbstractKnnVectorQueryBuilderTestCase.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
