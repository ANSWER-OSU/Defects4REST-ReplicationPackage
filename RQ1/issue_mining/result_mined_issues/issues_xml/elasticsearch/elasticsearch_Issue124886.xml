<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>124886</ISSUENO>
  <ISSUEURL>https://github.com/elastic/elasticsearch/issues/124886</ISSUEURL>
  <TITLE>[CI] DataStreamAndIndexLifecycleMixingTests testIndexTemplateSwapsILMForDataStreamLifecycle failing</TITLE>
  <DESCRIPTION>**Build Scans:** - [elasticsearch-periodic-platform-support #7014 / sles-15_platform-support-unix](https://gradle-enterprise.elastic.co/s/q6b5j2ab55stw) - [elasticsearch-pull-request #62626 / part-2](https://gradle-enterprise.elastic.co/s/gpao4skdiaiam) - [elasticsearch-pull-request #62097 / part-2](https://gradle-enterprise.elastic.co/s/gmcsbeaslmr62) **Reproduction Line:** ``` ./gradlew &quot;:x-pack:plugin:ilm:internalClusterTest&quot; --tests &quot;org.elasticsearch.xpack.ilm.DataStreamAndIndexLifecycleMixingTests.testIndexTemplateSwapsILMForDataStreamLifecycle&quot; -Dtests.seed=1DFFCE84BC4BFB0A -Dtests.locale=ks -Dtests.timezone=Canada/Saskatchewan -Druntime.java=23 ``` **Applicable branches:** main **Reproduces locally?:** N/A **Failure History:** [See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&amp;_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.ilm.DataStreamAndIndexLifecycleMixingTests),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(testIndexTemplateSwapsILMForDataStreamLifecycle),title:'Test',type:optionsListControl))))) **Failure Message:** ``` java.util.concurrent.ExecutionException: [.ds-datastream-uqwigbyzzdzpjs-2025.03.14-000003] org.elasticsearch.index.IndexNotFoundException: no such index [.ds-datastream-uqwigbyzzdzpjs-2025.03.14-000003] ``` **Issue Reasons:** - [main] 3 failures in test testIndexTemplateSwapsILMForDataStreamLifecycle (0.7% fail rate in 446 executions) - [main] 2 failures in step part-2 (1.1% fail rate in 175 executions) - [main] 2 failures in pipeline elasticsearch-pull-request (1.1% fail rate in 178 executions) **Note:** This issue was created using new test triage automation. Please report issues or feedback to es-delivery.</DESCRIPTION>
  <REPONAME>elasticsearch</REPONAME>
  <TIMEDIFFERENCEDAYS>11</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Mute org.elasticsearch.datastreams.lifecycle.ExplainDataStreamLifecycleIT testSystemExplainLifecycle #124885</MESSAGE>
    <SHA>9b7b6ae059be2a1f9926bfe5f26e9dece5c95d16</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Mute org.elasticsearch.xpack.ilm.DataStreamAndIndexLifecycleMixingTests testIndexTemplateSwapsILMForDataStreamLifecycle #124886</MESSAGE>
      <SHA>96915d4916c1ed008654a2f64da230265cf1a75e</SHA>
      <PATCHEDFILES>
        <FILE>muted-tests.yml</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fix data stream retrieval in `DataStreamAndIndexLifecycleMixingTests` These tests had the potential to fail when two consecutive GET data streams requests would hit two different nodes, where one node already had the cluster state that contained the new backing index and the other node didn't yet. Caused by #122852 Fixes #124837 Fixes #124849 Fixes #124850 Fixes #124886 Fixes #125083</MESSAGE>
      <SHA>0e560b435695573ce7d88d0fd95b784f382af55b</SHA>
      <PATCHEDFILES>
        <FILE>muted-tests.yml</FILE>
        <FILE>x-pack/plugin/ilm/src/internalClusterTest/java/org/elasticsearch/xpack/ilm/DataStreamAndIndexLifecycleMixingTests.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fix data stream retrieval in `DataStreamAndIndexLifecycleMixingTests` (#125609) These tests had the potential to fail when two consecutive GET data streams requests would hit two different nodes, where one node already had the cluster state that contained the new backing index and the other node didn't yet. Caused by #122852 Fixes #124837 Fixes #124849 Fixes #124850 Fixes #124886 Fixes #125083</MESSAGE>
      <SHA>3d9a7abb843c4b0160ee71ed4fd091632206b629</SHA>
      <PATCHEDFILES>
        <FILE>muted-tests.yml</FILE>
        <FILE>x-pack/plugin/ilm/src/internalClusterTest/java/org/elasticsearch/xpack/ilm/DataStreamAndIndexLifecycleMixingTests.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fix data stream retrieval in `DataStreamAndIndexLifecycleMixingTests` (#125609) These tests had the potential to fail when two consecutive GET data streams requests would hit two different nodes, where one node already had the cluster state that contained the new backing index and the other node didn't yet. Caused by #122852 Fixes #124837 Fixes #124849 Fixes #124850 Fixes #124886 Fixes #125083</MESSAGE>
      <SHA>09f1fa059efe177991bce8ae398487f994405949</SHA>
      <PATCHEDFILES>
        <FILE>muted-tests.yml</FILE>
        <FILE>x-pack/plugin/ilm/src/internalClusterTest/java/org/elasticsearch/xpack/ilm/DataStreamAndIndexLifecycleMixingTests.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
