<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>117108</ISSUENO>
  <ISSUEURL>https://github.com/elastic/elasticsearch/issues/117108</ISSUEURL>
  <TITLE>ES|QL mixed cluster tests failed on 8.17</TITLE>
  <DESCRIPTION>ES|QL mixed cluster tests failed with `Unknown DataType for type name: date_nanos on 8.17`. I can reproduce locally with `./gradlew &quot;:x-pack:plugin:esql:qa:server:mixed-cluster:v8.15.4#javaRestTest&quot; ` ``` [2024-11-20T15:34:09,463][ERROR][o.e.b.ElasticsearchUncaughtExceptionHandler] [test-cluster-2] fatal error in thread [elasticsearch-error-rethrower], exiting java.lang.AssertionError: java.io.IOException: Unknown DataType for type name: date_nanos at org.elasticsearch.transport.InboundHandler.handleRequest(InboundHandler.java:262) ~[elasticsearch-8.15.4.jar:?] at org.elasticsearch.transport.InboundHandler.messageReceived(InboundHandler.java:116) ~[elasticsearch-8.15.4.jar:?] at org.elasticsearch.transport.InboundHandler.inboundMessage(InboundHandler.java:97) ~[elasticsearch-8.15.4.jar:?] at org.elasticsearch.transport.TcpTransport.inboundMessage(TcpTransport.java:821) ~[elasticsearch-8.15.4.jar:?] at org.elasticsearch.transport.InboundPipeline.forwardFragments(InboundPipeline.java:124) ~[elasticsearch-8.15.4.jar:?] at org.elasticsearch.transport.InboundPipeline.doHandleBytes(InboundPipeline.java:96) ~[elasticsearch-8.15.4.jar:?] at org.elasticsearch.transport.InboundPipeline.handleBytes(InboundPipeline.java:61) ~[elasticsearch-8.15.4.jar:?] at org.elasticsearch.transport.netty4.Netty4MessageInboundHandler.channelRead(Netty4MessageInboundHandler.java:57) ~[?:?] at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444) ~[?:?] at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420) ~[?:?] at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412) ~[?:?] at io.netty.handler.codec.MessageToMessageDecoder.channelRead(MessageToMessageDecoder.java:103) ~[?:?] at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444) ~[?:?] at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420) ~[?:?] at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412) ~[?:?] at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410) ~[?:?] at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440) ~[?:?] at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420) ~[?:?] at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919) ~[?:?] at io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166) ~[?:?] at io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788) ~[?:?] at io.netty.channel.nio.NioEventLoop.processSelectedKeysPlain(NioEventLoop.java:689) ~[?:?] at io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:652) ~[?:?] at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562) ~[?:?] at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997) ~[?:?] at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74) ~[?:?] at java.lang.Thread.run(Thread.java:1570) ~[?:?] ```</DESCRIPTION>
  <REPONAME>elasticsearch</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Fix long metric deserialize &amp; add - auto-resize needs to be set manually (#117105) (#117170) * Fix long metric deserialize &amp; add - auto-resize needs to be set manually</MESSAGE>
    <SHA>c012a75c3629286158965524070e5dea86d4b43f</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>ESQL: Skip more union type tests Skip some more union type tests when running against older versions of Elasticsearch because they *now* require `date_nanos` support. Closes #117108</MESSAGE>
      <SHA>3f506d299321025bef1cfcd0d09e7be5deefb542</SHA>
      <PATCHEDFILES>
        <FILE>x-pack/plugin/esql/qa/testFixtures/src/main/resources/union_types.csv-spec</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>ESQL: Skip more union type tests (#117186) Skip some more union type tests when running against older versions of Elasticsearch because they *now* require `date_nanos` support. Closes #117108</MESSAGE>
      <SHA>da914e553f57e11b3166b9a5e62cc1dfd8ac4be3</SHA>
      <PATCHEDFILES>
        <FILE>x-pack/plugin/esql/qa/testFixtures/src/main/resources/union_types.csv-spec</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>ESQL: Skip more union type tests (#117186) Skip some more union type tests when running against older versions of Elasticsearch because they *now* require `date_nanos` support. Closes #117108</MESSAGE>
      <SHA>600c59cfb789530d36661fbf13e6da30bddd7bc6</SHA>
      <PATCHEDFILES>
        <FILE>x-pack/plugin/esql/qa/testFixtures/src/main/resources/union_types.csv-spec</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
