<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>119696</ISSUENO>
  <ISSUEURL>https://github.com/elastic/elasticsearch/issues/119696</ISSUEURL>
  <TITLE>`default_metric` field is not propagated when downsampling an `aggregate_metric_double` field</TITLE>
  <DESCRIPTION>### Elasticsearch Version 9.0 and before ### Installed Plugins _No response_ ### Java Version _bundled_ ### OS Version - ### Problem Description `default_metric` mapping parameter is lost during downsampling. ### Steps to Reproduce Downsample an index with the following mapping: ``` &quot;m&quot;: { &quot;type&quot;: &quot;aggregate_metric_double&quot;, &quot;metrics&quot;: [&quot;min&quot;, &quot;max&quot;, &quot;sum&quot;, &quot;value_count&quot;], &quot;default_metric&quot;: &quot;min&quot;, &quot;time_series_metric&quot;: &quot;gauge&quot; } ``` Downsampled index has the following mapping: ``` &quot;m&quot;: { &quot;type&quot;: &quot;aggregate_metric_double&quot;, &quot;metrics&quot;: [ &quot;min&quot;, &quot;max&quot;, &quot;sum&quot;, &quot;value_count&quot; ], &quot;default_metric&quot;: &quot;max&quot;, &quot;time_series_metric&quot;: &quot;gauge&quot; } ``` Note the change of `default_metric` from `min` to `max`. ### Logs (if relevant) _No response_</DESCRIPTION>
  <REPONAME>elasticsearch</REPONAME>
  <TIMEDIFFERENCEDAYS>29</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Don't attempt to install modules into test cluster more than once (#121833)</MESSAGE>
    <SHA>56cac1bfe9cec5d74278f0ebeaf975e4263eb0e8</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Copy metrics and default_metric properties when downsampling aggregate_metric_double (#121727) Fixes #119696 and #96076</MESSAGE>
      <SHA>e3e474c337b41f7ada6f0b5d16f1686653502be4</SHA>
      <PATCHEDFILES>
        <FILE>docs/changelog/121727.yaml</FILE>
        <FILE>modules/data-streams/src/main/java/org/elasticsearch/datastreams/DataStreamFeatures.java</FILE>
        <FILE>x-pack/plugin/downsample/qa/rest/src/yamlRestTest/resources/rest-api-spec/test/downsample/80_downsample_aggregate.yml</FILE>
        <FILE>x-pack/plugin/downsample/src/main/java/org/elasticsearch/xpack/downsample/TransportDownsampleAction.java</FILE>
        <FILE>x-pack/plugin/downsample/src/test/java/org/elasticsearch/xpack/downsample/TransportDownsampleActionTests.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Copy metrics and default_metric properties when downsampling aggregate_metric_double (#121727) Fixes #119696 and #96076</MESSAGE>
      <SHA>c37905839c0bd2d334750dd733eda528fb82631d</SHA>
      <PATCHEDFILES>
        <FILE>docs/changelog/121727.yaml</FILE>
        <FILE>modules/data-streams/src/main/java/org/elasticsearch/datastreams/DataStreamFeatures.java</FILE>
        <FILE>x-pack/plugin/downsample/qa/rest/src/yamlRestTest/resources/rest-api-spec/test/downsample/80_downsample_aggregate.yml</FILE>
        <FILE>x-pack/plugin/downsample/src/main/java/org/elasticsearch/xpack/downsample/TransportDownsampleAction.java</FILE>
        <FILE>x-pack/plugin/downsample/src/test/java/org/elasticsearch/xpack/downsample/TransportDownsampleActionTests.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Copy metrics and default_metric properties when downsampling aggregate_metric_double (#121727) Fixes #119696 and #96076</MESSAGE>
      <SHA>a88ae02a867469016f576d996e4f4603d6aca49c</SHA>
      <PATCHEDFILES>
        <FILE>docs/changelog/121727.yaml</FILE>
        <FILE>modules/data-streams/src/main/java/org/elasticsearch/datastreams/DataStreamFeatures.java</FILE>
        <FILE>x-pack/plugin/downsample/qa/rest/src/yamlRestTest/resources/rest-api-spec/test/downsample/80_downsample_aggregate.yml</FILE>
        <FILE>x-pack/plugin/downsample/src/main/java/org/elasticsearch/xpack/downsample/TransportDownsampleAction.java</FILE>
        <FILE>x-pack/plugin/downsample/src/test/java/org/elasticsearch/xpack/downsample/TransportDownsampleActionTests.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Copy metrics and default_metric properties when downsampling aggregate_metric_double (#121727) (#121854) Fixes #119696 and #96076</MESSAGE>
      <SHA>1781a5356e0b04eabff39d98c82563dc68c4267b</SHA>
      <PATCHEDFILES>
        <FILE>docs/changelog/121727.yaml</FILE>
        <FILE>modules/data-streams/src/main/java/org/elasticsearch/datastreams/DataStreamFeatures.java</FILE>
        <FILE>x-pack/plugin/downsample/qa/rest/src/yamlRestTest/resources/rest-api-spec/test/downsample/80_downsample_aggregate.yml</FILE>
        <FILE>x-pack/plugin/downsample/src/main/java/org/elasticsearch/xpack/downsample/TransportDownsampleAction.java</FILE>
        <FILE>x-pack/plugin/downsample/src/test/java/org/elasticsearch/xpack/downsample/TransportDownsampleActionTests.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Copy metrics and default_metric properties when downsampling aggregate_metric_double (#121727) (#121855) Fixes #119696 and #96076</MESSAGE>
      <SHA>5813fa395c6a3b650de3a88aba2f559becc12be7</SHA>
      <PATCHEDFILES>
        <FILE>docs/changelog/121727.yaml</FILE>
        <FILE>modules/data-streams/src/main/java/org/elasticsearch/datastreams/DataStreamFeatures.java</FILE>
        <FILE>x-pack/plugin/downsample/qa/rest/src/yamlRestTest/resources/rest-api-spec/test/downsample/80_downsample_aggregate.yml</FILE>
        <FILE>x-pack/plugin/downsample/src/main/java/org/elasticsearch/xpack/downsample/TransportDownsampleAction.java</FILE>
        <FILE>x-pack/plugin/downsample/src/test/java/org/elasticsearch/xpack/downsample/TransportDownsampleActionTests.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Copy metrics and default_metric properties when downsampling aggregate_metric_double (#121727) (#121853) Fixes #119696 and #96076</MESSAGE>
      <SHA>476286bf89488d59b3181685eaa2d6f98e4efd46</SHA>
      <PATCHEDFILES>
        <FILE>docs/changelog/121727.yaml</FILE>
        <FILE>modules/data-streams/src/main/java/org/elasticsearch/datastreams/DataStreamFeatures.java</FILE>
        <FILE>x-pack/plugin/downsample/qa/rest/src/yamlRestTest/resources/rest-api-spec/test/downsample/80_downsample_aggregate.yml</FILE>
        <FILE>x-pack/plugin/downsample/src/main/java/org/elasticsearch/xpack/downsample/TransportDownsampleAction.java</FILE>
        <FILE>x-pack/plugin/downsample/src/test/java/org/elasticsearch/xpack/downsample/TransportDownsampleActionTests.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
