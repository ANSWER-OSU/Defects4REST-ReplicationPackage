<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>124827</ISSUENO>
  <ISSUEURL>https://github.com/elastic/elasticsearch/issues/124827</ISSUEURL>
  <TITLE>ESQL: API for listing running queries</TITLE>
  <DESCRIPTION>Create an API for listing currently running ESQL queries. ``` GET /_query/queries // returns for each of the running queries // query_id, start_time, running_time, query // could add status one of {&quot;running, cancelled, stopping&quot;} { &quot;queries&quot; : { &quot;abc&quot;: { &quot;id&quot;: &quot;abc&quot;, &quot;start_time_millis&quot;: 14585858875292, &quot;running_time_nanos&quot;: 762794, &quot;query&quot;: &quot;FROM logs* | STATS BY hostname&quot; }, &quot;4321&quot;: { &quot;id&quot;:&quot;4321&quot;, &quot;start_time_millis&quot;: 14585858823573, &quot;running_time_nanos&quot;: 90231, &quot;query&quot;: &quot;FROM orders | LOOKUP country_code ON country&quot; } } } ```</DESCRIPTION>
  <REPONAME>elasticsearch</REPONAME>
  <TIMEDIFFERENCEDAYS>25</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Refactor remote cluster handling in Analyzer (#126426) * Refactor remote cluster handling in Analyzer - Initialize clusters earlier - Simplify cluster set calculation - No need to keep separate skipped list for enrich resolution</MESSAGE>
    <SHA>b21e3253a825278cb3378cb8616aa7ee30f7f81d</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>ESQL: List/get query API (#124832) This PR adds two new REST endpoints, for listing queries and getting information on a current query. * Resolves #124827 * Related to #124828 (initial work) Changes from the API specified in the above issues: * The get API is pretty initial, as we don't have a way of fetching the memory used or number of rows processed. List queries response: ``` GET /_query/queries // returns for each of the running queries // query_id, start_time, running_time, query { &quot;queries&quot; : { &quot;abc&quot;: { &quot;id&quot;: &quot;abc&quot;, &quot;start_time_millis&quot;: 14585858875292, &quot;running_time_nanos&quot;: 762794, &quot;query&quot;: &quot;FROM logs* | STATS BY hostname&quot; }, &quot;4321&quot;: { &quot;id&quot;:&quot;4321&quot;, &quot;start_time_millis&quot;: 14585858823573, &quot;running_time_nanos&quot;: 90231, &quot;query&quot;: &quot;FROM orders | LOOKUP country_code ON country&quot; } } } ``` Get query response: ``` GET /_query/queries/abc { &quot;id&quot; : &quot;abc&quot;, &quot;start_time_millis&quot;: 14585858875292, &quot;running_time_nanos&quot;: 762794, &quot;query&quot;: &quot;FROM logs* | STATS BY hostname&quot; &quot;coordinating_node&quot;: &quot;oTUltX4IQMOUUVeiohTt8A&quot; &quot;data_nodes&quot; : [ &quot;DwrYwfytxthse49X4&quot;, &quot;i5msnbUyWlpe86e7&quot;] } ```</MESSAGE>
      <SHA>953b9fbb83b916cbf8e947dc66e156590691b5cd</SHA>
      <PATCHEDFILES>
        <FILE>docs/changelog/124832.yaml</FILE>
        <FILE>docs/reference/elasticsearch/security-privileges.md</FILE>
        <FILE>rest-api-spec/src/main/resources/rest-api-spec/api/esql.get_query.json</FILE>
        <FILE>rest-api-spec/src/main/resources/rest-api-spec/api/esql.list_queries.json</FILE>
        <FILE>test/framework/src/main/java/org/elasticsearch/test/IntOrLongMatcher.java</FILE>
        <FILE>x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ClientHelper.java</FILE>
        <FILE>x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/security/authz/privilege/ClusterPrivilegeResolver.java</FILE>
        <FILE>x-pack/plugin/esql-core/src/main/java/org/elasticsearch/xpack/esql/core/async/AsyncTaskManagementService.java</FILE>
        <FILE>x-pack/plugin/esql/qa/security/src/javaRestTest/java/org/elasticsearch/xpack/esql/EsqlSecurityIT.java</FILE>
        <FILE>x-pack/plugin/esql/qa/security/src/javaRestTest/resources/roles.yml</FILE>
        <FILE>x-pack/plugin/esql/qa/server/src/main/java/org/elasticsearch/xpack/esql/qa/rest/RestEsqlTestCase.java</FILE>
        <FILE>x-pack/plugin/esql/qa/testFixtures/src/main/java/org/elasticsearch/xpack/esql/EsqlTestUtils.java</FILE>
        <FILE>x-pack/plugin/esql/src/internalClusterTest/java/org/elasticsearch/xpack/esql/action/AsyncEsqlQueryActionIT.java</FILE>
        <FILE>x-pack/plugin/esql/src/internalClusterTest/java/org/elasticsearch/xpack/esql/action/EsqlListQueriesActionIT.java</FILE>
        <FILE>x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/action/EsqlCapabilities.java</FILE>
        <FILE>x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/action/EsqlGetQueryAction.java</FILE>
        <FILE>x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/action/EsqlGetQueryRequest.java</FILE>
        <FILE>x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/action/EsqlListQueriesAction.java</FILE>
        <FILE>x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/action/EsqlListQueriesRequest.java</FILE>
        <FILE>x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/action/RestEsqlListQueriesAction.java</FILE>
        <FILE>x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/plugin/EsqlGetQueryResponse.java</FILE>
        <FILE>x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/plugin/EsqlListQueriesResponse.java</FILE>
        <FILE>x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/plugin/EsqlPlugin.java</FILE>
        <FILE>x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/plugin/TransportEsqlGetQueryAction.java</FILE>
        <FILE>x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/plugin/TransportEsqlListQueriesAction.java</FILE>
        <FILE>x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/plugin/TransportEsqlQueryAction.java</FILE>
        <FILE>x-pack/plugin/security/qa/operator-privileges-tests/src/javaRestTest/java/org/elasticsearch/xpack/security/operator/Constants.java</FILE>
        <FILE>x-pack/plugin/security/src/main/java/org/elasticsearch/xpack/security/authz/AuthorizationUtils.java</FILE>
        <FILE>x-pack/plugin/src/yamlRestTest/resources/rest-api-spec/test/esql/200_queries.yml</FILE>
        <FILE>x-pack/plugin/src/yamlRestTest/resources/rest-api-spec/test/privileges/11_builtin.yml</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
