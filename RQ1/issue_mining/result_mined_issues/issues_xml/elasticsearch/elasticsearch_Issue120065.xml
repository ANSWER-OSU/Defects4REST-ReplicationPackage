<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>120065</ISSUENO>
  <ISSUEURL>https://github.com/elastic/elasticsearch/issues/120065</ISSUEURL>
  <TITLE>[Transform] Unblock when destination index changes</TITLE>
  <DESCRIPTION>When a destination index is write blocked, changing the destination index via the `_update` API should allow the Transform to progress.</DESCRIPTION>
  <REPONAME>elasticsearch</REPONAME>
  <TIMEDIFFERENCEDAYS>3</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Clean up lingering tasks after DatafeedJobsIT. (#120040)</MESSAGE>
    <SHA>67e1bd46a6d45e0d1e2f7d6f22486413f42bf48e</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>[Transform] Unblock after update If an update changes the destination index, optimistically assume the new destination index does not have a write block and try to run the transform. If the new destination index has a write block, the transform will drop the run and move back into a blocked state. Fix #120065</MESSAGE>
      <SHA>b6dd7a50354201af9e73f9b804ed8ecf103f605e</SHA>
      <PATCHEDFILES>
        <FILE>x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/transform/transforms/TransformConfigUpdate.java</FILE>
        <FILE>x-pack/plugin/core/src/test/java/org/elasticsearch/xpack/core/transform/transforms/TransformConfigTests.java</FILE>
        <FILE>x-pack/plugin/core/src/test/java/org/elasticsearch/xpack/core/transform/transforms/TransformConfigUpdateTests.java</FILE>
        <FILE>x-pack/plugin/transform/qa/multi-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/transform/integration/TransformIT.java</FILE>
        <FILE>x-pack/plugin/transform/qa/multi-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/transform/integration/TransformRestTestCase.java</FILE>
        <FILE>x-pack/plugin/transform/src/main/java/org/elasticsearch/xpack/transform/action/TransportUpdateTransformAction.java</FILE>
        <FILE>x-pack/plugin/transform/src/main/java/org/elasticsearch/xpack/transform/transforms/TransformTask.java</FILE>
        <FILE>x-pack/plugin/transform/src/test/java/org/elasticsearch/xpack/transform/transforms/TransformTaskTests.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>[Transform] Unblock after update (#120144) If an update changes the destination index, optimistically assume the new destination index does not have a write block and try to run the transform. If the new destination index has a write block, the transform will drop the run and move back into a blocked state. Fix #120065</MESSAGE>
      <SHA>6bc2683b8ca64a570fb16e3eb829b6359cbd87bb</SHA>
      <PATCHEDFILES>
        <FILE>x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/transform/transforms/TransformConfigUpdate.java</FILE>
        <FILE>x-pack/plugin/core/src/test/java/org/elasticsearch/xpack/core/transform/transforms/TransformConfigTests.java</FILE>
        <FILE>x-pack/plugin/core/src/test/java/org/elasticsearch/xpack/core/transform/transforms/TransformConfigUpdateTests.java</FILE>
        <FILE>x-pack/plugin/transform/qa/multi-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/transform/integration/TransformIT.java</FILE>
        <FILE>x-pack/plugin/transform/qa/multi-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/transform/integration/TransformRestTestCase.java</FILE>
        <FILE>x-pack/plugin/transform/src/main/java/org/elasticsearch/xpack/transform/action/TransportUpdateTransformAction.java</FILE>
        <FILE>x-pack/plugin/transform/src/main/java/org/elasticsearch/xpack/transform/transforms/TransformTask.java</FILE>
        <FILE>x-pack/plugin/transform/src/test/java/org/elasticsearch/xpack/transform/transforms/TransformTaskTests.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>[Transform] Unblock after update (#120144) If an update changes the destination index, optimistically assume the new destination index does not have a write block and try to run the transform. If the new destination index has a write block, the transform will drop the run and move back into a blocked state. Fix #120065</MESSAGE>
      <SHA>0971f43e648b64f872b31177ee185849a6f772a7</SHA>
      <PATCHEDFILES>
        <FILE>x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/transform/transforms/TransformConfigUpdate.java</FILE>
        <FILE>x-pack/plugin/core/src/test/java/org/elasticsearch/xpack/core/transform/transforms/TransformConfigTests.java</FILE>
        <FILE>x-pack/plugin/core/src/test/java/org/elasticsearch/xpack/core/transform/transforms/TransformConfigUpdateTests.java</FILE>
        <FILE>x-pack/plugin/transform/qa/multi-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/transform/integration/TransformIT.java</FILE>
        <FILE>x-pack/plugin/transform/qa/multi-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/transform/integration/TransformRestTestCase.java</FILE>
        <FILE>x-pack/plugin/transform/src/main/java/org/elasticsearch/xpack/transform/action/TransportUpdateTransformAction.java</FILE>
        <FILE>x-pack/plugin/transform/src/main/java/org/elasticsearch/xpack/transform/transforms/TransformTask.java</FILE>
        <FILE>x-pack/plugin/transform/src/test/java/org/elasticsearch/xpack/transform/transforms/TransformTaskTests.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>[Transform] Unblock after update (#120144) If an update changes the destination index, optimistically assume the new destination index does not have a write block and try to run the transform. If the new destination index has a write block, the transform will drop the run and move back into a blocked state. Fix #120065</MESSAGE>
      <SHA>4db9f229c0e9e7cd1579a28d909b3b70f2f4ff70</SHA>
      <PATCHEDFILES>
        <FILE>x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/transform/transforms/TransformConfigUpdate.java</FILE>
        <FILE>x-pack/plugin/core/src/test/java/org/elasticsearch/xpack/core/transform/transforms/TransformConfigTests.java</FILE>
        <FILE>x-pack/plugin/core/src/test/java/org/elasticsearch/xpack/core/transform/transforms/TransformConfigUpdateTests.java</FILE>
        <FILE>x-pack/plugin/transform/qa/multi-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/transform/integration/TransformIT.java</FILE>
        <FILE>x-pack/plugin/transform/qa/multi-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/transform/integration/TransformRestTestCase.java</FILE>
        <FILE>x-pack/plugin/transform/src/main/java/org/elasticsearch/xpack/transform/action/TransportUpdateTransformAction.java</FILE>
        <FILE>x-pack/plugin/transform/src/main/java/org/elasticsearch/xpack/transform/transforms/TransformTask.java</FILE>
        <FILE>x-pack/plugin/transform/src/test/java/org/elasticsearch/xpack/transform/transforms/TransformTaskTests.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>[Transform] Unblock after update (#120144) (#120322) If an update changes the destination index, optimistically assume the new destination index does not have a write block and try to run the transform. If the new destination index has a write block, the transform will drop the run and move back into a blocked state. Fix #120065</MESSAGE>
      <SHA>2be3b3005a41ee812fced0e6e44a92bdeeef1d80</SHA>
      <PATCHEDFILES>
        <FILE>x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/transform/transforms/TransformConfigUpdate.java</FILE>
        <FILE>x-pack/plugin/core/src/test/java/org/elasticsearch/xpack/core/transform/transforms/TransformConfigTests.java</FILE>
        <FILE>x-pack/plugin/core/src/test/java/org/elasticsearch/xpack/core/transform/transforms/TransformConfigUpdateTests.java</FILE>
        <FILE>x-pack/plugin/transform/qa/multi-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/transform/integration/TransformIT.java</FILE>
        <FILE>x-pack/plugin/transform/qa/multi-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/transform/integration/TransformRestTestCase.java</FILE>
        <FILE>x-pack/plugin/transform/src/main/java/org/elasticsearch/xpack/transform/action/TransportUpdateTransformAction.java</FILE>
        <FILE>x-pack/plugin/transform/src/main/java/org/elasticsearch/xpack/transform/transforms/TransformTask.java</FILE>
        <FILE>x-pack/plugin/transform/src/test/java/org/elasticsearch/xpack/transform/transforms/TransformTaskTests.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
