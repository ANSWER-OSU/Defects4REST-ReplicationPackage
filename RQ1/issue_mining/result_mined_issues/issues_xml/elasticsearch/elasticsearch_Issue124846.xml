<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>124846</ISSUENO>
  <ISSUEURL>https://github.com/elastic/elasticsearch/issues/124846</ISSUEURL>
  <TITLE>[CI] DataStreamLifecycleServiceIT testAutomaticForceMerge failing</TITLE>
  <DESCRIPTION>**Build Scans:** - [elasticsearch-periodic-platform-support #7007 / ubuntu-2004-aarch64_checkpart1_platform-support-arm](https://gradle-enterprise.elastic.co/s/uxfxg6ocdj3j2) - [elasticsearch-periodic-platform-support #7007 / ubuntu-2004_platform-support-unix](https://gradle-enterprise.elastic.co/s/5w3fhu75hzhhs) - [elasticsearch-periodic #6985 / openjdk23_entitlements_true_checkpart1_java-matrix](https://gradle-enterprise.elastic.co/s/hxd27kcyns6pi) - [elasticsearch-pull-request #62601 / part-1](https://gradle-enterprise.elastic.co/s/dscjlzw6jr7fm) **Reproduction Line:** ``` ./gradlew &quot;:modules:data-streams:internalClusterTest&quot; --tests &quot;org.elasticsearch.datastreams.lifecycle.DataStreamLifecycleServiceIT.testAutomaticForceMerge&quot; -Dtests.seed=A4A18D06FC83A975 -Dtests.locale=ksb -Dtests.timezone=America/Cambridge_Bay -Druntime.java=23 ``` **Applicable branches:** main **Reproduces locally?:** N/A **Failure History:** [See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&amp;_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.datastreams.lifecycle.DataStreamLifecycleServiceIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(testAutomaticForceMerge),title:'Test',type:optionsListControl))))) **Failure Message:** ``` java.lang.ArrayIndexOutOfBoundsException: Index 1 out of bounds for length 1 ``` **Issue Reasons:** - [main] 4 failures in test testAutomaticForceMerge (1.9% fail rate in 214 executions) **Note:** This issue was created using new test triage automation. Please report issues or feedback to es-delivery.</DESCRIPTION>
  <REPONAME>elasticsearch</REPONAME>
  <TIMEDIFFERENCEDAYS>10</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Refactor CrossClusterQueryWithPartialResultsIT tests (#124811)</MESSAGE>
    <SHA>35cdc82743020c932947f631a8e8187597f10eb0</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Mute org.elasticsearch.datastreams.lifecycle.DataStreamLifecycleServiceIT testAutomaticForceMerge #124846</MESSAGE>
      <SHA>1e8edd5abd84bd3eae1390ec05c976dcb24729ea</SHA>
      <PATCHEDFILES>
        <FILE>muted-tests.yml</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fix data stream retrieval in `DataStreamLifecycleServiceIT` These tests had the potential to fail when two consecutive GET data streams requests would hit two different nodes, where one node already had the cluster state that contained the new backing index and the other node didn't yet. Caused by #122852 Fixes #124846 Fixes #124950 Fixes #124999</MESSAGE>
      <SHA>8fd96df63957d9e852b925a2fceb7285332c584d</SHA>
      <PATCHEDFILES>
        <FILE>modules/data-streams/src/internalClusterTest/java/org/elasticsearch/datastreams/lifecycle/DataStreamLifecycleServiceIT.java</FILE>
        <FILE>muted-tests.yml</FILE>
        <FILE>server/src/internalClusterTest/java/org/elasticsearch/persistent/PersistentTaskCreationFailureIT.java</FILE>
        <FILE>server/src/internalClusterTest/java/org/elasticsearch/snapshots/SnapshotShutdownIT.java</FILE>
        <FILE>server/src/internalClusterTest/java/org/elasticsearch/snapshots/SnapshotsServiceIT.java</FILE>
        <FILE>server/src/test/java/org/elasticsearch/snapshots/SnapshotResiliencyTests.java</FILE>
        <FILE>test/framework/src/main/java/org/elasticsearch/test/ClusterServiceUtils.java</FILE>
        <FILE>test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fix data stream retrieval in `DataStreamLifecycleServiceIT` (#125195) These tests had the potential to fail when two consecutive GET data streams requests would hit two different nodes, where one node already had the cluster state that contained the new backing index and the other node didn't yet. Caused by #122852 Fixes #124846 Fixes #124950 Fixes #124999</MESSAGE>
      <SHA>542a3b65a9acd9ff33eb836a4aed183bcadc0508</SHA>
      <PATCHEDFILES>
        <FILE>modules/data-streams/src/internalClusterTest/java/org/elasticsearch/datastreams/lifecycle/DataStreamLifecycleServiceIT.java</FILE>
        <FILE>muted-tests.yml</FILE>
        <FILE>test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fix data stream retrieval in `DataStreamLifecycleServiceIT` (#125195) These tests had the potential to fail when two consecutive GET data streams requests would hit two different nodes, where one node already had the cluster state that contained the new backing index and the other node didn't yet. Caused by #122852 Fixes #124846 Fixes #124950 Fixes #124999</MESSAGE>
      <SHA>c9e72dcbb682efcbdfd1e0508c47867d0447c04f</SHA>
      <PATCHEDFILES>
        <FILE>modules/data-streams/src/internalClusterTest/java/org/elasticsearch/datastreams/lifecycle/DataStreamLifecycleServiceIT.java</FILE>
        <FILE>muted-tests.yml</FILE>
        <FILE>test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
