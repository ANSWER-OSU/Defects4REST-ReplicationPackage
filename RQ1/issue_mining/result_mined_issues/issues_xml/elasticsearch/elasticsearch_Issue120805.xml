<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>120805</ISSUENO>
  <ISSUEURL>https://github.com/elastic/elasticsearch/issues/120805</ISSUEURL>
  <TITLE>[CI] LearningToRankExplainIT testLtrExplainWithMultipleShardsAndReplicas failing</TITLE>
  <DESCRIPTION>**Build Scans:** - [elasticsearch-intake #16352 / part4](https://gradle-enterprise.elastic.co/s/ngjja3obvylta) - [elasticsearch-pull-request #52578 / part-4](https://gradle-enterprise.elastic.co/s/qpfpv5gdudnhu) - [elasticsearch-pull-request #52563 / part-4](https://gradle-enterprise.elastic.co/s/azbriwzq35b5o) - [elasticsearch-pull-request #52281 / part-4](https://gradle-enterprise.elastic.co/s/6s5y7hf3u5d6g) **Reproduction Line:** ``` ./gradlew &quot;:x-pack:plugin:ml:internalClusterTest&quot; --tests &quot;org.elasticsearch.xpack.ml.integration.LearningToRankExplainIT.testLtrExplainWithMultipleShardsAndReplicas&quot; -Dtests.seed=68B2754ED2EB1699 -Dtests.locale=lv -Dtests.timezone=America/Guyana -Druntime.java=23 ``` **Applicable branches:** main **Reproduces locally?:** N/A **Failure History:** [See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&amp;_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.ml.integration.LearningToRankExplainIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(testLtrExplainWithMultipleShardsAndReplicas),title:'Test',type:optionsListControl))))) **Failure Message:** ``` java.lang.AssertionError: Expected: &lt;2L&gt; but: was &lt;1L&gt; ``` **Issue Reasons:** - [main] 4 failures in test testLtrExplainWithMultipleShardsAndReplicas (33.3% fail rate in 12 executions) - [main] 3 failures in step part-4 (33.3% fail rate in 9 executions) - [main] 3 failures in pipeline elasticsearch-pull-request (33.3% fail rate in 9 executions) **Note:** This issue was created using new test triage automation. Please report issues or feedback to es-delivery.</DESCRIPTION>
  <REPONAME>elasticsearch</REPONAME>
  <TIMEDIFFERENCEDAYS>6</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Refresh source index before reindexing data stream index (#120752) Add step to the ReindexDatastreamIndexAction which refreshes the source index after setting it to read-only but before calling reindex. Without doing a refresh it is possible for docs from the source index to be missing from the destination index. This happens because the docs arrived before the source index is set to read-only, but because the index hasn't refreshed, the reindex action cannot see these updates.</MESSAGE>
    <SHA>484a95043d4dc8303e7b80228a2357d5495951e3</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Mute org.elasticsearch.xpack.ml.integration.LearningToRankExplainIT testLtrExplainWithMultipleShardsAndReplicas #120805</MESSAGE>
      <SHA>29afce6e003aed9db8067c2720c4e6902dd886ef</SHA>
      <PATCHEDFILES>
        <FILE>muted-tests.yml</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
