<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>121487</ISSUENO>
  <ISSUEURL>https://github.com/elastic/elasticsearch/issues/121487</ISSUEURL>
  <TITLE>[CI] CrossClusterAsyncQueryIT testStopQueryLocal failing</TITLE>
  <DESCRIPTION>**Build Scans:** - [elasticsearch-periodic-platform-support #6121 / windows-2022_checkpart3_platform-support-windows](https://gradle-enterprise.elastic.co/s/e477filxopmp4) - [elasticsearch-pull-request #54427 / part-3](https://gradle-enterprise.elastic.co/s/erwmnt476x6qk) - [elasticsearch-pull-request #54172 / part-3](https://gradle-enterprise.elastic.co/s/l7rsptlfwpwro) **Reproduction Line:** ``` gradlew &quot;:x-pack:plugin:esql:internalClusterTest&quot; --tests &quot;org.elasticsearch.xpack.esql.action.CrossClusterAsyncQueryIT.testStopQueryLocal&quot; -Dtests.seed=9118AB4453C6411D -Dtests.locale=fr-PM -Dtests.timezone=Africa/Ouagadougou -Druntime.java=23 ``` **Applicable branches:** main **Reproduces locally?:** N/A **Failure History:** [See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&amp;_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.esql.action.CrossClusterAsyncQueryIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(testStopQueryLocal),title:'Test',type:optionsListControl))))) **Failure Message:** ``` java.lang.AssertionError: Expected: not &lt;running&gt; but: was &lt;running&gt; ``` **Issue Reasons:** - [main] 3 failures in test testStopQueryLocal (0.9% fail rate in 327 executions) - [main] 2 failures in step part-3 (1.5% fail rate in 132 executions) - [main] 2 failures in pipeline elasticsearch-pull-request (1.5% fail rate in 131 executions) **Note:** This issue was created using new test triage automation. Please report issues or feedback to es-delivery.</DESCRIPTION>
  <REPONAME>elasticsearch</REPONAME>
  <TIMEDIFFERENCEDAYS>5</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Remove outdated assertion from #118214 (#121435) Asserting that we definitely saw the &quot;received a single result&quot; flag and can now deal with null responses, isn't applicable after a few recent fixes. New requests are sent out before responses are fully processed to keep data nodes in a tighter loop (as well as other relaxed ordering relative to when this assertion was added) so the flag is not guaranteed to show up as true for lower numbers of shard requests any longer. Lets just remove it, it was always best effort and accidental that this worked for the numbers the test randomizes over.</MESSAGE>
    <SHA>2b410c44eb8fc684d3986247a49f9696b44f2d4c</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Mute org.elasticsearch.xpack.esql.action.CrossClusterAsyncQueryIT testStopQueryLocal #121487</MESSAGE>
      <SHA>9e73518097d8fae4203be61e60ec6acd9997c702</SHA>
      <PATCHEDFILES>
        <FILE>muted-tests.yml</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
