<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>121913</ISSUENO>
  <ISSUEURL>https://github.com/elastic/elasticsearch/issues/121913</ISSUEURL>
  <TITLE>[Transform] Delete API fails when destination index writes to alias</TITLE>
  <DESCRIPTION>When a transform writes to an alias, calling the Delete API with `delete_dest_index` throws an IllegalArgumentException: ```python BadRequestError: BadRequestError(400, 'illegal_argument_exception', 'The provided expression [dice-rolls-write] matches an alias, specify the corresponding concrete indices instead.') ``` ```python from elasticsearch import Elasticsearch import os from datetime import datetime, timezone import numpy as np import time # Initialize Client es_url = os.getenv(&quot;ES_URL&quot;, &quot;http://localhost:9200&quot;) es_user = os.getenv(&quot;ES_USERNAME&quot;, &quot;elastic&quot;) es_password = os.getenv(&quot;ES_PASSWORD&quot;, &quot;password&quot;) es = Elasticsearch( hosts=es_url, basic_auth=(es_user, es_password), verify_certs=False, ssl_show_warn=False ) es.cluster.put_settings( flat_settings=&quot;true&quot;, body={&quot;transient&quot;: {&quot;logger.org.elasticsearch.xpack.transform.transforms&quot;: &quot;debug&quot;}}, ) source_index=&quot;random-dice&quot; dest_index=&quot;dice-rolls&quot; dest_index_alias=&quot;dice-rolls-write&quot; transform_id=&quot;dice-rolls&quot; print(&quot;Loading first value into index&quot;) print(es.index(index=source_index, document={ 'value': np.random.randint(1,21), 'time': datetime.now(timezone.utc) })) print(&quot;Creating Index &amp; Alias&quot;) print(es.indices.create(index=dest_index)) print(es.indices.update_aliases( actions=[ { &quot;add&quot;: { &quot;index&quot;: dest_index, &quot;alias&quot;: dest_index_alias } } ], )) print(&quot;Creating Transform&quot;) es.transform.put_transform( transform_id=transform_id, source={ &quot;index&quot;: source_index }, dest={ &quot;index&quot;: dest_index_alias }, pivot={ &quot;group_by&quot;: { &quot;dice value&quot;: { &quot;terms&quot;: { &quot;field&quot;: &quot;value&quot;, &quot;missing_bucket&quot;: True } } }, &quot;aggregations&quot;: { &quot;occurrences&quot;: { &quot;value_count&quot;: { &quot;field&quot;: &quot;value&quot; } } } }, frequency= &quot;5s&quot;, sync= { &quot;time&quot;: { &quot;field&quot;: &quot;time&quot;, &quot;delay&quot;: &quot;5s&quot; } } ) print(&quot;Starting Transform&quot;) print(es.transform.start_transform( transform_id=transform_id )) print(&quot;Stopping Transform&quot;) print(es.transform.stop_transform( transform_id=transform_id, wait_for_completion=True )) print(&quot;Deleting Transform&quot;) print(es.transform.delete_transform( transform_id=transform_id, delete_dest_index=True )) ```</DESCRIPTION>
  <REPONAME>elasticsearch</REPONAME>
  <TIMEDIFFERENCEDAYS>6</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Validate transport handshake from known version (#121747) With parallel releases on multiple branches it's possible that an older branch sees a transport version update that is not known to a numerically newer but chronologically older version. In that case the two nodes cannot intercommunicate, so with this commit we reject such connection attempts at the version negotiation stage.</MESSAGE>
    <SHA>5302589639ca231222383ca49eeaf21691c1183d</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>[Transform] Delete Alias Write Index When the Transform is configured to write to an alias, specifying `DELETE _transform/&lt;id&gt;?delete_dest_index` will follow the alias to the concrete destination index. Fix #121913</MESSAGE>
      <SHA>fcb70d88cf8b180bfc6329b6b943dbe24355570c</SHA>
      <PATCHEDFILES>
        <FILE>docs/reference/transform/apis/delete-transform.asciidoc</FILE>
        <FILE>x-pack/plugin/transform/qa/single-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/transform/integration/TransformDeleteIT.java</FILE>
        <FILE>x-pack/plugin/transform/qa/single-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/transform/integration/TransformResetIT.java</FILE>
        <FILE>x-pack/plugin/transform/qa/single-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/transform/integration/TransformRestTestCase.java</FILE>
        <FILE>x-pack/plugin/transform/src/main/java/org/elasticsearch/xpack/transform/action/TransportDeleteTransformAction.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>[Transform] Delete Alias Write Index (#122074) When the Transform is configured to write to an alias, specifying `DELETE _transform/&lt;id&gt;?delete_dest_index` will follow the alias to the concrete destination index. Fix #121913 Co-authored-by: Przemysław Witek &lt;przemyslaw.witek@elastic.co&gt;</MESSAGE>
      <SHA>713e5893889bd1d35bbb2426e46f5791ea16e21e</SHA>
      <PATCHEDFILES>
        <FILE>docs/changelog/122074.yaml</FILE>
        <FILE>x-pack/plugin/transform/qa/single-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/transform/integration/TransformDeleteIT.java</FILE>
        <FILE>x-pack/plugin/transform/qa/single-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/transform/integration/TransformRestTestCase.java</FILE>
        <FILE>x-pack/plugin/transform/src/main/java/org/elasticsearch/xpack/transform/action/TransportDeleteTransformAction.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>[Transform] Delete Alias Write Index (#122074) When the Transform is configured to write to an alias, specifying `DELETE _transform/&lt;id&gt;?delete_dest_index` will follow the alias to the concrete destination index. Fix #121913 Co-authored-by: Przemysław Witek &lt;przemyslaw.witek@elastic.co&gt;</MESSAGE>
      <SHA>e2a8be973fecf4c543efd5c551975a9a478c5221</SHA>
      <PATCHEDFILES>
        <FILE>docs/changelog/122074.yaml</FILE>
        <FILE>x-pack/plugin/transform/qa/single-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/transform/integration/TransformDeleteIT.java</FILE>
        <FILE>x-pack/plugin/transform/qa/single-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/transform/integration/TransformRestTestCase.java</FILE>
        <FILE>x-pack/plugin/transform/src/main/java/org/elasticsearch/xpack/transform/action/TransportDeleteTransformAction.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>[Transform] Delete Alias Write Index (#122074) When the Transform is configured to write to an alias, specifying `DELETE _transform/&lt;id&gt;?delete_dest_index` will follow the alias to the concrete destination index. Fix #121913 Co-authored-by: Przemysław Witek &lt;przemyslaw.witek@elastic.co&gt;</MESSAGE>
      <SHA>927ed303a7381adcd7e33499fe273806b3f29541</SHA>
      <PATCHEDFILES>
        <FILE>docs/changelog/122074.yaml</FILE>
        <FILE>x-pack/plugin/transform/qa/single-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/transform/integration/TransformDeleteIT.java</FILE>
        <FILE>x-pack/plugin/transform/qa/single-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/transform/integration/TransformRestTestCase.java</FILE>
        <FILE>x-pack/plugin/transform/src/main/java/org/elasticsearch/xpack/transform/action/TransportDeleteTransformAction.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>[Transform] Delete Alias Write Index (#122074) When the Transform is configured to write to an alias, specifying `DELETE _transform/&lt;id&gt;?delete_dest_index` will follow the alias to the concrete destination index. Fix #121913 Co-authored-by: Przemysław Witek &lt;przemyslaw.witek@elastic.co&gt;</MESSAGE>
      <SHA>99c53981374841296778026e0f6fe12d91a7f39a</SHA>
      <PATCHEDFILES>
        <FILE>docs/changelog/122074.yaml</FILE>
        <FILE>x-pack/plugin/transform/qa/single-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/transform/integration/TransformDeleteIT.java</FILE>
        <FILE>x-pack/plugin/transform/qa/single-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/transform/integration/TransformRestTestCase.java</FILE>
        <FILE>x-pack/plugin/transform/src/main/java/org/elasticsearch/xpack/transform/action/TransportDeleteTransformAction.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>[Transform] Delete Alias Write Index (#122074) (#122403) When the Transform is configured to write to an alias, specifying `DELETE _transform/&lt;id&gt;?delete_dest_index` will follow the alias to the concrete destination index. Fix #121913 Co-authored-by: Przemysław Witek &lt;przemyslaw.witek@elastic.co&gt;</MESSAGE>
      <SHA>efa422c9809e15e9b0c2a5b629cc93d02fe66d19</SHA>
      <PATCHEDFILES>
        <FILE>docs/changelog/122074.yaml</FILE>
        <FILE>x-pack/plugin/transform/qa/single-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/transform/integration/TransformDeleteIT.java</FILE>
        <FILE>x-pack/plugin/transform/qa/single-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/transform/integration/TransformRestTestCase.java</FILE>
        <FILE>x-pack/plugin/transform/src/main/java/org/elasticsearch/xpack/transform/action/TransportDeleteTransformAction.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>[8.x] [Transform] Delete Alias Write Index (#122074) (#122405) * [Transform] Delete Alias Write Index (#122074) When the Transform is configured to write to an alias, specifying `DELETE _transform/&lt;id&gt;?delete_dest_index` will follow the alias to the concrete destination index. Fix #121913 Co-authored-by: Przemysław Witek &lt;przemyslaw.witek@elastic.co&gt; * Update for 8.x api --------- Co-authored-by: Przemysław Witek &lt;przemyslaw.witek@elastic.co&gt;</MESSAGE>
      <SHA>489e2d6692b510d9118a5d366792e40dbfee9620</SHA>
      <PATCHEDFILES>
        <FILE>docs/changelog/122074.yaml</FILE>
        <FILE>x-pack/plugin/transform/qa/single-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/transform/integration/TransformDeleteIT.java</FILE>
        <FILE>x-pack/plugin/transform/qa/single-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/transform/integration/TransformRestTestCase.java</FILE>
        <FILE>x-pack/plugin/transform/src/main/java/org/elasticsearch/xpack/transform/action/TransportDeleteTransformAction.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>[8.18] [Transform] Delete Alias Write Index (#122074) (#122404) * [Transform] Delete Alias Write Index (#122074) When the Transform is configured to write to an alias, specifying `DELETE _transform/&lt;id&gt;?delete_dest_index` will follow the alias to the concrete destination index. Fix #121913 Co-authored-by: Przemysław Witek &lt;przemyslaw.witek@elastic.co&gt; * Update for 8.x api --------- Co-authored-by: Przemysław Witek &lt;przemyslaw.witek@elastic.co&gt;</MESSAGE>
      <SHA>928762b82520faf496706d4cd64ff117430b7b97</SHA>
      <PATCHEDFILES>
        <FILE>docs/changelog/122074.yaml</FILE>
        <FILE>x-pack/plugin/transform/qa/single-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/transform/integration/TransformDeleteIT.java</FILE>
        <FILE>x-pack/plugin/transform/qa/single-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/transform/integration/TransformRestTestCase.java</FILE>
        <FILE>x-pack/plugin/transform/src/main/java/org/elasticsearch/xpack/transform/action/TransportDeleteTransformAction.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
