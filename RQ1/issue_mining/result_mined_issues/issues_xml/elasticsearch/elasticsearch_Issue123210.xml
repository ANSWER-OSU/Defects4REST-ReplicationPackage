<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>123210</ISSUENO>
  <ISSUEURL>https://github.com/elastic/elasticsearch/issues/123210</ISSUEURL>
  <TITLE>[CI] RestEsqlIT testForceSleepsProfile {ASYNC} failing</TITLE>
  <DESCRIPTION>**Build Scans:** - [elasticsearch-periodic-platform-support #6551 / rhel-7_platform-support-unix](https://gradle-enterprise.elastic.co/s/faiy5ummuues2) - [elasticsearch-periodic-platform-support #6516 / rhel-7_platform-support-unix](https://gradle-enterprise.elastic.co/s/hiugvpmtjy2fg) **Reproduction Line:** ``` ./gradlew &quot;:x-pack:plugin:esql:qa:server:single-node:javaRestTest&quot; --tests &quot;org.elasticsearch.xpack.esql.qa.single_node.RestEsqlIT.testForceSleepsProfile {ASYNC}&quot; -Dtests.seed=EE63D76CE1F08C05 -Dtests.locale=ia -Dtests.timezone=America/Montevideo -Druntime.java=23 ``` **Applicable branches:** 8.18 **Reproduces locally?:** N/A **Failure History:** [See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&amp;_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.esql.qa.single_node.RestEsqlIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(testForceSleepsProfile%20%7BASYNC%7D),title:'Test',type:optionsListControl))))) **Failure Message:** ``` java.lang.AssertionError: Expected a map containing counts: a map containing exchange empty: expected &lt;1&gt; but was &lt;2&gt; first: a list containing 0: a map containing reason: &quot;exchange empty&quot; sleep_millis: &lt;1740209910016L&gt; wake_millis: &lt;1740209911146L&gt; 1: &lt;unexpected&gt; but was &lt;{reason=exchange empty, sleep_millis=1740209911388, wake_millis=1740209911507}&gt; last: a list containing 0: a map containing reason: &quot;exchange empty&quot; sleep_millis: &lt;1740209910016L&gt; wake_millis: &lt;1740209911146L&gt; 1: &lt;unexpected&gt; but was &lt;{reason=exchange empty, sleep_millis=1740209911388, wake_millis=1740209911507}&gt; ``` **Issue Reasons:** - [8.18] 2 failures in test testForceSleepsProfile {ASYNC} (0.9% fail rate in 226 executions) - [8.18] 2 failures in step rhel-7_platform-support-unix (33.3% fail rate in 6 executions) - [8.18] 2 failures in pipeline elasticsearch-periodic-platform-support (33.3% fail rate in 6 executions) **Note:** This issue was created using new test triage automation. Please report issues or feedback to es-delivery.</DESCRIPTION>
  <REPONAME>elasticsearch</REPONAME>
  <TIMEDIFFERENCEDAYS>9</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Update Flatten Graph Docs to Include a Real Flattened Graph 8.x (#123900) updated flatten graph docs to include a real flattened graph</MESSAGE>
    <SHA>c2bbe83f7fdd3ac68101f0bccb8f2d09727ded9c</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Relax profiles assertions (#123919) If the final driver is woken up before the exchange buffer is finished, there will be two sleeps in its profile instead of one. We don't need these assertions to be so precise. This change relaxes the assertions to allow reduce operators to have more than one sleep. Closes #123210</MESSAGE>
      <SHA>ba715c045735dc80cab6653160a8a67da5c53e24</SHA>
      <PATCHEDFILES>
        <FILE>x-pack/plugin/esql/qa/server/single-node/src/javaRestTest/java/org/elasticsearch/xpack/esql/qa/single_node/RestEsqlIT.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
