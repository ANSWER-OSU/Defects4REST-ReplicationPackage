<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>1111</ISSUENO>
  <ISSUEURL>https://github.com/nopSolutions/nopCommerce/issues/1111</ISSUEURL>
  <TITLE>Problem with a null combination (sold out)</TITLE>
  <DESCRIPTION>I'm working with Nop Commerce 3.6 and with earlier versions. I configure the products selecting &quot;Track inventory by product attributes&quot; and the option &quot;Allow only existing attribute combinations&quot;, to allow only the combinations of attributes which I define. I have a problem: if a customer, trying to add a product in his cart, doesn't select any attributes, he receives a message of &quot;Sold out&quot; and also, correctly, &quot;Please select the attributes&quot;, but the product isn't sold out. I think the reason is this: I allow only the combinations defined by me, so the &quot;null combination&quot; is prevented and is seen as out of stock. Is it a bug or there is a configuration to resolve this problem? I found in ShoppingCartServices this fragment of code ``` case ManageInventoryMethod.ManageStockByAttributes: { var combination = _productAttributeParser.FindProductAttributeCombination(product, attributesXml); if (combination != null) { //combination exists //let's check stock level if (!combination.AllowOutOfStockOrders &amp;&amp; combination.StockQuantity &lt; quantity) { int maximumQuantityCanBeAdded = combination.StockQuantity; if (maximumQuantityCanBeAdded &lt;= 0) { warnings.Add(_localizationService.GetResource(&quot;ShoppingCart.OutOfStock&quot;)); } else { warnings.Add(string.Format(_localizationService.GetResource(&quot;ShoppingCart.QuantityExceedsStock&quot;), maximumQuantityCanBeAdded)); } } } else { //combination doesn't exist if (product.AllowAddingOnlyExistingAttributeCombinations) { //maybe, is it better to display something like &quot;No such product/combination&quot; message? warnings.Add(_localizationService.GetResource(&quot;ShoppingCart.OutOfStock&quot;)); } } } break; default: break; ``` To prevent the validation of null combination I would try to change it in ``` case ManageInventoryMethod.ManageStockByAttributes: { var combination = _productAttributeParser.FindProductAttributeCombination(product, attributesXml); if (combination != null) { //combination exists //let's check stock level if (!combination.AllowOutOfStockOrders &amp;&amp; combination.StockQuantity &lt; quantity) { int maximumQuantityCanBeAdded = combination.StockQuantity; if (maximumQuantityCanBeAdded &lt;= 0) { warnings.Add(_localizationService.GetResource(&quot;ShoppingCart.OutOfStock&quot;)); } else { warnings.Add(string.Format(_localizationService.GetResource(&quot;ShoppingCart.QuantityExceedsStock&quot;), maximumQuantityCanBeAdded)); } } } else { //combination doesn't exist if ((product.AllowAddingOnlyExistingAttributeCombinations)&amp;&amp;(!string.IsNullOrEmpty(attributesXml))) { //maybe, is it better to display something like &quot;No such product/combination&quot; message? warnings.Add(_localizationService.GetResource(&quot;ShoppingCart.OutOfStock&quot;)); } } } break; default: break; ``` Is it the solution or it could cause other problems? Source: http://www.nopcommerce.com/boards/t/40161/problem-with-a-null-combination.aspx</DESCRIPTION>
  <REPONAME>nopCommerce</REPONAME>
  <TIMEDIFFERENCEDAYS>48</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #1291 from sethmoore/develop Fixed messed up project reference</MESSAGE>
    <SHA>cebd9a008396bb555715e683b1a03910e1073279</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>#1111 We should display &quot;out of stock&quot; message (product details page) when a selected attribute combination doesn't exist and &quot;Allow only existing attribute combinations&quot; option is enabled.</MESSAGE>
      <SHA>a546b746788fbac0df16b3023bb8f65de97488e8</SHA>
      <PATCHEDFILES>
        <FILE>src/Libraries/Nop.Services/Catalog/ProductExtensions.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
