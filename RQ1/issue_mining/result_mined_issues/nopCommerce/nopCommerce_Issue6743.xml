<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>6743</ISSUENO>
  <ISSUEURL>https://github.com/nopSolutions/nopCommerce/issues/6743</ISSUEURL>
  <TITLE>Incorrect culture detection on first request when AutomaticallyDetectLanguage disabled</TITLE>
  <DESCRIPTION>nopCommerce version: 4.60.2 Steps to reproduce the problem: Have two languages configured from the admin: one with RTL support (e.g., he-IL) and one can be en-US. Set the display order of he-IL to 0 and en-US to 1. When a customer visits the store for the first time, the default language will be he-IL. However, the culture selected for the first time is en-US. This causes an issue in loading the RTL CSS. Instead, it loads LTR for the first time. This happens because of the default language set in the customer's browser. In my case, it was en-US, and the browser sends the &quot;Accept-Language: en-US,en;q=0.9&quot; request header. The below method is used to set up the cultures of the application: https://github.com/nopSolutions/nopCommerce/blob/7104b704cad742482bc054152f7d1dc2a578c85d/src/Presentation/Nop.Web.Framework/Infrastructure/Extensions/ApplicationBuilderExtensions.cs#L417 By default, .NET Core includes the &quot;[AcceptLanguageHeaderRequestCultureProvider](https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.localization.acceptlanguageheaderrequestcultureprovider?view=aspnetcore-7.0)&quot; in the [RequestCultureProviders](https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.builder.requestlocalizationoptions.requestcultureproviders?view=aspnetcore-7.0) collection. Removing it from the culture providers collection solves the issue, as it's going to use default culture when it could not resolve it from the request.</DESCRIPTION>
  <REPONAME>nopCommerce</REPONAME>
  <TIMEDIFFERENCEDAYS>2</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>#6742 Widgets.FacebookPixel plugin. Ignore errors for search engine user</MESSAGE>
    <SHA>a5bea016f3585d8cf0b76eb5e4f5bb0308558a11</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>#6743 Correct culture detection on first request when AutomaticallyDetectLanguage disabled</MESSAGE>
      <SHA>16a1b5417c722b54197934a16a09cf1e4b73d753</SHA>
      <PATCHEDFILES>
        <FILE>src/Presentation/Nop.Web.Framework/Infrastructure/Extensions/ApplicationBuilderExtensions.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
