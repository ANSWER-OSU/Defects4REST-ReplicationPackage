<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>157</ISSUENO>
  <ISSUEURL>https://github.com/nopSolutions/nopCommerce/issues/157</ISSUEURL>
  <TITLE>More presentation model caching</TITLE>
  <DESCRIPTION>EF entities (e.g. Customer or Order) cannot be cached between requests (EF limitation). And we can cache presentation layer objects only. 1. ProductReviewModel (do not forget about UTC datetime converted to a local one in some cases) 2. News and blog records (do not forget about UTC datetime converted to a local one in some cases). Regarding points 1-2 and dates. We can use the original UTC date in models. And convert dates (to the current customer timezone) only in cshtml files. It'll allow us to cache many models where dates are used. The issue is that in this case we won't be consistent with admin area where we have to convert dates in controllers because in some cases dates are returned using JSON 3. Countries and states UPDATE: See comment by Andrei Mazulnitsyn on March 25th 2019</DESCRIPTION>
  <REPONAME>nopCommerce</REPONAME>
  <TIMEDIFFERENCEDAYS>1165</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>#2527 Performance optimization. Added mroe SQL Server indexes</MESSAGE>
    <SHA>696961185975bb018e93978cad7620b921da7e25</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>#157 Performance optimization. A workaround to cache stores (do not load stores for each HTTP request).</MESSAGE>
      <SHA>c484d1a451c8a15db9bf9f1f95379f9f6e5a802b</SHA>
      <PATCHEDFILES>
        <FILE>src/Libraries/Nop.Core/Caching/IEntityForCaching.cs</FILE>
        <FILE>src/Libraries/Nop.Core/Domain/Stores/Store.cs</FILE>
        <FILE>src/Libraries/Nop.Core/IStoreContext.cs</FILE>
        <FILE>src/Libraries/Nop.Core/Nop.Core.csproj</FILE>
        <FILE>src/Libraries/Nop.Data/Nop.Data.csproj</FILE>
        <FILE>src/Libraries/Nop.Services/Common/PdfService.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Customers/CustomerRegistrationService.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Discounts/DiscountRequirementValidationRequest.cs</FILE>
        <FILE>src/Libraries/Nop.Services/ExportImport/ExportManager.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Localization/LocalizationExtensions.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Messages/MessageTokenProvider.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Messages/WorkflowMessageService.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Stores/IStoreMappingService.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Stores/IStoreService.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Stores/StoreMappingService.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Stores/StoreService.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.DiscountRules.HasOneProduct/Controllers/DiscountRulesHasOneProductController.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Feed.GoogleShopping/Controllers/FeedGoogleShoppingController.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.PayPalDirect/Controllers/PaymentPayPalDirectController.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.PayPalDirect/Description.txt</FILE>
        <FILE>src/Plugins/Nop.Plugin.Pickup.PickupInStore/Controllers/PickupInStoreController.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Pickup.PickupInStore/Description.txt</FILE>
        <FILE>src/Plugins/Nop.Plugin.Shipping.FixedOrByWeight/Controllers/FixedOrByWeightController.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Shipping.FixedOrByWeight/Description.txt</FILE>
        <FILE>src/Plugins/Nop.Plugin.Shipping.FixedOrByWeight/Views/_ByWeight.cshtml</FILE>
        <FILE>src/Plugins/Nop.Plugin.Tax.FixedOrByCountryStateZip/Controllers/FixedOrByCountryStateZipController.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Tax.FixedOrByCountryStateZip/Description.txt</FILE>
        <FILE>src/Presentation/Nop.Web.Framework/Controllers/BaseController.cs</FILE>
        <FILE>src/Presentation/Nop.Web.Framework/Extensions/HtmlExtensions.cs</FILE>
        <FILE>src/Presentation/Nop.Web.Framework/Infrastructure/DependencyRegistrar.cs</FILE>
        <FILE>src/Presentation/Nop.Web.Framework/WebStoreContext.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Components/AclDisabledWarning.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Components/MultistoreDisabledWarning.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Components/StoreScopeConfiguration.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Controllers/BlogController.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Controllers/CampaignController.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Controllers/CategoryController.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Controllers/CheckoutAttributeController.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Controllers/CommonController.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Controllers/CountryController.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Controllers/CurrencyController.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Controllers/CustomerController.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Controllers/CustomerRoleController.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Controllers/DiscountController.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Controllers/LanguageController.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Controllers/ManufacturerController.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Controllers/MessageTemplateController.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Controllers/NewsController.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Controllers/NewsLetterSubscriptionController.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Controllers/OrderController.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Controllers/PluginController.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Controllers/ProductController.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Controllers/ProductReviewController.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Controllers/SettingController.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Controllers/ShoppingCartController.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Controllers/TopicController.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Views/Customer/_CreateOrUpdate.BackInStockSubscriptions.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Views/Customer/_CreateOrUpdate.CurrentShoppingCart.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Views/Customer/_CreateOrUpdate.CurrentWishlist.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Views/Customer/_CreateOrUpdate.Orders.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Views/Customer/_CreateOrUpdate.RewardPoints.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Views/Home/_LatestOrders.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Views/NewsLetterSubscription/List.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Views/Order/List.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Views/Product/_CreateOrUpdate.Info.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Views/ProductReview/List.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Views/Setting/AllSettings.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Views/ShoppingCart/CurrentCarts.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Views/ShoppingCart/CurrentWishlists.cshtml</FILE>
        <FILE>src/Tests/Nop.Services.Tests/Catalog/PriceCalculationServiceTests.cs</FILE>
        <FILE>src/Tests/Nop.Services.Tests/Helpers/DateTimeHelperTests.cs</FILE>
        <FILE>src/Tests/Nop.Services.Tests/Orders/OrderProcessingServiceTests.cs</FILE>
        <FILE>src/Tests/Nop.Services.Tests/Orders/OrderTotalCalculationServiceTests.cs</FILE>
        <FILE>src/Tests/Nop.Services.Tests/Shipping/CalculateDimensionsTests.cs</FILE>
        <FILE>src/Tests/Nop.Services.Tests/Shipping/ShippingServiceTests.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#157 Performance optimization. A workaround to cache stores (do not load stores for each HTTP request).</MESSAGE>
      <SHA>77d6589a7108ad68469818576a4d33cd417d87ef</SHA>
      <PATCHEDFILES>
        <FILE>src/Libraries/Nop.Core/Caching/IEntityForCaching.cs</FILE>
        <FILE>src/Libraries/Nop.Core/Domain/Stores/Store.cs</FILE>
        <FILE>src/Libraries/Nop.Core/IStoreContext.cs</FILE>
        <FILE>src/Libraries/Nop.Core/Nop.Core.csproj</FILE>
        <FILE>src/Libraries/Nop.Data/Nop.Data.csproj</FILE>
        <FILE>src/Libraries/Nop.Services/Localization/LocalizationExtensions.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Stores/IStoreMappingService.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Stores/IStoreService.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Stores/StoreMappingService.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Stores/StoreService.cs</FILE>
        <FILE>src/Presentation/Nop.Web.Framework/WebStoreContext.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Controllers/StoreController.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#157 Further changes on cacheable entities. Support for GenericAttribute, AclRecord, UrlRecord, StoreMapping</MESSAGE>
      <SHA>df5e9379b29996f31f1fc7522b143b95220795b2</SHA>
      <PATCHEDFILES>
        <FILE>src/Libraries/Nop.Core/Caching/Extensions.cs</FILE>
        <FILE>src/Libraries/Nop.Data/Extensions.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Localization/LocalizationExtensions.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Localization/LocalizedEntityService.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Security/AclService.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Seo/SeoExtensions.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Seo/UrlRecordService.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Stores/StoreMappingService.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#157 Further changes on cacheable entities</MESSAGE>
      <SHA>0d57b3a46dd32eb42f34b2a2c214ae301882cf5a</SHA>
      <PATCHEDFILES>
        <FILE>src/Libraries/Nop.Core/IStoreContext.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Stores/StoreService.cs</FILE>
        <FILE>src/Presentation/Nop.Web.Framework/WebStoreContext.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#157 Performance optimization. A workaround to cache stores (do not load stores for each HTTP request).</MESSAGE>
      <SHA>417444dc6f7888e00fe27cdfde8b6e7b1a3991e6</SHA>
      <PATCHEDFILES>
        <FILE>src/Libraries/Nop.Core/Caching/Extensions.cs</FILE>
        <FILE>src/Libraries/Nop.Core/Caching/IEntityForCaching.cs</FILE>
        <FILE>src/Libraries/Nop.Core/Domain/Stores/Store.cs</FILE>
        <FILE>src/Libraries/Nop.Core/Nop.Core.csproj</FILE>
        <FILE>src/Libraries/Nop.Data/Extensions.cs</FILE>
        <FILE>src/Libraries/Nop.Data/Nop.Data.csproj</FILE>
        <FILE>src/Libraries/Nop.Services/Localization/LocalizationExtensions.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Localization/LocalizedEntityService.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Security/AclService.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Seo/SeoExtensions.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Seo/UrlRecordService.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Stores/IStoreMappingService.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Stores/IStoreService.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Stores/StoreMappingService.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Stores/StoreService.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Controllers/StoreController.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#157 Removed &quot;LocaleStringResources&quot; navigation property from &quot;Language&quot; (preparations to make &quot;Language&quot; entyi cacheable)</MESSAGE>
      <SHA>38545ff3393c607438167e1bf6b7ee299c4d58ca</SHA>
      <PATCHEDFILES>
        <FILE>src/Libraries/Nop.Core/Domain/Localization/Language.cs</FILE>
        <FILE>src/Libraries/Nop.Data/Mapping/Localization/LocaleStringResourceMap.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Localization/LocalizationService.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Infrastructure/Mapper/AdminMapperConfiguration.cs</FILE>
        <FILE>src/Tests/Nop.Data.Tests/Localization/LanguagePersistenceTests.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#157 Further changes in the previous implementation of store caching (more generic approach)</MESSAGE>
      <SHA>156fad406d6892ea4aa023e56b75e60916250586</SHA>
      <PATCHEDFILES>
        <FILE>src/Libraries/Nop.Services/Stores/StoreService.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#157 Performance optimization. Cache currencies (do not load them for each HTTP request).</MESSAGE>
      <SHA>39f26983fa2ea1d392ac67fa19916f7a15ef7a31</SHA>
      <PATCHEDFILES>
        <FILE>src/Libraries/Nop.Core/Domain/Directory/Currency.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Directory/CurrencyService.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Directory/ICurrencyService.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Directory/UpdateExchangeRateTask.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Controllers/CurrencyController.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#157 Performance optimization. Cache languages (do not load them for each HTTP request).</MESSAGE>
      <SHA>a21c7954c6f20676d14829413043f772932a378b</SHA>
      <PATCHEDFILES>
        <FILE>src/Libraries/Nop.Core/Domain/Localization/Language.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Localization/ILanguageService.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Localization/LanguageService.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Controllers/BlogController.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Controllers/LanguageController.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Controllers/NewsController.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Controllers/PollController.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
