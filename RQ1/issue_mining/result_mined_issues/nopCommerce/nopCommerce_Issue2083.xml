<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>2083</ISSUENO>
  <ISSUEURL>https://github.com/nopSolutions/nopCommerce/issues/2083</ISSUEURL>
  <TITLE>When using SSL behind a proxy (ie Cloudflare), admin locale is not en-US</TITLE>
  <DESCRIPTION>In order the admin zone to work properly with numbers, it's important that the Culture is set to 'en-US'. This is done in `SetWorkingCulture` in `Global.asax.cs`, calling `CommonHelper.SetTelerikCulture` when the url matches with admin. The problem is that it's comparing `WebHelper.GetThisPageUrl(false)` with `WebHelper.GetStoreLocation()'. The former method calls internally to 'WehHelper.GetThisPageUrl` and in this case, just returns `HttpContext.Request.Url`, which does not take in account any header that may indicate that the original request (and the effective store location) is https. So, the urls don't match and the Culture is not set to `en-US` so if your store culture uses commas instead of dots to indicate decimal numbers, you're screwed.</DESCRIPTION>
  <REPONAME>nopCommerce</REPONAME>
  <TIMEDIFFERENCEDAYS>15</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>#2039 Updated link to documentation portal (now it's available in different languages).</MESSAGE>
    <SHA>f8c47309bcd9434efd62025ee0aed2c6dac77378</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fix #2083 - Force https when requesting current page url in a secure connection</MESSAGE>
      <SHA>ca7bea21142f0f37931d8138d7eefc902cad8ff4</SHA>
      <PATCHEDFILES>
        <FILE>src/Libraries/Nop.Core/WebHelper.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#2083 Proper consideration of secure connection on GetThisPageUrl method</MESSAGE>
      <SHA>cf7fbacb8b690d70eb7f191c197ddc04f21f75f3</SHA>
      <PATCHEDFILES>
        <FILE>src/Libraries/Nop.Core/WebHelper.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
