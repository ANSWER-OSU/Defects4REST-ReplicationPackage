<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>3292</ISSUENO>
  <ISSUEURL>https://github.com/nopSolutions/nopCommerce/issues/3292</ISSUEURL>
  <TITLE>Discount configuration URL is not properly generated in virtual directories</TITLE>
  <DESCRIPTION>As per our premium support ticket number 14378 It appears to be a path issue when running nopCommerce as a sub-application under a parent domain. Virtual path is generatead twice. For example. www.test.com/path/path/Admin/DiscountRulesCustomerRoles/Configure?discountId=18 instead of www.test.com/path/Admin/DiscountRulesCustomerRoles/Configure?discountId=18 I believe it's the &quot;GetConfigurationUrl&quot; method that has the issue in case of sub-applications. var url = $&quot;{_webHelper.GetStoreLocation()}{discountRequirementRule.GetConfigurationUrl(discount.Id, discountRequirementId)}&quot;;</DESCRIPTION>
  <REPONAME>nopCommerce</REPONAME>
  <TIMEDIFFERENCEDAYS>4</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge branch 'issue-3290-Issue-after-changing-with-product-pictures-SEO-filename' into develop</MESSAGE>
    <SHA>77a80f6b946ec6629d2ced5c54a434a51182e6c6</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>#3292 Fixed generate configuration URL in virtual directories for plugin DiscountRules.CustomerRoles</MESSAGE>
      <SHA>e535898668a6b697c253ac8e34bd3efc3aa8d91c</SHA>
      <PATCHEDFILES>
        <FILE>src/Plugins/Nop.Plugin.DiscountRules.CustomerRoles/CustomerRoleDiscountRequirementRule.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.DiscountRules.CustomerRoles/plugin.json</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#3292 Some improvement in the structure of the code</MESSAGE>
      <SHA>7f71d12c341052329de09e937b6bbc1fe6899ab3</SHA>
      <PATCHEDFILES>
        <FILE>src/Plugins/Nop.Plugin.DiscountRules.CustomerRoles/CustomerRoleDiscountRequirementRule.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.DiscountRules.CustomerRoles/plugin.json</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Controllers/DiscountController.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Factories/DiscountModelFactory.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
