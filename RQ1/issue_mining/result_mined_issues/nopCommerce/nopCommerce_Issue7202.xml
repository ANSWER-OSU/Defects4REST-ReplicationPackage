<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>7202</ISSUENO>
  <ISSUEURL>https://github.com/nopSolutions/nopCommerce/issues/7202</ISSUEURL>
  <TITLE>Copying a product with attribute combinations results in incorrect StockQuantityHistory entry</TITLE>
  <DESCRIPTION>I believe there is a bug in the `ProductCopyService.CopyAttributesMappingAsync` method at the call to `_productService.AddStockQuantityHistoryEntryAsync` on lines 371-373. The `combinationId` parameter receives `combination.Id`, but I believe that `combinationCopy.Id` would be more appropriate. Currently, the resulting entry in the `StockQuantityHistory` table references the product copy's id but the original comination's id and this causes issues when trying to reconcile inventory history for products with attribute combinations. https://github.com/nopSolutions/nopCommerce/blob/98adab92f9c17f23b7d719a130497c518b7d234c/src/Libraries/Nop.Services/Catalog/CopyProductService.cs#L341-L373 I would also argue there's a valid use case for wanting to copy a product and attribute combinations *without copying any inventory information* but that's a separate issue.</DESCRIPTION>
  <REPONAME>nopCommerce</REPONAME>
  <TIMEDIFFERENCEDAYS>12</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>#7198 Refactor ConvertFrom method in GenericListTypeConverter</MESSAGE>
    <SHA>98adab92f9c17f23b7d719a130497c518b7d234c</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>fixing product attribute combinations StockQuantityHistory when copy a product with combinations #7202</MESSAGE>
      <SHA>7033377b103cf1bfd78455aea949cc0a6111568f</SHA>
      <PATCHEDFILES>
        <FILE>src/Libraries/Nop.Services/Catalog/CopyProductService.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>fixing product attribute combinations StockQuantityHistory when copy a product with combinations #7202</MESSAGE>
      <SHA>50dd40803ea19e9705908a7f9ad6bb1412b2e9a0</SHA>
      <PATCHEDFILES>
        <FILE>src/Libraries/Nop.Services/Catalog/CopyProductService.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#7202 Fixing product attribute combinations stock quantity history when copy a product with combinations</MESSAGE>
      <SHA>6050d0ca2d566b19b000f9a0e75ed6f749b8fb72</SHA>
      <PATCHEDFILES>
        <FILE>src/Libraries/Nop.Services/Catalog/CopyProductService.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#7202 Fixing product attribute combinations stock quantity history when copy a product with combinations (cherry picked from commit 6050d0ca2d566b19b000f9a0e75ed6f749b8fb72)</MESSAGE>
      <SHA>adca6bcd73275b09374a47ce2b309ed01ac192f0</SHA>
      <PATCHEDFILES>
        <FILE>src/Libraries/Nop.Services/Catalog/CopyProductService.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
