<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>385</ISSUENO>
  <ISSUEURL>https://github.com/nopSolutions/nopCommerce/issues/385</ISSUEURL>
  <TITLE>Add support for product URLs with a category in path (configurable)</TITLE>
  <DESCRIPTION>This way, product URLs could be `/category-slug-name/product-slug-name`. If a product has several categories in the breadcrumb, then use only the last one (the most nested). Also, note that sometimes a product could be with any categories (in this case always use `/product-slug-name`) Let's make it configurable - the current way (e.g. `/product-slug-name`) or a new one (`/category-slug-name/product-slug-name`). Add an appropriate setting to the admin area Some notes (to be investigated): 1. The workaround for that is for `GenericPathRoute` to map to `{*generic_name}` rather than {generic_name} I believe. 2. Please note after addition of such custom route ALL controllers and routes should be also registered. For example, \somecontroller\somemethod. Otherwise, customers will be redirected to this new {*generic_name} route handler. Also, think about the processing of 404 errors for such cases. Some investigation is required. 3. Each missing static resource (like /content/files/missingfile.pdf) is also caught by `GenericPathRoute`, it's not a big problem, but I'm not sure of the consequences. Also see - http://www.nopcommerce.com/boards/t/29637/performance-optimization-needed-nopcommerce-is-too-slow-.aspx?p=7#123632</DESCRIPTION>
  <REPONAME>nopCommerce</REPONAME>
  <TIMEDIFFERENCEDAYS>2314</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Refactoring of SlugRouteTransformer</MESSAGE>
    <SHA>6fe946eb80e50e836c0b62fdb0db9aea66138ca4</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>#385 Added support for routes with catalog paths</MESSAGE>
      <SHA>a1c7c89e98ea7a637a15a254c7997f59866f6ed0</SHA>
      <PATCHEDFILES>
        <FILE>src/Presentation/Nop.Web.Framework/Mvc/Routing/SlugRouteTransformer.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Infrastructure/GenericUrlRouteProvider.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#385 Added a helper to build generic URLs</MESSAGE>
      <SHA>1ac2d856cf7f958b7d4aff0a8cd52b2093f953d0</SHA>
      <PATCHEDFILES>
        <FILE>src/Presentation/Nop.Web.Framework/Infrastructure/NopStartup.cs</FILE>
        <FILE>src/Presentation/Nop.Web.Framework/Mvc/Routing/INopUrlHelper.cs</FILE>
        <FILE>src/Presentation/Nop.Web.Framework/Mvc/Routing/NopUrlHelper.cs</FILE>
        <FILE>src/Presentation/Nop.Web.Framework/Mvc/Routing/UrlHelperExtensions.cs</FILE>
        <FILE>src/Tests/Nop.Tests/BaseNopTest.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#385 Using new helper to generate generic URLs</MESSAGE>
      <SHA>07e75d60c5eaf24157417bcf4c10e79911ba7885</SHA>
      <PATCHEDFILES>
        <FILE>src/Plugins/Nop.Plugin.Misc.Sendinblue/Services/MarketingAutomationManager.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Misc.Sendinblue/plugin.json</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Factories/TopicModelFactory.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Views/Blog/BlogPostEdit.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Views/Category/Edit.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Views/Manufacturer/Edit.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Views/News/NewsItemEdit.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Views/Product/Edit.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Views/Topic/Edit.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Views/_ViewImports.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Controllers/BlogController.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Controllers/CatalogController.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Controllers/NewsController.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Controllers/ProductController.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Controllers/ShoppingCartController.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Factories/CatalogModelFactory.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Factories/SitemapModelFactory.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Views/BackInStockSubscription/CustomerSubscriptions.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Blog/BlogPost.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Blog/List.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Catalog/CategoryTemplate.ProductsInGridOrLines.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Catalog/ManufacturerAll.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Catalog/ManufacturerTemplate.ProductsInGridOrLines.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Catalog/ProductTagsAll.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Catalog/ProductsByTag.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Catalog/Vendor.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Catalog/VendorAll.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Checkout/Confirm.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Checkout/OpcConfirmOrder.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Customer/DownloadableProducts.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Customer/Register.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/News/List.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/News/NewsItem.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Order/Details.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Order/ShipmentDetails.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Product/CompareProducts.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Product/CustomerProductReviews.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Product/ProductEmailAFriend.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Product/ProductReviews.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Product/ProductTemplate.Grouped.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Product/ProductTemplate.Simple.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Product/_Microdata.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Product/_ProductBreadcrumb.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Product/_ProductManufacturers.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Product/_ProductPrice.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Product/_ProductTags.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Product/_SKU_Man_GTIN_Ven.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/ReturnRequest/CustomerReturnRequests.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/ReturnRequest/ReturnRequest.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Shared/Components/CategoryNavigation/Default.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Shared/Components/EuCookieLaw/Default.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Shared/Components/FlyoutShoppingCart/Default.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Shared/Components/Footer/Default.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Shared/Components/HomepageCategories/Default.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Shared/Components/HomepageNews/Default.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Shared/Components/ManufacturerNavigation/Default.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Shared/Components/OrderSummary/Default.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Shared/Components/PopularProductTags/Default.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Shared/Components/RecentlyViewedProductsBlock/Default.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Shared/Components/TopMenu/Default.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Shared/Components/VendorNavigation/Default.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Shared/_ProductBox.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/ShoppingCart/Wishlist.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Topic/TopicDetails.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Vendor/ApplyVendor.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/_ViewImports.cshtml</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#385 Allow third-party handlers to select an action by the found URL record</MESSAGE>
      <SHA>dd5ddb053d7fd2a0c30d40cb6adda8f256820bf3</SHA>
      <PATCHEDFILES>
        <FILE>src/Presentation/Nop.Web.Framework/Events/GenericRoutingEvent.cs</FILE>
        <FILE>src/Presentation/Nop.Web.Framework/Mvc/Routing/SlugRouteTransformer.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#385 Rename routing defaults</MESSAGE>
      <SHA>956a14370c6c0989aabe3ede1f3eb07790d5fdee</SHA>
      <PATCHEDFILES>
        <FILE>src/Presentation/Nop.Web.Framework/Infrastructure/NopCommonStartup.cs</FILE>
        <FILE>src/Presentation/Nop.Web.Framework/Mvc/Routing/LanguageParameterTransformer.cs</FILE>
        <FILE>src/Presentation/Nop.Web.Framework/Mvc/Routing/NopRoutingDefaults.cs</FILE>
        <FILE>src/Presentation/Nop.Web.Framework/Mvc/Routing/SlugRouteTransformer.cs</FILE>
        <FILE>src/Presentation/Nop.Web.Framework/UI/NopHtmlHelper.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Infrastructure/BaseRouteProvider.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#385 Split routing defaults to route names and route values</MESSAGE>
      <SHA>b02c962f82e4fc7d7a58d9f090e6513efdf25611</SHA>
      <PATCHEDFILES>
        <FILE>src/Presentation/Nop.Web.Framework/Mvc/Routing/LanguageParameterTransformer.cs</FILE>
        <FILE>src/Presentation/Nop.Web.Framework/Mvc/Routing/NopRoutingDefaults.cs</FILE>
        <FILE>src/Presentation/Nop.Web.Framework/Mvc/Routing/NopUrlHelper.cs</FILE>
        <FILE>src/Presentation/Nop.Web.Framework/Mvc/Routing/SlugRouteTransformer.cs</FILE>
        <FILE>src/Presentation/Nop.Web.Framework/UI/NopHtmlHelper.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Infrastructure/BaseRouteProvider.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Infrastructure/GenericUrlRouteProvider.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#385 Add some route names to defaults</MESSAGE>
      <SHA>5b01768c9220342794f1cee0ff262501819c1a15</SHA>
      <PATCHEDFILES>
        <FILE>src/Libraries/Nop.Core/Http/NopHttpDefaults.cs</FILE>
        <FILE>src/Presentation/Nop.Web.Framework/Mvc/Routing/NopRoutingDefaults.cs</FILE>
        <FILE>src/Presentation/Nop.Web.Framework/Mvc/Routing/NopUrlHelper.cs</FILE>
        <FILE>src/Presentation/Nop.Web.Framework/Mvc/Routing/SlugRouteTransformer.cs</FILE>
        <FILE>src/Presentation/Nop.Web.Framework/UI/NopHtmlHelper.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Controllers/CommonController.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Infrastructure/GenericUrlRouteProvider.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#385 Add ProductUrlStructureType and appropriate settings</MESSAGE>
      <SHA>c32aa2d714b72782f7a3190fa88a676b0c4e88ac</SHA>
      <PATCHEDFILES>
        <FILE>src/Libraries/Nop.Core/Domain/Catalog/CatalogSettings.cs</FILE>
        <FILE>src/Libraries/Nop.Core/Domain/Catalog/ProductUrlStructureType.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Installation/InstallationService.cs</FILE>
        <FILE>src/Presentation/Nop.Web.Framework/Migrations/UpgradeTo460/LocalizationMigration.cs</FILE>
        <FILE>src/Presentation/Nop.Web.Framework/Migrations/UpgradeTo460/SettingMigration.cs</FILE>
        <FILE>src/Presentation/Nop.Web.Framework/Mvc/Routing/NopUrlHelper.cs</FILE>
        <FILE>src/Presentation/Nop.Web.Framework/Mvc/Routing/SlugRouteTransformer.cs</FILE>
        <FILE>src/Presentation/Nop.Web/App_Data/Localization/defaultResources.nopres.xml</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Controllers/SettingController.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Factories/SettingModelFactory.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Infrastructure/Mapper/AdminMapperConfiguration.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Models/Settings/CatalogSettingsModel.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Views/Setting/_Catalog.ProductPage.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Infrastructure/GenericUrlRouteProvider.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#385 Fix some incorrect views location</MESSAGE>
      <SHA>4324b22dcb5dbea2e610def4a7d10f8694021cc6</SHA>
      <PATCHEDFILES>
        <FILE>src/Presentation/Nop.Web/Controllers/BlogController.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Controllers/NewsController.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
