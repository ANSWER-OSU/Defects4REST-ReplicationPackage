<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>6713</ISSUENO>
  <ISSUEURL>https://github.com/nopSolutions/nopCommerce/issues/6713</ISSUEURL>
  <TITLE>Product imports from excel not working with large file and split products file option is on</TITLE>
  <DESCRIPTION>nopCommerce version: 4.50.3 Steps to reproduce the problem: - Prepare a products excel (xlsx) file to import, should have more than 1k rows, can be exported from products list - Enable &quot;Export/Import products. Allow splitting file&quot; from catalog settings - Go to Admin =&gt; Products, Import the excel file - Give error - &quot;File contains corrupted data.&quot; Error stack trace: System.IO.FileFormatException: File contains corrupted data. at System.IO.Packaging.ZipPackage..ctor(Stream s, FileMode packageFileMode, FileAccess packageFileAccess) at System.IO.Packaging.Package.Open(Stream stream, FileMode packageMode, FileAccess packageAccess) at DocumentFormat.OpenXml.Packaging.OpenXmlPackage.OpenCore(Stream stream, Boolean readWriteMode) at DocumentFormat.OpenXml.Packaging.SpreadsheetDocument.Open(Stream stream, Boolean isEditable, OpenSettings openSettings) at DocumentFormat.OpenXml.Packaging.SpreadsheetDocument.Open(Stream stream, Boolean isEditable) at ClosedXML.Excel.XLWorkbook.LoadSheets(Stream stream) at Nop.Services.ExportImport.ImportManager.CopyDataToNewFile(ImportProductMetadata metadata, IXLWorksheet worksheet, String filePath, Int32 startRow, Int32 endRow, Int32 endCell) in D:\a\1\s\Libraries\Nop.Services\ExportImport\ImportManager.cs:line 191 Problem identified is calling when &quot;new XLWorkbook(stream)&quot; with new file stream, see attached image with possible solution ![image](https://github.com/nopSolutions/nopCommerce/assets/14998556/05e79b9b-5930-4c01-a597-df345b8c4a69)</DESCRIPTION>
  <REPONAME>nopCommerce</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Fix the IsPaymentWorkflowRequiredAsync method We should not consider in this method the additional fee from using a particular payment method.</MESSAGE>
    <SHA>7654c8a383f71677c6942dce34faa3532d9fe0f7</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>#6713 Fixed problem with splitting the big products file during importing</MESSAGE>
      <SHA>9377ca8c0f2b493ab54398e977778464cd2e1e70</SHA>
      <PATCHEDFILES>
        <FILE>src/Libraries/Nop.Services/ExportImport/ImportManager.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
