<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>6781</ISSUENO>
  <ISSUEURL>https://github.com/nopSolutions/nopCommerce/issues/6781</ISSUEURL>
  <TITLE>UpdateShoppingCartItemAsync Optimization</TITLE>
  <DESCRIPTION>nopCommerce version: All Steps to reproduce the problem: Inside if statement, remove the update customer, insdie else, pass false for resetCheckoutData paramter public virtual async Task&lt;IList&lt;string&gt;&gt; UpdateShoppingCartItemAsync(Customer customer, int shoppingCartItemId, string attributesXml, decimal customerEnteredPrice, DateTime? rentalStartDate = null, DateTime? rentalEndDate = null, int quantity = 1, bool resetCheckoutData = true) { if (customer == null) throw new ArgumentNullException(nameof(customer)); var warnings = new List&lt;string&gt;(); var shoppingCartItem = await _sciRepository.GetByIdAsync(shoppingCartItemId, cache =&gt; default); if (shoppingCartItem == null || shoppingCartItem.CustomerId != customer.Id) return warnings; if (resetCheckoutData) { //reset checkout data await _customerService.ResetCheckoutDataAsync(customer, shoppingCartItem.StoreId); } var product = await _productService.GetProductByIdAsync(shoppingCartItem.ProductId); if (quantity &gt; 0) { //check warnings warnings.AddRange(await GetShoppingCartItemWarningsAsync(customer, shoppingCartItem.ShoppingCartType, product, shoppingCartItem.StoreId, attributesXml, customerEnteredPrice, rentalStartDate, rentalEndDate, quantity, false, shoppingCartItemId)); if (warnings.Any()) return warnings; //if everything is OK, then update a shopping cart item shoppingCartItem.Quantity = quantity; shoppingCartItem.AttributesXml = attributesXml; shoppingCartItem.CustomerEnteredPrice = customerEnteredPrice; shoppingCartItem.RentalStartDateUtc = rentalStartDate; shoppingCartItem.RentalEndDateUtc = rentalEndDate; shoppingCartItem.UpdatedOnUtc = DateTime.UtcNow; await _sciRepository.UpdateAsync(shoppingCartItem); // **No need to call await _customerService.UpdateCustomerAsync(customer);** await _customerService.UpdateCustomerAsync(customer); } else { //check warnings for required products warnings.AddRange(await GetRequiredProductWarningsAsync(customer, shoppingCartItem.ShoppingCartType, product, shoppingCartItem.StoreId, quantity, false, shoppingCartItemId)); if (warnings.Any()) return warnings; //delete a shopping cart item // **Always pass resetCheckoutData as false as it is already reseted if it was passed as true** await DeleteShoppingCartItemAsync(shoppingCartItem, resetCheckoutData, true); } return warnings; }</DESCRIPTION>
  <REPONAME>nopCommerce</REPONAME>
  <TIMEDIFFERENCEDAYS>79</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>#6782 Minor optimization in MigrateShoppingCartAsync</MESSAGE>
    <SHA>70f44e1bbd2f4d3f9ffd17dabc03570844a23199</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>#6781 Minor optimization in UpdateShoppingCartItemAsync</MESSAGE>
      <SHA>fafb817681c3e591045f3137315069ba4aa40016</SHA>
      <PATCHEDFILES>
        <FILE>src/Libraries/Nop.Services/Orders/ShoppingCartService.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
