<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>6553</ISSUENO>
  <ISSUEURL>https://github.com/nopSolutions/nopCommerce/issues/6553</ISSUEURL>
  <TITLE>Switch to Google Analytics 4 and the new measurement protocol</TITLE>
  <DESCRIPTION>Currently we use Universal Analytics. On July 1, 2023, standard Universal Analytics properties will stop processing new hits - [source](https://support.google.com/analytics/answer/10759417?hl=en) So let's wwitch our implementation to Google Analytics 4. Mostly existing websites can be switched online as described [here](https://support.google.com/analytics/answer/9744165). But some extra development actions also could be applied as descriped [here](https://support.google.com/analytics/answer/10759417) in the &quot;Advanced setup needs (if applicable)&quot; section: 1. [Map Universal Analytics custom events to Google Analytics 4](https://support.google.com/analytics/answer/11091025) 2. [Migrate ecommerce measurement](https://developers.google.com/analytics/devguides/migration/ecommerce) 3. [User-ID](https://support.google.com/analytics/answer/9213390) 4. [Measurement protocol](https://support.google.com/analytics/answer/9900444) Also implement https://github.com/nopSolutions/nopCommerce/issues/5915 when this one is finished</DESCRIPTION>
  <REPONAME>nopCommerce</REPONAME>
  <TIMEDIFFERENCEDAYS>38</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Increased minor version number</MESSAGE>
    <SHA>c1a83e669dbf015de7ac17ad552af5378569e0ef</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>#6553 Switch to Google Analytcs 4</MESSAGE>
      <SHA>1b2802edbf925e3a0ec15628e810e786632e82f5</SHA>
      <PATCHEDFILES>
        <FILE>src/Plugins/Nop.Plugin.Widgets.GoogleAnalytics/Api/GoogleAnalyticsHttpClient.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Widgets.GoogleAnalytics/Api/GoogleRequest.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Widgets.GoogleAnalytics/Api/Helpers.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Widgets.GoogleAnalytics/Api/Models/Event.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Widgets.GoogleAnalytics/Api/Models/EventRequest.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Widgets.GoogleAnalytics/Api/Models/Item.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Widgets.GoogleAnalytics/Api/Models/Parameters.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Widgets.GoogleAnalytics/Api/Models/Response.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Widgets.GoogleAnalytics/Api/Models/ValidationMessage.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Widgets.GoogleAnalytics/Api/Transaction.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Widgets.GoogleAnalytics/Api/TransactionItem.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Widgets.GoogleAnalytics/Components/WidgetsGoogleAnalyticsViewComponent.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Widgets.GoogleAnalytics/Controllers/WidgetsGoogleAnalyticsController.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Widgets.GoogleAnalytics/Events.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Widgets.GoogleAnalytics/GoogleAnalyticsDefaults.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Widgets.GoogleAnalytics/GoogleAnalyticsPlugin.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Widgets.GoogleAnalytics/GoogleAnalyticsSettings.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Widgets.GoogleAnalytics/Infrastructure/NopStartup.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Widgets.GoogleAnalytics/Migrations/UpgradeTo460/LocalizationMigration.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Widgets.GoogleAnalytics/Models/ConfigurationModel.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Widgets.GoogleAnalytics/Views/Configure.cshtml</FILE>
        <FILE>src/Plugins/Nop.Plugin.Widgets.GoogleAnalytics/plugin.json</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#6553 Further changes - Added localization migration</MESSAGE>
      <SHA>df88e219d4fef4fe84a8af5910e51b2a101c9536</SHA>
      <PATCHEDFILES>
        <FILE>src/Plugins/Nop.Plugin.Widgets.GoogleAnalytics/Migrations/UpgradeTo460/LocalizationMigration.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Widgets.GoogleAnalytics/Migrations/UpgradeTo470/LocalizationMigration.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Widgets.GoogleAnalytics/plugin.json</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#6553 - eCommerce tracking is done through GA events, JS implementation has been removed.</MESSAGE>
      <SHA>293e8e60b68a683d749ba3adda42e01e0f9f7a58</SHA>
      <PATCHEDFILES>
        <FILE>src/Plugins/Nop.Plugin.Widgets.GoogleAnalytics/Components/WidgetsGoogleAnalyticsViewComponent.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Widgets.GoogleAnalytics/GoogleAnalyticsDefaults.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Widgets.GoogleAnalytics/GoogleAnalyticsPlugin.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Widgets.GoogleAnalytics/GoogleAnalyticsSettings.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Widgets.GoogleAnalytics/Infrastructure/RouteProvider.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#6553 Removed redundant token from tracking script</MESSAGE>
      <SHA>1e90827777af035f87c82879695a25a557cd86e1</SHA>
      <PATCHEDFILES>
        <FILE>src/Plugins/Nop.Plugin.Widgets.GoogleAnalytics/GoogleAnalyticsPlugin.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
