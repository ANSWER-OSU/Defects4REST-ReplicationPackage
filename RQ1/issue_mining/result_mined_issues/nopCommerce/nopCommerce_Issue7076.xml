<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>7076</ISSUENO>
  <ISSUEURL>https://github.com/nopSolutions/nopCommerce/issues/7076</ISSUEURL>
  <TITLE>Optimize address handling</TITLE>
  <DESCRIPTION>nopCommerce version: 4.60.6 Steps to reproduce the problem: Create an order with same billing and shipping address. In Adresss table you'll get two extra copies of your address. I understand the logic behind those copies (permanent copies for order history out of user's reach), yet I think the way it is currently implemented is significantly excessive. Most users will have more orders than changes to their address, so this whole duplication system gives no benefit in their case. In case there is pickup address, it's going to be copied thousand times too. For store that operates for a while, those addresses build up into significant numbers. Looking through the code, I can immediately suggest to skip creation of extra copy if shipping and billing is same, that will reduce duplicates by half for majority of users. That's a cheap fix, but it only reduces problem. More fundamental (and considerably more breaking) solution would be to treat addresses as immutable, update = creation of new address. This way there is going to be no need to create duplicates at all.</DESCRIPTION>
  <REPONAME>nopCommerce</REPONAME>
  <TIMEDIFFERENCEDAYS>2</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Refactoring of MigrationExtension class</MESSAGE>
    <SHA>51d88f7f5466842b5eef1dbbc2dc637e1cde138a</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>#7076 Don't duplicate shipping address for order if it's same as billing</MESSAGE>
      <SHA>a3e16feeebb46e6c1f9f312e50ec0bb6de6d856a</SHA>
      <PATCHEDFILES>
        <FILE>src/Libraries/Nop.Services/Orders/OrderProcessingService.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
