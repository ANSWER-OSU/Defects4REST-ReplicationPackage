<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>7127</ISSUENO>
  <ISSUEURL>https://github.com/nopSolutions/nopCommerce/issues/7127</ISSUEURL>
  <TITLE>GetLanguageFromRequestAsync and Accept-Language header mismatch</TITLE>
  <DESCRIPTION>Today, I discovered a somewhat odd and peculiar problem with AutomaticallyDetectLanguage and GetLanguageFromRequestAsync. Currently, NopCommerce uses UseNopRequestLocalization to add all languages to SupportedCultures and SupportedUICultures. It then creates new CultureInfo with the LanguageCulture (e.g., en-GB) as the key. This works fine until we come to Sweden, where both Chrome and Edge send sv as the Accept-Language header and not sv-SE as NopCommerce has registered, leading to it defaulting to English. I don't know if this is an exception for Sweden or if the same thing applies to, for example, Norway, Denmark, etc. Changing the browser's language to English causes it to send both en and en-US as Accept-Language. I tried changing all instances where we use LanguageCulture to determine language to UniqueSeoCode, and then everything started to work. I don't know if this is due to some change in the browser, my computer, .net but I just wanted to share my findings.</DESCRIPTION>
  <REPONAME>nopCommerce</REPONAME>
  <TIMEDIFFERENCEDAYS>217</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge branch 'issue-7146-ordering-subcategory-products' into develop</MESSAGE>
    <SHA>e0d35cbe42bcdf21f381919da32e19c90139dcc5</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>#7127 Added language detection for neutral cultures by Accept-Language header</MESSAGE>
      <SHA>6e6781f5116a22bdc807e2635f769cf8311d40d1</SHA>
      <PATCHEDFILES>
        <FILE>src/Presentation/Nop.Web.Framework/Globalization/AcceptLanguageHeaderRequestCultureProvider.cs</FILE>
        <FILE>src/Presentation/Nop.Web.Framework/Infrastructure/Extensions/ApplicationBuilderExtensions.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
