<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>5886</ISSUENO>
  <ISSUEURL>https://github.com/nopSolutions/nopCommerce/issues/5886</ISSUEURL>
  <TITLE>SendContactUsMessageAsync does not include sender name and email</TITLE>
  <DESCRIPTION>nopCommerce version: 4.4.4 (and develop) The WorkflowMessageService SendContactUsMessageAsync method contains a condition to add the sender name and email to the body of the message if commonSettings.UseSystemEmailForContactUsForm is true (line 2338). Unfortunately the Token containing the body of the email has already been set (line 2324) so this condition has no effect and the sender name and email are not added to the body of the email. Steps to reproduce the problem: On default installation complete a contact us form. Check the rendered message Our fix is: if (_commonSettings.UseSystemEmailForContactUsForm) { fromEmail = emailAccount.Email; fromName = emailAccount.DisplayName; body = $&quot;&lt;strong&gt;From&lt;/strong&gt;: {WebUtility.HtmlEncode(senderName)} - {WebUtility.HtmlEncode(senderEmail)}&lt;br /&gt;&lt;br /&gt;{body}&quot;; //DBG ADDED //tokens were already set so modifying body above was not doing anything tokens.Remove(tokens.FirstOrDefault(x =&gt; x.Key == &quot;ContactUs.Body&quot;)); tokens.Add(new Token(&quot;ContactUs.Body&quot;, body, true)); //END DBG ADDED }</DESCRIPTION>
  <REPONAME>nopCommerce</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge branch 'Issue-4363-Clear-log-with-sliding-windows' into develop</MESSAGE>
    <SHA>c817220cdf115f283181dcf8391c0576fba1cf52</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>#5886 Fixed problem with the ContactUs.Body token in the SendContactUsMessageAsync method</MESSAGE>
      <SHA>92a9a5587d96a0db1d11c3b5a620d73423b48497</SHA>
      <PATCHEDFILES>
        <FILE>src/Libraries/Nop.Services/Messages/WorkflowMessageService.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
