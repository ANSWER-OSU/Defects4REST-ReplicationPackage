<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>3408</ISSUENO>
  <ISSUEURL>https://github.com/nopSolutions/nopCommerce/issues/3408</ISSUEURL>
  <TITLE>Idea to improve GetFullErrorTextAndRollbackEntityChanges</TITLE>
  <DESCRIPTION>Sometime I got error in _contex.SaveChanges: Here's my idea to improve protected string GetFullErrorTextAndRollbackEntityChanges(DbUpdateException exception) { //rollback entity changes if (_context is DbContext dbContext) { var entries = dbContext.ChangeTracker.Entries() .Where(e =&gt; e.State == EntityState.Added || e.State == EntityState.Modified).ToList(); entries.ForEach(entry =&gt; { try { entry.State = EntityState.Unchanged; } catch (InvalidOperationException) { // ignored } }); } //_context.SaveChanges(); //Sometime I got error in _contex.SaveChanges and the actually exception will not be catched , =&gt; try to try catch here again try { _context.SaveChanges(); return exception.ToString(); } catch(Exception ex) { return ex.ToString();//let outer caller throw inner exception along with this message ( the inner exception is sometime the actually exception ) } }</DESCRIPTION>
  <REPONAME>nopCommerce</REPONAME>
  <TIMEDIFFERENCEDAYS>101</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge branch 'Issue-3424-Order-GUID-reset-while-editing' into develop</MESSAGE>
    <SHA>781e128eff5e72fe9074202bc96b36fa7bb93c4b</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>#3408 Added suppression the exception that occurred when saving database context after rollback of changes</MESSAGE>
      <SHA>ba825247ee94cf0d3e6b0340dbc3d76f8830b4ba</SHA>
      <PATCHEDFILES>
        <FILE>src/Libraries/Nop.Data/EfRepository.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
