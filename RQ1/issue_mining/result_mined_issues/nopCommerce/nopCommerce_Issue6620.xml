<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>6620</ISSUENO>
  <ISSUEURL>https://github.com/nopSolutions/nopCommerce/issues/6620</ISSUEURL>
  <TITLE>NopJsMinifier &quot;.min&quot; check error</TITLE>
  <DESCRIPTION>nopCommerce version: 4.6 I was trying to use Uppy Javascript library. Then I realized that NUglify causing problem when minifying Uppy. Then I check this code and realized it may be wrong. Original version checks the key(file name) if it ends with &quot;.min&quot;. Shouldn't it be &quot;.min.js&quot; and &quot;.min.css&quot; for css processors. So the purpose of this check is to skip the already minified js and css files. But the minified files are named as xxx.min.js and xxx.min.css. I corrected it and it skips the already minified files. using System; using System.Collections.Generic; using System.Threading.Tasks; using Nop.Core.Infrastructure; using Nop.Services.Logging; using NUglify; using NUglify.JavaScript; using WebOptimizer; namespace Nop.Web.Framework.WebOptimizer.Processors { /// &lt;summary&gt; /// Represents a class of processor that handle javascript assets /// &lt;/summary&gt; /// &lt;remarks&gt;Implementation has taken from WebOptimizer to add logging&lt;/remarks&gt; public partial class NopJsMinifier : Processor { #region Methods /// &lt;summary&gt; /// Executes the processor on the specified configuration. /// &lt;/summary&gt; /// &lt;param name=&quot;context&quot;&gt;The context used to perform processing to WebOptimizer.IAsset instances&lt;/param&gt; public override async Task ExecuteAsync(IAssetContext context) { var content = new Dictionary&lt;string, byte[]&gt;(); foreach (var key in context.Content.Keys) { if (key.EndsWith(&quot;.min.js&quot;)) { content[key] = context.Content[key]; continue; } var input = context.Content[key].AsString(); var result = Uglify.Js(input, new CodeSettings { TermSemicolons = true }); var minified = result.Code; if (result.HasErrors) { await EngineContext.Current.Resolve&lt;ILogger&gt;() .WarningAsync($&quot;JavaScript minification: {key}&quot;, new(string.Join(Environment.NewLine, result.Errors))); } content[key] = minified.AsByteArray(); } context.Content = content; return; } #endregion } }</DESCRIPTION>
  <REPONAME>nopCommerce</REPONAME>
  <TIMEDIFFERENCEDAYS>57</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge branch 'issue-6471-trim-entered-values' into develop</MESSAGE>
    <SHA>0d015d314c57a199b9b8a22af8aa269ab6d1b100</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>#6620 NopJsMinifier &amp; NopCssMinifier skip already minified files fixed</MESSAGE>
      <SHA>c00b13d6c3b91f3a12d761c7336eeffc8ff247b2</SHA>
      <PATCHEDFILES>
        <FILE>src/Presentation/Nop.Web.Framework/WebOptimizer/Processors/NopCssMinifier.cs</FILE>
        <FILE>src/Presentation/Nop.Web.Framework/WebOptimizer/Processors/NopJsMinifier.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Merge pull request #6653 from parshan2/develop_6620 #6620 NopJsMinifier &amp; NopCssMinifier skip already minified files fix</MESSAGE>
      <SHA>2290d66630730ca951eabb45bd13ef23018bdf3f</SHA>
      <PATCHEDFILES>
        <FILE>src/Presentation/Nop.Web.Framework/WebOptimizer/Processors/NopCssMinifier.cs</FILE>
        <FILE>src/Presentation/Nop.Web.Framework/WebOptimizer/Processors/NopJsMinifier.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
