<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>908</ISSUENO>
  <ISSUEURL>https://github.com/nopSolutions/nopCommerce/issues/908</ISSUEURL>
  <TITLE>IPictureService.GetPictureUrl method should return relative or absolute paths (based on a parameter)</TITLE>
  <DESCRIPTION>IPictureService.GetPictureUrl method should return relative or absolute paths (based on a parameter). BTW, In this case we could simplify caching of picture models in CatalogController. Note that last years it's better practice to have absolute URLs Open PictureService.cs and add protected virtual string GetImageUrlPrefix(string storeLocation) { var imageUrlPrefix = &quot;&quot;; if (!String.IsNullOrEmpty(storeLocation)) { imageUrlPrefix = storeLocation; } else { //imageUrlPrefix = VirtualPathUtility.ToAppRelative(&quot;~/&quot;); imageUrlPrefix = _httpContext.Request.ApplicationPath; } return imageUrlPrefix; } P.S. In virtual category add / to the after imageUrlPrefix = _httpContext.Request.ApplicationPath; then replace storeLocation = !String.IsNullOrEmpty(storeLocation) ``` ? storeLocation : _webHelper.GetStoreLocation(); ``` with GetImageUrlPrefix(storeLocation) then remove pciture caching by &quot;is connection SSL secured?&quot; and &quot;current store ID&quot; do not forget about images for Open Graph, Twitter meta tags</DESCRIPTION>
  <REPONAME>nopCommerce</REPONAME>
  <TIMEDIFFERENCEDAYS>1155</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Prevented to load not necessary image binaries</MESSAGE>
    <SHA>b61cf56c103ba17376c5f198b2149a9e990908a8</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>#908 Added possibility to use virtual path for images</MESSAGE>
      <SHA>b3425c641f1ce053ef6eda33143a9c2acff52146</SHA>
      <PATCHEDFILES>
        <FILE>src/Libraries/Nop.Core/Domain/Media/MediaSettings.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Installation/CodeFirstInstallationService.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Media/AzurePictureService.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Media/PictureService.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Infrastructure/Mapper/AdminMapperConfiguration.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Factories/CommonModelFactory.cs</FILE>
        <FILE>upgradescripts/4.10-4.20 (under development)/upgrade.sql</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
