<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>5570</ISSUENO>
  <ISSUEURL>https://github.com/nopSolutions/nopCommerce/issues/5570</ISSUEURL>
  <TITLE>Store sitemap.xml as a file</TITLE>
  <DESCRIPTION>nopCommerce version: develop At now XML sitemap generated in memory upon request, placed in the cache and then returned. This can be expensive in terms of performance if the store has many products, categories, etc., and the cache will not help here, since usually search engine robots request a map less often than it's stored in the cache. We could store the sitemap in a file and just return it when requested. But then this file will need to be periodically updated somehow (including from plugins), also it will need to be replicated in case of web farms, etc. Perhaps we should make this behavior configurable? Let's discuss. Add a new setting &quot;Do not update Sitemap.xml before UTC&quot; (choose a better name). Re-generate XML file (or files) only after this date. Then update the setting for the next period. For example, 7 days (make it configurable)</DESCRIPTION>
  <REPONAME>nopCommerce</REPONAME>
  <TIMEDIFFERENCEDAYS>518</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge branch '4.50-bug-fixes' into develop</MESSAGE>
    <SHA>6392bd8afdbac559198f3397ef7a931ffa67ea41</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>#5570 Sitemap XMLs have been moved to the file system</MESSAGE>
      <SHA>ed398de39957c374b718c66603760e655947559e</SHA>
      <PATCHEDFILES>
        <FILE>.gitignore</FILE>
        <FILE>src/Libraries/Nop.Core/Caching/DistributedCacheManager.cs</FILE>
        <FILE>src/Libraries/Nop.Core/Caching/ILocker.cs</FILE>
        <FILE>src/Libraries/Nop.Core/Caching/MemoryCacheManager.cs</FILE>
        <FILE>src/Libraries/Nop.Core/Domain/Common/SitemapXmlSettings.cs</FILE>
        <FILE>src/Libraries/Nop.Core/Infrastructure/INopFileProvider.cs</FILE>
        <FILE>src/Libraries/Nop.Core/Infrastructure/NopFileProvider.cs</FILE>
        <FILE>src/Libraries/Nop.Services/ScheduleTasks/ScheduleTaskRunner.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Seo/NopSeoDefaults.cs</FILE>
        <FILE>src/Presentation/Nop.Web.Framework/Infrastructure/Extensions/ApplicationBuilderExtensions.cs</FILE>
        <FILE>src/Presentation/Nop.Web.Framework/Migrations/UpgradeTo460/SettingMigration.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Controllers/CommonController.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Factories/ISitemapModelFactory.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Factories/SitemapModelFactory.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Models/Sitemap/SitemapXmlModel.cs</FILE>
        <FILE>src/Presentation/Nop.Web/wwwroot/sitemaps/Index.htm</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#5570 Added sitemap directory to check write permission</MESSAGE>
      <SHA>e92633470de01b9e3a6334f8025be4fcab39c469</SHA>
      <PATCHEDFILES>
        <FILE>src/Presentation/Nop.Web.Framework/Security/FilePermissionHelper.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
