<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>1961</ISSUENO>
  <ISSUEURL>https://github.com/nopSolutions/nopCommerce/issues/1961</ISSUEURL>
  <TITLE>Allow VAT number to be entered in the anonymous (guest) checkout. Or notify guest that it's possible only after registration</TITLE>
  <DESCRIPTION>also see https://www.nopcommerce.com/boards/t/47929/eu-vat-customer-with-invalid-vat-should-not-be-able-to-order.aspx Let's just decide what we have to do what VAT number requires some validation from a store owner (a tax setting). At least we should decide what we have to display or allow so guests understand that they can enter VAT numbers (e.g. only after registration) So let's add setting 1. It will only be considered when `EuVatEnabled` is enabled. If this new setting is disabled, then during anonymous checkout a warning that the VAT number can be entered and used only after registration should be displayed. If it's enabled, then we add a new field on the billing address page to enter the VAT number. When saving the address, we check the validity of this number (`GetVatNumberStatus` method), if it's valid, then save the VAT number and its status for the customer (guest). When placing an order, this number will be saved in the order details.</DESCRIPTION>
  <REPONAME>nopCommerce</REPONAME>
  <TIMEDIFFERENCEDAYS>2049</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Updated version of 4.60 SchemaMigration migration to avoid problem on systems which use CI/CD</MESSAGE>
    <SHA>691184d187040559e08cdedc4a041af4b1ed57d4</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>#1961 Allow VAT number to be entered in guest checkout (#6304)</MESSAGE>
      <SHA>a8f37d8d536c8180db78995476545e0e90e657ce</SHA>
      <PATCHEDFILES>
        <FILE>src/Libraries/Nop.Core/Domain/Tax/TaxSettings.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Installation/InstallationService.cs</FILE>
        <FILE>src/Presentation/Nop.Web.Framework/Migrations/UpgradeTo460/LocalizationMigration.cs</FILE>
        <FILE>src/Presentation/Nop.Web.Framework/Migrations/UpgradeTo460/SettingMigration.cs</FILE>
        <FILE>src/Presentation/Nop.Web/App_Data/Localization/defaultResources.nopres.xml</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Controllers/SettingController.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Factories/SettingModelFactory.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Infrastructure/Mapper/AdminMapperConfiguration.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Models/Settings/TaxSettingsModel.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Views/Setting/_Tax.VAT.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Controllers/CheckoutController.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Factories/CheckoutModelFactory.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Models/Common/AddressModel.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Themes/DefaultClean/Content/css/styles.css</FILE>
        <FILE>src/Presentation/Nop.Web/Themes/DefaultClean/Content/css/styles.rtl.css</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Shared/_CreateOrUpdateAddress.cshtml</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#1961 Next changes to allow VAT number to be entered in guest checkout</MESSAGE>
      <SHA>f653ded0978c1a6a65bd76836da72c19c4393ac6</SHA>
      <PATCHEDFILES>
        <FILE>src/Presentation/Nop.Web.Framework/Migrations/UpgradeTo460/LocalizationMigration.cs</FILE>
        <FILE>src/Presentation/Nop.Web/App_Data/Localization/defaultResources.nopres.xml</FILE>
        <FILE>src/Presentation/Nop.Web/Controllers/CheckoutController.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Factories/CheckoutModelFactory.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Factories/CustomerModelFactory.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Models/Checkout/CheckoutBillingAddressModel.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Models/Common/AddressModel.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Checkout/BillingAddress.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Checkout/OpcBillingAddress.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Shared/_CreateOrUpdateAddress.cshtml</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
