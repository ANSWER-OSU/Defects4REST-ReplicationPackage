<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>6080</ISSUENO>
  <ISSUEURL>https://github.com/nopSolutions/nopCommerce/issues/6080</ISSUEURL>
  <TITLE>Suggestions to make Payment plugins more extensible</TITLE>
  <DESCRIPTION>For this example, I'm going to use the Cheque / Money Order payment plugin but could as well applicable to other plugins. The payment instructions could be found during Checkout (before the Order is placed). However, at this point, customers won't be writing the details down thinking that they could access the info sometime later after the order is placed. ![image](https://user-images.githubusercontent.com/14930009/149495275-8706bdd0-0ad5-432f-9e40-b06ca6658685.png) At the Order Details page (after the Order is placed), there's no way the customers could access the payment instructions anymore. I know I could add a FAQ page or info page with the payment instructions but that would not be intuitive anymore and customers won't even think to look for pages like that in the first place. ![image](https://user-images.githubusercontent.com/14930009/149496039-4d748820-4ab7-471d-a45f-f90617c022d4.png) It would be better if the plugin could include a `ViewComponent` on the Order Details page. This way the plugin has more control over what to display. It could even include javascript files or css stylesheets in the `View` of the `ViewComponent`. ![image](https://user-images.githubusercontent.com/14930009/149497873-13831a8b-50bb-4324-911e-af1c22a7ae1b.png) **Note:** Although in the screenshot above, `PartialView` is mentioned, but a `ViewComponent` is more suitable and inline with how nopCommerce works. Let's take another example, the PayPal Standard payment plugin. ![image](https://user-images.githubusercontent.com/14930009/149498333-265cca74-e623-435d-95ee-7a3f90f0590e.png) The code to display the &quot;Retry Payment&quot; button is controlled by `Nop.Web` instead of by the plugin. https://github.com/nopSolutions/nopCommerce/blob/e19fe8c85c7ca2b7f44b989ce1792fe1a517fc7f/src/Presentation/Nop.Web/Views/Order/Details.cshtml#L203-L214 Here, `Nop.Web` is only displaying one button which probably good enough for PayPal. It is presumtuous to assume that this also applies to every other payment gateways out there. Other banks could require some actions to be taken first before being redirected to their payment authorisation page thus might require several additional buttons to be displayed. Or to have a hyperlink when clicked would display the &quot;Terms &amp; Conditions&quot; of using the bank's service. The correct way would be as mentioned, give more control to the payment plugin to include a `ViewComponent` to display whatever that the plugin deem necessary instead of having `Nop.Web` catering for every single possible scenario. Currently, in `IPaymentMethod` interface which is implemented by Payment plugins, there's a method called `GetPublicViewComponentName()` which is used to display the `ViewComponent` of the payment instructions/info as shown in the first screenshot. https://github.com/nopSolutions/nopCommerce/blob/12dd4825dfb56bbc64e192cd35d25e3205427646/src/Libraries/Nop.Services/Payments/IPaymentMethod.cs#L133-L137 We could extend this and introduce two more methods: `GetOrderDetailsViewComponentName()` which is the `ViewComponent` on the Order Details page explained above, and `GetCheckoutCompletedViewComponentName()` which is the `ViewComponent` to be displayed after checkout is completed. `GetCheckoutCompletedViewComponentName()` is useful for manual/offline Payment plugins to attach a reminder to customer after the checkout process is completed. ![image](https://user-images.githubusercontent.com/14930009/149587271-d7d831d8-dfba-4972-82aa-0ac819a7a92b.png)</DESCRIPTION>
  <REPONAME>nopCommerce</REPONAME>
  <TIMEDIFFERENCEDAYS>374</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Fixed some properties that didn't get renamed properly Views.</MESSAGE>
    <SHA>3ecaa2b46327ac75c9da7dc82233f6f0c22e0d3c</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>#6080 Having payment plugins to have more control thus being more extensible. Removed redundant methods `PostProcessPaymentAsync()` and `CanRePostProcessPaymentAsync()`. Payment plugins are now more self-contained when it comes to re-posting failed transactions. The core of nopCommerce doesn't need to be aware of the concept of &quot;re-posting&quot;, only the plugins need to know.</MESSAGE>
      <SHA>62bbf691282bf2bf3fb4ffda94f0aca7e02c69e1</SHA>
      <PATCHEDFILES>
        <FILE>src/Libraries/Nop.Services/Orders/OrderProcessingService.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Payments/IPaymentMethod.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Payments/IPaymentService.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Payments/PaymentService.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Payments/PostProcessPaymentRequest.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.CheckMoneyOrder/CheckMoneyOrderPaymentProcessor.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.CheckMoneyOrder/Components/CheckMoneyOrderOrderDetailsViewComponent.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.CheckMoneyOrder/Components/CheckMoneyOrderPaymentInfoViewComponent.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.CheckMoneyOrder/Models/OrderDetailsModel.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.CheckMoneyOrder/Nop.Plugin.Payments.CheckMoneyOrder.csproj</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.CheckMoneyOrder/Views/OrderDetails.cshtml</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.Manual/ManualPaymentProcessor.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.PayPalCommerce/PayPalCommercePaymentMethod.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.PayPalStandard/Components/OrderDetailsViewComponent.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.PayPalStandard/Components/PaymentInfoViewComponent.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.PayPalStandard/Controllers/PaymentPayPalStandardController.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.PayPalStandard/Infrastructure/NopStartup.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.PayPalStandard/Infrastructure/RouteProvider.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.PayPalStandard/Models/PaymentRePostModel.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.PayPalStandard/Nop.Plugin.Payments.PayPalStandard.csproj</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.PayPalStandard/PayPalStandardPaymentProcessor.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.PayPalStandard/Services/PayPalStandardPaymentService.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.PayPalStandard/Views/OrderDetails.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/App_Data/Localization/defaultResources.nopres.xml</FILE>
        <FILE>src/Presentation/Nop.Web/Controllers/CheckoutController.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Controllers/OrderController.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Factories/CheckoutModelFactory.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Factories/OrderModelFactory.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Factories/ShoppingCartModelFactory.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Models/Checkout/CheckoutCompletedModel.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Models/Order/OrderDetailsModel.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Themes/DefaultClean/Content/css/styles.css</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Checkout/Completed.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Checkout/PaymentInfo.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Order/Details.cshtml</FILE>
        <FILE>src/Tests/Nop.Tests/Nop.Services.Tests/Payments/TestPaymentMethod.cs</FILE>
        <FILE>src/Tests/Nop.Tests/Nop.Web.Tests/Public/Factories/CheckoutModelFactoryTests.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#6080 Having payment plugins to have more control thus being more extensible. Removed redundant methods `PostProcessPaymentAsync()` and `CanRePostProcessPaymentAsync()`. Payment plugins are now more self-contained when it comes to re-posting failed transactions. The core of nopCommerce doesn't need to be aware of the concept of &quot;re-posting&quot;, only the plugins need to know.</MESSAGE>
      <SHA>52a0a6809939b02789d06811685e8ca50c9d7ec4</SHA>
      <PATCHEDFILES>
        <FILE>src/Libraries/Nop.Services/Orders/OrderProcessingService.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Payments/IPaymentMethod.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Payments/IPaymentService.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Payments/PaymentService.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Payments/PostProcessPaymentRequest.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.CheckMoneyOrder/CheckMoneyOrderPaymentProcessor.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.CheckMoneyOrder/Components/CheckMoneyOrderOrderDetailsViewComponent.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.CheckMoneyOrder/Components/CheckMoneyOrderPaymentInfoViewComponent.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.CheckMoneyOrder/Models/OrderDetailsModel.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.CheckMoneyOrder/Nop.Plugin.Payments.CheckMoneyOrder.csproj</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.CheckMoneyOrder/Views/OrderDetails.cshtml</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.Manual/ManualPaymentProcessor.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.PayPalCommerce/PayPalCommercePaymentMethod.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.PayPalStandard/Components/OrderDetailsViewComponent.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.PayPalStandard/Components/PaymentInfoViewComponent.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.PayPalStandard/Controllers/PaymentPayPalStandardController.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.PayPalStandard/Infrastructure/NopStartup.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.PayPalStandard/Infrastructure/RouteProvider.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.PayPalStandard/Models/PaymentRePostModel.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.PayPalStandard/Nop.Plugin.Payments.PayPalStandard.csproj</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.PayPalStandard/PayPalStandardPaymentProcessor.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.PayPalStandard/Services/PayPalStandardPaymentService.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.PayPalStandard/Views/OrderDetails.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/App_Data/Localization/defaultResources.nopres.xml</FILE>
        <FILE>src/Presentation/Nop.Web/Controllers/CheckoutController.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Controllers/OrderController.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Factories/CheckoutModelFactory.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Factories/OrderModelFactory.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Factories/ShoppingCartModelFactory.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Models/Checkout/CheckoutCompletedModel.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Models/Order/OrderDetailsModel.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Themes/DefaultClean/Content/css/styles.css</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Checkout/Completed.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Checkout/PaymentInfo.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Order/Details.cshtml</FILE>
        <FILE>src/Tests/Nop.Tests/Nop.Services.Tests/Payments/TestPaymentMethod.cs</FILE>
        <FILE>src/Tests/Nop.Tests/Nop.Web.Tests/Public/Factories/CheckoutModelFactoryTests.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#6080 Having payment plugins to have more control thus being more extensible. Removed redundant methods `PostProcessPaymentAsync()` and `CanRePostProcessPaymentAsync()`. Payment plugins are now more self-contained when it comes to re-posting failed transactions. The core of nopCommerce doesn't need to be aware of the concept of &quot;re-posting&quot;, only the plugins need to know.</MESSAGE>
      <SHA>24bd9e26b692f362a8c032a4a889c66d6520185d</SHA>
      <PATCHEDFILES>
        <FILE>src/Libraries/Nop.Services/Orders/OrderProcessingService.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Payments/IPaymentMethod.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Payments/IPaymentService.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Payments/PaymentService.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Payments/PostProcessPaymentRequest.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.CheckMoneyOrder/CheckMoneyOrderPaymentProcessor.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.CheckMoneyOrder/Components/CheckMoneyOrderOrderDetailsViewComponent.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.CheckMoneyOrder/Components/CheckMoneyOrderPaymentInfoViewComponent.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.CheckMoneyOrder/Models/OrderDetailsModel.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.CheckMoneyOrder/Nop.Plugin.Payments.CheckMoneyOrder.csproj</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.CheckMoneyOrder/Views/OrderDetails.cshtml</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.Manual/ManualPaymentProcessor.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.PayPalCommerce/PayPalCommercePaymentMethod.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.PayPalStandard/Components/OrderDetailsViewComponent.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.PayPalStandard/Components/PaymentInfoViewComponent.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.PayPalStandard/Controllers/PaymentPayPalStandardController.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.PayPalStandard/Infrastructure/NopStartup.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.PayPalStandard/Infrastructure/RouteProvider.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.PayPalStandard/Models/PaymentRePostModel.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.PayPalStandard/Nop.Plugin.Payments.PayPalStandard.csproj</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.PayPalStandard/PayPalStandardPaymentProcessor.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.PayPalStandard/Services/PayPalStandardPaymentService.cs</FILE>
        <FILE>src/Plugins/Nop.Plugin.Payments.PayPalStandard/Views/OrderDetails.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/App_Data/Localization/defaultResources.nopres.xml</FILE>
        <FILE>src/Presentation/Nop.Web/Controllers/CheckoutController.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Controllers/OrderController.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Factories/CheckoutModelFactory.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Factories/OrderModelFactory.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Factories/ShoppingCartModelFactory.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Models/Checkout/CheckoutCompletedModel.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Models/Order/OrderDetailsModel.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Themes/DefaultClean/Content/css/styles.css</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Checkout/Completed.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Checkout/PaymentInfo.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Views/Order/Details.cshtml</FILE>
        <FILE>src/Tests/Nop.Tests/Nop.Services.Tests/Payments/TestPaymentMethod.cs</FILE>
        <FILE>src/Tests/Nop.Tests/Nop.Web.Tests/Public/Factories/CheckoutModelFactoryTests.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
