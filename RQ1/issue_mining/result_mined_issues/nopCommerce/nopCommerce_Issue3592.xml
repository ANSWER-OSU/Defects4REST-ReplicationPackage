<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>3592</ISSUENO>
  <ISSUEURL>https://github.com/nopSolutions/nopCommerce/issues/3592</ISSUEURL>
  <TITLE>Additionally check ManageAcl permission when managing customer roles</TITLE>
  <DESCRIPTION>I would suggest modifying the CustomerRoleController.cs in admin and change every one of these lines: `if (!_permissionService.Authorize(StandardPermissionProvider.ManageCustomers))` to: `if (!_permissionService.Authorize(StandardPermissionProvider.ManageAcl))` Then you can use the Admin area. Manage ACL permission from within the Access control list area to limit user access. I think the permissions to manage the ACL go hand in hand with setting roles. Allowing anyone with Manage Customers rights to change users roles and therefore change their access privileges does not make sense. Additionally, the CustomerController.cs would have to be modified to prevent roles from being added or changed when a customer record is added or edited, also using `if (!_permissionService.Authorize(StandardPermissionProvider.ManageAcl))`. Allowing only the guest role here would make sense. If someone needs roles added they would have to have a user with ACL rights do it. Source: https://www.nopcommerce.com/boards/t/16840/acl-system-allows-admin-users-to-add-themselves-to-roles-of-greater-seniority-250.aspx?p=4#224940</DESCRIPTION>
  <REPONAME>nopCommerce</REPONAME>
  <TIMEDIFFERENCEDAYS>65</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>#3728 Better styling of nested tables</MESSAGE>
    <SHA>86d700b56850983a3624157f216fb63ff1537238</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>#3592 Additionally check ManageAcl permission when managing customer roles</MESSAGE>
      <SHA>6977603f93d9f803a2d138b55ac5549b855061c5</SHA>
      <PATCHEDFILES>
        <FILE>src/Presentation/Nop.Web/App_Data/Localization/defaultResources.nopres.xml</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Controllers/CustomerController.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Controllers/CustomerRoleController.cs</FILE>
        <FILE>upgradescripts/4.10-4.20 (under development)/upgrade.sql</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
