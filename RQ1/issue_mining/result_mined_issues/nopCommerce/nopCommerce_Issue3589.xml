<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>3589</ISSUENO>
  <ISSUEURL>https://github.com/nopSolutions/nopCommerce/issues/3589</ISSUEURL>
  <TITLE>Stop products with custom AttributeXml from merging</TITLE>
  <DESCRIPTION>I am integrating nopCommerce with a 3rd-party product customizer via a plugin. The customizer returns a DesignId which I am adding to the attributeXml of the ShoppingCartItem, similar to gift cards. This works great but the problem I'm having is two products with different DesignIds are getting merged in the cart when I want them to remain as separate line items. Option 1: I could create and register my own IProductAttributeParser and override AreProductAttributesEqual. But this method only considers product-mapping attributes, not custom attributes. This same method is also used when finding product attribute combinations, so any changes have the potential of breaking core product attribute functionality. Option 2: I can do like what is being done for gift cards and add logic in ShoppingCartService.FindShoppingCartItemInTheCart. The issue here is I have to override this entire method and all of its logic the equality logic is contained within a loop over all shopping cart items. This loop has a lot of logic and I worry about keeping it up-to-date with nop upgrades. My proposal: I'm going to issue a pull request that extracts the inner part of the for loop into its own method. This way I can register my own IShoppingCartService that overrides only this submethod to check if the item being added is equivalent to a single shopping cart item. I can do my custom check and then defer to the base method. Thoughts?</DESCRIPTION>
  <REPONAME>nopCommerce</REPONAME>
  <TIMEDIFFERENCEDAYS>8</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Extract shopping cart item equality in ShoppingCartService (#3590) * Extract ShoppingCartItemIsEqual in ShoppingCartService * Improve performance of ShoppingCartItemIsEqual via shortcircuiting * Ignore case in gift card comparison per original code</MESSAGE>
    <SHA>dc8084baf85597d33b9419239c667eb4551db9aa</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>#3589 Code refactoring on &quot;Extract shopping cart item equality in ShoppingCartService&quot; commit</MESSAGE>
      <SHA>63d383fd4839af83cd7436aaa9336ef615b19f9a</SHA>
      <PATCHEDFILES>
        <FILE>src/Libraries/Nop.Services/Orders/ShoppingCartService.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
