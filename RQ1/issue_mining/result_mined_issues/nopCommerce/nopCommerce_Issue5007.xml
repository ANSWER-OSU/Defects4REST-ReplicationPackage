<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>5007</ISSUENO>
  <ISSUEURL>https://github.com/nopSolutions/nopCommerce/issues/5007</ISSUEURL>
  <TITLE>GetBestCustomersReport wrong parameters in order by</TITLE>
  <DESCRIPTION>nopCommerce version: 4.30 Steps to reproduce the problem: Please check code for `GetBestCustomersReport` method in `CustomerReportService.cs` file. The order by clause is not properly written, please check below code `query2 = orderBy switch { OrderByEnum.OrderByQuantity =&gt; query2.OrderByDescending(x =&gt; x.OrderTotal), OrderByEnum.OrderByTotalAmount =&gt; query2.OrderByDescending(x =&gt; x.OrderCount), _ =&gt; throw new ArgumentException(&quot;Wrong orderBy parameter&quot;, nameof(orderBy)), };` Here if we order by quantity then query2 must be ordered by OrderCount in DESC order. Same way for Order Total Amount. Currently results on views are correct because from view also you passed wrong parameter for eg. `BestCustomersByOrderTotal.cshtml` in this view please check filters parameter in datatable. `Filters = new List&lt;FilterParameter&gt; { new FilterParameter(nameof(Model.BestCustomersByOrderTotal.OrderBy), (int)OrderByEnum.OrderByQuantity), }` only thing is, condition is not matching with `enum` properties.</DESCRIPTION>
  <REPONAME>nopCommerce</REPONAME>
  <TIMEDIFFERENCEDAYS>161</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Remove inappropriate environment variables from web.config</MESSAGE>
    <SHA>eb87103dce9e48c3b723f8a02b920d2ff50cdfb4</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>#5007 Fix BestCustomersReport wrong 'OrderBy' parameter</MESSAGE>
      <SHA>508d27680d3cbd4f5d7f1fa32ad45303ba5c6f0c</SHA>
      <PATCHEDFILES>
        <FILE>src/Libraries/Nop.Services/Customers/CustomerReportService.cs</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Views/Report/BestCustomersByNumberOfOrders.cshtml</FILE>
        <FILE>src/Presentation/Nop.Web/Areas/Admin/Views/Report/BestCustomersByOrderTotal.cshtml</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
