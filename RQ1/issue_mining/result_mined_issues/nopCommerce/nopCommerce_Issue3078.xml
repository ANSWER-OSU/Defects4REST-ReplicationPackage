<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>3078</ISSUENO>
  <ISSUEURL>https://github.com/nopSolutions/nopCommerce/issues/3078</ISSUEURL>
  <TITLE>Adding useful fields to admin/customer/list for exporting to xlsx/xml</TITLE>
  <DESCRIPTION>The admin/customers/list view is lacking lots of useful fields. Eg it exports the countryId not the actual country string etc which is not useful for importing into other products. I have made a new controller to override this function: ` [HttpPost, ActionName(&quot;List&quot;)] [FormValueRequired(&quot;exportexcel-all&quot;)] [Route(&quot;/Admin/Customer/List&quot;)] public virtual IActionResult ExportExcelAll(CustomerListModel model) {` I have then modified it to call my own version of ExportCustomersToXlsx() This is not very efficient (eg calling GetCustomerByEmail 4x instead of once per customer etc) however it works great. It adds DOB, real country and state strings etc. Can we have a new dropdown menu item (or a mechanism to add custom ones easily) that calls this code? The way I have implemented it currently so that I don't modify the original nop source is very hacky (eg overriding the url). Any way we can get this code in the released version of nop? I use it for importing into my forum/facebook advert exclude list etc and it is very handy. ``` public virtual byte[] ExportCustomersToXlsx(IList&lt;Customer&gt; customers) { //property array var properties = new[] { new PropertyByName&lt;Customer&gt;(&quot;CustomerId&quot;, p =&gt; p.Id), new PropertyByName&lt;Customer&gt;(&quot;CustomerGuid&quot;, p =&gt; p.CustomerGuid), new PropertyByName&lt;Customer&gt;(&quot;Email&quot;, p =&gt; p.Email), new PropertyByName&lt;Customer&gt;(&quot;Username&quot;, p =&gt; p.Username), new PropertyByName&lt;Customer&gt;(&quot;Password&quot;, p =&gt; _customerService.GetCurrentPassword(p.Id)?.Password), new PropertyByName&lt;Customer&gt;(&quot;PasswordFormatId&quot;, p =&gt; _customerService.GetCurrentPassword(p.Id)?.PasswordFormatId ?? 0), new PropertyByName&lt;Customer&gt;(&quot;PasswordSalt&quot;, p =&gt; _customerService.GetCurrentPassword(p.Id)?.PasswordSalt), new PropertyByName&lt;Customer&gt;(&quot;IsTaxExempt&quot;, p =&gt; p.IsTaxExempt), new PropertyByName&lt;Customer&gt;(&quot;AffiliateId&quot;, p =&gt; p.AffiliateId), new PropertyByName&lt;Customer&gt;(&quot;VendorId&quot;, p =&gt; p.VendorId), new PropertyByName&lt;Customer&gt;(&quot;Active&quot;, p =&gt; p.Active), new PropertyByName&lt;Customer&gt;(&quot;IsGuest&quot;, p =&gt; p.IsGuest()), new PropertyByName&lt;Customer&gt;(&quot;IsRegistered&quot;, p =&gt; p.IsRegistered()), new PropertyByName&lt;Customer&gt;(&quot;IsAdministrator&quot;, p =&gt; p.IsAdmin()), new PropertyByName&lt;Customer&gt;(&quot;IsForumModerator&quot;, p =&gt; p.IsForumModerator()), new PropertyByName&lt;Customer&gt;(&quot;CreatedOnUtc&quot;, p =&gt; p.CreatedOnUtc), //attributes new PropertyByName&lt;Customer&gt;(&quot;FirstName&quot;, p =&gt; p.GetAttribute&lt;string&gt;(SystemCustomerAttributeNames.FirstName)), new PropertyByName&lt;Customer&gt;(&quot;LastName&quot;, p =&gt; p.GetAttribute&lt;string&gt;(SystemCustomerAttributeNames.LastName)), new PropertyByName&lt;Customer&gt;(&quot;Gender&quot;, p =&gt; p.GetAttribute&lt;string&gt;(SystemCustomerAttributeNames.Gender)), new PropertyByName&lt;Customer&gt;(&quot;DateOfBirth&quot;, p =&gt; p.GetAttribute&lt;string&gt;(SystemCustomerAttributeNames.DateOfBirth)), new PropertyByName&lt;Customer&gt;(&quot;Company&quot;, p =&gt; p.GetAttribute&lt;string&gt;(SystemCustomerAttributeNames.Company)), new PropertyByName&lt;Customer&gt;(&quot;StreetAddress&quot;, p =&gt; p.GetAttribute&lt;string&gt;(SystemCustomerAttributeNames.StreetAddress)), new PropertyByName&lt;Customer&gt;(&quot;StreetAddress2&quot;, p =&gt; p.GetAttribute&lt;string&gt;(SystemCustomerAttributeNames.StreetAddress2)), new PropertyByName&lt;Customer&gt;(&quot;ZipPostalCode&quot;, p =&gt; p.GetAttribute&lt;string&gt;(SystemCustomerAttributeNames.ZipPostalCode)), new PropertyByName&lt;Customer&gt;(&quot;City&quot;, p =&gt; p.GetAttribute&lt;string&gt;(SystemCustomerAttributeNames.City)), new PropertyByName&lt;Customer&gt;(&quot;CountryId&quot;, p =&gt; p.GetAttribute&lt;int&gt;(SystemCustomerAttributeNames.CountryId)), new PropertyByName&lt;Customer&gt;(&quot;StateProvinceId&quot;, p =&gt; p.GetAttribute&lt;int&gt;(SystemCustomerAttributeNames.StateProvinceId)), new PropertyByName&lt;Customer&gt;(&quot;Country&quot;, p =&gt; { var customer = _customerService.GetCustomerByEmail(p.Email); return customer?.Addresses?.FirstOrDefault()?.Country?.Name; }), new PropertyByName&lt;Customer&gt;(&quot;CountryAbbr&quot;, p =&gt; { var customer = _customerService.GetCustomerByEmail(p.Email); return customer?.Addresses?.FirstOrDefault()?.Country?.ThreeLetterIsoCode; }), new PropertyByName&lt;Customer&gt;(&quot;State&quot;, p =&gt; { var customer = _customerService.GetCustomerByEmail(p.Email); return customer?.Addresses?.FirstOrDefault()?.StateProvince?.Name; }), new PropertyByName&lt;Customer&gt;(&quot;StateAbbr&quot;, p =&gt; { var customer = _customerService.GetCustomerByEmail(p.Email); return customer?.Addresses?.FirstOrDefault()?.StateProvince?.Abbreviation; }), new PropertyByName&lt;Customer&gt;(&quot;Phone&quot;, p =&gt; p.GetAttribute&lt;string&gt;(SystemCustomerAttributeNames.Phone)), new PropertyByName&lt;Customer&gt;(&quot;Fax&quot;, p =&gt; p.GetAttribute&lt;string&gt;(SystemCustomerAttributeNames.Fax)), new PropertyByName&lt;Customer&gt;(&quot;VatNumber&quot;, p =&gt; p.GetAttribute&lt;string&gt;(SystemCustomerAttributeNames.VatNumber)), new PropertyByName&lt;Customer&gt;(&quot;VatNumberStatusId&quot;, p =&gt; p.GetAttribute&lt;int&gt;(SystemCustomerAttributeNames.VatNumberStatusId)), new PropertyByName&lt;Customer&gt;(&quot;TimeZoneId&quot;, p =&gt; p.GetAttribute&lt;string&gt;(SystemCustomerAttributeNames.TimeZoneId)), new PropertyByName&lt;Customer&gt;(&quot;AvatarPictureId&quot;, p =&gt; p.GetAttribute&lt;int&gt;(SystemCustomerAttributeNames.AvatarPictureId)), new PropertyByName&lt;Customer&gt;(&quot;ForumPostCount&quot;, p =&gt; p.GetAttribute&lt;int&gt;(SystemCustomerAttributeNames.ForumPostCount)), new PropertyByName&lt;Customer&gt;(&quot;Signature&quot;, p =&gt; p.GetAttribute&lt;string&gt;(SystemCustomerAttributeNames.Signature)) }; return ExportToXlsx(properties, customers); } ```</DESCRIPTION>
  <REPONAME>nopCommerce</REPONAME>
  <TIMEDIFFERENCEDAYS>952</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge branch 'issue-5217-disable-localization-sitemap-location' into develop</MESSAGE>
    <SHA>cd1b00d0ce8865c02502764e7b832c3eb7fc0fd9</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>#3078 Improved exporting of customers</MESSAGE>
      <SHA>101fa1864fed85560ef92c8b1925b41094095e2a</SHA>
      <PATCHEDFILES>
        <FILE>src/Libraries/Nop.Services/ExportImport/ExportManager.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Vendors/IVendorService.cs</FILE>
        <FILE>src/Libraries/Nop.Services/Vendors/VendorService.cs</FILE>
        <FILE>src/Tests/Nop.Tests/Nop.Services.Tests/ExportImport/ExportManagerTests.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
