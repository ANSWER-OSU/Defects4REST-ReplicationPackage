<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>19023</ISSUENO>
  <ISSUEURL>https://github.com/netbox-community/netbox/issues/19023</ISSUEURL>
  <TITLE>`get_field_value()` does not recognize null field values on bound forms</TITLE>
  <DESCRIPTION>### Deployment Type Self-hosted ### NetBox Version v4.2.6 ### Python Version 3.10 ### Steps to Reproduce This was uncovered while using the [`get_field_value()`](https://github.com/netbox-community/netbox/blob/e1e514251e825fadfcc87a191502a931fa9edb5b/netbox/utilities/forms/utils.py#L132) utility function for dynamic form rendering. A simple proof is provided below. ```python from django import forms from dcim.models import Site from utilities.forms.utils import get_field_value class MyForm(forms.Form): site = forms.ModelChoiceField( queryset=Site.objects.all(), required=False ) form = MyForm({'site': None}, initial={'site': 1}) get_field_value(form, 'site') ``` ### Expected Behavior The function should always return the value of the field in a bound form. ### Observed Behavior When a null value is specified on a bound form, the function defers to the field's initial value: ```python &gt;&gt;&gt; form = MyForm({'site': 2}, initial={'site': 1}) &gt;&gt;&gt; get_field_value(form, 'site') 2 &gt;&gt;&gt; form = MyForm({'site': None}, initial={'site': 1}) &gt;&gt;&gt; get_field_value(form, 'site') 1 ```</DESCRIPTION>
  <REPONAME>netbox</REPONAME>
  <TIMEDIFFERENCEDAYS>4</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Fixes #18965: Ensure script list run buttons respect scripts' commit_default option (#19013) * Fixes #18965: Script list run buttons respect scripts' commit_default * Cleanup script .Meta access in template</MESSAGE>
    <SHA>e1e514251e825fadfcc87a191502a931fa9edb5b</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fixes #19023: get_field_value() should respect null values in bound forms</MESSAGE>
      <SHA>abdfeca349b72c375d54f7bc48aca13b79517ebe</SHA>
      <PATCHEDFILES>
        <FILE>netbox/utilities/forms/utils.py</FILE>
        <FILE>netbox/utilities/tests/test_forms.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fixes #19023: get_field_value() should respect null values in bound forms (#19024)</MESSAGE>
      <SHA>88ef9ecfa3ac14150e6d999df4247956165c2253</SHA>
      <PATCHEDFILES>
        <FILE>netbox/utilities/forms/utils.py</FILE>
        <FILE>netbox/utilities/tests/test_forms.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fixes #19023: get_field_value() should respect null values in bound forms (#19024)</MESSAGE>
      <SHA>9ee9cc71cda97c2add8f54ee89ba095848282b0d</SHA>
      <PATCHEDFILES>
        <FILE>netbox/utilities/forms/utils.py</FILE>
        <FILE>netbox/utilities/tests/test_forms.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Closes #19002: Module type profiles (#19014) * Move Module &amp; ModuleType models to a separate file * Add ModuleTypeProfile &amp; related fields * Initial work on JSON schema validation * Add attributes property on ModuleType * Introduce MultipleOfValidator * Introduce JSONSchemaProperty * Enable dynamic form field rendering * Misc cleanup * Fix migration conflict * Ensure deterministic ordering of attriubte fields * Support choices &amp; default values * Include module type attributes on module view * Enable modifying individual attributes via REST API * Enable filtering by attribute values * Add documentation &amp; tests * Schema should be optional * Include attributes column for profiles * Profile is nullable * Include some initial profiles to be installed via migration * Fix migrations conflict * Fix filterset test * Misc cleanup * Fixes #19023: get_field_value() should respect null values in bound forms (#19024) * Skip filters which do not specify a JSON-serializable value * Fix handling of array item types * Fix initial data in schema field during bulk edit * Implement sanity checking for JSON schema definitions * Fall back to filtering by string value</MESSAGE>
      <SHA>8d7889e2c00e44689fe9efe66da0422b6669ba9b</SHA>
      <PATCHEDFILES>
        <FILE>base_requirements.txt</FILE>
        <FILE>docs/models/dcim/moduletype.md</FILE>
        <FILE>docs/models/dcim/moduletypeprofile.md</FILE>
        <FILE>netbox/dcim/api/serializers_/devicetypes.py</FILE>
        <FILE>netbox/dcim/api/urls.py</FILE>
        <FILE>netbox/dcim/api/views.py</FILE>
        <FILE>netbox/dcim/filtersets.py</FILE>
        <FILE>netbox/dcim/forms/bulk_edit.py</FILE>
        <FILE>netbox/dcim/forms/bulk_import.py</FILE>
        <FILE>netbox/dcim/forms/filtersets.py</FILE>
        <FILE>netbox/dcim/forms/model_forms.py</FILE>
        <FILE>netbox/dcim/graphql/filters.py</FILE>
        <FILE>netbox/dcim/graphql/schema.py</FILE>
        <FILE>netbox/dcim/graphql/types.py</FILE>
        <FILE>netbox/dcim/migrations/0205_moduletypeprofile.py</FILE>
        <FILE>netbox/dcim/migrations/0206_load_module_type_profiles.py</FILE>
        <FILE>netbox/dcim/migrations/initial_data/module_type_profiles/cpu.json</FILE>
        <FILE>netbox/dcim/migrations/initial_data/module_type_profiles/fan.json</FILE>
        <FILE>netbox/dcim/migrations/initial_data/module_type_profiles/gpu.json</FILE>
        <FILE>netbox/dcim/migrations/initial_data/module_type_profiles/hard_disk.json</FILE>
        <FILE>netbox/dcim/migrations/initial_data/module_type_profiles/memory.json</FILE>
        <FILE>netbox/dcim/migrations/initial_data/module_type_profiles/power_supply.json</FILE>
        <FILE>netbox/dcim/models/__init__.py</FILE>
        <FILE>netbox/dcim/models/devices.py</FILE>
        <FILE>netbox/dcim/models/modules.py</FILE>
        <FILE>netbox/dcim/search.py</FILE>
        <FILE>netbox/dcim/tables/modules.py</FILE>
        <FILE>netbox/dcim/tables/template_code.py</FILE>
        <FILE>netbox/dcim/tests/test_api.py</FILE>
        <FILE>netbox/dcim/tests/test_filtersets.py</FILE>
        <FILE>netbox/dcim/tests/test_views.py</FILE>
        <FILE>netbox/dcim/urls.py</FILE>
        <FILE>netbox/dcim/utils.py</FILE>
        <FILE>netbox/dcim/views.py</FILE>
        <FILE>netbox/extras/tests/test_filtersets.py</FILE>
        <FILE>netbox/netbox/api/fields.py</FILE>
        <FILE>netbox/netbox/filtersets.py</FILE>
        <FILE>netbox/netbox/navigation/menu.py</FILE>
        <FILE>netbox/netbox/tables/columns.py</FILE>
        <FILE>netbox/templates/dcim/module.html</FILE>
        <FILE>netbox/templates/dcim/moduletype.html</FILE>
        <FILE>netbox/templates/dcim/moduletypeprofile.html</FILE>
        <FILE>netbox/utilities/forms/utils.py</FILE>
        <FILE>netbox/utilities/jsonschema.py</FILE>
        <FILE>netbox/utilities/tests/test_forms.py</FILE>
        <FILE>netbox/utilities/validators.py</FILE>
        <FILE>requirements.txt</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
