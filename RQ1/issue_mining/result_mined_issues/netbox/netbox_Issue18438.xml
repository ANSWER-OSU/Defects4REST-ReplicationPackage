<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>18438</ISSUENO>
  <ISSUEURL>https://github.com/netbox-community/netbox/issues/18438</ISSUEURL>
  <TITLE>IPAM migration 0072 not performant with large number of existing prefixes</TITLE>
  <DESCRIPTION>### Deployment Type NetBox Cloud ### NetBox Version v4.2.2 ### Python Version 3.10 ### Steps to Reproduce 1. Create a large number of prefixes (e.g. 20,000) in a previous NetBox release. 2. Upgrade to NetBox v4.2.0 or later. ### Expected Behavior The database migrations should complete within a reasonable amount of time. ### Observed Behavior The [`0072_prefix_cached_relations`](https://github.com/netbox-community/netbox/blob/main/netbox/ipam/migrations/0072_prefix_cached_relations.py) migration within the `ipam` app can take an excessively long time to complete when there exist many thousands of prefixes in the database. This is due to a missing `batch_size` parameter in the `bulk_update()` operation.</DESCRIPTION>
  <REPONAME>netbox</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Update source translation strings</MESSAGE>
    <SHA>d11deb66788c35ccb50eccdbd6bd2518733e2801</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fixes #18438: Specify batch_size for migrations which run bulk_update()</MESSAGE>
      <SHA>0d08a6b9a856304cf5dd0f46e861e7c4bd5d7ef6</SHA>
      <PATCHEDFILES>
        <FILE>netbox/circuits/migrations/0048_circuitterminations_cached_relations.py</FILE>
        <FILE>netbox/ipam/migrations/0072_prefix_cached_relations.py</FILE>
        <FILE>netbox/virtualization/migrations/0045_clusters_cached_relations.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fixes #18438: Specify batch_size for migrations which run bulk_update()</MESSAGE>
      <SHA>b91366129783d34b474d36e5dbf65e0d09016983</SHA>
      <PATCHEDFILES>
        <FILE>netbox/circuits/migrations/0048_circuitterminations_cached_relations.py</FILE>
        <FILE>netbox/ipam/migrations/0072_prefix_cached_relations.py</FILE>
        <FILE>netbox/virtualization/migrations/0045_clusters_cached_relations.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fixes #18438: Specify batch_size for migrations which run bulk_update()</MESSAGE>
      <SHA>da070559c0e30c5ade7e23e2629f7a3e924169ae</SHA>
      <PATCHEDFILES>
        <FILE>netbox/circuits/migrations/0048_circuitterminations_cached_relations.py</FILE>
        <FILE>netbox/ipam/migrations/0072_prefix_cached_relations.py</FILE>
        <FILE>netbox/virtualization/migrations/0045_clusters_cached_relations.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fixes #18438: Specify batch_size for migrations which run bulk_update()</MESSAGE>
      <SHA>b25ffc316849be50ee9306b31bee9bd18cd7aa44</SHA>
      <PATCHEDFILES>
        <FILE>netbox/circuits/migrations/0048_circuitterminations_cached_relations.py</FILE>
        <FILE>netbox/ipam/migrations/0072_prefix_cached_relations.py</FILE>
        <FILE>netbox/virtualization/migrations/0045_clusters_cached_relations.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
