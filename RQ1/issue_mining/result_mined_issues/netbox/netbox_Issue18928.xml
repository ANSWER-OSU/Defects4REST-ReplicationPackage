<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>18928</ISSUENO>
  <ISSUEURL>https://github.com/netbox-community/netbox/issues/18928</ISSUEURL>
  <TITLE>Bulk deletion of expired changelog records does not support cascades</TITLE>
  <DESCRIPTION>### Deployment Type NetBox Cloud ### NetBox Version v4.2.5 ### Python Version 3.10 ### Steps to Reproduce This issue manifests when a plugin-provided model has a relationship to NetBox's ObjectChange model. See netboxlabs/netbox-branching#175 for instance. ### Expected Behavior When running the `housekeeping` management command, all expired changelog records should be deleted successfully. ### Observed Behavior If there exists a relation from some other model to the ObjectChange model, the deletion of the ObjectChange record may fail due to a constraint violation. For example: &gt; django.db.utils.IntegrityError: update or delete on table &quot;core_objectchange&quot; violates foreign key constraint &quot;netbox_branching_app_change_id_5ac5eb3f_fk_core_obje&quot; on table &quot;netbox_branching_appliedchange&quot; &gt; DETAIL: Key (id)=(8) is still referenced from table &quot;netbox_branching_appliedchange&quot;.</DESCRIPTION>
  <REPONAME>netbox</REPONAME>
  <TIMEDIFFERENCEDAYS>1</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Fixes #18884: Handle tag assignments manually within deserialize_object (#18908)</MESSAGE>
    <SHA>f86647dc28d61d77a7f4f8fa946d880c75db6f50</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fixes #18928: Fix support for cascading deletions when cleaning up expired changelog records</MESSAGE>
      <SHA>c5801f988127cdb764d765b1452e1b4d46f7c834</SHA>
      <PATCHEDFILES>
        <FILE>netbox/extras/management/commands/housekeeping.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Merge pull request #18929 from netbox-community/18928-housekeeping-changelog-cleanup Fixes #18928: Fix support for cascading deletions when cleaning up expired changelog records</MESSAGE>
      <SHA>c50b1c989d0104b9f15c9aadd16ef810db7717b1</SHA>
      <PATCHEDFILES>
        <FILE>netbox/extras/management/commands/housekeeping.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
