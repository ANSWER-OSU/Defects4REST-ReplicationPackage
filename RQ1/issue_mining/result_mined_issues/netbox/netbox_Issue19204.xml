<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>19204</ISSUENO>
  <ISSUEURL>https://github.com/netbox-community/netbox/issues/19204</ISSUEURL>
  <TITLE>Job hanging / Event Rule for virtual machine model launching custom script causes job to hang</TITLE>
  <DESCRIPTION>### Deployment Type Self-hosted ### NetBox Version 4.2.6 ### Python Version 3.11 ### Steps to Reproduce Redis server v=7.0.15 sha=00000000:0 malloc=jemalloc-5.3.0 bits=64 build=c89c70d1d28059e4 (probably not relevant, but here u go) 1. Add custom script to Netbox that returns data 2. Create Event Rule for Virtual Machine with Action: Launch Script 3. Create/modify virtual machine Script: ``` from extras.scripts import * class MyCustomScript(Script): class Meta: name = &quot;My Custom Script&quot; description = &quot;My description&quot; def run(self, data, commit): return data ``` Virtual Machine Custom Fields: 2x Selection 1x Multiple Selection 1x Object: ![Image](https://github.com/user-attachments/assets/3e84d015-5b97-4b1c-a621-4f31e2149a8d) Platform Custom Fields: 1x Selection Tenant Custom Fields: 1x Object: Netbox-DNS-&gt;Record Here a quick json dump of the virtual machine I created. ``` { &quot;id&quot;: 153, &quot;url&quot;: &quot;https://mydomain/api/virtualization/virtual-machines/153/&quot;, &quot;display_url&quot;: &quot;mydomain/virtualization/virtual-machines/153/&quot;, &quot;display&quot;: &quot;test&quot;, &quot;name&quot;: &quot;test&quot;, &quot;status&quot;: { &quot;value&quot;: &quot;active&quot;, &quot;label&quot;: &quot;Active&quot; }, &quot;site&quot;: { &quot;id&quot;: 2, &quot;url&quot;: &quot;https://mydomain/api/dcim/sites/2/&quot;, &quot;display&quot;: &quot;NEXS_00&quot;, &quot;name&quot;: &quot;NEXS_00&quot;, &quot;slug&quot;: &quot;nexs_00&quot;, &quot;description&quot;: &quot;Chaeynz Home&quot; }, &quot;cluster&quot;: { &quot;id&quot;: 1, &quot;url&quot;: &quot;https://mydomain/api/virtualization/clusters/1/&quot;, &quot;display&quot;: &quot;RC&quot;, &quot;name&quot;: &quot;RC&quot;, &quot;description&quot;: &quot;&quot; }, &quot;device&quot;: null, &quot;serial&quot;: &quot;&quot;, &quot;role&quot;: null, &quot;tenant&quot;: null, &quot;platform&quot;: null, &quot;primary_ip&quot;: null, &quot;primary_ip4&quot;: null, &quot;primary_ip6&quot;: null, &quot;vcpus&quot;: null, &quot;memory&quot;: null, &quot;disk&quot;: null, &quot;description&quot;: &quot;&quot;, &quot;comments&quot;: &quot;&quot;, &quot;config_template&quot;: null, &quot;local_context_data&quot;: null, &quot;tags&quot;: [], &quot;custom_fields&quot;: { &quot;resource_pool&quot;: null, &quot;machine_service_category&quot;: null, &quot;nfs_share&quot;: null, &quot;vm_prefix&quot;: null }, &quot;config_context&quot;: {}, &quot;created&quot;: &quot;2025-04-15T20:24:08.790042Z&quot;, &quot;last_updated&quot;: &quot;2025-04-15T20:42:32.559175Z&quot;, &quot;interface_count&quot;: 0, &quot;virtual_disk_count&quot;: 0 } ``` I did not investigate further, but it seems to me there is some kind of loop going on. You have try except blocks in the code to launch scripts from what I am seeing.. Maybe it is because of the relation with objects? I hope this is useful, if you have any questions I will be happy to help! ### Expected Behavior Script should return virtual machine json data Or.. atleast timeout? ### Observed Behavior After 1 hour the jobs are still hanging that ran against for my virtual machine model. ![Image](https://github.com/user-attachments/assets/40d72735-e959-4dd1-a2c6-6380c2501a63)</DESCRIPTION>
  <REPONAME>netbox</REPONAME>
  <TIMEDIFFERENCEDAYS>7</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>19217 debug toolbar (#19289) * 19217 update and re-add django-debug-toolbar to INSTALLED_APPS * 19217 remove debug if not collectstatic</MESSAGE>
    <SHA>0ce307c7fd630999c0c7a01c61856576c68f9c4b</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fixes #19204: Use DjangoJSONEncoder for Job data</MESSAGE>
      <SHA>e19f8bbf86a66086b9cf30e7705bc5d08d703806</SHA>
      <PATCHEDFILES>
        <FILE>netbox/core/migrations/0013_job_data_encoder.py</FILE>
        <FILE>netbox/core/models/jobs.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fixes #19204: Use DjangoJSONEncoder for Job data (#19297)</MESSAGE>
      <SHA>fbf926204ec4b34277d418a503b5bf3b542ec3a9</SHA>
      <PATCHEDFILES>
        <FILE>netbox/core/migrations/0013_job_data_encoder.py</FILE>
        <FILE>netbox/core/models/jobs.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
