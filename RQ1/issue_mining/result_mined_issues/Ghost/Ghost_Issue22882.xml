<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>22882</ISSUENO>
  <ISSUEURL>https://github.com/TryGhost/Ghost/issues/22882</ISSUEURL>
  <TITLE>staff2fa beta lab does not have a UI in the labs section of the admin site</TITLE>
  <DESCRIPTION>### Issue Summary The staff2fa beta lab does not have a toggle on the Labs section of the Ghost admin site in my self-hosted instance. Checked to see if it was an alpha lab on a local development instance on Ghost, also on 5.116.1 with enableDeveloperExperiments set to true in the settings file. Still no luck. From what I’ve looked at though, it is marked as a beta lab currently. Briefly raised this [on the forum](https://forum.ghost.org/t/2fa-auth-slider-is-missing/56734), with others confirming that they can reproduce the issue. [vikaspotluri123](https://forum.ghost.org/u/vikaspotluri123) replied in the post I created stating that they also see it as a beta lab (as I also saw) per #21749. The issue seems that when it was removed from the alpha features UI due to it being changed to a beta lab, it was never actually added to the beta lab UI. As they stated, I am unsure if this is intentional—it does strike me as a bit odd! On the last part, if this _is_ intentional, please feel free to close this issue as not a bug, but a brief explanation would be appreciated, if possible! Thanks everyone for working on Ghost! ### Steps to Reproduce 1. Go to your Ghost admin site on `.../ghost`. 2. Open the site settings page. 3. Scroll down until you find the Labs section. 4. Click &quot;Open&quot; in the top-right corner of the labs card. 5. Observe no option to toggle on/off the `staff2fa` lab due to it not being listed. ### Ghost Version Reproduced on 5.116.1 and 5.116.2 ### Node.js Version Reproduced on 20.19.0 and 22.14.0 ### How did you install Ghost? Via the CLI on a VPS running Ubuntu 22.04.5 LTS (prod) and Laptop macOS 15.4 (24E248) (local) environments ### Database type MySQL 5.7 ### Browser &amp; OS version Safari 18.4 (20621.1.15.11.10) ### Relevant log / error output ```shell ``` ### Code of Conduct - [x] I agree to be friendly and polite to people in this repository</DESCRIPTION>
  <REPONAME>Ghost</REPONAME>
  <TIMEDIFFERENCEDAYS>3</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Update dependency react-router to v7.5.1 (#22949) This PR contains the following updates: | Package | Change | Age | Adoption | Passing | Confidence | |---|---|---|---|---|---| | [react-router](https://redirect.github.com/remix-run/react-router) ([source](https://redirect.github.com/remix-run/react-router/tree/HEAD/packages/react-router)) | [`7.5.0` -&gt; `7.5.1`](https://renovatebot.com/diffs/npm/react-router/7.5.0/7.5.1) | [![age](https://developer.mend.io/api/mc/badges/age/npm/react-router/7.5.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/react-router/7.5.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/react-router/7.5.0/7.5.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/react-router/7.5.0/7.5.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | --- ### Release Notes &lt;details&gt; &lt;summary&gt;remix-run/react-router (react-router)&lt;/summary&gt; ### [`v7.5.1`](https://redirect.github.com/remix-run/react-router/blob/HEAD/packages/react-router/CHANGELOG.md#751) ##### Patch Changes - Fix single fetch bug where no revalidation request would be made when navigating upwards to a reused parent route ([#&amp;#8203;13253](https://redirect.github.com/remix-run/react-router/pull/13253)) - When using the object-based `route.lazy` API, the `HydrateFallback` and `hydrateFallbackElement` properties are now skipped when lazy loading routes after hydration. ([#&amp;#8203;13376](https://redirect.github.com/remix-run/react-router/pull/13376)) If you move the code for these properties into a separate file, you can use this optimization to avoid downloading unused hydration code. For example: ```ts createBrowserRouter([ { path: &quot;/show/:showId&quot;, lazy: { loader: async () =&gt; (await import(&quot;./show.loader.js&quot;)).loader, Component: async () =&gt; (await import(&quot;./show.component.js&quot;)).Component, HydrateFallback: async () =&gt; (await import(&quot;./show.hydrate-fallback.js&quot;)).HydrateFallback, }, }, ]); ``` - Properly revalidate prerendered paths when param values change ([#&amp;#8203;13380](https://redirect.github.com/remix-run/react-router/pull/13380)) - UNSTABLE: Add a new `unstable_runClientMiddleware` argument to `dataStrategy` to enable middleware execution in custom `dataStrategy` implementations ([#&amp;#8203;13395](https://redirect.github.com/remix-run/react-router/pull/13395)) - UNSTABLE: Add better error messaging when `getLoadContext` is not updated to return a `Map`&quot; ([#&amp;#8203;13242](https://redirect.github.com/remix-run/react-router/pull/13242)) - Do not automatically add `null` to `staticHandler.query()` `context.loaderData` if routes do not have loaders ([#&amp;#8203;13223](https://redirect.github.com/remix-run/react-router/pull/13223)) - This was a Remix v2 implementation detail inadvertently left in for React Router v7 - Now that we allow returning `undefined` from loaders, our prior check of `loaderData[routeId] !== undefined` was no longer sufficient and was changed to a `routeId in loaderData` check - these `null` values can cause issues for this new check - ⚠️ This could be a &quot;breaking bug fix&quot; for you if you are doing manual SSR with `createStaticHandler()`/`&lt;StaticRouterProvider&gt;`, and using `context.loaderData` to control `&lt;RouterProvider&gt;` hydration behavior on the client - Fix prerendering when a loader returns a redirect ([#&amp;#8203;13365](https://redirect.github.com/remix-run/react-router/pull/13365)) - UNSTABLE: Update context type for `LoaderFunctionArgs`/`ActionFunctionArgs` when middleware is enabled ([#&amp;#8203;13381](https://redirect.github.com/remix-run/react-router/pull/13381)) - Add support for the new `unstable_shouldCallHandler`/`unstable_shouldRevalidateArgs` APIs in `dataStrategy` ([#&amp;#8203;13253](https://redirect.github.com/remix-run/react-router/pull/13253)) &lt;/details&gt; --- ### Configuration **Schedule**: Branch creation - At any time (no schedule defined), Automerge - Between 05:00 PM and 11:59 PM, only on Friday ( * 17-23 * * 5 ), Only on Sunday and Saturday ( * * * * 0,6 ), Between 12:00 AM and 12:59 PM, only on Monday ( * 0-12 * * 1 ) (UTC). **Automerge**: Enabled. ♻ **Rebasing**: Never, or you tick the rebase/retry checkbox. **Ignore**: Close this PR and you won't be reminded about this update again. --- - [ ] &lt;!-- rebase-check --&gt;If you want to rebase/retry this PR, check this box --- This PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/TryGhost/Ghost). &lt;!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzOS4yNDguNCIsInVwZGF0ZWRJblZlciI6IjM5LjI0OC40IiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6W119--&gt; Co-authored-by: renovate[bot] &lt;29139614+renovate[bot]@users.noreply.github.com&gt;</MESSAGE>
    <SHA>24fa3bb4ac8691bca83591adc1a723f56ec2de77</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>✨Enabled staff device verification by default (#22946) ref https://linear.app/ghost/issue/ENG-2127/swap-2fa-labs-flag-to-a-proper-config-flag closes https://github.com/TryGhost/Ghost/issues/22882 - This change enables staff device verification for all staff users - meaning that if a login from a new device is detected, we will send a 2FA code via email, and require it to be provided. - This change also requires that email be configured in order to login - It is also possible to force 2FA for all logins, by toggling the setting under &quot;Staff&quot; - Several weeks ago, we set the labs flag for staff2fa to default to true as part of a staged rollout to check the feature works. At that point, we removed the UI from labs, which has caused some confusion - sorry! - This change reworks the feature to be based on a config flag, rather than a labs flag. It's enabled by default, but can be disabled by setting the following in config: ``` &quot;security&quot;: { &quot;staffDeviceVerification&quot;: false } ```</MESSAGE>
      <SHA>86be98168278a2782aed637088f6fd245949e664</SHA>
      <PATCHEDFILES>
        <FILE>apps/admin-x-framework/src/api/config.ts</FILE>
        <FILE>apps/admin-x-framework/src/test/responses/config.json</FILE>
        <FILE>apps/admin-x-settings/src/components/settings/general/Users.tsx</FILE>
        <FILE>apps/admin-x-settings/test/acceptance/general/users/security.test.ts</FILE>
        <FILE>ghost/core/core/server/services/auth/session/index.js</FILE>
        <FILE>ghost/core/core/server/services/auth/session/session-service.js</FILE>
        <FILE>ghost/core/core/shared/config/env/config.testing-mysql.json</FILE>
        <FILE>ghost/core/core/shared/config/env/config.testing.json</FILE>
        <FILE>ghost/core/core/shared/labs.js</FILE>
        <FILE>ghost/core/test/e2e-api/admin/__snapshots__/config.test.js.snap</FILE>
        <FILE>ghost/core/test/e2e-api/admin/__snapshots__/session.test.js.snap</FILE>
        <FILE>ghost/core/test/e2e-api/admin/session.test.js</FILE>
        <FILE>ghost/core/test/e2e-api/admin/sso.test.js</FILE>
        <FILE>ghost/core/test/e2e-browser/admin/2fa.spec.js</FILE>
        <FILE>ghost/core/test/e2e-browser/admin/reset-password.spec.js</FILE>
        <FILE>ghost/core/test/e2e-browser/portal/invites.spec.js</FILE>
        <FILE>ghost/core/test/unit/server/services/auth/session/session-service.test.js</FILE>
        <FILE>ghost/core/test/utils/fixture-utils.js</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
