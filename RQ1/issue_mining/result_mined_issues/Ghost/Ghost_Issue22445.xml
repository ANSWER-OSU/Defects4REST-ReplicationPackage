<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>22445</ISSUENO>
  <ISSUEURL>https://github.com/TryGhost/Ghost/issues/22445</ISSUEURL>
  <TITLE>Add user role to for expanded editor permissions</TITLE>
  <DESCRIPTION>### Issue Summary Currently only admins (or owners) can manage members and moderate comments, with the only next-most-privileged role being the editor. It would be beneficial to add another level between that can do editing, member management, comment moderation, etc. that doesn't give full control over the site and settings. ### Steps to Reproduce f ### Ghost Version current ### Node.js Version 20 ### How did you install Ghost? local ### Database type MySQL 5.7 ### Browser &amp; OS version _No response_ ### Relevant log / error output ```shell ``` ### Code of Conduct - [x] I agree to be friendly and polite to people in this repository</DESCRIPTION>
  <REPONAME>Ghost</REPONAME>
  <TIMEDIFFERENCEDAYS>1</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Provided es-es translation for newsletter.json (#22418) no ref Provided English to Spanish translation with a Spain bias (es-es).</MESSAGE>
    <SHA>bbe612809fa035f10ad37112d94bee79866e1af3</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Updated fixtures for role tests ref TryGhost/Ghost#22445 In order to avoid a massive PR, this is Part #0 of the 'super editor' role addition. Role test fixtures are updated to be less rigid.</MESSAGE>
      <SHA>b1bd4fe6d15b2a0d1c83cf038ce0d0f5dae08e7d</SHA>
      <PATCHEDFILES>
        <FILE>ghost/core/test/regression/models/model_posts.test.js</FILE>
        <FILE>ghost/core/test/utils/fixture-utils.js</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Added labs flag for the super editor beta (#22444) ref TryGhost/Ghost#22445 Super editor labs flag. (Er... &quot;Enhanced Editor role&quot;) Part 1 of n. (Please merge #22443 first)</MESSAGE>
      <SHA>d204f4113b88d58545ffaa647775206492b8f872</SHA>
      <PATCHEDFILES>
        <FILE>apps/admin-x-settings/src/components/settings/advanced/labs/BetaFeatures.tsx</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Refactored and added utils for roles tests ref TryGhost/Ghost#22445 Part of the Super Editor project! Cleans up a bunch of gnarly _.some in favor of a utility function. While it adds an isSuperEditor and isEitherEditor, it should be without other impacts on permissions behavior and can be kept with or without the super editor permissions additions.</MESSAGE>
      <SHA>3dfb94c94f56bc7dfdfeb6c9bda465b4371757a1</SHA>
      <PATCHEDFILES>
        <FILE>ghost/core/core/server/models/invite.js</FILE>
        <FILE>ghost/core/core/server/models/post.js</FILE>
        <FILE>ghost/core/core/server/models/relations/authors.js</FILE>
        <FILE>ghost/core/core/server/models/role-utils.js</FILE>
        <FILE>ghost/core/core/server/models/role.js</FILE>
        <FILE>ghost/core/core/server/models/user.js</FILE>
        <FILE>ghost/core/test/unit/server/models/set-is-roles.test.js</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Added super editor roles &amp; permissions (#22450) ref https://github.com/TryGhost/Ghost/issues/22445 Migrations and tests related to migrations, for the super user feature --------- Co-authored-by: Steve Larson &lt;9larsons@gmail.com&gt;</MESSAGE>
      <SHA>16abea3e198ca5ef61ca84cadd3a8dbce680d8cd</SHA>
      <PATCHEDFILES>
        <FILE>ghost/core/core/server/data/migrations/versions/5.113/2025-03-07-12-24-00-add-super-editor.js</FILE>
        <FILE>ghost/core/core/server/data/migrations/versions/5.113/2025-03-07-12-25-00-add-member-perms-to-super-editor.js</FILE>
        <FILE>ghost/core/core/server/data/schema/fixtures/fixtures.json</FILE>
        <FILE>ghost/core/core/server/models/role.js</FILE>
        <FILE>ghost/core/core/server/models/user.js</FILE>
        <FILE>ghost/core/test/e2e-api/admin/__snapshots__/roles.test.js.snap</FILE>
        <FILE>ghost/core/test/e2e-api/admin/roles.test.js</FILE>
        <FILE>ghost/core/test/integration/migrations/migration.test.js</FILE>
        <FILE>ghost/core/test/regression/models/model_users.test.js</FILE>
        <FILE>ghost/core/test/unit/server/data/schema/fixtures/fixture-manager.test.js</FILE>
        <FILE>ghost/core/test/unit/server/data/schema/integrity.test.js</FILE>
        <FILE>ghost/core/test/utils/fixture-utils.js</FILE>
        <FILE>ghost/core/test/utils/fixtures/context.js</FILE>
        <FILE>ghost/core/test/utils/fixtures/data-generator.js</FILE>
        <FILE>ghost/core/test/utils/fixtures/fixtures.json</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Added Admin Settings changes for super editor role (#22452) ref https://github.com/TryGhost/Ghost/issues/22445 This PR contains the admin-x-settings changes needed to allow the super editor role. --------- Co-authored-by: Steve Larson &lt;9larsons@gmail.com&gt;</MESSAGE>
      <SHA>533bf2ee071a7a80b9f46453d89cb24ed5b11d2c</SHA>
      <PATCHEDFILES>
        <FILE>.github/workflows/ci.yml</FILE>
        <FILE>apps/admin-x-framework/src/api/roles.ts</FILE>
        <FILE>apps/admin-x-framework/src/api/users.ts</FILE>
        <FILE>apps/admin-x-framework/types/api/roles.d.ts</FILE>
        <FILE>apps/admin-x-settings/src/components/settings/general/InviteUserModal.tsx</FILE>
        <FILE>apps/admin-x-settings/src/components/settings/general/users/RoleSelector.tsx</FILE>
        <FILE>apps/admin-x-settings/src/hooks/useStaffUsers.tsx</FILE>
        <FILE>ghost/core/core/server/models/invite.js</FILE>
        <FILE>ghost/core/core/shared/labs.js</FILE>
        <FILE>ghost/core/test/e2e-api/admin/__snapshots__/config.test.js.snap</FILE>
        <FILE>ghost/core/test/e2e-api/admin/invites.test.js</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Added Admin changes for super editors (#22453) Ref https://github.com/TryGhost/Ghost/issues/22445 This PR has the admin section changes (and associated tests) for super editors, including routing adjustments. --------- Co-authored-by: Steve Larson &lt;9larsons@gmail.com&gt;</MESSAGE>
      <SHA>eb633a31814e28652f12076f52c97e64b198463e</SHA>
      <PATCHEDFILES>
        <FILE>apps/admin-x-framework/src/api/users.ts</FILE>
        <FILE>apps/admin-x-settings/src/components/settings/general/InviteUserModal.tsx</FILE>
        <FILE>ghost/admin/app/components/gh-nav-menu/footer.hbs</FILE>
        <FILE>ghost/admin/app/components/gh-nav-menu/main.hbs</FILE>
        <FILE>ghost/admin/app/components/gh-nav-menu/main.js</FILE>
        <FILE>ghost/admin/app/components/gh-post-settings-menu.js</FILE>
        <FILE>ghost/admin/app/controllers/lexical-editor.js</FILE>
        <FILE>ghost/admin/app/helpers/gh-user-can-manage-members.js</FILE>
        <FILE>ghost/admin/app/helpers/members-count-fetcher.js</FILE>
        <FILE>ghost/admin/app/models/user.js</FILE>
        <FILE>ghost/admin/app/routes/member.js</FILE>
        <FILE>ghost/admin/app/routes/members-activity.js</FILE>
        <FILE>ghost/admin/app/routes/members-management.js</FILE>
        <FILE>ghost/admin/app/routes/members.js</FILE>
        <FILE>ghost/admin/app/routes/members/import.js</FILE>
        <FILE>ghost/admin/app/templates/member.hbs</FILE>
        <FILE>ghost/admin/mirage/config/members.js</FILE>
        <FILE>ghost/admin/mirage/config/roles.js</FILE>
        <FILE>ghost/admin/mirage/config/tiers.js</FILE>
        <FILE>ghost/admin/mirage/fixtures/roles.js</FILE>
        <FILE>ghost/admin/tests/acceptance/dashboard-test.js</FILE>
        <FILE>ghost/admin/tests/acceptance/editor-test.js</FILE>
        <FILE>ghost/admin/tests/acceptance/editor/super-editor-lexical-test.js</FILE>
        <FILE>ghost/admin/tests/acceptance/members-activity-test.js</FILE>
        <FILE>ghost/admin/tests/acceptance/members-test.js</FILE>
        <FILE>ghost/admin/tests/acceptance/members/import-test.js</FILE>
        <FILE>ghost/admin/tests/acceptance/settings-button-test.js</FILE>
        <FILE>ghost/admin/tests/acceptance/tags-test.js</FILE>
        <FILE>ghost/admin/tests/unit/helpers/gh-user-can-manage-members-test.js</FILE>
        <FILE>ghost/admin/tests/unit/models/user-test.js</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>âœ¨ Added Beta feature: Editors can manage comments and members. (#22487) ref https://github.com/TryGhost/Ghost/issues/22445 closes https://github.com/TryGhost/Ghost/issues/22328 The current Ghost permissions system gives Editors the ability to publish posts and newsletters and to invite new authors and contributors, but does not give them any abilities in terms of member management, such as creating new members, providing complimentary access, viewing subscription status, or cancelling member subscriptions. Currently, that functionality is reserved for the Administrator level, but this access level includes substantial additional permissions, that the site owner may not want to grant to the person in their organization doing &quot;member support&quot;. The situation is similar for comments. Only administrators can moderate comments, even though a busy site might have a lot of staffing need in this area to keep things under control. This PR creates a &quot;Super Editor&quot; role that can also do user management and comments moderation, controlled by a beta feature flag. Note: changes to the feature flag toggle do not take effect on individual editors until their roles are individually updated. While I was there, I closed https://github.com/TryGhost/Ghost/issues/22328. I also added some refactoring of the role-based part of the permissions system to improve readability. **This is a multi-part PR.** #22487 this PR (comments, plus permissions bug fix (from 22450) and some clean-up ) #22453 (admin area) #22452 (admin-x) #22450 (migrations &amp; associated) #22448 (permissions refactoring and utility function) #22444 (labs flag) #22443 (updated fixtures and tests) Tests updated. New version of comments is required and will ship separately. --------- Co-authored-by: Steve Larson &lt;9larsons@gmail.com&gt;</MESSAGE>
      <SHA>7ca02f4e5f6d32248e0dab40f26edc369df77866</SHA>
      <PATCHEDFILES>
        <FILE>apps/comments-ui/src/App.tsx</FILE>
        <FILE>apps/comments-ui/test/utils/MockedApi.ts</FILE>
        <FILE>ghost/core/core/frontend/src/admin-auth/message-handler.js</FILE>
        <FILE>ghost/core/core/server/models/user.js</FILE>
        <FILE>ghost/core/core/server/services/permissions/can-this.js</FILE>
        <FILE>ghost/core/test/regression/models/model_posts.test.js</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
