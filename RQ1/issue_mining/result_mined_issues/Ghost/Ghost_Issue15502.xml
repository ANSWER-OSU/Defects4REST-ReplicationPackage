<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>15502</ISSUENO>
  <ISSUEURL>https://github.com/TryGhost/Ghost/issues/15502</ISSUEURL>
  <TITLE>i18n Milestone 2: Framework and build tools</TITLE>
  <DESCRIPTION>_This issue represents a single milestone within our i18n project. The full project is documented [on the Ghost forum](https://forum.ghost.org/t/hacktoberfest-project-i18n-for-portal-member-emails-comments-ui-sodosearch/33062)._ --- **Expected structure** - A new `ghost/locales` folder in the monorepo contains namespaced JSON files e.g. `locales/es/common.json`, `/ocales/es/portal.json`, `locales/es/email.json` - For Node.js/email-templates we do one of: - (Preferred) The correct path is loaded from config based on environment - ghost/locales gets copied into ghost/core somehow - Then for react: - Use code-splitting to generate individual versions of portal for each supported locale. **Goals:** - [x] Get the basic pieces of i18next in place &amp; configured according to [the tech spec](https://forum.ghost.org/t/hacktoberfest-project-i18n-for-portal-member-emails-comments-ui-sodosearch/33062#technical-plan-3) - [x] Implement the expected structure (see above) - [x] Figure out if we need to switch to vitejs in Portal to achieve the desired build (may need help from Ghost team) - [x] Have 1 interpolated string in each of email and Portal - [x] Tooling for extracting strings &amp; generating files ----- ## Tasks: - [x] Move Portal into the monorepo (Ghost team to complete soon) - [x] Demo/spike of the build tool for Portal - I think this is the hardest part so we should do it first - [x] Demo/spike of how locale files get pulled into Node.js for email templates - [x] Demo/spike of i18next wiring so that there's one interpolated string in Portal and one in an email template - [x] Demo/spike of a tooling that can grab the 2 interpolated strings e.g. `yarn translate es` would create `/locales/es/portal.js` and `/locales/es/email.js` each containing one string. I'm hoping to find people interested in the different parts to do initial spike implementations - then we can figure out the tasks more clearly. --- **Notes on participating &amp; Hacktoberfest:** We aren't going to merge half-baked spikes or wiring that doesn't match the spec yet - so if you're just trying to get through Hacktoberfest as fast as possible, this is not the issue for you! (There are plenty of small bugs though!) However, if you're using Hacktoberfest as a vehicle to find a cool &amp; meaningful project to work on, this should be well up your street :) We'll do our best to ensure that those who actively contribute value to this project get something merged and appropriately labelled by the end of Hacktoberfest If you're interested, drop a note to say Hi and which part you're interested in before getting stuck in, just in case we end up with multiple people trying to get the same things merged.</DESCRIPTION>
  <REPONAME>Ghost</REPONAME>
  <TIMEDIFFERENCEDAYS>171</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Fixed suppression list data for emails with plus sign (#16140) no issue When fetching the suppression list data for emails with a plus sign, the parsing of the NQL filter fails: ```at Child.applyDefaultAndCustomFilters (/Ghost/node_modules/@tryghost/bookshelf-filter/lib/bookshelf-filter.js:66:23) [ghost] email:[simon+test@ghos [ghost] ------------^ [ghost] Expecting 'OR', 'RBRACKET', got 'AND' ```</MESSAGE>
    <SHA>2dc9c7dbba7f33a5d922d3b964e65b01157a6577</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Added i18n package refs https://github.com/TryGhost/Ghost/issues/15502 - this is an early implementation of an i18n provider by exporting an instance of `i18next` - there's a lot more to be done here but baby steps :)</MESSAGE>
      <SHA>6c1e6ebaa0b51cab53675e2ca4704d79a353d876</SHA>
      <PATCHEDFILES>
        <FILE>ghost/i18n/.eslintrc.js</FILE>
        <FILE>ghost/i18n/README.md</FILE>
        <FILE>ghost/i18n/index.js</FILE>
        <FILE>ghost/i18n/lib/i18n.js</FILE>
        <FILE>ghost/i18n/locales/en.js</FILE>
        <FILE>ghost/i18n/locales/nl.js</FILE>
        <FILE>ghost/i18n/package.json</FILE>
        <FILE>ghost/i18n/test/.eslintrc.js</FILE>
        <FILE>ghost/i18n/test/i18n.test.js</FILE>
        <FILE>yarn.lock</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Added i18n package refs https://github.com/TryGhost/Ghost/issues/15502 - this is an early implementation of an i18n provider by exporting an instance of `i18next` - there's a lot more to be done here but baby steps :)</MESSAGE>
      <SHA>0d9268ad8683fa84a63f0ecad170f31b17e858a8</SHA>
      <PATCHEDFILES>
        <FILE>ghost/i18n/.eslintrc.js</FILE>
        <FILE>ghost/i18n/README.md</FILE>
        <FILE>ghost/i18n/index.js</FILE>
        <FILE>ghost/i18n/lib/i18n.js</FILE>
        <FILE>ghost/i18n/locales/en.js</FILE>
        <FILE>ghost/i18n/locales/nl.js</FILE>
        <FILE>ghost/i18n/package.json</FILE>
        <FILE>ghost/i18n/test/.eslintrc.js</FILE>
        <FILE>ghost/i18n/test/i18n.test.js</FILE>
        <FILE>yarn.lock</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Moved i18n translations into JSON files refs https://github.com/TryGhost/Ghost/issues/15502 - plain JSON files are cleaner and less overwhelming than boilerplate JS files, and given they're going to be automatically generated, we probably won't be able to support comments anyway</MESSAGE>
      <SHA>fb030353fe9b36ea597684b1a1b934d6c38b9496</SHA>
      <PATCHEDFILES>
        <FILE>ghost/i18n/lib/i18n.js</FILE>
        <FILE>ghost/i18n/locales/en.js</FILE>
        <FILE>ghost/i18n/locales/en.json</FILE>
        <FILE>ghost/i18n/locales/nl.js</FILE>
        <FILE>ghost/i18n/locales/nl.json</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Added `yarn translate:portal` command refs https://github.com/TryGhost/Ghost/issues/15502 - the amazing `i18next-parser` dependency will extract our translated strings from Portal and dump them into locale files, so we never have to add them manually</MESSAGE>
      <SHA>2cf161168b25d00e64a816db4a4d2eaea96df418</SHA>
      <PATCHEDFILES>
        <FILE>ghost/i18n/i18next-parser.config.js</FILE>
        <FILE>ghost/i18n/lib/i18n.js</FILE>
        <FILE>ghost/i18n/package.json</FILE>
        <FILE>yarn.lock</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Configured i18next-parser settings refs https://github.com/TryGhost/Ghost/issues/15502 - prevent it from creating `_old` files - set JSON indentation to 4 spaces</MESSAGE>
      <SHA>fbbea1c8a1f3d22b623550a2877f8d025d9badb5</SHA>
      <PATCHEDFILES>
        <FILE>ghost/i18n/i18next-parser.config.js</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Added CI test to ensure i18n strings are extracted out refs https://github.com/TryGhost/Ghost/issues/15502 - this will test if we have strings that aren't present in the JSON files in CI, so we don't miss out on translations</MESSAGE>
      <SHA>1f32a7be8a1f71cb792654c5ebe3cf4a944b348b</SHA>
      <PATCHEDFILES>
        <FILE>ghost/i18n/i18next-parser.config.js</FILE>
        <FILE>ghost/i18n/package.json</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Added i18n package refs https://github.com/TryGhost/Ghost/issues/15502 - this is an early implementation of an i18n provider by exporting an instance of `i18next` - there's a lot more to be done here but baby steps :)</MESSAGE>
      <SHA>236f1d3a6721f9f8a0511d31da2b7bc45244b79d</SHA>
      <PATCHEDFILES>
        <FILE>ghost/i18n/.eslintrc.js</FILE>
        <FILE>ghost/i18n/README.md</FILE>
        <FILE>ghost/i18n/index.js</FILE>
        <FILE>ghost/i18n/lib/i18n.js</FILE>
        <FILE>ghost/i18n/locales/en.js</FILE>
        <FILE>ghost/i18n/locales/nl.js</FILE>
        <FILE>ghost/i18n/package.json</FILE>
        <FILE>ghost/i18n/test/.eslintrc.js</FILE>
        <FILE>ghost/i18n/test/i18n.test.js</FILE>
        <FILE>yarn.lock</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Configured i18next-parser settings refs https://github.com/TryGhost/Ghost/issues/15502 - prevent it from creating `_old` files - set JSON indentation to 4 spaces</MESSAGE>
      <SHA>0d3edbb9b466dfb6b160602265754704132be4d3</SHA>
      <PATCHEDFILES>
        <FILE>ghost/i18n/i18next-parser.config.js</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Added CI test to ensure i18n strings are extracted out refs https://github.com/TryGhost/Ghost/issues/15502 - this will test if we have strings that aren't present in the JSON files in CI, so we don't miss out on translations</MESSAGE>
      <SHA>f1ccfef716e6bf5ef5bdcbf7c98e385256feebbc</SHA>
      <PATCHEDFILES>
        <FILE>ghost/i18n/i18next-parser.config.js</FILE>
        <FILE>ghost/i18n/package.json</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Renamed `yarn translate:portal` to `yarn translate:generate` refs https://github.com/TryGhost/Ghost/issues/15502 - needed to add the `i18n` tests so we don't lose the &quot;Hello&quot; test I wrote, and keeping everything under one command is easier</MESSAGE>
      <SHA>badbdbbedd7eb9e02d2ad271b246e6447344e9da</SHA>
      <PATCHEDFILES>
        <FILE>ghost/i18n/locales/en.json</FILE>
        <FILE>ghost/i18n/package.json</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Added `@tryghost/i18n` to Portal refs https://github.com/TryGhost/Ghost/issues/15502 - this adds the package to Portal and integrates it into the state we pass around - note: I've currently left the detection of the language (`site.locale`) commented for now until we flesh more of the implementation out</MESSAGE>
      <SHA>9e5efff187619922d37813a0c74675f31bb9a12f</SHA>
      <PATCHEDFILES>
        <FILE>ghost/portal/package.json</FILE>
        <FILE>ghost/portal/src/App.js</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fixed returning key when value is empty string refs https://github.com/TryGhost/Ghost/issues/15502 - in the event the value is an empty string, we want to return the key - this config option enables that</MESSAGE>
      <SHA>2804445d41b6803c508d525fd040efb13b758280</SHA>
      <PATCHEDFILES>
        <FILE>ghost/i18n/lib/i18n.js</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Added `i18n` translate function to test context refs https://github.com/TryGhost/Ghost/issues/15502 - this allows use of the `t` function whilst running tests</MESSAGE>
      <SHA>e630acdb88441090ea37f88186cda6e255d20c08</SHA>
      <PATCHEDFILES>
        <FILE>ghost/portal/src/utils/test-utils.js</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Added translation wrapper to public-facing strings in Portal refs https://github.com/TryGhost/Ghost/issues/15502 - in order to use the translations, strings must be wrapped in the `t` function, which is passed through AppContext - whilst I haven't instrumented all public strings, the vast majority are done here and the strings have been brought into the JSON locale files using `yarn translate:generate`</MESSAGE>
      <SHA>1aa9dbb52c640c9bfb1389912fb0050df24f9024</SHA>
      <PATCHEDFILES>
        <FILE>ghost/i18n/locales/en.json</FILE>
        <FILE>ghost/i18n/locales/nl.json</FILE>
        <FILE>ghost/portal/src/components/common/NewsletterManagement.js</FILE>
        <FILE>ghost/portal/src/components/common/PoweredBy.js</FILE>
        <FILE>ghost/portal/src/components/common/ProductsSection.js</FILE>
        <FILE>ghost/portal/src/components/common/SiteTitleBackButton.js</FILE>
        <FILE>ghost/portal/src/components/pages/AccountEmailPage.js</FILE>
        <FILE>ghost/portal/src/components/pages/AccountHomePage/components/EmailPreferencesAction.js</FILE>
        <FILE>ghost/portal/src/components/pages/AccountHomePage/components/UserHeader.js</FILE>
        <FILE>ghost/portal/src/components/pages/AccountPlanPage.js</FILE>
        <FILE>ghost/portal/src/components/pages/AccountProfilePage.js</FILE>
        <FILE>ghost/portal/src/components/pages/EmailSuppressedPage.js</FILE>
        <FILE>ghost/portal/src/components/pages/FeedbackPage.js</FILE>
        <FILE>ghost/portal/src/components/pages/MagicLinkPage.js</FILE>
        <FILE>ghost/portal/src/components/pages/NewsletterSelectionPage.js</FILE>
        <FILE>ghost/portal/src/components/pages/OfferPage.js</FILE>
        <FILE>ghost/portal/src/components/pages/SigninPage.js</FILE>
        <FILE>ghost/portal/src/components/pages/SignupPage.js</FILE>
        <FILE>ghost/portal/src/components/pages/UnsubscribePage.js</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Added translation wrapper to public-facing strings in Portal refs https://github.com/TryGhost/Ghost/issues/15502 - in order to use the translations, strings must be wrapped in the `t` function, which is passed through AppContext - whilst I haven't instrumented all public strings, the vast majority are done here and the strings have been brought into the JSON locale files using `yarn translate:generate`</MESSAGE>
      <SHA>acf2ab2d22350f439d7bd9c0dc91186ec96eb13b</SHA>
      <PATCHEDFILES>
        <FILE>ghost/i18n/locales/en.json</FILE>
        <FILE>ghost/i18n/locales/nl.json</FILE>
        <FILE>ghost/portal/src/components/common/NewsletterManagement.js</FILE>
        <FILE>ghost/portal/src/components/common/PoweredBy.js</FILE>
        <FILE>ghost/portal/src/components/common/ProductsSection.js</FILE>
        <FILE>ghost/portal/src/components/common/SiteTitleBackButton.js</FILE>
        <FILE>ghost/portal/src/components/pages/AccountEmailPage.js</FILE>
        <FILE>ghost/portal/src/components/pages/AccountHomePage/components/EmailPreferencesAction.js</FILE>
        <FILE>ghost/portal/src/components/pages/AccountHomePage/components/UserHeader.js</FILE>
        <FILE>ghost/portal/src/components/pages/AccountPlanPage.js</FILE>
        <FILE>ghost/portal/src/components/pages/AccountProfilePage.js</FILE>
        <FILE>ghost/portal/src/components/pages/EmailSuppressedPage.js</FILE>
        <FILE>ghost/portal/src/components/pages/FeedbackPage.js</FILE>
        <FILE>ghost/portal/src/components/pages/MagicLinkPage.js</FILE>
        <FILE>ghost/portal/src/components/pages/NewsletterSelectionPage.js</FILE>
        <FILE>ghost/portal/src/components/pages/OfferPage.js</FILE>
        <FILE>ghost/portal/src/components/pages/SigninPage.js</FILE>
        <FILE>ghost/portal/src/components/pages/SignupPage.js</FILE>
        <FILE>ghost/portal/src/components/pages/UnsubscribePage.js</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Added support for namespaces to i18n package refs https://github.com/TryGhost/Ghost/issues/15502 - this adds support for namespaces to the i18n package so we can separate translations for different packages</MESSAGE>
      <SHA>6d8ca23625ccb5ee87bdea62e21ff1c323f2d692</SHA>
      <PATCHEDFILES>
        <FILE>ghost/i18n/i18next-parser.config.js</FILE>
        <FILE>ghost/i18n/lib/i18n.js</FILE>
        <FILE>ghost/i18n/locales/en/portal.json</FILE>
        <FILE>ghost/i18n/locales/en/test.json</FILE>
        <FILE>ghost/i18n/locales/nl/portal.json</FILE>
        <FILE>ghost/i18n/locales/nl/test.json</FILE>
        <FILE>ghost/i18n/package.json</FILE>
        <FILE>ghost/i18n/test/i18n.test.js</FILE>
        <FILE>ghost/portal/src/App.js</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
