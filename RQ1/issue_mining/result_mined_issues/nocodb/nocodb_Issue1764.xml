<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>1764</ISSUENO>
  <ISSUEURL>https://github.com/nocodb/nocodb/issues/1764</ISSUEURL>
  <TITLE>Migration from 0.84.16 to 0.90.3 failed (mssql, docker)</TITLE>
  <DESCRIPTION>MSSQL only supports one ALTER COLUMN per ALTER TABLE (see https://docs.microsoft.com/en-us/sql/t-sql/statements/alter-table-transact-sql?redirectedfrom=MSDN&amp;view=sql-server-ver15) **Please enter the following details** please provide the following details : NocoDB used as docker : true NocoDB version : 0.90.3 Database used in NC_DB URL : mssql Project was created by clicking : New Project by connecting to external database Database on which spreadsheet is created : mssql OS on which NocoDB is running : Linux Node.js version if running as node : Database version : 15.0.4198.2 **Steps To Reproduce** 1. docker stop; docker rm 2. Update docker image to latest (dc4717b4f34a) 3. docker run 4. Dashboard isn't shown in frontend (&quot;Cannot GET /&quot;) 5. See error **Expected behavior** Frontend starting; Dashboard shown; Migration done; No error in log **Error** App started successfully. Visit -&gt; *********** Tue, 19 Apr 2022 12:11:39 GMT tedious deprecated The default value for `config.options.enableArithAbort` will change from `false` to `true` in the next major version of `tedious`. Set the value to `true` or `false` explicitly to silence this message. at node_modules/mssql/lib/tedious/connection-pool.js:61:23 migration file &quot;nc_012_alter_column_data_types&quot; failed migration failed with error: ALTER TABLE [nc_columns_v2] alter column [cdf] nvarchar(max), [dtxp] nvarchar(max), [cc] nvarchar(max), [ct] nvarchar(max) - Incorrect syntax near ','. RequestError: ALTER TABLE [nc_columns_v2] alter column [cdf] nvarchar(max), [dtxp] nvarchar(max), [cc] nvarchar(max), [ct] nvarchar(max) - Incorrect syntax near ','. at handleError (/usr/src/app/node_modules/mssql/lib/tedious/request.js:374:15) at Connection.emit (events.js:314:20) at Connection.EventEmitter.emit (domain.js:483:12) at Parser.&lt;anonymous&gt; (/usr/src/app/node_modules/tedious/lib/connection.js:832:12) at Parser.emit (events.js:314:20) at Parser.EventEmitter.emit (domain.js:483:12) at Parser.&lt;anonymous&gt; (/usr/src/app/node_modules/tedious/lib/token/token-stream-parser.js:37:14) at Parser.emit (events.js:314:20) at Parser.EventEmitter.emit (domain.js:483:12) at addChunk (/usr/src/app/node_modules/readable-stream/lib/_stream_readable.js:298:12) { code: 'EREQUEST', originalError: Error: Incorrect syntax near ','. at handleError (/usr/src/app/node_modules/mssql/lib/tedious/request.js:372:19) at Connection.emit (events.js:314:20) at Connection.EventEmitter.emit (domain.js:483:12) at Parser.&lt;anonymous&gt; (/usr/src/app/node_modules/tedious/lib/connection.js:832:12) at Parser.emit (events.js:314:20) at Parser.EventEmitter.emit (domain.js:483:12) at Parser.&lt;anonymous&gt; (/usr/src/app/node_modules/tedious/lib/token/token-stream-parser.js:37:14) at Parser.emit (events.js:314:20) at Parser.EventEmitter.emit (domain.js:483:12) at addChunk (/usr/src/app/node_modules/readable-stream/lib/_stream_readable.js:298:12) { info: ErrorMessageToken { name: 'ERROR', event: 'errorMessage', number: 102, state: 1, class: 15, message: &quot;Incorrect syntax near ','.&quot;, serverName: '********', procName: '', lineNumber: 1 } }, number: 102, lineNumber: 1, state: 1, class: 15, serverName: '*********', procName: '', precedingErrors: [] }</DESCRIPTION>
  <REPONAME>nocodb</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>fix: migration down statement correction Signed-off-by: Pranav C &lt;pranavxc@gmail.com&gt;</MESSAGE>
    <SHA>f2efbee4ae35cbff200b061b3a3ddb78ad9a82fe</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>fix(migration): split alter table statement into multiple statements to support MSSQL re #1764 Signed-off-by: Pranav C &lt;pranavxc@gmail.com&gt;</MESSAGE>
      <SHA>8cbd4215803c2fd9bb3e91775b457bed8d01985d</SHA>
      <PATCHEDFILES>
        <FILE>packages/nocodb/src/lib/noco/migrationsv2/nc_012_alter_column_data_types.ts</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fix - Migration bugs (#1771) * fix: handle formula parse error in formula migration re #1760 Signed-off-by: Pranav C &lt;pranavxc@gmail.com&gt; * fix: avoid project user insertion if corresponding project or user is missing re #1760 Signed-off-by: Pranav C &lt;pranavxc@gmail.com&gt; * fix: skip shared views if view_name/model_name is empty or missing re #1760 Signed-off-by: Pranav C &lt;pranavxc@gmail.com&gt; * fix: migration down statement correction Signed-off-by: Pranav C &lt;pranavxc@gmail.com&gt; * fix(migration): split alter table statement into multiple statements to support MSSQL re #1764 Signed-off-by: Pranav C &lt;pranavxc@gmail.com&gt;</MESSAGE>
      <SHA>03bf9180ea78a09b433c6fc14fef4e21169204b8</SHA>
      <PATCHEDFILES>
        <FILE>packages/nocodb/src/lib/noco/migrationsv2/nc_011.ts</FILE>
        <FILE>packages/nocodb/src/lib/noco/migrationsv2/nc_012_alter_column_data_types.ts</FILE>
        <FILE>packages/nocodb/src/lib/noco/upgrader/jobs/ncProjectUpgraderV2_0090000.ts</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>0.90.5 Pre-release (#1774) * chore(deps): bump minimist Bumps [minimist](https://github.com/substack/minimist) from 1.2.5 to 1.2.6. - [Release notes](https://github.com/substack/minimist/releases) - [Commits](https://github.com/substack/minimist/compare/1.2.5...1.2.6) --- updated-dependencies: - dependency-name: minimist dependency-type: indirect ... Signed-off-by: dependabot[bot] &lt;support@github.com&gt; * chore(deps): bump async from 2.6.3 to 2.6.4 in /packages/noco-docs-prev Bumps [async](https://github.com/caolan/async) from 2.6.3 to 2.6.4. - [Release notes](https://github.com/caolan/async/releases) - [Changelog](https://github.com/caolan/async/blob/v2.6.4/CHANGELOG.md) - [Commits](https://github.com/caolan/async/compare/v2.6.3...v2.6.4) --- updated-dependencies: - dependency-name: async dependency-type: indirect ... Signed-off-by: dependabot[bot] &lt;support@github.com&gt; * chore(deps): bump async from 2.6.3 to 2.6.4 in /packages/noco-docs Bumps [async](https://github.com/caolan/async) from 2.6.3 to 2.6.4. - [Release notes](https://github.com/caolan/async/releases) - [Changelog](https://github.com/caolan/async/blob/v2.6.4/CHANGELOG.md) - [Commits](https://github.com/caolan/async/compare/v2.6.3...v2.6.4) --- updated-dependencies: - dependency-name: async dependency-type: indirect ... Signed-off-by: dependabot[bot] &lt;support@github.com&gt; * chore(deps): bump async from 2.6.3 to 2.6.4 in /packages/nc-plugin Bumps [async](https://github.com/caolan/async) from 2.6.3 to 2.6.4. - [Release notes](https://github.com/caolan/async/releases) - [Changelog](https://github.com/caolan/async/blob/v2.6.4/CHANGELOG.md) - [Commits](https://github.com/caolan/async/compare/v2.6.3...v2.6.4) --- updated-dependencies: - dependency-name: async dependency-type: indirect ... Signed-off-by: dependabot[bot] &lt;support@github.com&gt; * chore(deps): bump async from 2.6.3 to 2.6.4 in /packages/nc-cli Bumps [async](https://github.com/caolan/async) from 2.6.3 to 2.6.4. - [Release notes](https://github.com/caolan/async/releases) - [Changelog](https://github.com/caolan/async/blob/v2.6.4/CHANGELOG.md) - [Commits](https://github.com/caolan/async/compare/v2.6.3...v2.6.4) --- updated-dependencies: - dependency-name: async dependency-type: indirect ... Signed-off-by: dependabot[bot] &lt;support@github.com&gt; * chore(deps): bump async from 2.6.3 to 2.6.4 in /packages/noco-i18n Bumps [async](https://github.com/caolan/async) from 2.6.3 to 2.6.4. - [Release notes](https://github.com/caolan/async/releases) - [Changelog](https://github.com/caolan/async/blob/v2.6.4/CHANGELOG.md) - [Commits](https://github.com/caolan/async/compare/v2.6.3...v2.6.4) --- updated-dependencies: - dependency-name: async dependency-type: indirect ... Signed-off-by: dependabot[bot] &lt;support@github.com&gt; * chore(deps): bump async from 2.6.3 to 2.6.4 in /packages/noco-blog Bumps [async](https://github.com/caolan/async) from 2.6.3 to 2.6.4. - [Release notes](https://github.com/caolan/async/releases) - [Changelog](https://github.com/caolan/async/blob/v2.6.4/CHANGELOG.md) - [Commits](https://github.com/caolan/async/compare/v2.6.3...v2.6.4) --- updated-dependencies: - dependency-name: async dependency-type: indirect ... Signed-off-by: dependabot[bot] &lt;support@github.com&gt; * chore(deps): bump async from 2.6.3 to 2.6.4 in /packages/nocodb-sdk Bumps [async](https://github.com/caolan/async) from 2.6.3 to 2.6.4. - [Release notes](https://github.com/caolan/async/releases) - [Changelog](https://github.com/caolan/async/blob/v2.6.4/CHANGELOG.md) - [Commits](https://github.com/caolan/async/compare/v2.6.3...v2.6.4) --- updated-dependencies: - dependency-name: async dependency-type: indirect ... Signed-off-by: dependabot[bot] &lt;support@github.com&gt; * chore(deps): bump minimist from 1.2.5 to 1.2.6 in /packages/nocodb Bumps [minimist](https://github.com/substack/minimist) from 1.2.5 to 1.2.6. - [Release notes](https://github.com/substack/minimist/releases) - [Commits](https://github.com/substack/minimist/compare/1.2.5...1.2.6) --- updated-dependencies: - dependency-name: minimist dependency-type: indirect ... Signed-off-by: dependabot[bot] &lt;support@github.com&gt; * refactor: i18n zh_CN corrections Signed-off-by: Raju Udava &lt;86527202+dstala@users.noreply.github.com&gt; * refactor: use SqlFactory from nocodb-sdk package (#1750) Signed-off-by: Pranav C &lt;pranavxc@gmail.com&gt; * fix: refer parent table referenced column in filter query(BT) re #1756 Signed-off-by: Pranav C &lt;pranavxc@gmail.com&gt; * fix: wrap nested add update query select part to avoid issue when referencing same table Signed-off-by: Pranav C &lt;pranavxc@gmail.com&gt; * chore(deps): bump async in /packages/nc-migrator-archived Bumps [async](https://github.com/caolan/async) from 2.6.2 to 2.6.4. - [Release notes](https://github.com/caolan/async/releases) - [Changelog](https://github.com/caolan/async/blob/v2.6.4/CHANGELOG.md) - [Commits](https://github.com/caolan/async/compare/v2.6.2...v2.6.4) --- updated-dependencies: - dependency-name: async dependency-type: indirect ... Signed-off-by: dependabot[bot] &lt;support@github.com&gt; * docs: update README.md [skip ci] * docs: update .all-contributorsrc [skip ci] * docs: add info related to {orgs} and swagger ui Signed-off-by: Wing-Kam Wong &lt;wingkwong.code@gmail.com&gt; * Fix - Migration bugs (#1771) * fix: handle formula parse error in formula migration re #1760 Signed-off-by: Pranav C &lt;pranavxc@gmail.com&gt; * fix: avoid project user insertion if corresponding project or user is missing re #1760 Signed-off-by: Pranav C &lt;pranavxc@gmail.com&gt; * fix: skip shared views if view_name/model_name is empty or missing re #1760 Signed-off-by: Pranav C &lt;pranavxc@gmail.com&gt; * fix: migration down statement correction Signed-off-by: Pranav C &lt;pranavxc@gmail.com&gt; * fix(migration): split alter table statement into multiple statements to support MSSQL re #1764 Signed-off-by: Pranav C &lt;pranavxc@gmail.com&gt; * refactor: add null check in upgrader Signed-off-by: Pranav C &lt;pranavxc@gmail.com&gt; Co-authored-by: dependabot[bot] &lt;49699333+dependabot[bot]@users.noreply.github.com&gt; Co-authored-by: Raju Udava &lt;86527202+dstala@users.noreply.github.com&gt; Co-authored-by: աɨռɢӄաօռɢ &lt;wingkwong.code@gmail.com&gt; Co-authored-by: navi &lt;oof1lab@gmail.com&gt; Co-authored-by: allcontributors[bot] &lt;46447321+allcontributors[bot]@users.noreply.github.com&gt;</MESSAGE>
      <SHA>412053039e84251293557b1b98036437266e61de</SHA>
      <PATCHEDFILES>
        <FILE>.all-contributorsrc</FILE>
        <FILE>README.md</FILE>
        <FILE>packages/nc-cli/package-lock.json</FILE>
        <FILE>packages/nc-gui/components/project/functionTab/functionQuery.vue</FILE>
        <FILE>packages/nc-gui/components/project/spreadsheet/public/xcForm.vue</FILE>
        <FILE>packages/nc-gui/components/project/spreadsheet/public/xcTable.vue</FILE>
        <FILE>packages/nc-gui/components/project/sqlClient.vue</FILE>
        <FILE>packages/nc-gui/components/project/tableTabs/columns.vue</FILE>
        <FILE>packages/nc-gui/helpers/sqlUi/MssqlUi.js</FILE>
        <FILE>packages/nc-gui/helpers/sqlUi/MysqlUi.js</FILE>
        <FILE>packages/nc-gui/helpers/sqlUi/OracleUi.js</FILE>
        <FILE>packages/nc-gui/helpers/sqlUi/PgUi.js</FILE>
        <FILE>packages/nc-gui/helpers/sqlUi/SqlUiFactory.js</FILE>
        <FILE>packages/nc-gui/helpers/sqlUi/SqliteUi.js</FILE>
        <FILE>packages/nc-gui/helpers/sqlUi/index.js</FILE>
        <FILE>packages/nc-gui/lang/zh_CN.json</FILE>
        <FILE>packages/nc-migrator-archived/package-lock.json</FILE>
        <FILE>packages/nc-plugin/package-lock.json</FILE>
        <FILE>packages/noco-blog/package-lock.json</FILE>
        <FILE>packages/noco-docs-prev/package-lock.json</FILE>
        <FILE>packages/noco-docs/content/en/developer-resources/rest-apis.md</FILE>
        <FILE>packages/noco-docs/package-lock.json</FILE>
        <FILE>packages/noco-i18n/package-lock.json</FILE>
        <FILE>packages/nocodb-sdk/package-lock.json</FILE>
        <FILE>packages/nocodb/package-lock.json</FILE>
        <FILE>packages/nocodb/src/__tests__/restv2.test.ts</FILE>
        <FILE>packages/nocodb/src/lib/dataMapper/lib/sql/BaseModelSqlv2.ts</FILE>
        <FILE>packages/nocodb/src/lib/dataMapper/lib/sql/conditionV2.ts</FILE>
        <FILE>packages/nocodb/src/lib/dataMapper/lib/sql/formulav2/formulaQueryBuilderv2.ts</FILE>
        <FILE>packages/nocodb/src/lib/dataMapper/lib/sql/sortV2.ts</FILE>
        <FILE>packages/nocodb/src/lib/noco-models/Column.ts</FILE>
        <FILE>packages/nocodb/src/lib/noco-models/Filter.ts</FILE>
        <FILE>packages/nocodb/src/lib/noco-models/GalleryView.ts</FILE>
        <FILE>packages/nocodb/src/lib/noco-models/HookFilter.ts</FILE>
        <FILE>packages/nocodb/src/lib/noco-models/Model.ts</FILE>
        <FILE>packages/nocodb/src/lib/noco/common/BaseApiBuilder.ts</FILE>
        <FILE>packages/nocodb/src/lib/noco/meta/NcMetaMgr.ts</FILE>
        <FILE>packages/nocodb/src/lib/noco/meta/api/columnApis.ts</FILE>
        <FILE>packages/nocodb/src/lib/noco/meta/api/metaDiffApis.ts</FILE>
        <FILE>packages/nocodb/src/lib/noco/meta/api/projectApis.ts</FILE>
        <FILE>packages/nocodb/src/lib/noco/meta/api/publicApis/publicMetaApis.ts</FILE>
        <FILE>packages/nocodb/src/lib/noco/meta/handlersv2/ncCreateLookup.ts</FILE>
        <FILE>packages/nocodb/src/lib/noco/migrationsv2/nc_011.ts</FILE>
        <FILE>packages/nocodb/src/lib/noco/migrationsv2/nc_012_alter_column_data_types.ts</FILE>
        <FILE>packages/nocodb/src/lib/noco/upgrader/jobs/ncProjectUpgraderV2_0090000.ts</FILE>
        <FILE>packages/nocodb/src/lib/sqlMgr/code/models/xc/BaseModelXcMeta.ts</FILE>
        <FILE>packages/nocodb/src/lib/sqlUi/MssqlUi.ts</FILE>
        <FILE>packages/nocodb/src/lib/sqlUi/MysqlUi.ts</FILE>
        <FILE>packages/nocodb/src/lib/sqlUi/OracleUi.ts</FILE>
        <FILE>packages/nocodb/src/lib/sqlUi/PgUi.ts</FILE>
        <FILE>packages/nocodb/src/lib/sqlUi/SqlUiFactory.ts</FILE>
        <FILE>packages/nocodb/src/lib/sqlUi/SqliteUi.ts</FILE>
        <FILE>packages/nocodb/src/lib/sqlUi/UITypes.ts</FILE>
        <FILE>packages/nocodb/src/lib/sqlUi/index.ts</FILE>
        <FILE>packages/nocodb/src/lib/templateParser/NcTemplateParser.ts</FILE>
        <FILE>scripts/cypress/fixtures/sqlite-sakila/regenFiles/package-lock.json</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
