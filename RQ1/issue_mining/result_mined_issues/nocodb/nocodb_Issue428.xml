<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>428</ISSUENO>
  <ISSUEURL>https://github.com/nocodb/nocodb/issues/428</ISSUEURL>
  <TITLE>Bug in 'reverse-proxy with sub-path' configuration</TITLE>
  <DESCRIPTION>**Please enter the following details** Node: **v12.22.1** Arch: **x64** Platform: **linux** Docker: **true** Database: **pg** ProjectOnRootDB: **true** RootDB: **pg** PackageVersion: **0.11.9** **Steps To Reproduce** 1. Set up a reverse proxy, e.g. nginx 2. Set up a location directive in nginx, where a subfolder is forward to nocodb: ``` server { server_name sub.domain.tld; listen 80; location /db/ { proxy_set_header Host $host; proxy_set_header X-Forwarded-Host $host:$server_port; proxy_set_header X-Forwarded-Proto https; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_pass http://localhost:8080/; chunked_transfer_encoding off; proxy_buffering off; proxy_cache off; } location / { // another app } } ``` In the docker-compose, set up the environment variables: ``` nocodb: container_name: nocodb depends_on: root_db: condition: service_healthy image: nocodb/nocodb:latest ports: - &quot;8080:8080&quot; - &quot;127.0.0.1:8081:8081&quot; - &quot;127.0.0.1:8082:8082&quot; - &quot;127.0.0.1:8083:8083&quot; restart: always environment: NC_DB: &quot;db connection string&quot; NC_PUBLIC_URL: &quot;http://sub.domain.tld/db&quot; NC_BACKEND_URL: &quot;http://sub.domain.tld/db&quot; NC_DISABLE_TELE: &quot;true&quot; ``` 4. The app starts behaving erroneously. Some links in the UI don't work correctly while some options might be missing. - Clicking on a project sends an invalid request: ```http://sub.domain.tld/nc/test1_XnM0/projectApiInfo``` As ```/db/``` is not prefixed before ```/nc/```, nginx considers this request to be invalid and actually sends it to the other app. - After opening a project, in the top-left pop-up menu, the link for Swagger Docs is missing. ![image](https://user-images.githubusercontent.com/64059154/128353999-62c6c8e5-6f70-4b12-8630-16de1f5f4ccb.png) This link is available when the nocodb app is accessed directly via the server's IP address (bypassing nginx): ![image](https://user-images.githubusercontent.com/64059154/128354062-f5375d54-e617-42f3-939a-2bcf8b463545.png) **Expected behaviour** The app should load and operate smoothly and all routes should be prefixed with: &quot;http://sub.domain.tld/db/&quot;</DESCRIPTION>
  <REPONAME>nocodb</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>chore(publish): v0.11.9 Signed-off-by: Pranav C &lt;61551451+pranavxc@users.noreply.github.com&gt;</MESSAGE>
    <SHA>40494fc3e95e6278caf7abe8345b3e76a37d4278</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>fix: Remove unnecessary baseurl appending, Correction in refresh token api re #428 Signed-off-by: Pranav C &lt;61551451+pranavxc@users.noreply.github.com&gt;</MESSAGE>
      <SHA>83db607c31a6c3ecc11662b8f9ffdb27feb1c0e2</SHA>
      <PATCHEDFILES>
        <FILE>packages/nc-gui/components/project/graphqlClient.vue</FILE>
        <FILE>packages/nc-gui/components/project/spreadsheet/apis/gqlApi.js</FILE>
        <FILE>packages/nc-gui/components/project/swaggerClient.vue</FILE>
        <FILE>packages/nc-gui/components/project/xcInfo.vue</FILE>
        <FILE>packages/nc-gui/layouts/default.vue</FILE>
        <FILE>packages/nc-gui/plugins/axiosInterceptor.js</FILE>
        <FILE>packages/nc-gui/plugins/ncApis/gqlApi.js</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>fix: Update Swagger json path &amp; favicon re #428 Signed-off-by: Pranav C &lt;61551451+pranavxc@users.noreply.github.com&gt;</MESSAGE>
      <SHA>9bbb41a08a9417b386310414affa1511fb636b33</SHA>
      <PATCHEDFILES>
        <FILE>packages/nocodb/src/lib/noco/rest/RestApiBuilder.ts</FILE>
        <FILE>packages/nocodb/src/lib/noco/rest/ui/auth/swagger.ts</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>fix: Refresh token error handling re #428 Signed-off-by: Pranav C &lt;61551451+pranavxc@users.noreply.github.com&gt;</MESSAGE>
      <SHA>6cd6b5dd76baac335fc5cac7feb4f27a5258be16</SHA>
      <PATCHEDFILES>
        <FILE>packages/nocodb/src/lib/noco/rest/RestAuthCtrl.ts</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>fix: Remove unnecessary baseurl appending, Correction in refresh token api re #428 Signed-off-by: Pranav C &lt;61551451+pranavxc@users.noreply.github.com&gt;</MESSAGE>
      <SHA>c8848353a5210e1ef22b5d73c33e40e0d2aa384c</SHA>
      <PATCHEDFILES>
        <FILE>packages/nc-gui/components/project/graphqlClient.vue</FILE>
        <FILE>packages/nc-gui/components/project/spreadsheet/apis/gqlApi.js</FILE>
        <FILE>packages/nc-gui/components/project/swaggerClient.vue</FILE>
        <FILE>packages/nc-gui/components/project/xcInfo.vue</FILE>
        <FILE>packages/nc-gui/layouts/default.vue</FILE>
        <FILE>packages/nc-gui/plugins/axiosInterceptor.js</FILE>
        <FILE>packages/nc-gui/plugins/ncApis/gqlApi.js</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>fix: Update Swagger json path &amp; favicon re #428 Signed-off-by: Pranav C &lt;61551451+pranavxc@users.noreply.github.com&gt;</MESSAGE>
      <SHA>11a92dd346faf333026e7ad17a5fb3fbe8be14ec</SHA>
      <PATCHEDFILES>
        <FILE>packages/nocodb/src/lib/noco/rest/RestApiBuilder.ts</FILE>
        <FILE>packages/nocodb/src/lib/noco/rest/ui/auth/swagger.ts</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>fix: Refresh token error handling re #428 Signed-off-by: Pranav C &lt;61551451+pranavxc@users.noreply.github.com&gt;</MESSAGE>
      <SHA>e006488cfa656e007868c73153960fd15274c929</SHA>
      <PATCHEDFILES>
        <FILE>packages/nocodb/src/lib/noco/rest/RestAuthCtrl.ts</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
