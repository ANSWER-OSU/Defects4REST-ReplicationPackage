<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>3370</ISSUENO>
  <ISSUEURL>https://github.com/apache/apisix/issues/3370</ISSUEURL>
  <TITLE>bug: http service should not be started before etcd data is pulled</TITLE>
  <DESCRIPTION>### Issue description that when accessing immediately after apisix is started, it will return: ```json {&quot;error_msg &quot;: &quot;404 Route Not Found&quot;} ``` Is it because apisix did not pull the route data in etcd in time? maybe the http service of apisix should be started after pulling etcd data. ### Environment * apisix version: [docker] apache/apisix:2.2-alpine * OS: [docker] apache/apisix:2.2-alpine * OpenResty / Nginx version: [docker] apache/apisix:2.2-alpine * etcd enabled auto-tls. * apisix disable etcd.tls.verify.</DESCRIPTION>
  <REPONAME>apisix</REPONAME>
  <TIMEDIFFERENCEDAYS>50</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>docs: sync English doc to Chinese (#3796) Signed-off-by: spacewander &lt;spacewanderlzx@gmail.com&gt;</MESSAGE>
    <SHA>8609cd507a554c62474c3915160a4f9c1c47afef</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>feat: load etcd configuration when apisix starts Fix #3370 Signed-off-by: spacewander &lt;spacewanderlzx@gmail.com&gt;</MESSAGE>
      <SHA>a625b48f815a0263f0ca20b5c5b074c008df841d</SHA>
      <PATCHEDFILES>
        <FILE>apisix/cli/etcd.lua</FILE>
        <FILE>apisix/constants.lua</FILE>
        <FILE>apisix/core/config_etcd.lua</FILE>
        <FILE>apisix/core/config_yaml.lua</FILE>
        <FILE>apisix/core/etcd.lua</FILE>
        <FILE>apisix/init.lua</FILE>
        <FILE>apisix/patch.lua</FILE>
        <FILE>apisix/plugin.lua</FILE>
        <FILE>t/APISIX.pm</FILE>
        <FILE>t/admin/plugins-reload.t</FILE>
        <FILE>t/core/etcd.t</FILE>
        <FILE>t/misc/patch.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>feat: load etcd configuration when apisix starts Fix #3370 Signed-off-by: spacewander &lt;spacewanderlzx@gmail.com&gt;</MESSAGE>
      <SHA>9d55aa27cf0fec1cdc94e8abe36298e1e1b17d45</SHA>
      <PATCHEDFILES>
        <FILE>apisix/cli/etcd.lua</FILE>
        <FILE>apisix/constants.lua</FILE>
        <FILE>apisix/core/config_etcd.lua</FILE>
        <FILE>apisix/core/config_yaml.lua</FILE>
        <FILE>apisix/core/etcd.lua</FILE>
        <FILE>apisix/init.lua</FILE>
        <FILE>apisix/patch.lua</FILE>
        <FILE>apisix/plugin.lua</FILE>
        <FILE>t/APISIX.pm</FILE>
        <FILE>t/admin/plugins-reload.t</FILE>
        <FILE>t/core/etcd.t</FILE>
        <FILE>t/misc/patch.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>feat: load etcd configuration when apisix starts Fix #3370 Signed-off-by: spacewander &lt;spacewanderlzx@gmail.com&gt;</MESSAGE>
      <SHA>7dfdad2105d943775aecb27ae22e3f6265a958f2</SHA>
      <PATCHEDFILES>
        <FILE>apisix/cli/etcd.lua</FILE>
        <FILE>apisix/constants.lua</FILE>
        <FILE>apisix/core/config_etcd.lua</FILE>
        <FILE>apisix/core/config_yaml.lua</FILE>
        <FILE>apisix/core/etcd.lua</FILE>
        <FILE>apisix/init.lua</FILE>
        <FILE>apisix/patch.lua</FILE>
        <FILE>t/APISIX.pm</FILE>
        <FILE>t/admin/plugins-reload.t</FILE>
        <FILE>t/core/etcd-sync.t</FILE>
        <FILE>t/core/etcd.t</FILE>
        <FILE>t/misc/patch.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>feat: load etcd configuration when apisix starts (#3799) Fix #3370 Signed-off-by: spacewander &lt;spacewanderlzx@gmail.com&gt;</MESSAGE>
      <SHA>83537ad1585b38692397e45776e7abea17af03d8</SHA>
      <PATCHEDFILES>
        <FILE>apisix/cli/etcd.lua</FILE>
        <FILE>apisix/constants.lua</FILE>
        <FILE>apisix/core/config_etcd.lua</FILE>
        <FILE>apisix/core/config_yaml.lua</FILE>
        <FILE>apisix/core/etcd.lua</FILE>
        <FILE>apisix/init.lua</FILE>
        <FILE>apisix/patch.lua</FILE>
        <FILE>t/APISIX.pm</FILE>
        <FILE>t/admin/plugins-reload.t</FILE>
        <FILE>t/core/etcd-sync.t</FILE>
        <FILE>t/core/etcd.t</FILE>
        <FILE>t/misc/patch.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
