<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>5077</ISSUENO>
  <ISSUEURL>https://github.com/apache/apisix/issues/5077</ISSUEURL>
  <TITLE>bug: In radixtree_host_uri mode, the prometheus plugin cannot obtain the correct matched_uri value.</TITLE>
  <DESCRIPTION>### Issue description In radixtree_host_uri mode. api_ctx.curr_req_matched._path was eventually replaced by `host_rev` example: request: http://123.com/x1 api_ctx.curr_req_matched._path replaced by `moc.321` ### Environment - apisix version (cmd: `apisix version`): v2.9 - OS (cmd: `uname -a`): centos7 - OpenResty / Nginx version (cmd: `nginx -V` or `openresty -V`): 1.19.3.1 ### Steps to reproduce 1: adjustment mode, change to `radixtree_host_uri` 2: request apisix route 3: query apisx:9091/apisx/promethues/metrics. ### Actual result host reverse. example: request: http://123.com/x1 api_ctx.curr_req_matched._path replaced by `moc.321` ### Error log none ### Expected result api_ctx.curr_req_matched._path replaced by `matched_ops.uri`</DESCRIPTION>
  <REPONAME>apisix</REPONAME>
  <TIMEDIFFERENCEDAYS>5</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>test: gzip test may fail because size may be validated before number (#5097)</MESSAGE>
    <SHA>46cabd6b9e1e76baf27c1f153e02ad9127894abe</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>fix(radixtree_host_uri): correct matched path Fix #5077 Signed-off-by: spacewander &lt;spacewanderlzx@gmail.com&gt;</MESSAGE>
      <SHA>06c59bdd4dab85c679739c340933bf96f655a4d4</SHA>
      <PATCHEDFILES>
        <FILE>apisix/http/router/radixtree_host_uri.lua</FILE>
        <FILE>t/router/radixtree-host-uri3.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>fix(radixtree_host_uri): correct matched path (#5104) Fix #5077 Signed-off-by: spacewander &lt;spacewanderlzx@gmail.com&gt;</MESSAGE>
      <SHA>034d231183365987b7807e594751fffe8fc4a8f7</SHA>
      <PATCHEDFILES>
        <FILE>apisix/http/router/radixtree_host_uri.lua</FILE>
        <FILE>t/router/radixtree-host-uri3.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
