<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>2991</ISSUENO>
  <ISSUEURL>https://github.com/apache/apisix/issues/2991</ISSUEURL>
  <TITLE>reject request data if it contains an empty array, eg: &quot;remote_addrs&quot;: []</TITLE>
  <DESCRIPTION>To add a route, if the `remote_addrs` field is an empty array, the matching behavior is ambiguous. In order to avoid ambiguity and keep the API design simple and clear, we should reject the value as an empty array. Here is an example, should return `400`: ``` $ curl http://127.0.0.1:9080/apisix/admin/routes/1 -H 'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1' -X PUT -i -d ' { &quot;uri&quot;: &quot;/index.html&quot;, &quot;remote_addrs&quot;: [], &quot;enable_websocket&quot;: true, &quot;upstream&quot;: { &quot;type&quot;: &quot;roundrobin&quot;, &quot;nodes&quot;: { &quot;39.97.63.215:80&quot;: 1 } } }' HTTP/1.1 400 Bad Request ... ... ``` **Here is the todo list(from the discussion)** * `Admin API`: reject request data if it contains an empty array, eg: `&quot;remote_addrs&quot;: []`. `Code + Doc` * `Manager API`: same as `Admin API`. * `Dashbaord`: keep adding hacking codes to the frontend. `Code` The field `hosts`, `uris` and `methods`, they have the same issue, we should fix them in the same way too. original comment: https://github.com/apache/apisix/issues/2924#issuecomment-740405671</DESCRIPTION>
  <REPONAME>apisix</REPONAME>
  <TIMEDIFFERENCEDAYS>2</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>test: solve conflict between #2993 and #2943 (#2997) Signed-off-by: spacewander &lt;spacewanderlzx@gmail.com&gt;</MESSAGE>
    <SHA>9918efbe5ba8b367550a5ea64aa6de3f5183ca7f</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>feat: improve jsonschema validation on route resource Fix #2671 Fix #2991 Signed-off-by: spacewander &lt;spacewanderlzx@gmail.com&gt;</MESSAGE>
      <SHA>f0026c794a583881c7c8c57a9fb3a4c9e7ce3147</SHA>
      <PATCHEDFILES>
        <FILE>apisix/admin/routes.lua</FILE>
        <FILE>apisix/schema_def.lua</FILE>
        <FILE>doc/admin-api.md</FILE>
        <FILE>t/admin/routes.t</FILE>
        <FILE>t/admin/routes2.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>feat: improve jsonschema validation on route resource Fix #2671 Fix #2991 Signed-off-by: spacewander &lt;spacewanderlzx@gmail.com&gt;</MESSAGE>
      <SHA>8183133bea68ba74e3f41c16f7bee0915014cc81</SHA>
      <PATCHEDFILES>
        <FILE>apisix/admin/routes.lua</FILE>
        <FILE>apisix/schema_def.lua</FILE>
        <FILE>doc/admin-api.md</FILE>
        <FILE>doc/zh-cn/admin-api.md</FILE>
        <FILE>t/admin/routes.t</FILE>
        <FILE>t/admin/routes2.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>feat: improve jsonschema validation on route resource Fix #2671 Fix #2991 Signed-off-by: spacewander &lt;spacewanderlzx@gmail.com&gt;</MESSAGE>
      <SHA>12c18b54d066980e1223cf2e98029edb41722d3a</SHA>
      <PATCHEDFILES>
        <FILE>apisix/admin/routes.lua</FILE>
        <FILE>apisix/schema_def.lua</FILE>
        <FILE>doc/admin-api.md</FILE>
        <FILE>doc/zh-cn/admin-api.md</FILE>
        <FILE>t/admin/routes2.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>feat: improve jsonschema validation on route resource (#3008) fix #2671 fix #2991</MESSAGE>
      <SHA>0eacf3af7dd12d5cd7ba1e2d8e9b4ba1833218b1</SHA>
      <PATCHEDFILES>
        <FILE>apisix/admin/routes.lua</FILE>
        <FILE>apisix/schema_def.lua</FILE>
        <FILE>doc/admin-api.md</FILE>
        <FILE>doc/zh-cn/admin-api.md</FILE>
        <FILE>t/admin/routes2.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
