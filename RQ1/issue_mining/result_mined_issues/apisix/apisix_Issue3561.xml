<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>3561</ISSUENO>
  <ISSUEURL>https://github.com/apache/apisix/issues/3561</ISSUEURL>
  <TITLE>test unstable: t/plugin/prometheus.t</TITLE>
  <DESCRIPTION>### Issue description Test failed in CI. ``` Error: led test 'TEST 45: set route with key-auth enabled for consumer metrics - pattern &quot;[error]&quot; should not match any line in error.log but matches line &quot;2021/02/08 13:52:26 [error] 21196#21196: *3795 [lua] config_yaml.lua:66: failed to fetch /home/runner/work/apisix/apisix/t/servroot/conf/apisix.yaml attributes: cannot obtain information from file '/home/runner/work/apisix/apisix/t/servroot/conf/apisix.yaml': No such file or directory, context: ngx.timer&quot; (req 0) # 2021/02/08 13:52:26 [error] 21195#21195: *3798 [lua] config_yaml.lua:66: failed to fetch /home/runner/work/apisix/apisix/t/servroot/conf/apisix.yaml attributes: cannot obtain information from file '/home/runner/work/apisix/apisix/t/servroot/conf/apisix.yaml': No such file or directory, context: ngx.timer # 2021/02/08 13:52:26 [info] 21253#21253: *3781 [lua] plugin.lua:547: checker(): check plugin schema, name: prometheus, configurations: {}, context: ngx.timer # 2021/02/08 13:52:26 [info] 21253#21253: *3781 [lua] service.lua:88: filter(): filter service: {&quot;value&quot;:{&quot;update_time&quot;:1612792326,&quot;plugins&quot;:{&quot;prometheus&quot;:{}},&quot;upstream&quot;:{&quot;parent&quot;:{&quot;value&quot;:&quot;table: 0x7f0dbfc7bc90&quot;,&quot;clean_handlers&quot;:{},&quot;modifiedIndex&quot;:8392,&quot;has_domain&quot;:false,&quot;key&quot;:&quot;\/apisix\/services\/1&quot;,&quot;createdIndex&quot;:8392},&quot;type&quot;:&quot;roundrobin&quot;,&quot;hash_on&quot;:&quot;vars&quot;,&quot;scheme&quot;:&quot;http&quot;,&quot;nodes&quot;:[{&quot;host&quot;:&quot;127.0.0.1&quot;,&quot;port&quot;:1980,&quot;weight&quot;:1}],&quot;pass_host&quot;:&quot;pass&quot;},&quot;id&quot;:&quot;1&quot;,&quot;create_time&quot;:1612792326},&quot;clean_handlers&quot;:&quot;table: 0x7f0dbf867e98&quot;,&quot;modifiedIndex&quot;:8392,&quot;has_domain&quot;:false,&quot;key&quot;:&quot;\/apisix\/services\/1&quot;,&quot;createdIndex&quot;:8392}, context: ngx.timer # 2021/02/08 13:52:26 [info] 21253#21253: *3779 [lua] plugin.lua:547: checker(): check plugin schema, name: prometheus, configurations: {}, context: ngx.timer # 2021/02/08 13:52:26 [info] 21253#21253: *3783 [lua] v3.lua:34: _request_uri(): v3 request uri: http://127.0.0.1:2379/v3/kv/put, timeout: 30, context: ngx.timer # 2021/02/08 13:52:26 [info] 21253#21253: *3775 [lua] v3.lua:563: request_chunk(): http request method: POST path: /v3/watch body: {&quot;create_request&quot;:{&quot;range_end&quot;:&quot;L2FwaXNpeC9yb3V0ZXQ=&quot;,&quot;start_revision&quot;:8459,&quot;key&quot;:&quot;L2FwaXNpeC9yb3V0ZXM=&quot;}} query: nil, context: ngx.timer # 2021/02/08 13:52:26 [info] 21253#21253: *3789 [lua] v3.lua:563: request_chunk(): http request method: POST path: /v3/watch body: {&quot;create_request&quot;:{&quot;range_end&quot;:&quot;L2FwaXNpeC9jb25zdW1lcnQ=&quot;,&quot;start_revision&quot;:8459,&quot;key&quot;:&quot;L2FwaXNpeC9jb25zdW1lcnM=&quot;}} query: nil, context: ngx.timer # 2021/02/08 13:52:26 [info] 21253#21253: *3787 [lua] v3.lua:563: request_chunk(): http request method: POST path: /v3/watch body: {&quot;create_request&quot;:{&quot;range_end&quot;:&quot;L2FwaXNpeC9wbHVnaW5fbWV0YWRhdGI=&quot;,&quot;start_revision&quot;:8459,&quot;key&quot;:&quot;L2FwaXNpeC9wbHVnaW5fbWV0YWRhdGE=&quot;}} query: nil, context: ngx.timer # 2021/02/08 13:52:26 [info] 21253#21253: *3777 [lua] v3.lua:563: request_chunk(): http request method: POST path: /v3/watch body: {&quot;create_request&quot;:{&quot;range_end&quot;:&quot;L2FwaXNpeC9zc20=&quot;,&quot;start_revision&quot;:8459,&quot;key&quot;:&quot;L2FwaXNpeC9zc2w=&quot;}} query: nil, context: ngx.timer # ' # at /home/runner/work/apisix/apisix/test-nginx/lib/Test/Nginx/Socket.pm line 1280. ``` ### Environment * apisix version (cmd: `apisix version`): master * OS (cmd: `uname -a`): ubunt-18.04 * OpenResty / Nginx version (cmd: `nginx -V` or `openresty -V`): 1.15 * etcd version, if have (cmd: run `curl http://127.0.0.1:9090/v1/server_info` to get the info from server-info API): * apisix-dashboard version, if have:</DESCRIPTION>
  <REPONAME>apisix</REPONAME>
  <TIMEDIFFERENCEDAYS>1</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>docs: fix grammar (#3539)</MESSAGE>
    <SHA>e5cd46e38e09d1025817381a3bf0b85a4f02a528</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>test: split prometheus test case Fix #3561 Signed-off-by: spacewander &lt;spacewanderlzx@gmail.com&gt;</MESSAGE>
      <SHA>a5c83a93087c3a8c23025f01fed1c9e724911ac2</SHA>
      <PATCHEDFILES>
        <FILE>t/plugin/prometheus.t</FILE>
        <FILE>t/plugin/prometheus2.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>test: split prometheus test case Fix #3561 Signed-off-by: spacewander &lt;spacewanderlzx@gmail.com&gt;</MESSAGE>
      <SHA>398ecd8ea49dee5fba059aa93f0d477bd62d1280</SHA>
      <PATCHEDFILES>
        <FILE>t/plugin/prometheus.t</FILE>
        <FILE>t/plugin/prometheus2.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>test: split prometheus test case Fix #3561 Signed-off-by: spacewander &lt;spacewanderlzx@gmail.com&gt;</MESSAGE>
      <SHA>671e452b8bfcf9d8829ccc7d7f8e3412706a2f3d</SHA>
      <PATCHEDFILES>
        <FILE>t/plugin/prometheus.t</FILE>
        <FILE>t/plugin/prometheus2.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>test: split prometheus test case (#3563) Fix #3561 Signed-off-by: spacewander &lt;spacewanderlzx@gmail.com&gt;</MESSAGE>
      <SHA>0b6d35d965ea1a33a2ba30c0f042b41abeed3381</SHA>
      <PATCHEDFILES>
        <FILE>t/plugin/prometheus.t</FILE>
        <FILE>t/plugin/prometheus2.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
