<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>2938</ISSUENO>
  <ISSUEURL>https://github.com/apache/apisix/issues/2938</ISSUEURL>
  <TITLE>bug: &quot;unread data in buffer&quot; when getting prometheus metrics</TITLE>
  <DESCRIPTION>### Issue description We have the prometheus plugin enabled in global rule and query the /apisix/promethues/metrics endpoint once per second. After upgrading to APISIX 2.0 from 1.5, occasionally we see ERROR logs like this: `[error] 36#36: *105103628 [lua] http.lua:951: request_uri(): unread data in buffer, client:, server: , request: &quot;GET /apisix/prometheus/metrics HTTP/1.1&quot;` ### Environment * apisix version (cmd: `apisix version`): 2.0 * OS: linux ### Minimal test code / Steps to reproduce the issue 1. We weren't able to reproduce this issue. ### What's the actual result? (including assertion message &amp; call stack if applicable) Errors, see above. Not sure if this has any impact on the prometheus metrics? ### What's the expected result? No errors.</DESCRIPTION>
  <REPONAME>apisix</REPONAME>
  <TIMEDIFFERENCEDAYS>276</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>docs(cors): update expose_headers description (#4937)</MESSAGE>
    <SHA>a062a9c83bad20672babd0b0b64484220dcac16c</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>chore: explicitly track api7-lua-resty-http &amp; upgrade lua-resty-etcd Fix #2938 Signed-off-by: spacewander &lt;spacewanderlzx@gmail.com&gt;</MESSAGE>
      <SHA>5bdea09b5d184e1b61b140ee86d172eb2a0c484b</SHA>
      <PATCHEDFILES>
        <FILE>rockspec/apisix-master-0.rockspec</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>chore: explicitly track api7-lua-resty-http &amp; upgrade lua-resty-etcd (#4974) Fix #2938 Signed-off-by: spacewander &lt;spacewanderlzx@gmail.com&gt;</MESSAGE>
      <SHA>0e2b284d8086fefdf7cde5a658886323f98ac467</SHA>
      <PATCHEDFILES>
        <FILE>rockspec/apisix-master-0.rockspec</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
