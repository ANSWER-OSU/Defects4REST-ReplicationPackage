<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>6848</ISSUENO>
  <ISSUEURL>https://github.com/apache/apisix/issues/6848</ISSUEURL>
  <TITLE>bug: http-logger 和grpc-transcode 同时使用BUG</TITLE>
  <DESCRIPTION>### Current Behavior http-logger 开启 include_resp_body = true 记录返回body 同时 使用 grpc-transcode 接口返回数据错错误 表现为返回 proto 定义的默认值 ### Expected Behavior 正常解析grpc ### Error Logs _No response_ ### Steps to Reproduce 1.开启插件 http-logger 开启 include_resp_body = true 记录返回body 2.编写一个grpc 服务通过 grpc-transcode解析 3. 请求后返回默认值 4. 插件 http-logger 设置 include_resp_body = false 请求返回正常 详细步骤,代码:https://github.com/aixichen/apisix_bug/blob/master/README.md ### Environment - APISIX version (run `apisix version`):2.13.0 - Operating system (run `uname -a`):root</DESCRIPTION>
  <REPONAME>apisix</REPONAME>
  <TIMEDIFFERENCEDAYS>4</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>fix(grpc-web): don't override Access-Control-Allow-Origin header in response (#6842)</MESSAGE>
    <SHA>d6a4afd1f81717bfe2e6d0328b179c6db5a18543</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>fix(grpc-transcode): fetch the response body cached in the ctx Closes #6848</MESSAGE>
      <SHA>8d55221f3499651902a9e3a313ecce3f23b2cbed</SHA>
      <PATCHEDFILES>
        <FILE>apisix/plugins/grpc-transcode/response.lua</FILE>
        <FILE>t/plugin/grpc-transcode-with-logger-plgin.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>fix(grpc-transcode): fetch the response body cached in the ctx (#6862) Closes #6848</MESSAGE>
      <SHA>2518b18a7ba87e4e42204bb01924c0c8f79d7527</SHA>
      <PATCHEDFILES>
        <FILE>apisix/plugins/grpc-transcode/response.lua</FILE>
        <FILE>t/plugin/grpc-transcode2.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>fix(grpc-transcode): fetch the response body cached in the ctx (#6862) Closes #6848</MESSAGE>
      <SHA>b4cbd9172ba80ca7f4a9a8e1137335866671463e</SHA>
      <PATCHEDFILES>
        <FILE>apisix/plugins/grpc-transcode/response.lua</FILE>
        <FILE>t/plugin/grpc-transcode2.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>fix(grpc-transcode): fetch the response body cached in the ctx (#6862) Closes #6848</MESSAGE>
      <SHA>0d5735bfc0cfb1f75fc5b33ffb4e39f2ec47bd82</SHA>
      <PATCHEDFILES>
        <FILE>apisix/plugins/grpc-transcode/response.lua</FILE>
        <FILE>t/plugin/grpc-transcode2.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
