<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>1901</ISSUENO>
  <ISSUEURL>https://github.com/apache/apisix/issues/1901</ISSUEURL>
  <TITLE>bug: 500 error when bench limit-count plugin</TITLE>
  <DESCRIPTION>limit count conf: policy: redis count: 100 time_window: 60 key: remote_addr os: CentOS 7.6 benchmark tool: apache benchmark I got runtime error which result in 500 response when i bench 1million request, 1k concurrency by ab.It seems `red:ttl(key)` return nil in limit-count-redis.lua. The follow snippet is runtime error detail: ``` lua entry thread aborted: runtime error: .../apisix/apisix/plugins/limit-count/limit-count-redis.lua:76: attempt to compare nil with number stack traceback: coroutine 0: .../apisix/apisix/plugins/limit-count/limit-count-redis.lua: in function 'incoming' /usr/local/apisix/apisix/plugins/limit-count.lua:121: in function 'phase_fun' /usr/local/apisix/apisix/init.lua:147: in function 'run_plugin' /usr/local/apisix/apisix/init.lua:385: in function 'http_access_phase' access_by_lua(nginx.conf:161):2: in main chunk ``` Is it a bug? @membphis @moonming</DESCRIPTION>
  <REPONAME>apisix</REPONAME>
  <TIMEDIFFERENCEDAYS>5</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>doc: update Chinese how-to-build.md (#1936) fix #1933</MESSAGE>
    <SHA>c6f7af6be7ccaf5de08c93e8edcbe7542a221d23</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>bugfix: fix limit-count plugin redis.ttl error. (#1928) FIX #1901</MESSAGE>
      <SHA>2433152d9a9bf2179b201490cc0d84afbe23e446</SHA>
      <PATCHEDFILES>
        <FILE>apisix/plugins/limit-count/limit-count-redis.lua</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
