<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>1838</ISSUENO>
  <ISSUEURL>https://github.com/apache/apisix/issues/1838</ISSUEURL>
  <TITLE>bug: discovery Eureka cannot automatically proxy to a new node</TITLE>
  <DESCRIPTION>### Issue description register a new instance to Eureka,but can't proxy to this instance ### Environment * apisix version (cmd: `apisix version`): 1.4 * OS:mac os ### Minimal test code / Steps to reproduce the issue 1. 2. 3. ### What's the actual result? (including assertion message &amp; call stack if applicable) oldnode host&quot;:&quot;172.16.50.93&quot;,&quot;port&quot;:8888 newnode host&quot;:&quot;172.16.50.93&quot;,&quot;port&quot;:8081 apisix balance proxy to oldnode not to newnode after make reload itâ€˜s OK ### What's the expected result?</DESCRIPTION>
  <REPONAME>apisix</REPONAME>
  <TIMEDIFFERENCEDAYS>188</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>ci: support to run ci on Centos 7 (#3061) fix #2573</MESSAGE>
    <SHA>3e19b06293463f52c8d26f0958542fc475ff0fcd</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>fix: avoid caching outdated discovery upstream nodes Fix #2369 Fix #1838 Signed-off-by: spacewander &lt;spacewanderlzx@gmail.com&gt;</MESSAGE>
      <SHA>5b0f51e405eb0916d06df2968973607beb0a4403</SHA>
      <PATCHEDFILES>
        <FILE>apisix/balancer.lua</FILE>
        <FILE>apisix/init.lua</FILE>
        <FILE>apisix/upstream.lua</FILE>
        <FILE>apisix/utils/upstream.lua</FILE>
        <FILE>t/node/healthcheck-discovery.t</FILE>
        <FILE>t/node/upstream-discovery.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>fix: avoid caching outdated discovery upstream nodes Fix #2369 Fix #1838 Signed-off-by: spacewander &lt;spacewanderlzx@gmail.com&gt;</MESSAGE>
      <SHA>161df38c4fee2d4d272ee0b6809055eaafcf6d6d</SHA>
      <PATCHEDFILES>
        <FILE>apisix/balancer.lua</FILE>
        <FILE>apisix/http/service.lua</FILE>
        <FILE>apisix/init.lua</FILE>
        <FILE>apisix/plugin.lua</FILE>
        <FILE>apisix/router.lua</FILE>
        <FILE>apisix/upstream.lua</FILE>
        <FILE>apisix/utils/upstream.lua</FILE>
        <FILE>t/node/healthcheck-discovery.t</FILE>
        <FILE>t/node/upstream-discovery.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
