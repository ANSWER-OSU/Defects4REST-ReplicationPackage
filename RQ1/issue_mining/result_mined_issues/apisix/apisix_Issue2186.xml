<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>2186</ISSUENO>
  <ISSUEURL>https://github.com/apache/apisix/issues/2186</ISSUEURL>
  <TITLE>bug: The log keeps printing &quot;wait for more time, context: ngx.timer&quot;</TITLE>
  <DESCRIPTION>### Issue description The http_init method starts a privileged process and the privileged process initializes the routing in the init_worker phase ``` -- radixtree_uri.lua file function _M.init_worker(filter) local err user_routes, err = core.config.new(&quot;/routes&quot;, { automatic = true, item_schema = core.schema.route, filter = filter, }) if not user_routes then error(&quot;failed to create etcd instance for fetching /routes : &quot; .. err) end end ``` When setting `config_center` to `yaml` in `config.yaml`, the created object will add a timer and continuously sync yaml data, but the init_worker method skips the privileged process ``` -- config_yaml.lua function _M.init_worker() if process.type() ~= &quot;worker&quot; and process.type() ~= &quot;single&quot; then return end read_apisix_yaml() ngx.timer.every(1, read_apisix_yaml) end ``` This will cause the sync to fail and keep printing error logs ``` if not apisix_yaml_ctime then log.warn(&quot;wait for more time&quot;) return nil, &quot;failed to read local file &quot; .. apisix_yaml_path end ``` ### Environment * apisix version (cmd: `apisix version`): The latest master code * OS: Mac OS ### Minimal test code / Steps to reproduce the issue 1. set `config_center` to `yaml` ### What's the actual result? (including assertion message &amp; call stack if applicable) The log keeps printing &quot;wait for more time, context: ngx.timer&quot; ### What's the expected result? no error I think the privileged process should skip the init_worker method of some modules</DESCRIPTION>
  <REPONAME>apisix</REPONAME>
  <TIMEDIFFERENCEDAYS>5</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>fix: wait time is too short it will easy fail in some bad hardware environment (#2127)</MESSAGE>
    <SHA>a3f865aa4bb9aa8324ad5025c46360977aed8bec</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>bugfix: load yaml config in privileged agent Fix #2186.</MESSAGE>
      <SHA>4a77257f48c1d10a77545a082c79a803379665fd</SHA>
      <PATCHEDFILES>
        <FILE>apisix/core/config_yaml.lua</FILE>
        <FILE>t/config-center-yaml/route.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
