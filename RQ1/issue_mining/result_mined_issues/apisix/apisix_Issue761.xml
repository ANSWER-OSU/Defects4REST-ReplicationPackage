<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>761</ISSUENO>
  <ISSUEURL>https://github.com/apache/apisix/issues/761</ISSUEURL>
  <TITLE>bug: 三级泛解析路由规则无法匹配</TITLE>
  <DESCRIPTION>### Issue description ### Environment * apisix version (cmd: `apisix version`):master * OS:docker ### Minimal test code / Steps to reproduce the issue ` {&quot;node&quot;:{&quot;nodes&quot;:[ {&quot;value&quot;:{&quot;host&quot;:&quot;lnp-admin.test.com&quot;,&quot;plugins&quot;:{},&quot;uri&quot;:&quot;\/*&quot;,&quot;service_id&quot;:&quot;00000000000000000070&quot;,&quot;desc&quot;:&quot;lap-admin-test&quot;},&quot;createdIndex&quot;:77,&quot;key&quot;:&quot;\/apisix\/routes\/00000000000000000077&quot;,&quot;modifiedIndex&quot;:77}, {&quot;value&quot;:{&quot;host&quot;:&quot;apisix.test.com&quot;,&quot;plugins&quot;:{},&quot;uri&quot;:&quot;\/apisix\/*&quot;,&quot;service_id&quot;:&quot;00000000000000000035&quot;,&quot;desc&quot;:&quot;apisix.zhu&quot;},&quot;createdIndex&quot;:47,&quot;key&quot;:&quot;\/apisix\/routes\/00000000000000000038&quot;,&quot;modifiedIndex&quot;:47}, {&quot;value&quot;:{&quot;host&quot;:&quot;lap.test.com&quot;,&quot;plugins&quot;:{},&quot;uri&quot;:&quot;\/*&quot;,&quot;service_id&quot;:&quot;00000000000000000065&quot;,&quot;desc&quot;:&quot;lap-test&quot;},&quot;createdIndex&quot;:74,&quot;key&quot;:&quot;\/apisix\/routes\/00000000000000000074&quot;,&quot;modifiedIndex&quot;:74}, {&quot;value&quot;:{&quot;host&quot;:&quot;lnp.test.com&quot;,&quot;plugins&quot;:{},&quot;uri&quot;:&quot;\/*&quot;,&quot;service_id&quot;:&quot;00000000000000000066&quot;,&quot;desc&quot;:&quot;lnp-test&quot;},&quot;createdIndex&quot;:75,&quot;key&quot;:&quot;\/apisix\/routes\/00000000000000000075&quot;,&quot;modifiedIndex&quot;:75}, {&quot;value&quot;:{&quot;host&quot;:&quot;lap-admin.test.com&quot;,&quot;plugins&quot;:{},&quot;uri&quot;:&quot;\/*&quot;,&quot;service_id&quot;:&quot;00000000000000000071&quot;,&quot;desc&quot;:&quot;lap-admin-test&quot;},&quot;createdIndex&quot;:76,&quot;key&quot;:&quot;\/apisix\/routes\/00000000000000000076&quot;,&quot;modifiedIndex&quot;:76}, ## 下面2条是可以匹配到的 {&quot;value&quot;:{&quot;host&quot;:&quot;yhs.demo.test.com&quot;,&quot;plugins&quot;:{},&quot;uri&quot;:&quot;\/*&quot;,&quot;service_id&quot;:&quot;00000000000000000065&quot;,&quot;desc&quot;:&quot;yhs-demo-test-com&quot;},&quot;createdIndex&quot;:80,&quot;key&quot;:&quot;\/apisix\/routes\/00000000000000000080&quot;,&quot;modifiedIndex&quot;:80}, {&quot;value&quot;:{&quot;host&quot;:&quot;pma.demo.test.com&quot;,&quot;plugins&quot;:{},&quot;uri&quot;:&quot;\/*&quot;,&quot;service_id&quot;:&quot;00000000000000000066&quot;,&quot;desc&quot;:&quot;pma-demo-test-com&quot;},&quot;createdIndex&quot;:98,&quot;key&quot;:&quot;\/apisix\/routes\/00000000000000000097&quot;,&quot;modifiedIndex&quot;:98}, ## ## 注意这里（匹配不上）:如果试用test2.demo.test.com去访问，匹配不到，直接用cdnserver那条路由了 {&quot;value&quot;:{&quot;host&quot;:&quot;*.demo.test.com&quot;,&quot;plugins&quot;:{},&quot;uri&quot;:&quot;\/*&quot;,&quot;service_id&quot;:&quot;00000000000000000066&quot;,&quot;desc&quot;:&quot;*-demo-test-com&quot;},&quot;createdIndex&quot;:98,&quot;key&quot;:&quot;\/apisix\/routes\/00000000000000000098&quot;,&quot;modifiedIndex&quot;:99}, {&quot;value&quot;:{&quot;host&quot;:&quot;apisix.test.com&quot;,&quot;plugins&quot;:{},&quot;uri&quot;:&quot;\/apisix\/*&quot;,&quot;service_id&quot;:&quot;00000000000000000035&quot;,&quot;desc&quot;:&quot;apisix-fu&quot;},&quot;createdIndex&quot;:48,&quot;key&quot;:&quot;\/apisix\/routes\/00000000000000000046&quot;,&quot;modifiedIndex&quot;:48}, {&quot;value&quot;:{&quot;host&quot;:&quot;portainer.test.com&quot;,&quot;plugins&quot;:{},&quot;uri&quot;:&quot;\/*&quot;,&quot;service_id&quot;:&quot;00000000000000000058&quot;,&quot;desc&quot;:&quot;portainer-test&quot;},&quot;createdIndex&quot;:59,&quot;key&quot;:&quot;\/apisix\/routes\/00000000000000000059&quot;,&quot;modifiedIndex&quot;:59}, ## 上面没又匹配到转到cdnserver## {&quot;value&quot;:{&quot;plugins&quot;:{},&quot;service_id&quot;:&quot;00000000000000000092&quot;,&quot;desc&quot;:&quot;cdnserver&quot;,&quot;uri&quot;:&quot;\/*&quot;},&quot;createdIndex&quot;:93,&quot;key&quot;:&quot;\/apisix\/routes\/00000000000000000067&quot;,&quot;modifiedIndex&quot;:93}] ## ,&quot;modifiedIndex&quot;:10,&quot;createdIndex&quot;:10,&quot;key&quot;:&quot;\/apisix\/routes&quot;,&quot;dir&quot;:true},&quot;action&quot;:&quot;get&quot;} ` ### What's the actual result? (including assertion message &amp; call stack if applicable) ### What's the expected result?</DESCRIPTION>
  <REPONAME>apisix</REPONAME>
  <TIMEDIFFERENCEDAYS>16</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>doc: fix typo in install-dependencies.md (#852)</MESSAGE>
    <SHA>35416e9c0ff2a8f07779517def5cdb45a19c38d6</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>bugfix(radixtree_host_uri): match priority, host &gt; uri. (#817) * bugfix(radixtree_host_uri): match priority, host &gt; uri. Fix #761.</MESSAGE>
      <SHA>77ad66206e0136700350b872f27f096c2d48c47d</SHA>
      <PATCHEDFILES>
        <FILE>Makefile</FILE>
        <FILE>lua/apisix/http/router/radixtree_host_uri.lua</FILE>
        <FILE>lua/apisix/schema_def.lua</FILE>
        <FILE>t/router/radixtree-host-uri2.t</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
