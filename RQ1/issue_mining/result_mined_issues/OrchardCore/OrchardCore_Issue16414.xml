<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>16414</ISSUENO>
  <ISSUEURL>https://github.com/OrchardCMS/OrchardCore/issues/16414</ISSUEURL>
  <TITLE>Failed to read the 'ContentDefinitionRecord' from the distributed cache System.Text.Json.JsonException</TITLE>
  <DESCRIPTION>### Describe the bug When enabling REDIS cache feature. I randomly get the following exception in the logs ``` ERROR|Failed to read the 'ContentDefinitionRecord' from the distributed cache System.Text.Json.JsonException: '0x1F' is an invalid start of a value. Path: $ | LineNumber: 0 | BytePositionInLine: 0. ---&gt; System.Text.Json.JsonReaderException: '0x1F' is an invalid start of a value. LineNumber: 0 | BytePositionInLine: 0. at System.Text.Json.ThrowHelper.ThrowJsonReaderException(Utf8JsonReader&amp; json, ExceptionResource resource, Byte nextByte, ReadOnlySpan`1 bytes) at System.Text.Json.Utf8JsonReader.ConsumeValue(Byte marker) at System.Text.Json.Utf8JsonReader.ReadFirstToken(Byte first) at System.Text.Json.Utf8JsonReader.ReadSingleSegment() at System.Text.Json.Utf8JsonReader.Read() at System.Text.Json.Serialization.JsonConverter`1.ReadCore(Utf8JsonReader&amp; reader, JsonSerializerOptions options, ReadStack&amp; state) --- End of inner exception stack trace --- at System.Text.Json.ThrowHelper.ReThrowWithPath(ReadStack&amp; state, JsonReaderException ex) at System.Text.Json.Serialization.JsonConverter`1.ReadCore(Utf8JsonReader&amp; reader, JsonSerializerOptions options, ReadStack&amp; state) at System.Text.Json.JsonSerializer.ReadFromSpan[TValue](ReadOnlySpan`1 utf8Json, JsonTypeInfo`1 jsonTypeInfo, Nullable`1 actualByteCount) at System.Text.Json.JsonSerializer.ReadFromSpan[TValue](ReadOnlySpan`1 json, JsonTypeInfo`1 jsonTypeInfo) at System.Text.Json.JsonSerializer.Deserialize[TValue](String json, JsonSerializerOptions options) at System.Text.Json.JConvert.DeserializeObject[TValue](String json, JsonSerializerOptions options) at OrchardCore.Documents.DefaultDocumentSerializer.DeserializeAsync[TDocument](Byte[] data) at OrchardCore.Documents.DocumentManager`1.GetFromDistributedCacheAsync() at OrchardCore.Documents.DocumentManager`1.GetInternalAsync(Boolean failover) at OrchardCore.Documents.DocumentManager`1.GetOrCreateImmutableAsync(Func`1 factoryAsync) at System.Text.Json.ThrowHelper.ReThrowWithPath(ReadStack&amp; state, JsonReaderException ex) at System.Text.Json.Serialization.JsonConverter`1.ReadCore(Utf8JsonReader&amp; reader, JsonSerializerOptions options, ReadStack&amp; state) at System.Text.Json.JsonSerializer.ReadFromSpan[TValue](ReadOnlySpan`1 utf8Json, JsonTypeInfo`1 jsonTypeInfo, Nullable`1 actualByteCount) at System.Text.Json.JsonSerializer.ReadFromSpan[TValue](ReadOnlySpan`1 json, JsonTypeInfo`1 jsonTypeInfo) at System.Text.Json.JsonSerializer.Deserialize[TValue](String json, JsonSerializerOptions options) at System.Text.Json.JConvert.DeserializeObject[TValue](String json, JsonSerializerOptions options) at OrchardCore.Documents.DefaultDocumentSerializer.DeserializeAsync[TDocument](Byte[] data) at OrchardCore.Documents.DocumentManager`1.GetFromDistributedCacheAsync() at OrchardCore.Documents.DocumentManager`1.GetInternalAsync(Boolean failover) at OrchardCore.Documents.DocumentManager`1.GetOrCreateImmutableAsync(Func`1 factoryAsync) ``` ### Orchard Core version 2.0.0 ### To Reproduce Steps to reproduce the behavior: 1. Enabled REDIS cache 2. reload couple of pages</DESCRIPTION>
  <REPONAME>OrchardCore</REPONAME>
  <TIMEDIFFERENCEDAYS>1</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>.NET 8.0.7 (#16413)</MESSAGE>
    <SHA>d51f74a26d3464f754aba3010b8cf546a81d34a3</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Deserialize compressed documents correctly Fix #16414 Related Work Items: #16</MESSAGE>
      <SHA>4f5a75123666ff41c8ce2b0773ec27e235b3b2a5</SHA>
      <PATCHEDFILES>
        <FILE>src/OrchardCore/OrchardCore.Infrastructure/Documents/DefaultDocumentSerializer.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
