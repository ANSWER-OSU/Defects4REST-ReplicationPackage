<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>16378</ISSUENO>
  <ISSUEURL>https://github.com/OrchardCMS/OrchardCore/issues/16378</ISSUEURL>
  <TITLE>Rebuilding Lucene Index fails</TITLE>
  <DESCRIPTION>### Describe the bug Rebuilding Lucene Index in one of my tenants fails with the Error `SqlException: Invalid column name 'Target'.` and the Stacktrace shown below. Creating a fresh Lucene Index works on that tenant, rebuilding it fails. On a different tenant rebuilding works fine. But the other tenant is quite young compared to the one that creates the problems. My guess would be a Migration problem of the DataBase, as the problem seem to be the way to access content items: `OrchardCore.ContentManagement.DefaultContentManager.GetAsync(IEnumerable&lt;string&gt; contentItemIds, VersionOptions options)` ### Orchard Core version 2.0.0.-preview-18254 ### To Reproduce Seems to be dependent on the tenant/db, so likely not reproducible. Steps to reproduce the behavior: 1. Go to Admin Backend 3. Ensure these Features are enabled: `Lucene` (`Content Types` `Contents` `Indexing` `Liquid` `Settings`), `Search`, `PDF Media Indexing` (`Media Indexing`) 4. Go to Search-&gt;Indexing-&gt;Lucene Indices 5. Ensure you have a defined Search Index (and some content you can search for) 6. Select your Lucene Index and click &quot;Rebuild&quot; or &quot;Reset&quot; 7. See error 8. All searches on frontend lead to empty result lists now. ### Expected behavior Should Rebuild or Reset the index ### Logs and screenshots ``` SqlException: Invalid column name 'Target'. System.Threading.Tasks.ContinuationResultTaskFromResultTask&lt;TAntecedentResult, TResult&gt;.InnerInvoke() System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, object state) System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, object state) System.Threading.Tasks.Task.ExecuteWithThreadLocal(ref Task currentTaskSlot, Thread threadPoolThread) YesSql.Commands.BatchCommand.ExecuteAsync(DbConnection connection, DbTransaction transaction, ISqlDialect dialect, ILogger logger) YesSql.Session.FlushInternalAsync(bool saving) YesSql.Session.FlushInternalAsync(bool saving) YesSql.Services.DefaultQuery+Query&lt;T&gt;.ListImpl() OrchardCore.ContentManagement.DefaultContentManager.GetAsync(IEnumerable&lt;string&gt; contentItemIds, VersionOptions options) OrchardCore.Search.Lucene.LuceneIndexingService+&lt;&gt;c__DisplayClass10_0+&lt;&lt;ProcessContentItemsAsync&gt;b__0&gt;d.MoveNext() OrchardCore.Environment.Shell.Scope.ShellScope.UsingAsync(Func&lt;ShellScope, Task&gt; execute, bool activateShell) OrchardCore.Environment.Shell.Scope.ShellScope.UsingAsync(Func&lt;ShellScope, Task&gt; execute, bool activateShell) OrchardCore.Environment.Shell.Scope.ShellScope.UsingAsync(Func&lt;ShellScope, Task&gt; execute, bool activateShell) OrchardCore.Environment.Shell.Scope.ShellScope.UsingAsync(Func&lt;ShellScope, Task&gt; execute, bool activateShell) OrchardCore.Environment.Shell.Scope.ShellScope.UsingAsync(Func&lt;ShellScope, Task&gt; execute, bool activateShell) OrchardCore.Search.Lucene.LuceneIndexingService.ProcessContentItemsAsync(string indexName) OrchardCore.Search.Lucene.Controllers.AdminController.Rebuild(string id) lambda_method2041(Closure , object ) Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor+TaskOfActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, object controller, object[] arguments) Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.&lt;InvokeActionMethodAsync&gt;g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask&lt;IActionResult&gt; actionResultValueTask) Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.&lt;InvokeNextActionFilterAsync&gt;g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, object state, bool isCompleted) Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context) Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(ref State next, ref Scope scope, ref object state, ref bool isCompleted) Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.&lt;InvokeInnerFilterAsync&gt;g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, object state, bool isCompleted) Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.&lt;InvokeNextResourceFilter&gt;g__Awaited|25_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, object state, bool isCompleted) Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResourceExecutedContextSealed context) Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Next(ref State next, ref Scope scope, ref object state, ref bool isCompleted) Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.&lt;InvokeFilterPipelineAsync&gt;g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, object state, bool isCompleted) Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.&lt;InvokeAsync&gt;g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope) Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.&lt;InvokeAsync&gt;g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope) OrchardCore.Seo.Services.RobotsMiddleware.Invoke(HttpContext httpContext) SixLabors.ImageSharp.Web.Middleware.ImageSharpMiddleware.Invoke(HttpContext httpContext, bool retry) OrchardCore.Liquid.ScriptsMiddleware.Invoke(HttpContext httpContext) Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context) Microsoft.AspNetCore.Localization.RequestLocalizationMiddleware.Invoke(HttpContext context) Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context) OrchardCore.Diagnostics.DiagnosticsStartupFilter+&lt;&gt;c__DisplayClass3_0+&lt;&lt;Configure&gt;b__1&gt;d.MoveNext() Microsoft.AspNetCore.Diagnostics.StatusCodePagesMiddleware.Invoke(HttpContext context) OrchardCore.ContentPreview.PreviewStartupFilter+&lt;&gt;c+&lt;&lt;Configure&gt;b__0_1&gt;d.MoveNext() OrchardCore.Modules.ModularTenantRouterMiddleware.Invoke(HttpContext httpContext) OrchardCore.Modules.ModularTenantContainerMiddleware+&lt;&gt;c__DisplayClass4_0+&lt;&lt;Invoke&gt;b__0&gt;d.MoveNext() OrchardCore.Environment.Shell.Scope.ShellScope.UsingAsync(Func&lt;ShellScope, Task&gt; execute, bool activateShell) OrchardCore.Environment.Shell.Scope.ShellScope.UsingAsync(Func&lt;ShellScope, Task&gt; execute, bool activateShell) OrchardCore.Environment.Shell.Scope.ShellScope.UsingAsync(Func&lt;ShellScope, Task&gt; execute, bool activateShell) OrchardCore.Environment.Shell.Scope.ShellScope.UsingAsync(Func&lt;ShellScope, Task&gt; execute, bool activateShell) OrchardCore.Environment.Shell.Scope.ShellScope.UsingAsync(Func&lt;ShellScope, Task&gt; execute, bool activateShell) OrchardCore.Modules.ModularTenantContainerMiddleware.Invoke(HttpContext httpContext) Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context) Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context) ```</DESCRIPTION>
  <REPONAME>OrchardCore</REPONAME>
  <TIMEDIFFERENCEDAYS>5</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Adds more features back that were lost due to the removal of Newtonsoft (#16292) --------- Co-authored-by: SÃ©bastien Ros &lt;sebastienros@gmail.com&gt; Co-authored-by: Mike Alhayek &lt;mike@crestapps.com&gt; Co-authored-by: Hisham Bin Ateya &lt;hishamco_2007@yahoo.com&gt;</MESSAGE>
    <SHA>51eb7b8f2481de0b05592b79cc4feb1c390cc0be</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Add Target column to the LinkFieldIndex table Fix #16378</MESSAGE>
      <SHA>0dd3422b478ddf21d539cb051039b8e17395ab66</SHA>
      <PATCHEDFILES>
        <FILE>src/OrchardCore.Modules/OrchardCore.ContentFields/Indexing/SQL/LinkFieldIndexProvider.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.ContentFields/Indexing/SQL/Migrations.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Remove 'Target' from LinkFieldIndex Fix #16378</MESSAGE>
      <SHA>ceb4e38b0a723db9d00f0d0161790b6ef24b9a37</SHA>
      <PATCHEDFILES>
        <FILE>src/OrchardCore.Modules/OrchardCore.ContentFields/Indexing/SQL/LinkFieldIndexProvider.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Remove 'Target' from LinkFieldIndex (#16397) Fix #16378</MESSAGE>
      <SHA>94d7fbfd0e8393baf3019ff836ff93b49624af71</SHA>
      <PATCHEDFILES>
        <FILE>src/OrchardCore.Modules/OrchardCore.ContentFields/Indexing/SQL/LinkFieldIndexProvider.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
