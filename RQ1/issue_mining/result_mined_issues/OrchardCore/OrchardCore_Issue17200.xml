<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>17200</ISSUENO>
  <ISSUEURL>https://github.com/OrchardCMS/OrchardCore/issues/17200</ISSUEURL>
  <TITLE>ReCaptchaSettings.DetectionThreshold is not counted correctly for log in</TITLE>
  <DESCRIPTION>&lt;!-- Please also see the docs on how we manage issues: https://docs.orchardcore.net/en/latest/docs/guides/contributing/managing-issues/. --&gt; &lt;!-- Please replace all placeholders such as this below. --&gt; ### Describe the bug &lt;!-- What is the issue you're seeing? --&gt; My value of ReCaptchaSettings.DetectionThreshold is 5. I expect this to mean I can fail logging in 5 times and then on the 6th attempt I see the ReCaptcha. * In OC 1.8.2 I actually have to fail 6 times before I see the ReCaptcha. * In OC 2.1.2 I have to fail 7 times before I see the ReCaptcha. In OC 2.1.2 it seems like the number of failed attempts went up by 1, but it seems like it was off in 1.8.2 as well. If the 1.8.2 behavior is correct then that's fine with me. But it does seem like it unintentionally changed in 2.1.2, which is my bigger concern. ### Orchard Core version &lt;!-- Add the version of the Orchard Core NuGet packages you use, or the commit hash if you can reproduce this with the source code. --&gt; I noticed this in the process of updating from OC 1.8.2 to 2.1.2. ### To Reproduce &lt;!-- Steps to reproduce the behavior: 1. Go to '...' 2. Click on '...' 3. Scroll down to '...' 4. See error --&gt; 1. Create a new site with the blog recipe. 2. Enable the `OrchardCore.ReCaptcha.Users` feature. 3. Set the site key and secret key for ReCaptcha under Security &gt; Settings &gt; reCaptcha. 4. Log out. 5. Go to /login. 6. Repeatedly log in with dummy credentials. ### Expected behavior &lt;!-- Add a clear and concise description of what you expected to happen. --&gt; The default setting of ReCaptchaSettings.DetectionThreshold is 5 and I'm using the default value. In OC 1.8.2 I fail the log in process 5 times in a row. I would expect to see the ReCaptcha here, but I actually need to fail a 6th time for it to appear. In this gif I click the &quot;log in&quot; button 5 times and fail, but it isn't until I click &quot;log in&quot; a 6th time that the ReCaptcha is displayed. ![1_8_2](https://github.com/user-attachments/assets/8f171f64-5a49-4be0-bf5c-2ea670aa1a4d) In OC 2.1.2 it is similar, except I have to fail 7 times even though my threshold is still set to 5. ![2_1_2](https://github.com/user-attachments/assets/27a97d6b-7c44-4f3c-a383-64af7399daeb)</DESCRIPTION>
  <REPONAME>OrchardCore</REPONAME>
  <TIMEDIFFERENCEDAYS>6</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Fix Layer translations (#17210)</MESSAGE>
    <SHA>d21acb2f024616c084ece928de7acea3f0f9a097</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fix reCaptcha LoginForm Fix #17200</MESSAGE>
      <SHA>b3e29649d816ea52a18fe880832fd3d7bdbb1190</SHA>
      <PATCHEDFILES>
        <FILE>src/OrchardCore.Modules/OrchardCore.ReCaptcha/Drivers/ReCaptchaLoginFormDisplayDriver.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.ReCaptcha/OrchardCore.ReCaptcha.csproj</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.ReCaptcha/Services/ReCaptchaShapeTableProvider.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.ReCaptcha/Startup.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.ReCaptcha/Views/FormReCaptcha.cshtml</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Users/Controllers/AccountController.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.ReCaptcha.Core/ActionFilters/Detection/IPAddressRobotDetector.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
