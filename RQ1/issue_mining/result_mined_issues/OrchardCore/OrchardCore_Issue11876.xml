<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>11876</ISSUENO>
  <ISSUEURL>https://github.com/OrchardCMS/OrchardCore/issues/11876</ISSUEURL>
  <TITLE>Validate database connection before setting up a tenant</TITLE>
  <DESCRIPTION>### Is your feature request related to a problem? Please describe. In some cases, while trying to setup a new tenant on the &quot;Setup&quot; screen, the user is able to provide connection settings if the connection is not per-configured. In other case, the setup could fail and only some of the tables are created on the connection which leads to incomplete setup. If we run into an in-complete setup, the user should be notified that the tables already exists so they can change the connection or manually delete incomplete tables. Not sure if possible, if a setup fail, may be find out the created table and drop them manually? We would have to find a way to track created tables during setup before dropping table otherwise we could unintentionally drop wrong tables. Both cases above will lead to this exception ![image](https://user-images.githubusercontent.com/24724371/174127237-677c5ebb-b110-46de-87d8-0644cd034fa1.png) ### Describe the solution you'd like I think we should validate the database connection before allowing the user to proceed the setup. Bonus, If possible, track a list new tables, and if the setup fail, drop them This issue is related to #1183 and #11863 but targets a different scenarios.</DESCRIPTION>
  <REPONAME>OrchardCore</REPONAME>
  <TIMEDIFFERENCEDAYS>63</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>update comment to restart build</MESSAGE>
    <SHA>d7c812d2a187b6ee716407f9f416dc233204ade6</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Add a fix for #11876 and clean up the code</MESSAGE>
      <SHA>431020333bf364ee832273d5260eb3f47e853ec7</SHA>
      <PATCHEDFILES>
        <FILE>src/OrchardCore.Modules/OrchardCore.Tenants/Services/TenantValidator.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.Data.YesSql.Abstractions/DbConnectionValidatorResult.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.Data.YesSql/DatabaseHelper.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.Data.YesSql/DatabaseProviderName.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.Data.YesSql/DbConnectionValidator.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.Setup.Core/SetupService.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
