<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>9604</ISSUENO>
  <ISSUEURL>https://github.com/OrchardCMS/OrchardCore/issues/9604</ISSUEURL>
  <TITLE>Media library appears empty when using Azure provider and .NET 6 preview 4</TITLE>
  <DESCRIPTION>### Describe the bug When navigating to the media library (using the Azure file storage provider) in the Admin tool, the folder and file list appear empty. Upon further investigation, the files are still in Azure, just not displayed in the UX. ### To Reproduce Steps to reproduce the behavior: 1. Upgrade to .NET 6 preview 4 2. Run project, go to Admin page 3. Click on Media Library in left hand navigation 4. Observe no files or folders are shown ### Expected behavior Existing files and folders should be shown ### Screenshots If applicable, add screenshots to help explain your problem. ![image](https://user-images.githubusercontent.com/1692895/120518754-e5f22480-c39f-11eb-922d-dbc522962070.png) Further investigation in the logs: ``` 2021-06-02 12:07:56.9398|Default|00-521add71d6b10e8fa1df420ac31f8e49-aee88540b26e97b6-00||Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddleware|ERROR|An unhandled exception has occurred while executing the request. **System.ArgumentOutOfRangeException: Not a valid Win32 FileTime.** at System.DateTime.ToFileTimeUtc() in System.Private.CoreLib.dll:token 0x6000ccc+0x45 at System.DateTimeOffset.ToFileTime() in System.Private.CoreLib.dll:token 0x6000d41+0x7 at SixLabors.ImageSharp.Web.Middleware.ImageContext.ComputeLastModified() in SixLabors.ImageSharp.Web.dll:token 0x60000c3+0x60 at SixLabors.ImageSharp.Web.Middleware.ImageContext.ComprehendRequestHeaders(DateTimeOffset lastModified, Int64 length) in SixLabors.ImageSharp.Web.dll:token 0x60000bc+0xe at SixLabors.ImageSharp.Web.Middleware.ImageSharpMiddleware.SendResponseAsync(ImageContext imageContext, String key, ImageCacheMetadata metadata, IImageCacheResolver cacheResolver) in SixLabors.ImageSharp.Web.dll:token 0x60000d1+0x28 at SixLabors.ImageSharp.Web.Middleware.ImageSharpMiddleware.ProcessRequestAsync(HttpContext context, IImageResolver sourceImageResolver, ImageContext imageContext, IDictionary`2 commands) in SixLabors.ImageSharp.Web.dll:token 0x60000ce+0x2fb at SixLabors.ImageSharp.Web.Middleware.ImageSharpMiddleware.Invoke(HttpContext context) in SixLabors.ImageSharp.Web.dll:token 0x60000cd+0x381 at OrchardCore.Media.Services.MediaFileStoreResolverMiddleware.Invoke(HttpContext context) in OrchardCore.Media.dll:token 0x6000106+0x45d at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context) in Microsoft.AspNetCore.Authorization.Policy.dll:token 0x600000b+0x3f1 ```</DESCRIPTION>
  <REPONAME>OrchardCore</REPONAME>
  <TIMEDIFFERENCEDAYS>8</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Code mirror Cdn Integrity (#9613) Fixes #9610</MESSAGE>
    <SHA>a5a401bec4ff9e126f9eff6d084a18a0fee10130</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fix async enumerable issue in media api (#9604) Due to changes in .NET 6 preview 4 for async streams, the `GetFolders` and `GetMediaItems` apis were causing the request to return before the actual calls were made to Azure when using the OrchardCore.FileStorage.AzureBlob.BlobFileStore. Adding an await fixes the issue.</MESSAGE>
      <SHA>25fe8b0eb6f57aa5d0690750a46c091bc0bd1996</SHA>
      <PATCHEDFILES>
        <FILE>src/OrchardCore.Modules/OrchardCore.Media/Controllers/AdminController.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fix async enumerable issue in media api (#9604) Due to changes in .NET 6 preview 4 for async streams, the `GetFolders` and `GetMediaItems` apis were causing the request to return before the actual calls were made to Azure when using the OrchardCore.FileStorage.AzureBlob.BlobFileStore. Adding an await fixes the issue.</MESSAGE>
      <SHA>08036f2b447a1c8942f0191591fed1010245a424</SHA>
      <PATCHEDFILES>
        <FILE>src/OrchardCore.Modules/OrchardCore.Media/Controllers/AdminController.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
