<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>16932</ISSUENO>
  <ISSUEURL>https://github.com/OrchardCMS/OrchardCore/issues/16932</ISSUEURL>
  <TITLE>IUserTimeZoneService no longer caches user requests</TITLE>
  <DESCRIPTION>this pr #16614 has made some changes to how the users time zones are cached which makes the cache useless. this code in `UserTimeZoneSelector` now retrieves the current user on every request, before trying to get a timezone for the user. (or in fact if a timezone calcation is done more than once on a page, which is a common usage, then it queries for the user multiple times) ``` var currentUser = await _userManager.GetUserAsync(_httpContextAccessor.HttpContext.User); ``` the previous arrangement where `UserTimeZoneService` held the cache for the database query to lookup the user (to get their timezone) was a useful cache. Now it's irrelevant, because the componet calling into that cache is doing all the work.</DESCRIPTION>
  <REPONAME>OrchardCore</REPONAME>
  <TIMEDIFFERENCEDAYS>9</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Auto Attach the DashboardPart to content types with DashboardWidget stereotype (#16911) --------- Co-authored-by: Zoltán Lehóczky &lt;zoltan.lehoczky@lombiq.com&gt;</MESSAGE>
    <SHA>8dcefad2138b8d6e8e816966873e7f32d81bae80</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fix the User TimeZoneService #16932</MESSAGE>
      <SHA>7eb5d9849c3ea60ee953f3dd51627b78b8ffd6f7</SHA>
      <PATCHEDFILES>
        <FILE>src/OrchardCore.Modules/OrchardCore.Users/TimeZone/Drivers/UserTimeZoneDisplayDriver.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Users/TimeZone/Services/IUserTimeZoneService.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Users/TimeZone/Services/UserTimeZoneSelector.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Users/TimeZone/Services/UserTimeZoneService.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
