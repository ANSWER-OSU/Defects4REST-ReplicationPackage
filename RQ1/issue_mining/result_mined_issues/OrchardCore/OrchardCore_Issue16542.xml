<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>16542</ISSUENO>
  <ISSUEURL>https://github.com/OrchardCMS/OrchardCore/issues/16542</ISSUEURL>
  <TITLE>CreateContentTask evaluation will not remove illegal characters</TITLE>
  <DESCRIPTION>While upgrading to 2.0 i had a workflow with a CreateContentTask activity to create a specific content type with following liquid expression : ``` {% capture full_name %} {{Workflow.Input.User.Properties.UserProfileSettings.UserProfileSettings.FirstName.Text}} {{Workflow.Input.User.Properties.UserProfileSettings.UserProfileSettings.LastName.Text}} {% endcapture %} { &quot;DisplayText&quot;: &quot;{{full_name}}&quot;, &quot;Owner&quot;:&quot;{{Workflow.Input.User.UserId}}&quot;, &quot;Author&quot;: &quot;{{Workflow.Input.User.UserName}}&quot;, } ``` when ContentProperties is evaluated from : ``` var contentProperties = await _expressionEvaluator.EvaluateAsync(ContentProperties, workflowContext, _javaScriptEncoder); ``` the json to be merged is returned like this (with carriage return inside the json) : ``` { &quot;DisplayText&quot;: &quot; qqqqqqqqfname qqqqqqqqlname &quot;, } ``` this results in the following error when merging with content item : ``` System.Text.Json.JsonReaderException: '0x0D' (CARRIAGE RETURN) is invalid within a JSON string. The string should be correctly escaped. ``` This was handeled automatically before 2.0 . Is there a way to remove automatically invalid json characters like previous ?</DESCRIPTION>
  <REPONAME>OrchardCore</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Add Sortable dependency to script using Sortable (#16531) --------- Co-authored-by: Zoltán Lehóczky &lt;zoltan.lehoczky@lombiq.com&gt;</MESSAGE>
    <SHA>ecfd6655310b1f124f568f1a81de3b311ce5ab78</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fix training comma issue Fix #16542</MESSAGE>
      <SHA>c281e99c5dd9200bce00db5f005f43631b757018</SHA>
      <PATCHEDFILES>
        <FILE>src/OrchardCore.Modules/OrchardCore.ContentFields/Settings/HtmlFieldMonacoEditorSettingsDriver.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Contents/Workflows/Activities/CreateContentTask.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Deployment/Steps/JsonRecipeDeploymentSource.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Deployment/Steps/JsonRecipeDeploymentStepDriver.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Html/Settings/HtmlBodyPartMonacoEditorSettingsDriver.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Search.Elasticsearch/GraphQL/ElasticQueryFieldTypeProvider.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Search.Lucene/GraphQL/LuceneQueryFieldTypeProvider.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Search.Lucene/Services/LuceneIndexingState.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
