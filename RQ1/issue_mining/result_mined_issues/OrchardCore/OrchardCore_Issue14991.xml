<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>14991</ISSUENO>
  <ISSUEURL>https://github.com/OrchardCMS/OrchardCore/issues/14991</ISSUEURL>
  <TITLE>ArgumentNullException from ResourceManager.FindMatchingResource when multiple resources are defined with the same name and at least one doesn't specify a version.</TITLE>
  <DESCRIPTION>### Describe the bug I have 2 scripts defined. A &quot;default&quot; version that doesn't specify a version. In another module, I define an override of that resource by defining a resource with the same name and specifying a version number. When I run the site, the script resources fail to load due to an ArgumentNullException. The issue lies in [ResourceManager.FindMatchingResource](https://github.com/OrchardCMS/OrchardCore/blob/87f7a4314e01315070f3e58fff286ebe2200e9df/src/OrchardCore/OrchardCore.ResourceManagement/ResourceManager.cs#L211), because when evaluating the second match, `resource.Version` is null, which causes `new Version(resource.Version)` to throw the ArgumentNullException. Note that [earlier in the method](https://github.com/OrchardCMS/OrchardCore/blob/87f7a4314e01315070f3e58fff286ebe2200e9df/src/OrchardCore/OrchardCore.ResourceManagement/ResourceManager.cs#L197), the code takes care to avoid the ArgumentNullException by checking for null. A work around for this issue is to just make sure that all resources specify a version, but since the version is not required by the API, it should handle null gracefully. ### To Reproduce Steps to reproduce the behavior: 1. In an `IConfigureOptions&lt;ResourceManagementOptions&gt;`, register a new resource. For example, a script called &quot;MyScript&quot;. Don't specify a version. 2. Additionally, register a second resource with the same name and this time also call `SetVersion` with a valid version number. For example, &quot;MyScript&quot; with a version of &quot;1.0.0&quot;. 3. Require the resource. For example, in `Layout.cshtml`, use the script tag helper to require &quot;MyScript&quot; and don't specify a version. 4. Run the site and notice that the script doesn't load (in fact, no scripts load). Also notice that you receive the following error in the log: ``` 2024-01-04T14:01:25.6549337-05:00|Local|0HN0DATOGCGSU:00000007|OrchardCore.ResourceManagement.TagHelpers.ResourcesTagHelper|ERR|An error occurred while rendering &quot;HeadScript&quot; resource. System.ArgumentNullException: Value cannot be null. (Parameter 'input') at System.ArgumentNullException.Throw(String paramName) at System.Version.Parse(String input) at System.Version..ctor(String version) at OrchardCore.ResourceManagement.ResourceManager.FindMatchingResource(IEnumerable`1 stream, RequireSettings settings, String name) at OrchardCore.ResourceManagement.ResourceManager.FindResource(RequireSettings settings, Boolean resolveInlineDefinitions) at OrchardCore.ResourceManagement.ResourceManager.FindResource(RequireSettings settings) at OrchardCore.ResourceManagement.ResourceManager.DoGetRequiredResources(String resourceType) at OrchardCore.ResourceManagement.ResourceManager.RenderHeadScript(TextWriter writer) at OrchardCore.ResourceManagement.TagHelpers.ResourcesTagHelper.Process(TagHelperContext tagHelperContext, TagHelperOutput output) 2024-01-04T14:01:25.7205291-05:00|Local|0HN0DATOGCGSU:00000007|OrchardCore.ResourceManagement.TagHelpers.ResourcesTagHelper|ERR|An error occurred while rendering &quot;FootScript&quot; resource. System.ArgumentNullException: Value cannot be null. (Parameter 'input') at System.ArgumentNullException.Throw(String paramName) at System.Version.Parse(String input) at System.Version..ctor(String version) at OrchardCore.ResourceManagement.ResourceManager.FindMatchingResource(IEnumerable`1 stream, RequireSettings settings, String name) at OrchardCore.ResourceManagement.ResourceManager.FindResource(RequireSettings settings, Boolean resolveInlineDefinitions) at OrchardCore.ResourceManagement.ResourceManager.FindResource(RequireSettings settings) at OrchardCore.ResourceManagement.ResourceManager.DoGetRequiredResources(String resourceType) at OrchardCore.ResourceManagement.ResourceManager.RenderFootScript(TextWriter writer) ``` ### Expected behavior I would expect version 1.0.0 of the resource to be loaded on the page (winning out over the one without a version, and not throwing an error). ### Screenshots If applicable, add screenshots to help explain your problem.</DESCRIPTION>
  <REPONAME>OrchardCore</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Use PagerAsync and PagerSlimAsync instead of using dynamic New (#14978)</MESSAGE>
    <SHA>87f7a4314e01315070f3e58fff286ebe2200e9df</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Update ResourceManager.cs to better handle resources that don't specify a version fixes #14991</MESSAGE>
      <SHA>b362b77b42f55f635362ed98fe46793769150b3e</SHA>
      <PATCHEDFILES>
        <FILE>src/OrchardCore/OrchardCore.ResourceManagement/ResourceManager.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
