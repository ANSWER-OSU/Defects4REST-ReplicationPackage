<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>14917</ISSUENO>
  <ISSUEURL>https://github.com/OrchardCMS/OrchardCore/issues/14917</ISSUEURL>
  <TITLE>Custom claims lost after during claims principal refresh</TITLE>
  <DESCRIPTION>### Describe the bug We are able to add custom claims by using `IUserClaimsProvider`. However, these claims get lost when the identify is refreshed (after 30 mins) ### To Reproduce Steps to reproduce the behavior: 1. Use `IUserClaimsProvider` to register a custom 2. Login 3. Do not use the site for at least 30 mins (to force identity to refresh) 4. Evaluate the identity again and see if your custom claim exists, ### Expected behavior All claims should be available after the refresh.</DESCRIPTION>
  <REPONAME>OrchardCore</REPONAME>
  <TIMEDIFFERENCEDAYS>1</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Ping Elasticsearch async (#14875)</MESSAGE>
    <SHA>f28560f9d5b941857e858a2183dec6f7fa29a48d</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Maintain claims principal during refresh Fix #14917</MESSAGE>
      <SHA>2a357b6029e8a242b5fb0a86c158c19f1d145204</SHA>
      <PATCHEDFILES>
        <FILE>src/OrchardCore.Modules/OrchardCore.Users/Startup.cs</FILE>
        <FILE>src/OrchardCore/OrchardCore.Users.Core/Services/ConfigureSecurityStampOptions.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
