<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>13854</ISSUENO>
  <ISSUEURL>https://github.com/OrchardCMS/OrchardCore/issues/13854</ISSUEURL>
  <TITLE>ContainedPart is not attached during editing content item</TITLE>
  <DESCRIPTION>### Describe the bug I have content type called `Transaction` and another called `Customer`. A transaction must have a customer either by manually selecting a customer using a content field picker or if the `Transaction` content item has `ContainedPart` which identifies the customer it would belong to. The `Transaction` content type has a part that required the user to select a customer. However, if the new `Transaction` being created contained in a ListPart, then I should not show the customer picker since the container will tell us which customer this transaction should belong to. I can control when not to sure the customer picker using a shape table provider like this ```C# public class CustomerShapeTableProvider : IShapeTableProvider { public void Discover(ShapeTableBuilder builder) { builder.Describe(&quot;ContentPickerField_Edit&quot;) .Placement(context =&gt; { // We should not need to render a customer picker if the content Item is part of a list part. if (context.Differentiator == &quot;RequiredCustomerPart-Customer&quot; &amp;&amp; context.ZoneShape.TryGetProperty(&quot;ContentItem&quot;, out ContentItem contentItem)) { return contentItem.Has&lt;ContainedPart&gt;() &amp;&amp; contentItem.As&lt;ContainedPart&gt;().ListContentType == &quot;Customer&quot;) } return false; }, new PlacementInfo { Location = &quot;-&quot; }); } } ``` The above works after the ContentItem has been saved. However, if the ContentItem is new, the `ContainedPart` does not exists on the ContentItem as expected. The [ContainedPartDisplayDriver ](https://github.com/OrchardCMS/OrchardCore/blob/3e937abcfc761ef06469a43f535a01ec75b7f4ec/src/OrchardCore.Modules/OrchardCore.Lists/Drivers/ContainedPartDisplayDriver.cs#L50) is responsible of attaching `ContainedPart` on the content item when ListPart is used. However, it only attach it on `Update` request not on `Edit`. Since we know the content item is going to have a ListPart, we should attach the `ContainedPart` to the content item if it does not already exists allowing logic is handlers like ShapeTable to work.</DESCRIPTION>
  <REPONAME>OrchardCore</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Include Google Analytics and Tag Manage when user concents. (#13834)</MESSAGE>
    <SHA>3e937abcfc761ef06469a43f535a01ec75b7f4ec</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Attach ContainedPart during creating the Edit shapes. Fix #13854</MESSAGE>
      <SHA>d5420ea7755d5b9fa663b018e065fa670abbe5bd</SHA>
      <PATCHEDFILES>
        <FILE>src/OrchardCore.Modules/OrchardCore.Lists/Drivers/ContainedPartDisplayDriver.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
