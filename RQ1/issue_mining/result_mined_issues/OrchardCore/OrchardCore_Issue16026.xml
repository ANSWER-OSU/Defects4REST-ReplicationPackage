<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>16026</ISSUENO>
  <ISSUEURL>https://github.com/OrchardCMS/OrchardCore/issues/16026</ISSUEURL>
  <TITLE>`OrchardCore.Users` - a service to decide which kind of parameter use to link external login to existing account in the second check</TITLE>
  <DESCRIPTION>### Discussed in https://github.com/OrchardCMS/OrchardCore/discussions/16023 Each module that add an extenal login provider (like GitHub or OpenID) can specify the value of `ClaimTypes.NameIdentifier` to link the external login information to an existing OrchardCore account. But in this line of code, OrchardCore force another check over external login data that could redirect a user to a view that ask about link external login data to an existing account by checking the email value returned by the login provider. https://github.com/OrchardCMS/OrchardCore/blob/649b7404d3b1d387be936d2d77430e387c5aee20/src/OrchardCore.Modules/OrchardCore.Users/Controllers/AccountController.cs#L387-L415 I would like each module that add an external login can manage this behavior by a dedicated service. If a module doesn't implement this service: the actual behavior is applied. Probably could be useful to have a settings to disable this code. I'm not sure if this &quot;second check&quot; over external login data is correct or it's nature: seems a second chance to connect external login data to user account.</DESCRIPTION>
  <REPONAME>OrchardCore</REPONAME>
  <TIMEDIFFERENCEDAYS>42</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Add a way to specify username to send notifications to (#16073) Co-authored-by: Zoltán Lehóczky &lt;zoltan.lehoczky@lombiq.com&gt;</MESSAGE>
    <SHA>0f57494155dfe3d852aafc45e14c513f5536c6de</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>feat(Users): added default services to retrieve user to link to login data feat(Users): changed account controller code to use new services feat(Users): load all services in reversed enum to ret last registered services feat(Users): updated view code resolve #16026</MESSAGE>
      <SHA>aa734f1e10f8a88f42a65d84364e0ddd5710277c</SHA>
      <PATCHEDFILES>
        <FILE>src/OrchardCore.Modules/OrchardCore.Users/Controllers/AccountController.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Users/Services/DefaultExternalLoginUserToRelateFinder.cs</FILE>
        <FILE>src/OrchardCore.Modules/OrchardCore.Users/Views/Account/LinkExternalLogin.cshtml</FILE>
        <FILE>src/OrchardCore/OrchardCore.Users.Abstractions/Services/IExternalLoginUserToRelateFinder.cs</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
