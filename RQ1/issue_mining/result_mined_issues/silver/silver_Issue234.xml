<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>234</ISSUENO>
  <ISSUEURL>https://github.com/silverapp/silver/issues/234</ISSUEURL>
  <TITLE>Bill the value of ended subscriptions only at the new billing cycle</TITLE>
  <DESCRIPTION>If a customer has `consolidated_billing` and a subscription is ended during the month, bill the corresponding value only at the new billing cycle. The exception is when the ended subscription is the last on that the customer has. In this case, the proforma/invoice has to be issued when ending the subscription. When this exception occurs the subscription with the `canceling` state have to be billed too.</DESCRIPTION>
  <REPONAME>silver</REPONAME>
  <TIMEDIFFERENCEDAYS>37</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Add/update tests placeholders for the cancel state + cleanup other command tests</MESSAGE>
    <SHA>445a5d65776202bff46955c1cfce1947b9c4231c</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Merge branch 'master' into enhance-consolidated-billing-fixes-#231-#234</MESSAGE>
      <SHA>154f51a1f2c7794c4c6b839e8dd08e3ee9ca20d6</SHA>
      <PATCHEDFILES>
        <FILE>requirements/common.txt</FILE>
        <FILE>requirements/test.txt</FILE>
        <FILE>silver/models.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Merge pull request #244 from PressLabs/enhance-consolidated-billing-fixes-#231-#234 Enhance consolidated billing -- fixes #231, #234, #247</MESSAGE>
      <SHA>b0cae8b14b65a78ee3f73950e51ac1bcefcb68f1</SHA>
      <PATCHEDFILES>
        <FILE>silver/admin.py</FILE>
        <FILE>silver/api/views.py</FILE>
        <FILE>silver/documents_generator.py</FILE>
        <FILE>silver/models.py</FILE>
        <FILE>silver/templates/admin/issue_all_customer_documents.html</FILE>
        <FILE>silver/tests/commands/test_generate_docs.py</FILE>
        <FILE>silver/tests/unit/test_subscription.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
