<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>26</ISSUENO>
  <ISSUEURL>https://github.com/treasure-data/digdag/issues/26</ISSUEURL>
  <TITLE>org.h2.jdbc.JdbcSQLException: Table &quot;QUEUED_SHARED_TASK_LOCKS&quot; not found</TITLE>
  <DESCRIPTION>I ran into this error when running a workflow as a local mode. ``` 2016-04-01 14:25:30 +0900 [ERROR] (local-agent-0): Uncaught exception org.skife.jdbi.v2.exceptions.UnableToCreateStatementException: org.h2.jdbc.JdbcSQLException: Table &quot;QUEUED_SHARED_TASK_LOCKS&quot; not found; SQL statement: with recursive t (queue_id) as ((select queue_id from queued_shared_task_locks where hold_expire_time is null order by queue_id limit 1) union all select (select queue_id from queued_shared_task_locks where hold_expire_time is null and queue_id &gt; t.queue_id order by queue_id limit 1) from t where t.queue_id is not null) select queue_id as id from t where queue_id is not null [42102-191] [statement:&quot;with recursive t (queue_id) as ((select queue_id from queued_shared_task_locks where hold_expire_time is null order by queue_id limit 1) union all select (select queue_id from queued_shared_task_locks where hold_expire_time is null and queue_id &gt; t.queue_id order by queue_id limit 1) from t where t.queue_id is not null) select queue_id as id from t where queue_id is not null&quot;, located:&quot;with recursive t (queue_id) as ((select queue_id from queued_shared_task_locks where hold_expire_time is null order by queue_id limit 1) union all select (select queue_id from queued_shared_task_locks where hold_expire_time is null and queue_id &gt; t.queue_id order by queue_id limit 1) from t where t.queue_id is not null) select queue_id as id from t where queue_id is not null&quot;, rewritten:&quot;with recursive t (queue_id) as ((select queue_id from queued_shared_task_locks where hold_expire_time is null order by queue_id limit 1) union all select (select queue_id from queued_shared_task_locks where hold_expire_time is null and queue_id &gt; t.queue_id order by queue_id limit 1) from t where t.queue_id is not null) select queue_id as id from t where queue_id is not null&quot;, arguments:{ positional:{}, named:{}, finder:[]}] at org.skife.jdbi.v2.SQLStatement.internalExecute(SQLStatement.java:1306) at org.skife.jdbi.v2.Query.fold(Query.java:173) at org.skife.jdbi.v2.Query.list(Query.java:82) at org.skife.jdbi.v2.Query.list(Query.java:75) at io.digdag.core.database.DatabaseTaskQueueStore.lambda$lockSharedTasks$147(DatabaseTaskQueueStore.java:195) at io.digdag.core.database.BasicDatabaseStoreManager.lambda$transaction$54(BasicDatabaseStoreManager.java:192) at org.skife.jdbi.v2.tweak.transactions.LocalTransactionHandler.inTransaction(LocalTransactionHandler.java:183) at org.skife.jdbi.v2.BasicHandle.inTransaction(BasicHandle.java:330) at io.digdag.core.database.BasicDatabaseStoreManager.transaction(BasicDatabaseStoreManager.java:192) at io.digdag.core.database.DatabaseTaskQueueStore.lockSharedTasks(DatabaseTaskQueueStore.java:176) at io.digdag.core.database.DatabaseTaskQueueFactory$DatabaseTaskQueue.lockSharedTasks(DatabaseTaskQueueFactory.java:87) at io.digdag.core.agent.LocalAgent.run(LocalAgent.java:57) at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) at java.util.concurrent.FutureTask.run(FutureTask.java:266) at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) at java.lang.Thread.run(Thread.java:745) Caused by: org.h2.jdbc.JdbcSQLException: Table &quot;QUEUED_SHARED_TASK_LOCKS&quot; not found; SQL statement: with recursive t (queue_id) as ((select queue_id from queued_shared_task_locks where hold_expire_time is null order by queue_id limit 1) union all select (select queue_id from queued_shared_task_locks where hold_expire_time is null and queue_id &gt; t.queue_id order by queue_id limit 1) from t where t.queue_id is not null) select queue_id as id from t where queue_id is not null [42102-191] at org.h2.message.DbException.getJdbcSQLException(DbException.java:345) at org.h2.message.DbException.get(DbException.java:179) at org.h2.message.DbException.get(DbException.java:155) at org.h2.command.Parser.readTableOrView(Parser.java:5349) at org.h2.command.Parser.readTableFilter(Parser.java:1245) at org.h2.command.Parser.parseSelectSimpleFromPart(Parser.java:1884) at org.h2.command.Parser.parseSelectSimple(Parser.java:2032) at org.h2.command.Parser.parseSelectSub(Parser.java:1878) at org.h2.command.Parser.parseSelectUnion(Parser.java:1699) at org.h2.command.Parser.parseSelectSub(Parser.java:1874) at org.h2.command.Parser.parseSelectUnion(Parser.java:1699) at org.h2.command.Parser.parseSelect(Parser.java:1687) at org.h2.command.Parser.parseWith(Parser.java:4745) at org.h2.command.Parser.parsePrepared(Parser.java:479) at org.h2.command.Parser.parse(Parser.java:315) at org.h2.command.Parser.parse(Parser.java:287) at org.h2.command.Parser.prepareCommand(Parser.java:252) at org.h2.engine.Session.prepareLocal(Session.java:560) at org.h2.engine.Session.prepareCommand(Session.java:501) at org.h2.jdbc.JdbcConnection.prepareCommand(JdbcConnection.java:1188) at org.h2.jdbc.JdbcPreparedStatement.&lt;init&gt;(JdbcPreparedStatement.java:73) at org.h2.jdbc.JdbcConnection.prepareStatement(JdbcConnection.java:276) at com.zaxxer.hikari.pool.ProxyConnection.prepareStatement(ProxyConnection.java:308) at com.zaxxer.hikari.pool.HikariProxyConnection.prepareStatement(HikariProxyConnection.java) at org.skife.jdbi.v2.DefaultStatementBuilder.create(DefaultStatementBuilder.java:54) at org.skife.jdbi.v2.SQLStatement.internalExecute(SQLStatement.java:1302) ... 16 common frames omitted ``` This is the workflow: ``` run: +main +main: +step1: sh&gt;: ./tasks/bin/enc-tool -e development-ec2 -a 1 -c ENCRYPT -t 200 ```</DESCRIPTION>
  <REPONAME>digdag</REPONAME>
  <TIMEDIFFERENCEDAYS>5</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Backport start/end options in schedule (#1750) * Add tests in schedulers (#31) * Add start/end in schedule (#32) Implement start/end in daily&gt;, hourly&gt;, minutes_interval&gt;, monthly&gt; and weekly&gt;.</MESSAGE>
    <SHA>3356327420745234b1a4c7764b01add494155d06</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Merge pull request #26 from treasure-data/WM-1386-add-information-to-server-log WM-1386 Add attempt_id and session_id to server log</MESSAGE>
      <SHA>1e1a41eb6be7a17f4ff5156a6022e2422fafa4f5</SHA>
      <PATCHEDFILES>
        <FILE>digdag-cli/src/main/java/io/digdag/cli/Run.java</FILE>
        <FILE>digdag-core/src/main/java/io/digdag/core/agent/OperatorManager.java</FILE>
        <FILE>digdag-tests/src/test/java/acceptance/LogIT.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
