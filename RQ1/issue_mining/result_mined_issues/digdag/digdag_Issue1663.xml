<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>1663</ISSUENO>
  <ISSUEURL>https://github.com/treasure-data/digdag/issues/1663</ISSUEURL>
  <TITLE>SELinux with docker needs :Z volume mount option</TITLE>
  <DESCRIPTION>When using SELinux with docker, volumes should be mounted with the `:Z` [mount option](https://docs.docker.com/storage/bind-mounts/#configure-the-selinux-label). This is set here: https://github.com/treasure-data/digdag/blob/07c11785b6f5c8c2469a94ec764e1d1a448be667/digdag-standards/src/main/java/io/digdag/standards/command/DockerCommandExecutor.java#L115-L116 When using SELinux, this should be: ```java command.add(&quot;-v&quot;).add(String.format(ENGLISH, &quot;%s:%s:rw,Z&quot;, projectPath, projectPath)); // use projectPath to keep pb.directory() valid ``` Maybe a config option could be introduced: ```yaml _export: docker: image: &quot;python:3.8-slim&quot; pull_always: true selinux: true ```</DESCRIPTION>
  <REPONAME>digdag</REPONAME>
  <TIMEDIFFERENCEDAYS>86</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #1668 from o-mura/o-mura/for-cli-enable-count-lastid add count/last-id option to &quot;digdag workflows&quot; command</MESSAGE>
    <SHA>bd66ae80a4e28d8289a687e43320cfdeb7842b23</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Set selinux label when mounting docker volumes When using selinux, docker volumes need to be mounted with :Z in order to work properly. Bug: https://github.com/treasure-data/digdag/issues/1663</MESSAGE>
      <SHA>126b444ce013b488764905dd878cd35de913c3e6</SHA>
      <PATCHEDFILES>
        <FILE>digdag-standards/src/main/java/io/digdag/standards/command/DockerCommandExecutor.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Set selinux label when mounting docker volumes (#1676) * Set selinux label when mounting docker volumes When using selinux, docker volumes need to be mounted with :Z in order to work properly. Bug: https://github.com/treasure-data/digdag/issues/1663 * Implement a config option, adjust documentation This version implements a `selinux` boolean config option in the docker context to enable or disable SELinux support. Also document new configuration option.</MESSAGE>
      <SHA>011d848689ae3d31a8624d59bc8ece5c38e3ae5e</SHA>
      <PATCHEDFILES>
        <FILE>digdag-docs/src/command_executor.md</FILE>
        <FILE>digdag-standards/src/main/java/io/digdag/standards/command/DockerCommandExecutor.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
