<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>549</ISSUENO>
  <ISSUEURL>https://github.com/harness/harness/issues/549</ISSUEURL>
  <TITLE>Prevent Hanging Builds</TITLE>
  <DESCRIPTION>We need to put code in place to prevent inadvertently hanging a build. There are some things we can't prevent, like someone executing a blocking command. The timeout will handle this. I'm more concerned with background jobs (a web server, selenium server, etc) that might be started and run in the background, or disowned from the parent process. This is a simple test script that will hang even if `exit 0` is reached: ``` sh #!/bin/bash python -m SimpleHTTPServer 8888 &amp; exit 0 ``` This will hang a Drone build as well, until it times out, resulting in a failure status even when the build should be successful. This is something that, unless addressed, is going to frequently trip people up. We could implement a trap that gets included in each generated build script: ``` sh exit_trap() { # TODO kill processes } trap exit_trap SIGINT SIGTERM EXIT ``` And in the trap, we could try to kill and background jobs. It would look something like this: ``` sh for pid in $(jobs -pr); do [ -d /proc/$pid ] &amp;&amp; disown $pid &amp;&amp; kill -9 $pid &amp;&gt; /dev/null; done ``` I've seen examples where the above code isn't adequate. So we could just kill all processes `&gt; 1`. The reason I say `&gt; 1` is because `pid 1` is the build script being executed by Docker. This code could look something like this: ``` sh for pid in $(ps -A --no-headers -o pid); do [ $pid -gt 1 ] &amp;&amp; [ -d /proc/$pid ] &amp;&amp; kill -9 $pid &amp;&gt; /dev/null; done ``` There may be a better, more reliable way to address this issue. Heck, maybe there is a flag I can pass to bash to do this automatically. If so, let me know</DESCRIPTION>
  <REPONAME>harness</REPONAME>
  <TIMEDIFFERENCEDAYS>577</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>fix: [code-886]: fix execution runnning icon (#560)</MESSAGE>
    <SHA>b7a7e7aff5288fe957b96575a5ad5e7618a6a454</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>[UI] Apply latest PR input text box design and full support (#549)</MESSAGE>
      <SHA>858dff1469a18f0cb76577e5eac3710ac1f2ae33</SHA>
      <PATCHEDFILES>
        <FILE>web/src/components/CommentBox/CommentBox.tsx</FILE>
        <FILE>web/src/components/DiffViewer/DiffViewer.tsx</FILE>
        <FILE>web/src/components/DiffViewer/DiffViewerUtils.tsx</FILE>
        <FILE>web/src/components/MarkdownEditorWithPreview/MarkdownEditorWithPreview.module.scss</FILE>
        <FILE>web/src/components/MarkdownEditorWithPreview/MarkdownEditorWithPreview.tsx</FILE>
        <FILE>web/src/pages/Compare/Compare.tsx</FILE>
        <FILE>web/src/pages/PullRequest/Conversation/Conversation.module.scss</FILE>
        <FILE>web/src/pages/PullRequest/Conversation/Conversation.module.scss.d.ts</FILE>
        <FILE>web/src/pages/PullRequest/Conversation/Conversation.tsx</FILE>
        <FILE>web/src/pages/PullRequest/Conversation/DescriptionBox.tsx</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
