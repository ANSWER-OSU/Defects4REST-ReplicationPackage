<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>1091</ISSUENO>
  <ISSUEURL>https://github.com/harness/harness/issues/1091</ISSUEURL>
  <TITLE>Cannot connect to services image</TITLE>
  <DESCRIPTION>Hi, I am writing .drone.yml as: ``` image: &quot;bradrydzewski/ruby:2.0.0&quot; env: - RAILS_ENV=test script: - pwd - whoami - rbenv versions - lsof -P | grep TCP - ps -ef | grep socat - mysql -uroot -h127.0.0.1 -P3306 -e 'show databases' services: - mysql - redis ``` but mysql connection fails. The output of drone console is as follows: ``` $ whoami ubuntu $ rbenv versions * 2.0.0-p353 (set by RBENV_VERSION environment variable) $ lsof -P | grep TCP socat 42 ubuntu 3u IPv4 458517 0t0 TCP *:3306 (LISTEN) socat 43 ubuntu 3u IPv4 458519 0t0 TCP *:6379 (LISTEN) $ ps -ef | grep socat ubuntu 42 40 0 02:36 ? 00:00:00 socat TCP-LISTEN:6379,fork TCP:192.168.5.107:6379 ubuntu 43 39 0 02:36 ? 00:00:00 socat TCP-LISTEN:3306,fork TCP:192.168.5.106:3306 $ mysql -uroot -h127.0.0.1 -P3306 -e 'show databases' 2015/07/10 02:16:39 socat[221] E connect(3, AF=2 192.168.5.106:3306, 16): No route to host ERROR 2013 (HY000): Lost connection to MySQL server at 'reading initial communication packet', system error: 0 ``` Can you tell me how to troubleshoot this? On host OS, iptables -L tell like this: ``` $ iptables -t nat -L -n Chain PREROUTING (policy ACCEPT) target prot opt source destination DOCKER all -- 0.0.0.0/0 0.0.0.0/0 ADDRTYPE match dst-type LOCAL Chain INPUT (policy ACCEPT) target prot opt source destination Chain OUTPUT (policy ACCEPT) target prot opt source destination DOCKER all -- 0.0.0.0/0 !127.0.0.0/8 ADDRTYPE match dst-type LOCAL Chain POSTROUTING (policy ACCEPT) target prot opt source destination MASQUERADE all -- 192.168.5.0/24 0.0.0.0/0 MASQUERADE tcp -- 192.168.5.106 192.168.5.106 tcp dpt:3306 MASQUERADE tcp -- 192.168.5.107 192.168.5.107 tcp dpt:6379 Chain DOCKER (2 references) target prot opt source destination DNAT tcp -- 0.0.0.0/0 127.0.0.1 tcp dpt:32810 to:192.168.5.106:3306 DNAT tcp -- 0.0.0.0/0 127.0.0.1 tcp dpt:32811 to:192.168.5.107:6379 ``` ``` $ ps -ef | grep docker root 13552 14675 0 10:37 ? 00:00:00 docker-proxy -proto tcp -host-ip 127.0.0.1 -host-port 32800 -container-ip 192.168.5.106 -container-port 3306 root 13650 14675 0 10:37 ? 00:00:00 docker-proxy -proto tcp -host-ip 127.0.0.1 -host-port 32801 -container-ip 192.168.5.107 -container-port 6379 ``` The information of host os is as follows: ``` $ cat /etc/redhat-release CentOS Linux release 7.1.1503 (Core) $ uname -a Linux xxxxxx 3.10.0-229.el7.x86_64 #1 SMP Fri Mar 6 11:36:42 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux $ rpm -qa | grep drone drone-0.3.0_alpha-1435875221.x86_64 $ docker --version Docker version 1.7.0, build 0baf609 ``` If you need some more information, please let me know. thanks</DESCRIPTION>
  <REPONAME>harness</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Fix scrolling position when collapsing full diff (#1090)</MESSAGE>
    <SHA>53505ef84931ec9c69c93f410470d1c9ed4254b3</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Remove flicker when Approve button being not rendered on data loading (#1091)</MESSAGE>
      <SHA>49860882d3b7555f2bab1afefb8248a45734bcbb</SHA>
      <PATCHEDFILES>
        <FILE>web/src/components/Changes/ReviewSplitButton/ReviewSplitButton.tsx</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
