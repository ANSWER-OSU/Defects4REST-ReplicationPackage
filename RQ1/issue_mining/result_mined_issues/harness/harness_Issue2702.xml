<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>2702</ISSUENO>
  <ISSUEURL>https://github.com/harness/harness/issues/2702</ISSUEURL>
  <TITLE>non-interactive metrics access</TITLE>
  <DESCRIPTION>I'm playing with autoscaling drone agents. Everything I need is available from the API at `api/system/stats`. The trouble is, in order to access this information, I need to log into drone to collect my oauth token so that I can paste it into a script and make the request. That's a manual step that I want to avoid. I could use the new `DRONE_PROMETHEUS_ANONYMOUS_ACCESS` which also has the info I need, but I'd rather not expose that publicly. Here are some ideas I've had: 1. Use `DRONE_USER_CREATE` to specify the token of a new user so that I know it in advance what the token is. I tried this, but it turns out the token actually does not set the `user_oauth_token` field, but the `user_hash` field instead. Is that intentional? Either way it would be nice to be able to do this somehow. 2. Dig a token directly out of the database. I was thinking of doing this, but it seems if I'm going to go that far, I may as well skip that step and dig the stats I need directly out of the database instead. I can do this but it isn't awesome. 3. Add a new HTTP listener to the drone server which serves some bits of the app (maybe parts of the API) on a separate port without requiring authentication so that I can expose it only privately.</DESCRIPTION>
  <REPONAME>harness</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>fix: [AH-357]: migrations (#2709) * fix: [AH-357]: migrations</MESSAGE>
    <SHA>4482527dbf92edb794cdb2cbe9776786762629dc</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>feat: [CODE-2370]: changes for using PR source branch delete/restore API (#2702) * fixed error for branch not found * swagger.yaml prettier * removed commitSha queryParam and do a getBranch to get the commitSha * fixed lint issue * Merge branch 'main' of https://git0.harness.io/l7B_kbSEQD2wjrM7PShm5w/PROD/Harness_Commons/gitness into CODE-2370-2 * added commit_sha query param to PR delete branch API * fixed linting issues * updated swagger * feat: [CODE-2370]: changes for using PR source branch delete/restore API</MESSAGE>
      <SHA>8bc9714c92d2ff0a17523c9a99b53700b16b288b</SHA>
      <PATCHEDFILES>
        <FILE>app/api/controller/pullreq/delete_branch.go</FILE>
        <FILE>app/api/controller/repo/delete_branch.go</FILE>
        <FILE>app/api/handler/repo/delete_branch.go</FILE>
        <FILE>app/api/openapi/repo.go</FILE>
        <FILE>web/src/components/DiffViewer/DiffViewerUtils.tsx</FILE>
        <FILE>web/src/framework/strings/stringTypes.ts</FILE>
        <FILE>web/src/i18n/strings.en.yaml</FILE>
        <FILE>web/src/pages/PullRequest/Conversation/PullRequestActionsBox/PullRequestActionsBox.tsx</FILE>
        <FILE>web/src/pages/PullRequest/Conversation/PullRequestOverviewPanel/PullRequestOverviewPanel.tsx</FILE>
        <FILE>web/src/pages/PullRequest/Conversation/PullRequestOverviewPanel/sections/BranchActionsSection.tsx</FILE>
        <FILE>web/src/pages/PullRequest/Conversation/SystemComment.tsx</FILE>
        <FILE>web/src/services/code/index.tsx</FILE>
        <FILE>web/src/services/code/swagger.yaml</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
