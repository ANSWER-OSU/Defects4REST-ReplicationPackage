<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>15</ISSUENO>
  <ISSUEURL>https://github.com/harness/harness/issues/15</ISSUEURL>
  <TITLE>Unable to complete registration after invite on clean install</TITLE>
  <DESCRIPTION>Using latest deb-file and sqlite, after a user clicks the activation link and adds their password, the register post-handler fails during saving to db complaining about token not being unique. `2014/02/08 17:24:28 meddler.Insert: DB error in Exec: column token is not unique`</DESCRIPTION>
  <REPONAME>harness</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>fixed issue #4</MESSAGE>
    <SHA>9162070e4dcdc01fbdd9f41fce539231616fe59d</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>fixed issue #15</MESSAGE>
      <SHA>52faded952ec4dfc5b07e785599f72a3a0aec7d6</SHA>
      <PATCHEDFILES>
        <FILE>pkg/handler/app.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Principals, ServiceAccounts, Tokens and auth.Sessions (#15) This change introduces the concept of a principal (abstraction of call identity), and adds a new service account type principal. Also adds support for different tokens (session, PAT, SAT, OAuth2) and adds auth.Session which is being used to capture information about the caller and call method.</MESSAGE>
      <SHA>8c2f900c805019f0b932656aaa290d8031bbb3aa</SHA>
      <PATCHEDFILES>
        <FILE>cli/cli.go</FILE>
        <FILE>cli/file.go</FILE>
        <FILE>cli/operations/account/login.go</FILE>
        <FILE>cli/operations/account/logout.go</FILE>
        <FILE>cli/operations/account/register.go</FILE>
        <FILE>cli/operations/user/user.go</FILE>
        <FILE>cli/operations/users/create.go</FILE>
        <FILE>cli/operations/users/delete.go</FILE>
        <FILE>cli/operations/users/find.go</FILE>
        <FILE>cli/operations/users/list.go</FILE>
        <FILE>cli/operations/users/update.go</FILE>
        <FILE>cli/operations/users/users.go</FILE>
        <FILE>cli/server/wire_gen.go</FILE>
        <FILE>cli/session/session.go</FILE>
        <FILE>cli/swagger.go</FILE>
        <FILE>cli/token/token.go</FILE>
        <FILE>cli/util/util.go</FILE>
        <FILE>client/client.go</FILE>
        <FILE>client/interface.go</FILE>
        <FILE>go.mod</FILE>
        <FILE>go.sum</FILE>
        <FILE>internal/api/guard/guard.go</FILE>
        <FILE>internal/api/guard/guard.repo.go</FILE>
        <FILE>internal/api/guard/guard.serviceAccount.go</FILE>
        <FILE>internal/api/guard/guard.space.go</FILE>
        <FILE>internal/api/handler/account/login.go</FILE>
        <FILE>internal/api/handler/account/register.go</FILE>
        <FILE>internal/api/handler/common/common.go</FILE>
        <FILE>internal/api/handler/common/path.go</FILE>
        <FILE>internal/api/handler/repo/create.go</FILE>
        <FILE>internal/api/handler/repo/createPath.go</FILE>
        <FILE>internal/api/handler/repo/delete.go</FILE>
        <FILE>internal/api/handler/repo/deletePath.go</FILE>
        <FILE>internal/api/handler/repo/find.go</FILE>
        <FILE>internal/api/handler/repo/listPaths.go</FILE>
        <FILE>internal/api/handler/repo/listServiceAccounts.go</FILE>
        <FILE>internal/api/handler/repo/move.go</FILE>
        <FILE>internal/api/handler/repo/update.go</FILE>
        <FILE>internal/api/handler/serviceaccount/create.go</FILE>
        <FILE>internal/api/handler/serviceaccount/createSat.go</FILE>
        <FILE>internal/api/handler/serviceaccount/delete.go</FILE>
        <FILE>internal/api/handler/serviceaccount/deleteSat.go</FILE>
        <FILE>internal/api/handler/serviceaccount/find.go</FILE>
        <FILE>internal/api/handler/serviceaccount/listSats.go</FILE>
        <FILE>internal/api/handler/space/create.go</FILE>
        <FILE>internal/api/handler/space/createPath.go</FILE>
        <FILE>internal/api/handler/space/delete.go</FILE>
        <FILE>internal/api/handler/space/deletePath.go</FILE>
        <FILE>internal/api/handler/space/find.go</FILE>
        <FILE>internal/api/handler/space/listPaths.go</FILE>
        <FILE>internal/api/handler/space/listRepos.go</FILE>
        <FILE>internal/api/handler/space/listServiceAccounts.go</FILE>
        <FILE>internal/api/handler/space/move.go</FILE>
        <FILE>internal/api/handler/space/update.go</FILE>
        <FILE>internal/api/handler/user/createPat.go</FILE>
        <FILE>internal/api/handler/user/deletePat.go</FILE>
        <FILE>internal/api/handler/user/deleteSession.go</FILE>
        <FILE>internal/api/handler/user/find.go</FILE>
        <FILE>internal/api/handler/user/find_test.go</FILE>
        <FILE>internal/api/handler/user/listPats.go</FILE>
        <FILE>internal/api/handler/user/listSessions.go</FILE>
        <FILE>internal/api/handler/user/token_test.go</FILE>
        <FILE>internal/api/handler/user/update.go</FILE>
        <FILE>internal/api/handler/user/update_test.go</FILE>
        <FILE>internal/api/handler/users/create.go</FILE>
        <FILE>internal/api/handler/users/delete.go</FILE>
        <FILE>internal/api/handler/users/find.go</FILE>
        <FILE>internal/api/handler/users/list.go</FILE>
        <FILE>internal/api/handler/users/update.go</FILE>
        <FILE>internal/api/middleware/authn/authn.go</FILE>
        <FILE>internal/api/middleware/resolve/principal.go</FILE>
        <FILE>internal/api/middleware/resolve/repo.go</FILE>
        <FILE>internal/api/middleware/resolve/serviceAccount.go</FILE>
        <FILE>internal/api/middleware/resolve/space.go</FILE>
        <FILE>internal/api/middleware/resolve/user.go</FILE>
        <FILE>internal/api/openapi/account.go</FILE>
        <FILE>internal/api/openapi/user.go</FILE>
        <FILE>internal/api/render/errors.go</FILE>
        <FILE>internal/api/render/render.go</FILE>
        <FILE>internal/api/request/context.go</FILE>
        <FILE>internal/api/request/path.go</FILE>
        <FILE>internal/api/request/principal.go</FILE>
        <FILE>internal/api/request/token.go</FILE>
        <FILE>internal/api/request/util.go</FILE>
        <FILE>internal/auth/authn/authenticator.go</FILE>
        <FILE>internal/auth/authn/harness/harness.go</FILE>
        <FILE>internal/auth/authn/token.go</FILE>
        <FILE>internal/auth/authz/authz.go</FILE>
        <FILE>internal/auth/authz/harness/authorizer.go</FILE>
        <FILE>internal/auth/authz/unsafe.go</FILE>
        <FILE>internal/auth/harness.go/harness.go</FILE>
        <FILE>internal/auth/metadata.go</FILE>
        <FILE>internal/auth/session.go</FILE>
        <FILE>internal/router/api.go</FILE>
        <FILE>internal/router/git.go</FILE>
        <FILE>internal/router/router.go</FILE>
        <FILE>internal/store/database/migrate/postgres/0001_create_table_paths.up.sql</FILE>
        <FILE>internal/store/database/migrate/postgres/0001_create_table_principals.up.sql</FILE>
        <FILE>internal/store/database/migrate/postgres/0001_create_table_repositories.up.sql</FILE>
        <FILE>internal/store/database/migrate/postgres/0001_create_table_spaces.up.sql</FILE>
        <FILE>internal/store/database/migrate/postgres/0001_create_table_tokens.up.sql</FILE>
        <FILE>internal/store/database/migrate/postgres/0001_create_table_users.up.sql</FILE>
        <FILE>internal/store/database/migrate/postgres/0002_create_index_principals_principal_sa_parentType_principal_sa_parentId.up.sql</FILE>
        <FILE>internal/store/database/migrate/postgres/0002_create_index_tokens_principalId.up.sql</FILE>
        <FILE>internal/store/database/migrate/sqlite/0001_create_table_paths.up.sql</FILE>
        <FILE>internal/store/database/migrate/sqlite/0001_create_table_principals.up.sql</FILE>
        <FILE>internal/store/database/migrate/sqlite/0001_create_table_repositories.up.sql</FILE>
        <FILE>internal/store/database/migrate/sqlite/0001_create_table_spaces.up.sql</FILE>
        <FILE>internal/store/database/migrate/sqlite/0001_create_table_tokens.up.sql</FILE>
        <FILE>internal/store/database/migrate/sqlite/0001_create_table_users.up.sql</FILE>
        <FILE>internal/store/database/migrate/sqlite/0002_create_index_principals_principal_sa_parentType_principal_sa_parentId.up.sql</FILE>
        <FILE>internal/store/database/migrate/sqlite/0002_create_index_tokens_principalId.up.sql</FILE>
        <FILE>internal/store/database/path.go</FILE>
        <FILE>internal/store/database/repo.go</FILE>
        <FILE>internal/store/database/repo_sync.go</FILE>
        <FILE>internal/store/database/serviceAccount.go</FILE>
        <FILE>internal/store/database/serviceAccount_sync.go</FILE>
        <FILE>internal/store/database/space.go</FILE>
        <FILE>internal/store/database/space_sync.go</FILE>
        <FILE>internal/store/database/store_test.go</FILE>
        <FILE>internal/store/database/testdata/repos.json</FILE>
        <FILE>internal/store/database/testdata/spaces.json</FILE>
        <FILE>internal/store/database/token.go</FILE>
        <FILE>internal/store/database/token_sync.go</FILE>
        <FILE>internal/store/database/user.go</FILE>
        <FILE>internal/store/database/user_test.go</FILE>
        <FILE>internal/store/database/wire.go</FILE>
        <FILE>internal/store/store.go</FILE>
        <FILE>internal/token/jwt.go</FILE>
        <FILE>internal/token/token.go</FILE>
        <FILE>internal/token/token_test.go</FILE>
        <FILE>mocks/mock_client.go</FILE>
        <FILE>types/check/common.go</FILE>
        <FILE>types/check/path.go</FILE>
        <FILE>types/check/repo.go</FILE>
        <FILE>types/check/serviceAccount.go</FILE>
        <FILE>types/check/space.go</FILE>
        <FILE>types/check/user.go</FILE>
        <FILE>types/enum/authz.go</FILE>
        <FILE>types/enum/path.go</FILE>
        <FILE>types/enum/principal.go</FILE>
        <FILE>types/enum/repo.go</FILE>
        <FILE>types/enum/resource.go</FILE>
        <FILE>types/enum/space.go</FILE>
        <FILE>types/enum/token.go</FILE>
        <FILE>types/principal.go</FILE>
        <FILE>types/repo.go</FILE>
        <FILE>types/service.go</FILE>
        <FILE>types/serviceAccount.go</FILE>
        <FILE>types/space.go</FILE>
        <FILE>types/token.go</FILE>
        <FILE>types/types.go</FILE>
        <FILE>types/user.go</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Merge branch 'gitblame' of _OKE5H2PQKOUfzFFDuD4FA/default/CODE/gitness (#15)</MESSAGE>
      <SHA>c2975da1e68b0961e34b7928ef3940c39e798177</SHA>
      <PATCHEDFILES>
        <FILE>web/package.json</FILE>
        <FILE>web/src/App.module.scss</FILE>
        <FILE>web/src/App.module.scss.d.ts</FILE>
        <FILE>web/src/App.scss</FILE>
        <FILE>web/src/App.tsx</FILE>
        <FILE>web/src/components/MarkdownEditorWithPreview/MarkdownEditorWithPreview.module.scss</FILE>
        <FILE>web/src/framework/strings/stringTypes.ts</FILE>
        <FILE>web/src/i18n/strings.en.yaml</FILE>
        <FILE>web/src/pages/PullRequest/Conversation/Conversation.module.scss</FILE>
        <FILE>web/src/pages/PullRequest/Conversation/PullRequestSideBar/PullRequestSideBar.tsx</FILE>
        <FILE>web/src/pages/Repository/RepositoryContent/FileContent/FileContent.tsx</FILE>
        <FILE>web/src/pages/Repository/RepositoryContent/FileContent/GitBlame.module.scss</FILE>
        <FILE>web/src/pages/Repository/RepositoryContent/FileContent/GitBlame.module.scss.d.ts</FILE>
        <FILE>web/src/pages/Repository/RepositoryContent/FileContent/GitBlame.tsx</FILE>
        <FILE>web/src/pages/Repository/RepositoryContent/FileContent/lineWidget.ts</FILE>
        <FILE>web/src/services/code/index.tsx</FILE>
        <FILE>web/src/services/code/swagger.yaml</FILE>
        <FILE>web/src/utils/types.ts</FILE>
        <FILE>web/src/utils/utils.scss</FILE>
        <FILE>web/yarn.lock</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
