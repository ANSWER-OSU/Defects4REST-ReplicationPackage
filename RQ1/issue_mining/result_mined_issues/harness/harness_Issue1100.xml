<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>1100</ISSUENO>
  <ISSUEURL>https://github.com/harness/harness/issues/1100</ISSUEURL>
  <TITLE>Github Authentication Issue (build 0.4.0)</TITLE>
  <DESCRIPTION>I have been having trouble getting github authentication working in the latest 0.4.0 build. Realizing this is under heavy development, I thought I'd share my results in the event its an actual bug, but it could simply be a configuration issue :) My TOML config looks like this ``` [server] addr = &quot;:80&quot; [database] driver=&quot;sqlite3&quot; datasource=&quot;/var/lib/drone/drone.sqlite&quot; [docker] addr = &quot;unix:///var/run/docker.sock&quot; swarm = false [remote] kind=&quot;github&quot; base=&quot;https://github.com&quot; orgs=[&quot;my_org&quot;] open=true [auth] client=&quot;xxx&quot; secret=&quot;xxxxx&quot; authorize=&quot;https://github.com/login/oauth/authorize&quot; access_token=&quot;https://github.com/login/oauth/access_token&quot; ``` I have set up the GH Application with the following.. ``` homepage url: http://x.x.x.x auth callback url: http://x.x.x.x/api/auth/github.com ``` With this configuration, I receive a URI mismatch error ``` http://x.x.x.x/login?error=redirect_uri_mismatch&amp;error_description=The%20redirect_uri%20MUST%20match%20the%20registered%20callback%20URL%20for%20this%20application.&amp;error_uri=https:%2F%2Fdeveloper.github.com%2Fv3%2Foauth%2F%23redirect-uri-mismatch&amp;state=random ``` If i modify the &quot;auth callback url&quot; to match the &quot;homepage url&quot;, I am redirected from Drone -&gt; GH login, at which point I am able to authorize the application. I am then redirected back to Drone, where I receive an error &quot;There was an error authorizing your account&quot; ``` http://x.x.x.x/login#error=user_not_found ``` Running this all in debug mode, I have the following in my log ``` [GIN] 2015/07/17 - 10:22:33 | 200 | 172.985µs | x.x.x.x:52191 | GET / [GIN] 2015/07/17 - 10:22:33 | 401 | 76.747µs | x.x.x.x:52202 | GET /api/user [GIN] 2015/07/17 - 10:22:33 | 401 | 41.783µs | x.x.x.x:52203 | GET /api/user [GIN] 2015/07/17 - 10:22:33 | 401 | 22.659µs | x.x.x.x:52202 | GET /api/user/repos [GIN] 2015/07/17 - 10:22:34 | 303 | 515.537µs | x.x.x.x:52204 | GET /authorize ERRO[0074] cannot get user with access_token. GET https://api.github.com/user/emails: 404 Not Found [] [GIN] 2015/07/17 - 10:22:46 | 303 | 293.630906ms | x.x.x.x:52204 | GET /authorize [GIN] 2015/07/17 - 10:22:47 | 200 | 90.46µs | x.x.x.x:52204 | GET /login [GIN] 2015/07/17 - 10:23:23 | 303 | 108.303µs | x.x.x.x:52164 | GET /authorize ERRO[0111] cannot get user with access_token. GET https://api.github.com/user/emails: 404 Not Found [] [GIN] 2015/07/17 - 10:23:23 | 303 | 176.590794ms | x.x.x.x:52164 | GET /authorize [GIN] 2015/07/17 - 10:23:23 | 200 | 59.108µs | x.x.x.x:52164 | GET /login ``` If you need any more information, please let me know! I appreciate any help you have to offer</DESCRIPTION>
  <REPONAME>harness</REPONAME>
  <TIMEDIFFERENCEDAYS>1</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>fix: [code-1543]: fix issue on dry merge on merged pr (#1099)</MESSAGE>
    <SHA>a135dec3116b46638911ff6619babf66e25e1ab7</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Implement Copy link to PR comment (#1100)</MESSAGE>
      <SHA>892977c78f759fbe96da8fca13e8b225acb16c90</SHA>
      <PATCHEDFILES>
        <FILE>web/src/components/CommentBox/CommentBox.module.scss</FILE>
        <FILE>web/src/components/CommentBox/CommentBox.module.scss.d.ts</FILE>
        <FILE>web/src/components/CommentBox/CommentBox.tsx</FILE>
        <FILE>web/src/components/DiffViewer/usePullReqComments.tsx</FILE>
        <FILE>web/src/framework/strings/stringTypes.ts</FILE>
        <FILE>web/src/i18n/strings.en.yaml</FILE>
        <FILE>web/src/pages/PullRequest/Conversation/Conversation.tsx</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
