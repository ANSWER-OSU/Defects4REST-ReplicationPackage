<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>262</ISSUENO>
  <ISSUEURL>https://github.com/strapdata/elassandra/issues/262</ISSUEURL>
  <TITLE>Log corruption edge case when TOKENS= epState is printed to console</TITLE>
  <DESCRIPTION>**Elassandra version**: 6.2.3.10 (docker) **Plugins installed**: [] **JVM version** (`java -version`): OpenJDK Runtime Environment (build 1.8.0_181-8u181-b13-2~deb9u1-b13) **OS version** (`uname -a` if on a Unix-like system): Kubernetes, I don't think it matters though. **Description of the problem including expected versus actual behavior**: There's an edge case where the altcharset gets toggled in the logs. When variable `epState` is printed to stdout, it's possible that `TOKENS=` contains data that will render the remaining logs in the terminal's alternate charset. `./server/src/main/java/org/elassandra/discovery/CassandraDiscovery.java`, function `onDead()`: **Steps to reproduce**: 1. Start StatefulSet with strapdata/kubernetes-elassandra. 2. Abnormal output: 2019-02-05 18:57:16,395 INFO [GossipStage:1] org.apache.cassandra.gms.Gossiper.markDead(Gossiper.java:1034) InetAddress /10.20.4.14 is now DOWN 2019-02-05 18:57:16,398 DEBUG [GossipStage:1] org.elassandra.discovery.CassandraDiscovery.onDead(CassandraDiscovery.java:643) Endpoint=/10.20.4.14 ApplicationState=EndpointState: HeartBeatState = HeartBeat: generation = 1549393035, version = 2147483647, AppStateMap = {STATUS=Value(shutdown,true,423), SCHEMA=Value(347c7dcb-ff5e-3f1f-b8a8-ab52c6e23b63,12), DC=Value(DC1,8), RACK=Value(r1,10), RELEASE_VERSION=Value(3.11.3,4), INTERNAL_IP=Value(10.20.4.14,6), RPC_ADDRESS=Value(10.20.4.14,3), NET_VERSION=Value(11,1), HOST_ID=Value(47efcc56-1fd9-4fca-8547-cdde17e13f33,2), TOKENS=ValueÖ^zþ Ò¸å©wOxÒªPU×B §¶×1┘Ã·!= ;£┐MQ»_è←15)← RPC_READY=V▒┌┤e(°▒┌⎽e←424)£ ☃⎽A┌☃┴e=°▒┌⎽e =&gt; ┤⎻d▒├e ┼⎺de → d☃⎽c⎺┼┼ec├☃┼± 3. Normal output: 2019-02-05 18:55:07,371 INFO [STREAM-IN-/10.20.4.14:47834] org.apache.cassandra.streaming.StreamResultFuture.maybeComplete(StreamResultFuture.java:219) [Stream #8dc5d370-2977-11e9-8d6d-07bf72afb10a] All sessions completed 2019-02-05 18:55:07,646 INFO [GossipStage:1] org.apache.cassandra.gms.Gossiper.markDead(Gossiper.java:1034) InetAddress /10.20.4.14 is now DOWN 2019-02-05 18:55:07,647 DEBUG [GossipStage:1] org.elassandra.discovery.CassandraDiscovery.onDead(CassandraDiscovery.java:643) Endpoint=/10.20.4.14 ApplicationState=EndpointState: HeartBeatState = HeartBeat: generation = 1549392868, version = 2147483647, AppStateMap = {STATUS=Value(shutdown,true,192), LOAD=Value(30768.0,16), SCHEMA=Value(347c7dcb-ff5e-3f1f-b8a8-ab52c6e23b63,32), DC=Value(DC1,8), RACK=Value(r1,10), RELEASE_VERSION=Value(3.11.3,4), INTERNAL_IP=Value(10.20.4.14,6), RPC_ADDRESS=Value(10.20.4.14,3), NET_VERSION=Value(11,1), HOST_ID=Value(47efcc56-1fd9-4fca-8547-cdde17e13f33,2), TOKENS=Value!= ;}kÖ^zþ Ò1┘Ã·MQ»_ªPUndraDiscovery.java:854) Add node host_id=47efcc56-1fd9-4fca-8547-cdde17e13f33 endpoint=10.20.4.14 internal_ip=10.20.4.14, rpc_address=10.20.4.14, status=DISABLED Sorry about lack of code block formatting, Github Markdown was frustrating.</DESCRIPTION>
  <REPONAME>elassandra</REPONAME>
  <TIMEDIFFERENCEDAYS>7</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>do not publish javadoc</MESSAGE>
    <SHA>7953491d81e269cd0dc73f19195d01ccb6293bc2</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fix log corruption with TOKENS #262</MESSAGE>
      <SHA>ed82511b44994a4d3f3edb262abd53654614acd3</SHA>
      <PATCHEDFILES>
        <FILE>server/src/main/java/org/elassandra/discovery/CassandraDiscovery.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
