<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>315</ISSUENO>
  <ISSUEURL>https://github.com/strapdata/elassandra/issues/315</ISSUEURL>
  <TITLE>Nested objects' fields not indexed</TITLE>
  <DESCRIPTION>Hello, I have tried to use Elassandra 6.2.3 and 6.8.4 (on Docker Hub) and a critical issue came out: The steps I made: 1. Created a new index 2. Indexed a document with a field containing a nested object (everything OK for now) Request `{ &quot;fieldA&quot;: &quot;A&quot;, &quot;fieldB&quot;: &quot;B&quot;, &quot;nested&quot;: { &quot;fieldC&quot;: &quot;C&quot;, &quot;fieldD&quot;: &quot;D&quot;, &quot;fieldE&quot;: &quot;E&quot;, &quot;fieldF&quot;: &quot;F&quot; } }` 3. Indexed a second document with this same field containing, in the nested object, some different fields from the first document -&gt; the result is that only a random field is saved, even if under **/_mapping** URL all the fields are displayed correctly. Request `{ &quot;fieldA&quot;: &quot;A&quot;, &quot;fieldB&quot;: &quot;B&quot;, &quot;nested&quot;: { &quot;fieldG&quot;: &quot;G&quot;, &quot;fieldH&quot;: &quot;H&quot;, &quot;fieldI&quot;: &quot;I&quot;, &quot;fieldJ&quot;: &quot;J&quot; } }` GET output: `{ &quot;took&quot;: 11, &quot;timed_out&quot;: false, &quot;_shards&quot;: { &quot;total&quot;: 1, &quot;successful&quot;: 1, &quot;skipped&quot;: 0, &quot;failed&quot;: 0 }, &quot;hits&quot;: { &quot;total&quot;: 2, &quot;max_score&quot;: 1.0, &quot;hits&quot;: [ { &quot;_index&quot;: &quot;test-issue-index&quot;, &quot;_type&quot;: &quot;test-issue&quot;, &quot;_id&quot;: &quot;B0rWGG8Bx4Fl4m8pOw3Q&quot;, &quot;_score&quot;: 1.0, &quot;_source&quot;: { &quot;fieldA&quot;: &quot;A&quot;, &quot;fieldB&quot;: &quot;B&quot;, &quot;nested&quot;: { &quot;fieldF&quot;: &quot;F&quot;, &quot;fieldC&quot;: &quot;C&quot;, &quot;fieldE&quot;: &quot;E&quot;, &quot;fieldD&quot;: &quot;D&quot; } } }, { &quot;_index&quot;: &quot;test-issue-index&quot;, &quot;_type&quot;: &quot;test-issue&quot;, &quot;_id&quot;: &quot;CErWGG8Bx4Fl4m8p0A26&quot;, &quot;_score&quot;: 1.0, &quot;_source&quot;: { &quot;fieldA&quot;: &quot;A&quot;, &quot;fieldB&quot;: &quot;B&quot;, &quot;nested&quot;: { &quot;fieldJ&quot;: &quot;J&quot; } } } ] } }` Here the /_mapping endpoint request, just to show to you that every field in the nested object is correctly mapped into the index. `{ &quot;test-issue-index&quot;: { &quot;mappings&quot;: { &quot;test-issue&quot;: { &quot;properties&quot;: { &quot;fieldA&quot;: { &quot;type&quot;: &quot;text&quot;, &quot;fields&quot;: { &quot;keyword&quot;: { &quot;type&quot;: &quot;keyword&quot;, &quot;ignore_above&quot;: 256 } } }, &quot;fieldB&quot;: { &quot;type&quot;: &quot;text&quot;, &quot;fields&quot;: { &quot;keyword&quot;: { &quot;type&quot;: &quot;keyword&quot;, &quot;ignore_above&quot;: 256 } } }, &quot;nested&quot;: { &quot;properties&quot;: { &quot;fieldC&quot;: { &quot;type&quot;: &quot;text&quot;, &quot;fields&quot;: { &quot;keyword&quot;: { &quot;type&quot;: &quot;keyword&quot;, &quot;ignore_above&quot;: 256 } } }, &quot;fieldD&quot;: { &quot;type&quot;: &quot;text&quot;, &quot;fields&quot;: { &quot;keyword&quot;: { &quot;type&quot;: &quot;keyword&quot;, &quot;ignore_above&quot;: 256 } } }, &quot;fieldE&quot;: { &quot;type&quot;: &quot;text&quot;, &quot;fields&quot;: { &quot;keyword&quot;: { &quot;type&quot;: &quot;keyword&quot;, &quot;ignore_above&quot;: 256 } } }, &quot;fieldF&quot;: { &quot;type&quot;: &quot;text&quot;, &quot;fields&quot;: { &quot;keyword&quot;: { &quot;type&quot;: &quot;keyword&quot;, &quot;ignore_above&quot;: 256 } } }, &quot;fieldG&quot;: { &quot;type&quot;: &quot;text&quot;, &quot;fields&quot;: { &quot;keyword&quot;: { &quot;type&quot;: &quot;keyword&quot;, &quot;ignore_above&quot;: 256 } } }, &quot;fieldH&quot;: { &quot;type&quot;: &quot;text&quot;, &quot;fields&quot;: { &quot;keyword&quot;: { &quot;type&quot;: &quot;keyword&quot;, &quot;ignore_above&quot;: 256 } } }, &quot;fieldI&quot;: { &quot;type&quot;: &quot;text&quot;, &quot;fields&quot;: { &quot;keyword&quot;: { &quot;type&quot;: &quot;keyword&quot;, &quot;ignore_above&quot;: 256 } } }, &quot;fieldJ&quot;: { &quot;type&quot;: &quot;text&quot;, &quot;fields&quot;: { &quot;keyword&quot;: { &quot;type&quot;: &quot;keyword&quot;, &quot;ignore_above&quot;: 256 } } } } } } } } } }` **NOTE: These behaviour is NOT reproduced on ElasticSearch (not Elassandra) 6.2.3 or 6.8.4** Can you help me, please? Thanks and regards. Paolo</DESCRIPTION>
  <REPONAME>elassandra</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>fixup travis.yml</MESSAGE>
    <SHA>a9e8735a5ea4b3d33b8a37f93cc297896bed7ef2</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fix #315 missing subfield when indexing a doc with 2 or more new subfields</MESSAGE>
      <SHA>687466f1d1db07b268030109b53ead2a9a51dca6</SHA>
      <PATCHEDFILES>
        <FILE>server/src/main/java/org/elassandra/cluster/SchemaManager.java</FILE>
        <FILE>server/src/test/java/org/elassandra/CqlTypesTests.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
