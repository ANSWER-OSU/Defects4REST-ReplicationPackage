<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>296</ISSUENO>
  <ISSUEURL>https://github.com/strapdata/elassandra/issues/296</ISSUEURL>
  <TITLE>Setting null_value on an integer field causes an exception</TITLE>
  <DESCRIPTION>Hello, I am seeing an exception when I attempt to create a mapping for a UDT with the following attributes. Removing the `null_value` from the `foo` property fixes the issue, leading me to believe there is some issue with `null_value` and integers. ``` &quot;something&quot;: { &quot;type&quot;: &quot;nested&quot;, &quot;cql_udt_name&quot;: &quot;something_udt&quot;, &quot;cql_collection&quot;: &quot;singleton&quot;, &quot;properties&quot;: { &quot;foo&quot;: { &quot;type&quot;: &quot;integer&quot;, &quot;null_value&quot;: &quot;0&quot;, &quot;cql_collection&quot;: &quot;singleton&quot;, &quot;fields&quot;: { &quot;raw&quot;: { &quot;type&quot;: &quot;integer&quot;, &quot;null_value&quot;: &quot;0&quot; } } }, &quot;bar&quot;: { &quot;type&quot;: &quot;keyword&quot;, &quot;null_value&quot;: &quot;NULL&quot;, &quot;cql_collection&quot;: &quot;singleton&quot;, &quot;normalizer&quot;: &quot;custom_normalizer&quot;, &quot;fields&quot;: { &quot;raw&quot;: { &quot;type&quot;: &quot;keyword&quot;, &quot;null_value&quot;: &quot;NULL&quot; } } }, &quot;baz&quot;: { &quot;type&quot;: &quot;keyword&quot;, &quot;null_value&quot;: &quot;NULL&quot;, &quot;cql_collection&quot;: &quot;singleton&quot;, &quot;normalizer&quot;: &quot;custom_normalizer&quot;, &quot;fields&quot;: { &quot;raw&quot;: { &quot;type&quot;: &quot;keyword&quot;, &quot;null_value&quot;: &quot;NULL&quot; } } }, &quot;value&quot;: { &quot;type&quot;: &quot;float&quot;, &quot;null_value&quot;: &quot;0&quot;, &quot;cql_collection&quot;: &quot;singleton&quot;, &quot;fields&quot;: { &quot;raw&quot;: { &quot;type&quot;: &quot;float&quot;, &quot;null_value&quot;: &quot;0&quot; } } } } }, ``` The exception: ``` java.lang.NullPointerException: null at org.elasticsearch.index.mapper.NumberFieldMapper$NumberType$6.createFields(NumberFieldMapper.java:696) at org.elasticsearch.index.mapper.NumberFieldMapper$NumberType$4.createFields(NumberFieldMapper.java:516) at org.elasticsearch.index.mapper.NumberFieldMapper.createField(NumberFieldMapper.java:1151) at org.elassandra.index.ElasticSecondaryIndex.addField(ElasticSecondaryIndex.java:390) at org.elassandra.index.ElasticSecondaryIndex.addField(ElasticSecondaryIndex.java:485) at org.elassandra.index.ElasticSecondaryIndex$ImmutableMappingInfo$RowcumentIndexer$Rowcument.buildContext(ElasticSecondaryIndex.java:2074) at org.elassandra.index.ElasticSecondaryIndex$ImmutableMappingInfo$WideRowcumentIndexer$WideRowcument.buildContext(ElasticSecondaryIndex.java:1421) at org.elassandra.index.ElasticSecondaryIndex$ImmutableMappingInfo$RowcumentIndexer$Rowcument.index(ElasticSecondaryIndex.java:2160) at org.elassandra.index.ElasticSecondaryIndex$ImmutableMappingInfo$RowcumentIndexer$Rowcument.index(ElasticSecondaryIndex.java:2144) at org.elassandra.index.ElasticSecondaryIndex$ImmutableMappingInfo$WideRowcumentIndexer$WideRowcument.index(ElasticSecondaryIndex.java:1421) at org.elassandra.index.ElasticSecondaryIndex$ImmutableMappingInfo$RowcumentIndexer$Rowcument.write(ElasticSecondaryIndex.java:2127) at org.elassandra.index.ElasticSecondaryIndex$ImmutableMappingInfo$WideRowcumentIndexer$WideRowcument.write(ElasticSecondaryIndex.java:1421) at org.elassandra.index.ElasticSecondaryIndex$ImmutableMappingInfo$WideRowcumentIndexer.readBeforeWrite(ElasticSecondaryIndex.java:1474) at org.elassandra.index.ElasticSecondaryIndex$ImmutableMappingInfo$WideRowcumentIndexer.update(ElasticSecondaryIndex.java:1542) at org.elassandra.index.ElasticSecondaryIndex$ImmutableMappingInfo$RowcumentIndexer.finish(ElasticSecondaryIndex.java:1845) at java.lang.Iterable.forEach(Iterable.java:75) at org.apache.cassandra.index.SecondaryIndexManager.indexPartition(SecondaryIndexManager.java:642) at org.apache.cassandra.index.internal.CollatedViewIndexBuilder.build(CollatedViewIndexBuilder.java:139) at org.apache.cassandra.db.compaction.CompactionManager$14.run(CompactionManager.java:1637) at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) at java.util.concurrent.FutureTask.run(FutureTask.java:266) at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) at org.apache.cassandra.concurrent.NamedThreadFactory.lambda$threadLocalDeallocator$0(NamedThreadFactory.java:81) at java.lang.Thread.run(Thread.java:748) ``` Let me know if you need any information from me. Thanks.</DESCRIPTION>
  <REPONAME>elassandra</REPONAME>
  <TIMEDIFFERENCEDAYS>12</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Fix wrong assertion when deleteing index</MESSAGE>
    <SHA>56c48d20fc480c3e320646973f09a01624ac61ae</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fix #296 null_value on an integer field causes an exception</MESSAGE>
      <SHA>92c8487e745c925441d2ed37f1274d30ff3c2e86</SHA>
      <PATCHEDFILES>
        <FILE>server/src/main/java/org/elasticsearch/index/mapper/NumberFieldMapper.java</FILE>
        <FILE>server/src/test/java/org/elassandra/CqlTypesTests.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
