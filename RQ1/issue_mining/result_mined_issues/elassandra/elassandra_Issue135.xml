<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>135</ISSUENO>
  <ISSUEURL>https://github.com/strapdata/elassandra/issues/135</ISSUEURL>
  <TITLE>Error while writing unindexed boolean</TITLE>
  <DESCRIPTION>&lt;!-- GitHub is reserved for bug reports and feature requests. The best place to ask a general question is at the Elastic Discourse forums at https://discuss.elastic.co. If you are in fact posting a bug report or a feature request, please include one and only one of the below blocks in your new issue. Note that whether you're filing a bug report or a feature request, ensure that your submission is for an [OS that we support](https://www.elastic.co/support/matrix#show_os). Bug reports on an OS that we do not support or feature requests specific to an OS that we do not support will be closed. --&gt; &lt;!-- If you are filing a bug report, please remove the below feature request block and provide responses for all of the below items. --&gt; **Elassandra version**: [ 5.5.0.3, 5.5.0.4, 5.5.0.5 ] **JVM version**: Java HotSpot(TM) 64-Bit Server VM (build 25.151-b12, mixed mode) **OS version**: Linux 4.10.0-38-generic **Description of the problem including expected versus actual behavior**: **Steps to reproduce**: 1. Create an index with a not indexed boolean ``` PUT elassandra { &quot;mappings&quot; : { &quot;fan&quot; : { &quot;dynamic&quot; : &quot;strict&quot;, &quot;properties&quot; : { &quot;name&quot; : { &quot;type&quot; : &quot;text&quot; }, &quot;like_elassandra&quot; : { &quot;index&quot; : false, &quot;type&quot; : &quot;boolean&quot; } } } } } ``` 2. Index a document ``` PUT elassandra/fan/jxerome { &quot;name&quot;: &quot;jxerome&quot;, &quot;like_elassandra&quot; : true } ``` 3. The last query fail with this message: ``` { &quot;error&quot;: { &quot;root_cause&quot;: [ { &quot;type&quot;: &quot;remote_transport_exception&quot;, &quot;reason&quot;: &quot;[127.0.0.1][127.0.0.1:9300][indices:data/write/bulk[s][p]]&quot; } ], &quot;type&quot;: &quot;write_failure_exception&quot;, &quot;reason&quot;: &quot;Operation failed - received 0 responses and 1 failures&quot; }, &quot;status&quot;: 500 } ``` **Provide logs (if relevant)**: ``` 2017-11-09 17:22:35,093 ERROR [MutationStage-1] org.apache.cassandra.service.StorageProxy$8.runMayThrow(StorageProxy.java:1414) Failed to apply mutation locally : {} java.lang.RuntimeException: it doesn't make sense to have a field that is neither indexed nor stored for ks: elassandra, table: fan at org.apache.cassandra.db.ColumnFamilyStore.apply(ColumnFamilyStore.java:1357) at org.apache.cassandra.db.Keyspace.applyInternal(Keyspace.java:623) at org.apache.cassandra.db.Keyspace.apply(Keyspace.java:467) at org.apache.cassandra.db.Mutation.apply(Mutation.java:227) at org.apache.cassandra.db.Mutation.apply(Mutation.java:232) at org.apache.cassandra.db.Mutation.apply(Mutation.java:241) at org.apache.cassandra.service.StorageProxy$8.runMayThrow(StorageProxy.java:1408) at org.apache.cassandra.service.StorageProxy$LocalMutationRunnable.run(StorageProxy.java:2647) at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) at org.apache.cassandra.concurrent.AbstractLocalAwareExecutorService$FutureTask.run(AbstractLocalAwareExecutorService.java:162) at org.apache.cassandra.concurrent.SEPWorker.run(SEPWorker.java:109) at java.lang.Thread.run(Thread.java:748) Caused by: java.lang.IllegalArgumentException: it doesn't make sense to have a field that is neither indexed nor stored at org.apache.lucene.document.Field.&lt;init&gt;(Field.java:249) at org.elasticsearch.index.mapper.BooleanFieldMapper.createField(BooleanFieldMapper.java:277) at org.elassandra.index.ElasticSecondaryIndex$Context.addField(ElasticSecondaryIndex.java:404) at org.elassandra.index.ElasticSecondaryIndex$Context.addField(ElasticSecondaryIndex.java:376) at org.elassandra.index.ElasticSecondaryIndex$ImmutableMappingInfo$RowcumentIndexer$Rowcument.buildContext(ElasticSecondaryIndex.java:1805) at org.elassandra.index.ElasticSecondaryIndex$ImmutableMappingInfo$SkinnyRowcumentIndexer$SkinnyRowcument.buildContext(ElasticSecondaryIndex.java:1435) at org.elassandra.index.ElasticSecondaryIndex$ImmutableMappingInfo$RowcumentIndexer$Rowcument.index(ElasticSecondaryIndex.java:1874) at org.elassandra.index.ElasticSecondaryIndex$ImmutableMappingInfo$RowcumentIndexer$Rowcument.index(ElasticSecondaryIndex.java:1863) at org.elassandra.index.ElasticSecondaryIndex$ImmutableMappingInfo$SkinnyRowcumentIndexer$SkinnyRowcument.index(ElasticSecondaryIndex.java:1435) at org.elassandra.index.ElasticSecondaryIndex$ImmutableMappingInfo$SkinnyRowcumentIndexer.flush(ElasticSecondaryIndex.java:1471) at org.elassandra.index.ElasticSecondaryIndex$ImmutableMappingInfo$RowcumentIndexer.finish(ElasticSecondaryIndex.java:1586) at org.apache.cassandra.index.SecondaryIndexManager$WriteTimeTransaction.commit(SecondaryIndexManager.java:983) at org.apache.cassandra.db.partitions.AtomicBTreePartition.addAllWithSizeDelta(AtomicBTreePartition.java:181) at org.apache.cassandra.db.Memtable.put(Memtable.java:284) at org.apache.cassandra.db.ColumnFamilyStore.apply(ColumnFamilyStore.java:1339) ... 11 common frames omitted ```</DESCRIPTION>
  <REPONAME>elassandra</REPONAME>
  <TIMEDIFFERENCEDAYS>5</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Improve search strategy setting validation</MESSAGE>
    <SHA>a22cc80cb58306a734f3d09328f7a5221b34f1c4</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fix error while writing unindexed boolean #135</MESSAGE>
      <SHA>a65bf4d30588341447c860658ef74abf05c265a6</SHA>
      <PATCHEDFILES>
        <FILE>core/src/main/java/org/elasticsearch/index/mapper/BooleanFieldMapper.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
