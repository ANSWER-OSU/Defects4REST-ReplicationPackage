<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>335</ISSUENO>
  <ISSUEURL>https://github.com/strapdata/elassandra/issues/335</ISSUEURL>
  <TITLE>performance and consistency issues</TITLE>
  <DESCRIPTION>**Elassandra version**: 6.2.3.17-1 **OS version** (`uname -a` if on a Unix-like system): Ubuntu **Description of the problem including expected versus actual behavior**: Hello, I have a 5 node elassandra cluster (6.2.3.17-1) with replication factor 3. I changed the to RandomSearchStrategy and now when I'm doing a request like: ``` { &quot;from&quot;: 0, &quot;size&quot;: 20, &quot;_source&quot;: [ &quot;account_uuid&quot;, &quot;uuid&quot;, &quot;initiation_time&quot; ], &quot;query&quot;: { &quot;bool&quot;: { &quot;filter&quot;: [] } }, &quot;sort&quot;: { &quot;initiation_time&quot;: &quot;desc&quot; } } ``` On some queries I get: ``` &quot;took&quot;: 13, &quot;timed_out&quot;: false, &quot;_shards&quot;: { &quot;total&quot;: 3, &quot;successful&quot;: 3, &quot;skipped&quot;: 0, &quot;failed&quot;: 0 } &quot;hits&quot;: { &quot;total&quot;: 141271411, ``` Some other I get: ``` &quot;took&quot;: 13, &quot;timed_out&quot;: false, &quot;_shards&quot;: { &quot;total&quot;: 2, &quot;successful&quot;: 2, &quot;skipped&quot;: 0, &quot;failed&quot;: 0 }, &quot;hits&quot;: { &quot;total&quot;: 95191276, ... ``` - First problem is that some requests shows 3 shards involved and other 2 (randomly). When I get 3 I see duplicate record as well (same id) - Second is that even when shards.total = 2 the hits.total is different from request to request Problems occurs no matter what node I pick to send the request. Also we run repair on the entire cluster, re-indexed but no change. Moving back to `PrimaryFirstSearchStrategy` I get all the time consistent hits.total = 80013500 which is my real number of documents. But response time grows from 15ms to 1500 ms. Any idea what can be wrong? Silviu</DESCRIPTION>
  <REPONAME>elassandra</REPONAME>
  <TIMEDIFFERENCEDAYS>12</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Fixup ES_PORT in aliases.sh</MESSAGE>
    <SHA>8be12d0d2a2e93a000d721cba65bbf032269e57f</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fix RandomSearchStrategy missing results #335</MESSAGE>
      <SHA>e4093b339fdb11a2f3037ba8e6e2b89836dcf6fa</SHA>
      <PATCHEDFILES>
        <FILE>server/src/main/java/org/elassandra/cluster/routing/AbstractSearchStrategy.java</FILE>
        <FILE>server/src/main/java/org/elassandra/cluster/routing/RandomSearchStrategy.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fix RandomSearchStrategy missing results #335</MESSAGE>
      <SHA>bf216460e69ecb372fe0a5b86e7619ae90c04d83</SHA>
      <PATCHEDFILES>
        <FILE>server/src/main/java/org/elassandra/cluster/routing/AbstractSearchStrategy.java</FILE>
        <FILE>server/src/main/java/org/elassandra/cluster/routing/RandomSearchStrategy.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
