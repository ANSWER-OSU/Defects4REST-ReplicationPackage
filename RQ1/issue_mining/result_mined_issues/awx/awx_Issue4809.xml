<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>4809</ISSUENO>
  <ISSUEURL>https://github.com/ansible/awx/issues/4809</ISSUEURL>
  <TITLE>Reducing dynamic inventory update locking</TITLE>
  <DESCRIPTION>##### ISSUE TYPE - Feature Idea ##### SUMMARY &lt;!-- Briefly describe the problem or desired enhancement. --&gt; We're running into a situation, wherein we have an inventory of a few thousand hosts. This inventory is dynamic, there is a source script for the inventory inside of a project. This inventory is configured to overwrite variables and hosts, as our infrastructure can change a lot during the day, and all the variables are delivered through this dynamic source. We, as an organization / team, often need to run orchestration across the entire fleet. Thousands of hosts. These jobs can often last many hours, ensuring fleet health as the job continues through. What we notice is that while such a job is executing, AWX will refuse to update that dynamic inventory. The inventory update job will remain pending while the original task continues. This can be a pretty big problem for us, as our inventory can change throughout the day. New hosts can show up many times throughout the day, or be removed. Data about those hosts can change too, so we do want to have a fairly updated picture of inventory each time we launch a job. What we'd like to see is the ability to execute the inventory update job while a job that USES the inventory is running. This will allow us to configure our inventory with &quot;update on execution&quot;, with a reasonable cache. It will allow new hosts to reliably use provisioning call backs to get jobs. Thanks!</DESCRIPTION>
  <REPONAME>awx</REPONAME>
  <TIMEDIFFERENCEDAYS>119</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #5491 from marshmalien/inv-host-add Add Inventory Host Add form Reviewed-by: https://github.com/apps/softwarefactory-project-zuul</MESSAGE>
    <SHA>c5b4681bf4229205636d4eaf89a32eb750a03833</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Prevent running jobs from blocking inventory updates A running job that has an inventory source will block that inventory update from running. This fix removes the block. The test creates a job in running state, and an inventory update in pending state. The test asserts that the task manager and dependency graph .is_job_blocked method returns False for the inventory update (i.e. update can run). issue #4809</MESSAGE>
      <SHA>b9b888dd97d720ee5ff5461130ec347f3060a44f</SHA>
      <PATCHEDFILES>
        <FILE>awx/main/scheduler/dependency_graph.py</FILE>
        <FILE>awx/main/tests/functional/task_management/test_scheduler.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Prevent running jobs from blocking inventory updates A running job that has an inventory source will block that inventory update from running. This fix removes the block. The test creates a job in running state, and an inventory update in pending state. The test asserts that the task manager and dependency graph .is_job_blocked method returns False for the inventory update (i.e. update can run). issue #4809</MESSAGE>
      <SHA>08d3d8dfe09c4b62c72588d958009c7f8c5aa29e</SHA>
      <PATCHEDFILES>
        <FILE>awx/main/scheduler/dependency_graph.py</FILE>
        <FILE>awx/main/tests/functional/task_management/test_scheduler.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Prevent running jobs from blocking inventory updates A running job that has an inventory source will block that inventory update from running. This fix removes the block. The test creates a job in running state, and an inventory update in pending state. The test asserts that the task manager and dependency graph .is_job_blocked method returns False for the inventory update (i.e. update can run). issue #4809</MESSAGE>
      <SHA>b26b8e709781a425b67bf85554e1a72dfd872a0c</SHA>
      <PATCHEDFILES>
        <FILE>awx/main/scheduler/dependency_graph.py</FILE>
        <FILE>awx/main/tests/functional/task_management/test_scheduler.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
