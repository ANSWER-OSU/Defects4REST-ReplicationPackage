<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>4553</ISSUENO>
  <ISSUEURL>https://github.com/ansible/awx/issues/4553</ISSUEURL>
  <TITLE>RFE: Add toggle for &quot;Disable Local User Log-in&quot; setting</TITLE>
  <DESCRIPTION>##### ISSUE TYPE - Feature Idea ##### SUMMARY &lt;!-- Briefly describe the problem or desired enhancement. --&gt; When the external authentication (LDAP/SAML/OAuth etc.) is enabled, there is a use-case to turn off the authentication for local users for security reason. It would be great if there is a toggle switch to turn on/off authentication for local users. When the local auth is disabled, it is not able to log in via local users but Tower can use built-in admin user in backup/restore process.</DESCRIPTION>
  <REPONAME>awx</REPONAME>
  <TIMEDIFFERENCEDAYS>664</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #10234 from rooftopcellist/rm_eula_acceptance Remove explicit eula acceptance SUMMARY Issue: ansible/tower#4948 This PR changes the entitlement process to no require explicit acceptance of the Eula, but still display it for the user to read. ISSUE TYPE Feature Pull Request COMPONENT NAME API UI AWX VERSION 19.1.0 ADDITIONAL INFO If the eula_accepted field is passed, it will just be ignored. Reviewed-by: Bill Nottingham &lt;None&gt;</MESSAGE>
    <SHA>dd269804fd2c3849eff2313e449ffe8c6f13c126</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Merge pull request #10102 from jbradberry/disable-local-users Add the ability to disable local authentication SUMMARY When an external authentication system is enabled, users would like the ability to disable local authentication for enhanced security. related #4553 TODO create a configure-Tower-in-Tower setting, DISABLE_LOCAL_AUTH expose the setting in the settings UI be able to query out all local-only users User.objects.filter(Q(profile__isnull=True) | Q(profile__ldap_dn=''), enterprise_auth__isnull=True, social_auth__isnull=True) see: awx/main/utils/common.py, get_external_account write a thin wrapper around the Django model-based auth backend update the UI tests to include the new setting be able to trigger a side-effect when this setting changes revoke all OAuth2 tokens for users that do not have a remote auth backend associated with them revoke sessions for local-only users ultimately I did this by adding a new middleware that checks the value of this new setting and force-logouts any local-only user making a request after it is enabled settings API endpoint raises a validation error if there are no external users or auth sources configured The remote user existence validation has been removed, since ultimately we can't know for sure if a sysadmin-level user will still have access to the UI. This is being dealt with by using a confirmation modal, see below. add a modal asking the user to confirm that they want to turn this setting on ISSUE TYPE Feature Pull Request COMPONENT NAME API UI AWX VERSION Reviewed-by: Jeff Bradberry &lt;None&gt; Reviewed-by: Bianca Henderson &lt;beeankha@gmail.com&gt; Reviewed-by: Mat Wilson &lt;mawilson@redhat.com&gt; Reviewed-by: Michael Abashian &lt;None&gt; Reviewed-by: Chris Meyers &lt;None&gt;</MESSAGE>
      <SHA>c29a7ccf8bb1760fc139de7dc787fa8a2353910e</SHA>
      <PATCHEDFILES>
        <FILE>awx/api/conf.py</FILE>
        <FILE>awx/conf/signals.py</FILE>
        <FILE>awx/main/backends.py</FILE>
        <FILE>awx/main/conf.py</FILE>
        <FILE>awx/main/management/commands/expire_sessions.py</FILE>
        <FILE>awx/main/middleware.py</FILE>
        <FILE>awx/settings/defaults.py</FILE>
        <FILE>awx/sso/fields.py</FILE>
        <FILE>awx/ui_next/src/screens/Setting/MiscSystem/MiscSystemDetail/MiscSystemDetail.jsx</FILE>
        <FILE>awx/ui_next/src/screens/Setting/MiscSystem/MiscSystemDetail/MiscSystemDetail.test.jsx</FILE>
        <FILE>awx/ui_next/src/screens/Setting/MiscSystem/MiscSystemEdit/MiscSystemEdit.jsx</FILE>
        <FILE>awx/ui_next/src/screens/Setting/MiscSystem/MiscSystemEdit/MiscSystemEdit.test.jsx</FILE>
        <FILE>awx/ui_next/src/screens/Setting/shared/SharedFields.jsx</FILE>
        <FILE>awx/ui_next/src/screens/Setting/shared/SharedFields.test.jsx</FILE>
        <FILE>awx/ui_next/src/screens/Setting/shared/data.allSettingOptions.json</FILE>
        <FILE>awx/ui_next/src/screens/Setting/shared/data.allSettings.json</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
