<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>4750</ISSUENO>
  <ISSUEURL>https://github.com/ansible/awx/issues/4750</ISSUEURL>
  <TITLE>Inventory Update using &quot;Sourced from a Project&quot; not working - AWX 7.0.0</TITLE>
  <DESCRIPTION>##### ISSUE TYPE - Bug Report ##### SUMMARY &lt;!-- Briefly describe the problem. --&gt; ##### ENVIRONMENT * AWX version: 7.0.0 * AWX install method: docker on linux * Ansible version: 2.8.4 * Operating System: Debian * Web Browser: Chrome ##### STEPS TO REPRODUCE Try to sync an inventory using &quot;Sourced from a Project&quot; source. The job fails with no clear output. When visiting API I find the issue and pin it in specific job running before that ##### EXPECTED RESULTS Inventory sync to happen ##### ACTUAL RESULTS A failed Task ##### ADDITIONAL INFORMATION Checking the inventory_update job number 980 I find this error: ``` { &quot;id&quot;: 980, &quot;type&quot;: &quot;inventory_update&quot;, &quot;url&quot;: &quot;/api/v2/inventory_updates/980/&quot;, &quot;related&quot;: { &quot;created_by&quot;: &quot;/api/v2/users/1/&quot;, &quot;unified_job_template&quot;: &quot;/api/v2/inventory_sources/28/&quot;, &quot;stdout&quot;: &quot;/api/v2/inventory_updates/980/stdout/&quot;, &quot;inventory_source&quot;: &quot;/api/v2/inventory_sources/28/&quot;, &quot;cancel&quot;: &quot;/api/v2/inventory_updates/980/cancel/&quot;, &quot;notifications&quot;: &quot;/api/v2/inventory_updates/980/notifications/&quot;, &quot;events&quot;: &quot;/api/v2/inventory_updates/980/events/&quot;, &quot;source_project_update&quot;: &quot;/api/v2/project_updates/981/&quot;, &quot;inventory&quot;: &quot;/api/v2/inventories/4/&quot;, &quot;credentials&quot;: &quot;/api/v2/inventory_updates/980/credentials/&quot;, &quot;source_project&quot;: &quot;/api/v2/projects/24/&quot; }, &quot;summary_fields&quot;: { &quot;inventory&quot;: { &quot;id&quot;: 4, &quot;name&quot;: &quot;kubernetes&quot;, &quot;description&quot;: &quot;&quot;, &quot;has_active_failures&quot;: false, &quot;total_hosts&quot;: 0, &quot;hosts_with_active_failures&quot;: 0, &quot;total_groups&quot;: 0, &quot;groups_with_active_failures&quot;: 0, &quot;has_inventory_sources&quot;: true, &quot;total_inventory_sources&quot;: 1, &quot;inventory_sources_with_failures&quot;: 1, &quot;organization_id&quot;: 1, &quot;kind&quot;: &quot;&quot; }, &quot;unified_job_template&quot;: { &quot;id&quot;: 28, &quot;name&quot;: &quot;Update inventory&quot;, &quot;description&quot;: &quot;&quot;, &quot;unified_job_type&quot;: &quot;inventory_update&quot; }, &quot;inventory_source&quot;: { &quot;source&quot;: &quot;scm&quot;, &quot;last_updated&quot;: &quot;2019-09-14T13:42:08.653158Z&quot;, &quot;status&quot;: &quot;failed&quot; }, &quot;instance_group&quot;: { &quot;name&quot;: &quot;tower&quot;, &quot;id&quot;: 1 }, &quot;created_by&quot;: { &quot;id&quot;: 1, &quot;username&quot;: &quot;admin&quot;, &quot;first_name&quot;: &quot;&quot;, &quot;last_name&quot;: &quot;&quot; }, &quot;user_capabilities&quot;: { &quot;delete&quot;: true, &quot;start&quot;: true }, &quot;credentials&quot;: [], &quot;source_project&quot;: { &quot;id&quot;: 24, &quot;name&quot;: &quot;Kubernetes&quot;, &quot;description&quot;: &quot;&quot;, &quot;status&quot;: &quot;successful&quot;, &quot;scm_type&quot;: &quot;git&quot; } }, &quot;created&quot;: &quot;2019-09-14T13:36:34.515351Z&quot;, &quot;modified&quot;: &quot;2019-09-14T13:36:34.714877Z&quot;, &quot;name&quot;: &quot;kubernetes - Update inventory&quot;, &quot;description&quot;: &quot;&quot;, &quot;source&quot;: &quot;scm&quot;, &quot;source_path&quot;: &quot;inventory&quot;, &quot;source_script&quot;: null, &quot;source_vars&quot;: &quot;&quot;, &quot;credential&quot;: null, &quot;source_regions&quot;: &quot;&quot;, &quot;instance_filters&quot;: &quot;&quot;, &quot;group_by&quot;: &quot;&quot;, &quot;overwrite&quot;: false, &quot;overwrite_vars&quot;: false, &quot;custom_virtualenv&quot;: null, &quot;timeout&quot;: 0, &quot;verbosity&quot;: 1, &quot;unified_job_template&quot;: 28, &quot;launch_type&quot;: &quot;manual&quot;, &quot;status&quot;: &quot;error&quot;, &quot;failed&quot;: true, &quot;started&quot;: &quot;2019-09-14T13:36:34.822591Z&quot;, &quot;finished&quot;: &quot;2019-09-14T13:36:40.780413Z&quot;, &quot;elapsed&quot;: 0.0, &quot;job_args&quot;: &quot;&quot;, &quot;job_cwd&quot;: &quot;&quot;, &quot;job_env&quot;: {}, &quot;job_explanation&quot;: &quot;Previous Task Failed: {\&quot;job_type\&quot;: \&quot;project_update\&quot;, \&quot;job_name\&quot;: \&quot;Kubernetes\&quot;, \&quot;job_id\&quot;: \&quot;981\&quot;}&quot;, &quot;execution_node&quot;: &quot;ansibleworker1&quot;, &quot;result_traceback&quot;: &quot;Traceback (most recent call last):\n File \&quot;/usr/local/lib/python3.7/dist-packages/awx-7.0.0-py3.7.egg/awx/main/tasks.py\&quot;, line 1174, in run\n self.pre_run_hook(self.instance, private_data_dir)\n File \&quot;/usr/local/lib/python3.7/dist-packages/awx-7.0.0-py3.7.egg/awx/main/tasks.py\&quot;, line 2330, in pre_run_hook\n project_update_task().run(local_project_sync.id)\n File \&quot;/usr/local/lib/python3.7/dist-packages/awx-7.0.0-py3.7.egg/awx/main/tasks.py\&quot;, line 685, in _wrapped\n return f(self, *args, **kwargs)\n File \&quot;/usr/local/lib/python3.7/dist-packages/awx-7.0.0-py3.7.egg/awx/main/tasks.py\&quot;, line 1330, in run\n raise AwxTaskError.TaskError(self.instance, rc)\nException: project_update 981 (failed) encountered an error (rc=2), please see task stdout for details.\n&quot;, &quot;event_processing_finished&quot;: true, &quot;inventory&quot;: 4, &quot;inventory_source&quot;: 28, &quot;license_error&quot;: false, &quot;org_host_limit_error&quot;: false, &quot;source_project_update&quot;: 981, &quot;source_project&quot;: 24 } ``` finding the Job 981, which never Appears in my UI I queried the API and: ``` { &quot;id&quot;: 981, &quot;type&quot;: &quot;project_update&quot;, &quot;url&quot;: &quot;/api/v2/project_updates/981/&quot;, &quot;summary_fields&quot;: { &quot;project&quot;: { &quot;id&quot;: 24, &quot;name&quot;: &quot;Kubernetes&quot;, &quot;description&quot;: &quot;&quot;, &quot;status&quot;: &quot;successful&quot;, &quot;scm_type&quot;: &quot;git&quot; }, &quot;credential&quot;: { &quot;id&quot;: 4, &quot;name&quot;: &quot;**&quot;, &quot;description&quot;: &quot;&quot;, &quot;kind&quot;: &quot;scm&quot;, &quot;cloud&quot;: false, &quot;credential_type_id&quot;: 2 }, &quot;unified_job_template&quot;: { &quot;id&quot;: 24, &quot;name&quot;: &quot;Kubernetes&quot;, &quot;description&quot;: &quot;&quot;, &quot;unified_job_type&quot;: &quot;project_update&quot; }, &quot;instance_group&quot;: { &quot;name&quot;: &quot;tower&quot;, &quot;id&quot;: 1 }, &quot;user_capabilities&quot;: { &quot;delete&quot;: true, &quot;start&quot;: true } }, &quot;created&quot;: &quot;2019-09-14T13:36:34.882981Z&quot;, &quot;modified&quot;: &quot;2019-09-14T13:36:34.882989Z&quot;, &quot;name&quot;: &quot;Kubernetes&quot;, &quot;description&quot;: &quot;&quot;, &quot;local_path&quot;: &quot;_24__kubernetes&quot;, &quot;scm_type&quot;: &quot;git&quot;, &quot;scm_url&quot;: &quot;*******&quot;, &quot;scm_branch&quot;: &quot;&quot;, &quot;scm_refspec&quot;: &quot;&quot;, &quot;scm_clean&quot;: true, &quot;scm_delete_on_update&quot;: true, &quot;credential&quot;: 4, &quot;timeout&quot;: 0, &quot;scm_revision&quot;: &quot;a79609e829f4908c94008e52ba9a9f73e4450ab2&quot;, &quot;unified_job_template&quot;: 24, &quot;launch_type&quot;: &quot;sync&quot;, &quot;status&quot;: &quot;failed&quot;, &quot;failed&quot;: true, &quot;started&quot;: &quot;2019-09-14T13:36:34.882822Z&quot;, &quot;finished&quot;: &quot;2019-09-14T13:36:40.760367Z&quot;, &quot;elapsed&quot;: 5.878, &quot;job_explanation&quot;: &quot;&quot;, &quot;execution_node&quot;: &quot;ansibleworker1&quot;, &quot;result_traceback&quot;: &quot;&quot;, &quot;event_processing_finished&quot;: true, &quot;project&quot;: 24, &quot;job_type&quot;: &quot;run&quot;, &quot;host_status_counts&quot;: { &quot;failures&quot;: 1 }, &quot;playbook_counts&quot;: { &quot;play_count&quot;: 2, &quot;task_count&quot;: 15 } } ``` Finally the error on the Runbook: ``` Identity added: /tmp/awx_981_u15xqles/artifacts/981/ssh_key_data () No config file found; using defaults PLAY [all] ********************************************************************* TASK [delete project directory before update] ********************************** skipping: [localhost,] =&gt; {&quot;changed&quot;: false, &quot;skip_reason&quot;: &quot;Conditional result was False&quot;} TASK [update project using git] ************************************************ ok: [localhost, -&gt; localhost] =&gt; {&quot;after&quot;: &quot;a79609e829f4908c94008e52ba9a9f73e4450ab2&quot;, &quot;before&quot;: &quot;a79609e829f4908c94008e52ba9a9f73e4450ab2&quot;, &quot;changed&quot;: false, &quot;remote_url_changed&quot;: false} TASK [Set the git repository version] ****************************************** ok: [localhost, -&gt; localhost] =&gt; {&quot;ansible_facts&quot;: {&quot;scm_version&quot;: &quot;a79609e829f4908c94008e52ba9a9f73e4450ab2&quot;}, &quot;changed&quot;: false} TASK [update project using hg] ************************************************* skipping: [localhost,] =&gt; {&quot;changed&quot;: false, &quot;skip_reason&quot;: &quot;Conditional result was False&quot;} TASK [Set the hg repository version] ******************************************* skipping: [localhost,] =&gt; {&quot;changed&quot;: false, &quot;skip_reason&quot;: &quot;Conditional result was False&quot;} TASK [parse hg version string properly] **************************************** skipping: [localhost,] =&gt; {&quot;changed&quot;: false, &quot;skip_reason&quot;: &quot;Conditional result was False&quot;} TASK [update project using svn] ************************************************ skipping: [localhost,] =&gt; {&quot;changed&quot;: false, &quot;skip_reason&quot;: &quot;Conditional result was False&quot;} TASK [Set the svn repository version] ****************************************** skipping: [localhost,] =&gt; {&quot;changed&quot;: false, &quot;skip_reason&quot;: &quot;Conditional result was False&quot;} TASK [parse subversion version string properly] ******************************** skipping: [localhost,] =&gt; {&quot;changed&quot;: false, &quot;skip_reason&quot;: &quot;Conditional result was False&quot;} TASK [Ensure the project directory is present] ********************************* skipping: [localhost,] =&gt; {&quot;changed&quot;: false, &quot;skip_reason&quot;: &quot;Conditional result was False&quot;} TASK [Fetch Insights Playbook(s)] ********************************************** skipping: [localhost,] =&gt; {&quot;changed&quot;: false, &quot;skip_reason&quot;: &quot;Conditional result was False&quot;} TASK [Save Insights Version] *************************************************** skipping: [localhost,] =&gt; {&quot;changed&quot;: false, &quot;skip_reason&quot;: &quot;Conditional result was False&quot;} TASK [Repository Version] ****************************************************** ok: [localhost,] =&gt; { &quot;msg&quot;: &quot;Repository Version a79609e829f4908c94008e52ba9a9f73e4450ab2&quot; } PLAY [all] ********************************************************************* TASK [detect requirements.yml] ************************************************* ok: [localhost, -&gt; localhost] =&gt; {&quot;changed&quot;: false, &quot;stat&quot;: {&quot;atime&quot;: 1568468115.431545, &quot;attr_flags&quot;: &quot;&quot;, &quot;attributes&quot;: [], &quot;block_size&quot;: 512, &quot;blocks&quot;: 9, &quot;charset&quot;: &quot;us-ascii&quot;, &quot;checksum&quot;: &quot;78b666b9f4be6f267727d5e851e21569c251f2a7&quot;, &quot;ctime&quot;: 1568468115.419545, &quot;dev&quot;: 173, &quot;device_type&quot;: 0, &quot;executable&quot;: false, &quot;exists&quot;: true, &quot;gid&quot;: 0, &quot;gr_name&quot;: &quot;root&quot;, &quot;inode&quot;: 287311, &quot;isblk&quot;: false, &quot;ischr&quot;: false, &quot;isdir&quot;: false, &quot;isfifo&quot;: false, &quot;isgid&quot;: false, &quot;islnk&quot;: false, &quot;isreg&quot;: true, &quot;issock&quot;: false, &quot;isuid&quot;: false, &quot;mimetype&quot;: &quot;text/plain&quot;, &quot;mode&quot;: &quot;0644&quot;, &quot;mtime&quot;: 1568468115.419545, &quot;nlink&quot;: 1, &quot;path&quot;: &quot;/var/lib/awx/projects/_24__kubernetes/roles/requirements.yml&quot;, &quot;pw_name&quot;: &quot;root&quot;, &quot;readable&quot;: true, &quot;rgrp&quot;: true, &quot;roth&quot;: true, &quot;rusr&quot;: true, &quot;size&quot;: 258, &quot;uid&quot;: 0, &quot;version&quot;: null, &quot;wgrp&quot;: false, &quot;woth&quot;: false, &quot;writeable&quot;: true, &quot;wusr&quot;: true, &quot;xgrp&quot;: false, &quot;xoth&quot;: false, &quot;xusr&quot;: false}} TASK [fetch galaxy roles from requirements.yml] ******************************** fatal: [localhost,]: FAILED! =&gt; {&quot;msg&quot;: &quot;The task includes an option with an undefined variable. The error was: 'roles_destination' is undefined\\n\\nThe error appears to be in '/usr/local/lib/python3.7/dist-packages/awx-7.0.0-py3.7.egg/awx/playbooks/project_update.yml': line 128, column 9, but may\\nbe elsewhere in the file depending on the exact syntax problem.\\n\\nThe offending line appears to be:\\n\\n\\n - name: fetch galaxy roles from requirements.yml\\n ^ here\\n&quot;} PLAY RECAP ********************************************************************* localhost, : ok=4 changed=0 unreachable=0 failed=1 skipped=10 rescued=0 ignored=0 ```</DESCRIPTION>
  <REPONAME>awx</REPONAME>
  <TIMEDIFFERENCEDAYS>47</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #5074 from shanemcd/devel Downstream k8s installer changes Reviewed-by: https://github.com/apps/softwarefactory-project-zuul</MESSAGE>
    <SHA>bda1abab8d981e28c4fd14fb805ff3932c844e03</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Set default location to cwd fixes #4750</MESSAGE>
      <SHA>ca537056834354444c09e326bbabb96cf450dd48</SHA>
      <PATCHEDFILES>
        <FILE>awx/playbooks/project_update.yml</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
