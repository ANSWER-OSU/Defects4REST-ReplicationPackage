<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>5756</ISSUENO>
  <ISSUEURL>https://github.com/ansible/awx/issues/5756</ISSUEURL>
  <TITLE>Adding venv_vars.yaml makes container fail to start</TITLE>
  <DESCRIPTION>##### ISSUE TYPE - Bug Report ##### SUMMARY Use of virtual envs for k8s/openshift, as described on https://github.com/ansible/awx/blob/devel/docs/custom_virtualenvs.md isnt working. ##### ENVIRONMENT * AWX version: 9.1.1 * AWX install method: openshift * Ansible version: Same as what ships with AWX 9.1.1 * Operating System: Centos * Web Browser: Firefox ##### STEPS TO REPRODUCE 1. Ansible AWX is already installed on Openshift 3.11 1. Create a file called `venv_vars.yaml` and copy the example yaml from https://github.com/ansible/awx/blob/devel/docs/custom_virtualenvs.md 1. Attempt to modify installed AWX to have some venvs. Run `ansible-playbook -i inventory install.yml -e openshift_password=username -e openshift_token=$(oc whoami -t) --extra-vars &quot;@venv_vars.yaml&quot;` ##### EXPECTED RESULTS Expect to have virtual environments created. ##### ACTUAL RESULTS The `aws-0` container fails to start, gets stuck in ` Init Crash Loop Back-off `. ##### ADDITIONAL INFORMATION I'm running in a corp environment, and am using a proxy. The below looks like the container isnt using the proxy settings that are added to the inventory. The `init-custom-venvs` has the following command: ``` sh -c yum install -y ansible curl python-setuptools epel-release \ openssl openssl-devel gcc python-devel &amp;&amp; yum install -y python-virtualenv python36 python36-devel &amp;&amp; mkdir -p /opt/custom-venvs &amp;&amp; virtualenv -p python3 \ /opt/custom-venvs/dns_team &amp;&amp; source /opt/custom-venvs/dns_team/bin/activate &amp;&amp; /opt/custom-venvs/dns_team/bin/pip install -U psutil \ &quot;ansible==2.8.1&quot; &amp;&amp; /opt/custom-venvs/dns_team/bin/pip install -U \ dnspython infoblox-client &amp;&amp; deactivate &amp;&amp; virtualenv -p python2 \ /opt/custom-venvs/windows_team &amp;&amp; source /opt/custom-venvs/windows_team/bin/activate &amp;&amp; /opt/custom-venvs/windows_team/bin/pip install -U psutil \ &quot;ansible==2.8.0&quot; &amp;&amp; /opt/custom-venvs/windows_team/bin/pip install -U \ winrm &amp;&amp; deactivate &amp;&amp; virtualenv -p python2 \ /opt/custom-venvs/vmware_team &amp;&amp; source /opt/custom-venvs/vmware_team/bin/activate &amp;&amp; /opt/custom-venvs/vmware_team/bin/pip install -U psutil \ &quot;ansible==2.7.10&quot; &amp;&amp; /opt/custom-venvs/vmware_team/bin/pip install -U \ pyvmomi &amp;&amp; deactivate &amp;&amp; : ``` #### Logs From ` oc logs awx-0 -c init-custom-venvs` shows: ``` Loaded plugins: fastestmirror, ovl Determining fastest mirrors One of the configured repositories failed (Unknown), and yum doesn't have enough cached data to continue. At this point the only safe thing yum can do is fail. There are a few ways to work &quot;fix&quot; this: 1. Contact the upstream for the repository and get them to fix the problem. 2. Reconfigure the baseurl/etc. for the repository, to point to a working upstream. This is most often useful if you are using a newer distribution release than is supported by the repository (and the packages for the previous distribution release still work). 3. Run the command with the repository temporarily disabled yum --disablerepo=&lt;repoid&gt; ... 4. Disable the repository permanently, so yum won't use it by default. Yum will then just ignore the repository until you permanently enable it again or use --enablerepo for temporary usage: yum-config-manager --disable &lt;repoid&gt; or subscription-manager repos --disable=&lt;repoid&gt; 5. Configure the failing repository to be skipped, if it is unavailable. Note that yum will try to contact the repo. when it runs most commands, so will have to try and fail each time (and thus. yum will be be much slower). If it is a very temporary problem though, this is often a nice compromise: yum-config-manager --save --setopt=&lt;repoid&gt;.skip_if_unavailable=true Cannot find a valid baseurl for repo: base/7/x86_64 Could not retrieve mirrorlist http://mirrorlist.centos.org/?release=7&amp;arch=x86_64&amp;repo=os&amp;infra=container error was 14: curl#7 - &quot;Failed to connect to 2604:1580:fe02:2::10: Network is unreachable&quot; ``` @fantashley</DESCRIPTION>
  <REPONAME>awx</REPONAME>
  <TIMEDIFFERENCEDAYS>10</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #5809 from AlexSCorey/5799-TeamEditUpdate Fixes update failure on TeamEdit Reviewed-by: https://github.com/apps/softwarefactory-project-zuul</MESSAGE>
    <SHA>864767d74a11c935d7e63cfc5424d1422ddc444e</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Merge pull request #5805 from fantashley/support-proxy-venv Add proxy support in custom venv container fixes #5756 Reviewed-by: https://github.com/apps/softwarefactory-project-zuul</MESSAGE>
      <SHA>cacd2c3392e52ba08e072e6561148298cb90793d</SHA>
      <PATCHEDFILES>
        <FILE>installer/roles/kubernetes/templates/deployment.yml.j2</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Merge pull request #5756 from rooftopcellist/fix-ja-available More accurate translation for Availability Check</MESSAGE>
      <SHA>038d04efa56dc2fe3cfbe282537040d916eadc00</SHA>
      <PATCHEDFILES>
        <FILE>awx/ui/src/locales/ja/messages.po</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
