<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>5947</ISSUENO>
  <ISSUEURL>https://github.com/ansible/awx/issues/5947</ISSUEURL>
  <TITLE>Cannot checkout ansible galaxy roles after upgrade to 9.2.0</TITLE>
  <DESCRIPTION>##### ISSUE TYPE - Bug Report ##### SUMMARY Cannot check out the ansible galxy roles on a project run. Running this locally works. The roles are on a private git server, and the same SSH key that is used to checkout the project is also used to download the roles Additional information: Killing the container **awx-celery** will make it work only the first run only. After that the error bellow from the run log shows up. ##### ENVIRONMENT * AWX version: 9.2.0 * AWX install method: k8s * Ansible version: 2.9.3 * Operating System: * Web Browser: ##### STEPS TO REPRODUCE &lt;!-- Please describe exactly how to reproduce the problem. --&gt; ##### EXPECTED RESULTS Being able to check out the ansible galaxy roles ##### ACTUAL RESULTS Hangs indefinitely for a checkout of the ansible galaxy roles. ##### ADDITIONAL INFORMATION Run log ``` Identity added: /tmp/awx_2550_0fu1yi5d/artifacts/2550/ssh_key_data (awx) ansible-playbook 2.9.3 config file = /etc/ansible/ansible.cfg configured module search path = ['/var/lib/awx/.ansible/plugins/modules', '/usr/share/ansible/plugins/modules'] ansible python module location = /usr/lib/python3.6/site-packages/ansible executable location = /usr/bin/ansible-playbook python version = 3.6.8 (default, Nov 21 2019, 19:31:34) [GCC 8.3.1 20190507 (Red Hat 8.3.1-4)] Using /etc/ansible/ansible.cfg as config file host_list declined parsing /tmp/awx_2550_0fu1yi5d/inventory/hosts as it did not pass its verify_file() method script declined parsing /tmp/awx_2550_0fu1yi5d/inventory/hosts as it did not pass its verify_file() method auto declined parsing /tmp/awx_2550_0fu1yi5d/inventory/hosts as it did not pass its verify_file() method Parsed /tmp/awx_2550_0fu1yi5d/inventory/hosts inventory source with ini plugin PLAYBOOK: project_update.yml *************************************************** 2 plays in project_update.yml PLAY [Update source tree if necessary] ***************************************** META: ran handlers META: ran handlers META: ran handlers PLAY [Install content with ansible-galaxy command if necessary] **************** META: ran handlers TASK [detect requirements.yml] ************************************************* task path: /var/lib/awx/venv/awx/lib/python3.6/site-packages/awx/playbooks/project_update.yml:133 &lt;127.0.0.1&gt; ESTABLISH LOCAL CONNECTION FOR USER: awx &lt;127.0.0.1&gt; EXEC /bin/sh -c 'echo ~awx &amp;&amp; sleep 0' &lt;127.0.0.1&gt; EXEC /bin/sh -c '( umask 77 &amp;&amp; mkdir -p &quot;` echo /var/lib/awx/.ansible/tmp/ansible-tmp-1581719618.0153997-274054373534382 `&quot; &amp;&amp; echo ansible-tmp-1581719618.0153997-274054373534382=&quot;` echo /var/lib/awx/.ansible/tmp/ansible-tmp-1581719618.0153997-274054373534382 `&quot; ) &amp;&amp; sleep 0' Using module file /usr/lib/python3.6/site-packages/ansible/modules/files/stat.py &lt;127.0.0.1&gt; PUT /var/lib/awx/.ansible/tmp/ansible-local-3zvuarjl6/tmp08hc4g9h TO /var/lib/awx/.ansible/tmp/ansible-tmp-1581719618.0153997-274054373534382/AnsiballZ_stat.py &lt;127.0.0.1&gt; EXEC /bin/sh -c 'chmod u+x /var/lib/awx/.ansible/tmp/ansible-tmp-1581719618.0153997-274054373534382/ /var/lib/awx/.ansible/tmp/ansible-tmp-1581719618.0153997-274054373534382/AnsiballZ_stat.py &amp;&amp; sleep 0' &lt;127.0.0.1&gt; EXEC /bin/sh -c '/usr/bin/python3.6 /var/lib/awx/.ansible/tmp/ansible-tmp-1581719618.0153997-274054373534382/AnsiballZ_stat.py &amp;&amp; sleep 0' &lt;127.0.0.1&gt; EXEC /bin/sh -c 'rm -f -r /var/lib/awx/.ansible/tmp/ansible-tmp-1581719618.0153997-274054373534382/ &gt; /dev/null 2&gt;&amp;1 &amp;&amp; sleep 0' ok: [localhost] =&gt; { &quot;changed&quot;: false, &quot;invocation&quot;: { &quot;module_args&quot;: { &quot;checksum_algorithm&quot;: &quot;sha1&quot;, &quot;follow&quot;: false, &quot;get_attributes&quot;: true, &quot;get_checksum&quot;: true, &quot;get_md5&quot;: false, &quot;get_mime&quot;: true, &quot;path&quot;: &quot;/var/lib/awx/projects/_8__baseline/roles/requirements.yml&quot; } }, &quot;stat&quot;: { &quot;atime&quot;: 1581719306.717563, &quot;attr_flags&quot;: &quot;&quot;, &quot;attributes&quot;: [], &quot;block_size&quot;: 4096, &quot;blocks&quot;: 8, &quot;charset&quot;: &quot;unknown&quot;, &quot;checksum&quot;: &quot;873ac04b1592376ef928d565cc2ce5155883d558&quot;, &quot;ctime&quot;: 1581719306.2855692, &quot;dev&quot;: 228, &quot;device_type&quot;: 0, &quot;execuâ€¦ TASK [fetch galaxy roles from requirements.yml] ******************************** task path: /var/lib/awx/venv/awx/lib/python3.6/site-packages/awx/playbooks/project_update.yml:138 &lt;127.0.0.1&gt; ESTABLISH LOCAL CONNECTION FOR USER: awx &lt;127.0.0.1&gt; EXEC /bin/sh -c 'echo ~awx &amp;&amp; sleep 0' &lt;127.0.0.1&gt; EXEC /bin/sh -c '( umask 77 &amp;&amp; mkdir -p &quot;` echo /var/lib/awx/.ansible/tmp/ansible-tmp-1581719618.5172336-42218225795671 `&quot; &amp;&amp; echo ansible-tmp-1581719618.5172336-42218225795671=&quot;` echo /var/lib/awx/.ansible/tmp/ansible-tmp-1581719618.5172336-42218225795671 `&quot; ) &amp;&amp; sleep 0' Using module file /usr/lib/python3.6/site-packages/ansible/modules/commands/command.py &lt;127.0.0.1&gt; PUT /var/lib/awx/.ansible/tmp/ansible-local-3zvuarjl6/tmpjax4m5ei TO /var/lib/awx/.ansible/tmp/ansible-tmp-1581719618.5172336-42218225795671/AnsiballZ_command.py &lt;127.0.0.1&gt; EXEC /bin/sh -c 'chmod u+x /var/lib/awx/.ansible/tmp/ansible-tmp-1581719618.5172336-42218225795671/ /var/lib/awx/.ansible/tmp/ansible-tmp-1581719618.5172336-42218225795671/AnsiballZ_command.py &amp;&amp; sleep 0' &lt;127.0.0.1&gt; EXEC /bin/sh -c 'ANSIBLE_FORCE_COLOR=False /usr/bin/python3.6 /var/lib/awx/.ansible/tmp/ansible-tmp-1581719618.5172336-42218225795671/AnsiballZ_command.py &amp;&amp; sleep 0' The authenticity of host 'git.&lt;redacted&gt;.com (176.9.x.x)' can't be established. ECDSA key fingerprint is SHA256:qPurwghZ7CHDtzfDJ2JfNVfj8LEAnHpprxDy+3P23JY. ``` **ps -faux** ``` USER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND awx 2645 0.0 0.0 14948 3604 pts/1 Ss 22:40 0:00 /bin/bash awx 2656 0.0 0.0 49276 3660 pts/1 R+ 22:43 0:00 \_ ps -faux awx 2657 0.0 0.0 9672 2116 pts/1 S+ 22:43 0:00 \_ less awx 1 0.0 0.0 37344 4160 ? Ss Feb13 0:00 bash /usr/bin/launch_awx_task.sh awx 132 0.0 0.2 105860 24128 ? S Feb13 0:20 /usr/bin/python3.6 /usr/local/bin/supervisord -c /supervisor_task.conf awx 135 0.0 0.2 83264 17876 ? S Feb13 0:00 \_ python3 /usr/bin/config-watcher awx 136 0.1 1.8 770312 152220 ? Sl Feb13 2:22 \_ /var/lib/awx/venv/awx/bin/python3 /usr/bin/awx-manage run_dispatcher awx 160 0.0 0.0 0 0 ? Z Feb13 0:35 | \_ [awx-manage] &lt;defunct&gt; awx 161 0.0 1.6 473996 136804 ? Sl Feb13 0:41 | \_ /var/lib/awx/venv/awx/bin/python3 /usr/bin/awx-manage run_dispatcher awx 162 0.0 1.6 474252 137220 ? Sl Feb13 0:42 | \_ /var/lib/awx/venv/awx/bin/python3 /usr/bin/awx-manage run_dispatcher awx 2578 0.0 0.0 23060 4504 ? S 22:33 0:00 | | \_ git cat-file --batch-check root 2581 0.0 0.0 17652 1264 pts/0 Ss+ 22:33 0:00 | | \_ /usr/bin/bwrap --die-with-parent --unshare-pid --dev-bind / / --proc /proc --bind /tmp/ansible_runner_pi_445pegtp/ansible_runner_pi_rv6c_wj8/tmp_twvbhc6 /etc/ssh --bind /tmp/ansible_runner_pi_445pegtp/ansible_runner_pi_rv6c_wj8/tmpr_on7l8s /etc/tower --bind /tmp/ansible_runner_pi_445pegtp/ansible_runner_pi_rv6c_wj8/tmpgbjqe0a0 /tmp --bind /tmp/ansible_runner_pi_445pegtp/ansible_runner_pi_rv6c_wj8/tmpf6a20bcu /var/lib/awx --bind /tmp/ansible_runner_pi_445pegtp/ansible_runner_pi_rv6c_wj8/tmp369ttbmc /var/lib/awx/projects --bind /tmp/ansible_runner_pi_445pegtp/ansible_runner_pi_rv6c_wj8/tmpwl9a_sbj /var/log --ro-bind /var/lib/awx/venv/ansible /var/lib/awx/venv/ansible --ro-bind /var/lib/awx/venv/awx /var/lib/awx/venv/awx --bind /tmp/awx_2547_imikqrpl /tmp/awx_2547_imikqrpl --bind /tmp/awx_2550_0fu1yi5d /tmp/awx_2550_0fu1yi5d --bind /var/lib/awx/projects /var/lib/awx/projects --bind /var/lib/awx/venv/awx/lib/python3.6/site-packages/awx/playbooks /var/lib/awx/venv/awx/lib/python3.6/site-packages/awx/playbooks --chdir /var/lib/awx/venv/awx/lib/python3.6/site-packages/awx/playbooks ssh-agent sh -c ssh-add /tmp/awx_2550_0fu1yi5d/artifacts/2550/ssh_key_data &amp;&amp; rm -f /tmp/awx_2550_0fu1yi5d/artifacts/2550/ssh_key_data &amp;&amp; ansible-playbook -vvv -t install_roles -i /tmp/awx_2550_0fu1yi5d/inventory/hosts -e @/tmp/awx_2550_0fu1yi5d/env/extravars project_update.yml awx 2582 0.0 0.0 17748 1316 pts/0 S+ 22:33 0:00 | | \_ /usr/bin/bwrap --die-with-parent --unshare-pid --dev-bind / / --proc /proc --bind /tmp/ansible_runner_pi_445pegtp/ansible_runner_pi_rv6c_wj8/tmp_twvbhc6 /etc/ssh --bind /tmp/ansible_runner_pi_445pegtp/ansible_runner_pi_rv6c_wj8/tmpr_on7l8s /etc/tower --bind /tmp/ansible_runner_pi_445pegtp/ansible_runner_pi_rv6c_wj8/tmpgbjqe0a0 /tmp --bind /tmp/ansible_runner_pi_445pegtp/ansible_runner_pi_rv6c_wj8/tmpf6a20bcu /var/lib/awx --bind /tmp/ansible_runner_pi_445pegtp/ansible_runner_pi_rv6c_wj8/tmp369ttbmc /var/lib/awx/projects --bind /tmp/ansible_runner_pi_445pegtp/ansible_runner_pi_rv6c_wj8/tmpwl9a_sbj /var/log --ro-bind /var/lib/awx/venv/ansible /var/lib/awx/venv/ansible --ro-bind /var/lib/awx/venv/awx /var/lib/awx/venv/awx --bind /tmp/awx_2547_imikqrpl /tmp/awx_2547_imikqrpl --bind /tmp/awx_2550_0fu1yi5d /tmp/awx_2550_0fu1yi5d --bind /var/lib/awx/projects /var/lib/awx/projects --bind /var/lib/awx/venv/awx/lib/python3.6/site-packages/awx/playbooks /var/lib/awx/venv/awx/lib/python3.6/site-packages/awx/playbooks --chdir /var/lib/awx/venv/awx/lib/python3.6/site-packages/awx/playbooks ssh-agent sh -c ssh-add /tmp/awx_2550_0fu1yi5d/artifacts/2550/ssh_key_data &amp;&amp; rm -f /tmp/awx_2550_0fu1yi5d/artifacts/2550/ssh_key_data &amp;&amp; ansible-playbook -vvv -t install_roles -i /tmp/awx_2550_0fu1yi5d/inventory/hosts -e @/tmp/awx_2550_0fu1yi5d/env/extravars project_update.yml awx 2584 6.5 0.8 388624 70520 pts/0 Sl+ 22:33 0:39 | | \_ /usr/bin/python3.6 -s /usr/bin/ansible-playbook -vvv -t install_roles -i /tmp/awx_2550_0fu1yi5d/inventory/hosts -e @/tmp/awx_2550_0fu1yi5d/env/extravars project_update.yml awx 2585 0.0 0.0 29440 548 ? Ss 22:33 0:00 | | \_ ssh-agent sh -c ssh-add /tmp/awx_2550_0fu1yi5d/artifacts/2550/ssh_key_data &amp;&amp; rm -f /tmp/awx_2550_0fu1yi5d/artifacts/2550/ssh_key_data &amp;&amp; ansible-playbook -vvv -t install_roles -i /tmp/awx_2550_0fu1yi5d/inventory/hosts -e @/tmp/awx_2550_0fu1yi5d/env/extravars project_update.yml awx 2609 0.0 0.7 396804 64140 pts/0 S+ 22:33 0:00 | | \_ /usr/bin/python3.6 -s /usr/bin/ansible-playbook -vvv -t install_roles -i /tmp/awx_2550_0fu1yi5d/inventory/hosts -e @/tmp/awx_2550_0fu1yi5d/env/extravars project_update.yml awx 2618 0.0 0.0 14816 3216 pts/0 S+ 22:33 0:00 | | \_ /bin/sh -c ANSIBLE_FORCE_COLOR=False /usr/bin/python3.6 /var/lib/awx/.ansible/tmp/ansible-tmp-1581719618.5172336-42218225795671/AnsiballZ_command.py &amp;&amp; sleep 0 awx 2619 0.0 0.2 92212 18136 pts/0 S+ 22:33 0:00 | | \_ /usr/bin/python3.6 /var/lib/awx/.ansible/tmp/ansible-tmp-1581719618.5172336-42218225795671/AnsiballZ_command.py awx 2620 0.0 0.5 166468 42588 pts/0 S+ 22:33 0:00 | | \_ /usr/bin/python3.6 -s /usr/bin/ansible-galaxy install -r requirements.yml -p /tmp/awx_2547_imikqrpl/requirements_roles -vvv awx 2624 0.0 0.0 23420 4668 pts/0 S+ 22:33 0:00 | | \_ /usr/bin/git clone git@git.&lt;redacted&gt;.com:msp/ansible/roles/msp.sshd.git msp.sshd awx 2625 0.0 0.0 48216 6296 pts/0 S+ 22:33 0:00 | | \_ /usr/bin/ssh git@git.&lt;redacted&gt;.com git-upload-pack 'msp/ansible/roles/msp.sshd.git' awx 930 0.0 1.7 694040 145176 ? Sl 21:11 0:04 | \_ /var/lib/awx/venv/awx/bin/python3 /usr/bin/awx-manage run_dispatcher awx 1008 0.0 1.8 762644 149716 ? Sl 21:12 0:05 | \_ /var/lib/awx/venv/awx/bin/python3 /usr/bin/awx-manage run_dispatcher awx 137 0.0 1.5 605312 125328 ? Sl Feb13 0:14 \_ /var/lib/awx/venv/awx/bin/python3 /usr/bin/awx-manage run_callback_receiver awx 154 0.1 1.5 389792 125400 ? Sl Feb13 2:30 | \_ /var/lib/awx/venv/awx/bin/python3 /usr/bin/awx-manage run_callback_receiver awx 155 0.1 1.5 389512 125264 ? Sl Feb13 2:29 | \_ /var/lib/awx/venv/awx/bin/python3 /usr/bin/awx-manage run_callback_receiver awx 156 0.1 1.5 390112 125148 ? Sl Feb13 2:29 | \_ /var/lib/awx/venv/awx/bin/python3 /usr/bin/awx-manage run_callback_receiver awx 157 0.1 1.5 389592 125316 ? Sl Feb13 2:30 | \_ /var/lib/awx/venv/awx/bin/python3 /usr/bin/awx-manage run_callback_receiver awx 138 0.0 1.6 320288 132104 ? S Feb13 0:23 \_ /var/lib/awx/venv/awx/bin/python3 /usr/bin/awx-manage runworker --only-channels websocket.* ``` ansible.cfg ``` [defaults] host_key_checking = False timeout = 30 remote_tmp = ~/.ansible/tmp remote_user = root interpreter_python = auto_silent roles_path = ./roles strategy = linear [ssh_connection] pipelining = yes ```</DESCRIPTION>
  <REPONAME>awx</REPONAME>
  <TIMEDIFFERENCEDAYS>67</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #6104 from mabashian/6086-proj-form-org Fixes issues with organization when saving the project form. Reviewed-by: https://github.com/apps/softwarefactory-project-zuul</MESSAGE>
    <SHA>e9d11be680a2110011d0b754d5041981f240df9e</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>disable host key checking when installing galaxy roles/collections see: https://github.com/ansible/awx/issues/5947</MESSAGE>
      <SHA>e4695743091dc479e2f67488111363e24e3f63c7</SHA>
      <PATCHEDFILES>
        <FILE>awx/playbooks/project_update.yml</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
