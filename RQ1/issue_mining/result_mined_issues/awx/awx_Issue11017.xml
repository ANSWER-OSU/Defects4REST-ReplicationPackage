<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>11017</ISSUENO>
  <ISSUEURL>https://github.com/ansible/awx/issues/11017</ISSUEURL>
  <TITLE>Unable to use ansible_facts for smart inventory source</TITLE>
  <DESCRIPTION>### Please confirm the following - [X] I agree to follow this project's [code of conduct](http://docs.ansible.com/ansible/latest/community/code_of_conduct.html). - [X] I have checked the [current issues](https://github.com/ansible/awx/issues) for duplicates. - [X] I understand that AWX is open source software provided for free and that I am not entitled to status updates or other assurances. ### Summary One older article describes how ansible_facts can be used to create smart inventory within AWX/Ansible tower: https://www.ansible.com/blog/ansible-tower-advanced-smart-inventory-usage Unfortunately this feature seems to be broken or not properly documented, as API doesn't seem to be recognizing field ansible_facts. GET to /api/v2/hosts/?ansible_facts.ansible_distribution_version=18.04 ``` HTTP 400 Bad Request Allow: GET, POST, HEAD, OPTIONS Content-Type: application/json Vary: Accept X-API-Node: awx-6bd564b87c-26bv6 X-API-Product-Name: AWX X-API-Product-Version: 19.3.0 X-API-Time: 0.005s { &quot;error&quot;: &quot;Host has no field named 'ansible_facts.ansible_distribution_version'&quot; } ``` ### AWX version 19.3.0 ### Installation method kubernetes ### Modifications no ### Ansible version _No response_ ### Operating system _No response_ ### Web browser Firefox ### Steps to reproduce 1. Go to Inventory 2. Add - Smart Inventory 3. Try to filter using &quot;Smart host filter&quot; field Alternative: 1. Go to /api/v2/hosts/ 2. try using query string with desired field (eg /api/v2/hosts/?ansible_facts.ansible_distribution_version=18.04) ### Expected results API queries facts and displays hosts that only match those facts ### Actual results API complains that the field is incorrect ### Additional information Using any top-level field works normally: eg. /api/v2/hosts/?id=302 (if host with ID 302 in AWX exists) returns properties for that host. It would appear that since the ansible_facts is just a reference to additional page that the API is not able to query it.</DESCRIPTION>
  <REPONAME>awx</REPONAME>
  <TIMEDIFFERENCEDAYS>164</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #11573 from nixocio/ui_rename_files Rename remaining .jsx files to .js</MESSAGE>
    <SHA>b4e9ff7ce085d11f94e9fea943aa7766f427774e</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Modify usage of ansible_facts on advanced search Modify usage of ansible_facts on advanced search, once `ansible_facts` key is selected render a text input allowing the user to type special query expected for ansible_facts. This change will add more flexibility to the usage of ansible_facts when creating a smart inventory. See: https://github.com/ansible/awx/issues/11017</MESSAGE>
      <SHA>69c6487f83df8633b69bb0db56d4573df6b5a117</SHA>
      <PATCHEDFILES>
        <FILE>awx/ui/src/components/DataListToolbar/DataListToolbar.js</FILE>
        <FILE>awx/ui/src/components/ListHeader/ListHeader.js</FILE>
        <FILE>awx/ui/src/components/ListHeader/ListHeader.test.js</FILE>
        <FILE>awx/ui/src/components/Lookup/HostFilterLookup.js</FILE>
        <FILE>awx/ui/src/components/Lookup/shared/HostFilterUtils.js</FILE>
        <FILE>awx/ui/src/components/Lookup/shared/HostFilterUtils.test.js</FILE>
        <FILE>awx/ui/src/components/Search/AdvancedSearch.js</FILE>
        <FILE>awx/ui/src/components/Search/Search.js</FILE>
        <FILE>awx/ui/src/screens/Host/HostList/HostList.js</FILE>
        <FILE>awx/ui/src/screens/Host/HostList/HostList.test.js</FILE>
        <FILE>awx/ui/src/screens/Host/HostList/SmartInventoryButton.js</FILE>
        <FILE>awx/ui/src/screens/Inventory/SmartInventoryAdd/SmartInventoryAdd.js</FILE>
        <FILE>awx/ui/src/screens/Inventory/SmartInventoryAdd/SmartInventoryAdd.test.js</FILE>
        <FILE>awx/ui/src/screens/Inventory/SmartInventoryEdit/SmartInventoryEdit.js</FILE>
        <FILE>awx/ui/src/screens/Inventory/shared/SmartInventoryForm.js</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Modify usage of ansible_facts on advanced search Modify usage of ansible_facts on advanced search, once `ansible_facts` key is selected render a text input allowing the user to type special query expected for ansible_facts. This change will add more flexibility to the usage of ansible_facts when creating a smart inventory. See: https://github.com/ansible/awx/issues/11017</MESSAGE>
      <SHA>fca182df1064fe85e3a5ad94f7074f16a13f8381</SHA>
      <PATCHEDFILES>
        <FILE>awx/ui/src/components/DataListToolbar/DataListToolbar.js</FILE>
        <FILE>awx/ui/src/components/ListHeader/ListHeader.js</FILE>
        <FILE>awx/ui/src/components/ListHeader/ListHeader.test.js</FILE>
        <FILE>awx/ui/src/components/Lookup/HostFilterLookup.js</FILE>
        <FILE>awx/ui/src/components/Lookup/shared/HostFilterUtils.js</FILE>
        <FILE>awx/ui/src/components/Lookup/shared/HostFilterUtils.test.js</FILE>
        <FILE>awx/ui/src/components/Search/AdvancedSearch.js</FILE>
        <FILE>awx/ui/src/components/Search/Search.js</FILE>
        <FILE>awx/ui/src/screens/Host/HostList/HostList.js</FILE>
        <FILE>awx/ui/src/screens/Host/HostList/HostList.test.js</FILE>
        <FILE>awx/ui/src/screens/Host/HostList/SmartInventoryButton.js</FILE>
        <FILE>awx/ui/src/screens/Inventory/SmartInventoryAdd/SmartInventoryAdd.js</FILE>
        <FILE>awx/ui/src/screens/Inventory/SmartInventoryAdd/SmartInventoryAdd.test.js</FILE>
        <FILE>awx/ui/src/screens/Inventory/SmartInventoryEdit/SmartInventoryEdit.js</FILE>
        <FILE>awx/ui/src/screens/Inventory/shared/SmartInventoryForm.js</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
