<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>13439</ISSUENO>
  <ISSUEURL>https://github.com/ansible/awx/issues/13439</ISSUEURL>
  <TITLE>CyberArk Conjur lookup plugin does not work with open source Conjur version</TITLE>
  <DESCRIPTION>### Please confirm the following - [X] I agree to follow this project's [code of conduct](https://docs.ansible.com/ansible/latest/community/code_of_conduct.html). - [X] I have checked the [current issues](https://github.com/ansible/awx/issues) for duplicates. - [X] I understand that AWX is open source software provided for free and that I might not receive a timely response. ### Bug Summary The CyberArk Conjur Secrets Manager Lookup plugin no longer supports the lookup against the Conjur OSS. Most likely because the opensource conjure version API endpoint does not have the `/api/` portion recently added by this change: https://github.com/ansible/awx/pull/13121 ### AWX version 2.4 ### Select the relevant components - [ ] UI - [X] API - [ ] Docs - [ ] Collection - [ ] CLI - [ ] Other ### Installation method docker development environment ### Modifications no ### Ansible version _No response_ ### Operating system _No response_ ### Web browser _No response_ ### Steps to reproduce 1. Deploy Conjur OSS. We use the latest `cyberark/conjur` image for that. The Conjur version is ``` Version 1.19.1-3398 API Version 5.3.0 ``` 2. Under the AWX, create the CyberArk Conjur Secrets Manager Lookup credential. Provide Conjure URL, user, and token. 3. Click Test and provide a path. ### Expected results Connection to Conjur should be established. HTTP 200 response. ### Actual results 401 error returned. ``` Traceback (most recent call last): File &quot;/var/lib/awx/venv/awx/lib64/python3.9/site-packages/awx/main/tasks/jobs.py&quot;, line 504, in run args = self.build_args(self.instance, private_data_dir, passwords) File &quot;/var/lib/awx/venv/awx/lib64/python3.9/site-packages/awx/main/tasks/jobs.py&quot;, line 937, in build_args ssh_username = creds.get_input('username', default='') File &quot;/var/lib/awx/venv/awx/lib64/python3.9/site-packages/awx/main/models/credential/__init__.py&quot;, line 275, in get_input return self._get_dynamic_input(field_name) File &quot;/var/lib/awx/venv/awx/lib64/python3.9/site-packages/awx/main/models/credential/__init__.py&quot;, line 309, in _get_dynamic_input return input_source.get_input_value() File &quot;/var/lib/awx/venv/awx/lib64/python3.9/site-packages/awx/main/models/credential/__init__.py&quot;, line 1250, in get_input_value return backend(**backend_kwargs) File &quot;/var/lib/awx/venv/awx/lib64/python3.9/site-packages/awx/main/credential_plugins/conjur.py&quot;, line 72, in conjur_backend raise_for_status(resp) File &quot;/var/lib/awx/venv/awx/lib64/python3.9/site-packages/awx/main/credential_plugins/plugin.py&quot;, line 12, in raise_for_status resp.raise_for_status() File &quot;/var/lib/awx/venv/awx/lib64/python3.9/site-packages/requests/models.py&quot;, line 1021, in raise_for_status raise HTTPError(http_error_msg, response=self) requests.exceptions.HTTPError: 401 Client Error: Unauthorized for url: https://conjureurl.com/api/authn/test/admin/authenticate ``` ### Additional information _No response_</DESCRIPTION>
  <REPONAME>awx</REPONAME>
  <TIMEDIFFERENCEDAYS>14</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Fix syntax bug that came from fixing sanity tests (#13473)</MESSAGE>
    <SHA>a2f528e6e528acfe030d86cbb0f95a04072185a7</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Merge pull request #13455 from infamousjoeg/fix-13439-support-conjur-oss Fixes #13439 Add exception handling for `/api` on url</MESSAGE>
      <SHA>61c7d4e4cace58af3e8ff63c9a9d3b1f4b2cc0e7</SHA>
      <PATCHEDFILES>
        <FILE>awx/main/credential_plugins/conjur.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
