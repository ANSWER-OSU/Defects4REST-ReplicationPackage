<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>9685</ISSUENO>
  <ISSUEURL>https://github.com/ansible/awx/issues/9685</ISSUEURL>
  <TITLE>Running Ad-hoc command through shell module is not executing against all given hosts</TITLE>
  <DESCRIPTION>&lt;!-- Issues are for **concrete, actionable bugs and feature requests** only - if you're just asking for debugging help or technical support, please use: - http://webchat.freenode.net/?channels=ansible-awx - https://groups.google.com/forum/#!forum/awx-project We have to limit this because of limited volunteer time to respond to issues! --&gt; ##### ISSUE TYPE - Bug Report ##### SUMMARY When running an ad-hoc command (e.g. hostname) using the shell module against an inventory's hosts, it seems the command is executing only against a single host. However, the command is running properly when ran as tasks within a playbook. e.g. running hostname using the shell module as an ad-hoc command against 192.168.100.112 and 192.168.100.113 is producing the following output. ``` No config file found; using defaults SSH password: 192.168.100.112 | CHANGED | rc=0 &gt;&gt; ansible-target-1 192.168.100.113 | CHANGED | rc=0 &gt;&gt; ansible-target-1 ``` The output when ran against the same set of hosts (192.168.100.112 and 192.168.100.113) through a playbook task: Playbook Tasks: ``` - name: Test running a command on Linux shell: hostname register: cmd_output changed_when: false - debug: var: cmd_output ``` Output: ``` ok: [192.168.100.112] =&gt; { &quot;cmd_output&quot;: { &quot;changed&quot;: false, &quot;cmd&quot;: &quot;hostname&quot;, &quot;delta&quot;: &quot;0:00:00.006624&quot;, &quot;end&quot;: &quot;2021-03-24 12:32:21.732695&quot;, &quot;failed&quot;: false, &quot;rc&quot;: 0, &quot;start&quot;: &quot;2021-03-24 12:32:21.726071&quot;, &quot;stderr&quot;: &quot;&quot;, &quot;stderr_lines&quot;: [], &quot;stdout&quot;: &quot;ansible-target-1&quot;, &quot;stdout_lines&quot;: [ &quot;ansible-target-1&quot; ] } } ok: [192.168.100.113] =&gt; { &quot;cmd_output&quot;: { &quot;changed&quot;: false, &quot;cmd&quot;: &quot;hostname&quot;, &quot;delta&quot;: &quot;0:00:00.004691&quot;, &quot;end&quot;: &quot;2021-03-24 12:32:21.732708&quot;, &quot;failed&quot;: false, &quot;rc&quot;: 0, &quot;start&quot;: &quot;2021-03-24 12:32:21.728017&quot;, &quot;stderr&quot;: &quot;&quot;, &quot;stderr_lines&quot;: [], &quot;stdout&quot;: &quot;ansible-target-2&quot;, &quot;stdout_lines&quot;: [ &quot;ansible-target-2&quot; ] } } ``` ##### ENVIRONMENT * AWX version: 18.0.0 * AWX install method: On a Kubernetes Cluster using the Kubernetes Operator mentioned in the installation documentation * Ansible version: Default Execution Environment * Operating System: Ubuntu 18.04.5 LTS * Web Browser: Chrome ##### STEPS TO REPRODUCE Run Ad-hoc command using the shell module in AWX: ![image](https://user-images.githubusercontent.com/28568237/112347999-c652c780-8c9d-11eb-894d-e807a71c07a7.png) ##### EXPECTED RESULTS The hostname command should return the hostname of the target against which it is being executed. ``` SSH password: 192.168.100.113 | CHANGED | rc=0 &gt;&gt; ansible-target-2 192.168.100.112 | CHANGED | rc=0 &gt;&gt; ansible-target-1 ``` ##### ACTUAL RESULTS The hostname of 192.168.100.112 is being returned for both hosts. ``` SSH password: 192.168.100.113 | CHANGED | rc=0 &gt;&gt; ansible-target-1 192.168.100.112 | CHANGED | rc=0 &gt;&gt; ansible-target-1 ``` ##### ADDITIONAL INFORMATION This is the first time I deployed AWX on a Kubernetes cluster using the operator. Please suggest if there is any settings which may need to be modified or if any specific logs are needed to debug this issue further.</DESCRIPTION>
  <REPONAME>awx</REPONAME>
  <TIMEDIFFERENCEDAYS>28</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #9600 from keithjgrant/3167-variables-formatting Initialize variables field/detail with formatted JSON strings SUMMARY When a variables detail or variables field are mounted with JSON code, this ensures the JSON is formatted with friendly whitespace, regardless how it was originally formatted when saved. addresses #3167 ISSUE TYPE Bugfix Pull Request COMPONENT NAME UI Reviewed-by: Kersom &lt;None&gt; Reviewed-by: Jake McDermott &lt;yo@jakemcdermott.me&gt;</MESSAGE>
    <SHA>5ef7dd894ae20e10006fa83dfdadc8b04a95306d</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Merge pull request #9973 from shanemcd/fix-adhoc-commands Fix issue where ad-hoc commands for multiple hosts ran on single host Should resolve #9685 Reviewed-by: Matthew Jones &lt;bsdmatburt@gmail.com&gt;</MESSAGE>
      <SHA>eec4f8dcc27428cd1aeb1c251d43052a3ea780e8</SHA>
      <PATCHEDFILES>
        <FILE>awx/main/tasks.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
