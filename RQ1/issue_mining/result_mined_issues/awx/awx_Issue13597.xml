<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>13597</ISSUENO>
  <ISSUEURL>https://github.com/ansible/awx/issues/13597</ISSUEURL>
  <TITLE>Unable to use CCP lookup plugin with empty webservice_id</TITLE>
  <DESCRIPTION>### Please confirm the following - [X] I agree to follow this project's [code of conduct](https://docs.ansible.com/ansible/latest/community/code_of_conduct.html). - [X] I have checked the [current issues](https://github.com/ansible/awx/issues) for duplicates. - [X] I understand that AWX is open source software provided for free and that I might not receive a timely response. ### Bug Summary When job uses the `CyberArk Central Credential Provider Lookup` credential plugin with an empty web service id, it fails with the exception: ``` Traceback (most recent call last): File &quot;/awx_devel/awx/main/tasks/jobs.py&quot;, line 508, in run args = self.build_args(self.instance, private_data_dir, passwords) File &quot;/awx_devel/awx/main/tasks/jobs.py&quot;, line 941, in build_args ssh_username = creds.get_input('username', default='') File &quot;/awx_devel/awx/main/models/credential/__init__.py&quot;, line 275, in get_input return self._get_dynamic_input(field_name) File &quot;/awx_devel/awx/main/models/credential/__init__.py&quot;, line 309, in _get_dynamic_input return input_source.get_input_value() File &quot;/awx_devel/awx/main/models/credential/__init__.py&quot;, line 1250, in get_input_value return backend(**backend_kwargs) File &quot;/awx_devel/awx/main/credential_plugins/aim.py&quot;, line 73, in aim_backend webservice_id = kwargs['webservice_id'] KeyError: 'webservice_id' ``` The issue is only reproducible if we create a CCP lookup credential using API and we do not provide the `webservice_id` key as the input. If you create CCP lookup with UI - everything works fine. ### AWX version devel ### Select the relevant components - [ ] UI - [X] API - [ ] Docs - [ ] Collection - [ ] CLI - [ ] Other ### Installation method docker development environment ### Modifications no ### Ansible version _No response_ ### Operating system _No response_ ### Web browser _No response_ ### Steps to reproduce 1. Create CyberArk Central Credential Provider Lookup credential. Do not provide the WebService ID value, keep it empty. I used API to create credetnail and the webservice_id was missing in the inputs: ``` inputs = { 'url': url, 'app_id': app_id, 'client_key': client_key, 'client_cert': client_cert, 'verify': verify } payload = factories.credential.payload( name=fauxfactory.gen_utf8(), description=fauxfactory.gen_utf8(), credential_type=cred_type, inputs=inputs ) ``` 2. Create Machine credential that uses the CCP lookup credential. Set proper Object query. 3. Create Job Template that uses this credential. Run the job. ### Expected results The lookup should use default webservice id: `AIMWebService` ### Actual results Exception occured. See description. ### Additional information _No response_</DESCRIPTION>
  <REPONAME>awx</REPONAME>
  <TIMEDIFFERENCEDAYS>9</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Working on running spellcheck on everything ahead of merging the shellcheck/code check CI addition. (#13453)</MESSAGE>
    <SHA>39ee4285ce2427ab9278e2249fd11e06c5a88901</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Merge pull request #13627 from infamousjoeg/fix-13597-webservice_id-default Fixes #13597 webservice_id default value added</MESSAGE>
      <SHA>0eb9de02f390b39eb8c4d3789e9e13ac014f5e96</SHA>
      <PATCHEDFILES>
        <FILE>awx/main/credential_plugins/aim.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
