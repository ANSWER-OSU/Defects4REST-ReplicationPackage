<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>6675</ISSUENO>
  <ISSUEURL>https://github.com/ansible/awx/issues/6675</ISSUEURL>
  <TITLE>Isolated runs choke on rsync's .~tmp~ directories</TITLE>
  <DESCRIPTION>##### ISSUE TYPE - Bug Report ##### SUMMARY In some circumstances, running an Ansible playbook as an isolated job causes a spurious failure (despite all individual Ansible tasks succeeding), because a stray `.~tmp~` directory pops up in an unexpected place. ##### ENVIRONMENT * AWX version: AWX 10.0.0 * AWX install method: openshift * Ansible version: 2.9.5 ##### STEPS TO REPRODUCE - Set `AWX_RESOURCE_PROFILING_ENABLED = True` - Keep running isolated jobs until the problem shows up ##### EXPECTED RESULTS All such jobs should succeed or fail depending solely on the underlying Ansible tasks' outcomes ##### ACTUAL RESULTS Here is an example stack trace (also found in #6280): ``` Traceback (most recent call last): File &quot;/var/lib/awx/venv/awx/lib/python3.6/site-packages/awx/main/tasks.py&quot;, line 1468, in run ident=str(self.instance.pk)) File &quot;/var/lib/awx/venv/awx/lib/python3.6/site-packages/awx/main/isolated/manager.py&quot;, line 422, in run status, rc = self.check() File &quot;/var/lib/awx/venv/awx/lib/python3.6/site-packages/awx/main/isolated/manager.py&quot;, line 241, in check self.consume_events() File &quot;/var/lib/awx/venv/awx/lib/python3.6/site-packages/awx/main/isolated/manager.py&quot;, line 293, in consume_events open(os.path.join(events_path, event), 'r') IsADirectoryError: [Errno 21] Is a directory: '/tmp/awx_754_hs8ylxru/artifacts/754/job_events/.~tmp~' ```</DESCRIPTION>
  <REPONAME>awx</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #6568 from AlanCoding/whoops_not_changed Do not set changed=True if the object did not change Reviewed-by: https://github.com/apps/softwarefactory-project-zuul</MESSAGE>
    <SHA>eeab4b90a55864c9c80882e25780a914398b9e51</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>skip non-files when consuming events synced from isolated hosts see: https://github.com/ansible/awx/issues/6675</MESSAGE>
      <SHA>9843e216323341350b6d8b2934399312aa9f64de</SHA>
      <PATCHEDFILES>
        <FILE>awx/main/isolated/manager.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
