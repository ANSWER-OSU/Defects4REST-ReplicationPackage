<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>6514</ISSUENO>
  <ISSUEURL>https://github.com/ansible/awx/issues/6514</ISSUEURL>
  <TITLE>Key from OpenSSL 1.1.1c FIPS 28 May 2019, is not accepted with passphrase</TITLE>
  <DESCRIPTION>##### ISSUE TYPE - Bug Report ##### SUMMARY When adding keys generated with OpenSSL 1.1.1c FIPS 28 May 2019, awx refuses the key saying: should not be set when SSH key is not encrypted. ##### ENVIRONMENT * AWX version: 10.0.0 * AWX install method: docker * Ansible version: ansible 2.9.6 config file = None configured module search path = ['/root/.ansible/plugins/modules', '/usr/share/ansible/plugins/modules'] ansible python module location = /usr/local/lib/python3.6/site-packages/ansible executable location = /usr/local/bin/ansible python version = 3.6.8 (default, Oct 11 2019, 15:04:54) [GCC 8.3.1 20190507 (Red Hat 8.3.1-4)] * Operating System: RHEL 8 * Web Browser: Chrome, and API ##### STEPS TO REPRODUCE 1. Generate key-pair WITH passphrase ```ssh-keygen -t ed25519 -f awx_ed25519_key -N abcde Generating public/private ed25519 key pair. Your identification has been saved in awx_ed25519_key. Your public key has been saved in awx_ed25519_key.pub. The key fingerprint is: SHA256:GVvNii9jvIOHRsCRUWrV3GBbinwFPpQF3IepEkCnPBs root@myserver.enterprise.se The key's randomart image is: +--[ED25519 256]--+ | .+=++*O+o | | .o*.====o. | | .E.o.B...o | | .o+...B . | | .. .S . | | .. . | | . o= . | | +.o+ | | . ... | +----[SHA256]-----+ ``` 2. Add the key and passphrase with &quot;ssh_key_data&quot; and &quot;ssh_key_unlock&quot; via api or gui 3. Get error.message: {&quot;inputs&quot;=&gt;{&quot;ssh_key_unlock&quot;=&gt;[&quot;should not be set when SSH key is not encrypted.&quot;]}} ##### EXPECTED RESULTS The api to add the key and passphrase ##### ACTUAL RESULTS Error message ##### ADDITIONAL INFORMATION I think that this occur because awx makes some kind of validation on the key, and the new openssl version creates key with different headers: Old openssl-version: OpenSSL 1.0.1e-fips 11 Feb 2013 ``` -----BEGIN RSA PRIVATE KEY----- Proc-Type: 4,ENCRYPTED DEK-Info: DES-EDE3-CBC,B9423EE955EC985E p8vgpHM3U097R80vPr1TV8I4Iqaq8yh7/+gyOb121d+USv4TRqxumT/Y4wuhNLDe ....... -----END RSA PRIVATE KEY----- ``` New openssl-version: OpenSSL 1.1.1c FIPS 28 May 2019 ``` -----BEGIN OPENSSH PRIVATE KEY----- b3BlbnNzaC1rZXktdjEAAAAACmFlczI1Ni1jdHIAAAAGYmNyeXB0AAAAGAAAABCZqRixE+ ....... 8jZox6XfW2/viTcnW0QJd7q854aAPAz5xzmkL3r7MEhr+NYjD7MJ95EJNE -----END OPENSSH PRIVATE KEY----- ```</DESCRIPTION>
  <REPONAME>awx</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Cleaning SOS report passwords (#14557) (#6513) Co-authored-by: Steffen Scheib &lt;92300342+sscheib-rh@users.noreply.github.com&gt;</MESSAGE>
    <SHA>7920c89593b4ff84dbc6d2ac5263266ddeb5da34</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fix bug that prevented dispatcher exit with downed DB (#14469) (#6514) * Separate handling of original sitTERM and sigINT</MESSAGE>
      <SHA>e577121a40f76d2f12cca3a27ba877d2b4ec2c96</SHA>
      <PATCHEDFILES>
        <FILE>awx/main/tasks/signals.py</FILE>
        <FILE>awx/main/tests/unit/tasks/test_signals.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
