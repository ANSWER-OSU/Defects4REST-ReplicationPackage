<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>5388</ISSUENO>
  <ISSUEURL>https://github.com/ansible/awx/issues/5388</ISSUEURL>
  <TITLE>Get Kubernetes API version fails on oc 3.11, 'unknown shorthand flag'</TITLE>
  <DESCRIPTION>##### ISSUE TYPE - Bug Report ##### SUMMARY Installation on Openshift fails on the &quot;Get Kubernetes API version&quot;. ##### ENVIRONMENT * AWX version: 9.0.1 * AWX install method: openshift * Ansible version: 2.8.3 * Operating System: Debian Buster * oc version: v3.11.0+0cbc58b ##### STEPS TO REPRODUCE - oc v3.11.0+0cbc58b - Run the installer ##### EXPECTED RESULTS - Installation success ? ##### ACTUAL RESULTS ``` TASK [kubernetes : Get Kubernetes API version] **************************************************************************************************************************** fatal: [localhost]: FAILED! =&gt; {&quot;changed&quot;: true, &quot;cmd&quot;: [&quot;oc&quot;, &quot;--config=/tmp/awx-config/.kube/config&quot;, &quot;version&quot;, &quot;-o&quot;, &quot;json&quot;], &quot;delta&quot;: &quot;0:00:00.281032&quot;, &quot;end&quot;: &quot;2019-11-25 10:57:37.835706&quot;, &quot;msg&quot;: &quot;non-zero return code&quot;, &quot;rc&quot;: 1, &quot;start&quot;: &quot;2019-11-25 10:57:37.554674&quot;, &quot;stderr&quot;: &quot;Error: unknown shorthand flag: 'o' in -o\n\n\nUsage:\n oc version [flags]\n\nUse \&quot;oc options\&quot; for a list of global command-line options (applies to all commands).&quot;, &quot;stderr_lines&quot;: [&quot;Error: unknown shorthand flag: 'o' in -o&quot;, &quot;&quot;, &quot;&quot;, &quot;Usage:&quot;, &quot; oc version [flags]&quot;, &quot;&quot;, &quot;Use \&quot;oc options\&quot; for a list of global command-line options (applies to all commands).&quot;], &quot;stdout&quot;: &quot;&quot;, &quot;stdout_lines&quot;: []} PLAY RECAP **************************************************************************************************************************************************************** localhost : ok=16 changed=4 unreachable=0 failed=1 skipped=74 rescued=0 ignored=2 ``` ##### ADDITIONAL INFORMATION Executing the command manually: ``` $ oc version -o json Error: unknown shorthand flag: 'o' in -o Usage: oc version [flags] Use &quot;oc options&quot; for a list of global command-line options (applies to all commands). ``` The output json is mentionned in [oc 3.9 documentation](https://docs.openshift.com/container-platform/3.9/cli_reference/basic_cli_operations.html#version) but not in [3.11](https://docs.openshift.com/container-platform/3.11/cli_reference/basic_cli_operations.html).</DESCRIPTION>
  <REPONAME>awx</REPONAME>
  <TIMEDIFFERENCEDAYS>7</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #5418 from shanemcd/downstream-k8s-changes Pull in downstream changes to k8s installer Reviewed-by: https://github.com/apps/softwarefactory-project-zuul</MESSAGE>
    <SHA>1f628778bb458c98a4b72d628dffa427ffbce0c1</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Generic method of detecting k8s api version Related: https://github.com/ansible/awx/issues/5388</MESSAGE>
      <SHA>02c0ff1de225e50df99fd83d80e66a0fdcee0bae</SHA>
      <PATCHEDFILES>
        <FILE>installer/roles/kubernetes/tasks/main.yml</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Generic method of detecting k8s api version Related: https://github.com/ansible/awx/issues/5388</MESSAGE>
      <SHA>3d07f051eeb21657504864eeee5fd3641b1323ab</SHA>
      <PATCHEDFILES>
        <FILE>installer/roles/kubernetes/tasks/main.yml</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Generic method of detecting k8s api version Related: https://github.com/ansible/awx/issues/5388</MESSAGE>
      <SHA>e68d576fd22dba0369a0e703378a1913f6a11528</SHA>
      <PATCHEDFILES>
        <FILE>installer/roles/kubernetes/tasks/main.yml</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
