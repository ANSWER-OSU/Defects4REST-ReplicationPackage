<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>9915</ISSUENO>
  <ISSUEURL>https://github.com/ansible/awx/issues/9915</ISSUEURL>
  <TITLE>Frequent Vault Lookup Errors</TITLE>
  <DESCRIPTION>&lt;!-- Issues are for **concrete, actionable bugs and feature requests** only - if you're just asking for debugging help or technical support, please use: - http://webchat.freenode.net/?channels=ansible-awx - https://groups.google.com/forum/#!forum/awx-project We have to limit this because of limited volunteer time to respond to issues! --&gt; ##### ISSUE TYPE - Bug Report ##### SUMMARY I'm using Vault lookups within my credentials tied to various playbooks and constantly get Errors related to these lookups within my jobs. It happens every time if I try to relaunch a failed job that's using a credential with a Vault lookup. It also happens frequently on newly launched jobs. If I relaunch the Errored job again then it will work just fine. ##### ENVIRONMENT * AWX version: `19.0.0` * AWX install method: `awx-operator` * Ansible version: `2.11` * Operating System: `MacOS` * Web Browser: `Chrome` ##### STEPS TO REPRODUCE Launch a job using a credential with Vault lookups ##### EXPECTED RESULTS Job should launch without error ##### ACTUAL RESULTS ``` Traceback (most recent call last): File &quot;/var/lib/awx/venv/awx/lib64/python3.8/site-packages/awx/main/tasks.py&quot;, line 1332, in run passwords = self.build_passwords(self.instance, kwargs) File &quot;/var/lib/awx/venv/awx/lib64/python3.8/site-packages/awx/main/tasks.py&quot;, line 1495, in build_passwords value = runtime_passwords.get(field, cred.get_input('password' if field == 'ssh_password' else field, default='')) File &quot;/var/lib/awx/venv/awx/lib64/python3.8/site-packages/awx/main/models/credential/__init__.py&quot;, line 273, in get_input return self._get_dynamic_input(field_name) File &quot;/var/lib/awx/venv/awx/lib64/python3.8/site-packages/awx/main/models/credential/__init__.py&quot;, line 301, in _get_dynamic_input return input_source.get_input_value() File &quot;/var/lib/awx/venv/awx/lib64/python3.8/site-packages/awx/main/models/credential/__init__.py&quot;, line 1203, in get_input_value return backend(**backend_kwargs) File &quot;/var/lib/awx/venv/awx/lib64/python3.8/site-packages/awx/main/credential_plugins/hashivault.py&quot;, line 223, in kv_backend raise_for_status(response) File &quot;/var/lib/awx/venv/awx/lib64/python3.8/site-packages/awx/main/credential_plugins/plugin.py&quot;, line 12, in raise_for_status resp.raise_for_status() File &quot;/var/lib/awx/venv/awx/lib64/python3.8/site-packages/requests/models.py&quot;, line 941, in raise_for_status raise HTTPError(http_error_msg, response=self) requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://infra-vault.auslab.cisco.com/v1/infra/data/ad_bind_admin ``` ##### ADDITIONAL INFORMATION I did deploy my awx cluster with multiple `tower_replicas: 2` so I'm not sure if that's a factor. **EDIT**: I scaled my awx deployment replicas to `1` and still have this issue so that does not appear to be related to the problem.</DESCRIPTION>
  <REPONAME>awx</REPONAME>
  <TIMEDIFFERENCEDAYS>1</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #10215 from keithjgrant/9218-sort-in-modal fix namespaced url params SUMMARY Fixes issues when multiple lists are on the page (generally only occurs now when on a list page with an open modal that contains a second list) — Navigating within the modal list currently wipes out URL parameters for the main list, causing the page to reload, which closes the modal. The fix prevents changes to one set of namespaced URL parameters from wiping out URL parameters from another namespace Refactors query string utils to consolidate a lot of repeated logic from components into a new util, updateQueryString. Use this function to modify query string parameters while maintaining params for multiple namespaces at the same time. QS utils that are no longer needed have been deleted: replaceParams and encodeNonDefaultQueryString Addresses #10181 and #9218 ISSUE TYPE Bugfix Pull Request COMPONENT NAME UI Reviewed-by: Keith Grant &lt;keithjgrant@gmail.com&gt; Reviewed-by: John Mitchell &lt;None&gt; Reviewed-by: Alex Corey &lt;Alex.swansboro@gmail.com&gt;</MESSAGE>
    <SHA>d70dfec6b6be47ce3df0b50e5dffc5da4c876281</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Merge pull request #9908 from marshmalien/session-work Add Session context and redirects SUMMARY Issues: #8272 #9197 #8155 #9311 When user is logged out due to inactivity, redirect to the Login Page with a warning alert stating that their session expired. When a user logs in on one tab, redirect from login page to home on the other tabs. Clear session state when it expires and/or when a user logs out. Redirect users to direct link destination after authentication @AlexSCorey is looking at possibly rolling #9915 (SSO login redirect override URL is not working) into this PR ISSUE TYPE Feature Pull Request COMPONENT NAME UI Reviewed-by: Kersom &lt;None&gt; Reviewed-by: Jake McDermott &lt;yo@jakemcdermott.me&gt; Reviewed-by: Keith Grant &lt;keithjgrant@gmail.com&gt; Reviewed-by: Alex Corey &lt;Alex.swansboro@gmail.com&gt; Reviewed-by: Marliana Lara &lt;marliana.lara@gmail.com&gt; Reviewed-by: Tiago Góes &lt;tiago.goes2009@gmail.com&gt;</MESSAGE>
      <SHA>fef24355abd445312b4c939ea257bad8906540ff</SHA>
      <PATCHEDFILES>
        <FILE>awx/ui_next/src/App.jsx</FILE>
        <FILE>awx/ui_next/src/App.test.jsx</FILE>
        <FILE>awx/ui_next/src/components/AppContainer/AppContainer.jsx</FILE>
        <FILE>awx/ui_next/src/components/AppContainer/AppContainer.test.jsx</FILE>
        <FILE>awx/ui_next/src/components/ContentError/ContentError.jsx</FILE>
        <FILE>awx/ui_next/src/constants.js</FILE>
        <FILE>awx/ui_next/src/contexts/Config.jsx</FILE>
        <FILE>awx/ui_next/src/contexts/Session.jsx</FILE>
        <FILE>awx/ui_next/src/locales/en/messages.po</FILE>
        <FILE>awx/ui_next/src/locales/es/messages.po</FILE>
        <FILE>awx/ui_next/src/locales/fr/messages.po</FILE>
        <FILE>awx/ui_next/src/locales/ja/messages.po</FILE>
        <FILE>awx/ui_next/src/locales/nl/messages.po</FILE>
        <FILE>awx/ui_next/src/locales/zh/messages.po</FILE>
        <FILE>awx/ui_next/src/locales/zu/messages.po</FILE>
        <FILE>awx/ui_next/src/screens/Login/Login.jsx</FILE>
        <FILE>awx/ui_next/src/setupTests.js</FILE>
        <FILE>awx/ui_next/testUtils/enzymeHelpers.jsx</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
