<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>9695</ISSUENO>
  <ISSUEURL>https://github.com/ansible/awx/issues/9695</ISSUEURL>
  <TITLE>Wrong prefix for Docker volumes</TITLE>
  <DESCRIPTION>##### ISSUE TYPE - Bug Report ##### SUMMARY The Ansible playbook ```migrate.yml``` creates Docker volumes with the prefix ```tools_```. However, when the command ```make docker-compose``` is executed, Docker volumes with the prefix ```sources_``` are created. ##### ENVIRONMENT * AWX version: 18.0.0 * AWX install method: docker for mac * Ansible version: 2.10.7 * Operating System: macOS Catalina (10.15.7) * Web Browser: Safari ##### STEPS TO REPRODUCE Migrate PostgreSQL data: ``` $ ansible-playbook -i tools/docker-compose/inventory tools/docker-compose/ansible/migrate.yml -e &quot;migrate_local_docker=true&quot; -e &quot;postgres_data_dir=~/.awx/pgdocker&quot; -e &quot;old_docker_compose_dir=~/.awx/awxcompose&quot; ``` Build Docker image: ``` $ make docker-compose-build $ make docker-compose $ docker exec tools_awx_1 make clean-ui ui-devel ``` ##### EXPECTED RESULTS $ docker volume ls DRIVER VOLUME NAME local awxcompose_rsyslog-config local awxcompose_rsyslog-socket local awxcompose_supervisor-socket local tools_awx_db local tools_receptor_1 local tools_redis_socket_1 ##### ACTUAL RESULTS $ docker volume ls DRIVER VOLUME NAME local awxcompose_rsyslog-config local awxcompose_rsyslog-socket local awxcompose_supervisor-socket local sources_awx_db local sources_receptor_1 local sources_redis_socket_1 local tools_awx_db local tools_receptor_1 local tools_redis_socket_1 ##### ADDITIONAL INFORMATION It is necessary to set a custom name for Docker volumes. ``` $ colordiff -Naur docker-compose.yml /tmp/docker-compose.yml --- docker-compose.yml 2021-03-25 12:13:01.000000000 +0100 +++ /tmp/docker-compose.yml 2021-03-25 11:56:31.000000000 +0100 @@ -65,5 +65,8 @@ - &quot;awx_db:/var/lib/postgresql/data&quot; volumes: awx_db: + name: tools_awx_db receptor_1: + name: tools_receptor_1 redis_socket_1: + name: tools_redis_socket_1 ```</DESCRIPTION>
  <REPONAME>awx</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #9711 from jladdjr/let_jupyter_install_ipython let jupyter install ipython running akit with ipython on py38: In [1]: jt = v2.job_templates.create() --------------------------------------------------------------------------- TypeError Traceback (most recent call last) /usr/lib64/python3.8/codeop.py in __call__(self, source, filename, symbol) 141 142 def __call__(self, source, filename, symbol): --&gt; 143 codeob = compile(source, filename, symbol, self.flags, 1) 144 for feature in _features: 145 if codeob.co_flags &amp; feature.compiler_flag: TypeError: required field &quot;type_ignores&quot; missing from Module Looks like we need a newer version of ipython: ipython/ipython#12558 (comment) .. because we pinned ipython in 2017 a39b1e8 If I try to install the newer ipython alongside jupyter, pip's dep resolver mentions a conflict .. but if we just install jupyter there are no conflicts and a newer ipython (that avoids the original issue) gets installed. pip freeze | grep &quot;ipython\|jupyter&quot; ipython==7.21.0 ipython-genutils==0.2.0 jupyter==1.0.0 jupyter-client==6.1.12 jupyter-console==6.4.0 jupyter-core==4.7.1 jupyterlab-pygments==0.1.2 jupyterlab-widgets==1.0.0 In [1]: jt = v2.job_templates.create() In [2]: jt Out[2]: { &quot;id&quot;: 12, &quot;type&quot;: &quot;job_template&quot;, &quot;url&quot;: &quot;/api/v2/job_templates/12/&quot;, Reviewed-by: Shane McDonald &lt;me@shanemcd.com&gt;</MESSAGE>
    <SHA>dee8ed70cdfd1a725bddc90390bdd5003106a26e</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Merge pull request #9696 from dhoppe/patch-1 Set a custom name for Docker volumes SUMMARY This pull request is related to #9695 and will make sure that the command make docker-compose does not create additional Docker volumes with the wrong prefix. ISSUE TYPE Bugfix Pull Request COMPONENT NAME Installer AWX VERSION awx: 18.0.0 ADDITIONAL INFORMATION The current version of docker-compose.yml.j2 does not care about the Docker volumes created during the execution of migrate.yml. This means new Docker volumes will be created with the wrong prefix, which only contain the preloaded data. This does not make sense, because I want to keep my data and according to the docs, the following command is necessary to load the demo data. $ docker exec tools_awx_1 awx-manage create_preload_data Reviewed-by: Shane McDonald &lt;me@shanemcd.com&gt;</MESSAGE>
      <SHA>db21b17ccdbd00418d07860f00a985aa578ade6b</SHA>
      <PATCHEDFILES>
        <FILE>tools/docker-compose/ansible/roles/sources/templates/docker-compose.yml.j2</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
