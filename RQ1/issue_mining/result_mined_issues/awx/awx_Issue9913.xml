<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>9913</ISSUENO>
  <ISSUEURL>https://github.com/ansible/awx/issues/9913</ISSUEURL>
  <TITLE>Tini is downloaded for the wrong architecture</TITLE>
  <DESCRIPTION>##### ISSUE TYPE - Bug Report ##### SUMMARY The Docker container ```tools_awx_1``` terminates with an error message because the Docker image contains ```tini``` for the wrong architecture. ``` ... awx_1_1 | Running migrations: awx_1_1 | No migrations to apply. awx_1_1 | if [ &quot;/var/lib/awx/venv/&quot; ]; then \ awx_1_1 | . /var/lib/awx/venv//awx/bin/activate; \ awx_1_1 | fi; \ awx_1_1 | awx-manage provision_instance --hostname=awx_1; \ awx_1_1 | awx-manage register_queue --queuename=tower --instance_percent=100;\ awx_1_1 | if [ &quot;tower&quot; == &quot;tower,thepentagon&quot; ]; then \ awx_1_1 | awx-manage provision_instance --hostname=isolated; \ awx_1_1 | awx-manage register_queue --queuename='thepentagon' --hostnames=isolated --controller=tower; \ awx_1_1 | awx-manage generate_isolated_key &gt; /awx_devel/awx/main/isolated/authorized_keys; \ awx_1_1 | fi; awx_1_1 | Instance already registered awx_1 awx_1_1 | Instance Group already registered tower awx_1_1 | (changed: False) awx_1_1 | /usr/bin/launch_awx.sh: line 8: /usr/bin/tini: cannot execute binary file: Exec format error awx_1_1 | /usr/bin/launch_awx.sh: line 8: /usr/bin/tini: Success tools_awx_1 exited with code 126 ``` ##### ENVIRONMENT * AWX version: 19.0.0 * AWX install method: docker on linux * Ansible version: 2.10.6 * Operating System: Raspberry Pi OS (Lite 64-Bit) * Web Browser: Safari ##### STEPS TO REPRODUCE Build an run Docker image. ``` $ make docker-compose-build $ make docker-compose ``` ##### EXPECTED RESULTS The Docker image should contain ```tini``` for architecture ```arm64```. ``` $ grep tini Dockerfile # Install tini RUN curl -L -o /usr/bin/tini https://github.com/krallin/tini/releases/download/v0.19.0/tini-arm64 &amp;&amp; \ chmod +x /usr/bin/tini ``` ``` $ docker run -it quay.io/awx/awx_devel:HEAD &quot;file /usr/bin/tini&quot; /usr/bin/tini: ELF 64-bit LSB executable, ARM aarch64, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux-aarch64.so.1, for GNU/Linux 3.7.0, BuildID[sha1]=a6090e14afd1fea9a646fe4a0bd090f2fc041e85, stripped ``` ##### ACTUAL RESULTS The Docker image contains ```tini``` for architecture ```amd64```. ``` $ grep tini Dockerfile # Install tini RUN curl -L -o /usr/bin/tini https://github.com/krallin/tini/releases/download/v0.19.0/tini-amd64 &amp;&amp; \ chmod +x /usr/bin/tini ``` ``` $ docker run -it quay.io/awx/awx_devel:HEAD &quot;file /usr/bin/tini&quot; /usr/bin/tini: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 2.6.32, BuildID[sha1]=a3f773dca5734fef07e2ea80c0450b3c60bbaf74, stripped ``` ##### ADDITIONAL INFORMATION The variable ```tini_architecture``` is defined in the wrong Ansible role. ``` $ grep -r tini_architecture tools/ansible/roles tools/ansible/roles/dockerfile/templates/Dockerfile.j2:RUN curl -L -o /usr/bin/tini https://github.com/krallin/tini/releases/download/v0.19.0/tini-{{ tini_architecture | default('amd64') }} &amp;&amp; \ tools/ansible/roles/image_build/defaults/main.yml:tini_architecture: '{{ { &quot;x86_64&quot;: &quot;amd64&quot;, &quot;aarch64&quot;: &quot;arm64&quot;, &quot;armv7&quot;: &quot;arm&quot; }[ansible_facts.architecture] }}' ```</DESCRIPTION>
  <REPONAME>awx</REPONAME>
  <TIMEDIFFERENCEDAYS>1</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #9776 from AlexSCorey/9019-MultiChart Observability Metrics SUMMARY This adds the chart for Observability Metrics (#9019). To see the chart you need to navigate to /metrics. Also, its best if you run a build that has multiple instances. This will do that for you COMPOSE_TAG=devel CLUSTER_NODE_COUNT=2 make docker-compose. When this feature loads the user has to select an instance (1, or all) and a metric to render data on the graph. Once they select those items, the chart appears and we start to make requests to the api every 3 seconds to get the data. (Currently the api does not support web sockets for this feature) If the user changes the values for either of the drop down items the chart resets. The chart also only show the last 50 data points. There is a &quot;tooltip&quot; that is rendered at the bottom left hand side. I decided to put it there, instead of on the chart itself because this chart could get quite crowded depending the number of data points rendered and the number of instances rendering lines. The X axis is sort of meaningless. The values below simply render the number of api requests. This isn't a value of time. Since the main goal of this feature is to show significant changes instead of tryin to pinpoint when the change occurs I felt that showing a time stamp on this axis would crowd the axis as well. ISSUE TYPE Feature Pull Request COMPONENT NAME UI AWX VERSION ADDITIONAL INFORMATION Reviewed-by: Kersom &lt;None&gt; Reviewed-by: Jake McDermott &lt;yo@jakemcdermott.me&gt; Reviewed-by: Alex Corey &lt;Alex.swansboro@gmail.com&gt; Reviewed-by: Mat Wilson &lt;mawilson@redhat.com&gt;</MESSAGE>
    <SHA>d53d41b84a122448f0dc7657ad67a456b7faffe2</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Merge pull request #9914 from dhoppe/fix_architecture Define variables in the correct Ansible role SUMMARY This pull request is related to #9913. ISSUE TYPE Bugfix Pull Request COMPONENT NAME Docker AWX VERSION awx: 19.0.0 ADDITIONAL INFORMATION This pull request ensures that tini is downloaded for the correct architecture. $ grep tini Dockerfil # Install tini RUN curl -L -o /usr/bin/tini https://github.com/krallin/tini/releases/download/v0.19.0/tini-arm64 &amp;&amp; \ chmod +x /usr/bin/tini Reviewed-by: Shane McDonald &lt;me@shanemcd.com&gt;</MESSAGE>
      <SHA>d834519aae3fc2ed81b3afcebb127352bf033133</SHA>
      <PATCHEDFILES>
        <FILE>tools/ansible/roles/dockerfile/defaults/main.yml</FILE>
        <FILE>tools/ansible/roles/image_build/defaults/main.yml</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
