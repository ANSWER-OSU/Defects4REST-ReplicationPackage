<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>8194</ISSUENO>
  <ISSUEURL>https://github.com/ansible/awx/issues/8194</ISSUEURL>
  <TITLE>Inventory/Project rbac broken on JT form</TITLE>
  <DESCRIPTION>##### ISSUE TYPE - Bug Report ##### SUMMARY It currently looks like we're disabling the Project/Inventory lookups in the JT form if a user does not have the ability to create a project or inventory. See https://github.com/ansible/awx/blob/devel/awx/ui_next/src/components/Lookup/InventoryLookup.jsx#L60 and https://github.com/ansible/awx/blob/devel/awx/ui_next/src/components/Lookup/ProjectLookup.jsx#L58. This is not correct though. Here are the rules in the old UI: - Inventory Lookup 1. On the Add form we never disabled this lookup 2. On the Edit form we disabled this lookup if the user did not have the ability to GET the selected inventory OR GET the selected project OR GET all of the selected credentials. - Project Loookup 1. On the Add form we never disabled this lookup 2. On the Edit form we disabled this lookup if the user did not have the ability to GET the selected inventory OR GET the selected project OR GET all of the selected credentials. The reason why we can get away with not disabling the lookup on Add is because the Add button is hidden if the user does not have access to a project which they can use. The inventory field is not required (use can prompt on launch instead) so this field does not need to be disabled if there is no default. ##### STEPS TO REPRODUCE 1. Create an org called Foo 2. Create a project called Bar in any org (can be Foo) 3. Create a normal user that is a member of Foo 4. Grant normal user use permissions on Bar project 5. Log in as normal user and navigate to the JT Add form ##### EXPECTED RESULTS Inventory/Project lookups to be enabled ##### ACTUAL RESULTS Inventory/Project lookups are disabled</DESCRIPTION>
  <REPONAME>awx</REPONAME>
  <TIMEDIFFERENCEDAYS>113</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #8472 from marshmalien/setting-misc-system-forms Add setting &quot;system&quot; category forms and tests Reviewed-by: https://github.com/apps/softwarefactory-project-zuul</MESSAGE>
    <SHA>1deb4ff5e47c857557bba94e23a451840a7b7cf7</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fix Inventory/Project rbac broken on JT form Fix Inventory/Project rbac broken on JT form. Also, update ProjectLookup to filter using `role_level: 'use_role'` as per old UI implementation. See: https://github.com/ansible/awx/issues/8194</MESSAGE>
      <SHA>48d5c1f0b1fc72a80690245d35c82d6500a066d5</SHA>
      <PATCHEDFILES>
        <FILE>awx/ui_next/src/components/Lookup/InventoryLookup.jsx</FILE>
        <FILE>awx/ui_next/src/components/Lookup/InventoryLookup.test.jsx</FILE>
        <FILE>awx/ui_next/src/components/Lookup/ProjectLookup.jsx</FILE>
        <FILE>awx/ui_next/src/components/Lookup/ProjectLookup.test.jsx</FILE>
        <FILE>awx/ui_next/src/screens/Template/JobTemplateAdd/JobTemplateAdd.jsx</FILE>
        <FILE>awx/ui_next/src/screens/Template/shared/JobTemplateForm.jsx</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fix Inventory/Project rbac broken on JT form Fix Inventory/Project rbac broken on JT form. Also, update ProjectLookup to filter using `role_level: 'use_role'` as per old UI implementation. See: https://github.com/ansible/awx/issues/8194</MESSAGE>
      <SHA>1b389a1287e14d0fb2c23a8c9dbdca1dd8fa5c58</SHA>
      <PATCHEDFILES>
        <FILE>awx/ui_next/src/components/Lookup/InventoryLookup.jsx</FILE>
        <FILE>awx/ui_next/src/components/Lookup/InventoryLookup.test.jsx</FILE>
        <FILE>awx/ui_next/src/components/Lookup/ProjectLookup.jsx</FILE>
        <FILE>awx/ui_next/src/components/Lookup/ProjectLookup.test.jsx</FILE>
        <FILE>awx/ui_next/src/screens/Template/JobTemplateAdd/JobTemplateAdd.jsx</FILE>
        <FILE>awx/ui_next/src/screens/Template/shared/JobTemplateForm.jsx</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fix Inventory/Project rbac broken on JT form Fix Inventory/Project rbac broken on JT form. Also, update ProjectLookup to filter using `role_level: 'use_role'` as per old UI implementation. See: https://github.com/ansible/awx/issues/8194</MESSAGE>
      <SHA>c59407e610964b0d3ab9aa1d276422c83ae8464c</SHA>
      <PATCHEDFILES>
        <FILE>awx/ui_next/src/components/Lookup/InventoryLookup.jsx</FILE>
        <FILE>awx/ui_next/src/components/Lookup/InventoryLookup.test.jsx</FILE>
        <FILE>awx/ui_next/src/components/Lookup/ProjectLookup.jsx</FILE>
        <FILE>awx/ui_next/src/components/Lookup/ProjectLookup.test.jsx</FILE>
        <FILE>awx/ui_next/src/screens/Template/JobTemplateAdd/JobTemplateAdd.jsx</FILE>
        <FILE>awx/ui_next/src/screens/Template/shared/JobTemplateForm.jsx</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fix Inventory/Project rbac broken on JT form Fix Inventory/Project rbac broken on JT form. Also, update ProjectLookup to filter using `role_level: 'use_role'` as per old UI implementation. See: https://github.com/ansible/awx/issues/8194</MESSAGE>
      <SHA>3333b79ef3c948a21e435124059df46e92db5888</SHA>
      <PATCHEDFILES>
        <FILE>awx/ui_next/src/components/Lookup/InventoryLookup.jsx</FILE>
        <FILE>awx/ui_next/src/components/Lookup/InventoryLookup.test.jsx</FILE>
        <FILE>awx/ui_next/src/components/Lookup/ProjectLookup.jsx</FILE>
        <FILE>awx/ui_next/src/components/Lookup/ProjectLookup.test.jsx</FILE>
        <FILE>awx/ui_next/src/screens/Template/JobTemplateAdd/JobTemplateAdd.jsx</FILE>
        <FILE>awx/ui_next/src/screens/Template/shared/JobTemplateForm.jsx</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fix Inventory/Project rbac broken on JT form Fix Inventory/Project rbac broken on JT form. Also, update ProjectLookup to filter using `role_level: 'use_role'` as per old UI implementation. See: https://github.com/ansible/awx/issues/8194</MESSAGE>
      <SHA>ad0c7ab865a4df473052726e66cccd1713efd2d9</SHA>
      <PATCHEDFILES>
        <FILE>awx/ui_next/src/components/Lookup/InventoryLookup.jsx</FILE>
        <FILE>awx/ui_next/src/components/Lookup/InventoryLookup.test.jsx</FILE>
        <FILE>awx/ui_next/src/components/Lookup/ProjectLookup.jsx</FILE>
        <FILE>awx/ui_next/src/components/Lookup/ProjectLookup.test.jsx</FILE>
        <FILE>awx/ui_next/src/screens/Template/JobTemplateAdd/JobTemplateAdd.jsx</FILE>
        <FILE>awx/ui_next/src/screens/Template/shared/JobTemplateForm.jsx</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fix Inventory/Project rbac broken on JT form Fix Inventory/Project rbac broken on JT form. Also, update ProjectLookup to filter using `role_level: 'use_role'` as per old UI implementation. See: https://github.com/ansible/awx/issues/8194</MESSAGE>
      <SHA>e040099bb33dca44b251e2d37a6da8d84347ebe2</SHA>
      <PATCHEDFILES>
        <FILE>awx/ui_next/src/components/Lookup/InventoryLookup.jsx</FILE>
        <FILE>awx/ui_next/src/components/Lookup/InventoryLookup.test.jsx</FILE>
        <FILE>awx/ui_next/src/components/Lookup/ProjectLookup.jsx</FILE>
        <FILE>awx/ui_next/src/components/Lookup/ProjectLookup.test.jsx</FILE>
        <FILE>awx/ui_next/src/screens/Template/JobTemplateAdd/JobTemplateAdd.jsx</FILE>
        <FILE>awx/ui_next/src/screens/Template/JobTemplateEdit/JobTemplateEdit.jsx</FILE>
        <FILE>awx/ui_next/src/screens/Template/shared/JobTemplateForm.jsx</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fix Inventory/Project rbac broken on JT form Fix Inventory/Project rbac broken on JT form. Also, update ProjectLookup to filter using `role_level: 'use_role'` as per old UI implementation. Also, update InventoryLookup to filter using `role_level: 'use_role'` as per old UI implementation. See: https://github.com/ansible/awx/issues/8194</MESSAGE>
      <SHA>667f15c64c59f7dbdda5f6d0b56e7bf75dc72cb0</SHA>
      <PATCHEDFILES>
        <FILE>awx/ui_next/src/components/AdHocCommands/AdHocCommands.jsx</FILE>
        <FILE>awx/ui_next/src/components/Lookup/InventoryLookup.jsx</FILE>
        <FILE>awx/ui_next/src/components/Lookup/InventoryLookup.test.jsx</FILE>
        <FILE>awx/ui_next/src/components/Lookup/ProjectLookup.jsx</FILE>
        <FILE>awx/ui_next/src/components/Lookup/ProjectLookup.test.jsx</FILE>
        <FILE>awx/ui_next/src/screens/Template/JobTemplateAdd/JobTemplateAdd.jsx</FILE>
        <FILE>awx/ui_next/src/screens/Template/JobTemplateEdit/JobTemplateEdit.jsx</FILE>
        <FILE>awx/ui_next/src/screens/Template/shared/JobTemplateForm.jsx</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fix Inventory/Project rbac broken on JT form Fix Inventory/Project rbac broken on JT form. Also, update ProjectLookup to filter using `role_level: 'use_role'` as per old UI implementation. Also, update InventoryLookup to filter using `role_level: 'use_role'` as per old UI implementation. See: https://github.com/ansible/awx/issues/8194</MESSAGE>
      <SHA>e3e961c37da966b3e2b0752f54a5c62fec5b7ace</SHA>
      <PATCHEDFILES>
        <FILE>awx/ui_next/src/components/AdHocCommands/AdHocCommands.jsx</FILE>
        <FILE>awx/ui_next/src/components/Lookup/InventoryLookup.jsx</FILE>
        <FILE>awx/ui_next/src/components/Lookup/InventoryLookup.test.jsx</FILE>
        <FILE>awx/ui_next/src/components/Lookup/ProjectLookup.jsx</FILE>
        <FILE>awx/ui_next/src/components/Lookup/ProjectLookup.test.jsx</FILE>
        <FILE>awx/ui_next/src/screens/Template/JobTemplateAdd/JobTemplateAdd.jsx</FILE>
        <FILE>awx/ui_next/src/screens/Template/JobTemplateEdit/JobTemplateEdit.jsx</FILE>
        <FILE>awx/ui_next/src/screens/Template/shared/JobTemplateForm.jsx</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fix Inventory/Project rbac broken on JT form Fix Inventory/Project rbac broken on JT form. Also, update ProjectLookup to filter using `role_level: 'use_role'` as per old UI implementation. Also, update InventoryLookup to filter using `role_level: 'use_role'` as per old UI implementation. See: https://github.com/ansible/awx/issues/8194</MESSAGE>
      <SHA>deccd106151a6dac6bf67e1687897662f235523b</SHA>
      <PATCHEDFILES>
        <FILE>awx/ui_next/src/components/AdHocCommands/AdHocCommands.jsx</FILE>
        <FILE>awx/ui_next/src/components/Lookup/InventoryLookup.jsx</FILE>
        <FILE>awx/ui_next/src/components/Lookup/InventoryLookup.test.jsx</FILE>
        <FILE>awx/ui_next/src/components/Lookup/ProjectLookup.jsx</FILE>
        <FILE>awx/ui_next/src/components/Lookup/ProjectLookup.test.jsx</FILE>
        <FILE>awx/ui_next/src/screens/Template/JobTemplateAdd/JobTemplateAdd.jsx</FILE>
        <FILE>awx/ui_next/src/screens/Template/JobTemplateEdit/JobTemplateEdit.jsx</FILE>
        <FILE>awx/ui_next/src/screens/Template/shared/JobTemplateForm.jsx</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fix Inventory/Project rbac broken on JT form Fix Inventory/Project rbac broken on JT form. Also, update ProjectLookup to filter using `role_level: 'use_role'` as per old UI implementation. Also, update InventoryLookup to filter using `role_level: 'use_role'` as per old UI implementation. See: https://github.com/ansible/awx/issues/8194</MESSAGE>
      <SHA>b6fd85d2a534a36c72793264bf39f1ee8b7b2d9a</SHA>
      <PATCHEDFILES>
        <FILE>awx/ui_next/src/components/AdHocCommands/AdHocCommands.jsx</FILE>
        <FILE>awx/ui_next/src/components/Lookup/InventoryLookup.jsx</FILE>
        <FILE>awx/ui_next/src/components/Lookup/InventoryLookup.test.jsx</FILE>
        <FILE>awx/ui_next/src/components/Lookup/ProjectLookup.jsx</FILE>
        <FILE>awx/ui_next/src/components/Lookup/ProjectLookup.test.jsx</FILE>
        <FILE>awx/ui_next/src/screens/Template/JobTemplateAdd/JobTemplateAdd.jsx</FILE>
        <FILE>awx/ui_next/src/screens/Template/JobTemplateEdit/JobTemplateEdit.jsx</FILE>
        <FILE>awx/ui_next/src/screens/Template/shared/JobTemplateForm.jsx</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fix Inventory/Project rbac broken on JT form Fix Inventory/Project rbac broken on JT form. Also, update ProjectLookup to filter using `role_level: 'use_role'` as per old UI implementation. Also, update InventoryLookup to filter using `role_level: 'use_role'` as per old UI implementation. See: https://github.com/ansible/awx/issues/8194</MESSAGE>
      <SHA>b8369defd640ed9fdff13cf6f85ba42c185c9327</SHA>
      <PATCHEDFILES>
        <FILE>awx/ui_next/src/components/AdHocCommands/AdHocCommands.jsx</FILE>
        <FILE>awx/ui_next/src/components/Lookup/InventoryLookup.jsx</FILE>
        <FILE>awx/ui_next/src/components/Lookup/InventoryLookup.test.jsx</FILE>
        <FILE>awx/ui_next/src/components/Lookup/ProjectLookup.jsx</FILE>
        <FILE>awx/ui_next/src/components/Lookup/ProjectLookup.test.jsx</FILE>
        <FILE>awx/ui_next/src/screens/Template/JobTemplateAdd/JobTemplateAdd.jsx</FILE>
        <FILE>awx/ui_next/src/screens/Template/JobTemplateEdit/JobTemplateEdit.jsx</FILE>
        <FILE>awx/ui_next/src/screens/Template/shared/JobTemplateForm.jsx</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
