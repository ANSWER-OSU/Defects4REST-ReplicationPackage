<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>9952</ISSUENO>
  <ISSUEURL>https://github.com/ansible/awx/issues/9952</ISSUEURL>
  <TITLE>Problem with symbolic links in ansible role to run a job</TITLE>
  <DESCRIPTION>&lt;!-- Issues are for **concrete, actionable bugs and feature requests** only - if you're just asking for debugging help or technical support, please use: - http://webchat.freenode.net/?channels=ansible-awx - https://groups.google.com/forum/#!forum/awx-project We have to limit this because of limited volunteer time to respond to issues! --&gt; ##### ISSUE TYPE - Bug Report ##### SUMMARY Recently I upgrade my awx version from 17.0 to 19.0 using awx-operator and migrating database such as is described on official docu. Everything is okay but when I run a job I had an error in container awx-task. ##### ENVIRONMENT * AWX version: 19.0.0 * AWX install method: awx-operator in k8s * Ansible version: 2.10 * Operating System: kubernetes running on ubuntu 18 ##### STEPS TO REPRODUCE Have a broken symbolic link in an ansible role repo and update from 17.0.0 to 19.0.0 using awx-operator ##### EXPECTED RESULTS Jobs running successful even with a broken symbolic link like in the 17.0.0 version. ##### ACTUAL RESULTS I am getting this error in awx-task container: ``` 2021-04-20 11:35:50,723 DEBUG [-] awx.main.commands.run_callback_receiver ProjectUpdateEvent.objects.bulk_create(4) 2021-04-20 11:35:50,899 DEBUG [fb4b1880602c4f4881d883bc995d279d] awx.analytics.job_lifecycle job-15549 running playbook Exception in thread Thread-2: Traceback (most recent call last): File &quot;/usr/lib64/python3.8/threading.py&quot;, line 932, in _bootstrap_inner self.run() File &quot;/usr/lib64/python3.8/threading.py&quot;, line 870, in run self._target(*self._args, **self._kwargs) File &quot;/var/lib/awx/venv/awx/lib64/python3.8/site-packages/awx/main/tasks.py&quot;, line 3018, in transmit ansible_runner.interface.run(streamer='transmit', _output=_socket.makefile('wb'), **self.runner_params) File &quot;/var/lib/awx/venv/awx/lib64/python3.8/site-packages/ansible_runner/interface.py&quot;, line 243, in run r.run() File &quot;/var/lib/awx/venv/awx/lib64/python3.8/site-packages/ansible_runner/streaming.py&quot;, line 53, in run self._output.write(utils.stream_dir(self.private_data_dir)) File &quot;/var/lib/awx/venv/awx/lib64/python3.8/site-packages/ansible_runner/utils.py&quot;, line 95, in stream_dir archive.write(os.path.join(dirpath, fname), arcname=os.path.join(relpath, fname)) File &quot;/usr/lib64/python3.8/zipfile.py&quot;, line 1740, in write zinfo = ZipInfo.from_file(filename, arcname, File &quot;/usr/lib64/python3.8/zipfile.py&quot;, line 522, in from_file st = os.stat(filename) FileNotFoundError: [Errno 2] No such file or directory: '/tmp/pdd_wrapper_15549_mh85vlnt/awx_15549_luuthi79/project/core/roles/role-01/files/public_keys/XXXX/XXXXX' ``` ##### ADDITIONAL INFORMATION &lt;!-- Include any links to sosreport, database dumps, screenshots or other information. --&gt;</DESCRIPTION>
  <REPONAME>awx</REPONAME>
  <TIMEDIFFERENCEDAYS>55</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #10134 from AlexSCorey/10132-RelatedGroupsCnverttoTables converts inventory groups related groups and related hosts to tables SUMMARY This addresses #10132 ISSUE TYPE Feature Pull Request COMPONENT NAME UI ADDITIONAL INFORMATION Reviewed-by: Jake McDermott &lt;yo@jakemcdermott.me&gt;</MESSAGE>
    <SHA>0e74f51aa378ebb85edb7ac992125501462217c2</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Merge pull request #10212 from sarabrajsingh/bugfix/create-seperator-worker-thread-for-transmit-jobs-9952 created a TransmitterThread class to start transmit jobs within. Surrâ€¦ SUMMARY Surfaced this bug while fixing issue #9952. Receptor-ctl would hang trying to read from a socket pair that is never closed, when the transmit job was executed yet threw an exception. This anomaly occurred when using a k8s cluster (Openshift in our case) as the execution environment. FYI - for now, this only applies to container groups. We moved the transmit function to execute in its own thread, and rejoin the calling function (_run_internal) when it finishes transmitting, and bubbling up exceptions if any occurred in the thread. ISSUE TYPE Bugfix Pull Request COMPONENT NAME API AWX VERSION awx: 19.1.0 ADDITIONAL INFORMATION Steps to reproduce bug: Create an ansible project with some files (or roles) and commit to a git repository Purposely commit a broken symlink on any file in the project files to git Create a credential set that authenticates to your k8s cluster in AWX Create a container instance group that leverages the credentials from Step 3 in AWX Create a project in AWX that leverages the ansible project/git repo from Step 1 Create a job template that leverages the AWX project from Step 4 and set your EE to the container instance group from Step 3 Execute the job from Step 5 Reviewed-by: Shane McDonald &lt;me@shanemcd.com&gt;</MESSAGE>
      <SHA>61ae80819ff839fc1923b9d42f02ec0dc4d99ad2</SHA>
      <PATCHEDFILES>
        <FILE>awx/main/tasks.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
