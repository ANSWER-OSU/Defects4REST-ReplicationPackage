<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>9769</ISSUENO>
  <ISSUEURL>https://github.com/ansible/awx/issues/9769</ISSUEURL>
  <TITLE>EE RBAC violation when EE org changes</TITLE>
  <DESCRIPTION>##### STEPS TO REPRODUCE * Create two orgs &quot;Org 1&quot; and &quot;Org 2&quot; * Create a global EE * Create a JT in &quot;Org 1&quot; * Assign the global EE to the JT * Change the EE, assign &quot;Org 2&quot; to the EE * Run the JT ##### EXPECTED RESULTS * For the JT to fail to launch because the associated EE is in a different Org than the JT or maybe for the JT to use the default EE since it doesn't have permission to the explicitly defined one. ##### ACTUAL RESULTS * JT runs This problem generalizes to ASSIGN time permissions/RBAC vs. runtime permissions/RBAC. #### User Story For example. Say I am a company and I have created a global EE, call it &quot;My Networking Toolbox&quot;. A few JT explicitly use this EE. My company is growing, we start to create multiple Organizations, we now have an &quot;IT&quot; org and a &quot;Networking&quot; org. I now want to restrict the usage of &quot;My Networking Toolbox&quot; to the &quot;Networking&quot; org so I update the EE accordingly. This is where the problem comes in. Existing JT that are NOT in the &quot;Networking&quot; org still point at the &quot;My Networking Toolbox&quot; EE. New JT living outside of the &quot;Networking&quot; org are NOT allowed to point at &quot;My Networking Toolbox&quot;. #### Ideas * Do nothing. Tell the user to create a new EE record if they want to do this. * Check Jobs &lt;-&gt; EE RBAC at runtime and block running if violation * Do not allow EE to change Org relationship * Do not allow EE to change Org relationship if assigned to at least 1 job (similar behavior CredentialType)</DESCRIPTION>
  <REPONAME>awx</REPONAME>
  <TIMEDIFFERENCEDAYS>29</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #9873 from wenottingham/not-any-more-they-arent Update templates for installer changes SUMMARY Some of the options aren't valid any more. Reviewed-by: Jake McDermott &lt;yo@jakemcdermott.me&gt;</MESSAGE>
    <SHA>311c44341eaad465fadc286de0427e69ea434bbc</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Do not allow EE to modify Org Do not allow EE to modify Org. See: https://github.com/ansible/awx/issues/9769</MESSAGE>
      <SHA>8f44a20a81de6e16f4b846d0ff26d2ea40c35244</SHA>
      <PATCHEDFILES>
        <FILE>awx/ui_next/src/screens/ExecutionEnvironment/ExecutionEnvironmentEdit/ExecutionEnvironmentEdit.jsx</FILE>
        <FILE>awx/ui_next/src/screens/ExecutionEnvironment/ExecutionEnvironmentList/ExecutionEnvironmentList.jsx</FILE>
        <FILE>awx/ui_next/src/screens/ExecutionEnvironment/shared/ExecutionEnvironmentForm.jsx</FILE>
        <FILE>awx/ui_next/src/screens/ExecutionEnvironment/shared/ExecutionEnvironmentForm.test.jsx</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Merge pull request #9874 from fosterseth/fix_a9769_ee_rbac_change_org Prevent execution environment from being assigned to a new organization SUMMARY related #9769 ee organization can be changed to null (less restrictive) if organization is null, cannot be assigned to org (more restrictive) if org is assigned, it cannot be set to a different org ISSUE TYPE Bugfix Pull Request COMPONENT NAME API AWX VERSION awx: 19.0.0 Reviewed-by: Kersom &lt;None&gt; Reviewed-by: Chris Meyers &lt;None&gt; Reviewed-by: Jeff Bradberry &lt;None&gt; Reviewed-by: Seth Foster &lt;None&gt;</MESSAGE>
      <SHA>98bb296c6a3246167ccf6dc007bc70555d02a38d</SHA>
      <PATCHEDFILES>
        <FILE>awx/api/serializers.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Do not allow EE to modify Org Do not allow EE to modify Org. See: https://github.com/ansible/awx/issues/9769</MESSAGE>
      <SHA>7bd50a06efd6e8f24d84f355827ee5450ba89666</SHA>
      <PATCHEDFILES>
        <FILE>awx/ui_next/src/screens/ExecutionEnvironment/ExecutionEnvironmentEdit/ExecutionEnvironmentEdit.jsx</FILE>
        <FILE>awx/ui_next/src/screens/ExecutionEnvironment/ExecutionEnvironmentList/ExecutionEnvironmentList.jsx</FILE>
        <FILE>awx/ui_next/src/screens/ExecutionEnvironment/shared/ExecutionEnvironmentForm.jsx</FILE>
        <FILE>awx/ui_next/src/screens/ExecutionEnvironment/shared/ExecutionEnvironmentForm.test.jsx</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Do not allow EE to modify Org Do not allow EE to modify Org. See: https://github.com/ansible/awx/issues/9769</MESSAGE>
      <SHA>95f518846272a8d5467578051407c1c85fc4f1ad</SHA>
      <PATCHEDFILES>
        <FILE>awx/ui_next/src/screens/ExecutionEnvironment/ExecutionEnvironmentEdit/ExecutionEnvironmentEdit.jsx</FILE>
        <FILE>awx/ui_next/src/screens/ExecutionEnvironment/shared/ExecutionEnvironmentForm.jsx</FILE>
        <FILE>awx/ui_next/src/screens/ExecutionEnvironment/shared/ExecutionEnvironmentForm.test.jsx</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Merge pull request #9884 from nixocio/ui_issue_9769 Do not allow EE to modify Org Do not allow EE to modify Org. See: #9769 Also: #9874 Reviewed-by: Jake McDermott &lt;yo@jakemcdermott.me&gt; Reviewed-by: Tiago GÃ³es &lt;tiago.goes2009@gmail.com&gt;</MESSAGE>
      <SHA>a194dfdbbbde17a8e57a80407c5dd04bd09f78b0</SHA>
      <PATCHEDFILES>
        <FILE>awx/ui_next/src/screens/ExecutionEnvironment/ExecutionEnvironmentEdit/ExecutionEnvironmentEdit.jsx</FILE>
        <FILE>awx/ui_next/src/screens/ExecutionEnvironment/shared/ExecutionEnvironmentForm.jsx</FILE>
        <FILE>awx/ui_next/src/screens/ExecutionEnvironment/shared/ExecutionEnvironmentForm.test.jsx</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
