<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>4574</ISSUENO>
  <ISSUEURL>https://github.com/ansible/awx/issues/4574</ISSUEURL>
  <TITLE>MEMCACHED_HOST and MEMCACHED_PORT are not used</TITLE>
  <DESCRIPTION>##### ISSUE TYPE - Bug Report ##### SUMMARY &lt;!-- Briefly describe the problem. --&gt; `MEMCACHED_HOST` and `MEMCACHED_PORT` env variables are not used at all. Not possible to specify memcached host other than default. Probably here: https://github.com/ansible/awx/blob/devel/installer/roles/local_docker/templates/environment.sh.j2#L6-L7 ##### ENVIRONMENT * AWX version: 6.0.1 * AWX install method: docker ##### STEPS TO REPRODUCE ``` docker run -d \ --restart unless-stopped \ --network awxnetwork \ --name awx-memcached \ memcached:alpine docker run -d \ --restart unless-stopped \ --network awxnetwork \ -e MEMCACHED_HOST=awx-memcached \ -e MEMCACHED_PORT=11211 ansible/awx_web:6.1.0 ``` ##### EXPECTED RESULTS `awx-memcached` host will be used based on `MEMCACHED_HOST` env variable ##### ACTUAL RESULTS `MEMCACHED_HOST` env variable is not used =&gt; fallbacks to default value, which is `memcached` =&gt; memcached will not be used =&gt; AWX is slow. ##### ADDITIONAL INFORMATION ``` docker exec -it awx-web bash -c 'echo &quot;from django.conf import settings; print(settings.CACHES)&quot; | awx-manage shell' {'default': {'BACKEND': 'django.core.cache.backends.memcached.MemcachedCache', 'LOCATION': 'memcached:11211'}} ``` ``` docker exec -it awx-task bash -c 'echo &quot;from django.conf import settings; print(settings.CACHES)&quot; | awx-manage shell' {'default': {'BACKEND': 'django.core.cache.backends.memcached.MemcachedCache', 'LOCATION': 'memcached:11211'}} ``` I guess that this should be added/overrided, isnt? https://github.com/ansible/awx/blob/devel/awx/settings/defaults.py#L421-L429 I guess that this https://github.com/ansible/awx/pull/3720/commits/3bfb54d2fde6b0a071b0748f3d6f48ba4aee7b5d commit breaked MEMCACHED_HOST and MEMCACHED_PORT env variables:</DESCRIPTION>
  <REPONAME>awx</REPONAME>
  <TIMEDIFFERENCEDAYS>227</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #4568 from ryanpetrello/callback-status backport awx-manage run_callback_receiver --status</MESSAGE>
    <SHA>d0e889d52eefd024ef0a54edcfdb395c2eefc689</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Merge pull request #4574 from kdelee/fix_log_level Need log level info to show up with new settings</MESSAGE>
      <SHA>397c58a609e826f020122cc97e6b4691e3f2ee7b</SHA>
      <PATCHEDFILES>
        <FILE>awx/main/management/commands/gather_analytics.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
