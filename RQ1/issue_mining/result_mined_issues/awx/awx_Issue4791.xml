<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>4791</ISSUENO>
  <ISSUEURL>https://github.com/ansible/awx/issues/4791</ISSUEURL>
  <TITLE>Error trying to create Machine credential with prompted password field and HashiCorp Vault KV backed private key</TITLE>
  <DESCRIPTION>##### ISSUE TYPE - Bug Report ##### SUMMARY I'm trying to set up a Machine credential. For SSH Private Key I'm sourcing it from an already configured HashiCorp Vault KV credential. I want the user to provide the passphrase at template launch so I check the box. When I do this I get an error stating that `cannot be set unless &quot;SSH Private Key&quot; is set`. I suspect this is just a by-product of a credential plugin. Sourcing the private data by way of a plugin makes the schema for Machine (ssh) credentials fail to validate. ##### ENVIRONMENT * AWX version: 6.1.0 * AWX install method: docker on linux * Ansible version: 2.8.2 * Operating System: Mac OSX * Web Browser: Safari ##### STEPS TO REPRODUCE &lt;!-- Please describe exactly how to reproduce the problem. --&gt; - Create a HashiCorp Vault KV credential - Open dialog to create another credential; a Machine credential - Click the search button for the SSH PRIVATE KEY dialog - Select previously created HashiCorp Vault KV credential and click next - Fill in data for secret path and key name and save - Check Prompt on launch for PRIVATE KEY PASSPHRASE - Click Save ##### EXPECTED RESULTS &lt;!-- What did you expect to happen when running the steps above? --&gt; I expected to be able to source the private data from Vault and the passphrase from the user, ensuring no part of the combo is stored within AWX at rest. ##### ACTUAL RESULTS &lt;!-- What actually happened? --&gt; An error dialog appears below PRIVATE KEY PASSPHRASE and I cannot continue. ![Screen Shot 2019-09-19 at 7 06 05 PM](https://user-images.githubusercontent.com/523287/65294183-b9866e00-db12-11e9-902f-8a3175dc92f7.png) ##### ADDITIONAL INFORMATION &lt;!-- Include any links to sosreport, database dumps, screenshots or other information. --&gt; ![vault-ssh-prompt](https://user-images.githubusercontent.com/523287/65294681-cc4d7280-db13-11e9-900c-bf769e649a30.gif) cc github/gtower#19</DESCRIPTION>
  <REPONAME>awx</REPONAME>
  <TIMEDIFFERENCEDAYS>18</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Merge pull request #4806 from beeankha/url_update Update URL Reviewed-by: https://github.com/apps/softwarefactory-project-zuul</MESSAGE>
    <SHA>ebbcefd7df7a039fdb61d7ae458c9e294d57217d</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>fix a bug that prevents launch-time passphrases w/ cred plugins with the advent of credential plugins there's no way for us to *actually know* the RSA key value at the time the credential is _created_, because the order of operations is: 1. Create the credential with a specified passphrase 2. Associate a new dynamic inventory source pointed at some third party provider (hashi, cyberark, etc...) this commit removes the code that warns you about an extraneous passphrase (if you don't specify a private key) additionally, the code for determining whether or not a credential _requires_ a password/phrase at launch time has been updated to test private key validity based on the *actual* value from the third party provider see: https://github.com/ansible/awx/issues/4791</MESSAGE>
      <SHA>a79fc3eb3321dd2c88d58b5b75a32c70a0364968</SHA>
      <PATCHEDFILES>
        <FILE>awx/main/models/credential/__init__.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>fix a bug that prevents launch-time passphrases w/ cred plugins with the advent of credential plugins there's no way for us to *actually know* the RSA key value at the time the credential is _created_, because the order of operations is: 1. Create the credential with a specified passphrase 2. Associate a new dynamic inventory source pointed at some third party provider (hashi, cyberark, etc...) this commit removes the code that warns you about an extraneous passphrase (if you don't specify a private key) additionally, the code for determining whether or not a credential _requires_ a password/phrase at launch time has been updated to test private key validity based on the *actual* value from the third party provider see: https://github.com/ansible/awx/issues/4791</MESSAGE>
      <SHA>505acb5515cab9dc952b14829ca59ed20b9f6faa</SHA>
      <PATCHEDFILES>
        <FILE>awx/main/models/credential/__init__.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>fix a bug that prevents launch-time passphrases w/ cred plugins with the advent of credential plugins there's no way for us to *actually know* the RSA key value at the time the credential is _created_, because the order of operations is: 1. Create the credential with a specified passphrase 2. Associate a new dynamic inventory source pointed at some third party provider (hashi, cyberark, etc...) this commit removes the code that warns you about an extraneous passphrase (if you don't specify a private key) additionally, the code for determining whether or not a credential _requires_ a password/phrase at launch time has been updated to test private key validity based on the *actual* value from the third party provider see: https://github.com/ansible/awx/issues/4791</MESSAGE>
      <SHA>4844005f175b90e8de475f9188423bbcf30a36a2</SHA>
      <PATCHEDFILES>
        <FILE>awx/main/models/credential/__init__.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>fix a bug that prevents launch-time passphrases w/ cred plugins with the advent of credential plugins there's no way for us to *actually know* the RSA key value at the time the credential is _created_, because the order of operations is: 1. Create the credential with a specified passphrase 2. Associate a new dynamic inventory source pointed at some third party provider (hashi, cyberark, etc...) this commit removes the code that warns you about an extraneous passphrase (if you don't specify a private key) additionally, the code for determining whether or not a credential _requires_ a password/phrase at launch time has been updated to test private key validity based on the *actual* value from the third party provider see: https://github.com/ansible/awx/issues/4791</MESSAGE>
      <SHA>d30d51d72cfbef4722eb0595fcd3f4f43c342198</SHA>
      <PATCHEDFILES>
        <FILE>awx/main/models/credential/__init__.py</FILE>
        <FILE>awx/main/tests/functional/api/test_credential.py</FILE>
        <FILE>awx/main/tests/functional/test_credential.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
