<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>116973</ISSUENO>
  <ISSUEURL>https://github.com/elastic/elasticsearch/issues/116973</ISSUEURL>
  <TITLE>[CI] CohereServiceUpgradeIT testRerank {upgradedNodes=1} failing</TITLE>
  <DESCRIPTION>**Build Scans:** - [elasticsearch-periodic #5417 / 8.14.3_bwc](https://gradle-enterprise.elastic.co/s/ceoqk4l5od7b4) - [elasticsearch-periodic #5412 / 8.14.3_bwc](https://gradle-enterprise.elastic.co/s/a234mecqbvara) - [elasticsearch-periodic #5407 / 8.14.3_bwc](https://gradle-enterprise.elastic.co/s/3nvtygovijbwi) - [elasticsearch-periodic #5402 / 8.14.3_bwc](https://gradle-enterprise.elastic.co/s/i6nog6x6vbfhq) - [elasticsearch-periodic #5397 / 8.14.3_bwc](https://gradle-enterprise.elastic.co/s/cwrd2pcz65qsq) - [elasticsearch-periodic #5392 / 8.14.3_bwc](https://gradle-enterprise.elastic.co/s/pqbn6cahnpufg) - [elasticsearch-periodic #5387 / 8.14.3_bwc](https://gradle-enterprise.elastic.co/s/qzsayntvdpags) - [elasticsearch-periodic #5377 / 8.14.3_bwc](https://gradle-enterprise.elastic.co/s/ab7zdua62klvu) - [elasticsearch-periodic #5372 / 8.14.3_bwc](https://gradle-enterprise.elastic.co/s/ihnqdrlvrd44g) **Reproduction Line:** ``` ./gradlew &quot;:x-pack:plugin:inference:qa:rolling-upgrade:v8.14.3#bwcTest&quot; -Dtests.class=&quot;org.elasticsearch.xpack.application.CohereServiceUpgradeIT&quot; -Dtests.method=&quot;testRerank {upgradedNodes=1}&quot; -Dtests.seed=F8AD857E01D36443 -Dtests.bwc=true -Dtests.locale=ff-Adlm-CM -Dtests.timezone=Asia/Singapore -Druntime.java=23 ``` **Applicable branches:** 8.x **Reproduces locally?:** N/A **Failure History:** [See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&amp;_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.application.CohereServiceUpgradeIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(testRerank%20%7BupgradedNodes%3D1%7D),title:'Test',type:optionsListControl))))) **Failure Message:** ``` java.lang.IndexOutOfBoundsException: Index: 0, Size: 0 ``` **Issue Reasons:** - [8.x] 7 consecutive failures in step 8.14.3_bwc - [8.x] 9 failures in test testRerank {upgradedNodes=1} (2.1% fail rate in 431 executions) - [8.x] 9 failures in step 8.14.3_bwc (81.8% fail rate in 11 executions) - [8.x] 9 failures in pipeline elasticsearch-periodic (90.0% fail rate in 10 executions) **Note:** This issue was created using new test triage automation. Please report issues or feedback to es-delivery.</DESCRIPTION>
  <REPONAME>elasticsearch</REPONAME>
  <TIMEDIFFERENCEDAYS>64</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>[8.x] Fix handling of bulk requests with semantic text fields and delete ops (#116960) * Fix handling of bulk requests with semantic text fields and delete ops (#116942) Previously, delete operations were not processed correctly when followed by operations containing semantic text fields. This issue caused the positions of subsequent operations in the items array to shift incorrectly by one. This PR resolves the discrepancy and includes additional tests to ensure proper behavior. * fix compilation</MESSAGE>
    <SHA>c6e4bb44657ce1e03e61c496e4674cdfdc74c394</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Mute org.elasticsearch.xpack.application.CohereServiceUpgradeIT testRerank {upgradedNodes=1} #116973</MESSAGE>
      <SHA>e1b6990325bf7f9749a214d3647f5e3dd7ac65f5</SHA>
      <PATCHEDFILES>
        <FILE>muted-tests.yml</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>[Inference API] Unmute upgrade test (#118666) https://github.com/elastic/elasticsearch/pull/118664 ``` - class: org.elasticsearch.xpack.application.CohereServiceUpgradeIT method: testRerank {upgradedNodes=1} issue: https://github.com/elastic/elasticsearch/issues/116973 - class: org.elasticsearch.xpack.application.CohereServiceUpgradeIT method: testCohereEmbeddings {upgradedNodes=1} issue: https://github.com/elastic/elasticsearch/issues/116974 - class: org.elasticsearch.xpack.application.CohereServiceUpgradeIT method: testCohereEmbeddings {upgradedNodes=2} issue: https://github.com/elastic/elasticsearch/issues/116975 - class: org.elasticsearch.xpack.application.OpenAiServiceUpgradeIT method: testOpenAiEmbeddings {upgradedNodes=1} issue: https://github.com/elastic/elasticsearch/issues/118156 - class: org.elasticsearch.xpack.application.HuggingFaceServiceUpgradeIT method: testElser {upgradedNodes=1} issue: https://github.com/elastic/elasticsearch/issues/118127 - class: org.elasticsearch.xpack.application.OpenAiServiceUpgradeIT method: testOpenAiCompletions {upgradedNodes=1} issue: https://github.com/elastic/elasticsearch/issues/118162 - class: org.elasticsearch.xpack.application.OpenAiServiceUpgradeIT method: testOpenAiCompletions {upgradedNodes=2} issue: https://github.com/elastic/elasticsearch/issues/118163 - class: org.elasticsearch.xpack.application.OpenAiServiceUpgradeIT method: testOpenAiEmbeddings {upgradedNodes=2} issue: https://github.com/elastic/elasticsearch/issues/118204 - class: org.elasticsearch.xpack.application.HuggingFaceServiceUpgradeIT method: testHFEmbeddings {upgradedNodes=1} issue: https://github.com/elastic/elasticsearch/issues/118197 ```</MESSAGE>
      <SHA>db0d6cebaf0548d686b90fc74a0516aa4cd40f6e</SHA>
      <PATCHEDFILES>
        <FILE>muted-tests.yml</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>[Inference API] Unmute upgrade test (#118666) https://github.com/elastic/elasticsearch/pull/118664 ``` - class: org.elasticsearch.xpack.application.CohereServiceUpgradeIT method: testRerank {upgradedNodes=1} issue: https://github.com/elastic/elasticsearch/issues/116973 - class: org.elasticsearch.xpack.application.CohereServiceUpgradeIT method: testCohereEmbeddings {upgradedNodes=1} issue: https://github.com/elastic/elasticsearch/issues/116974 - class: org.elasticsearch.xpack.application.CohereServiceUpgradeIT method: testCohereEmbeddings {upgradedNodes=2} issue: https://github.com/elastic/elasticsearch/issues/116975 - class: org.elasticsearch.xpack.application.OpenAiServiceUpgradeIT method: testOpenAiEmbeddings {upgradedNodes=1} issue: https://github.com/elastic/elasticsearch/issues/118156 - class: org.elasticsearch.xpack.application.HuggingFaceServiceUpgradeIT method: testElser {upgradedNodes=1} issue: https://github.com/elastic/elasticsearch/issues/118127 - class: org.elasticsearch.xpack.application.OpenAiServiceUpgradeIT method: testOpenAiCompletions {upgradedNodes=1} issue: https://github.com/elastic/elasticsearch/issues/118162 - class: org.elasticsearch.xpack.application.OpenAiServiceUpgradeIT method: testOpenAiCompletions {upgradedNodes=2} issue: https://github.com/elastic/elasticsearch/issues/118163 - class: org.elasticsearch.xpack.application.OpenAiServiceUpgradeIT method: testOpenAiEmbeddings {upgradedNodes=2} issue: https://github.com/elastic/elasticsearch/issues/118204 - class: org.elasticsearch.xpack.application.HuggingFaceServiceUpgradeIT method: testHFEmbeddings {upgradedNodes=1} issue: https://github.com/elastic/elasticsearch/issues/118197 ```</MESSAGE>
      <SHA>35e9165fc3317a3a5b5bfa5ce5df63c9ba1472d8</SHA>
      <PATCHEDFILES>
        <FILE>muted-tests.yml</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
