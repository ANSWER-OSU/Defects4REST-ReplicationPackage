<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>122917</ISSUENO>
  <ISSUEURL>https://github.com/elastic/elasticsearch/issues/122917</ISSUEURL>
  <TITLE>Batch ILM policy cluster state updates</TITLE>
  <DESCRIPTION>Today, ILM policy cluster state updates are not batched: https://github.com/elastic/elasticsearch/blob/5160113880d5eb619706edf8671131319ac9beb2/x-pack/plugin/ilm/src/main/java/org/elasticsearch/xpack/ilm/action/TransportPutLifecycleAction.java#L122-L125 Batching these cluster state updates will reduce the number of cluster state updates the cluster needs to process. This is especially relevant in tests as the `IndexTemplateRegistry` adds dozens of ILM policies, each resulting in a dedicated cluster state update. This noticeably slows down cluster startup times.</DESCRIPTION>
  <REPONAME>elasticsearch</REPONAME>
  <TIMEDIFFERENCEDAYS>49</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Remove time unit from rate aggregation (#126497) Currently, the rate aggregation accepts two parameters: the first specifies the counter field, and the second specifies the time unit of the rate. The time unit parameter was introduced to conveniently compute requests per minute or per hour. However, this can be replaced easily - for example, rate(field, 1minute) with 60 * rate(field). This change removes the time unit parameter and reserves it for potential future usage, such as introducing a sliding window unit. If we decide on other options later, we can reintroduce it. Removing it now avoids breaking changes while the rate aggregation is not yet available.</MESSAGE>
    <SHA>7c77ead2099516248744a1529861b12f4d475a2b</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Batch ILM policy cluster state updates [#122917] (#126529) * Use a task queue to ensure ILM policy change cluster state updates are batched * Update docs/changelog/126529.yaml * Update docs/changelog/126529.yaml * Switch to using SimpleBatchedAckListenerTaskExecutor * Get timeout from request * Ditch the try-catch</MESSAGE>
      <SHA>7d7fa766c52c31aeda809ace5d7c6a4cff4e9f9e</SHA>
      <PATCHEDFILES>
        <FILE>docs/changelog/126529.yaml</FILE>
        <FILE>x-pack/plugin/ilm/src/main/java/org/elasticsearch/xpack/ilm/action/TransportPutLifecycleAction.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Batch ILM policy cluster state updates [#122917] (#126529) (#126587) * Use a task queue to ensure ILM policy change cluster state updates are batched * Update docs/changelog/126529.yaml * Update docs/changelog/126529.yaml * Switch to using SimpleBatchedAckListenerTaskExecutor * Get timeout from request * Ditch the try-catch (cherry picked from commit 7d7fa766c52c31aeda809ace5d7c6a4cff4e9f9e) # Conflicts: # x-pack/plugin/ilm/src/main/java/org/elasticsearch/xpack/ilm/action/TransportPutLifecycleAction.java</MESSAGE>
      <SHA>4b8e2165d201c0028fd3462b82e004131ab2a401</SHA>
      <PATCHEDFILES>
        <FILE>docs/changelog/126529.yaml</FILE>
        <FILE>x-pack/plugin/ilm/src/main/java/org/elasticsearch/xpack/ilm/action/TransportPutLifecycleAction.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
