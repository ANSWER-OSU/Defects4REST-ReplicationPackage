<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>118213</ISSUENO>
  <ISSUEURL>https://github.com/elastic/elasticsearch/issues/118213</ISSUEURL>
  <TITLE>[CI] EsqlActionTaskIT testCancelRequestWhenFailingFetchingPages failing</TITLE>
  <DESCRIPTION>**Build Scans:** - [elasticsearch-periodic #5297 / openjdk21_checkpart3_java-matrix](https://gradle-enterprise.elastic.co/s/4ljtybidq76fm) - [elasticsearch-periodic #5297 / openjdk22_checkpart3_java-matrix](https://gradle-enterprise.elastic.co/s/yy7xedmcvyogm) - [elasticsearch-intake #14096 / part3](https://gradle-enterprise.elastic.co/s/ebjtoykkg2rii) - [elasticsearch-periodic #5291 / openjdk21_checkpart3_java-matrix](https://gradle-enterprise.elastic.co/s/wnqdjazxnykqe) - [elasticsearch-periodic #5291 / openjdk22_checkpart3_java-matrix](https://gradle-enterprise.elastic.co/s/4xtwlqsmbbgmc) - [elasticsearch-periodic-platform-support #5264 / sles-15_platform-support-unix](https://gradle-enterprise.elastic.co/s/ind5jzy7a7ozg) - [elasticsearch-periodic #5285 / openjdk22_checkpart3_java-matrix](https://gradle-enterprise.elastic.co/s/yy6pagbl72zg6) - [elasticsearch-periodic #5273 / openjdk21_checkpart3_java-matrix](https://gradle-enterprise.elastic.co/s/zq22up3znvbyc) - [elasticsearch-periodic-platform-support #5246 / ubuntu-2004_platform-support-unix](https://gradle-enterprise.elastic.co/s/jgqx3disrwfza) - [elasticsearch-periodic #5267 / openjdk23_checkpart3_java-matrix](https://gradle-enterprise.elastic.co/s/4t4ryekna5ubk) **Reproduction Line:** ``` ./gradlew &quot;:x-pack:plugin:esql:internalClusterTest&quot; --tests &quot;org.elasticsearch.xpack.esql.action.EsqlActionTaskIT.testCancelRequestWhenFailingFetchingPages&quot; -Dtests.seed=A29B6F175EB234CA -Dtests.locale=jmc-TZ -Dtests.timezone=America/Cayenne -Druntime.java=21 ``` **Applicable branches:** 8.x **Reproduces locally?:** N/A **Failure History:** [See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&amp;_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.esql.action.EsqlActionTaskIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(testCancelRequestWhenFailingFetchingPages),title:'Test',type:optionsListControl))))) **Failure Message:** ``` java.lang.AssertionError: Expected: a string containing &quot;failed to fetch pages&quot; but: was &quot;Failed execution&quot; ``` **Issue Reasons:** - [8.x] 2 consecutive failures in step openjdk21_checkpart3_java-matrix - [8.x] 3 consecutive failures in step openjdk22_checkpart3_java-matrix - [8.x] 12 failures in test testCancelRequestWhenFailingFetchingPages (5.4% fail rate in 224 executions) - [8.x] 3 failures in step openjdk21_checkpart3_java-matrix (42.9% fail rate in 7 executions) - [8.x] 3 failures in step openjdk22_checkpart3_java-matrix (42.9% fail rate in 7 executions) - [8.x] 6 failures in pipeline elasticsearch-periodic (75.0% fail rate in 8 executions) - [8.x] 3 failures in pipeline elasticsearch-periodic-platform-support (37.5% fail rate in 8 executions) **Note:** This issue was created using new test triage automation. Please report issues or feedback to es-delivery.</DESCRIPTION>
  <REPONAME>elasticsearch</REPONAME>
  <TIMEDIFFERENCEDAYS>58</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>[TEST] Wait for no pending operations on the index shard (#118244) (#118258) This fixes testRetryPointInTime which on teardown is looking to assert that the operations in the translog and in the lucene index are the same. Previously we didn't wait for the translog operations to be applied. This changes `assertConsistentHistoryInLuceneIndex` to wait for the pending operations in the translog to be applied. Fixes #117116 (cherry picked from commit b4e852a54be436d8b8036da0a0ec4a472d44524a) Signed-off-by: Andrei Dan &lt;andrei.dan@elastic.co&gt;</MESSAGE>
    <SHA>1e62d47a142b6fafb24b08a19ab203286baf4b58</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Mute org.elasticsearch.xpack.esql.action.EsqlActionTaskIT testCancelRequestWhenFailingFetchingPages #118213</MESSAGE>
      <SHA>1b303fcc6de7d1d19417368be2b402f4bb507bea</SHA>
      <PATCHEDFILES>
        <FILE>muted-tests.yml</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
