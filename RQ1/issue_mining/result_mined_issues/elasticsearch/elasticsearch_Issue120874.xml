<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>120874</ISSUENO>
  <ISSUEURL>https://github.com/elastic/elasticsearch/issues/120874</ISSUEURL>
  <TITLE>Remove validations that prevents the use of nested field type with index.mode=time_series</TITLE>
  <DESCRIPTION>As part of the development of logsdb index sorting with nested field type was supported. Before Lucene's index sorting didn't support this. Additionally synthetic source now natively supports nested field type. With these limitations being fixed, tsdb/tsds can now also support the nested field type. This validation that prevents this can be removed. Relates to elastic/integrations#6604</DESCRIPTION>
  <REPONAME>elasticsearch</REPONAME>
  <TIMEDIFFERENCEDAYS>17</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Remove Countable interface and dry up ShardsIterator (#121923) The size method is needed only in SearchShardIterator and PlainIterator. An interface is not really needed, we can just rather add the size method where needed. Also, there's a couple of methods in the ShardsIterator interface that are not needed that this commit removes: size, reset and remaining.</MESSAGE>
    <SHA>6a57b70f16756b5369a5906f34eded51fd4eb9b6</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Enable the use of nested field type with index.mode=time_series (#122224) This patch removes the check that fails requests that attempt to use fields of type: nested within indices with mode time_series. This patch also updates TimeSeriesIdFieldMapper#postParse to set the _id field on child documents once it's calculated. Closes #120874</MESSAGE>
      <SHA>53150881e92b23ef92107de76f8564bb20f6d242</SHA>
      <PATCHEDFILES>
        <FILE>docs/changelog/122224.yaml</FILE>
        <FILE>rest-api-spec/build.gradle</FILE>
        <FILE>rest-api-spec/src/yamlRestTest/resources/rest-api-spec/test/tsdb/160_nested_fields.yml</FILE>
        <FILE>rest-api-spec/src/yamlRestTest/resources/rest-api-spec/test/tsdb/20_mapping.yml</FILE>
        <FILE>server/src/main/java/org/elasticsearch/index/IndexMode.java</FILE>
        <FILE>server/src/main/java/org/elasticsearch/index/mapper/DocumentParserContext.java</FILE>
        <FILE>server/src/main/java/org/elasticsearch/index/mapper/MapperFeatures.java</FILE>
        <FILE>server/src/main/java/org/elasticsearch/index/mapper/TimeSeriesIdFieldMapper.java</FILE>
        <FILE>server/src/main/java/org/elasticsearch/index/mapper/TsidExtractingIdFieldMapper.java</FILE>
        <FILE>x-pack/plugin/inference/src/test/java/org/elasticsearch/xpack/inference/mapper/SemanticTextFieldMapperTests.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Enable the use of nested field type with index.mode=time_series (#122224) (#122520) This patch removes the check that fails requests that attempt to use fields of type: nested within indices with mode time_series. This patch also updates TimeSeriesIdFieldMapper#postParse to set the _id field on child documents once it's calculated. Closes #120874 (cherry picked from commit 53150881e92b23ef92107de76f8564bb20f6d242) # Conflicts: # rest-api-spec/build.gradle</MESSAGE>
      <SHA>ae13c6119e404cda4a3377876b4068e2e745511c</SHA>
      <PATCHEDFILES>
        <FILE>docs/changelog/122224.yaml</FILE>
        <FILE>rest-api-spec/build.gradle</FILE>
        <FILE>rest-api-spec/src/yamlRestTest/resources/rest-api-spec/test/tsdb/160_nested_fields.yml</FILE>
        <FILE>rest-api-spec/src/yamlRestTest/resources/rest-api-spec/test/tsdb/20_mapping.yml</FILE>
        <FILE>server/src/main/java/org/elasticsearch/index/IndexMode.java</FILE>
        <FILE>server/src/main/java/org/elasticsearch/index/mapper/DocumentParserContext.java</FILE>
        <FILE>server/src/main/java/org/elasticsearch/index/mapper/MapperFeatures.java</FILE>
        <FILE>server/src/main/java/org/elasticsearch/index/mapper/TimeSeriesIdFieldMapper.java</FILE>
        <FILE>server/src/main/java/org/elasticsearch/index/mapper/TsidExtractingIdFieldMapper.java</FILE>
        <FILE>x-pack/plugin/inference/src/test/java/org/elasticsearch/xpack/inference/mapper/SemanticTextFieldMapperTests.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
