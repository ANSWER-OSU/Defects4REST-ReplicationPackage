<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>123769</ISSUENO>
  <ISSUEURL>https://github.com/elastic/elasticsearch/issues/123769</ISSUEURL>
  <TITLE>[CI] DataStreamLifecycleDownsampleDisruptionIT testDataStreamLifecycleDownsampleRollingRestart failing</TITLE>
  <DESCRIPTION>**Build Scans:** - [elasticsearch-periodic-platform-support #7350 / windows-2022_checkpart2_platform-support-windows](https://gradle-enterprise.elastic.co/s/quxhqujzsutre) - [elasticsearch-periodic-platform-support #7350 / ubuntu-2404-aarch64_checkpart2_platform-support-arm](https://gradle-enterprise.elastic.co/s/tq4a6uw2frlfq) - [elasticsearch-pull-request #65324 / part-2](https://gradle-enterprise.elastic.co/s/oqfxbk6wzemds) **Reproduction Line:** ``` gradlew &quot;:x-pack:plugin:downsample:internalClusterTest&quot; --tests &quot;org.elasticsearch.xpack.downsample.DataStreamLifecycleDownsampleDisruptionIT.testDataStreamLifecycleDownsampleRollingRestart&quot; -Dtests.seed=EA337873B547979F -Dtests.locale=bs-BA -Dtests.timezone=US/Alaska -Druntime.java=24 ``` **Applicable branches:** main **Reproduces locally?:** N/A **Failure History:** [See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&amp;_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.downsample.DataStreamLifecycleDownsampleDisruptionIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(testDataStreamLifecycleDownsampleRollingRestart),title:'Test',type:optionsListControl))))) **Failure Message:** ``` java.lang.AssertionError: safeGet: listener was completed exceptionally ``` **Issue Reasons:** - [main] 2 consecutive failures in test testDataStreamLifecycleDownsampleRollingRestart - [main] 3 failures in test testDataStreamLifecycleDownsampleRollingRestart (1.7% fail rate in 177 executions) **Note:** This issue was created using new test triage automation. Please report issues or feedback to es-delivery.</DESCRIPTION>
  <REPONAME>elasticsearch</REPONAME>
  <TIMEDIFFERENCEDAYS>44</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Report outcome of data node's shard snapshot master update (#123652) Improves the information in the IndexShardSnapshotStatus's statusDescription field to include the success/failure of the remote call to the master node to update the shard snapshot state. This allows us to see if there is a discrepancy between the state of the data node and the master node. Closes ES-10991</MESSAGE>
    <SHA>ba5a9c83310ce6fbe27ff251aba00e37fad1d205</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Mute org.elasticsearch.xpack.downsample.DataStreamLifecycleDownsampleDisruptionIT testDataStreamLifecycleDownsampleRollingRestart #123769</MESSAGE>
      <SHA>71ca4ca7d55dbb1bcd6d569e6293b41b2e7729cb</SHA>
      <PATCHEDFILES>
        <FILE>muted-tests.yml</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Effort to fix `testDataStreamLifecycleDownsampleRollingRestart` #123769 (#125478)</MESSAGE>
      <SHA>1943844d5aff294d286f70392b519b7332af7f7a</SHA>
      <PATCHEDFILES>
        <FILE>muted-tests.yml</FILE>
        <FILE>test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java</FILE>
        <FILE>x-pack/plugin/downsample/src/internalClusterTest/java/org/elasticsearch/xpack/downsample/DataStreamLifecycleDownsampleDisruptionIT.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Effort to fix `testDataStreamLifecycleDownsampleRollingRestart` #123769 (#125478) (cherry picked from commit 1943844d5aff294d286f70392b519b7332af7f7a) # Conflicts: # muted-tests.yml # x-pack/plugin/downsample/src/internalClusterTest/java/org/elasticsearch/xpack/downsample/DataStreamLifecycleDownsampleDisruptionIT.java</MESSAGE>
      <SHA>1bfb88c1f7a1a1c0c0a56a7f49fb10b1a6822e89</SHA>
      <PATCHEDFILES>
        <FILE>test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java</FILE>
        <FILE>x-pack/plugin/downsample/src/internalClusterTest/java/org/elasticsearch/xpack/downsample/DataStreamLifecycleDownsampleDisruptionIT.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Effort to fix `testDataStreamLifecycleDownsampleRollingRestart` #123769 (#125478) (#125845) (cherry picked from commit 1943844d5aff294d286f70392b519b7332af7f7a) # Conflicts: # muted-tests.yml # x-pack/plugin/downsample/src/internalClusterTest/java/org/elasticsearch/xpack/downsample/DataStreamLifecycleDownsampleDisruptionIT.java</MESSAGE>
      <SHA>12157be3d6c53e0ddc277368a28ad8fe76960986</SHA>
      <PATCHEDFILES>
        <FILE>test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java</FILE>
        <FILE>x-pack/plugin/downsample/src/internalClusterTest/java/org/elasticsearch/xpack/downsample/DataStreamLifecycleDownsampleDisruptionIT.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Effort to fix `testDataStreamLifecycleDownsampleRollingRestart` #123769 (#125478)</MESSAGE>
      <SHA>c7fcbe77bbf99c91002c0d93965a8a1dc0906794</SHA>
      <PATCHEDFILES>
        <FILE>test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java</FILE>
        <FILE>x-pack/plugin/downsample/src/internalClusterTest/java/org/elasticsearch/xpack/downsample/DataStreamLifecycleDownsampleDisruptionIT.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
