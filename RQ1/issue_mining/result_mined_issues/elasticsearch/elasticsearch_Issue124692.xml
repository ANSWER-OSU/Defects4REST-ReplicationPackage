<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>124692</ISSUENO>
  <ISSUEURL>https://github.com/elastic/elasticsearch/issues/124692</ISSUEURL>
  <TITLE>[CI] ExponentiallyWeightedMovingRateTests testEwmr_threadSafe failing</TITLE>
  <DESCRIPTION>**Build Scans:** - [elasticsearch-periodic-platform-support #6993 / almalinux-9_platform-support-unix](https://gradle-enterprise.elastic.co/s/fz7wro3vcla3m) - [elasticsearch-pull-request #62317 / part-1](https://gradle-enterprise.elastic.co/s/5fdkndahorvn6) - [elasticsearch-periodic-platform-support #6986 / almalinux-8-aarch64_checkpart1_platform-support-arm](https://gradle-enterprise.elastic.co/s/ywgog4iphm4cq) - [elasticsearch-periodic-platform-support #6966 / ubuntu-2004-aarch64_checkpart1_platform-support-arm](https://gradle-enterprise.elastic.co/s/ible4epcbhrwg) **Reproduction Line:** ``` ./gradlew &quot;:server:test&quot; --tests &quot;org.elasticsearch.common.metrics.ExponentiallyWeightedMovingRateTests.testEwmr_threadSafe&quot; -Dtests.seed=A1D9D6C0CD0FC7B2 -Dtests.locale=en-VU -Dtests.timezone=US/Pacific -Druntime.java=23 ``` **Applicable branches:** main **Reproduces locally?:** N/A **Failure History:** [See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&amp;_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.common.metrics.ExponentiallyWeightedMovingRateTests),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(testEwmr_threadSafe),title:'Test',type:optionsListControl))))) **Failure Message:** ``` java.lang.AssertionError: Expected: a numeric value within &lt;1.0E-13&gt; of &lt;5.056759216300853&gt; but: &lt;5.056759216300751&gt; differed by &lt;2.1405182655143987E-15&gt; more than delta &lt;1.0E-13&gt; ``` **Issue Reasons:** - [main] 4 failures in test testEwmr_threadSafe (1.7% fail rate in 235 executions) - [main] 3 failures in pipeline elasticsearch-periodic-platform-support (60.0% fail rate in 5 executions) **Note:** This issue was created using new test triage automation. Please report issues or feedback to es-delivery.</DESCRIPTION>
  <REPONAME>elasticsearch</REPONAME>
  <TIMEDIFFERENCEDAYS>14</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>ESQL autogenerate docs v3 (#124312) Building on the work started in https://github.com/elastic/elasticsearch/pull/123904, we now want to auto-generate most of the small subfiles from the ES|QL functions unit tests. This work also investigates any remaining discrepancies between the original asciidoc version and the new markdown, and tries to minimize differences so the docs do not look too different. The kibana json and markdown files are moved to a new location, and the operator docs are a little more generated than before (although still largely manual).</MESSAGE>
    <SHA>d5ddb909a4d45900152ce9f6a84a4390a4eeec26</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Mute org.elasticsearch.common.metrics.ExponentiallyWeightedMovingRateTests testEwmr_threadSafe #124692</MESSAGE>
      <SHA>73f0693c2aaee0f496c0d4e05a868cd936622245</SHA>
      <PATCHEDFILES>
        <FILE>muted-tests.yml</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Mute org.elasticsearch.common.metrics.ExponentiallyWeightedMovingRateTests testEwmr_threadSafe #124692</MESSAGE>
      <SHA>94183ad428f96061cb477b6fba87895ad4faaa33</SHA>
      <PATCHEDFILES>
        <FILE>muted-tests.yml</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Tweak tolerance in EWMR tests We have seen occasional failures with the existing tolerance, in `testEwmr_threadSafe` which contains some randomness. We were asserting the result of a lot of f.p. operations with a tolerance of 1.0e-13. The highest error I saw in any of the reported failures was 1.2e-13. This PR increases the tolerance to 2.0e-13 which should allow all those to pass. Fixes #124692</MESSAGE>
      <SHA>6d73413eb9e00a48375b7b008189df6d4c36696f</SHA>
      <PATCHEDFILES>
        <FILE>muted-tests.yml</FILE>
        <FILE>server/src/test/java/org/elasticsearch/common/metrics/ExponentiallyWeightedMovingRateTests.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Tweak tolerance in EWMR tests We have seen occasional failures with the existing tolerance, in `testEwmr_threadSafe` which contains some randomness. We were asserting the result of a lot of f.p. operations with a tolerance of 1.0e-13. The highest error I saw in any of the reported failures was 1.2e-13. This PR increases the tolerance to 2.0e-13 which should allow all those to pass. Fixes #124692</MESSAGE>
      <SHA>c663b820c8cc33dbde08bcbde7e3a03cf15237a9</SHA>
      <PATCHEDFILES>
        <FILE>muted-tests.yml</FILE>
        <FILE>server/src/test/java/org/elasticsearch/common/metrics/ExponentiallyWeightedMovingRateTests.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Tweak tolerance in EWMR tests (#125773) We have seen occasional failures with the existing tolerance, in `testEwmr_threadSafe` which contains some randomness. We were asserting the result of a lot of f.p. operations with a tolerance of 1.0e-13. The highest error I saw in any of the reported failures was less than 1.2e-13. This PR increases the tolerance to 2.0e-13 which should allow all those to pass. Fixes #124692</MESSAGE>
      <SHA>4fa41062a6b3008ce994131e66785609d94ebbdf</SHA>
      <PATCHEDFILES>
        <FILE>muted-tests.yml</FILE>
        <FILE>server/src/test/java/org/elasticsearch/common/metrics/ExponentiallyWeightedMovingRateTests.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Tweak tolerance in EWMR tests (#125773) We have seen occasional failures with the existing tolerance, in `testEwmr_threadSafe` which contains some randomness. We were asserting the result of a lot of f.p. operations with a tolerance of 1.0e-13. The highest error I saw in any of the reported failures was less than 1.2e-13. This PR increases the tolerance to 2.0e-13 which should allow all those to pass. Fixes #124692</MESSAGE>
      <SHA>c108b7d1a1f1d6de6ac9e2f2d86372344e4d320e</SHA>
      <PATCHEDFILES>
        <FILE>muted-tests.yml</FILE>
        <FILE>server/src/test/java/org/elasticsearch/common/metrics/ExponentiallyWeightedMovingRateTests.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
