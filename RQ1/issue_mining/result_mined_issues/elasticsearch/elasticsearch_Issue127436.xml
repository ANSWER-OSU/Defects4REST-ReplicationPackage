<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>127436</ISSUENO>
  <ISSUEURL>https://github.com/elastic/elasticsearch/issues/127436</ISSUEURL>
  <TITLE>[CI] S3RepositoryAnalysisRestIT testRepositoryAnalysis failing</TITLE>
  <DESCRIPTION>**Build Scans:** - [elasticsearch-periodic #7868 / openjdk23_entitlements_false_checkpart2_java-matrix](https://gradle-enterprise.elastic.co/s/fz7dpehulj5me) - [elasticsearch-periodic #7868 / openjdk21_checkpart2_java-fips-matrix](https://gradle-enterprise.elastic.co/s/wkp3ohktva6zk) - [elasticsearch-periodic-platform-support #7883 / almalinux-8_platform-support-unix](https://gradle-enterprise.elastic.co/s/yahamggm2wx4w) - [elasticsearch-periodic-platform-support #7865 / oraclelinux-9_platform-support-unix](https://gradle-enterprise.elastic.co/s/pqxlwl3ef3fqm) - [elasticsearch-intake #22324 / part2](https://gradle-enterprise.elastic.co/s/6bxilprldti36) **Reproduction Line:** ``` ./gradlew &quot;:x-pack:plugin:snapshot-repo-test-kit:qa:s3:javaRestTest&quot; --tests &quot;org.elasticsearch.repositories.blobstore.testkit.analyze.S3RepositoryAnalysisRestIT.testRepositoryAnalysis&quot; -Dtests.seed=51167EC8B4949CB9 -Dtests.jvm.argline=&quot;-Des.entitlements.enabled=false&quot; -Dtests.locale=en-UM -Dtests.timezone=Africa/Cairo -Druntime.java=23 ``` **Applicable branches:** main **Reproduces locally?:** N/A **Failure History:** [See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&amp;_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.repositories.blobstore.testkit.analyze.S3RepositoryAnalysisRestIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(testRepositoryAnalysis),title:'Test',type:optionsListControl))))) **Failure Message:** ``` org.elasticsearch.client.ResponseException: method [POST], host [http://[::1]:44081], URI [/_snapshot/repository/_analyze?blob_count=10&amp;seed=-7758166901472037605&amp;max_blob_size=10mb&amp;timeout=120s&amp;concurrency=4], status line [HTTP/1.1 500 Internal Server Error] {&quot;error&quot;:{&quot;root_cause&quot;:[{&quot;type&quot;:&quot;repository_verification_exception&quot;,&quot;reason&quot;:&quot;[repository] failed to copy blob after write: [test-blob-4-uvouJIsDR_KGh-ZLU5xSOQ]&quot;}],&quot;type&quot;:&quot;repository_verification_exception&quot;,&quot;reason&quot;:&quot;[repository] Elasticsearch observed the storage system underneath this repository behaved incorrectly which indicates it is not suitable for use with Elasticsearch snapshots. Typically this happens when using storage other than AWS S3 which incorrectly claims to be S3-compatible. If so, please report this incompatibility to your storage supplier. Do not report Elasticsearch issues involving storage systems which claim to be S3-compatible unless you can demonstrate that the same issue exists when using a genuine AWS S3 [truncated] ``` **Issue Reasons:** - [main] 5 failures in test testRepositoryAnalysis (2.3% fail rate in 217 executions) - [main] 2 failures in pipeline elasticsearch-periodic-platform-support (40.0% fail rate in 5 executions) **Note:** This issue was created using new test triage automation. Please report issues or feedback to es-delivery.</DESCRIPTION>
  <REPONAME>elasticsearch</REPONAME>
  <TIMEDIFFERENCEDAYS>1</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Mute org.elasticsearch.xpack.esql.qa.single_node.PushQueriesIT testPushCaseInsensitiveEqualityOnDefaults #127431</MESSAGE>
    <SHA>8e3810c1eb319109bc083868ca20fd0f1232917e</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Mute org.elasticsearch.repositories.blobstore.testkit.analyze.S3RepositoryAnalysisRestIT testRepositoryAnalysis #127436</MESSAGE>
      <SHA>3057168ede201d2cf681dc4540cba213bea725fd</SHA>
      <PATCHEDFILES>
        <FILE>muted-tests.yml</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fix `UploadPartCopy` source handling The leading `/` on the `x-amz-copy-source` header is optional; SDKv1 includes it but SDKv2 does not. Today we handle its omission when handling a `CopyObject` request but we must do the same for the `UploadPartCopy` path. Closes #127436</MESSAGE>
      <SHA>7ea50effbf823ead8bf580668d3accd7992677ae</SHA>
      <PATCHEDFILES>
        <FILE>muted-tests.yml</FILE>
        <FILE>test/fixtures/s3-fixture/src/main/java/fixture/s3/S3HttpHandler.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fix `UploadPartCopy` source handling (#127442) The leading `/` on the `x-amz-copy-source` header is optional; SDKv1 includes it but SDKv2 does not. Today we handle its omission when handling a `CopyObject` request but we must do the same for the `UploadPartCopy` path. Closes #127436</MESSAGE>
      <SHA>9772b5e0056eb644cfd37aaf4645ace0c995d9ee</SHA>
      <PATCHEDFILES>
        <FILE>muted-tests.yml</FILE>
        <FILE>test/fixtures/s3-fixture/src/main/java/fixture/s3/S3HttpHandler.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Mute org.elasticsearch.repositories.blobstore.testkit.analyze.S3RepositoryAnalysisRestIT testRepositoryAnalysis #127436</MESSAGE>
      <SHA>8e85664214b059b5ec5fbd7dc4d215fadcd86650</SHA>
      <PATCHEDFILES>
        <FILE>muted-tests.yml</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fix `UploadPartCopy` source handling (#127442) The leading `/` on the `x-amz-copy-source` header is optional; SDKv1 includes it but SDKv2 does not. Today we handle its omission when handling a `CopyObject` request but we must do the same for the `UploadPartCopy` path. Closes #127436</MESSAGE>
      <SHA>ce4cfaaa943ab2d4e881004ab42d62af5f1272e3</SHA>
      <PATCHEDFILES>
        <FILE>muted-tests.yml</FILE>
        <FILE>test/fixtures/s3-fixture/src/main/java/fixture/s3/S3HttpHandler.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
