<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>119254</ISSUENO>
  <ISSUEURL>https://github.com/elastic/elasticsearch/issues/119254</ISSUEURL>
  <TITLE>[CI] MultiClusterSpecIT test {string.NotEqualsNullToUpperFolded} failing</TITLE>
  <DESCRIPTION>**Build Scans:** - [elasticsearch-periodic #5562 / 8.13.4_bwc](https://gradle-enterprise.elastic.co/s/mhplohwjrtvis) - [elasticsearch-periodic #5557 / 8.13.4_bwc](https://gradle-enterprise.elastic.co/s/tuxxh64lyfsku) - [elasticsearch-periodic #5552 / 8.13.4_bwc](https://gradle-enterprise.elastic.co/s/hljtrrydsmhai) - [elasticsearch-periodic #5547 / 8.13.4_bwc](https://gradle-enterprise.elastic.co/s/gsmsnyfwdrxao) - [elasticsearch-periodic #5542 / 8.13.4_bwc](https://gradle-enterprise.elastic.co/s/cthrbqvkwuzww) - [elasticsearch-periodic #5537 / 8.13.4_bwc](https://gradle-enterprise.elastic.co/s/s3ta4t4xpv7xk) - [elasticsearch-periodic #5532 / 8.13.4_bwc](https://gradle-enterprise.elastic.co/s/47ttwk23hqfyi) - [elasticsearch-periodic #5527 / 8.13.4_bwc](https://gradle-enterprise.elastic.co/s/rbkq2mcwth5qy) - [elasticsearch-periodic #5522 / 8.13.4_bwc](https://gradle-enterprise.elastic.co/s/rfrweywmsm252) **Reproduction Line:** ``` ./gradlew &quot;:x-pack:plugin:esql:qa:server:multi-clusters:v8.13.4#oldToNew&quot; -Dtests.class=&quot;org.elasticsearch.xpack.esql.ccq.MultiClusterSpecIT&quot; -Dtests.method=&quot;test {string.NotEqualsNullToUpperFolded}&quot; -Dtests.seed=C1C65AEC442D0E24 -Dtests.bwc=true -Dtests.locale=sr -Dtests.timezone=Africa/Asmara -Druntime.java=23 ``` **Applicable branches:** 8.x **Reproduces locally?:** N/A **Failure History:** [See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&amp;_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.esql.ccq.MultiClusterSpecIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(test%20%7Bstring.NotEqualsNullToUpperFolded%7D),title:'Test',type:optionsListControl))))) **Failure Message:** ``` org.elasticsearch.client.ResponseException: method [POST], host [http://[::1]:34279], URI [/_query?pretty=true&amp;error_trace=true], status line [HTTP/1.1 400 Bad Request] --- error: root_cause: - type: &quot;parsing_exception&quot; reason: &quot;line 2:37: token recognition error at: ':'&quot; stack_trace: &quot;org.elasticsearch.xpack.esql.parser.ParsingException: line 2:37:\ \ token recognition error at: ':'\n\tat org.elasticsearch.xpack.esql.parser.EsqlParser$1.syntaxError(EsqlParser.java:109)\n\ \tat org.antlr.v4.runtime.ProxyErrorListener.syntaxError(ProxyErrorListener.java:41)\n\ \tat org.antlr.v4.runtime.Lexer.notifyListeners(Lexer.java:364)\n\tat org.antlr.v4.runtime.Lexer.nextToken(Lexer.java:144)\n\ \tat org.elasticsearch.xpack.esql.parser.EsqlParser$ParametrizedTokenSource.nextToken(EsqlParser.java:135)\n\ \tat org.antlr.v4.runtime.BufferedTokenStream.fetch(BufferedTokenStream.java:169)\n\ \tat org.antlr.v4.runtime.BufferedTokenStream.sync(BufferedTokenStream.java:152)\n\ \tat org.antlr.v4.runtime.BufferedTokenStream.consume(BufferedTokenStream.java:136)\n\ \tat org.antlr.v4.runtime.atn.ParserATNSimulator.execATN(ParserATNSimulator.java:515)\n\ \tat org.antlr.v4.runtime.atn.ParserATNSimulator.adaptivePredict(ParserATNSimulator.java:371)\n\ \tat org.elasticsearch.xpack.esql.parser.EsqlBaseParser.booleanExpression(EsqlBaseParser.java:826)\n\ \tat org.elasticsearch.xpack.esql.parser.EsqlBaseParser.whereCommand(EsqlBaseParser.java:630)\n\ \tat org.elasticsearch.xpack.esql.parser.EsqlBaseParser.processingCommand(EsqlBaseParser.java:535)\n\ \tat org.elasticsearch.xpack.esql.parser.EsqlBaseParser.query(EsqlBaseParser.java:316)\n\ \tat org.elasticsearch.xpack.esql.parser.EsqlBaseParser.singleStatement(EsqlBaseParser.java:199)\n\ \tat org.elasticsearch.xpack.esql.parser.EsqlParser.invokeParser(EsqlParser.java:73)\n\ \tat org.elasticsearch.xpack.esql.parser.EsqlParser.createStatement(EsqlParser.java:45)\n\ \tat org.elasticsearch.xpack.esql.session.EsqlSession.parse(EsqlSession.java:136)\n\ \tat org.elasticsearch.xpack.esql.session.EsqlSession.execute(EsqlSession.java:118)\n\ \tat org.elasticsearch.xpack.esql.execution.PlanExecutor.esql(PlanExecutor.java:67)\n\ \tat org.elasticsearch.xpack.esql.plugin.TransportEsqlQueryAction.innerExecute(TransportEsqlQueryAction.java:160)\n\ \tat org.elasticsearch.xpack.esql.plugin.TransportEsqlQueryAction.doExecuteForked(TransportEsqlQueryAction.java:137)\n\ \tat org.elasticsearch.xpack.esql.plugin.TransportEsqlQueryAction.lambda$doExecute$0(TransportEsqlQueryAction.java:121)\n\ \tat org.elasticsearch.server@8.13.4/org.elasticsearch.action.ActionRunnable$4.doRun(ActionRunnable.java:95)\n\ \tat org.elasticsearch.server@8.13.4/org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:26)\n\ \tat org.elasticsearch.server@8.13.4/org.elasticsearch.common.util.concurrent.TimedRunnable.doRun(TimedRunnable.java:33)\n\ \tat org.elasticsearch.server@8.13.4/org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:984)\n\ \tat org.elasticsearch.server@8.13.4/org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:26)\n\ \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)\n\ \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)\n\ \tat java.base/java.lang.Thread.run(Thread.java:1583)\nCaused by: LexerNoViableAltException(':')\n\ \tat org.antlr.v4.runtime.atn.LexerATNSimulator.failOrAccept(LexerATNSimulator.java:309)\n\ \tat org.antlr.v4.runtime.atn.LexerATNSimulator.execATN(LexerATNSimulator.java:230)\n\ \tat org.antlr.v4.runtime.atn.LexerATNSimulator.match(LexerATNSimulator.java:114)\n\ \tat org.antlr.v4.runtime.Lexer.nextToken(Lexer.java:141)\n\t... 27 more\n&quot; type: &quot;parsing_exception&quot; reason: &quot;line 2:37: token recognition error at: ':'&quot; caused_by: type: &quot;lexer_no_viable_alt_exception&quot; reason: null stack_trace: &quot;LexerNoViableAltException(':')\n\tat org.antlr.v4.runtime.atn.LexerATNSimulator.failOrAccept(LexerATNSimulator.java:309)\n\ \tat org.antlr.v4.runtime.atn.LexerATNSimulator.execATN(LexerATNSimulator.java:230)\n\ \tat org.antlr.v4.runtime.atn.LexerATNSimulator.match(LexerATNSimulator.java:114)\n\ \tat org.antlr.v4.runtime.Lexer.nextToken(Lexer.java:141)\n\tat org.elasticsearch.xpack.esql.parser.EsqlParser$ParametrizedTokenSource.nextToken(EsqlParser.java:135)\n\ \tat org.antlr.v4.runtime.BufferedTokenStream.fetch(BufferedTokenStream.java:169)\n\ \tat org.antlr.v4.runtime.BufferedTokenStream.sync(BufferedTokenStream.java:152)\n\ \tat org.antlr.v4.runtime.BufferedTokenStream.consume(BufferedTokenStream.java:136)\n\ \tat org.antlr.v4.runtime.atn.ParserATNSimulator.execATN(ParserATNSimulator.java:515)\n\ \tat org.antlr.v4.runtime.atn.ParserATNSimulator.adaptivePredict(ParserATNSimulator.java:371)\n\ \tat org.elasticsearch.xpack.esql.parser.EsqlBaseParser.booleanExpression(EsqlBaseParser.java:826)\n\ \tat org.elasticsearch.xpack.esql.parser.EsqlBaseParser.whereCommand(EsqlBaseParser.java:630)\n\ \tat org.elasticsearch.xpack.esql.parser.EsqlBaseParser.processingCommand(EsqlBaseParser.java:535)\n\ \tat org.elasticsearch.xpack.esql.parser.EsqlBaseParser.query(EsqlBaseParser.java:316)\n\ \tat org.elasticsearch.xpack.esql.parser.EsqlBaseParser.singleStatement(EsqlBaseParser.java:199)\n\ \tat org.elasticsearch.xpack.esql.parser.EsqlParser.invokeParser(EsqlParser.java:73)\n\ \tat org.elasticsearch.xpack.esql.parser.EsqlParser.createStatement(EsqlParser.java:45)\n\ \tat org.elasticsearch.xpack.esql.session.EsqlSession.parse(EsqlSession.java:136)\n\ \tat org.elasticsearch.xpack.esql.session.EsqlSession.execute(EsqlSession.java:118)\n\ \tat org.elasticsearch.xpack.esql.execution.PlanExecutor.esql(PlanExecutor.java:67)\n\ \tat org.elasticsearch.xpack.esql.plugin.TransportEsqlQueryAction.innerExecute(TransportEsqlQueryAction.java:160)\n\ \tat org.elasticsearch.xpack.esql.plugin.TransportEsqlQueryAction.doExecuteForked(TransportEsqlQueryAction.java:137)\n\ \tat org.elasticsearch.xpack.esql.plugin.TransportEsqlQueryAction.lambda$doExecute$0(TransportEsqlQueryAction.java:121)\n\ \tat org.elasticsearch.server@8.13.4/org.elasticsearch.action.ActionRunnable$4.doRun(ActionRunnable.java:95)\n\ \tat org.elasticsearch.server@8.13.4/org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:26)\n\ \tat org.elasticsearch.server@8.13.4/org.elasticsearch.common.util.concurrent.TimedRunnable.doRun(TimedRunnable.java:33)\n\ \tat org.elasticsearch.server@8.13.4/org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:984)\n\ \tat org.elasticsearch.server@8.13.4/org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:26)\n\ \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)\n\ \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)\n\ \tat java.base/java.lang.Thread.run(Thread.java:1583)\n&quot; stack_trace: &quot;org.elasticsearch.xpack.esql.parser.ParsingException: line 2:37: token\ \ recognition error at: ':'\n\tat org.elasticsearch.xpack.esql.parser.EsqlParser$1.syntaxError(EsqlParser.java:109)\n\ \tat org.antlr.v4.runtime.ProxyErrorListener.syntaxError(ProxyErrorListener.java:41)\n\ \tat org.antlr.v4.runtime.Lexer.notifyListeners(Lexer.java:364)\n\tat org.antlr.v4.runtime.Lexer.nextToken(Lexer.java:144)\n\ \tat org.elasticsearch.xpack.esql.parser.EsqlParser$ParametrizedTokenSource.nextToken(EsqlParser.java:135)\n\ \tat org.antlr.v4.runtime.BufferedTokenStream.fetch(BufferedTokenStream.java:169)\n\ \tat org.antlr.v4.runtime.BufferedTokenStream.sync(BufferedTokenStream.java:152)\n\ \tat org.antlr.v4.runtime.BufferedTokenStream.consume(BufferedTokenStream.java:136)\n\ \tat org.antlr.v4.runtime.atn.ParserATNSimulator.execATN(ParserATNSimulator.java:515)\n\ \tat org.antlr.v4.runtime.atn.ParserATNSimulator.adaptivePredict(ParserATNSimulator.java:371)\n\ \tat org.elasticsearch.xpack.esql.parser.EsqlBaseParser.booleanExpression(EsqlBaseParser.java:826)\n\ \tat org.elasticsearch.xpack.esql.parser.EsqlBaseParser.whereCommand(EsqlBaseParser.java:630)\n\ \tat org.elasticsearch.xpack.esql.parser.EsqlBaseParser.processingCommand(EsqlBaseParser.java:535)\n\ \tat org.elasticsearch.xpack.esql.parser.EsqlBaseParser.query(EsqlBaseParser.java:316)\n\ \tat org.elasticsearch.xpack.esql.parser.EsqlBaseParser.singleStatement(EsqlBaseParser.java:199)\n\ \tat org.elasticsearch.xpack.esql.parser.EsqlParser.invokeParser(EsqlParser.java:73)\n\ \tat org.elasticsearch.xpack.esql.parser.EsqlParser.createStatement(EsqlParser.java:45)\n\ \tat org.elasticsearch.xpack.esql.session.EsqlSession.parse(EsqlSession.java:136)\n\ \tat org.elasticsearch.xpack.esql.session.EsqlSession.execute(EsqlSession.java:118)\n\ \tat org.elasticsearch.xpack.esql.execution.PlanExecutor.esql(PlanExecutor.java:67)\n\ \tat org.elasticsearch.xpack.esql.plugin.TransportEsqlQueryAction.innerExecute(TransportEsqlQueryAction.java:160)\n\ \tat org.elasticsearch.xpack.esql.plugin.TransportEsqlQueryAction.doExecuteForked(TransportEsqlQueryAction.java:137)\n\ \tat org.elasticsearch.xpack.esql.plugin.TransportEsqlQueryAction.lambda$doExecute$0(TransportEsqlQueryAction.java:121)\n\ \tat org.elasticsearch.server@8.13.4/org.elasticsearch.action.ActionRunnable$4.doRun(ActionRunnable.java:95)\n\ \tat org.elasticsearch.server@8.13.4/org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:26)\n\ \tat org.elasticsearch.server@8.13.4/org.elasticsearch.common.util.concurrent.TimedRunnable.doRun(TimedRunnable.java:33)\n\ \tat org.elasticsearch.server@8.13.4/org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:984)\n\ \tat org.elasticsearch.server@8.13.4/org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:26)\n\ \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)\n\ \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)\n\ \tat java.base/java.lang.Thread.run(Thread.java:1583)\nCaused by: LexerNoViableAltException(':')\n\ \tat org.antlr.v4.runtime.atn.LexerATNSimulator.failOrAccept(LexerATNSimulator.java:309)\n\ \tat org.antlr.v4.runtime.atn.LexerATNSimulator.execATN(LexerATNSimulator.java:230)\n\ \tat org.antlr.v4.runtime.atn.LexerATNSimulator.match(LexerATNSimulator.java:114)\n\ \tat org.antlr.v4.runtime.Lexer.nextToken(Lexer.java:141)\n\t... 27 more\n&quot; status: 400 ``` **Issue Reasons:** - [8.x] 9 failures in test test {string.NotEqualsNullToUpperFolded} (1.3% fail rate in 720 executions) - [8.x] 9 failures in step 8.13.4_bwc (100.0% fail rate in 9 executions) - [8.x] 9 failures in pipeline elasticsearch-periodic (100.0% fail rate in 9 executions) **Note:** This issue was created using new test triage automation. Please report issues or feedback to es-delivery.</DESCRIPTION>
  <REPONAME>elasticsearch</REPONAME>
  <TIMEDIFFERENCEDAYS>2</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Mute org.elasticsearch.search.fieldcaps.FieldCapabilitiesIT testRelocation #119280</MESSAGE>
    <SHA>0815f7a61ab0b42f7bc88b43186c0f6180aebe0a</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>ESQL: Fix MultiClusterSpecIT failing test using :: cast (#119263) Fixes https://github.com/elastic/elasticsearch/issues/119254 Fixes https://github.com/elastic/elasticsearch/issues/119255 The `x::&lt;type&gt;` cast syntax doesn't exist in older versions, so, if the test doesn't require a modern capability, it may fail. I'm fixing this in main instead of 8.x just to avoid future conflicts, and because the cast syntax has nothing to do with the test itself.</MESSAGE>
      <SHA>fff3868fd43be951f79e7a527366f9e44faa757b</SHA>
      <PATCHEDFILES>
        <FILE>x-pack/plugin/esql/qa/testFixtures/src/main/resources/string.csv-spec</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>ESQL: Fix MultiClusterSpecIT failing test using :: cast (#119263) Fixes https://github.com/elastic/elasticsearch/issues/119254 Fixes https://github.com/elastic/elasticsearch/issues/119255 The `x::&lt;type&gt;` cast syntax doesn't exist in older versions, so, if the test doesn't require a modern capability, it may fail. I'm fixing this in main instead of 8.x just to avoid future conflicts, and because the cast syntax has nothing to do with the test itself.</MESSAGE>
      <SHA>4aeae7c1f1a8bfaf1cb7f5cfadfa76d3894a5fbd</SHA>
      <PATCHEDFILES>
        <FILE>x-pack/plugin/esql/qa/testFixtures/src/main/resources/string.csv-spec</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>ESQL: Fix MultiClusterSpecIT failing test using :: cast (#119263) (#119282) Fixes https://github.com/elastic/elasticsearch/issues/119254 Fixes https://github.com/elastic/elasticsearch/issues/119255 The `x::&lt;type&gt;` cast syntax doesn't exist in older versions, so, if the test doesn't require a modern capability, it may fail. I'm fixing this in main instead of 8.x just to avoid future conflicts, and because the cast syntax has nothing to do with the test itself.</MESSAGE>
      <SHA>cdd35a8306d46eb73406797323090b920418c74a</SHA>
      <PATCHEDFILES>
        <FILE>x-pack/plugin/esql/qa/testFixtures/src/main/resources/string.csv-spec</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
