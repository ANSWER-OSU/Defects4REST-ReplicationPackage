<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>126174</ISSUENO>
  <ISSUEURL>https://github.com/elastic/elasticsearch/issues/126174</ISSUEURL>
  <TITLE>[CI] TsdbDocValueBwcTests testMixedIndex failing</TITLE>
  <DESCRIPTION>**Build Scans:** - [elasticsearch-periodic #7398 / openjdk23_entitlements_true_checkpart1_java-matrix](https://gradle-enterprise.elastic.co/s/5vrcd2tw3eoog) - [elasticsearch-periodic #7398 / openjdk21_checkpart1_java-fips-matrix](https://gradle-enterprise.elastic.co/s/3b4rcxpnpyq5m) - [elasticsearch-periodic #7398 / openjdk23_entitlements_false_checkpart1_java-matrix](https://gradle-enterprise.elastic.co/s/erqag5gdq57me) **Reproduction Line:** ``` ./gradlew &quot;:server:test&quot; --tests &quot;org.elasticsearch.index.codec.tsdb.TsdbDocValueBwcTests.testMixedIndex&quot; -Dtests.seed=3162DABFE3159420 -Dtests.jvm.argline=&quot;-Des.entitlements.enabled=true&quot; -Dtests.locale=hu-HU -Dtests.timezone=Africa/Bamako -Druntime.java=23 ``` **Applicable branches:** main **Reproduces locally?:** N/A **Failure History:** [See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&amp;_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.index.codec.tsdb.TsdbDocValueBwcTests),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(testMixedIndex),title:'Test',type:optionsListControl))))) **Failure Message:** ``` java.security.AccessControlException: access denied (&quot;java.lang.reflect.ReflectPermission&quot; &quot;suppressAccessChecks&quot;) ``` **Issue Reasons:** - [main] 3 consecutive failures in test testMixedIndex - [main] 3 failures in test testMixedIndex (3.6% fail rate in 84 executions) **Note:** This issue was created using new test triage automation. Please report issues or feedback to es-delivery.</DESCRIPTION>
  <REPONAME>elasticsearch</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Rename METRICS command to TS (#126064) - Rename METRICS to TS - Disable time-series tests in mixed clusters until the development stabilizes.</MESSAGE>
    <SHA>b563145129ce5a85428e388c3929c79ed0f59fd6</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fix TsdbDocValueBwcTests test failure. Don't perform version check assertion in TsdbDocValueBwcTests if security manager is active. By default, with jvm version 24 entitlements are used instead security manager and assertOldDocValuesFormatVersion() / assertNewDocValuesFormatVersion() work as expected. Making these methods work with security manager would require granting the server entire test codebase suppressAccessChecks and suppressAccessChecks privileges. This is undesired from a security manager perspective. Instead, only assert doc values format checks if security manager isn't active, which is always the case jvm version 24 or higher is used. Closes #126174</MESSAGE>
      <SHA>8451909353710da3efa94330ab2d068150322b35</SHA>
      <PATCHEDFILES>
        <FILE>server/src/test/java/org/elasticsearch/index/codec/tsdb/TsdbDocValueBwcTests.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fix TsdbDocValueBwcTests test failure. (#126182) Don't perform version check assertion in TsdbDocValueBwcTests if security manager is active. By default, with jvm version 24 entitlements are used instead security manager and assertOldDocValuesFormatVersion() / assertNewDocValuesFormatVersion() work as expected. Making these methods work with security manager would require granting the server entire test codebase suppressAccessChecks and suppressAccessChecks privileges. This is undesired from a security manager perspective. Instead, only assert doc values format checks if security manager isn't active, which is always the case jvm version 24 or higher is used. Closes #126174</MESSAGE>
      <SHA>717d00d96de34b1c44610436e1e8942cda14f59d</SHA>
      <PATCHEDFILES>
        <FILE>server/src/test/java/org/elasticsearch/index/codec/tsdb/TsdbDocValueBwcTests.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fix TsdbDocValueBwcTests test failure. (#126182) Don't perform version check assertion in TsdbDocValueBwcTests if security manager is active. By default, with jvm version 24 entitlements are used instead security manager and assertOldDocValuesFormatVersion() / assertNewDocValuesFormatVersion() work as expected. Making these methods work with security manager would require granting the server entire test codebase suppressAccessChecks and suppressAccessChecks privileges. This is undesired from a security manager perspective. Instead, only assert doc values format checks if security manager isn't active, which is always the case jvm version 24 or higher is used. Closes #126174</MESSAGE>
      <SHA>b47b7790f497cccf4fa12698b2348402324da78f</SHA>
      <PATCHEDFILES>
        <FILE>server/src/test/java/org/elasticsearch/index/codec/tsdb/TsdbDocValueBwcTests.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
