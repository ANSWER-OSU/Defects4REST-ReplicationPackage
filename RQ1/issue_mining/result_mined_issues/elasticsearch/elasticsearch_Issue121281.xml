<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>121281</ISSUENO>
  <ISSUEURL>https://github.com/elastic/elasticsearch/issues/121281</ISSUEURL>
  <TITLE>Wildcard and prefix queries use different analyzer when analyze_wildcard is enabled</TITLE>
  <DESCRIPTION>### Elasticsearch Version 8.15.4 ### Installed Plugins _No response_ ### Java Version _bundled_ ### OS Version official elasticsearch docker image ### Problem Description The general discussion and more detailed informations can be found on the elastic-search forum : https://discuss.elastic.co/t/query-string-with-wildcard-not-working-as-expected-or-wrong-understanging-of-analyze-wildcard/371910 The distilled variant (hopefully) is: When using a wildcard query together with analyze_wildcard enabled, the applied analyzers are not the same as having a prefix-query with analyze_wildcard enabled. While it is debatable how well those analyzers are actually working with partial words (in either of those cases), I would suggest we apply the same analyzer in both cases. So my suggestion would be to either downgrade the prefix-query to normalization only (as wildcard does), or turn it around and upgrade the wildcard query to what is applied on the prefix query. Personally, I would love to see the upgrade of wildcard, even if the results my be scary, it is an opt-in feature anyway, so if someone wants to use it, he is aware of the 'magic box' IMHO. ### Steps to Reproduce https://discuss.elastic.co/t/query-string-with-wildcard-not-working-as-expected-or-wrong-understanging-of-analyze-wildcard/371910 first comment ### Logs (if relevant) _No response_</DESCRIPTION>
  <REPONAME>elasticsearch</REPONAME>
  <TIMEDIFFERENCEDAYS>75</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>ESQL: Add description to status and profile (#121783) This adds a `task_description` field to `profile` output and task `status`. This looks like: ``` ... &quot;profile&quot; : { &quot;drivers&quot; : [ { &quot;task_description&quot; : &quot;final&quot;, &quot;start_millis&quot; : 1738768795349, &quot;stop_millis&quot; : 1738768795405, ... &quot;task_description&quot; : &quot;node_reduce&quot;, &quot;start_millis&quot; : 1738768795392, &quot;stop_millis&quot; : 1738768795406, ... &quot;task_description&quot; : &quot;data&quot;, &quot;start_millis&quot; : 1738768795391, &quot;stop_millis&quot; : 1738768795404, ... ``` Previously you had to look at the signature of the operators in the driver to figure out what the driver is *doing*. You had to know enough about how ESQL works to guess. Now you can look at this description to see what the server *thinks* it is doing. No more manual classification. This will be useful when debugging failures and performance regressions because it is much easier to use `jq` to group on it: ``` | jq '.profile[] | group_by(.task_description)[]' ```</MESSAGE>
    <SHA>77f8558d0ba4c6f5b7966b481eb4651b02d03647</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Clarify analyze_wildcard param in queries Clarify that analyze_wildcard param in query_string and simple_query_string queries behaves differently depending where &quot;*&quot; is. Closes #121281</MESSAGE>
      <SHA>2eb4e109cedf5380c38bd61240432efa9f1a8cce</SHA>
      <PATCHEDFILES>
        <FILE>docs/reference/query-dsl/query-string-query.asciidoc</FILE>
        <FILE>docs/reference/query-dsl/simple-query-string-query.asciidoc</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
