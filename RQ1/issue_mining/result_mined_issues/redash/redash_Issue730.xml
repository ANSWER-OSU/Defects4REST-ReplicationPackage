<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>730</ISSUENO>
  <ISSUEURL>https://github.com/getredash/redash/issues/730</ISSUEURL>
  <TITLE>Migration Error(0017_add_organization.py)</TITLE>
  <DESCRIPTION>Migration Error with current master branch. ``` $ vagrant@vagrant-ubuntu-trusty-64:/opt/redash/current$ export PYTHONPATH=. &amp;&amp; bin/run python migrations/0017_add_organization.py ``` ### output ``` [2016-01-05 09:38:42,746][PID:1822][WARNING][redash.query_runner] Oracle query runner enabled but not supported, not registering. Either disable or install missing dependencies. Traceback (most recent call last): File &quot;migrations/0017_add_organization.py&quot;, line 12, in &lt;module&gt; Organization.SETTING_GOOGLE_APPS_DOMAINS: settings.GOOGLE_APPS_DOMAIN File &quot;/usr/local/lib/python2.7/dist-packages/peewee.py&quot;, line 4001, in create inst.save(force_insert=True) File &quot;/opt/redash/current/redash/models.py&quot;, line 93, in save super(BaseModel, self).save(*args, **kwargs) File &quot;/usr/local/lib/python2.7/dist-packages/peewee.py&quot;, line 4148, in save pk_from_cursor = self.insert(**field_dict).execute() File &quot;/usr/local/lib/python2.7/dist-packages/peewee.py&quot;, line 2858, in execute cursor = self._execute() File &quot;/opt/redash/current/redash/metrics/database.py&quot;, line 50, in metered_execute result = real_execute(self, *args, **kwargs) File &quot;/usr/local/lib/python2.7/dist-packages/peewee.py&quot;, line 2370, in _execute sql, params = self.sql() File &quot;/usr/local/lib/python2.7/dist-packages/peewee.py&quot;, line 2832, in sql return self.compiler().generate_insert(self) File &quot;/usr/local/lib/python2.7/dist-packages/peewee.py&quot;, line 1733, in generate_insert return self.build_query(clauses, alias_map) File &quot;/usr/local/lib/python2.7/dist-packages/peewee.py&quot;, line 1542, in build_query return self.parse_node(Clause(*clauses), alias_map) File &quot;/usr/local/lib/python2.7/dist-packages/peewee.py&quot;, line 1503, in parse_node sql, params, unknown = self._parse(node, alias_map, conv) File &quot;/usr/local/lib/python2.7/dist-packages/peewee.py&quot;, line 1478, in _parse sql, params = self._parse_map[node_type](node, alias_map, conv) File &quot;/usr/local/lib/python2.7/dist-packages/peewee.py&quot;, line 1406, in _parse_clause node.nodes, alias_map, conv, node.glue) File &quot;/usr/local/lib/python2.7/dist-packages/peewee.py&quot;, line 1520, in parse_node_list node_sql, node_params = self.parse_node(node, alias_map, conv) File &quot;/usr/local/lib/python2.7/dist-packages/peewee.py&quot;, line 1503, in parse_node sql, params, unknown = self._parse(node, alias_map, conv) File &quot;/usr/local/lib/python2.7/dist-packages/peewee.py&quot;, line 1478, in _parse sql, params = self._parse_map[node_type](node, alias_map, conv) File &quot;/usr/local/lib/python2.7/dist-packages/peewee.py&quot;, line 1406, in _parse_clause node.nodes, alias_map, conv, node.glue) File &quot;/usr/local/lib/python2.7/dist-packages/peewee.py&quot;, line 1520, in parse_node_list node_sql, node_params = self.parse_node(node, alias_map, conv) File &quot;/usr/local/lib/python2.7/dist-packages/peewee.py&quot;, line 1503, in parse_node sql, params, unknown = self._parse(node, alias_map, conv) File &quot;/usr/local/lib/python2.7/dist-packages/peewee.py&quot;, line 1478, in _parse sql, params = self._parse_map[node_type](node, alias_map, conv) File &quot;/usr/local/lib/python2.7/dist-packages/peewee.py&quot;, line 1406, in _parse_clause node.nodes, alias_map, conv, node.glue) File &quot;/usr/local/lib/python2.7/dist-packages/peewee.py&quot;, line 1520, in parse_node_list node_sql, node_params = self.parse_node(node, alias_map, conv) File &quot;/usr/local/lib/python2.7/dist-packages/peewee.py&quot;, line 1503, in parse_node sql, params, unknown = self._parse(node, alias_map, conv) File &quot;/usr/local/lib/python2.7/dist-packages/peewee.py&quot;, line 1478, in _parse sql, params = self._parse_map[node_type](node, alias_map, conv) File &quot;/usr/local/lib/python2.7/dist-packages/peewee.py&quot;, line 1394, in _parse_param params = [node.conv(node.value)] File &quot;/opt/redash/current/redash/models.py&quot;, line 68, in db_value return json.dumps(value) File &quot;/usr/lib/python2.7/json/__init__.py&quot;, line 243, in dumps return _default_encoder.encode(obj) File &quot;/usr/lib/python2.7/json/encoder.py&quot;, line 207, in encode chunks = self.iterencode(o, _one_shot=True) File &quot;/usr/lib/python2.7/json/encoder.py&quot;, line 270, in iterencode return _iterencode(o, 0) File &quot;/usr/lib/python2.7/json/encoder.py&quot;, line 184, in default raise TypeError(repr(o) + &quot; is not JSON serializable&quot;) TypeError: set([]) is not JSON serializable ```</DESCRIPTION>
  <REPONAME>redash</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Change multi-org implementation: To avoid complications with how Google Auth works, when enabling organization multi-tenancy on a single instance, each organization becomes a &quot;sub folder&quot; instead of a sub-domain.</MESSAGE>
    <SHA>7c6b95e71dd0ba051a8a45cc123f122d8ddd94f9</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fix #730: migration failing when no Google Apps domain set</MESSAGE>
      <SHA>ab39ed2898297196ea45772efa528b7bd98ff370</SHA>
      <PATCHEDFILES>
        <FILE>migrations/0017_add_organization.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Merge pull request #732 from getredash/feature/permissions Fix #730: migration failing when no Google Apps domain set</MESSAGE>
      <SHA>9a31077a99fb2d6a4632c4344bd2da7494354c21</SHA>
      <PATCHEDFILES>
        <FILE>migrations/0017_add_organization.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
