<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>4099</ISSUENO>
  <ISSUEURL>https://github.com/getredash/redash/issues/4099</ISSUEURL>
  <TITLE>Dashboards list includes dashboards with text widgets where you have no access to any other widgets</TITLE>
  <DESCRIPTION>in this case, a use named A, he has not have any datasource access or view permission, while the dashboard have a text widget, the user A can find the dashboard which have text widget on dashboard lis page, the reason is than this python file: app/redash/model/__init__.py about the class Dashboard with that method : ```python @classmethod def all(cls, org, group_ids, user_id): query = ( Dashboard.query .options( subqueryload(Dashboard.user).load_only('_profile_image_url', 'name'), ) .outerjoin(Widget) .outerjoin(Visualization) .outerjoin(Query) .outerjoin(DataSourceGroup, Query.data_source_id == DataSourceGroup.data_source_id) .filter( Dashboard.is_archived == False, (DataSourceGroup.group_id.in_(group_ids) | (Dashboard.user_id == user_id) ((Widget.dashboard != None) &amp; (Widget.visualization == None))), Dashboard.org == org) .distinct()) query = query.filter(or_(Dashboard.user_id == user_id, Dashboard.is_draft == False)) return query ``` the query on Widget.visualization == None so will find all dashboard that have text widget * Redash Version: 6.0.7.0.8.0 * Browser/OS: chrome/ios * How did you install Redash: k8s</DESCRIPTION>
  <REPONAME>redash</REPONAME>
  <TIMEDIFFERENCEDAYS>124</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Render AuthHeader according to permissions.</MESSAGE>
    <SHA>968a3927dbcc67a0087327982973f17d03a73b05</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Don't return dashboards where you only have access to textbox widget. Closes #4099.</MESSAGE>
      <SHA>46dc77556cad3a996718f4672887db81ae719355</SHA>
      <PATCHEDFILES>
        <FILE>redash/models/__init__.py</FILE>
        <FILE>tests/test_models.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Refine permissions usage in Redash to allow for guest users (#4492) * Allow executing query with either view_query or execute_query permissions. * Render AuthHeader according to permissions. * Don't return dashboards where you only have access to textbox widget. Closes #4099.</MESSAGE>
      <SHA>30bc1e2ff6fe2fc588564cc1e32c83720a8c59d0</SHA>
      <PATCHEDFILES>
        <FILE>client/app/components/app-header/AppHeader.jsx</FILE>
        <FILE>client/app/services/auth.js</FILE>
        <FILE>redash/handlers/query_results.py</FILE>
        <FILE>redash/models/__init__.py</FILE>
        <FILE>redash/permissions.py</FILE>
        <FILE>tests/test_models.py</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
