<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>5885</ISSUENO>
  <ISSUEURL>https://github.com/getredash/redash/issues/5885</ISSUEURL>
  <TITLE>Redash Workers Becomes Inactive Automatically</TITLE>
  <DESCRIPTION>&lt;!-- We use GitHub only for bug reports Anything else should be posted to https://discuss.redash.io For support, help &amp; questions use https://discuss.redash.io/c/support For feature requests &amp; ideas use https://discuss.redash.io/c/feature-requests **Found a security vulnerability?** Please email security@redash.io to report any security vulnerabilities. We will acknowledge receipt of your vulnerability and strive to send you regular updates about our progress. If you're curious about the status of your disclosure please feel free to email us again. If you want to encrypt your disclosure email, you can use this PGP key. --&gt; ### Issue Summary Everyday we see `redash` workers become inactive/stale and they are unable to process queries. This has mostly happened for adhoc workers and sometimes for other workers too. We have to restart the workers everyday and then everything works fine again. This is very big pain. ### Steps to Reproduce No clear steps are there to reproduce But one scenario could be if when workers are about to start and connect to redis instance if they are unable to connect then worker health check fails and they never come into alive state. This is a bug because it requires manual restart always. ### Technical details: * Redash Version: redash/redash:10.1.0.b50633 * Browser/OS: GKE * How did you install Redash: Helm Charts ### Further Investigation This has been reported earlier as well with different title and problems https://github.com/getredash/contrib-helm-chart/issues/124 https://github.com/getredash/contrib-helm-chart/issues/72 https://github.com/getredash/redash/issues/5801 We should add a liveness probe to make restarts automatic when supervisord workers are dead.</DESCRIPTION>
  <REPONAME>redash</REPONAME>
  <TIMEDIFFERENCEDAYS>61</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Fix group not found message. (#5935)</MESSAGE>
    <SHA>35b2430ff9e4d1a71b201697360f0b763f062a8f</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Add liveness check script for workers closes #5885</MESSAGE>
      <SHA>5a86aff436cfec076217226dfe94b37377f91ede</SHA>
      <PATCHEDFILES>
        <FILE>bin/docker-entrypoint</FILE>
        <FILE>bin/worker_healthcheck.sh</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Add liveness check for workers (#5886) * Add liveness check script for workers closes #5885 * delete extra script * Rename worker_healthcheck -&gt; workers_healthcheck --------- Co-authored-by: Arik Fraimovich &lt;arik@arikfr.com&gt;</MESSAGE>
      <SHA>5b9fd40dc700c2fc14c31356aa551b09f7094d75</SHA>
      <PATCHEDFILES>
        <FILE>bin/docker-entrypoint</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Add liveness check for workers (#5886) * Add liveness check script for workers closes #5885 * delete extra script * Rename worker_healthcheck -&gt; workers_healthcheck --------- Co-authored-by: Arik Fraimovich &lt;arik@arikfr.com&gt;</MESSAGE>
      <SHA>ca45020584eab53ad05a0d5d85489949dbd90930</SHA>
      <PATCHEDFILES>
        <FILE>bin/docker-entrypoint</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Add liveness check for workers (#5886) * Add liveness check script for workers closes #5885 * delete extra script * Rename worker_healthcheck -&gt; workers_healthcheck --------- Co-authored-by: Arik Fraimovich &lt;arik@arikfr.com&gt;</MESSAGE>
      <SHA>6cd3dcb68e765f5db4d1a691400bfbbcc63ee36a</SHA>
      <PATCHEDFILES>
        <FILE>bin/docker-entrypoint</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
