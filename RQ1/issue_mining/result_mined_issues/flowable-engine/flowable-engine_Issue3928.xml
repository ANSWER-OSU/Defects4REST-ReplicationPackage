<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>3928</ISSUENO>
  <ISSUEURL>https://github.com/flowable/flowable-engine/issues/3928</ISSUEURL>
  <TITLE>Event subscription is missing after migration of an active embedded sub process</TITLE>
  <DESCRIPTION>**Describe the bug** When a process instance with an active embedded non interrupting event sub process is migrated, the subscription is missing. For a signal, message or event register event the event subscription is missing. For a timer event the timer job is missing. **Expected behavior** Event subscriptions and timer jobs should not be missing after migration of a process instance with an active embedded event sub process. **Code** I'll add a pull request with test cases and a fix. **Additional context** main branch flowable-release-6.8.1 branch flowable-release-7.1.0 branch flowable-release-7.2.0 branch</DESCRIPTION>
  <REPONAME>flowable-engine</REPONAME>
  <TIMEDIFFERENCEDAYS>41</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Fix failing mysql test</MESSAGE>
    <SHA>e7f6d91728a9604a1b9c168dc808eecb26220495</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fixed missing subscriptions after migration of an active non interrupting event sub process (#3928)</MESSAGE>
      <SHA>e6e9425790ec0b8edf683fba8aa1bb8ca677d0a6</SHA>
      <PATCHEDFILES>
        <FILE>modules/flowable-engine/src/main/java/org/flowable/engine/impl/dynamic/AbstractDynamicStateManager.java</FILE>
        <FILE>modules/flowable-engine/src/test/java/org/flowable/engine/test/api/runtime/migration/AbstractProcessInstanceMigrationEventRegistryConsumerTest.java</FILE>
        <FILE>modules/flowable-engine/src/test/java/org/flowable/engine/test/api/runtime/migration/ProcessInstanceMigrationEventRegistryEventSubprocessTest.java</FILE>
        <FILE>modules/flowable-engine/src/test/java/org/flowable/engine/test/api/runtime/migration/ProcessInstanceMigrationEventSubProcessTest.java</FILE>
        <FILE>modules/flowable-engine/src/test/resources/org/flowable/engine/test/api/runtime/migration/non-interrupting-eventregistry-event-subprocess.bpmn20.xml</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fixed missing subscriptions after migration of an active embedded non interrupting event sub process (#3928) (#3929) * Fixed missing subscriptions after migration of an active non interrupting event sub process (#3928) * Added missing package import * In case of a timer event, only process event sub process when no timer job is present * Added testcases and fix when migrating an event sub process with two started sub processes * Fixed imports</MESSAGE>
      <SHA>b89cad95cec974cd29942fe405772e527e5bca6b</SHA>
      <PATCHEDFILES>
        <FILE>modules/flowable-engine/src/main/java/org/flowable/engine/impl/dynamic/AbstractDynamicStateManager.java</FILE>
        <FILE>modules/flowable-engine/src/main/java/org/flowable/engine/impl/dynamic/MoveExecutionEntityContainer.java</FILE>
        <FILE>modules/flowable-engine/src/test/java/org/flowable/engine/test/api/runtime/migration/AbstractProcessInstanceMigrationEventRegistryConsumerTest.java</FILE>
        <FILE>modules/flowable-engine/src/test/java/org/flowable/engine/test/api/runtime/migration/ProcessInstanceMigrationEventRegistryEventSubprocessTest.java</FILE>
        <FILE>modules/flowable-engine/src/test/java/org/flowable/engine/test/api/runtime/migration/ProcessInstanceMigrationEventSubProcessTest.java</FILE>
        <FILE>modules/flowable-engine/src/test/resources/org/flowable/engine/test/api/runtime/migration/non-interrupting-eventregistry-event-subprocess.bpmn20.xml</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
