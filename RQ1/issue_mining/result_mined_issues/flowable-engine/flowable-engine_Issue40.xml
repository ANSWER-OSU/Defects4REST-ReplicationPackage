<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>40</ISSUENO>
  <ISSUEURL>https://github.com/flowable/flowable-engine/issues/40</ISSUEURL>
  <TITLE>HistoricActivityInstanceQuery search unfinished activities - always zero results</TITLE>
  <DESCRIPTION>Query for all unfinished Historyc Activity Instances using HistoricActivityInstanceQuery. **Actual result:** - always get zero result **Expected result:** - should return the entries that do NOT have an END_TIME (END_TIME is null) ``` HistoryService historyService = activitiRule.getHistoryService(); HistoricActivityInstanceQuery historicActivityInstanceQuery = historyService.createHistoricActivityInstanceQuery(); long finishedActivityInstanceCount = historicActivityInstanceQuery.finished().count(); assertEquals(&quot;The Start event is completed&quot;, 1, finishedActivityInstanceCount); //select count(RES.ID_) from ACT_HI_ACTINST RES WHERE RES.END_TIME_ is null and RES.END_TIME_ is not null long unfinishedActivityInstanceCount = historicActivityInstanceQuery.unfinished().count(); assertEquals(&quot;There is one active task&quot;, 1, unfinishedActivityInstanceCount); ``` The generated SQL query is: `select count(RES.ID_) from ACT_HI_ACTINST RES WHERE RES.END_TIME_ is null and RES.END_TIME_ is not null `</DESCRIPTION>
  <REPONAME>flowable-engine</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Flowable 6 properties updates for QA</MESSAGE>
    <SHA>80f7f799a39aa690226465054931b691c0b3f668</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>#40 HistoricActivityInstanceQuery search unfinished activities - always zero results</MESSAGE>
      <SHA>d333d9d19b44040b4654f4f14684dd8a2c61bf82</SHA>
      <PATCHEDFILES>
        <FILE>modules/flowable-engine/src/main/java/org/activiti/engine/impl/HistoricActivityInstanceQueryImpl.java</FILE>
        <FILE>modules/flowable-engine/src/test/java/org/activiti/engine/test/history/HistoricActivityInstanceTest.java</FILE>
        <FILE>modules/flowable-engine/src/test/resources/org/activiti/engine/test/history/HistoricActivityInstanceTest.testHistoricActivityInstanceUnfinished.bpmn20.xml</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>PR #40 + small changes</MESSAGE>
      <SHA>e1fa7763e14f853134e8ebb4ecb215e8d2d62a0c</SHA>
      <PATCHEDFILES>
        <FILE>modules/flowable-dmn-engine/src/main/java/org/activiti/dmn/engine/DmnEngines.java</FILE>
        <FILE>modules/flowable-dmn-engine/src/main/java/org/activiti/dmn/engine/impl/util/ReflectUtil.java</FILE>
        <FILE>modules/flowable-dmn-spring/src/main/java/org/activiti/dmn/spring/SpringDmnConfigurationHelper.java</FILE>
        <FILE>modules/flowable-engine/src/main/java/org/activiti/engine/impl/HistoricActivityInstanceQueryImpl.java</FILE>
        <FILE>modules/flowable-engine/src/main/java/org/activiti/engine/impl/db/DbSqlSession.java</FILE>
        <FILE>modules/flowable-engine/src/test/java/org/activiti/engine/test/history/HistoricActivityInstanceTest.java</FILE>
        <FILE>modules/flowable-form-engine/src/main/java/org/activiti/form/engine/FormEngines.java</FILE>
        <FILE>modules/flowable-form-engine/src/main/java/org/activiti/form/engine/impl/FormInstanceQueryImpl.java</FILE>
        <FILE>modules/flowable-form-engine/src/main/java/org/activiti/form/engine/impl/FormInstanceQueryProperty.java</FILE>
        <FILE>modules/flowable-form-engine/src/main/java/org/activiti/form/engine/impl/util/ReflectUtil.java</FILE>
        <FILE>modules/flowable-form-spring/src/main/java/org/activiti/form/spring/SpringFormConfigurationHelper.java</FILE>
        <FILE>modules/flowable-idm-engine/src/main/java/org/activiti/idm/engine/IdmEngines.java</FILE>
        <FILE>modules/flowable-idm-spring/src/main/java/org/activiti/idm/spring/SpringIdmConfigurationHelper.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Port PR #40 to 5 engine branch</MESSAGE>
      <SHA>788682e23619c5da6bb007a7a2c12851ae04f250</SHA>
      <PATCHEDFILES>
        <FILE>modules/flowable-engine/src/main/java/org/activiti/engine/impl/HistoricActivityInstanceQueryImpl.java</FILE>
        <FILE>modules/flowable-engine/src/test/java/org/activiti/engine/test/history/HistoricActivityInstanceTest.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>PR #40 port to embedded v5 engine</MESSAGE>
      <SHA>4e2e77bbb342ad104462914b4263ac0dce2d62ee</SHA>
      <PATCHEDFILES>
        <FILE>modules/flowable5-engine/src/main/java/org/activiti5/engine/impl/HistoricActivityInstanceQueryImpl.java</FILE>
        <FILE>modules/flowable5-test/src/test/java/org/activiti5/engine/test/history/HistoricActivityInstanceTest.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Port PR #40 to 5 engine branch</MESSAGE>
      <SHA>e1c06f666e57241fe3607315554b7fef80c53809</SHA>
      <PATCHEDFILES>
        <FILE>modules/flowable-engine/src/main/java/org/activiti/engine/impl/HistoricActivityInstanceQueryImpl.java</FILE>
        <FILE>modules/flowable-engine/src/test/java/org/activiti/engine/test/history/HistoricActivityInstanceTest.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
