<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>3109</ISSUENO>
  <ISSUEURL>https://github.com/flowable/flowable-engine/issues/3109</ISSUEURL>
  <TITLE>[DMN] COLLECT hit policy with `alwaysUseArraysForDmnMultiHitPolicies` returns null/value instead of array</TITLE>
  <DESCRIPTION>**Description** BPMN/CMMN dmn service task for `COLLECT` hit policy returns (`protected boolean alwaysUseArraysForDmnMultiHitPolicies = true;`): | hits | output| |------|----------| | none hit | null | | one item hit | `itemValue` | | multiple hits | array of values | The issue is also related to #2286 test: https://github.com/martin-grofcik/flowable-engine/commit/704b6bb1bec7055c708c525880ab2097bc104a55 **Expected behavior** BPMN/CMMN dmn service task for `COLLECT` hit policy returns: | hits | output| |------|----------| | none hit | empty json array `[]` | | one item hit | one item json array `[&quot;itemValue&quot;]` | | multiple hits | array of values `[&quot;itemA&quot;, &quot;ItemB&quot;....]`| **Code** `DmnActivityBehavior` ```java } else { boolean multipleResults = decisionExecutionAuditContainer.isMultipleResults() &amp;&amp; processEngineConfiguration.isAlwaysUseArraysForDmnMultiHitPolicies(); ```</DESCRIPTION>
  <REPONAME>flowable-engine</REPONAME>
  <TIMEDIFFERENCEDAYS>734</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Batch deletion: Store the number of instances that need to be deleted and the number of instances that failed to be deleted</MESSAGE>
    <SHA>03fb7f51a297c0d7741fc67abe3989d969f88a91</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>#3109 [test] collect multi hit policy</MESSAGE>
      <SHA>704b6bb1bec7055c708c525880ab2097bc104a55</SHA>
      <PATCHEDFILES>
        <FILE>modules/flowable-dmn-engine-configurator/src/test/java/org/flowable/dmn/test/runtime/DmnTaskTest.java</FILE>
        <FILE>modules/flowable-dmn-engine-configurator/src/test/resources/org/flowable/bpmn/test/runtime/DmnTaskTest.collectHitPolicyNoAggregator.dmn</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#3109 COLLECT hit policy returns multiple results impl.</MESSAGE>
      <SHA>0f7c1bc03270967aea089d2129cf14109bbf5422</SHA>
      <PATCHEDFILES>
        <FILE>modules/flowable-dmn-engine/src/main/java/org/flowable/dmn/engine/impl/hitpolicy/HitPolicyCollect.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#3109 COLLECT hit policy returns multiple results impl.</MESSAGE>
      <SHA>7cc4e3973a6b836f9e44917c3cc2bb74a2f68f8b</SHA>
      <PATCHEDFILES>
        <FILE>modules/flowable-dmn-engine/src/main/java/org/flowable/dmn/engine/impl/hitpolicy/HitPolicyCollect.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#3109 trigger cancelled JDK11 build</MESSAGE>
      <SHA>9ca1be88cfc520102f62a053911e9f7326ff0154</SHA>
      <PATCHEDFILES>
        <FILE>modules/flowable-dmn-engine/src/main/java/org/flowable/dmn/engine/impl/hitpolicy/HitPolicyCollect.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#3109 [test] collect multi hit policy</MESSAGE>
      <SHA>0b1a17ca8c30f74d63a2cc86469602999a9bafd7</SHA>
      <PATCHEDFILES>
        <FILE>modules/flowable-dmn-engine-configurator/src/test/java/org/flowable/dmn/test/runtime/DmnTaskTest.java</FILE>
        <FILE>modules/flowable-dmn-engine-configurator/src/test/resources/org/flowable/bpmn/test/runtime/DmnTaskTest.collectHitPolicyNoAggregator.dmn</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#3109 COLLECT hit policy returns multiple results impl.</MESSAGE>
      <SHA>506c04ce7f849661c8e8128cd871b566652f8790</SHA>
      <PATCHEDFILES>
        <FILE>modules/flowable-dmn-engine/src/main/java/org/flowable/dmn/engine/impl/hitpolicy/HitPolicyCollect.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#3109 COLLECT hit policy returns multiple results impl.</MESSAGE>
      <SHA>bc891b4a6da9aa00cce3a58a53796e0e6d1f2ffb</SHA>
      <PATCHEDFILES>
        <FILE>modules/flowable-dmn-engine/src/main/java/org/flowable/dmn/engine/impl/hitpolicy/HitPolicyCollect.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#3109 trigger cancelled JDK11 build</MESSAGE>
      <SHA>6afdd4dba9520261babaf55a408b2957b5fcbbbd</SHA>
      <PATCHEDFILES>
        <FILE>modules/flowable-dmn-engine/src/main/java/org/flowable/dmn/engine/impl/hitpolicy/HitPolicyCollect.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#3109 additional tests without arrays</MESSAGE>
      <SHA>5c81eb981021d15489fd05037fb772527e023d77</SHA>
      <PATCHEDFILES>
        <FILE>modules/flowable-dmn-engine-configurator/src/test/java/org/flowable/dmn/test/runtime/DmnTaskTest.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#3109 Reverting non-intentional changes caused by merging branches</MESSAGE>
      <SHA>c2616a1028d9fd27479aec8087e82204f679ff29</SHA>
      <PATCHEDFILES>
        <FILE>modules/flowable-engine/src/main/java/org/activiti/engine/ActivitiAgenda.java</FILE>
        <FILE>modules/flowable-engine/src/main/java/org/flowable/engine/impl/bpmn/helper/ClassDelegate.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>#3109 collect multi hit policy (#3120) * #3109 [test] collect multi hit policy * #3109 COLLECT hit policy returns multiple results impl. * #3109 COLLECT hit policy returns multiple results impl. * #3109 trigger cancelled JDK11 build * #3109 additional tests without arrays Co-authored-by: martin.grofcik &lt;gromar01@gmail.com&gt;</MESSAGE>
      <SHA>e222162d22884696b03a85a854cec6f15db16179</SHA>
      <PATCHEDFILES>
        <FILE>modules/flowable-dmn-engine-configurator/src/test/java/org/flowable/dmn/test/runtime/DmnTaskTest.java</FILE>
        <FILE>modules/flowable-dmn-engine-configurator/src/test/resources/org/flowable/bpmn/test/runtime/DmnTaskTest.collectHitPolicyNoAggregator.dmn</FILE>
        <FILE>modules/flowable-dmn-engine/src/main/java/org/flowable/dmn/engine/impl/hitpolicy/HitPolicyCollect.java</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
