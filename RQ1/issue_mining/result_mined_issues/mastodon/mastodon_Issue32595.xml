<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>32595</ISSUENO>
  <ISSUEURL>https://github.com/mastodon/mastodon/issues/32595</ISSUEURL>
  <TITLE>Media from a server limited with &quot;reject media files&quot; no longer shows as &quot;Preview not available&quot;</TITLE>
  <DESCRIPTION>### Steps to reproduce the problem 1. Limit a server with &quot;reject media files&quot; 2. Follow someone from that server, User A 3. User A posts with a single image and it shows up on your followed timeline ### Expected behaviour The media is not downloaded, but it shows that there's media on the post, a &quot;Preview not available&quot; and a link to the original media ### Actual behaviour The post shows as if there was no media attached ### Detailed description I noticed recently that new posts from users of a server with rejected media does not show as &quot;preview not available&quot; anymore. There's no indication that the post had media in the first place and the only way to find out is if you go to the original post. ### Mastodon instance masto.donte.com.br ### Mastodon version v4.3.0+donte ### Browser name and version Chromium Version 129.0.6668.58 (Official Build, ungoogled-chromium) Arch Linux (64-bit) ### Operating system Linux ### Technical details There's no errors on the rails logs or on the console logs.</DESCRIPTION>
  <REPONAME>mastodon</REPONAME>
  <TIMEDIFFERENCEDAYS>2</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Update dependency eslint-plugin-formatjs to v5 (#32087) Co-authored-by: renovate[bot] &lt;29139614+renovate[bot]@users.noreply.github.com&gt;</MESSAGE>
    <SHA>bb0532530666d877cae6345ce6a11c041b01fc7b</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fix 'unknown' media attachment type rendering Fixes #32595. Essentially this code was reworked at some point and the previous else branch that caught the 'unknown' media type was removed.</MESSAGE>
      <SHA>6a4bcf8499d3b8e3e7984febb83826933ca9fc8c</SHA>
      <PATCHEDFILES>
        <FILE>app/javascript/mastodon/components/status.jsx</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fix 'uknown' media attachment rendering in detailed view Following the fix on #32613, this relates to #32595 and fixes the same issue in the detailed view</MESSAGE>
      <SHA>e882e554959005ad0ab8adf7cd29f23b240fb9d3</SHA>
      <PATCHEDFILES>
        <FILE>app/javascript/mastodon/features/status/components/detailed_status.tsx</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fix 'unknown' media attachment rendering in detailed view Following the fix on #32613, this relates to #32595 and fixes the same issue in the detailed view</MESSAGE>
      <SHA>36e5b7312b23230d41a5ccf894efb1786268d0d3</SHA>
      <PATCHEDFILES>
        <FILE>app/javascript/mastodon/features/status/components/detailed_status.tsx</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
