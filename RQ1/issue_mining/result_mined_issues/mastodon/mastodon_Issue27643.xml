<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>27643</ISSUENO>
  <ISSUEURL>https://github.com/mastodon/mastodon/issues/27643</ISSUEURL>
  <TITLE>Regression in emoji picker: Selecting an emoji does not output the emoji to textarea</TITLE>
  <DESCRIPTION>### Steps to reproduce the problem 1. Pull latest main to 277e696 2. Rebuild and restart 3. See emoji not outputting to textarea after selecting an emoji ... ### Expected behaviour Emoji code should appear to textarea ### Actual behaviour Nothing happens ### Detailed description I may have been too hasty since this was introduced [8 hours ago](https://github.com/mastodon/mastodon/commit/9c8891b39a2d04898880f4bd0754a52739ada30a#diff-b407b14e1a5570dfc879754f8669660ee64065027c51912f5061726fe1679b4f)... sorry for that, if it should be this way and is acknowledged. Maybe @ClearlyClaire has a clue? ### Mastodon instance mementomori.social ### Mastodon version v4.3.0-alpha.0-2023-10-31 ### Browser name and version Google Chrome 118.0.5993.70 (Official Build) (64-bit) ### Operating system Pop!_OS 22.04 LTS ### Technical details DevTools Console: ``` Uncaught TypeError: Cannot read properties of undefined (reading 'selectionStart') at compose_form.jsx:219:40 at Object.onPickEmoji [as onPick] (emoji_picker_dropdown_container.js:80:7) at Object.onClick (emoji_picker_dropdown.jsx:236:16) at a.value (nimble-picker.js:315:18) at nimble-emoji.js:46:23 at onClick (nimble-emoji.js:220:16) at Object.Ae (react-dom.production.min.js:54:317) at ze (react-dom.production.min.js:54:471) at react-dom.production.min.js:55:35 at Rr (react-dom.production.min.js:105:68) ```</DESCRIPTION>
  <REPONAME>mastodon</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Make icons more same size by their dimensions</MESSAGE>
    <SHA>356cec66c3af126b46df451df0df1808812320c9</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Revert 9c8891b to fix emoji picker for now, Ref #27643</MESSAGE>
      <SHA>fea857c4781ebaf42d0b901c7be1ce638db513b1</SHA>
      <PATCHEDFILES>
        <FILE>app/javascript/mastodon/components/autosuggest_textarea.jsx</FILE>
        <FILE>app/javascript/mastodon/features/compose/components/compose_form.jsx</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Get autosuggest_textarea and composer_form from main 8521238 and fix #27643</MESSAGE>
      <SHA>6c4147aa152c0c59f52daa35813d7406143943c2</SHA>
      <PATCHEDFILES>
        <FILE>app/javascript/mastodon/components/autosuggest_textarea.jsx</FILE>
        <FILE>app/javascript/mastodon/features/compose/components/compose_form.jsx</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Get autosuggest_textarea and composer_form from main 8521238 and fix mastodon/mastodon #27643 (Fix the reintroduced regression in 6c4147a)</MESSAGE>
      <SHA>577e190b3be516d461194bc8b0bfd386de5169fc</SHA>
      <PATCHEDFILES>
        <FILE>app/javascript/mastodon/components/autosuggest_textarea.jsx</FILE>
        <FILE>app/javascript/mastodon/features/compose/components/compose_form.jsx</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
