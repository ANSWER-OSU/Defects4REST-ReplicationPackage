<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>34251</ISSUENO>
  <ISSUEURL>https://github.com/mastodon/mastodon/issues/34251</ISSUEURL>
  <TITLE>Too many CacheBuster queues after run tootctl</TITLE>
  <DESCRIPTION>### Steps to reproduce the problem 1. run `tootctl status remove` 2. Check /sidekiq ... ### Expected behaviour Nothing weird happens ### Actual behaviour A lot of CacheBusterWorker queue for &quot;/thumbnails/original/missing.png&quot; ### Detailed description ![Image](https://github.com/user-attachments/assets/6242650d-3532-402a-afaf-fe0374cf9577) ### Mastodon instance qdon.space ### Mastodon version v4.4.0-alpha.4 (30e334b51a4e7add05401895bff5a2ea4a97e0bd) ### Technical details If this is happening on your own Mastodon server, please fill out those: - Ruby version: v3.4.2 - Node.js version: v22.14</DESCRIPTION>
  <REPONAME>mastodon</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Fix error when terms of service are missing an effective date (#34200)</MESSAGE>
    <SHA>009990760008e434e262e3c7bfdb22eeadfd9aca</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fix `CacheBuster` being queued for missing media attachments Fixes #34251</MESSAGE>
      <SHA>05de17fe4b6d513f4568098f573cebb0bdbaeefc</SHA>
      <PATCHEDFILES>
        <FILE>app/models/media_attachment.rb</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
