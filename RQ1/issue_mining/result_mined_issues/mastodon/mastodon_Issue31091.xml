<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>31091</ISSUENO>
  <ISSUEURL>https://github.com/mastodon/mastodon/issues/31091</ISSUEURL>
  <TITLE>Duplicate key &quot;orderedItems&quot; in outbox.json when exporting a user's archive</TITLE>
  <DESCRIPTION>### Steps to reproduce the problem 1. Export a user's archive 2. Download &amp; extract the archive 3. Look at outbox.json 4. There's two &quot;orderedItems&quot; keys! ![image](https://github.com/user-attachments/assets/eb69d63e-eb76-462e-a0f1-69b4600337ca) (originally [reported on glitch-soc](https://github.com/glitch-soc/mastodon/issues/2787) but was told that it's also happening upstream) ### Expected behaviour There should only be one &quot;orderedItems&quot; key ### Actual behaviour There were two &quot;orderedItems&quot; keys, one of which was a blank array ### Detailed description _No response_ ### Mastodon instance _No response_ ### Mastodon version v4.3.0-alpha.5+glitch ### Technical details _No response_</DESCRIPTION>
  <REPONAME>mastodon</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>New Crowdin Translations (automated) (#31038) Co-authored-by: GitHub Actions &lt;noreply@github.com&gt;</MESSAGE>
    <SHA>66430cb25c824cfad0394216d8e7a523533bcf4b</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fix duplicate `orderedItems` in user archive's `outbox.json` Fixes #31091</MESSAGE>
      <SHA>c0baea459c190ee07c35539cc4ffb3ac42ca8e27</SHA>
      <PATCHEDFILES>
        <FILE>app/lib/activitypub/adapter.rb</FILE>
        <FILE>app/services/backup_service.rb</FILE>
        <FILE>spec/services/backup_service_spec.rb</FILE>
      </PATCHEDFILES>
    </COMMIT>
    <COMMIT>
      <MESSAGE>Fix duplicate `orderedItems` in user archive's `outbox.json` Fixes #31091</MESSAGE>
      <SHA>00768fb2d74a044132201690e95fe4994284a586</SHA>
      <PATCHEDFILES>
        <FILE>app/lib/activitypub/adapter.rb</FILE>
        <FILE>app/services/backup_service.rb</FILE>
        <FILE>spec/lib/activitypub/adapter_spec.rb</FILE>
        <FILE>spec/services/backup_service_spec.rb</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
