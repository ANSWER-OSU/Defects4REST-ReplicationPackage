<?xml version="1.0" ?>
<ISSUE>
  <ISSUENO>33764</ISSUENO>
  <ISSUEURL>https://github.com/mastodon/mastodon/issues/33764</ISSUEURL>
  <TITLE>LinkCrawlWorker jobs stall leading to Sidekiq queue exhaustion</TITLE>
  <DESCRIPTION>### Steps to reproduce the problem Posts with links to some sites are spawning LinkCrawlWorker jobs that stall and eventually exhaust all the Sidekiq `pull` queue workers. ![Image](https://github.com/user-attachments/assets/d22578e5-a4b3-4980-be70-5f13290f6d40) Sampling of statues that cause this issue. ``` https://mastodon.social/users/kmpiw/statuses/113904991094873288 https://flipboard.com/users/npr/statuses/-tlFx41WTceXH_iurRZdiA:a:3195441 https://mstdn.social/users/mtlgazette/statuses/113907480354297871 https://flipboard.com/users/npr/statuses/RXOMLhODRj-HUx0GxevmBg:a:3195441 https://flipboard.com/users/npr/statuses/6rEZ0qNgQbiBWoG1mm4u2w:a:3195441 https://mastodon.world/users/verdantsquare/statuses/113907534835747953 ``` Examples of links that don't finish processing are anything on montrealgazette.com, www.dfat.gov.au, Akamai blog, and tons from NPR.org Rolling back to an image based on Jan 27 `main` results in job completion. ### Expected behaviour LinkedCrawlWorker job completes successfully ### Actual behaviour LinkedCrawlWorker job stalls ### Detailed description Suspect it's related to changes in #33757 although these links don't appear to have any redirects. ### Mastodon instance vmst.io ### Mastodon version main @ [5b291fc](https://github.com/mastodon/mastodon/commit/5b291fcbe41564264954618fb1f4086a3be1c600) ### Technical details _No response_</DESCRIPTION>
  <REPONAME>mastodon</REPONAME>
  <TIMEDIFFERENCEDAYS>0</TIMEDIFFERENCEDAYS>
  <BUGGYCOMMIT>
    <MESSAGE>Fix incorrect signature after HTTP redirect (#33757)</MESSAGE>
    <SHA>5b291fcbe41564264954618fb1f4086a3be1c600</SHA>
  </BUGGYCOMMIT>
  <PATCHCOMMITS>
    <COMMIT>
      <MESSAGE>Fix missing timeout options in `Request` class Fixes #33764</MESSAGE>
      <SHA>37dfb8ab9eec9d7f81e32d4eadddf903d55d5fdf</SHA>
      <PATCHEDFILES>
        <FILE>app/lib/request.rb</FILE>
      </PATCHEDFILES>
    </COMMIT>
  </PATCHCOMMITS>
</ISSUE>
