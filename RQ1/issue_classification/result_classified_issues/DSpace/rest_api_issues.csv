issue_no,repo,issue_url,title,description,patched_file_types,text_for_topic_modeling,prediction,confidence
3032,DSpace,https://github.com/DSpace/DSpace/issues/3032,pagination for eperson/groups/search/byMetadata method doesn't work properly,"**Describe the bug** If I make a request to `api/eperson/groups/search/byMetadata` the pagination works properly only for the first page. Indeed if I make a request for a page after the first I get a number of results which are twice as many as required **To Reproduce** It can be verified directly on the demo server: 1. login as admin through hal browser https://dspace7.4science.cloud/server 2. make a new request for the first page, and verify the server return 10 results : https://dspace7.4science.cloud/server/#https://dspace7.4science.cloud/server/api/eperson/groups/search/byMetadata?page=0&size=10&query= 3. make a new request for the second page, and verify the server return 20 results instead of 10 : https://dspace7.4science.cloud/server/#https://dspace7.4science.cloud/server/api/eperson/groups/search/byMetadata?page=1&size=10&query= **Expected behavior** It should return the exact number of results for every page requested",config-file,"pagination for eperson/groups/search/byMetadata method doesn't work properly **Describe the bug** If I make a request to `api/eperson/groups/search/byMetadata` the pagination works properly only for the first page. Indeed if I make a request for a page after the first I get a number of results which are twice as many as required **To Reproduce** It can be verified directly on the demo server: 1. login as admin through hal browser https://dspace7.4science.cloud/server 2. make a new request for the first page, and verify the server return 10 results : https://dspace7.4science.cloud/server/#https://dspace7.4science.cloud/server/api/eperson/groups/search/byMetadata?page=0&size=10&query= 3. make a new request for the second page, and verify the server return 20 results instead of 10 : https://dspace7.4science.cloud/server/#https://dspace7.4science.cloud/server/api/eperson/groups/search/byMetadata?page=1&size=10&query= **Expected behavior** It should return the exact number of results for every page requested config-file",bug,0.9
8494,DSpace,https://github.com/DSpace/DSpace/issues/8494,Deleting bitstreams via the 6.x REST API leaves empty bundles,"Deleting the last bitstreams in a bundle via the REST API on DSpace 6.4 (including on demo.dspace.org) from either the `DELETE /items/{item id}/bitstreams/{bitstream id}` or `DELETE /bitstreams/{bitstream id}` endpoints leaves the bundle itself and the link between the bundle and the item, which results an empty bundle in the item bitstreams. This is mostly harmless but causes XMLUI to show a broken thumbnail. To reproduce the bug, add a bitstream in a bundle, then delete it through the REST API (all the item bitstreams in a bundle must be deleted): bash curl -X DELETE '{DOMAIN}/rest/bitstreams/{BITSTREAM_ID}' -H 'Cookie:JSESSIONID={JSESSIONID}'  The behavior can be confirmed by either looking at the `item2bundle` table in the database, which will show that the bundle is still there or from the XMLUI bitstreams edit form. **After deleting the last ORIGINAL bitstream (XMLUI edit bitstreams form):** <img width=""868"" alt=""Screen Shot 2022-09-29 at 2 23 21 PM"" src=""https://user-images.githubusercontent.com/20943086/193020060-8d05988e-d785-4ddc-80c6-f8352d27aa46.png""> **After deleting the last THUMBNAIL bitstream (XMLUI edit bitstreams form):** <img width=""855"" alt=""Screen Shot 2022-09-29 at 2 27 41 PM"" src=""https://user-images.githubusercontent.com/20943086/193020084-a00b1837-c924-4fb2-8d7a-3e0dd779baea.png""> **After deleting the last THUMBNAIL bitstream (XMLUI item view):** <img width=""824"" alt=""Screen Shot 2022-09-29 at 2 28 19 PM"" src=""https://user-images.githubusercontent.com/20943086/193020118-a963c951-12c7-40bd-b0f3-bdc26d527d15.png""> The suggested fix is to delete the bundle when there are no remaining bitstreams. https://github.com/DSpace/DSpace/pull/8497",source-file | source-file,"Deleting bitstreams via the 6.x REST API leaves empty bundles Deleting the last bitstreams in a bundle via the REST API on DSpace 6.4 (including on demo.dspace.org) from either the `DELETE /items/{item id}/bitstreams/{bitstream id}` or `DELETE /bitstreams/{bitstream id}` endpoints leaves the bundle itself and the link between the bundle and the item, which results an empty bundle in the item bitstreams. This is mostly harmless but causes XMLUI to show a broken thumbnail. To reproduce the bug, add a bitstream in a bundle, then delete it through the REST API (all the item bitstreams in a bundle must be deleted): bash curl -X DELETE '{DOMAIN}/rest/bitstreams/{BITSTREAM_ID}' -H 'Cookie:JSESSIONID={JSESSIONID}'  The behavior can be confirmed by either looking at the `item2bundle` table in the database, which will show that the bundle is still there or from the XMLUI bitstreams edit form. **After deleting the last ORIGINAL bitstream (XMLUI edit bitstreams form):** <img width=""868"" alt=""Screen Shot 2022-09-29 at 2 23 21 PM"" src=""https://user-images.githubusercontent.com/20943086/193020060-8d05988e-d785-4ddc-80c6-f8352d27aa46.png""> **After deleting the last THUMBNAIL bitstream (XMLUI edit bitstreams form):** <img width=""855"" alt=""Screen Shot 2022-09-29 at 2 27 41 PM"" src=""https://user-images.githubusercontent.com/20943086/193020084-a00b1837-c924-4fb2-8d7a-3e0dd779baea.png""> **After deleting the last THUMBNAIL bitstream (XMLUI item view):** <img width=""824"" alt=""Screen Shot 2022-09-29 at 2 28 19 PM"" src=""https://user-images.githubusercontent.com/20943086/193020118-a963c951-12c7-40bd-b0f3-bdc26d527d15.png""> The suggested fix is to delete the bundle when there are no remaining bitstreams. https://github.com/DSpace/DSpace/pull/8497 source-file source-file",bug,0.95
3130,DSpace,https://github.com/DSpace/DSpace/issues/3130,Group2group cache is not updated by the REST endpoint,"**Describe the bug** The `org.dspace.app.rest.GroupRestController` doesn't call the update method of the group service that is responsible from the other things to rethink the group cache. This imply that if an user is member of the childGroup that is added as children to the parentGroup the subsequent calls to `GroupService.allMemberGroups(Context, EPerson)` would fail to get the parentGroup **To Reproduce** Steps to reproduce the behavior: 1. login as admin 2. create a ""children group"" 3. add the children group as member of a collection/community admin group 4. add a normal user to the children group 5. login with such user 6. verify that such user is not seen as administrator of the community/collection, this because it is an indirect member of the admin group. Alternatively you can check the content of the group2groupcache table This bugs also invalidate several scenario related to the security, discovery and workflow if the involved user get rights/tasks due to his membership to a sub-group **Expected behavior** The group2groupcache table is updated when a group is added or removed as a member of another group via the REST endpoints",test-file | source-file | source-file,"Group2group cache is not updated by the REST endpoint **Describe the bug** The `org.dspace.app.rest.GroupRestController` doesn't call the update method of the group service that is responsible from the other things to rethink the group cache. This imply that if an user is member of the childGroup that is added as children to the parentGroup the subsequent calls to `GroupService.allMemberGroups(Context, EPerson)` would fail to get the parentGroup **To Reproduce** Steps to reproduce the behavior: 1. login as admin 2. create a ""children group"" 3. add the children group as member of a collection/community admin group 4. add a normal user to the children group 5. login with such user 6. verify that such user is not seen as administrator of the community/collection, this because it is an indirect member of the admin group. Alternatively you can check the content of the group2groupcache table This bugs also invalidate several scenario related to the security, discovery and workflow if the involved user get rights/tasks due to his membership to a sub-group **Expected behavior** The group2groupcache table is updated when a group is added or removed as a member of another group via the REST endpoints test-file source-file source-file",bug,0.9
7126,DSpace,https://github.com/DSpace/DSpace/issues/7126,[DS-3779] REST 7 BistreamFormats endpoint throws error when searching based on id,"<i>Imported from JIRA <a href=""https://jira.lyrasis.org/browse/DS-3779"">[DS-3779]</a> created by JonasVg</i> <p>Currently, the calls done to the bitstreamformats that use the id return an error, even if the actual id exists<br/> eg:<br/> As we can see in this call, there are actually bitstreamformats present<br/> <a href=""https://tinyurl.com/yby4vkco"" class=""external-link"" target=""_blank"" rel=""nofollow noopener"">https://tinyurl.com/yby4vkco</a><br/> BUT, for example, the endpoint bitstreamformats/1<br/> <a href=""https://tinyurl.com/yawmpdej"" class=""external-link"" target=""_blank"" rel=""nofollow noopener"">https://tinyurl.com/yawmpdej</a><br/> throws an error</p>",other-file | config-file | other-file,"[DS-3779] REST 7 BistreamFormats endpoint throws error when searching based on id <i>Imported from JIRA <a href=""https://jira.lyrasis.org/browse/DS-3779"">[DS-3779]</a> created by JonasVg</i> <p>Currently, the calls done to the bitstreamformats that use the id return an error, even if the actual id exists<br/> eg:<br/> As we can see in this call, there are actually bitstreamformats present<br/> <a href=""https://tinyurl.com/yby4vkco"" class=""external-link"" target=""_blank"" rel=""nofollow noopener"">https://tinyurl.com/yby4vkco</a><br/> BUT, for example, the endpoint bitstreamformats/1<br/> <a href=""https://tinyurl.com/yawmpdej"" class=""external-link"" target=""_blank"" rel=""nofollow noopener"">https://tinyurl.com/yawmpdej</a><br/> throws an error</p> other-file config-file other-file",bug,0.9
8479,DSpace,https://github.com/DSpace/DSpace/issues/8479,Regular search can contain private & withdrawn items,"**Describe the bug** Regular search contains withdrawn and private items (if logged in as admin), these should probably only appear in the admin search. This is I think blocked for regular users with because of the lack of `read:g{AnonGroup}` solr field in the docs for private/withdrawn items. Since if fix/migrate from https://github.com/DSpace/DSpace/pull/8438 is not applied, then withdrawn items are visible for all/anon. **To Reproduce** Logged in as admin: - [[regular search for withdrawn item](https://demo7.dspace.org/search?query=cce2a443-c792-465e-9fd5-2cbf9aec2e68)](https://demo7.dspace.org/search?query=cce2a443-c792-465e-9fd5-2cbf9aec2e68) => Contains withdrawn item [[Ancient Greece](https://demo7.dspace.org/items/cce2a443-c792-465e-9fd5-2cbf9aec2e68)](https://demo7.dspace.org/items/cce2a443-c792-465e-9fd5-2cbf9aec2e68) in regular search result - Idem [[regular search for private item](https://demo7.dspace.org/search?query=68e9ec51-38cf-4549-937d-fb8ea8194551)](https://demo7.dspace.org/search?query=68e9ec51-38cf-4549-937d-fb8ea8194551) => Contains private item [[Testing Example.](https://demo7.dspace.org/items/68e9ec51-38cf-4549-937d-fb8ea8194551)](https://demo7.dspace.org/items/68e9ec51-38cf-4549-937d-fb8ea8194551) in regular search result **Expected behavior** Private or withdrawn items should not appear in regular search regardless of which user sees results. They should only appear in admin search (where there are sidebar filters/facets for them) **Proposed solution** Easiest solution: add `-withdrawn:true AND -discoverable:false` filter in default `DiscoveryConfiguration` in `defaultFilterQueries` property [[here](https://github.com/DSpace/DSpace/blob/main/dspace/config/spring/api/discovery.xml#L202-L207)](https://github.com/DSpace/DSpace/blob/main/dspace/config/spring/api/discovery.xml#L202-L207) Since there is a separate ""unDiscoverableItems"" config which contains the opposite [[here](https://github.com/DSpace/DSpace/blob/main/dspace/config/spring/api/discovery.xml#L480)](https://github.com/DSpace/DSpace/blob/main/dspace/config/spring/api/discovery.xml#L480) I think it is assumed that this functionality is default. **Related** If fix/migrate from https://github.com/DSpace/DSpace/pull/8438 is not applied, then withdrawn items are visible for all users.",config-file | config-file | config-file,"Regular search can contain private & withdrawn items **Describe the bug** Regular search contains withdrawn and private items (if logged in as admin), these should probably only appear in the admin search. This is I think blocked for regular users with because of the lack of `read:g{AnonGroup}` solr field in the docs for private/withdrawn items. Since if fix/migrate from https://github.com/DSpace/DSpace/pull/8438 is not applied, then withdrawn items are visible for all/anon. **To Reproduce** Logged in as admin: - [[regular search for withdrawn item](https://demo7.dspace.org/search?query=cce2a443-c792-465e-9fd5-2cbf9aec2e68)](https://demo7.dspace.org/search?query=cce2a443-c792-465e-9fd5-2cbf9aec2e68) => Contains withdrawn item [[Ancient Greece](https://demo7.dspace.org/items/cce2a443-c792-465e-9fd5-2cbf9aec2e68)](https://demo7.dspace.org/items/cce2a443-c792-465e-9fd5-2cbf9aec2e68) in regular search result - Idem [[regular search for private item](https://demo7.dspace.org/search?query=68e9ec51-38cf-4549-937d-fb8ea8194551)](https://demo7.dspace.org/search?query=68e9ec51-38cf-4549-937d-fb8ea8194551) => Contains private item [[Testing Example.](https://demo7.dspace.org/items/68e9ec51-38cf-4549-937d-fb8ea8194551)](https://demo7.dspace.org/items/68e9ec51-38cf-4549-937d-fb8ea8194551) in regular search result **Expected behavior** Private or withdrawn items should not appear in regular search regardless of which user sees results. They should only appear in admin search (where there are sidebar filters/facets for them) **Proposed solution** Easiest solution: add `-withdrawn:true AND -discoverable:false` filter in default `DiscoveryConfiguration` in `defaultFilterQueries` property [[here](https://github.com/DSpace/DSpace/blob/main/dspace/config/spring/api/discovery.xml#L202-L207)](https://github.com/DSpace/DSpace/blob/main/dspace/config/spring/api/discovery.xml#L202-L207) Since there is a separate ""unDiscoverableItems"" config which contains the opposite [[here](https://github.com/DSpace/DSpace/blob/main/dspace/config/spring/api/discovery.xml#L480)](https://github.com/DSpace/DSpace/blob/main/dspace/config/spring/api/discovery.xml#L480) I think it is assumed that this functionality is default. **Related** If fix/migrate from https://github.com/DSpace/DSpace/pull/8438 is not applied, then withdrawn items are visible for all users. config-file config-file config-file",bug,0.9
3440,DSpace,https://github.com/DSpace/DSpace/issues/3440,[DS-62] Not right encoding for license and extracted texts - ID: 2234532,"<i>Imported from JIRA <a href=""https://jira.lyrasis.org/browse/DS-62"">[DS-62]</a> created by bollini</i> <p>This cyrillic text displaed in ISO-8859-5 but need in UTF-8 (looked on<br/> server - this texts in right UTF-8).<br/> This in Firefox 3.0.1<br/> Tested also with browsers IE 6, Amaya - also wrong.</p> <p>Maybe problem with right encoding in header</p> <p>Followups:<br/> &#8212;<br/> Date: 2009-03-04 12:18<br/> Sender: bollini<br/> Hi,<br/> DSpace doesn't set explicity an header for the license so the<br/> configuration of your Apache enviroments drives the browser behaviour.<br/> Anyway, because the license files are written by DSpace, and DSpace doc<br/> requires Tomcat to run with the jdk option file.encoding=UTF-8 I think that<br/> should be appropriate to force the utf8 encoding in license content-type.<br/> So you can fix this issue editing the content-type in bitstream format<br/> registry appending ""; charset=utf-8"" to the MIME Type of the second row<br/> (License)</p>",config-file | other-file,"[DS-62] Not right encoding for license and extracted texts - ID: 2234532 <i>Imported from JIRA <a href=""https://jira.lyrasis.org/browse/DS-62"">[DS-62]</a> created by bollini</i> <p>This cyrillic text displaed in ISO-8859-5 but need in UTF-8 (looked on<br/> server - this texts in right UTF-8).<br/> This in Firefox 3.0.1<br/> Tested also with browsers IE 6, Amaya - also wrong.</p> <p>Maybe problem with right encoding in header</p> <p>Followups:<br/> &#8212;<br/> Date: 2009-03-04 12:18<br/> Sender: bollini<br/> Hi,<br/> DSpace doesn't set explicity an header for the license so the<br/> configuration of your Apache enviroments drives the browser behaviour.<br/> Anyway, because the license files are written by DSpace, and DSpace doc<br/> requires Tomcat to run with the jdk option file.encoding=UTF-8 I think that<br/> should be appropriate to force the utf8 encoding in license content-type.<br/> So you can fix this issue editing the content-type in bitstream format<br/> registry appending ""; charset=utf-8"" to the MIME Type of the second row<br/> (License)</p> config-file other-file",bug,0.85
3110,DSpace,https://github.com/DSpace/DSpace/issues/3110,Poor URL matching causes improper failure with confusing message,"**400 Bad Request** while rendering the initial page server-side. The underlying error made no sense: `java.lang.IllegalArgumentException: the supplied uri is not valid: http://ds7.wood.net/server/api/core/sites/2510e895-db7e-46b2-9a9e-b4fd92026156`. The string *is* a valid HTTP URI, and fetching it with `curl` succeeds. I traced the problem to the way that URIs are validated in `org.dspace.app.rest.utils.Utils.getBaseObjectRestFromUri`. The problem was revealed because I had configured `dspace.server.url` with an explicit port 80, which is useless (for protocol `http`) but not incorrect. This failure is incorrect, surprising, and time-consuming to understand. The ultimate cause of the failure is that `getBaseObjectRestFromUri` compares URLs as strings rather than as serializations of complex structured objects (which is what URLs are). I suggest that, to discover whether URL A is a prefix of URL B, one must compare protocol, host, port, and path separately. **To Reproduce** Steps to reproduce the behavior: 1. Configure `dspace.server.url` explicitly with the default port for its protocol. 2. Start up front end and back end, and browse to the front end. **Expected behavior** For example: the URL `http://example.com:80/foo` should be recognized as a prefix of `http://example.com/foo/bar`.",source-file | source-file | test-file | source-file | source-file | other-file | source-file | source-file | test-file | source-file,"Poor URL matching causes improper failure with confusing message **400 Bad Request** while rendering the initial page server-side. The underlying error made no sense: `java.lang.IllegalArgumentException: the supplied uri is not valid: http://ds7.wood.net/server/api/core/sites/2510e895-db7e-46b2-9a9e-b4fd92026156`. The string *is* a valid HTTP URI, and fetching it with `curl` succeeds. I traced the problem to the way that URIs are validated in `org.dspace.app.rest.utils.Utils.getBaseObjectRestFromUri`. The problem was revealed because I had configured `dspace.server.url` with an explicit port 80, which is useless (for protocol `http`) but not incorrect. This failure is incorrect, surprising, and time-consuming to understand. The ultimate cause of the failure is that `getBaseObjectRestFromUri` compares URLs as strings rather than as serializations of complex structured objects (which is what URLs are). I suggest that, to discover whether URL A is a prefix of URL B, one must compare protocol, host, port, and path separately. **To Reproduce** Steps to reproduce the behavior: 1. Configure `dspace.server.url` explicitly with the default port for its protocol. 2. Start up front end and back end, and browse to the front end. **Expected behavior** For example: the URL `http://example.com:80/foo` should be recognized as a prefix of `http://example.com/foo/bar`. source-file source-file test-file source-file source-file other-file source-file source-file test-file source-file",bug,0.95
7992,DSpace,https://github.com/DSpace/DSpace/issues/7992,Scripts and processes bug,"The REST code for the scripts and processes does not take into account the ""hasArg"" value of the configured script options. Instead, the REST API only exposes the option type. I believe angular will then use this option type to force an argument or not depending on the type. When the type is a String, which is the default type, an argument will be forced. As a consequence, when no argument needs to be provided, the type needs to be changed to a boolean as is done [here](https://github.com/DSpace/DSpace/blob/main/dspace-api/src/main/java/org/dspace/app/bulkedit/MetadataImportScriptConfiguration.java#L62). This is very unintuitive when adding configuration for new scripts. This bug was noticed in the [review of the harvest script](https://github.com/DSpace/dspace-angular/pull/1328#pullrequestreview-775425176). **Expected behavior** Ideally, the converter should set the type to boolean when no other type is provided and when there should be no argument provided for the parameter instead of having to set the type manually for every parameter. **Related work** This issue was noticed when reviewing the [Control collection harvest from the UI PR](https://github.com/DSpace/dspace-angular/pull/1328).",source-file | test-file | test-file | test-file | test-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | test-file | source-file | test-file | test-file | test-file | test-file | test-file | test-file,"Scripts and processes bug The REST code for the scripts and processes does not take into account the ""hasArg"" value of the configured script options. Instead, the REST API only exposes the option type. I believe angular will then use this option type to force an argument or not depending on the type. When the type is a String, which is the default type, an argument will be forced. As a consequence, when no argument needs to be provided, the type needs to be changed to a boolean as is done [here](https://github.com/DSpace/DSpace/blob/main/dspace-api/src/main/java/org/dspace/app/bulkedit/MetadataImportScriptConfiguration.java#L62). This is very unintuitive when adding configuration for new scripts. This bug was noticed in the [review of the harvest script](https://github.com/DSpace/dspace-angular/pull/1328#pullrequestreview-775425176). **Expected behavior** Ideally, the converter should set the type to boolean when no other type is provided and when there should be no argument provided for the parameter instead of having to set the type manually for every parameter. **Related work** This issue was noticed when reviewing the [Control collection harvest from the UI PR](https://github.com/DSpace/dspace-angular/pull/1328). source-file test-file test-file test-file test-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file test-file source-file test-file test-file test-file test-file test-file test-file",bug,0.85
8023,DSpace,https://github.com/DSpace/DSpace/issues/8023,DSpace 7.0: Bitstream download filename lose non-latin characters,"**Describe the bug** When download a bitstream having filename with character other than latin, those characters will be missing in file save dialog. For example, file named "" File.pdf"", will be saved as "" File.pdf"" This happen only on 7.0, 6.x and earlier handle this properly. **To Reproduce** Steps to reproduce the behavior: 1. Running DSpace 7.0 on Tomcat 9.0 2. Upload a file to and item with non-latin character in file name, e.g. "" File.pdf"" 2. Download the file from DSpace 7.0 UI 3. Browser will suggest save file name "" File.pdf"" instead of the correct "" File.pdf"" **More Information** This happen because HttpHeadersInitializer does not encode filename in Content-Disposition header. It just use the file name as is. Since HTTP header (or Tomcat?) does not support UTF8, all non-latin characters become ""?"" in the header. In contrast, DSpace 6.x encode filename in Content-Disposition header by using MimeUtility.encodeText(name, ""UTF8"", ""B""); **Discussion** Although encoding filename work fine in earlier version of DSpace, I am wondering if the proper solution should be using filename* which can indicate character encoding?",source-file | test-file,"DSpace 7.0: Bitstream download filename lose non-latin characters **Describe the bug** When download a bitstream having filename with character other than latin, those characters will be missing in file save dialog. For example, file named "" File.pdf"", will be saved as "" File.pdf"" This happen only on 7.0, 6.x and earlier handle this properly. **To Reproduce** Steps to reproduce the behavior: 1. Running DSpace 7.0 on Tomcat 9.0 2. Upload a file to and item with non-latin character in file name, e.g. "" File.pdf"" 2. Download the file from DSpace 7.0 UI 3. Browser will suggest save file name "" File.pdf"" instead of the correct "" File.pdf"" **More Information** This happen because HttpHeadersInitializer does not encode filename in Content-Disposition header. It just use the file name as is. Since HTTP header (or Tomcat?) does not support UTF8, all non-latin characters become ""?"" in the header. In contrast, DSpace 6.x encode filename in Content-Disposition header by using MimeUtility.encodeText(name, ""UTF8"", ""B""); **Discussion** Although encoding filename work fine in earlier version of DSpace, I am wondering if the proper solution should be using filename* which can indicate character encoding? source-file test-file",bug,0.9
8920,DSpace,https://github.com/DSpace/DSpace/issues/8920,LDAP authentication is broken if groupmaps are enabled,"**Describe the bug** LDAP authentication is broken if groupmaps are enabled in `dspace/config/modules/authentication-ldap.cfg`. DSpace version is 7.6. **To Reproduce** Steps to reproduce the behavior: 1. Configure and enable LDAP authentication in `dspace/config/modules/authentication-ldap.cfg` 2. Test that LDAP login is working 3. Enable at least one groupmap, for example: `authentication-ldap.login.groupmap.1 = OU=MYORG:MYORG_LDAP_USERS` 4. Test LDAP login again 5. DSpace frontend displays ""Invalid email or password"" message and the following error and stack trace are shown in dspace.log: <details> <summary>dspace.log</summary> <pre><code>2023-06-26 19:42:56,476 INFO unknown unknown org.dspace.authenticate.LDAPAuthentication @ anonymous::auth:attempting trivial auth of user=jsmith 2023-06-26 19:42:57,326 ERROR unknown unknown org.springframework.boot.web.servlet.support.ErrorPageFilter @ Forwarding to error page from request [/api/authn/login] due to exception [Cannot invoke ""java.util.ArrayList.iterator()"" because ""group"" is null] java.lang.NullPointerException: Cannot invoke ""java.util.ArrayList.iterator()"" because ""group"" is null at org.dspace.authenticate.LDAPAuthentication.assignGroups(LDAPAuthentication.java:730) ~[dspace-api-7.6.jar:7.6] at org.dspace.authenticate.LDAPAuthentication.authenticate(LDAPAuthentication.java:273) ~[dspace-api-7.6.jar:7.6] at org.dspace.authenticate.AuthenticationServiceImpl.authenticateInternal(AuthenticationServiceImpl.java:108) ~[dspace-api-7.6.jar:7.6] at org.dspace.authenticate.AuthenticationServiceImpl.authenticate(AuthenticationServiceImpl.java:80) ~[dspace-api-7.6.jar:7.6] at org.dspace.app.rest.security.EPersonRestAuthenticationProvider.authenticateNewLogin(EPersonRestAuthenticationProvider.java:130) ~[classes/:7.6] </code></pre> </details> **Expected behavior** Login should succeed. **Related work** This seems to be a regression from: - https://github.com/DSpace/DSpace/pull/8814 I have tested reverting that patch, both with groupmaps enabled and disabled, and LDAP login works in both cases.",source-file | config-file | other-file | config-file | config-file | config-file | config-file | config-file | config-file | config-file | container-file | container-file | other-file | config-file | config-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | other-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | config-file | other-file | other-file | database-file | database-file | documentation-file | database-file | database-file | database-file | database-file | database-file | database-file | documentation-file | database-file | database-file | database-file | database-file | database-file | database-file | database-file | database-file | database-file | database-file | database-file | database-file | database-file | database-file | database-file | database-file | database-file | database-file | database-file | database-file | database-file | database-file | database-file | database-file | database-file | database-file | database-file | database-file | database-file | database-file | database-file | database-file | database-file | database-file | database-file | database-file | database-file | database-file | database-file | documentation-file | database-file | database-file | database-file | database-file | database-file | database-file | database-file | database-file | database-file | database-file | database-file | database-file | database-file | database-file | database-file | database-file | database-file | config-file | config-file | config-file | test-file | test-file | test-file | test-file | test-file | test-file | test-file | test-file | test-file | test-file | test-file | test-file | test-file | test-file | test-file | test-file | test-file | test-file | test-file | test-file | test-file | test-file,"LDAP authentication is broken if groupmaps are enabled **Describe the bug** LDAP authentication is broken if groupmaps are enabled in `dspace/config/modules/authentication-ldap.cfg`. DSpace version is 7.6. **To Reproduce** Steps to reproduce the behavior: 1. Configure and enable LDAP authentication in `dspace/config/modules/authentication-ldap.cfg` 2. Test that LDAP login is working 3. Enable at least one groupmap, for example: `authentication-ldap.login.groupmap.1 = OU=MYORG:MYORG_LDAP_USERS` 4. Test LDAP login again 5. DSpace frontend displays ""Invalid email or password"" message and the following error and stack trace are shown in dspace.log: <details> <summary>dspace.log</summary> <pre><code>2023-06-26 19:42:56,476 INFO unknown unknown org.dspace.authenticate.LDAPAuthentication @ anonymous::auth:attempting trivial auth of user=jsmith 2023-06-26 19:42:57,326 ERROR unknown unknown org.springframework.boot.web.servlet.support.ErrorPageFilter @ Forwarding to error page from request [/api/authn/login] due to exception [Cannot invoke ""java.util.ArrayList.iterator()"" because ""group"" is null] java.lang.NullPointerException: Cannot invoke ""java.util.ArrayList.iterator()"" because ""group"" is null at org.dspace.authenticate.LDAPAuthentication.assignGroups(LDAPAuthentication.java:730) ~[dspace-api-7.6.jar:7.6] at org.dspace.authenticate.LDAPAuthentication.authenticate(LDAPAuthentication.java:273) ~[dspace-api-7.6.jar:7.6] at org.dspace.authenticate.AuthenticationServiceImpl.authenticateInternal(AuthenticationServiceImpl.java:108) ~[dspace-api-7.6.jar:7.6] at org.dspace.authenticate.AuthenticationServiceImpl.authenticate(AuthenticationServiceImpl.java:80) ~[dspace-api-7.6.jar:7.6] at org.dspace.app.rest.security.EPersonRestAuthenticationProvider.authenticateNewLogin(EPersonRestAuthenticationProvider.java:130) ~[classes/:7.6] </code></pre> </details> **Expected behavior** Login should succeed. **Related work** This seems to be a regression from: - https://github.com/DSpace/DSpace/pull/8814 I have tested reverting that patch, both with groupmaps enabled and disabled, and LDAP login works in both cases. source-file config-file other-file config-file config-file config-file config-file config-file config-file config-file container-file container-file other-file config-file config-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file other-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file config-file other-file other-file database-file database-file documentation-file database-file database-file database-file database-file database-file database-file documentation-file database-file database-file database-file database-file database-file database-file database-file database-file database-file database-file database-file database-file database-file database-file database-file database-file database-file database-file database-file database-file database-file database-file database-file database-file database-file database-file database-file database-file database-file database-file database-file database-file database-file database-file database-file database-file database-file database-file database-file documentation-file database-file database-file database-file database-file database-file database-file database-file database-file database-file database-file database-file database-file database-file database-file database-file database-file database-file config-file config-file config-file test-file test-file test-file test-file test-file test-file test-file test-file test-file test-file test-file test-file test-file test-file test-file test-file test-file test-file test-file test-file test-file test-file",bug,0.9
3184,DSpace,https://github.com/DSpace/DSpace/issues/3184,workflow discovery configuration query with query parameter set with free text returns no results,"**Describe the bug** If a discovery search with configuration param set as ""workflow"" and a query param does not return any result. **To Reproduce** Steps to reproduce the behavior: 1. login on dspace 7 demo 2. go to ""MyDSpace"" 3. select ""all tasks"" 4. enter a query string in search input box (i.e. title of an item that appears among ""all tasks"") 5. Search won't return results The same search can be made against REST api as logged in user, by calling /server/api/discover/search/objects?configuration=workflow&query=<query parameter> **Expected behavior** Results according to query content should be returned **Related work** We (4Science) can take this in charge, right after other beta5 tasks that we already have in charge. our estimation is 4 hours of work. Work that consists in the item indexing into task's solr documents (PooledTask and ClaimedTask resource types) and the creation of a specific test that proves the provided solution. ![Screenshot from 2021-03-12 15-17-16](https://user-images.githubusercontent.com/70699836/110952059-0e8cf400-8346-11eb-93ca-5366f572c08f.png) ![Screenshot from 2021-03-12 15-16-34](https://user-images.githubusercontent.com/70699836/110952063-0f258a80-8346-11eb-9b8b-ac90f0b96900.png)",config-file,"workflow discovery configuration query with query parameter set with free text returns no results **Describe the bug** If a discovery search with configuration param set as ""workflow"" and a query param does not return any result. **To Reproduce** Steps to reproduce the behavior: 1. login on dspace 7 demo 2. go to ""MyDSpace"" 3. select ""all tasks"" 4. enter a query string in search input box (i.e. title of an item that appears among ""all tasks"") 5. Search won't return results The same search can be made against REST api as logged in user, by calling /server/api/discover/search/objects?configuration=workflow&query=<query parameter> **Expected behavior** Results according to query content should be returned **Related work** We (4Science) can take this in charge, right after other beta5 tasks that we already have in charge. our estimation is 4 hours of work. Work that consists in the item indexing into task's solr documents (PooledTask and ClaimedTask resource types) and the creation of a specific test that proves the provided solution. ![Screenshot from 2021-03-12 15-17-16](https://user-images.githubusercontent.com/70699836/110952059-0e8cf400-8346-11eb-93ca-5366f572c08f.png) ![Screenshot from 2021-03-12 15-16-34](https://user-images.githubusercontent.com/70699836/110952063-0f258a80-8346-11eb-9b8b-ac90f0b96900.png) config-file",bug,0.9
3185,DSpace,https://github.com/DSpace/DSpace/issues/3185,Facet entries in the discover/facets/{facet} endpoint does not return the authority key,"**Describe the bug** When calling the {dspace.url}/api/discover/facets/{facet} endpoint, the results won't include the authority key, even though it should be there. **To Reproduce** 1. Set up a discovery core that has authority values for facets in the config 2. Try to retrieve the values through the call above 3. The resulting facet entries won't include the authority key **Expected behavior** The authority keys should be present in the response **Related work** This was discovered due to the failing tests in this PR: https://github.com/DSpace/DSpace/pull/3176",config-file,"Facet entries in the discover/facets/{facet} endpoint does not return the authority key **Describe the bug** When calling the {dspace.url}/api/discover/facets/{facet} endpoint, the results won't include the authority key, even though it should be there. **To Reproduce** 1. Set up a discovery core that has authority values for facets in the config 2. Try to retrieve the values through the call above 3. The resulting facet entries won't include the authority key **Expected behavior** The authority keys should be present in the response **Related work** This was discovered due to the failing tests in this PR: https://github.com/DSpace/DSpace/pull/3176 config-file",bug,0.9
8765,DSpace,https://github.com/DSpace/DSpace/issues/8765,Reset Password does not work from the Admin Panel when Captcha verification enabled,"**Describe the bug** When I am logged in as admin and try to reset a password for another eperson, it will throw an error: Error when trying to reset password An error occured when attempting to reset the password for the account associated with the following email address: 213523@ids.upchiapas.edu.mx. The same behavior encountered also in the DSpace 7.5 DEMO website. **To Reproduce** Steps to reproduce the behavior: 1. MUST have [Google Recaptcha](https://wiki.lyrasis.org/display/DSDOC7x/CAPTCHA+Verification) enabled to reproduce this bug. 2. Log in as Admin 3. Go to Access Control -> People -> Edit a Person -> Reset Password Related: The Bug was first described in #https://github.com/DSpace/DSpace/issues/8670 However, the angular fix (#2107) did not resolve the problem. In the Network Tab, I see how the request is sent properly (with the correct parameter =forgot), but the Backend responds with 403 Forbidden. Maybe is something in the backend that should be changed as well?",source-file,"Reset Password does not work from the Admin Panel when Captcha verification enabled **Describe the bug** When I am logged in as admin and try to reset a password for another eperson, it will throw an error: Error when trying to reset password An error occured when attempting to reset the password for the account associated with the following email address: 213523@ids.upchiapas.edu.mx. The same behavior encountered also in the DSpace 7.5 DEMO website. **To Reproduce** Steps to reproduce the behavior: 1. MUST have [Google Recaptcha](https://wiki.lyrasis.org/display/DSDOC7x/CAPTCHA+Verification) enabled to reproduce this bug. 2. Log in as Admin 3. Go to Access Control -> People -> Edit a Person -> Reset Password Related: The Bug was first described in #https://github.com/DSpace/DSpace/issues/8670 However, the angular fix (#2107) did not resolve the problem. In the Network Tab, I see how the request is sent properly (with the correct parameter =forgot), but the Backend responds with 403 Forbidden. Maybe is something in the backend that should be changed as well? source-file",bug,0.9
8732,DSpace,https://github.com/DSpace/DSpace/issues/8732,Default filter always applies in Register DOI via Item status page in UI,"**Describe the bug** It was my understanding that the functionality of registering doi via the item status page should always bypass any default filter defiened in the DOIIdentifierProvider bean (identifier-service.xml config) by applying the TrueFilter. I am seeing something very odd when trying this functionality and looking at the logs (I have added some additional logging). It looks like Truefilter is being checked twice, and an additional check is run that uses the default filter:  Before request [POST /server/api/pid/identifiers] originated from /items/69a962a1-0af5-4323-94f2-646fd500d8c5/edit/register-doi org.dspace.identifier.DOIIdentifierProvider @ Check filter: class org.dspace.content.logic.TrueFilter org.dspace.identifier.DOIIdentifierProvider @ Result of filter for 1810/347135 is true  org.dspace.identifier.DOIIdentifierProvider @ Check filter: class org.dspace.content.logic.TrueFilter org.dspace.identifier.DOIIdentifierProvider @ Result of filter for 1810/347135 is true org.dspace.identifier.DOIIdentifierProvider @ Check filter: class org.dspace.content.logic.DefaultFilter org.dspace.content.logic.condition.IsArchivedCondition @ Result of isArchived is true org.dspace.content.logic.condition.IsWithdrawnCondition @ Result of isWithdrawn is false org.dspace.content.logic.condition.InCollectionCondition @ item 1810/347135 is in collection 1810/294790, returning true org.dspace.identifier.DOIIdentifierProvider @ Result of filter for 1810/347135 is false org.dspace.app.rest.exception.DSpaceApiExceptionControllerAdvice @ An exception has occurred (status:500) java.lang.IllegalStateException: Failed to register identifier: null at org.dspace.app.rest.repository.IdentifierRestRepository.registerDOI(IdentifierRestRepository.java:248)  In the UI, I get the error message banner twice, and I can see two API calls in the developer tools. Is the method somehow being called multiple times? **To Reproduce** Steps to reproduce the behavior: 1. Log in as admin and choose an archived item without a DOI 2. Go to Edit item > Item status 3. Click on Register DOI 4. Confirm DOI registration **Expected behavior** The registration always takes place, bypassing any default identifier filters **Related work** Link to any related tickets or PRs here.",source-file | source-file | source-file,"Default filter always applies in Register DOI via Item status page in UI **Describe the bug** It was my understanding that the functionality of registering doi via the item status page should always bypass any default filter defiened in the DOIIdentifierProvider bean (identifier-service.xml config) by applying the TrueFilter. I am seeing something very odd when trying this functionality and looking at the logs (I have added some additional logging). It looks like Truefilter is being checked twice, and an additional check is run that uses the default filter:  Before request [POST /server/api/pid/identifiers] originated from /items/69a962a1-0af5-4323-94f2-646fd500d8c5/edit/register-doi org.dspace.identifier.DOIIdentifierProvider @ Check filter: class org.dspace.content.logic.TrueFilter org.dspace.identifier.DOIIdentifierProvider @ Result of filter for 1810/347135 is true  org.dspace.identifier.DOIIdentifierProvider @ Check filter: class org.dspace.content.logic.TrueFilter org.dspace.identifier.DOIIdentifierProvider @ Result of filter for 1810/347135 is true org.dspace.identifier.DOIIdentifierProvider @ Check filter: class org.dspace.content.logic.DefaultFilter org.dspace.content.logic.condition.IsArchivedCondition @ Result of isArchived is true org.dspace.content.logic.condition.IsWithdrawnCondition @ Result of isWithdrawn is false org.dspace.content.logic.condition.InCollectionCondition @ item 1810/347135 is in collection 1810/294790, returning true org.dspace.identifier.DOIIdentifierProvider @ Result of filter for 1810/347135 is false org.dspace.app.rest.exception.DSpaceApiExceptionControllerAdvice @ An exception has occurred (status:500) java.lang.IllegalStateException: Failed to register identifier: null at org.dspace.app.rest.repository.IdentifierRestRepository.registerDOI(IdentifierRestRepository.java:248)  In the UI, I get the error message banner twice, and I can see two API calls in the developer tools. Is the method somehow being called multiple times? **To Reproduce** Steps to reproduce the behavior: 1. Log in as admin and choose an archived item without a DOI 2. Go to Edit item > Item status 3. Click on Register DOI 4. Confirm DOI registration **Expected behavior** The registration always takes place, bypassing any default identifier filters **Related work** Link to any related tickets or PRs here. source-file source-file source-file",bug,0.9
3090,DSpace,https://github.com/DSpace/DSpace/issues/3090,Bitstream format cannot be retrieved if you don't have read rights on the file,"**Describe the bug** When you make a file private (or add an embargo to it) and you aren't logged in (or if you are logged in but without read rights to the file) the format of the file isn't displayed on the full item view page. This is because the format endpoint doesn't allow you to retrieve the format if you don't have read rights to the file. The url that is being used for that request is: > /server/api/core/bitstreams/{id}/format **To Reproduce** Steps to reproduce the behavior: 1. Upload a file to an item 2. Add an embargo to it, or make it admin only by removing the anonymous read rights 3. Go to the full item view page & the format won't be there **Expected behavior** The format should be able to be displayed even if you don't have read rights to the actual file.",other-file | config-file | config-file | other-file | database-file | other-file,"Bitstream format cannot be retrieved if you don't have read rights on the file **Describe the bug** When you make a file private (or add an embargo to it) and you aren't logged in (or if you are logged in but without read rights to the file) the format of the file isn't displayed on the full item view page. This is because the format endpoint doesn't allow you to retrieve the format if you don't have read rights to the file. The url that is being used for that request is: > /server/api/core/bitstreams/{id}/format **To Reproduce** Steps to reproduce the behavior: 1. Upload a file to an item 2. Add an embargo to it, or make it admin only by removing the anonymous read rights 3. Go to the full item view page & the format won't be there **Expected behavior** The format should be able to be displayed even if you don't have read rights to the actual file. other-file config-file config-file other-file database-file other-file",bug,0.9
3713,DSpace,https://github.com/DSpace/DSpace/issues/3713,[DS-338] Bitstream download allows caching of content that requires authorization to read,"<i>Imported from JIRA <a href=""https://jira.lyrasis.org/browse/DS-338"">[DS-338]</a> created by lcs</i> <p>The XMLUI requests to retrieve the contents of a Bitstream set an ""Expires"" header in the response with a very long time, which itself looks like a bug (the time is 60 hours, when the intent appears to be 1 hour). The other problem with this is that it sets ""Expires:"" even when the content is only accessible through authorization, which results in the following bug caused by aggressive browser caching: (this works best with a Bitstream that renders in the browser, such as an image or plain text)</p> <p>1. Clear browser history (in Firefox 3, use Tools->Clear private data dialog)<br/> 2. Logout of DSpace UI if logged in.<br/> 3. Attempt to view a Bitstream that does not have anonymous READ access; you'll be redirected to the Login page.<br/> 4. Login, get redirected to the Bitstream. Observe that its URL is the DSpace home page, however, e.g.<br/> <a href=""http://dspace.my.edu/xmlui"" class=""external-link"" target=""_blank"" rel=""nofollow noopener"">http://dspace.my.edu/xmlui</a><br/> 5. If you check your browser's cache at this point (visit URL about:cache?device=disk in Firefox3) observe that the content of this page is cached with an expiry time of 60 hours from now.<br/> 6. Now go to another page such as <a href=""http://dspace.my.edu/xmlui/community-list"" class=""external-link"" target=""_blank"" rel=""nofollow noopener"">http://dspace.my.edu/xmlui/community-list</a> and click ""Logout"".<br/> 7. Visit the home page (without trailing /) <a href=""http://dspace.my.edu/xmlui"" class=""external-link"" target=""_blank"" rel=""nofollow noopener"">http://dspace.my.edu/xmlui</a> and observe you're looking at the protected Bitstream. </p> <p>The attached patch fixes this behavior by skipping the ""Expires:"" response header completely when the Bitstream is not anonymously readable. It also shortens the cache time to 1 hour, which will still prevent frequent reloads from loading the server.</p>",source-file,"[DS-338] Bitstream download allows caching of content that requires authorization to read <i>Imported from JIRA <a href=""https://jira.lyrasis.org/browse/DS-338"">[DS-338]</a> created by lcs</i> <p>The XMLUI requests to retrieve the contents of a Bitstream set an ""Expires"" header in the response with a very long time, which itself looks like a bug (the time is 60 hours, when the intent appears to be 1 hour). The other problem with this is that it sets ""Expires:"" even when the content is only accessible through authorization, which results in the following bug caused by aggressive browser caching: (this works best with a Bitstream that renders in the browser, such as an image or plain text)</p> <p>1. Clear browser history (in Firefox 3, use Tools->Clear private data dialog)<br/> 2. Logout of DSpace UI if logged in.<br/> 3. Attempt to view a Bitstream that does not have anonymous READ access; you'll be redirected to the Login page.<br/> 4. Login, get redirected to the Bitstream. Observe that its URL is the DSpace home page, however, e.g.<br/> <a href=""http://dspace.my.edu/xmlui"" class=""external-link"" target=""_blank"" rel=""nofollow noopener"">http://dspace.my.edu/xmlui</a><br/> 5. If you check your browser's cache at this point (visit URL about:cache?device=disk in Firefox3) observe that the content of this page is cached with an expiry time of 60 hours from now.<br/> 6. Now go to another page such as <a href=""http://dspace.my.edu/xmlui/community-list"" class=""external-link"" target=""_blank"" rel=""nofollow noopener"">http://dspace.my.edu/xmlui/community-list</a> and click ""Logout"".<br/> 7. Visit the home page (without trailing /) <a href=""http://dspace.my.edu/xmlui"" class=""external-link"" target=""_blank"" rel=""nofollow noopener"">http://dspace.my.edu/xmlui</a> and observe you're looking at the protected Bitstream. </p> <p>The attached patch fixes this behavior by skipping the ""Expires:"" response header completely when the Bitstream is not anonymously readable. It also shortens the cache time to 1 hour, which will still prevent frequent reloads from loading the server.</p> source-file",bug,0.9
8792,DSpace,https://github.com/DSpace/DSpace/issues/8792,Exporting search results via CSV using a *very* long search query fails,"**Describe the bug** Exporting search results via CSV using a *very* long search query fails without specifying the problem. Searching itself works, but when trying to export the reults an error is shown. The query (like all process parameters) is inserted into the `public.process` table, into the column `parameters`. This column is limited to 512 characters, causing the process creation to fail. **To Reproduce** Steps to reproduce the behavior: 1. Open the search page: https://demo7.dspace.org/search 2. Enter a llong search query (> 512 characters) 3. Click search 4. Search results are shown 5. Click the CSV export button 6. The export fails with the error message ""Starting the export has failed"" **Expected behavior** The export should export the results as usual or document and display the limitation to users. **Related work** This is similar to the issue: #8730, fixed in #8755",source-file | database-file | source-file | database-file | database-file | database-file,"Exporting search results via CSV using a *very* long search query fails **Describe the bug** Exporting search results via CSV using a *very* long search query fails without specifying the problem. Searching itself works, but when trying to export the reults an error is shown. The query (like all process parameters) is inserted into the `public.process` table, into the column `parameters`. This column is limited to 512 characters, causing the process creation to fail. **To Reproduce** Steps to reproduce the behavior: 1. Open the search page: https://demo7.dspace.org/search 2. Enter a llong search query (> 512 characters) 3. Click search 4. Search results are shown 5. Click the CSV export button 6. The export fails with the error message ""Starting the export has failed"" **Expected behavior** The export should export the results as usual or document and display the limitation to users. **Related work** This is similar to the issue: #8730, fixed in #8755 source-file database-file source-file database-file database-file database-file",bug,0.9
7946,DSpace,https://github.com/DSpace/DSpace/issues/7946,DSpace 6.x REST API /registries/schema endpoint incorrectly handles fields without qualifiers,"**Describe the bug** The [DSpace 6.x REST API](https://wiki.lyrasis.org/display/DSDOC6x/REST+API) has an endpoint that allows you to get information about metadata fields in the registry. DSpace does not handle metadata fields without qualifiers properly, for example `dc.title` or `dc.contributor`, and returns HTTP 500 to the user. It logs the following to `dspace.log`: console ERROR org.dspace.rest.MetadataRegistryResource @ Field dc.title. not found  These fields obviously exist, and they are visible in the `dc` schema registry: https://demo.dspace.org/rest/registries/schema/dc ~~This probably affects DSpace 4 and 5 as well, since the REST API is the same code.~~ The registries endpoint was added in DSpace 6. **To Reproduce** Make a request to the `/rest/registries/schema/` endpoint for a metadata field without a qualifier, for example: - https://demo.dspace.org/rest/registries/schema/dc/metadata-fields/title - https://demo.dspace.org/rest/registries/schema/dc/metadata-fields/contributor **Expected behavior** An HTTP 200 response with information about the metadata field, for example `dc.contributor.advisor`: - https://demo.dspace.org/rest/registries/schema/dc/metadata-fields/contributor/advisor",source-file | source-file,"DSpace 6.x REST API /registries/schema endpoint incorrectly handles fields without qualifiers **Describe the bug** The [DSpace 6.x REST API](https://wiki.lyrasis.org/display/DSDOC6x/REST+API) has an endpoint that allows you to get information about metadata fields in the registry. DSpace does not handle metadata fields without qualifiers properly, for example `dc.title` or `dc.contributor`, and returns HTTP 500 to the user. It logs the following to `dspace.log`: console ERROR org.dspace.rest.MetadataRegistryResource @ Field dc.title. not found  These fields obviously exist, and they are visible in the `dc` schema registry: https://demo.dspace.org/rest/registries/schema/dc ~~This probably affects DSpace 4 and 5 as well, since the REST API is the same code.~~ The registries endpoint was added in DSpace 6. **To Reproduce** Make a request to the `/rest/registries/schema/` endpoint for a metadata field without a qualifier, for example: - https://demo.dspace.org/rest/registries/schema/dc/metadata-fields/title - https://demo.dspace.org/rest/registries/schema/dc/metadata-fields/contributor **Expected behavior** An HTTP 200 response with information about the metadata field, for example `dc.contributor.advisor`: - https://demo.dspace.org/rest/registries/schema/dc/metadata-fields/contributor/advisor source-file source-file",bug,0.95
3207,DSpace,https://github.com/DSpace/DSpace/issues/3207,LDAP Authentication does not work properly without the authentication-ldap.login.groupmap option,"When I try to login via LDAP, this keeps failing with this error:  2021-03-25 11:16:29,930 ERROR org.springframework.boot.web.servlet.support.ErrorPageFilter @ Forwarding to error page from request [/api/authn/login] due to exception [Index 1 out of bounds for length 1] java.lang.ArrayIndexOutOfBoundsException: Index 1 out of bounds for length 1 at org.dspace.authenticate.LDAPAuthentication.assignGroups(LDAPAuthentication.java:699) ~[dspace-api-7.0-beta5-SNAPSHOT.jar:7.0-beta5-SNAPSHOT] at org.dspace.authenticate.LDAPAuthentication.authenticate(LDAPAuthentication.java:265) ~[dspace-api-7.0-beta5-SNAPSHOT.jar:7.0-beta5-SNAPSHOT] at org.dspace.authenticate.AuthenticationServiceImpl.authenticateInternal(AuthenticationServiceImpl.java:108) ~[dspace-api-7.0-beta5-SNAPSHOT.jar:7.0-beta5-SNAPSHOT] at org.dspace.authenticate.AuthenticationServiceImpl.authenticate(AuthenticationServiceImpl.java:80) ~[dspace-api-7.0-beta5-SNAPSHOT.jar:7.0-beta5-SNAPSHOT] at org.dspace.app.rest.security.EPersonRestAuthenticationProvider.authenticateNewLogin(EPersonRestAuthenticationProvider.java:97) ~[classes/:7.0-beta5-SNAPSHOT] at org.dspace.app.rest.security.EPersonRestAuthenticationProvider.authenticate(EPersonRestAuthenticationProvider.java:71) ~[classes/:7.0-beta5-SNAPSHOT]  I have not configured any authentication-ldap.login.groupmap option (as I thought I won't need them). But apparently LDAPAuthentication does not work properly without this option.",source-file,"LDAP Authentication does not work properly without the authentication-ldap.login.groupmap option When I try to login via LDAP, this keeps failing with this error:  2021-03-25 11:16:29,930 ERROR org.springframework.boot.web.servlet.support.ErrorPageFilter @ Forwarding to error page from request [/api/authn/login] due to exception [Index 1 out of bounds for length 1] java.lang.ArrayIndexOutOfBoundsException: Index 1 out of bounds for length 1 at org.dspace.authenticate.LDAPAuthentication.assignGroups(LDAPAuthentication.java:699) ~[dspace-api-7.0-beta5-SNAPSHOT.jar:7.0-beta5-SNAPSHOT] at org.dspace.authenticate.LDAPAuthentication.authenticate(LDAPAuthentication.java:265) ~[dspace-api-7.0-beta5-SNAPSHOT.jar:7.0-beta5-SNAPSHOT] at org.dspace.authenticate.AuthenticationServiceImpl.authenticateInternal(AuthenticationServiceImpl.java:108) ~[dspace-api-7.0-beta5-SNAPSHOT.jar:7.0-beta5-SNAPSHOT] at org.dspace.authenticate.AuthenticationServiceImpl.authenticate(AuthenticationServiceImpl.java:80) ~[dspace-api-7.0-beta5-SNAPSHOT.jar:7.0-beta5-SNAPSHOT] at org.dspace.app.rest.security.EPersonRestAuthenticationProvider.authenticateNewLogin(EPersonRestAuthenticationProvider.java:97) ~[classes/:7.0-beta5-SNAPSHOT] at org.dspace.app.rest.security.EPersonRestAuthenticationProvider.authenticate(EPersonRestAuthenticationProvider.java:71) ~[classes/:7.0-beta5-SNAPSHOT]  I have not configured any authentication-ldap.login.groupmap option (as I thought I won't need them). But apparently LDAPAuthentication does not work properly without this option. source-file",bug,0.9
2826,DSpace,https://github.com/DSpace/DSpace/issues/2826,POSTing item returns null as 'name',"When using the REST API and POSTing to `collections/{collectionId}/items` the field `name` of the Item is ignored. So the command: `curl -X POST https://demo.dspace.org/rest/collections/{collection id}/items -H 'Content-Type: application/json' -H 'Accept: application/json' -d '{""name"": ""TEST""}'` returns `{ ""uuid"": ""someuuid"", ""name"": null,  }` Please correct me if I am wrong but the code in `rest/CollectionsResource.java` suggests that only the metadata, but not the name, of an Item is considered. As [` if (item.getMetadata() != null) {`](https://github.com/DSpace/DSpace/blob/master/dspace-rest/src/main/java/org/dspace/rest/CollectionsResource.java#L356) is the only time when Item is accessed. Do I miss something?",source-file | source-file,"POSTing item returns null as 'name' When using the REST API and POSTing to `collections/{collectionId}/items` the field `name` of the Item is ignored. So the command: `curl -X POST https://demo.dspace.org/rest/collections/{collection id}/items -H 'Content-Type: application/json' -H 'Accept: application/json' -d '{""name"": ""TEST""}'` returns `{ ""uuid"": ""someuuid"", ""name"": null,  }` Please correct me if I am wrong but the code in `rest/CollectionsResource.java` suggests that only the metadata, but not the name, of an Item is considered. As [` if (item.getMetadata() != null) {`](https://github.com/DSpace/DSpace/blob/master/dspace-rest/src/main/java/org/dspace/rest/CollectionsResource.java#L356) is the only time when Item is accessed. Do I miss something? source-file source-file",bug,0.95
10053,DSpace,https://github.com/DSpace/DSpace/issues/10053,COAR Notify: fixes to Request endorsement pattern implementation to fully adhere to the Notify implementation v1.0,"## Describe the bug The current implementation of COAR Notify in DSpace >= 8.x for the COAR Request endorsement pattern does not fully adhere to the COAR Notify specification (https://coar-notify.net/specification/1.0.0/). Overall, the current implementation works really well, and the proposed fixes are relatively minor. The fixes have been implemented and tested in collaboration with the PCI Service (Peer Community In) which has a full Notify implementation already available, and currently being used by other repositories such as CSIC (Spain) and HAL (France). As a result, the PR associated with this issue will provide fixes to make the implementation fully adhere to Notify 1.0 specification, as well provide a workflow that supports integration with the PCI endorsement services. List of identified issues 1. The current implementation assumes communications between the repository and the endorsement service will be machine to machine (i.e. the offer notification sent by the repository has the actor hardcoded to being the repository service - see https://github.com/DSpace/DSpace/blob/fc544a830987782d90d22c747e12a42ccf9926d7/dspace/config/ldn/request-endorsement#L20) Instead, the endorsement service expects an email address id in the form **mailto:email@example.org""** (e.g. the email and name of the submitter in the actor property) 2. Acknowledgement notifications: the current implementation in DSpace requires that the type property in received notifications includes both a **type (Accept, Reject, etc.)** as well as including the **coar-type (e.g. coar-type:RequestEndorsement)**. If the coar-type is not set, DSpace returns a null pointer error and notifications fails. See https://coar-notify.net/specification/1.0.0/accept/ where the type property is required and must be Accept, in the case of an Accept ack, and so on. Instead, the DSpace implementation could look for the coar-type (as it currently does), and if not present, it should look at inReplyTo property of the received notification and fetch the coar-type from the original notification (coar-type presence is required in the Offer notification, https://coar-notify.net/specification/1.0.0/request-endorsement/). If none present, then it should fail as expected. 3. Acknowledgement notifications the current DSpace implementation requires that the context property is present in received notifications, and uses this to find the associated DSpace object. The presence of context in ack notifications is optional (e.g. https://coar-notify.net/specification/1.0.0/accept/, the ""context"" property is not even mentioned for ack notifications). Therefore DSpace should follow the same approach as in 2.: if the context property is not present, then find it from the object in the associated inReplyTo notification. ## To Reproduce Steps to reproduce the behaviour: To reproduce the behaviour it is needed to set up a connection with PCI's staging/test environment ## Expected behaviour The service should allow to specify whether it requires the repository actor to be an email address, and ideally this should be done via configuration. The most simple implementation could make use of the submitter's email address and name (this approach would require less modifications to the database tables). A more flexible approach (that may not be needed) could allow the submitter to specify an email address (e.g. different to DSpace's submitter email address). The implementation should fully adhere to the current Notify implementation as per description in 2. and 3. ## Related work PR will be coming shortly",source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | database-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | test-file | other-file | other-file | other-file | other-file | other-file | other-file | other-file | other-file | config-file | database-file | test-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | test-file | other-file | other-file | other-file | config-file | other-file | other-file | other-file | other-file | other-file | other-file | other-file | config-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | database-file | database-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | test-file | test-file | test-file | test-file | test-file | other-file | other-file | other-file | other-file | other-file | other-file | other-file | other-file | config-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | source-file | test-file | test-file | test-file | test-file | other-file | other-file | other-file | config-file | other-file | other-file | other-file | other-file | other-file | other-file | other-file | config-file,"COAR Notify: fixes to Request endorsement pattern implementation to fully adhere to the Notify implementation v1.0 ## Describe the bug The current implementation of COAR Notify in DSpace >= 8.x for the COAR Request endorsement pattern does not fully adhere to the COAR Notify specification (https://coar-notify.net/specification/1.0.0/). Overall, the current implementation works really well, and the proposed fixes are relatively minor. The fixes have been implemented and tested in collaboration with the PCI Service (Peer Community In) which has a full Notify implementation already available, and currently being used by other repositories such as CSIC (Spain) and HAL (France). As a result, the PR associated with this issue will provide fixes to make the implementation fully adhere to Notify 1.0 specification, as well provide a workflow that supports integration with the PCI endorsement services. List of identified issues 1. The current implementation assumes communications between the repository and the endorsement service will be machine to machine (i.e. the offer notification sent by the repository has the actor hardcoded to being the repository service - see https://github.com/DSpace/DSpace/blob/fc544a830987782d90d22c747e12a42ccf9926d7/dspace/config/ldn/request-endorsement#L20) Instead, the endorsement service expects an email address id in the form **mailto:email@example.org""** (e.g. the email and name of the submitter in the actor property) 2. Acknowledgement notifications: the current implementation in DSpace requires that the type property in received notifications includes both a **type (Accept, Reject, etc.)** as well as including the **coar-type (e.g. coar-type:RequestEndorsement)**. If the coar-type is not set, DSpace returns a null pointer error and notifications fails. See https://coar-notify.net/specification/1.0.0/accept/ where the type property is required and must be Accept, in the case of an Accept ack, and so on. Instead, the DSpace implementation could look for the coar-type (as it currently does), and if not present, it should look at inReplyTo property of the received notification and fetch the coar-type from the original notification (coar-type presence is required in the Offer notification, https://coar-notify.net/specification/1.0.0/request-endorsement/). If none present, then it should fail as expected. 3. Acknowledgement notifications the current DSpace implementation requires that the context property is present in received notifications, and uses this to find the associated DSpace object. The presence of context in ack notifications is optional (e.g. https://coar-notify.net/specification/1.0.0/accept/, the ""context"" property is not even mentioned for ack notifications). Therefore DSpace should follow the same approach as in 2.: if the context property is not present, then find it from the object in the associated inReplyTo notification. ## To Reproduce Steps to reproduce the behaviour: To reproduce the behaviour it is needed to set up a connection with PCI's staging/test environment ## Expected behaviour The service should allow to specify whether it requires the repository actor to be an email address, and ideally this should be done via configuration. The most simple implementation could make use of the submitter's email address and name (this approach would require less modifications to the database tables). A more flexible approach (that may not be needed) could allow the submitter to specify an email address (e.g. different to DSpace's submitter email address). The implementation should fully adhere to the current Notify implementation as per description in 2. and 3. ## Related work PR will be coming shortly source-file source-file source-file source-file source-file source-file source-file source-file source-file database-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file test-file other-file other-file other-file other-file other-file other-file other-file other-file config-file database-file test-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file test-file other-file other-file other-file config-file other-file other-file other-file other-file other-file other-file other-file config-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file database-file database-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file test-file test-file test-file test-file test-file other-file other-file other-file other-file other-file other-file other-file other-file config-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file source-file test-file test-file test-file test-file other-file other-file other-file config-file other-file other-file other-file other-file other-file other-file other-file config-file",bug,0.9
2962,DSpace,https://github.com/DSpace/DSpace/issues/2962,CORS policy issue when retrieving bitstream through Angular,"**Describe the bug** During the implementation of the Angular counterpart of the [scripts and processes output](https://github.com/DSpace/DSpace/pull/2934), @MarieVerdonck noticed the following error when retrieving the output bitstream through a GET call of the relevant `process._links.output.href` link >Access to XMLHttpRequest at 'http://localhost:8080/server/api/core/bitstreams/fd4bf164-a876-486d-95a6-d9f24cb23700/content?authentication-token=eyJhbGciOiJIUzI1NiJ9.eyJlaWQiOiJjZDgyNGE2MS05NWJlLTRlMTYtYmNjZC01MWZlYTI2NzA3ZDAiLCJzZyI6W10sImV4cCI6MTU5OTcyNzMzOH0.s3EVCgQjjw1dLq2auJnDCzhb6ze59LxDYgEeX6tHHw0' from origin 'http://localhost:4000' has been blocked by CORS policy: No 'Access-Control-Allow-Origin' header is present on the requested resource. This LOOKS to be CORS related at a first glance, but might need additional investigation as well. **Request**  curl --location --request GET 'http://localhost:8080/server/api/core/bitstreams/fd4bf164-a876-486d-95a6-d9f24cb23700/content' \ --header 'Authorization: Bearer {{currentAccessToken}}'  **Response headers:** ![Screenshot 2020-09-10 at 11 31 53](https://user-images.githubusercontent.com/11884252/92738652-6b4e2880-f37c-11ea-9abc-d5be9ff5b2ac.png) This might be solvable if the CORS headers are properly set through the REST Api, it might also have another underlying issue that is not readily apparent. **To Reproduce** Steps to reproduce the behaviour: 1. Setup [REST PR](https://github.com/DSpace/DSpace/pull/2934) 2. Setup [Angular PR](https://github.com/DSpace/dspace-angular/pull/827) 3. Make sure to trigger a script that keeps output in a file. 4. Try to download that particular output bitstream **Expected behaviour** The bitstream should be properly 'downloaded', no CORS error should be logged, and the information of the logs should be shown in the UI **Related work** https://github.com/DSpace/DSpace/pull/2934 https://github.com/DSpace/dspace-angular/pull/827",source-file | source-file | source-file | source-file | source-file | source-file | source-file | test-file | test-file | test-file | test-file,"CORS policy issue when retrieving bitstream through Angular **Describe the bug** During the implementation of the Angular counterpart of the [scripts and processes output](https://github.com/DSpace/DSpace/pull/2934), @MarieVerdonck noticed the following error when retrieving the output bitstream through a GET call of the relevant `process._links.output.href` link >Access to XMLHttpRequest at 'http://localhost:8080/server/api/core/bitstreams/fd4bf164-a876-486d-95a6-d9f24cb23700/content?authentication-token=eyJhbGciOiJIUzI1NiJ9.eyJlaWQiOiJjZDgyNGE2MS05NWJlLTRlMTYtYmNjZC01MWZlYTI2NzA3ZDAiLCJzZyI6W10sImV4cCI6MTU5OTcyNzMzOH0.s3EVCgQjjw1dLq2auJnDCzhb6ze59LxDYgEeX6tHHw0' from origin 'http://localhost:4000' has been blocked by CORS policy: No 'Access-Control-Allow-Origin' header is present on the requested resource. This LOOKS to be CORS related at a first glance, but might need additional investigation as well. **Request**  curl --location --request GET 'http://localhost:8080/server/api/core/bitstreams/fd4bf164-a876-486d-95a6-d9f24cb23700/content' \ --header 'Authorization: Bearer {{currentAccessToken}}'  **Response headers:** ![Screenshot 2020-09-10 at 11 31 53](https://user-images.githubusercontent.com/11884252/92738652-6b4e2880-f37c-11ea-9abc-d5be9ff5b2ac.png) This might be solvable if the CORS headers are properly set through the REST Api, it might also have another underlying issue that is not readily apparent. **To Reproduce** Steps to reproduce the behaviour: 1. Setup [REST PR](https://github.com/DSpace/DSpace/pull/2934) 2. Setup [Angular PR](https://github.com/DSpace/dspace-angular/pull/827) 3. Make sure to trigger a script that keeps output in a file. 4. Try to download that particular output bitstream **Expected behaviour** The bitstream should be properly 'downloaded', no CORS error should be logged, and the information of the logs should be shown in the UI **Related work** https://github.com/DSpace/DSpace/pull/2934 https://github.com/DSpace/dspace-angular/pull/827 source-file source-file source-file source-file source-file source-file source-file test-file test-file test-file test-file",bug,0.85
9667,DSpace,https://github.com/DSpace/DSpace/issues/9667,Request-a-copy link has subpath stripped from dspace.ui.url,"In a dspace instance configured to run at a subpath, that subpath is stripped when request-a-copy link is generated here: https://github.com/DSpace/DSpace/blob/87f66fbc55cf2b8f8e265d74ce2c902ac2ee7e26/dspace-server-webapp/src/main/java/org/dspace/app/rest/repository/RequestItemRepository.java#L300 URIBuilder.setPathSegments removes any exiting path segments from the base url before adding the new segments.",source-file | test-file | source-file | test-file | source-file | test-file,"Request-a-copy link has subpath stripped from dspace.ui.url In a dspace instance configured to run at a subpath, that subpath is stripped when request-a-copy link is generated here: https://github.com/DSpace/DSpace/blob/87f66fbc55cf2b8f8e265d74ce2c902ac2ee7e26/dspace-server-webapp/src/main/java/org/dspace/app/rest/repository/RequestItemRepository.java#L300 URIBuilder.setPathSegments removes any exiting path segments from the base url before adding the new segments. source-file test-file source-file test-file source-file test-file",bug,0.9
3116,DSpace,https://github.com/DSpace/DSpace/issues/3116,Security issue in discovery,"**Describe the bug** Items under embargo (not the bitstreams) are exposed via Discovery. There's even an IT proving it's broken. The [item](https://github.com/DSpace/DSpace/blob/main/dspace-server-webapp/src/test/java/org/dspace/app/rest/DiscoveryRestControllerIT.java#L1927) has an [embargo period of 12 months](https://github.com/DSpace/DSpace/blob/main/dspace-server-webapp/src/test/java/org/dspace/app/rest/DiscoveryRestControllerIT.java#L1933), but is [accessible via discovery](https://github.com/DSpace/DSpace/blob/main/dspace-server-webapp/src/test/java/org/dspace/app/rest/DiscoveryRestControllerIT.java#L1959) as an [anonymous user](https://github.com/DSpace/DSpace/blob/main/dspace-server-webapp/src/test/java/org/dspace/app/rest/DiscoveryRestControllerIT.java#L1941). This implies there are security bugs: * The [SolrServiceResourceRestrictionPlugin](https://github.com/DSpace/DSpace/blob/main/dspace-api/src/main/java/org/dspace/discovery/SolrServiceResourceRestrictionPlugin.java) doesn't check for dates on permissions, causing the embargoed items to be returned * Discovery ignores the [PreAuthorize permissions check](https://github.com/DSpace/DSpace/blob/main/dspace-server-webapp/src/main/java/org/dspace/app/rest/converter/ConverterService.java#L122) which should ensure the item cannot be returned, not even when it's embedded The issue doesn't occur on the item REST endpoint. An [embargo of 6 months](https://github.com/DSpace/DSpace/blob/main/dspace-server-webapp/src/test/java/org/dspace/app/rest/ItemRestRepositoryIT.java#L1353) is resulting in an [unauthorized](https://github.com/DSpace/DSpace/blob/main/dspace-server-webapp/src/test/java/org/dspace/app/rest/ItemRestRepositoryIT.java#L1379) response.",source-file | test-file | source-file | test-file,"Security issue in discovery **Describe the bug** Items under embargo (not the bitstreams) are exposed via Discovery. There's even an IT proving it's broken. The [item](https://github.com/DSpace/DSpace/blob/main/dspace-server-webapp/src/test/java/org/dspace/app/rest/DiscoveryRestControllerIT.java#L1927) has an [embargo period of 12 months](https://github.com/DSpace/DSpace/blob/main/dspace-server-webapp/src/test/java/org/dspace/app/rest/DiscoveryRestControllerIT.java#L1933), but is [accessible via discovery](https://github.com/DSpace/DSpace/blob/main/dspace-server-webapp/src/test/java/org/dspace/app/rest/DiscoveryRestControllerIT.java#L1959) as an [anonymous user](https://github.com/DSpace/DSpace/blob/main/dspace-server-webapp/src/test/java/org/dspace/app/rest/DiscoveryRestControllerIT.java#L1941). This implies there are security bugs: * The [SolrServiceResourceRestrictionPlugin](https://github.com/DSpace/DSpace/blob/main/dspace-api/src/main/java/org/dspace/discovery/SolrServiceResourceRestrictionPlugin.java) doesn't check for dates on permissions, causing the embargoed items to be returned * Discovery ignores the [PreAuthorize permissions check](https://github.com/DSpace/DSpace/blob/main/dspace-server-webapp/src/main/java/org/dspace/app/rest/converter/ConverterService.java#L122) which should ensure the item cannot be returned, not even when it's embedded The issue doesn't occur on the item REST endpoint. An [embargo of 6 months](https://github.com/DSpace/DSpace/blob/main/dspace-server-webapp/src/test/java/org/dspace/app/rest/ItemRestRepositoryIT.java#L1353) is resulting in an [unauthorized](https://github.com/DSpace/DSpace/blob/main/dspace-server-webapp/src/test/java/org/dspace/app/rest/ItemRestRepositoryIT.java#L1379) response. source-file test-file source-file test-file",bug,0.95
3284,DSpace,https://github.com/DSpace/DSpace/issues/3284,OAI response contains wrong URL for bitstream,"**Describe the bug** The xoai document contains the old style bitstream URL with unreplaced place holder instead that the new one **To Reproduce** Steps to reproduce the behavior: 1. check the xoai response of any record that contains files 2. https://api7.dspace.org/server/oai/request?verb=GetRecord&metadataPrefix=xoai&identifier=oai:demo7.dspace.org:10673/248 3. the url looks like `<field name=""url"">bitstream.baseUrl/bitstream/10673/248/1/Video-Based%20Solution-Focused%20Brief%20Coaching.pdf</field>` **Expected behavior** The bitstream URL should work, the right one is https://demo7.dspace.org/bitstreams/b54bc2e4-e37d-4418-a108-79314f95f5a3/download",source-file | test-file | test-file,"OAI response contains wrong URL for bitstream **Describe the bug** The xoai document contains the old style bitstream URL with unreplaced place holder instead that the new one **To Reproduce** Steps to reproduce the behavior: 1. check the xoai response of any record that contains files 2. https://api7.dspace.org/server/oai/request?verb=GetRecord&metadataPrefix=xoai&identifier=oai:demo7.dspace.org:10673/248 3. the url looks like `<field name=""url"">bitstream.baseUrl/bitstream/10673/248/1/Video-Based%20Solution-Focused%20Brief%20Coaching.pdf</field>` **Expected behavior** The bitstream URL should work, the right one is https://demo7.dspace.org/bitstreams/b54bc2e4-e37d-4418-a108-79314f95f5a3/download source-file test-file test-file",bug,0.95
8888,DSpace,https://github.com/DSpace/DSpace/issues/8888,Shibboleth login leads to an error page when logging in with spaces in a GET request,"**Describe the bug** If you do a search with a space in it, for example ""testing turbine"" & then logging in with shibboleth will result in a ""Unauthorized, status=401"" error. **To Reproduce** Steps to reproduce the behavior: 1. Go to the following page: https://demo7.dspace.org/search?query=testing%20turbine 2. Then login with shibboleth **Expected behavior** Login should work. **Related work** Link to any related tickets or PRs here.",source-file | test-file | source-file | test-file,"Shibboleth login leads to an error page when logging in with spaces in a GET request **Describe the bug** If you do a search with a space in it, for example ""testing turbine"" & then logging in with shibboleth will result in a ""Unauthorized, status=401"" error. **To Reproduce** Steps to reproduce the behavior: 1. Go to the following page: https://demo7.dspace.org/search?query=testing%20turbine 2. Then login with shibboleth **Expected behavior** Login should work. **Related work** Link to any related tickets or PRs here. source-file test-file source-file test-file",bug,0.9
