issue_no,repo,issue_url,title,description,patched_file_types,text_for_topic_modeling,prediction,confidence,combined_text
282,elassandra,https://github.com/strapdata/elassandra/issues/282,Unable to create geo_shape index,"Elassandra version: 6.2.3.13-14 jvm: openjdk version ""1.8.0_212"" OS: Linux 631697ed6903 4.9.0-8-amd64 #1 SMP Debian 4.9.144-3.1 (2019-02-19) x86_64 GNU/Linux docker image: strapdata/elassandra:latest Hello, i'm trying to create geo_shape index for field with following request: PUT http://localhost:9200/weather `{ ""settings"": { ""keyspace"":""weather"" }, ""mappings"": { ""weather_data"" : { ""_source"": { ""enabled"": true }, ""properties"": { ""geom"": { ""type"":""geo_shape"" } } } } }` got the error: `{ ""error"": { ""root_cause"": [ { ""type"": ""mapper_parsing_exception"", ""reason"": ""Failed to execute query:null : Existing column [geom] type [text] mismatch with inferred type [list<text>]"" } ], ""type"": ""mapper_parsing_exception"", ""reason"": ""Failed to execute query:null : Existing column [geom] type [text] mismatch with inferred type [list<text>]"", ""caused_by"": { ""type"": ""configuration_exception"", ""reason"": ""Existing column [geom] type [text] mismatch with inferred type [list<text>]"" } }, ""status"": 400 }` The weather table: `CREATE TABLE weather.weather_data ( id text, updated_at timestamp, alt int, created_at timestamp, es_options text, es_query text, geom text, predict tinyint, radius int, time timestamp, type tinyint, version bigint, weather text, x int, y int, PRIMARY KEY (id, updated_at) ) WITH CLUSTERING ORDER BY (updated_at DESC) AND bloom_filter_fp_chance = 0.01 AND caching = {'keys': 'ALL', 'rows_per_partition': 'NONE'} AND comment = '' AND compaction = {'class': 'org.apache.cassandra.db.compaction.SizeTieredCompactionStrategy', 'max_threshold': '32', 'min_threshold': '4'} AND compression = {'chunk_length_in_kb': '64', 'class': 'org.apache.cassandra.io.compress.LZ4Compressor'} AND crc_check_chance = 1.0 AND dclocal_read_repair_chance = 0.1 AND default_time_to_live = 0 AND gc_grace_seconds = 864000 AND max_index_interval = 2048 AND memtable_flush_period_in_ms = 0 AND min_index_interval = 128 AND read_repair_chance = 0.0 AND speculative_retry = '99PERCENTILE';` Why geo_shape index needs list<text> type? And if add 'cql_collection' parameter to index request: `{ ""settings"": { ""keyspace"":""weather"" }, ""mappings"": { ""weather_data"" : { ""_source"": { ""enabled"": true }, ""properties"": { ""geom"": { ""type"":""geo_shape"", ""cql_collection"":""singleton"" } } } } }` I got the following error: `{ ""error"": { ""root_cause"": [ { ""type"": ""mapper_parsing_exception"", ""reason"": ""Mapping definition for [geom] has unsupported parameters: [cql_collection : singleton]"" } ], ""type"": ""mapper_parsing_exception"", ""reason"": ""Failed to parse mapping [weather_data]: Mapping definition for [geom] has unsupported parameters: [cql_collection : singleton]"", ""caused_by"": { ""type"": ""mapper_parsing_exception"", ""reason"": ""Mapping definition for [geom] has unsupported parameters: [cql_collection : singleton]"" } }, ""status"": 400 }` How can I create geo_shape index with field type 'text'?",source-file | source-file | test-file,unable create geo shape index jvm openjdk linux amd smp debian gnu linux docker image strapdata latest hello trying create geo shape index field following put http localhost weather settings keyspace weather mappings weather data enabled true properties geom type geo shape got root cause type mapper parsing exception reason failed execute query null existing column geom type text mismatch inferred type list text type mapper parsing exception reason failed execute query null existing column geom type text mismatch inferred type list text caused type configuration exception reason existing column geom type text mismatch inferred type list text status weather table create table weather weather data text updated timestamp alt int created timestamp options text query text geom text predict tinyint radius int time timestamp type tinyint bigint weather text int int primary key updated clustering order updated desc bloom filter chance caching keys rows per partition none comment compaction class apache cassandra compaction sizetieredcompactionstrategy max threshold min threshold compression chunk length class apache cassandra compress compressor crc check chance dclocal read repair chance default time live grace seconds max index interval memtable flush period min index interval read repair chance speculative retry percentile geo shape index needs list text type cql collection parameter index settings keyspace weather mappings weather data enabled true properties geom type geo shape cql collection singleton got following root cause type mapper parsing exception reason mapping definition geom unsupported parameters cql collection singleton type mapper parsing exception reason failed parse mapping weather data mapping definition geom unsupported parameters cql collection singleton caused type mapper parsing exception reason mapping definition geom unsupported parameters cql collection singleton status create geo shape index field type text,bug,0.9,"Unable to create geo_shape index Elassandra version: 6.2.3.13-14 jvm: openjdk version ""1.8.0_212"" OS: Linux 631697ed6903 4.9.0-8-amd64 #1 SMP Debian 4.9.144-3.1 (2019-02-19) x86_64 GNU/Linux docker image: strapdata/elassandra:latest Hello, i'm trying to create geo_shape index for field with following request: PUT http://localhost:9200/weather `{ ""settings"": { ""keyspace"":""weather"" }, ""mappings"": { ""weather_data"" : { ""_source"": { ""enabled"": true }, ""properties"": { ""geom"": { ""type"":""geo_shape"" } } } } }` got the error: `{ ""error"": { ""root_cause"": [ { ""type"": ""mapper_parsing_exception"", ""reason"": ""Failed to execute query:null : Existing column [geom] type [text] mismatch with inferred type [list<text>]"" } ], ""type"": ""mapper_parsing_exception"", ""reason"": ""Failed to execute query:null : Existing column [geom] type [text] mismatch with inferred type [list<text>]"", ""caused_by"": { ""type"": ""configuration_exception"", ""reason"": ""Existing column [geom] type [text] mismatch with inferred type [list<text>]"" } }, ""status"": 400 }` The weather table: `CREATE TABLE weather.weather_data ( id text, updated_at timestamp, alt int, created_at timestamp, es_options text, es_query text, geom text, predict tinyint, radius int, time timestamp, type tinyint, version bigint, weather text, x int, y int, PRIMARY KEY (id, updated_at) ) WITH CLUSTERING ORDER BY (updated_at DESC) AND bloom_filter_fp_chance = 0.01 AND caching = {'keys': 'ALL', 'rows_per_partition': 'NONE'} AND comment = '' AND compaction = {'class': 'org.apache.cassandra.db.compaction.SizeTieredCompactionStrategy', 'max_threshold': '32', 'min_threshold': '4'} AND compression = {'chunk_length_in_kb': '64', 'class': 'org.apache.cassandra.io.compress.LZ4Compressor'} AND crc_check_chance = 1.0 AND dclocal_read_repair_chance = 0.1 AND default_time_to_live = 0 AND gc_grace_seconds = 864000 AND max_index_interval = 2048 AND memtable_flush_period_in_ms = 0 AND min_index_interval = 128 AND read_repair_chance = 0.0 AND speculative_retry = '99PERCENTILE';` Why geo_shape index needs list<text> type? And if add 'cql_collection' parameter to index request: `{ ""settings"": { ""keyspace"":""weather"" }, ""mappings"": { ""weather_data"" : { ""_source"": { ""enabled"": true }, ""properties"": { ""geom"": { ""type"":""geo_shape"", ""cql_collection"":""singleton"" } } } } }` I got the following error: `{ ""error"": { ""root_cause"": [ { ""type"": ""mapper_parsing_exception"", ""reason"": ""Mapping definition for [geom] has unsupported parameters: [cql_collection : singleton]"" } ], ""type"": ""mapper_parsing_exception"", ""reason"": ""Failed to parse mapping [weather_data]: Mapping definition for [geom] has unsupported parameters: [cql_collection : singleton]"", ""caused_by"": { ""type"": ""mapper_parsing_exception"", ""reason"": ""Mapping definition for [geom] has unsupported parameters: [cql_collection : singleton]"" } }, ""status"": 400 }` How can I create geo_shape index with field type 'text'?"
70,elassandra,https://github.com/strapdata/elassandra/issues/70,ES DELETE by index/type fails for time-series indices,"There seems to be a possible bug or difference in the way plan indices are handled (ie: test_index) vs. timeseries indices (ie: test-2017.01.01) particularly evident on DELETE actions:  Successful DELETE: test_index <pre> DELETE test_index PUT _template/test_template { ""template"": ""test_index"", ""mappings"": { ""_default_"": { ""properties"": { ""attachment"": { ""type"": ""binary"" }, ""report"": { ""type"": ""boolean"" }, ""payload"": { ""type"": ""object"", ""enabled"": false } } } } } PUT test_index/test_type/test12 { ""@timestamp"": ""2016-12-27T19:14:00.012Z"", ""level"": ""INFO"", ""message"": ""test message"", ""action"": ""test_action"", ""payload"": {}, ""report"": false } DELETE test_index/test_type/test12 </pre>  Failed DELETE on index: test_index-2016.12.29 <pre> DELETE test_index* PUT _template/test_template { ""template"": ""test_index-*"", ""mappings"": { ""_default_"": { ""properties"": { ""attachment"": { ""type"": ""binary"" }, ""report"": { ""type"": ""boolean"" }, ""payload"": { ""type"": ""object"", ""enabled"": false } } } } } PUT test_index-2016.12.29/test_type/test12 { ""@timestamp"": ""2016-12-27T19:14:00.012Z"", ""level"": ""INFO"", ""message"": ""test message"", ""action"": ""test_action"", ""payload"": {}, ""report"": false } GET test_index-2016.12.29/_search DELETE test_index-2016.12.29/test_type/test12 </pre> Which results in the following error: <pre> { ""error"": { ""root_cause"": [ { ""type"": ""action_request_validation_exception"", ""reason"": ""Validation Failed: 1: test_index-2016.12.29.test_type table does not exists;"" } ], ""type"": ""action_request_validation_exception"", ""reason"": ""Validation Failed: 1: test_index-2016.12.29.test_type table does not exists;"" }, ""status"": 400 } </pre> Any suggestion as of what might be causing this?",source-file | source-file | source-file | test-file,delete index type fails time series indices seems possible bug difference way plan indices handled index timeseries indices particularly evident delete actions successful delete index pre delete index put template template template index mappings default properties attachment type binary report type boolean payload type object enabled false put index type timestamp level message message action action payload report false delete index type pre failed delete index index pre delete index put template template template index mappings default properties attachment type binary report type boolean payload type object enabled false put index type timestamp level message message action action payload report false get index search delete index type pre results following pre root cause type action validation exception reason validation failed index type table exists type action validation exception reason validation failed index type table exists status pre suggestion might causing,bug,0.9,"ES DELETE by index/type fails for time-series indices There seems to be a possible bug or difference in the way plan indices are handled (ie: test_index) vs. timeseries indices (ie: test-2017.01.01) particularly evident on DELETE actions:  Successful DELETE: test_index <pre> DELETE test_index PUT _template/test_template { ""template"": ""test_index"", ""mappings"": { ""_default_"": { ""properties"": { ""attachment"": { ""type"": ""binary"" }, ""report"": { ""type"": ""boolean"" }, ""payload"": { ""type"": ""object"", ""enabled"": false } } } } } PUT test_index/test_type/test12 { ""@timestamp"": ""2016-12-27T19:14:00.012Z"", ""level"": ""INFO"", ""message"": ""test message"", ""action"": ""test_action"", ""payload"": {}, ""report"": false } DELETE test_index/test_type/test12 </pre>  Failed DELETE on index: test_index-2016.12.29 <pre> DELETE test_index* PUT _template/test_template { ""template"": ""test_index-*"", ""mappings"": { ""_default_"": { ""properties"": { ""attachment"": { ""type"": ""binary"" }, ""report"": { ""type"": ""boolean"" }, ""payload"": { ""type"": ""object"", ""enabled"": false } } } } } PUT test_index-2016.12.29/test_type/test12 { ""@timestamp"": ""2016-12-27T19:14:00.012Z"", ""level"": ""INFO"", ""message"": ""test message"", ""action"": ""test_action"", ""payload"": {}, ""report"": false } GET test_index-2016.12.29/_search DELETE test_index-2016.12.29/test_type/test12 </pre> Which results in the following error: <pre> { ""error"": { ""root_cause"": [ { ""type"": ""action_request_validation_exception"", ""reason"": ""Validation Failed: 1: test_index-2016.12.29.test_type table does not exists;"" } ], ""type"": ""action_request_validation_exception"", ""reason"": ""Validation Failed: 1: test_index-2016.12.29.test_type table does not exists;"" }, ""status"": 400 } </pre> Any suggestion as of what might be causing this?"
163,elassandra,https://github.com/strapdata/elassandra/issues/163,Invalid date mapping,"<!-- GitHub is reserved for bug reports and feature requests. The best place to ask a general question is at the Elastic Discourse forums at https://discuss.elastic.co. If you are in fact posting a bug report or a feature request, please include one and only one of the below blocks in your new issue. Note that whether you're filing a bug report or a feature request, ensure that your submission is for an [OS that we support](https://www.elastic.co/support/matrix#show_os). Bug reports on an OS that we do not support or feature requests specific to an OS that we do not support will be closed. --> <!-- If you are filing a bug report, please remove the below feature request block and provide responses for all of the below items. --> **Elasticsearch version**: 5.5.0 **Plugins installed**: [] **JVM version**: 8 **OS version**: **Description of the problem including expected versus actual behavior**: **Steps to reproduce**: 1. create table with date field  create table date_elassandra_test ( id int primary key, somedate date );  2. create mapping on it  PUT http://node:9200/myspace/date_elassandra_test/_mapping { ""date_elassandra_test"": { ""properties"": { ""somedate"": { ""type"": ""date"", ""cql_collection"": ""singleton"" } } } }  3. insert some data `insert into date_elassandra_test (id,somedate) values (1,'2018-02-03');` 4. check search result  POST http://node:9200/myspace/date_elassandra_test/_search  {  ""_source"": { ""somedate"": ""-5877593-07-26T00:00:00.000Z"" }  } As you see - somedate is somehow offseted date for ElasticSearch. But if TIMESTAMP cassandra type is used instead - all is well",source-file | source-file | test-file | documentation-file,invalid date mapping github reserved bug reports feature requests best place ask general question elastic discourse forums https discuss elastic fact posting bug report feature please include one one blocks new note whether filing bug report feature ensure submission https www elastic matrix show bug reports feature requests specific closed filing bug report please feature block provide responses items plugins installed jvm description including expected versus actual behavior steps reproduce create table date field create table date int primary key somedate date create mapping put http node myspace date mapping date properties somedate type date cql collection singleton insert data insert date somedate values check search result post http node myspace date search somedate see somedate somehow offseted date timestamp cassandra type used instead well,bug,0.9,"Invalid date mapping <!-- GitHub is reserved for bug reports and feature requests. The best place to ask a general question is at the Elastic Discourse forums at https://discuss.elastic.co. If you are in fact posting a bug report or a feature request, please include one and only one of the below blocks in your new issue. Note that whether you're filing a bug report or a feature request, ensure that your submission is for an [OS that we support](https://www.elastic.co/support/matrix#show_os). Bug reports on an OS that we do not support or feature requests specific to an OS that we do not support will be closed. --> <!-- If you are filing a bug report, please remove the below feature request block and provide responses for all of the below items. --> **Elasticsearch version**: 5.5.0 **Plugins installed**: [] **JVM version**: 8 **OS version**: **Description of the problem including expected versus actual behavior**: **Steps to reproduce**: 1. create table with date field  create table date_elassandra_test ( id int primary key, somedate date );  2. create mapping on it  PUT http://node:9200/myspace/date_elassandra_test/_mapping { ""date_elassandra_test"": { ""properties"": { ""somedate"": { ""type"": ""date"", ""cql_collection"": ""singleton"" } } } }  3. insert some data `insert into date_elassandra_test (id,somedate) values (1,'2018-02-03');` 4. check search result  POST http://node:9200/myspace/date_elassandra_test/_search  {  ""_source"": { ""somedate"": ""-5877593-07-26T00:00:00.000Z"" }  } As you see - somedate is somehow offseted date for ElasticSearch. But if TIMESTAMP cassandra type is used instead - all is well"
65,elassandra,https://github.com/strapdata/elassandra/issues/65,java.io.IOException: from is a reserved keyword,"Bonjour Vincent, Using latest build, I am attempting to create custom index mapping including object types resulting in a faceted issue - filing them together as they seem two faces of the same coin so to speak.  java.io.IOException: from is a reserved keyword  PUT watcher { ""mappings"": { ""watch"": { ""properties"": { ""id"": { ""type"": ""string"", ""index"": ""not_analyzed"" }, ""condition"": { ""type"":""object"", ""enabled"": false }, ""input"": { ""type"":""object"", ""enabled"": false }, ""transform"": { ""type"":""object"", ""enabled"": false } } } } }  followed by a document creation attempt:  PUT watcher/watch/test_watch_random { ""disabled"": false, ""id"": ""test_watch_random"", ""trigger"": { ""schedule"": { ""later"": ""every 5 minutes"" } }, ""input"": { ""search"": { ""request"": { ""index"": [], ""body"": {} } } }, ""condition"": { ""script"": { ""script"": ""payload.hits.total > 100"" } }, ""transform"": {}, ""actions"": { ""email_admin"": { ""throttle_period"": ""15m"", ""email"": { ""to"": ""alarm@localhost"", ""from"": ""sentinl@localhost"", ""subject"": ""Sentinl Alarm"", ""priority"": ""high"", ""body"": ""Found {{payload.hits.total}} Events"" } } } }  The first response of Elassandra is:  { ""error"": { ""root_cause"": [ { ""type"": ""runtime_exception"", ""reason"": ""java.io.IOException: from is a reserved keyword"" } ], ""type"": ""runtime_exception"", ""reason"": ""java.io.IOException: from is a reserved keyword"", ""caused_by"": { ""type"": ""i_o_exception"", ""reason"": ""from is a reserved keyword"", ""caused_by"": { ""type"": ""configuration_exception"", ""reason"": ""from is a reserved keyword"" } } }, ""status"": 500 }  with logs:  2016-12-26 08:51:11,257 WARN [elasticsearch[127.0.0.1][http_server_worker][T#3]{New I/O worker #53}] BytesRestResponse.java:134 convert path: /watcher2/watch/test_watch_random, params: {index=watcher2, id=test_watch_random, type=watch} java.lang.RuntimeException: java.io.IOException: from is a reserved keyword at org.elassandra.cluster.InternalCassandraClusterService$BlockingActionListener.waitForUpdate(InternalCassandraClusterService.java:1820) at org.elassandra.cluster.InternalCassandraClusterService.blockingMappingUpdate(InternalCassandraClusterService.java:1842) at org.elassandra.cluster.InternalCassandraClusterService.upsertDocument(InternalCassandraClusterService.java:1879) at org.elassandra.cluster.InternalCassandraClusterService.insertDocument(InternalCassandraClusterService.java:1852) at org.elasticsearch.action.index.TransportXIndexAction.innerExecute(TransportXIndexAction.java:85) at org.elasticsearch.action.index.TransportIndexAction.doExecute(TransportIndexAction.java:120) at org.elasticsearch.action.index.TransportIndexAction.doExecute(TransportIndexAction.java:66) at org.elasticsearch.action.support.TransportAction.execute(TransportAction.java:137) at org.elasticsearch.action.support.TransportAction.execute(TransportAction.java:85) at org.elasticsearch.client.node.NodeClient.doExecute(NodeClient.java:58) at org.elasticsearch.client.support.AbstractClient.execute(AbstractClient.java:359) at org.elasticsearch.client.FilterClient.doExecute(FilterClient.java:52) at org.elasticsearch.rest.BaseRestHandler$HeadersAndContextCopyClient.doExecute(BaseRestHandler.java:88) at org.elasticsearch.client.support.AbstractClient.execute(AbstractClient.java:359) at org.elasticsearch.client.support.AbstractClient.index(AbstractClient.java:371) at org.elasticsearch.rest.action.index.RestIndexAction.handleRequest(RestIndexAction.java:105) at org.elasticsearch.rest.BaseRestHandler.handleRequest(BaseRestHandler.java:54) at org.elasticsearch.rest.RestController.executeHandler(RestController.java:198) at org.elasticsearch.rest.RestController.dispatchRequest(RestController.java:158) at org.elasticsearch.http.HttpServer.internalDispatchRequest(HttpServer.java:153) at org.elasticsearch.http.HttpServer$Dispatcher.dispatchRequest(HttpServer.java:101) at org.elasticsearch.http.netty.NettyHttpServerTransport.dispatchRequest(NettyHttpServerTransport.java:451) at org.elasticsearch.http.netty.HttpRequestHandler.messageReceived(HttpRequestHandler.java:61) at org.jboss.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:70) at org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564) at org.jboss.netty.channel.DefaultChannelPipeline$DefaultChannelHandlerContext.sendUpstream(DefaultChannelPipeline.java:791) at org.elasticsearch.http.netty.pipelining.HttpPipeliningHandler.messageReceived(HttpPipeliningHandler.java:60) at org.jboss.netty.channel.SimpleChannelHandler.handleUpstream(SimpleChannelHandler.java:88) at org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564) at org.jboss.netty.channel.DefaultChannelPipeline$DefaultChannelHandlerContext.sendUpstream(DefaultChannelPipeline.java:791) at org.jboss.netty.handler.codec.http.HttpChunkAggregator.messageReceived(HttpChunkAggregator.java:145) at org.jboss.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:70) at org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564) at org.jboss.netty.channel.DefaultChannelPipeline$DefaultChannelHandlerContext.sendUpstream(DefaultChannelPipeline.java:791) at org.jboss.netty.handler.codec.http.HttpContentDecoder.messageReceived(HttpContentDecoder.java:108) at org.jboss.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:70) at org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564) at org.jboss.netty.channel.DefaultChannelPipeline$DefaultChannelHandlerContext.sendUpstream(DefaultChannelPipeline.java:791) at org.jboss.netty.channel.Channels.fireMessageReceived(Channels.java:296) at org.jboss.netty.handler.codec.frame.FrameDecoder.unfoldAndFireMessageReceived(FrameDecoder.java:459) at org.jboss.netty.handler.codec.replay.ReplayingDecoder.callDecode(ReplayingDecoder.java:536) at org.jboss.netty.handler.codec.replay.ReplayingDecoder.messageReceived(ReplayingDecoder.java:435) at org.jboss.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:70) at org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564) at org.jboss.netty.channel.DefaultChannelPipeline$DefaultChannelHandlerContext.sendUpstream(DefaultChannelPipeline.java:791) at org.elasticsearch.common.netty.OpenChannelsHandler.handleUpstream(OpenChannelsHandler.java:75) at org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564) at org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:559) at org.jboss.netty.channel.Channels.fireMessageReceived(Channels.java:268) at org.jboss.netty.channel.Channels.fireMessageReceived(Channels.java:255) at org.jboss.netty.channel.socket.nio.NioWorker.read(NioWorker.java:88) at org.jboss.netty.channel.socket.nio.AbstractNioWorker.process(AbstractNioWorker.java:108) at org.jboss.netty.channel.socket.nio.AbstractNioSelector.run(AbstractNioSelector.java:337) at org.jboss.netty.channel.socket.nio.AbstractNioWorker.run(AbstractNioWorker.java:89) at org.jboss.netty.channel.socket.nio.NioWorker.run(NioWorker.java:178) at org.jboss.netty.util.ThreadRenamingRunnable.run(ThreadRenamingRunnable.java:108) at org.jboss.netty.util.internal.DeadLockProofWorker$1.run(DeadLockProofWorker.java:42) at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) at java.lang.Thread.run(Thread.java:745) Caused by: java.io.IOException: from is a reserved keyword at org.elassandra.cluster.InternalCassandraClusterService.updateTableSchema(InternalCassandraClusterService.java:1185) at org.elasticsearch.cluster.metadata.MetaDataMappingService$PutMappingExecutor.applyRequest(MetaDataMappingService.java:391) at org.elasticsearch.cluster.metadata.MetaDataMappingService$PutMappingExecutor.execute(MetaDataMappingService.java:280) at org.elasticsearch.cluster.service.InternalClusterService.runTasksForExecutor(InternalClusterService.java:540) at org.elasticsearch.cluster.service.InternalClusterService$UpdateTask.run(InternalClusterService.java:902) at org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.runAndClean(PrioritizedEsThreadPoolExecutor.java:231) at org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.run(PrioritizedEsThreadPoolExecutor.java:194)  3 common frames omitted Caused by: org.apache.cassandra.exceptions.ConfigurationException: from is a reserved keyword at org.elassandra.cluster.InternalCassandraClusterService.buildUDT(InternalCassandraClusterService.java:795) at org.elassandra.cluster.InternalCassandraClusterService.buildCql(InternalCassandraClusterService.java:744) at org.elassandra.cluster.InternalCassandraClusterService.buildUDT(InternalCassandraClusterService.java:772) at org.elassandra.cluster.InternalCassandraClusterService.buildCql(InternalCassandraClusterService.java:744) at org.elassandra.cluster.InternalCassandraClusterService.buildUDT(InternalCassandraClusterService.java:772) at org.elassandra.cluster.InternalCassandraClusterService.buildCql(InternalCassandraClusterService.java:744) at org.elassandra.cluster.InternalCassandraClusterService.updateTableSchema(InternalCassandraClusterService.java:1093)  9 common frames omitted  Interestingly, attempting the very same insert unchanged, works:  { ""_index"": ""watcher"", ""_type"": ""watch"", ""_id"": ""test_watch_random"", ""_version"": 1, ""_shards"": { ""total"": 1, ""successful"": 1, ""failed"": 0 }, ""created"": true }  and gets indexed correctly:  GET watcher/_search { ""took"": 5, ""timed_out"": false, ""_shards"": { ""total"": 1, ""successful"": 1, ""failed"": 0 }, ""hits"": { ""total"": 1, ""max_score"": 1, ""hits"": [ { ""_index"": ""watcher"", ""_type"": ""watch"", ""_id"": ""test_watch_random"", ""_score"": 1, ""_source"": { ""input"": ""{\""search\"":{\""request\"":{\""index\"":[],\""body\"":{"", ""condition"": ""{\""script\"":{\""script\"":\""payload.hits.total > 100\""}}"", ""transform"": ""{}"", ""id"": ""test_name"" } } ] } }   Pure Object documents not searchable Attempting to create a mapping without an ""enabled"" field seems to fail harder - the above mapping/document without the ""string"" id field is accepted but returns no search results afterwards. Here's an adapted example to reproduce:  PUT watcher_fail { ""mappings"": { ""watch"": { ""properties"": { ""condition"": { ""type"":""object"", ""enabled"": false }, ""input"": { ""type"":""object"", ""enabled"": false }, ""transform"": { ""type"":""object"", ""enabled"": false } } } } }  followed by a document creation attempt:  PUT watcher_fail/watch/this_doc_will_be_missing { ""trigger"": { ""schedule"": { ""later"": ""every 5 minutes"" } }, ""input"": { ""search"": { ""request"": { ""index"": [], ""body"": {} } } }, ""condition"": { ""script"": { ""script"": ""payload.hits.total > 100"" } }, ""transform"": {}, ""actions"": { ""email_admin"": { ""throttle_period"": ""15m"", ""email"": { ""to"": ""alarm@localhost"", ""from"": ""sentinl@localhost"", ""subject"": ""Sentinl Alarm"", ""priority"": ""high"", ""body"": ""Found {{payload.hits.total}} Events"" } } } }  The above document should get accepted, but will never be available in search:  GET watcher_fail/_search ",source-file,ioexception reserved keyword bonjour vincent latest attempting create custom index mapping including object types resulting faceted filing together seem two faces coin speak ioexception reserved keyword put watcher mappings watch properties type string index analyzed condition type object enabled false input type object enabled false transform type object enabled false followed document creation attempt put watcher watch watch random disabled false watch random trigger schedule later every minutes input search index body condition script script payload hits total transform actions email admin throttle period email alarm localhost sentinl localhost subject sentinl alarm priority high body found payload hits total events first response root cause type runtime exception reason ioexception reserved keyword type runtime exception reason ioexception reserved keyword caused type exception reason reserved keyword caused type configuration exception reason reserved keyword status logs warn http server worker new worker bytesrestresponse convert path watcher watch watch random params index watcher watch random type watch lang runtimeexception ioexception reserved keyword cluster internalcassandraclusterservice blockingactionlistener waitforupdate internalcassandraclusterservice cluster internalcassandraclusterservice blockingmappingupdate internalcassandraclusterservice cluster internalcassandraclusterservice upsertdocument internalcassandraclusterservice cluster internalcassandraclusterservice insertdocument internalcassandraclusterservice action index transportxindexaction innerexecute transportxindexaction action index transportindexaction doexecute transportindexaction action index transportindexaction doexecute transportindexaction action transportaction execute transportaction action transportaction execute transportaction client node nodeclient doexecute nodeclient client abstractclient execute abstractclient client filterclient doexecute filterclient rest baseresthandler headersandcontextcopyclient doexecute baseresthandler client abstractclient execute abstractclient client abstractclient index abstractclient rest action index restindexaction handlerequest restindexaction rest baseresthandler handlerequest baseresthandler rest restcontroller executehandler restcontroller rest restcontroller dispatchrequest restcontroller http httpserver internaldispatchrequest httpserver http httpserver dispatcher dispatchrequest httpserver http netty nettyhttpservertransport dispatchrequest nettyhttpservertransport http netty httprequesthandler messagereceived httprequesthandler jboss netty channel simplechannelupstreamhandler handleupstream simplechannelupstreamhandler jboss netty channel defaultchannelpipeline sendupstream defaultchannelpipeline jboss netty channel defaultchannelpipeline defaultchannelhandlercontext sendupstream defaultchannelpipeline http netty pipelining httppipelininghandler messagereceived httppipelininghandler jboss netty channel simplechannelhandler handleupstream simplechannelhandler jboss netty channel defaultchannelpipeline sendupstream defaultchannelpipeline jboss netty channel defaultchannelpipeline defaultchannelhandlercontext sendupstream defaultchannelpipeline jboss netty handler codec http httpchunkaggregator messagereceived httpchunkaggregator jboss netty channel simplechannelupstreamhandler handleupstream simplechannelupstreamhandler jboss netty channel defaultchannelpipeline sendupstream defaultchannelpipeline jboss netty channel defaultchannelpipeline defaultchannelhandlercontext sendupstream defaultchannelpipeline jboss netty handler codec http httpcontentdecoder messagereceived httpcontentdecoder jboss netty channel simplechannelupstreamhandler handleupstream simplechannelupstreamhandler jboss netty channel defaultchannelpipeline sendupstream defaultchannelpipeline jboss netty channel defaultchannelpipeline defaultchannelhandlercontext sendupstream defaultchannelpipeline jboss netty channel channels firemessagereceived channels jboss netty handler codec frame framedecoder unfoldandfiremessagereceived framedecoder jboss netty handler codec replay replayingdecoder calldecode replayingdecoder jboss netty handler codec replay replayingdecoder messagereceived replayingdecoder jboss netty channel simplechannelupstreamhandler handleupstream simplechannelupstreamhandler jboss netty channel defaultchannelpipeline sendupstream defaultchannelpipeline jboss netty channel defaultchannelpipeline defaultchannelhandlercontext sendupstream defaultchannelpipeline common netty openchannelshandler handleupstream openchannelshandler jboss netty channel defaultchannelpipeline sendupstream defaultchannelpipeline jboss netty channel defaultchannelpipeline sendupstream defaultchannelpipeline jboss netty channel channels firemessagereceived channels jboss netty channel channels firemessagereceived channels jboss netty channel socket nio nioworker read nioworker jboss netty channel socket nio abstractnioworker process abstractnioworker jboss netty channel socket nio abstractnioselector abstractnioselector jboss netty channel socket nio abstractnioworker abstractnioworker jboss netty channel socket nio nioworker nioworker jboss netty util threadrenamingrunnable threadrenamingrunnable jboss netty util internal deadlockproofworker deadlockproofworker util concurrent threadpoolexecutor runworker threadpoolexecutor util concurrent threadpoolexecutor worker threadpoolexecutor lang thread thread caused ioexception reserved keyword cluster internalcassandraclusterservice updatetableschema internalcassandraclusterservice cluster metadata metadatamappingservice putmappingexecutor applyrequest metadatamappingservice cluster metadata metadatamappingservice putmappingexecutor execute metadatamappingservice cluster service internalclusterservice runtasksforexecutor internalclusterservice cluster service internalclusterservice updatetask internalclusterservice common util concurrent prioritizedesthreadpoolexecutor tiebreakingprioritizedrunnable runandclean prioritizedesthreadpoolexecutor common util concurrent prioritizedesthreadpoolexecutor tiebreakingprioritizedrunnable prioritizedesthreadpoolexecutor common frames omitted caused apache cassandra exceptions configurationexception reserved keyword cluster internalcassandraclusterservice buildudt internalcassandraclusterservice cluster internalcassandraclusterservice buildcql internalcassandraclusterservice cluster internalcassandraclusterservice buildudt internalcassandraclusterservice cluster internalcassandraclusterservice buildcql internalcassandraclusterservice cluster internalcassandraclusterservice buildudt internalcassandraclusterservice cluster internalcassandraclusterservice buildcql internalcassandraclusterservice cluster internalcassandraclusterservice updatetableschema internalcassandraclusterservice common frames omitted interestingly attempting insert unchanged works index watcher type watch watch random shards total successful failed created true gets indexed correctly get watcher search took timed false shards total successful failed hits total max score hits index watcher type watch watch random score input search index body condition script script payload hits total transform name pure object documents searchable attempting create mapping without enabled field seems fail harder mapping document without string field accepted returns search results afterwards adapted example reproduce put watcher fail mappings watch properties condition type object enabled false input type object enabled false transform type object enabled false followed document creation attempt put watcher fail watch missing trigger schedule later every minutes input search index body condition script script payload hits total transform actions email admin throttle period email alarm localhost sentinl localhost subject sentinl alarm priority high body found payload hits total events document get accepted never available search get watcher fail search,bug,0.9,"java.io.IOException: from is a reserved keyword Bonjour Vincent, Using latest build, I am attempting to create custom index mapping including object types resulting in a faceted issue - filing them together as they seem two faces of the same coin so to speak.  java.io.IOException: from is a reserved keyword  PUT watcher { ""mappings"": { ""watch"": { ""properties"": { ""id"": { ""type"": ""string"", ""index"": ""not_analyzed"" }, ""condition"": { ""type"":""object"", ""enabled"": false }, ""input"": { ""type"":""object"", ""enabled"": false }, ""transform"": { ""type"":""object"", ""enabled"": false } } } } }  followed by a document creation attempt:  PUT watcher/watch/test_watch_random { ""disabled"": false, ""id"": ""test_watch_random"", ""trigger"": { ""schedule"": { ""later"": ""every 5 minutes"" } }, ""input"": { ""search"": { ""request"": { ""index"": [], ""body"": {} } } }, ""condition"": { ""script"": { ""script"": ""payload.hits.total > 100"" } }, ""transform"": {}, ""actions"": { ""email_admin"": { ""throttle_period"": ""15m"", ""email"": { ""to"": ""alarm@localhost"", ""from"": ""sentinl@localhost"", ""subject"": ""Sentinl Alarm"", ""priority"": ""high"", ""body"": ""Found {{payload.hits.total}} Events"" } } } }  The first response of Elassandra is:  { ""error"": { ""root_cause"": [ { ""type"": ""runtime_exception"", ""reason"": ""java.io.IOException: from is a reserved keyword"" } ], ""type"": ""runtime_exception"", ""reason"": ""java.io.IOException: from is a reserved keyword"", ""caused_by"": { ""type"": ""i_o_exception"", ""reason"": ""from is a reserved keyword"", ""caused_by"": { ""type"": ""configuration_exception"", ""reason"": ""from is a reserved keyword"" } } }, ""status"": 500 }  with logs:  2016-12-26 08:51:11,257 WARN [elasticsearch[127.0.0.1][http_server_worker][T#3]{New I/O worker #53}] BytesRestResponse.java:134 convert path: /watcher2/watch/test_watch_random, params: {index=watcher2, id=test_watch_random, type=watch} java.lang.RuntimeException: java.io.IOException: from is a reserved keyword at org.elassandra.cluster.InternalCassandraClusterService$BlockingActionListener.waitForUpdate(InternalCassandraClusterService.java:1820) at org.elassandra.cluster.InternalCassandraClusterService.blockingMappingUpdate(InternalCassandraClusterService.java:1842) at org.elassandra.cluster.InternalCassandraClusterService.upsertDocument(InternalCassandraClusterService.java:1879) at org.elassandra.cluster.InternalCassandraClusterService.insertDocument(InternalCassandraClusterService.java:1852) at org.elasticsearch.action.index.TransportXIndexAction.innerExecute(TransportXIndexAction.java:85) at org.elasticsearch.action.index.TransportIndexAction.doExecute(TransportIndexAction.java:120) at org.elasticsearch.action.index.TransportIndexAction.doExecute(TransportIndexAction.java:66) at org.elasticsearch.action.support.TransportAction.execute(TransportAction.java:137) at org.elasticsearch.action.support.TransportAction.execute(TransportAction.java:85) at org.elasticsearch.client.node.NodeClient.doExecute(NodeClient.java:58) at org.elasticsearch.client.support.AbstractClient.execute(AbstractClient.java:359) at org.elasticsearch.client.FilterClient.doExecute(FilterClient.java:52) at org.elasticsearch.rest.BaseRestHandler$HeadersAndContextCopyClient.doExecute(BaseRestHandler.java:88) at org.elasticsearch.client.support.AbstractClient.execute(AbstractClient.java:359) at org.elasticsearch.client.support.AbstractClient.index(AbstractClient.java:371) at org.elasticsearch.rest.action.index.RestIndexAction.handleRequest(RestIndexAction.java:105) at org.elasticsearch.rest.BaseRestHandler.handleRequest(BaseRestHandler.java:54) at org.elasticsearch.rest.RestController.executeHandler(RestController.java:198) at org.elasticsearch.rest.RestController.dispatchRequest(RestController.java:158) at org.elasticsearch.http.HttpServer.internalDispatchRequest(HttpServer.java:153) at org.elasticsearch.http.HttpServer$Dispatcher.dispatchRequest(HttpServer.java:101) at org.elasticsearch.http.netty.NettyHttpServerTransport.dispatchRequest(NettyHttpServerTransport.java:451) at org.elasticsearch.http.netty.HttpRequestHandler.messageReceived(HttpRequestHandler.java:61) at org.jboss.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:70) at org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564) at org.jboss.netty.channel.DefaultChannelPipeline$DefaultChannelHandlerContext.sendUpstream(DefaultChannelPipeline.java:791) at org.elasticsearch.http.netty.pipelining.HttpPipeliningHandler.messageReceived(HttpPipeliningHandler.java:60) at org.jboss.netty.channel.SimpleChannelHandler.handleUpstream(SimpleChannelHandler.java:88) at org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564) at org.jboss.netty.channel.DefaultChannelPipeline$DefaultChannelHandlerContext.sendUpstream(DefaultChannelPipeline.java:791) at org.jboss.netty.handler.codec.http.HttpChunkAggregator.messageReceived(HttpChunkAggregator.java:145) at org.jboss.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:70) at org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564) at org.jboss.netty.channel.DefaultChannelPipeline$DefaultChannelHandlerContext.sendUpstream(DefaultChannelPipeline.java:791) at org.jboss.netty.handler.codec.http.HttpContentDecoder.messageReceived(HttpContentDecoder.java:108) at org.jboss.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:70) at org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564) at org.jboss.netty.channel.DefaultChannelPipeline$DefaultChannelHandlerContext.sendUpstream(DefaultChannelPipeline.java:791) at org.jboss.netty.channel.Channels.fireMessageReceived(Channels.java:296) at org.jboss.netty.handler.codec.frame.FrameDecoder.unfoldAndFireMessageReceived(FrameDecoder.java:459) at org.jboss.netty.handler.codec.replay.ReplayingDecoder.callDecode(ReplayingDecoder.java:536) at org.jboss.netty.handler.codec.replay.ReplayingDecoder.messageReceived(ReplayingDecoder.java:435) at org.jboss.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:70) at org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564) at org.jboss.netty.channel.DefaultChannelPipeline$DefaultChannelHandlerContext.sendUpstream(DefaultChannelPipeline.java:791) at org.elasticsearch.common.netty.OpenChannelsHandler.handleUpstream(OpenChannelsHandler.java:75) at org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564) at org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:559) at org.jboss.netty.channel.Channels.fireMessageReceived(Channels.java:268) at org.jboss.netty.channel.Channels.fireMessageReceived(Channels.java:255) at org.jboss.netty.channel.socket.nio.NioWorker.read(NioWorker.java:88) at org.jboss.netty.channel.socket.nio.AbstractNioWorker.process(AbstractNioWorker.java:108) at org.jboss.netty.channel.socket.nio.AbstractNioSelector.run(AbstractNioSelector.java:337) at org.jboss.netty.channel.socket.nio.AbstractNioWorker.run(AbstractNioWorker.java:89) at org.jboss.netty.channel.socket.nio.NioWorker.run(NioWorker.java:178) at org.jboss.netty.util.ThreadRenamingRunnable.run(ThreadRenamingRunnable.java:108) at org.jboss.netty.util.internal.DeadLockProofWorker$1.run(DeadLockProofWorker.java:42) at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) at java.lang.Thread.run(Thread.java:745) Caused by: java.io.IOException: from is a reserved keyword at org.elassandra.cluster.InternalCassandraClusterService.updateTableSchema(InternalCassandraClusterService.java:1185) at org.elasticsearch.cluster.metadata.MetaDataMappingService$PutMappingExecutor.applyRequest(MetaDataMappingService.java:391) at org.elasticsearch.cluster.metadata.MetaDataMappingService$PutMappingExecutor.execute(MetaDataMappingService.java:280) at org.elasticsearch.cluster.service.InternalClusterService.runTasksForExecutor(InternalClusterService.java:540) at org.elasticsearch.cluster.service.InternalClusterService$UpdateTask.run(InternalClusterService.java:902) at org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.runAndClean(PrioritizedEsThreadPoolExecutor.java:231) at org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.run(PrioritizedEsThreadPoolExecutor.java:194)  3 common frames omitted Caused by: org.apache.cassandra.exceptions.ConfigurationException: from is a reserved keyword at org.elassandra.cluster.InternalCassandraClusterService.buildUDT(InternalCassandraClusterService.java:795) at org.elassandra.cluster.InternalCassandraClusterService.buildCql(InternalCassandraClusterService.java:744) at org.elassandra.cluster.InternalCassandraClusterService.buildUDT(InternalCassandraClusterService.java:772) at org.elassandra.cluster.InternalCassandraClusterService.buildCql(InternalCassandraClusterService.java:744) at org.elassandra.cluster.InternalCassandraClusterService.buildUDT(InternalCassandraClusterService.java:772) at org.elassandra.cluster.InternalCassandraClusterService.buildCql(InternalCassandraClusterService.java:744) at org.elassandra.cluster.InternalCassandraClusterService.updateTableSchema(InternalCassandraClusterService.java:1093)  9 common frames omitted  Interestingly, attempting the very same insert unchanged, works:  { ""_index"": ""watcher"", ""_type"": ""watch"", ""_id"": ""test_watch_random"", ""_version"": 1, ""_shards"": { ""total"": 1, ""successful"": 1, ""failed"": 0 }, ""created"": true }  and gets indexed correctly:  GET watcher/_search { ""took"": 5, ""timed_out"": false, ""_shards"": { ""total"": 1, ""successful"": 1, ""failed"": 0 }, ""hits"": { ""total"": 1, ""max_score"": 1, ""hits"": [ { ""_index"": ""watcher"", ""_type"": ""watch"", ""_id"": ""test_watch_random"", ""_score"": 1, ""_source"": { ""input"": ""{\""search\"":{\""request\"":{\""index\"":[],\""body\"":{"", ""condition"": ""{\""script\"":{\""script\"":\""payload.hits.total > 100\""}}"", ""transform"": ""{}"", ""id"": ""test_name"" } } ] } }   Pure Object documents not searchable Attempting to create a mapping without an ""enabled"" field seems to fail harder - the above mapping/document without the ""string"" id field is accepted but returns no search results afterwards. Here's an adapted example to reproduce:  PUT watcher_fail { ""mappings"": { ""watch"": { ""properties"": { ""condition"": { ""type"":""object"", ""enabled"": false }, ""input"": { ""type"":""object"", ""enabled"": false }, ""transform"": { ""type"":""object"", ""enabled"": false } } } } }  followed by a document creation attempt:  PUT watcher_fail/watch/this_doc_will_be_missing { ""trigger"": { ""schedule"": { ""later"": ""every 5 minutes"" } }, ""input"": { ""search"": { ""request"": { ""index"": [], ""body"": {} } } }, ""condition"": { ""script"": { ""script"": ""payload.hits.total > 100"" } }, ""transform"": {}, ""actions"": { ""email_admin"": { ""throttle_period"": ""15m"", ""email"": { ""to"": ""alarm@localhost"", ""from"": ""sentinl@localhost"", ""subject"": ""Sentinl Alarm"", ""priority"": ""high"", ""body"": ""Found {{payload.hits.total}} Events"" } } } }  The above document should get accepted, but will never be available in search:  GET watcher_fail/_search "
323,elassandra,https://github.com/strapdata/elassandra/issues/323,Elassandra mappings with type coercing aren't behaving the same as elasticsearch,"<!-- Bug report --> **Elassandra version**: 6.8.4.0 **JVM version** (`java -version`): docker image **OS version** (`uname -a` if on a Unix-like system): host system is OSx but I also tested it in GKE. **Description of the problem including expected versus actual behavior**: When using a mapping template, that enables type coercing, Elassandra doesn't behave the same as ElasticSearch. Instead it returns a 500 and an exception. **Steps to reproduce**: In both of these examples we'll be inserting a document that has an integer mapping. And in both cases the int field's value will be submitted as a string value.  Testing Elasticsearch 6.8  docker pull docker.elastic.co/elasticsearch/elasticsearch:6.8.6 docker run -p 9200:9200 -p 9300:9300 -e ""discovery.type=single-node"" docker.elastic.co/elasticsearch/elasticsearch:6.8.6 export HOST=localhost export INDEX=ents_type_site1 echo '{ ""index_patterns"": ""ents_*"", ""mappings"": { ""_doc"": { ""properties"": { ""_created"": { ""type"": ""date"" } }, ""dynamic_templates"": [ { ""integer_fields"": { ""match"": ""int_*"", ""mapping"": { ""coerce"": true, ""type"": ""long"" } } } ] } } }' | http PUT http://$HOST:9200/_template/ent_table_template { ""acknowledged"": true } echo '{""int__eventcnt"":""1""}' | http POST http://$HOST:9200/$INDEX/_doc/a1bc=:1cd== { ""_id"": ""a1bc=:1cd=="", ""_index"": ""ents_type_site1"", ""_primary_term"": 1, ""_seq_no"": 0, ""_shards"": { ""failed"": 0, ""successful"": 1, ""total"": 2 }, ""_type"": ""_doc"", ""_version"": 1, ""result"": ""created"" }  * Note that elasticsearch handled the casting of the string to an int.  Testing elassandra 6.8  docker run -p 9200:9200 -p 9300:9300 --name node0 -d strapdata/elassandra:6.8.4.0 export INDEX=ents_type_site1 echo '{ ""index_patterns"": ""ents_*"", ""mappings"": { ""_doc"": { ""properties"": { ""_created"": { ""type"": ""date"" } }, ""dynamic_templates"": [ { ""integer_fields"": { ""match"": ""int_*"", ""mapping"": { ""coerce"": true, ""type"": ""long"" } } } ] } } }' | http PUT http://$HOST:9200/_template/ent_table_template { ""acknowledged"": true } echo '{""int__eventcnt"":""1""}' | http POST http://$HOST:9200/$INDEX/_doc/a1bc=:1cd== { ""error"": { ""reason"": ""java.lang.String cannot be cast to java.lang.Number"", ""root_cause"": [ { ""reason"": ""[172.17.0.2][172.17.0.2:9300][indices:data/write/bulk[s][p]]"", ""type"": ""remote_transport_exception"" } ], ""type"": ""class_cast_exception"" }, ""status"": 500 }  **Please provide the following information**: * elassandra logs (logs/system.logs or /var/lib/cassandra/system.log)  2020-01-10 06:01:40,015 WARN [elasticsearch[172.17.0.2][http_server_worker][T#2]] org.elasticsearch.common.logging.DeprecationLogger.deprecated(DeprecationLogger.java:242) [types removal] The parameter include_type_name should be explicitly specified in put template requests to prepare for 7.0. In 7.0 include_type_name will default to 'false', and requests are expected to omit the type name in mapping definitions. 2020-01-10 06:01:42,691 INFO [elasticsearch[172.17.0.2][generic][T#3]] org.elassandra.shard.CassandraShardStateListener.afterIndexShardStarted(CassandraShardStateListener.java:69) shard [ents_type_site1][0] started 2020-01-10 06:01:42,994 ERROR [elasticsearch[172.17.0.2][write][T#1]] org.elassandra.cluster.QueryManager.upsertDocument(QueryManager.java:842) [java.lang.ClassCastException: java.lang.String cannot be cast to java.lang.Number].[ents_type_site1] failed to parse field _doc=int__eventcnt 2020-01-10 06:01:43,011 WARN [elasticsearch[172.17.0.2][write][T#1]] org.elasticsearch.rest.BytesRestResponse.build(BytesRestResponse.java:133) path: /ents_type_site1/_doc/a1bc=:1cd==, params: {index=ents_type_site1, id=a1bc=:1cd==, type=_doc} org.elasticsearch.transport.RemoteTransportException: [172.17.0.2][172.17.0.2:9300][indices:data/write/bulk[s][p]] Caused by: java.lang.ClassCastException: java.lang.String cannot be cast to java.lang.Number at org.elasticsearch.index.mapper.NumberFieldMapper$NumberType$7.cqlValue(NumberFieldMapper.java:870) at org.elasticsearch.index.mapper.NumberFieldMapper$NumberFieldType.cqlValue(NumberFieldMapper.java:1057) at org.elasticsearch.index.mapper.MappedFieldType.cqlValue(MappedFieldType.java:423) at org.elassandra.cluster.Serializer.serialize(Serializer.java:230) at org.elassandra.cluster.Serializer.serialize(Serializer.java:223) at org.elassandra.cluster.QueryManager.upsertDocument(QueryManager.java:840) at org.elassandra.cluster.QueryManager.insertDocument(QueryManager.java:694) at org.elasticsearch.action.bulk.TransportShardBulkAction.lambda$executeIndexRequestOnPrimary$3(TransportShardBulkAction.java:468) at org.elasticsearch.action.bulk.TransportShardBulkAction.executeOnPrimaryWhileHandlingMappingUpdates(TransportShardBulkAction.java:495) at org.elasticsearch.action.bulk.TransportShardBulkAction.executeIndexRequestOnPrimary(TransportShardBulkAction.java:464) at org.elasticsearch.action.bulk.TransportShardBulkAction.executeBulkItemRequest(TransportShardBulkAction.java:226) at org.elasticsearch.action.bulk.TransportShardBulkAction.performOnPrimary(TransportShardBulkAction.java:169) at org.elasticsearch.action.bulk.TransportShardBulkAction.performOnPrimary(TransportShardBulkAction.java:160) at org.elasticsearch.action.bulk.TransportShardBulkAction.shardOperationOnPrimary(TransportShardBulkAction.java:146) at org.elasticsearch.action.bulk.TransportShardBulkAction.shardOperationOnPrimary(TransportShardBulkAction.java:83) at org.elasticsearch.action.support.replication.TransportReplicationAction$PrimaryShardReference.perform(TransportReplicationAction.java:1088) at org.elasticsearch.action.support.replication.TransportReplicationAction$PrimaryShardReference.perform(TransportReplicationAction.java:1066) at org.elasticsearch.action.support.replication.ReplicationOperation.execute(ReplicationOperation.java:105) at org.elasticsearch.action.support.replication.TransportReplicationAction$AsyncPrimaryAction.runWithPrimaryShardReference(TransportReplicationAction.java:445) at org.elasticsearch.action.support.replication.TransportReplicationAction$AsyncPrimaryAction.doRun(TransportReplicationAction.java:387) at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) at org.elasticsearch.action.support.replication.TransportReplicationAction$PrimaryOperationTransportHandler.messageReceived(TransportReplicationAction.java:327) at org.elasticsearch.action.support.replication.TransportReplicationAction$PrimaryOperationTransportHandler.messageReceived(TransportReplicationAction.java:314) at org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:66) at org.elasticsearch.transport.TransportService$7.doRun(TransportService.java:696) at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:751) at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) at java.lang.Thread.run(Thread.java:748)  * elasticsearch cluster state (curl http://localhost:9200/_cluster/state) * cassandra schema (cqlsh>DESC KEYSPACE <your_keyspace>) * cassandra gossip state (run: nodetool gossipinfo)",source-file | source-file | test-file | source-file | source-file | test-file,mappings type coercing behaving bug report jvm docker image uname unix like system host system osx also tested gke description including expected versus actual behavior mapping template enables type coercing behave instead returns exception steps reproduce examples inserting document integer mapping cases int field value submitted string value testing docker docker elastic docker discovery type single node docker elastic export host localhost export index ents type site echo index patterns ents mappings properties created type date dynamic templates integer fields match int mapping coerce true type long http put http host template ent table template acknowledged true echo int eventcnt http post http host index index ents type site primary term seq shards failed successful total type result created note handled casting string int testing docker name node strapdata export index ents type site echo index patterns ents mappings properties created type date dynamic templates integer fields match int mapping coerce true type long http put http host template ent table template acknowledged true echo int eventcnt http post http host index reason lang string cannot cast lang number root cause reason indices data write bulk type remote transport exception type class cast exception status please provide following information logs logs system logs var cassandra system log warn http server worker common logging deprecationlogger deprecated deprecationlogger types removal parameter include type name explicitly specified put template requests prepare include type name default false requests expected omit type name mapping definitions generic shard cassandrashardstatelistener afterindexshardstarted cassandrashardstatelistener shard ents type site started write cluster querymanager upsertdocument querymanager lang classcastexception lang string cannot cast lang number ents type site failed parse field int eventcnt warn write rest bytesrestresponse bytesrestresponse path ents type site params index ents type site type transport remotetransportexception indices data write bulk caused lang classcastexception lang string cannot cast lang number index mapper numberfieldmapper numbertype cqlvalue numberfieldmapper index mapper numberfieldmapper numberfieldtype cqlvalue numberfieldmapper index mapper mappedfieldtype cqlvalue mappedfieldtype cluster serializer serialize serializer cluster serializer serialize serializer cluster querymanager upsertdocument querymanager cluster querymanager insertdocument querymanager action bulk transportshardbulkaction lambda executeindexrequestonprimary transportshardbulkaction action bulk transportshardbulkaction executeonprimarywhilehandlingmappingupdates transportshardbulkaction action bulk transportshardbulkaction executeindexrequestonprimary transportshardbulkaction action bulk transportshardbulkaction executebulkitemrequest transportshardbulkaction action bulk transportshardbulkaction performonprimary transportshardbulkaction action bulk transportshardbulkaction performonprimary transportshardbulkaction action bulk transportshardbulkaction shardoperationonprimary transportshardbulkaction action bulk transportshardbulkaction shardoperationonprimary transportshardbulkaction action replication transportreplicationaction primaryshardreference perform transportreplicationaction action replication transportreplicationaction primaryshardreference perform transportreplicationaction action replication replicationoperation execute replicationoperation action replication transportreplicationaction asyncprimaryaction runwithprimaryshardreference transportreplicationaction action replication transportreplicationaction asyncprimaryaction dorun transportreplicationaction common util concurrent abstractrunnable abstractrunnable action replication transportreplicationaction primaryoperationtransporthandler messagereceived transportreplicationaction action replication transportreplicationaction primaryoperationtransporthandler messagereceived transportreplicationaction transport requesthandlerregistry processmessagereceived requesthandlerregistry transport transportservice dorun transportservice common util concurrent threadcontext contextpreservingabstractrunnable dorun threadcontext common util concurrent abstractrunnable abstractrunnable util concurrent threadpoolexecutor runworker threadpoolexecutor util concurrent threadpoolexecutor worker threadpoolexecutor lang thread thread cluster state curl http localhost cluster state cassandra schema cqlsh desc keyspace keyspace cassandra gossip state nodetool gossipinfo,bug,0.95,"Elassandra mappings with type coercing aren't behaving the same as elasticsearch <!-- Bug report --> **Elassandra version**: 6.8.4.0 **JVM version** (`java -version`): docker image **OS version** (`uname -a` if on a Unix-like system): host system is OSx but I also tested it in GKE. **Description of the problem including expected versus actual behavior**: When using a mapping template, that enables type coercing, Elassandra doesn't behave the same as ElasticSearch. Instead it returns a 500 and an exception. **Steps to reproduce**: In both of these examples we'll be inserting a document that has an integer mapping. And in both cases the int field's value will be submitted as a string value.  Testing Elasticsearch 6.8  docker pull docker.elastic.co/elasticsearch/elasticsearch:6.8.6 docker run -p 9200:9200 -p 9300:9300 -e ""discovery.type=single-node"" docker.elastic.co/elasticsearch/elasticsearch:6.8.6 export HOST=localhost export INDEX=ents_type_site1 echo '{ ""index_patterns"": ""ents_*"", ""mappings"": { ""_doc"": { ""properties"": { ""_created"": { ""type"": ""date"" } }, ""dynamic_templates"": [ { ""integer_fields"": { ""match"": ""int_*"", ""mapping"": { ""coerce"": true, ""type"": ""long"" } } } ] } } }' | http PUT http://$HOST:9200/_template/ent_table_template { ""acknowledged"": true } echo '{""int__eventcnt"":""1""}' | http POST http://$HOST:9200/$INDEX/_doc/a1bc=:1cd== { ""_id"": ""a1bc=:1cd=="", ""_index"": ""ents_type_site1"", ""_primary_term"": 1, ""_seq_no"": 0, ""_shards"": { ""failed"": 0, ""successful"": 1, ""total"": 2 }, ""_type"": ""_doc"", ""_version"": 1, ""result"": ""created"" }  * Note that elasticsearch handled the casting of the string to an int.  Testing elassandra 6.8  docker run -p 9200:9200 -p 9300:9300 --name node0 -d strapdata/elassandra:6.8.4.0 export INDEX=ents_type_site1 echo '{ ""index_patterns"": ""ents_*"", ""mappings"": { ""_doc"": { ""properties"": { ""_created"": { ""type"": ""date"" } }, ""dynamic_templates"": [ { ""integer_fields"": { ""match"": ""int_*"", ""mapping"": { ""coerce"": true, ""type"": ""long"" } } } ] } } }' | http PUT http://$HOST:9200/_template/ent_table_template { ""acknowledged"": true } echo '{""int__eventcnt"":""1""}' | http POST http://$HOST:9200/$INDEX/_doc/a1bc=:1cd== { ""error"": { ""reason"": ""java.lang.String cannot be cast to java.lang.Number"", ""root_cause"": [ { ""reason"": ""[172.17.0.2][172.17.0.2:9300][indices:data/write/bulk[s][p]]"", ""type"": ""remote_transport_exception"" } ], ""type"": ""class_cast_exception"" }, ""status"": 500 }  **Please provide the following information**: * elassandra logs (logs/system.logs or /var/lib/cassandra/system.log)  2020-01-10 06:01:40,015 WARN [elasticsearch[172.17.0.2][http_server_worker][T#2]] org.elasticsearch.common.logging.DeprecationLogger.deprecated(DeprecationLogger.java:242) [types removal] The parameter include_type_name should be explicitly specified in put template requests to prepare for 7.0. In 7.0 include_type_name will default to 'false', and requests are expected to omit the type name in mapping definitions. 2020-01-10 06:01:42,691 INFO [elasticsearch[172.17.0.2][generic][T#3]] org.elassandra.shard.CassandraShardStateListener.afterIndexShardStarted(CassandraShardStateListener.java:69) shard [ents_type_site1][0] started 2020-01-10 06:01:42,994 ERROR [elasticsearch[172.17.0.2][write][T#1]] org.elassandra.cluster.QueryManager.upsertDocument(QueryManager.java:842) [java.lang.ClassCastException: java.lang.String cannot be cast to java.lang.Number].[ents_type_site1] failed to parse field _doc=int__eventcnt 2020-01-10 06:01:43,011 WARN [elasticsearch[172.17.0.2][write][T#1]] org.elasticsearch.rest.BytesRestResponse.build(BytesRestResponse.java:133) path: /ents_type_site1/_doc/a1bc=:1cd==, params: {index=ents_type_site1, id=a1bc=:1cd==, type=_doc} org.elasticsearch.transport.RemoteTransportException: [172.17.0.2][172.17.0.2:9300][indices:data/write/bulk[s][p]] Caused by: java.lang.ClassCastException: java.lang.String cannot be cast to java.lang.Number at org.elasticsearch.index.mapper.NumberFieldMapper$NumberType$7.cqlValue(NumberFieldMapper.java:870) at org.elasticsearch.index.mapper.NumberFieldMapper$NumberFieldType.cqlValue(NumberFieldMapper.java:1057) at org.elasticsearch.index.mapper.MappedFieldType.cqlValue(MappedFieldType.java:423) at org.elassandra.cluster.Serializer.serialize(Serializer.java:230) at org.elassandra.cluster.Serializer.serialize(Serializer.java:223) at org.elassandra.cluster.QueryManager.upsertDocument(QueryManager.java:840) at org.elassandra.cluster.QueryManager.insertDocument(QueryManager.java:694) at org.elasticsearch.action.bulk.TransportShardBulkAction.lambda$executeIndexRequestOnPrimary$3(TransportShardBulkAction.java:468) at org.elasticsearch.action.bulk.TransportShardBulkAction.executeOnPrimaryWhileHandlingMappingUpdates(TransportShardBulkAction.java:495) at org.elasticsearch.action.bulk.TransportShardBulkAction.executeIndexRequestOnPrimary(TransportShardBulkAction.java:464) at org.elasticsearch.action.bulk.TransportShardBulkAction.executeBulkItemRequest(TransportShardBulkAction.java:226) at org.elasticsearch.action.bulk.TransportShardBulkAction.performOnPrimary(TransportShardBulkAction.java:169) at org.elasticsearch.action.bulk.TransportShardBulkAction.performOnPrimary(TransportShardBulkAction.java:160) at org.elasticsearch.action.bulk.TransportShardBulkAction.shardOperationOnPrimary(TransportShardBulkAction.java:146) at org.elasticsearch.action.bulk.TransportShardBulkAction.shardOperationOnPrimary(TransportShardBulkAction.java:83) at org.elasticsearch.action.support.replication.TransportReplicationAction$PrimaryShardReference.perform(TransportReplicationAction.java:1088) at org.elasticsearch.action.support.replication.TransportReplicationAction$PrimaryShardReference.perform(TransportReplicationAction.java:1066) at org.elasticsearch.action.support.replication.ReplicationOperation.execute(ReplicationOperation.java:105) at org.elasticsearch.action.support.replication.TransportReplicationAction$AsyncPrimaryAction.runWithPrimaryShardReference(TransportReplicationAction.java:445) at org.elasticsearch.action.support.replication.TransportReplicationAction$AsyncPrimaryAction.doRun(TransportReplicationAction.java:387) at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) at org.elasticsearch.action.support.replication.TransportReplicationAction$PrimaryOperationTransportHandler.messageReceived(TransportReplicationAction.java:327) at org.elasticsearch.action.support.replication.TransportReplicationAction$PrimaryOperationTransportHandler.messageReceived(TransportReplicationAction.java:314) at org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:66) at org.elasticsearch.transport.TransportService$7.doRun(TransportService.java:696) at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:751) at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) at java.lang.Thread.run(Thread.java:748)  * elasticsearch cluster state (curl http://localhost:9200/_cluster/state) * cassandra schema (cqlsh>DESC KEYSPACE <your_keyspace>) * cassandra gossip state (run: nodetool gossipinfo)"
7,elassandra,https://github.com/strapdata/elassandra/issues/7,Build string on ES startpage is empty,"error show build numer:  { ""name"" : ""abc"", ""cluster_name"" : ""Test Cluster"", ""version"" : { ""number"" : ""2.1.2"", ""build_hash"" : ""${buildNumber}"", ""build_timestamp"" : ""NA"", ""build_snapshot"" : true, ""lucene_version"" : ""5.3.1"" }, ""tagline"" : ""You Know, for Search"" } ",config-file | other-file | other-file | other-file | other-file | other-file | source-file | other-file | other-file | other-file | other-file | other-file | other-file | other-file | other-file | other-file | other-file | other-file | other-file | other-file | other-file | other-file | other-file | other-file | other-file,string startpage empty show numer name abc cluster name cluster number hash buildnumber timestamp snapshot true lucene tagline know search,bug,0.85,"Build string on ES startpage is empty error show build numer:  { ""name"" : ""abc"", ""cluster_name"" : ""Test Cluster"", ""version"" : { ""number"" : ""2.1.2"", ""build_hash"" : ""${buildNumber}"", ""build_timestamp"" : ""NA"", ""build_snapshot"" : true, ""lucene_version"" : ""5.3.1"" }, ""tagline"" : ""You Know, for Search"" } "
346,elassandra,https://github.com/strapdata/elassandra/issues/346,"Nested objects with inner hits query returns ""extracted source isn't an object or an array""","<!-- Bug report --> **Elassandra version**: Behavior is seen on official docker images [6.8.4.0](https://hub.docker.com/layers/strapdata/elassandra/6.8.4.0/images/sha256-1e004ecccfc506faf806464e4beed1815d3c973ee6d3bb4b88193084397d8491?context=explore) -> [6.8.4.5](https://hub.docker.com/layers/strapdata/elassandra/6.8.4.5/images/sha256-1a7ff3e3c1ee0801f812aa321dfe4ae8a6f959c3ef47b0fbeaa3a4de695eff14?context=explore) **Plugins installed**: None **JVM version** (`java -version`): Docker image of 6.8.4.5 is running openjdk version ""1.8.0_252"" **OS version** (`uname -a` if on a Unix-like system): Running on a container on a host that is running 18.04.1-Ubuntu **Description of the problem including expected versus actual behavior**: I am moving from 6.2.3.28 to 6.8.4.5, and have noticed queries with inner hits on nested objects (as outlined in the steps below) are failing with the following error coming back:  { ""error"": { ""root_cause"": [ { ""type"": ""illegal_state_exception"", ""reason"": ""extracted source isn't an object or an array"" } ], ""type"": ""search_phase_execution_exception"", ""reason"": ""all shards failed"", ""phase"": ""query"", ""grouped"": true, ""failed_shards"": [ { ""shard"": 0, ""index"": ""nested_data"", ""node"": ""5c622bfa-fef0-4dd0-b040-5a68a767beb5"", ""reason"": { ""type"": ""illegal_state_exception"", ""reason"": ""extracted source isn't an object or an array"" } } ], ""caused_by"": { ""type"": ""illegal_state_exception"", ""reason"": ""extracted source isn't an object or an array"", ""caused_by"": { ""type"": ""illegal_state_exception"", ""reason"": ""extracted source isn't an object or an array"" } } }, ""status"": 500 }  **Reasons why I think this is a bug:** 1. When tested against [ES 6.8.4 docker image](https://hub.docker.com/layers/elasticsearch/library/elasticsearch/6.8.4/images/sha256-87538ba78df48470563796df1dbbf2e7bf407e97542830bfd395f912b15c07f0?context=explore) I do not see the same issue. 2. I do not see this issue on Elassandra 6.2.3.28, and assume there is backwards compatibility of query/mapping/docs on non major version releases **Other behaviors I noted:** Removing the inner_hits block of the query stops the issue, and so does turning off the source in the inner_hits block. However neither of these are desirable solutions Something else that seems to resolve the issue while I was triaging is removing `nested-object2` when inserting the data in step 2 below **Steps to reproduce**: 1. Create index at `nested_data` with the following mapping:  { ""mappings"": { ""nested_data"": { ""properties"": { ""parent-nested"": { ""type"": ""nested"", ""properties"": { ""nested-object1"": { ""type"": ""nested"", ""properties"": { ""field1"": { ""type"": ""text"" }, ""field2"": { ""type"": ""text"", ""fields"": { ""keyword"": { ""type"": ""keyword"", ""ignore_above"": 256 } } } } }, ""nested-object2"": { ""type"": ""nested"", ""properties"": { ""field2"": { ""type"": ""text"" } } } } } } } } }  2. Insert the following document in the above created index:  { ""parent-nested"": [ { ""nested-object1"": [ { ""field1"": ""hello"" } ] }, { ""nested-object2"": { } } ] }  3. Run the following query against the index:  { ""query"": { ""bool"": { ""must"": [ { ""nested"": { ""path"": ""parent-nested.nested-object1"", ""inner_hits"": { }, ""query"": { ""bool"": { ""should"": { ""bool"": { ""must"": { ""match"": { ""parent-nested.nested-object1.field1"": ""hello"" } } } } } } } } ] } } }  **Please provide the following information**: * elassandra logs:  elassandra | Elassandra started elassandra | 2020-06-04 17:51:31,748 WARN [elasticsearch[172.18.0.2][http_server_worker][T#2]] org.elasticsearch.common.logging.DeprecationLogger.deprecated(DeprecationLogger.java:242) [types removal] The parameter include_type_name should be explicitly specified in create index requests to prepare for 7.0. In 7.0 include_type_name will default to 'false', and requests are expected to omit the type name in mapping definitions. elassandra | 2020-06-04 17:51:33,174 INFO [elasticsearch[172.18.0.2][generic][T#2]] org.elassandra.shard.CassandraShardStateListener.afterIndexShardStarted(CassandraShardStateListener.java:69) shard [nested_data][0] started elassandra | 2020-06-04 17:51:46,971 WARN [elasticsearch[172.18.0.2][search][T#1]] org.elasticsearch.rest.BytesRestResponse.build(BytesRestResponse.java:133) path: /nested_data/_search, params: {index=nested_data} elassandra | org.elasticsearch.action.search.SearchPhaseExecutionException: all shards failed elassandra | at org.elasticsearch.action.search.AbstractSearchAsyncAction.onPhaseFailure(AbstractSearchAsyncAction.java:298) elassandra | at org.elasticsearch.action.search.AbstractSearchAsyncAction.executeNextPhase(AbstractSearchAsyncAction.java:135) elassandra | at org.elasticsearch.action.search.AbstractSearchAsyncAction.onPhaseDone(AbstractSearchAsyncAction.java:261) elassandra | at org.elasticsearch.action.search.InitialSearchPhase.onShardFailure(InitialSearchPhase.java:100) elassandra | at org.elasticsearch.action.search.InitialSearchPhase.access$100(InitialSearchPhase.java:48) elassandra | at org.elasticsearch.action.search.InitialSearchPhase$2.lambda$onFailure$1(InitialSearchPhase.java:220) elassandra | at org.elasticsearch.action.search.InitialSearchPhase.maybeFork(InitialSearchPhase.java:174) elassandra | at org.elasticsearch.action.search.InitialSearchPhase.access$000(InitialSearchPhase.java:48) elassandra | at org.elasticsearch.action.search.InitialSearchPhase$2.onFailure(InitialSearchPhase.java:220) elassandra | at org.elasticsearch.action.search.SearchExecutionStatsCollector.onFailure(SearchExecutionStatsCollector.java:73) elassandra | at org.elasticsearch.action.ActionListenerResponseHandler.handleException(ActionListenerResponseHandler.java:59) elassandra | at org.elasticsearch.action.search.SearchTransportService$ConnectionCountingHandler.handleException(SearchTransportService.java:463) elassandra | at org.elasticsearch.transport.TransportService$ContextRestoreResponseHandler.handleException(TransportService.java:1118) elassandra | at org.elasticsearch.transport.TransportService$DirectResponseChannel.processException(TransportService.java:1230) elassandra | at org.elasticsearch.transport.TransportService$DirectResponseChannel.sendResponse(TransportService.java:1204) elassandra | at org.elasticsearch.transport.TaskTransportChannel.sendResponse(TaskTransportChannel.java:60) elassandra | at org.elasticsearch.action.support.ChannelActionListener.onFailure(ChannelActionListener.java:56) elassandra | at org.elasticsearch.search.SearchService$2.onFailure(SearchService.java:368) elassandra | at org.elasticsearch.search.SearchService$2.onResponse(SearchService.java:362) elassandra | at org.elasticsearch.search.SearchService$2.onResponse(SearchService.java:356) elassandra | at org.elasticsearch.search.SearchService$4.doRun(SearchService.java:1114) elassandra | at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) elassandra | at org.elasticsearch.common.util.concurrent.TimedRunnable.doRun(TimedRunnable.java:41) elassandra | at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:751) elassandra | at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) elassandra | at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) elassandra | at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) elassandra | at java.lang.Thread.run(Thread.java:748) elassandra | Caused by: org.elasticsearch.ElasticsearchException$1: extracted source isn't an object or an array elassandra | at org.elasticsearch.ElasticsearchException.guessRootCauses(ElasticsearchException.java:657) elassandra | at org.elasticsearch.action.search.AbstractSearchAsyncAction.executeNextPhase(AbstractSearchAsyncAction.java:133) elassandra |  26 common frames omitted elassandra | Caused by: java.lang.IllegalStateException: extracted source isn't an object or an array elassandra | at org.elasticsearch.search.fetch.FetchPhase.createNestedSearchHit(FetchPhase.java:340) elassandra | at org.elasticsearch.search.fetch.FetchPhase.execute(FetchPhase.java:166) elassandra | at org.elasticsearch.search.fetch.subphase.InnerHitsFetchSubPhase.hitsExecute(InnerHitsFetchSubPhase.java:69) elassandra | at org.elasticsearch.search.fetch.FetchPhase.execute(FetchPhase.java:184) elassandra | at org.elasticsearch.search.SearchService.executeFetchPhase(SearchService.java:424) elassandra | at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:404) elassandra | at org.elasticsearch.search.SearchService.access$100(SearchService.java:127) elassandra | at org.elasticsearch.search.SearchService$2.onResponse(SearchService.java:360) elassandra |  9 common frames omitted elassandra | 2020-06-04 18:06:06,393 WARN [elasticsearch[172.18.0.2][search][T#2]] org.elasticsearch.rest.BytesRestResponse.build(BytesRestResponse.java:133) path: /nested_data/_search, params: {index=nested_data} elassandra | org.elasticsearch.action.search.SearchPhaseExecutionException: all shards failed elassandra | at org.elasticsearch.action.search.AbstractSearchAsyncAction.onPhaseFailure(AbstractSearchAsyncAction.java:298) elassandra | at org.elasticsearch.action.search.AbstractSearchAsyncAction.executeNextPhase(AbstractSearchAsyncAction.java:135) elassandra | at org.elasticsearch.action.search.AbstractSearchAsyncAction.onPhaseDone(AbstractSearchAsyncAction.java:261) elassandra | at org.elasticsearch.action.search.InitialSearchPhase.onShardFailure(InitialSearchPhase.java:100) elassandra | at org.elasticsearch.action.search.InitialSearchPhase.access$100(InitialSearchPhase.java:48) elassandra | at org.elasticsearch.action.search.InitialSearchPhase$2.lambda$onFailure$1(InitialSearchPhase.java:220) elassandra | at org.elasticsearch.action.search.InitialSearchPhase.maybeFork(InitialSearchPhase.java:174) elassandra | at org.elasticsearch.action.search.InitialSearchPhase.access$000(InitialSearchPhase.java:48) elassandra | at org.elasticsearch.action.search.InitialSearchPhase$2.onFailure(InitialSearchPhase.java:220) elassandra | at org.elasticsearch.action.search.SearchExecutionStatsCollector.onFailure(SearchExecutionStatsCollector.java:73) elassandra | at org.elasticsearch.action.ActionListenerResponseHandler.handleException(ActionListenerResponseHandler.java:59) elassandra | at org.elasticsearch.action.search.SearchTransportService$ConnectionCountingHandler.handleException(SearchTransportService.java:463) elassandra | at org.elasticsearch.transport.TransportService$ContextRestoreResponseHandler.handleException(TransportService.java:1118) elassandra | at org.elasticsearch.transport.TransportService$DirectResponseChannel.processException(TransportService.java:1230) elassandra | at org.elasticsearch.transport.TransportService$DirectResponseChannel.sendResponse(TransportService.java:1204) elassandra | at org.elasticsearch.transport.TaskTransportChannel.sendResponse(TaskTransportChannel.java:60) elassandra | at org.elasticsearch.action.support.ChannelActionListener.onFailure(ChannelActionListener.java:56) elassandra | at org.elasticsearch.search.SearchService$2.onFailure(SearchService.java:368) elassandra | at org.elasticsearch.search.SearchService$2.onResponse(SearchService.java:362) elassandra | at org.elasticsearch.search.SearchService$2.onResponse(SearchService.java:356) elassandra | at org.elasticsearch.search.SearchService$4.doRun(SearchService.java:1114) elassandra | at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) elassandra | at org.elasticsearch.common.util.concurrent.TimedRunnable.doRun(TimedRunnable.java:41) elassandra | at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:751) elassandra | at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) elassandra | at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) elassandra | at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) elassandra | at java.lang.Thread.run(Thread.java:748) elassandra | Caused by: org.elasticsearch.ElasticsearchException$1: extracted source isn't an object or an array elassandra | at org.elasticsearch.ElasticsearchException.guessRootCauses(ElasticsearchException.java:657) elassandra | at org.elasticsearch.action.search.AbstractSearchAsyncAction.executeNextPhase(AbstractSearchAsyncAction.java:133) elassandra |  26 common frames omitted elassandra | Caused by: java.lang.IllegalStateException: extracted source isn't an object or an array elassandra | at org.elasticsearch.search.fetch.FetchPhase.createNestedSearchHit(FetchPhase.java:340) elassandra | at org.elasticsearch.search.fetch.FetchPhase.execute(FetchPhase.java:166) elassandra | at org.elasticsearch.search.fetch.subphase.InnerHitsFetchSubPhase.hitsExecute(InnerHitsFetchSubPhase.java:69) elassandra | at org.elasticsearch.search.fetch.FetchPhase.execute(FetchPhase.java:184) elassandra | at org.elasticsearch.search.SearchService.executeFetchPhase(SearchService.java:424) elassandra | at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:404) elassandra | at org.elasticsearch.search.SearchService.access$100(SearchService.java:127) elassandra | at org.elasticsearch.search.SearchService$2.onResponse(SearchService.java:360) elassandra |  9 common frames omitted  * cassandra schema:  CREATE KEYSPACE nested_data WITH replication = {'class': 'NetworkTopologyStrategy', 'DC1': '1'} AND durable_writes = true; CREATE TYPE nested_data.nested_data_parent_nested_nested_object1 ( field1 list<text>, field2 list<text> ); CREATE TYPE nested_data.nested_data_parent_nested_nested_object2 ( field2 list<text> ); CREATE TYPE nested_data.nested_data_parent_nested ( ""nested-object1"" list<frozen<nested_data_parent_nested_nested_object1>>, ""nested-object2"" list<frozen<nested_data_parent_nested_nested_object2>> ); CREATE TABLE nested_data.nested_data ( ""_id"" text PRIMARY KEY, ""parent-nested"" list<frozen<nested_data_parent_nested>> ) WITH bloom_filter_fp_chance = 0.01 AND caching = {'keys': 'ALL', 'rows_per_partition': 'NONE'} AND comment = '' AND compaction = {'class': 'org.apache.cassandra.db.compaction.SizeTieredCompactionStrategy', 'max_threshold': '32', 'min_threshold': '4'} AND compression = {'chunk_length_in_kb': '64', 'class': 'org.apache.cassandra.io.compress.LZ4Compressor'} AND crc_check_chance = 1.0 AND dclocal_read_repair_chance = 0.1 AND default_time_to_live = 0 AND gc_grace_seconds = 864000 AND max_index_interval = 2048 AND memtable_flush_period_in_ms = 0 AND min_index_interval = 128 AND read_repair_chance = 0.0 AND speculative_retry = '99PERCENTILE'; CREATE CUSTOM INDEX elastic_nested_data_idx ON nested_data.nested_data () USING 'org.elassandra.index.ExtendedElasticSecondaryIndex'; ",source-file | source-file | test-file,nested objects inner hits query returns extracted object array bug report behavior seen official docker images https hub docker layers strapdata images sha ecccfc faf beed context explore https hub docker layers strapdata images sha dfe fbeaa eff context explore plugins installed none jvm docker image running openjdk uname unix like system running container host running ubuntu description including expected versus actual behavior moving noticed queries inner hits nested objects outlined steps failing following coming back root cause type illegal state exception reason extracted object array type search phase execution exception reason shards failed phase query grouped true failed shards shard index nested data node bfa fef beb reason type illegal state exception reason extracted object array caused type illegal state exception reason extracted object array caused type illegal state exception reason extracted object array status reasons think bug tested docker image https hub docker layers library images sha dbbf bfd context explore see see assume backwards compatibility query mapping docs non major releases behaviors noted removing inner hits block query stops turning inner hits block however neither desirable solutions something else seems resolve triaging removing nested object inserting data step steps reproduce create index nested data following mapping mappings nested data properties parent nested type nested properties nested object type nested properties field type text field type text fields keyword type keyword ignore nested object type nested properties field type text insert following document created index parent nested nested object field hello nested object following query index query bool must nested path parent nested nested object inner hits query bool bool must match parent nested nested object field hello please provide following information logs started warn http server worker common logging deprecationlogger deprecated deprecationlogger types removal parameter include type name explicitly specified create index requests prepare include type name default false requests expected omit type name mapping definitions generic shard cassandrashardstatelistener afterindexshardstarted cassandrashardstatelistener shard nested data started warn search rest bytesrestresponse bytesrestresponse path nested data search params index nested data action search searchphaseexecutionexception shards failed action search abstractsearchasyncaction onphasefailure abstractsearchasyncaction action search abstractsearchasyncaction executenextphase abstractsearchasyncaction action search abstractsearchasyncaction onphasedone abstractsearchasyncaction action search initialsearchphase onshardfailure initialsearchphase action search initialsearchphase access initialsearchphase action search initialsearchphase lambda onfailure initialsearchphase action search initialsearchphase maybefork initialsearchphase action search initialsearchphase access initialsearchphase action search initialsearchphase onfailure initialsearchphase action search searchexecutionstatscollector onfailure searchexecutionstatscollector action actionlistenerresponsehandler handleexception actionlistenerresponsehandler action search searchtransportservice connectioncountinghandler handleexception searchtransportservice transport transportservice contextrestoreresponsehandler handleexception transportservice transport transportservice directresponsechannel processexception transportservice transport transportservice directresponsechannel sendresponse transportservice transport tasktransportchannel sendresponse tasktransportchannel action channelactionlistener onfailure channelactionlistener search searchservice onfailure searchservice search searchservice onresponse searchservice search searchservice onresponse searchservice search searchservice dorun searchservice common util concurrent abstractrunnable abstractrunnable common util concurrent timedrunnable dorun timedrunnable common util concurrent threadcontext contextpreservingabstractrunnable dorun threadcontext common util concurrent abstractrunnable abstractrunnable util concurrent threadpoolexecutor runworker threadpoolexecutor util concurrent threadpoolexecutor worker threadpoolexecutor lang thread thread caused elasticsearchexception extracted object array elasticsearchexception guessrootcauses elasticsearchexception action search abstractsearchasyncaction executenextphase abstractsearchasyncaction common frames omitted caused lang illegalstateexception extracted object array search fetch fetchphase createnestedsearchhit fetchphase search fetch fetchphase execute fetchphase search fetch subphase innerhitsfetchsubphase hitsexecute innerhitsfetchsubphase search fetch fetchphase execute fetchphase search searchservice executefetchphase searchservice search searchservice executequeryphase searchservice search searchservice access searchservice search searchservice onresponse searchservice common frames omitted warn search rest bytesrestresponse bytesrestresponse path nested data search params index nested data action search searchphaseexecutionexception shards failed action search abstractsearchasyncaction onphasefailure abstractsearchasyncaction action search abstractsearchasyncaction executenextphase abstractsearchasyncaction action search abstractsearchasyncaction onphasedone abstractsearchasyncaction action search initialsearchphase onshardfailure initialsearchphase action search initialsearchphase access initialsearchphase action search initialsearchphase lambda onfailure initialsearchphase action search initialsearchphase maybefork initialsearchphase action search initialsearchphase access initialsearchphase action search initialsearchphase onfailure initialsearchphase action search searchexecutionstatscollector onfailure searchexecutionstatscollector action actionlistenerresponsehandler handleexception actionlistenerresponsehandler action search searchtransportservice connectioncountinghandler handleexception searchtransportservice transport transportservice contextrestoreresponsehandler handleexception transportservice transport transportservice directresponsechannel processexception transportservice transport transportservice directresponsechannel sendresponse transportservice transport tasktransportchannel sendresponse tasktransportchannel action channelactionlistener onfailure channelactionlistener search searchservice onfailure searchservice search searchservice onresponse searchservice search searchservice onresponse searchservice search searchservice dorun searchservice common util concurrent abstractrunnable abstractrunnable common util concurrent timedrunnable dorun timedrunnable common util concurrent threadcontext contextpreservingabstractrunnable dorun threadcontext common util concurrent abstractrunnable abstractrunnable util concurrent threadpoolexecutor runworker threadpoolexecutor util concurrent threadpoolexecutor worker threadpoolexecutor lang thread thread caused elasticsearchexception extracted object array elasticsearchexception guessrootcauses elasticsearchexception action search abstractsearchasyncaction executenextphase abstractsearchasyncaction common frames omitted caused lang illegalstateexception extracted object array search fetch fetchphase createnestedsearchhit fetchphase search fetch fetchphase execute fetchphase search fetch subphase innerhitsfetchsubphase hitsexecute innerhitsfetchsubphase search fetch fetchphase execute fetchphase search searchservice executefetchphase searchservice search searchservice executequeryphase searchservice search searchservice access searchservice search searchservice onresponse searchservice common frames omitted cassandra schema create keyspace nested data replication class networktopologystrategy durable writes true create type nested data nested data parent nested nested object field list text field list text create type nested data nested data parent nested nested object field list text create type nested data nested data parent nested nested object list frozen nested data parent nested nested object nested object list frozen nested data parent nested nested object create table nested data nested data text primary key parent nested list frozen nested data parent nested bloom filter chance caching keys rows per partition none comment compaction class apache cassandra compaction sizetieredcompactionstrategy max threshold min threshold compression chunk length class apache cassandra compress compressor crc check chance dclocal read repair chance default time live grace seconds max index interval memtable flush period min index interval read repair chance speculative retry percentile create custom index elastic nested data idx nested data nested data index extendedelasticsecondaryindex,bug,0.95,"Nested objects with inner hits query returns ""extracted source isn't an object or an array"" <!-- Bug report --> **Elassandra version**: Behavior is seen on official docker images [6.8.4.0](https://hub.docker.com/layers/strapdata/elassandra/6.8.4.0/images/sha256-1e004ecccfc506faf806464e4beed1815d3c973ee6d3bb4b88193084397d8491?context=explore) -> [6.8.4.5](https://hub.docker.com/layers/strapdata/elassandra/6.8.4.5/images/sha256-1a7ff3e3c1ee0801f812aa321dfe4ae8a6f959c3ef47b0fbeaa3a4de695eff14?context=explore) **Plugins installed**: None **JVM version** (`java -version`): Docker image of 6.8.4.5 is running openjdk version ""1.8.0_252"" **OS version** (`uname -a` if on a Unix-like system): Running on a container on a host that is running 18.04.1-Ubuntu **Description of the problem including expected versus actual behavior**: I am moving from 6.2.3.28 to 6.8.4.5, and have noticed queries with inner hits on nested objects (as outlined in the steps below) are failing with the following error coming back:  { ""error"": { ""root_cause"": [ { ""type"": ""illegal_state_exception"", ""reason"": ""extracted source isn't an object or an array"" } ], ""type"": ""search_phase_execution_exception"", ""reason"": ""all shards failed"", ""phase"": ""query"", ""grouped"": true, ""failed_shards"": [ { ""shard"": 0, ""index"": ""nested_data"", ""node"": ""5c622bfa-fef0-4dd0-b040-5a68a767beb5"", ""reason"": { ""type"": ""illegal_state_exception"", ""reason"": ""extracted source isn't an object or an array"" } } ], ""caused_by"": { ""type"": ""illegal_state_exception"", ""reason"": ""extracted source isn't an object or an array"", ""caused_by"": { ""type"": ""illegal_state_exception"", ""reason"": ""extracted source isn't an object or an array"" } } }, ""status"": 500 }  **Reasons why I think this is a bug:** 1. When tested against [ES 6.8.4 docker image](https://hub.docker.com/layers/elasticsearch/library/elasticsearch/6.8.4/images/sha256-87538ba78df48470563796df1dbbf2e7bf407e97542830bfd395f912b15c07f0?context=explore) I do not see the same issue. 2. I do not see this issue on Elassandra 6.2.3.28, and assume there is backwards compatibility of query/mapping/docs on non major version releases **Other behaviors I noted:** Removing the inner_hits block of the query stops the issue, and so does turning off the source in the inner_hits block. However neither of these are desirable solutions Something else that seems to resolve the issue while I was triaging is removing `nested-object2` when inserting the data in step 2 below **Steps to reproduce**: 1. Create index at `nested_data` with the following mapping:  { ""mappings"": { ""nested_data"": { ""properties"": { ""parent-nested"": { ""type"": ""nested"", ""properties"": { ""nested-object1"": { ""type"": ""nested"", ""properties"": { ""field1"": { ""type"": ""text"" }, ""field2"": { ""type"": ""text"", ""fields"": { ""keyword"": { ""type"": ""keyword"", ""ignore_above"": 256 } } } } }, ""nested-object2"": { ""type"": ""nested"", ""properties"": { ""field2"": { ""type"": ""text"" } } } } } } } } }  2. Insert the following document in the above created index:  { ""parent-nested"": [ { ""nested-object1"": [ { ""field1"": ""hello"" } ] }, { ""nested-object2"": { } } ] }  3. Run the following query against the index:  { ""query"": { ""bool"": { ""must"": [ { ""nested"": { ""path"": ""parent-nested.nested-object1"", ""inner_hits"": { }, ""query"": { ""bool"": { ""should"": { ""bool"": { ""must"": { ""match"": { ""parent-nested.nested-object1.field1"": ""hello"" } } } } } } } } ] } } }  **Please provide the following information**: * elassandra logs:  elassandra | Elassandra started elassandra | 2020-06-04 17:51:31,748 WARN [elasticsearch[172.18.0.2][http_server_worker][T#2]] org.elasticsearch.common.logging.DeprecationLogger.deprecated(DeprecationLogger.java:242) [types removal] The parameter include_type_name should be explicitly specified in create index requests to prepare for 7.0. In 7.0 include_type_name will default to 'false', and requests are expected to omit the type name in mapping definitions. elassandra | 2020-06-04 17:51:33,174 INFO [elasticsearch[172.18.0.2][generic][T#2]] org.elassandra.shard.CassandraShardStateListener.afterIndexShardStarted(CassandraShardStateListener.java:69) shard [nested_data][0] started elassandra | 2020-06-04 17:51:46,971 WARN [elasticsearch[172.18.0.2][search][T#1]] org.elasticsearch.rest.BytesRestResponse.build(BytesRestResponse.java:133) path: /nested_data/_search, params: {index=nested_data} elassandra | org.elasticsearch.action.search.SearchPhaseExecutionException: all shards failed elassandra | at org.elasticsearch.action.search.AbstractSearchAsyncAction.onPhaseFailure(AbstractSearchAsyncAction.java:298) elassandra | at org.elasticsearch.action.search.AbstractSearchAsyncAction.executeNextPhase(AbstractSearchAsyncAction.java:135) elassandra | at org.elasticsearch.action.search.AbstractSearchAsyncAction.onPhaseDone(AbstractSearchAsyncAction.java:261) elassandra | at org.elasticsearch.action.search.InitialSearchPhase.onShardFailure(InitialSearchPhase.java:100) elassandra | at org.elasticsearch.action.search.InitialSearchPhase.access$100(InitialSearchPhase.java:48) elassandra | at org.elasticsearch.action.search.InitialSearchPhase$2.lambda$onFailure$1(InitialSearchPhase.java:220) elassandra | at org.elasticsearch.action.search.InitialSearchPhase.maybeFork(InitialSearchPhase.java:174) elassandra | at org.elasticsearch.action.search.InitialSearchPhase.access$000(InitialSearchPhase.java:48) elassandra | at org.elasticsearch.action.search.InitialSearchPhase$2.onFailure(InitialSearchPhase.java:220) elassandra | at org.elasticsearch.action.search.SearchExecutionStatsCollector.onFailure(SearchExecutionStatsCollector.java:73) elassandra | at org.elasticsearch.action.ActionListenerResponseHandler.handleException(ActionListenerResponseHandler.java:59) elassandra | at org.elasticsearch.action.search.SearchTransportService$ConnectionCountingHandler.handleException(SearchTransportService.java:463) elassandra | at org.elasticsearch.transport.TransportService$ContextRestoreResponseHandler.handleException(TransportService.java:1118) elassandra | at org.elasticsearch.transport.TransportService$DirectResponseChannel.processException(TransportService.java:1230) elassandra | at org.elasticsearch.transport.TransportService$DirectResponseChannel.sendResponse(TransportService.java:1204) elassandra | at org.elasticsearch.transport.TaskTransportChannel.sendResponse(TaskTransportChannel.java:60) elassandra | at org.elasticsearch.action.support.ChannelActionListener.onFailure(ChannelActionListener.java:56) elassandra | at org.elasticsearch.search.SearchService$2.onFailure(SearchService.java:368) elassandra | at org.elasticsearch.search.SearchService$2.onResponse(SearchService.java:362) elassandra | at org.elasticsearch.search.SearchService$2.onResponse(SearchService.java:356) elassandra | at org.elasticsearch.search.SearchService$4.doRun(SearchService.java:1114) elassandra | at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) elassandra | at org.elasticsearch.common.util.concurrent.TimedRunnable.doRun(TimedRunnable.java:41) elassandra | at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:751) elassandra | at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) elassandra | at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) elassandra | at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) elassandra | at java.lang.Thread.run(Thread.java:748) elassandra | Caused by: org.elasticsearch.ElasticsearchException$1: extracted source isn't an object or an array elassandra | at org.elasticsearch.ElasticsearchException.guessRootCauses(ElasticsearchException.java:657) elassandra | at org.elasticsearch.action.search.AbstractSearchAsyncAction.executeNextPhase(AbstractSearchAsyncAction.java:133) elassandra |  26 common frames omitted elassandra | Caused by: java.lang.IllegalStateException: extracted source isn't an object or an array elassandra | at org.elasticsearch.search.fetch.FetchPhase.createNestedSearchHit(FetchPhase.java:340) elassandra | at org.elasticsearch.search.fetch.FetchPhase.execute(FetchPhase.java:166) elassandra | at org.elasticsearch.search.fetch.subphase.InnerHitsFetchSubPhase.hitsExecute(InnerHitsFetchSubPhase.java:69) elassandra | at org.elasticsearch.search.fetch.FetchPhase.execute(FetchPhase.java:184) elassandra | at org.elasticsearch.search.SearchService.executeFetchPhase(SearchService.java:424) elassandra | at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:404) elassandra | at org.elasticsearch.search.SearchService.access$100(SearchService.java:127) elassandra | at org.elasticsearch.search.SearchService$2.onResponse(SearchService.java:360) elassandra |  9 common frames omitted elassandra | 2020-06-04 18:06:06,393 WARN [elasticsearch[172.18.0.2][search][T#2]] org.elasticsearch.rest.BytesRestResponse.build(BytesRestResponse.java:133) path: /nested_data/_search, params: {index=nested_data} elassandra | org.elasticsearch.action.search.SearchPhaseExecutionException: all shards failed elassandra | at org.elasticsearch.action.search.AbstractSearchAsyncAction.onPhaseFailure(AbstractSearchAsyncAction.java:298) elassandra | at org.elasticsearch.action.search.AbstractSearchAsyncAction.executeNextPhase(AbstractSearchAsyncAction.java:135) elassandra | at org.elasticsearch.action.search.AbstractSearchAsyncAction.onPhaseDone(AbstractSearchAsyncAction.java:261) elassandra | at org.elasticsearch.action.search.InitialSearchPhase.onShardFailure(InitialSearchPhase.java:100) elassandra | at org.elasticsearch.action.search.InitialSearchPhase.access$100(InitialSearchPhase.java:48) elassandra | at org.elasticsearch.action.search.InitialSearchPhase$2.lambda$onFailure$1(InitialSearchPhase.java:220) elassandra | at org.elasticsearch.action.search.InitialSearchPhase.maybeFork(InitialSearchPhase.java:174) elassandra | at org.elasticsearch.action.search.InitialSearchPhase.access$000(InitialSearchPhase.java:48) elassandra | at org.elasticsearch.action.search.InitialSearchPhase$2.onFailure(InitialSearchPhase.java:220) elassandra | at org.elasticsearch.action.search.SearchExecutionStatsCollector.onFailure(SearchExecutionStatsCollector.java:73) elassandra | at org.elasticsearch.action.ActionListenerResponseHandler.handleException(ActionListenerResponseHandler.java:59) elassandra | at org.elasticsearch.action.search.SearchTransportService$ConnectionCountingHandler.handleException(SearchTransportService.java:463) elassandra | at org.elasticsearch.transport.TransportService$ContextRestoreResponseHandler.handleException(TransportService.java:1118) elassandra | at org.elasticsearch.transport.TransportService$DirectResponseChannel.processException(TransportService.java:1230) elassandra | at org.elasticsearch.transport.TransportService$DirectResponseChannel.sendResponse(TransportService.java:1204) elassandra | at org.elasticsearch.transport.TaskTransportChannel.sendResponse(TaskTransportChannel.java:60) elassandra | at org.elasticsearch.action.support.ChannelActionListener.onFailure(ChannelActionListener.java:56) elassandra | at org.elasticsearch.search.SearchService$2.onFailure(SearchService.java:368) elassandra | at org.elasticsearch.search.SearchService$2.onResponse(SearchService.java:362) elassandra | at org.elasticsearch.search.SearchService$2.onResponse(SearchService.java:356) elassandra | at org.elasticsearch.search.SearchService$4.doRun(SearchService.java:1114) elassandra | at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) elassandra | at org.elasticsearch.common.util.concurrent.TimedRunnable.doRun(TimedRunnable.java:41) elassandra | at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:751) elassandra | at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) elassandra | at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) elassandra | at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) elassandra | at java.lang.Thread.run(Thread.java:748) elassandra | Caused by: org.elasticsearch.ElasticsearchException$1: extracted source isn't an object or an array elassandra | at org.elasticsearch.ElasticsearchException.guessRootCauses(ElasticsearchException.java:657) elassandra | at org.elasticsearch.action.search.AbstractSearchAsyncAction.executeNextPhase(AbstractSearchAsyncAction.java:133) elassandra |  26 common frames omitted elassandra | Caused by: java.lang.IllegalStateException: extracted source isn't an object or an array elassandra | at org.elasticsearch.search.fetch.FetchPhase.createNestedSearchHit(FetchPhase.java:340) elassandra | at org.elasticsearch.search.fetch.FetchPhase.execute(FetchPhase.java:166) elassandra | at org.elasticsearch.search.fetch.subphase.InnerHitsFetchSubPhase.hitsExecute(InnerHitsFetchSubPhase.java:69) elassandra | at org.elasticsearch.search.fetch.FetchPhase.execute(FetchPhase.java:184) elassandra | at org.elasticsearch.search.SearchService.executeFetchPhase(SearchService.java:424) elassandra | at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:404) elassandra | at org.elasticsearch.search.SearchService.access$100(SearchService.java:127) elassandra | at org.elasticsearch.search.SearchService$2.onResponse(SearchService.java:360) elassandra |  9 common frames omitted  * cassandra schema:  CREATE KEYSPACE nested_data WITH replication = {'class': 'NetworkTopologyStrategy', 'DC1': '1'} AND durable_writes = true; CREATE TYPE nested_data.nested_data_parent_nested_nested_object1 ( field1 list<text>, field2 list<text> ); CREATE TYPE nested_data.nested_data_parent_nested_nested_object2 ( field2 list<text> ); CREATE TYPE nested_data.nested_data_parent_nested ( ""nested-object1"" list<frozen<nested_data_parent_nested_nested_object1>>, ""nested-object2"" list<frozen<nested_data_parent_nested_nested_object2>> ); CREATE TABLE nested_data.nested_data ( ""_id"" text PRIMARY KEY, ""parent-nested"" list<frozen<nested_data_parent_nested>> ) WITH bloom_filter_fp_chance = 0.01 AND caching = {'keys': 'ALL', 'rows_per_partition': 'NONE'} AND comment = '' AND compaction = {'class': 'org.apache.cassandra.db.compaction.SizeTieredCompactionStrategy', 'max_threshold': '32', 'min_threshold': '4'} AND compression = {'chunk_length_in_kb': '64', 'class': 'org.apache.cassandra.io.compress.LZ4Compressor'} AND crc_check_chance = 1.0 AND dclocal_read_repair_chance = 0.1 AND default_time_to_live = 0 AND gc_grace_seconds = 864000 AND max_index_interval = 2048 AND memtable_flush_period_in_ms = 0 AND min_index_interval = 128 AND read_repair_chance = 0.0 AND speculative_retry = '99PERCENTILE'; CREATE CUSTOM INDEX elastic_nested_data_idx ON nested_data.nested_data () USING 'org.elassandra.index.ExtendedElasticSecondaryIndex'; "
68,elassandra,https://github.com/strapdata/elassandra/issues/68,ES Object Type stringified in search,"When inserting fields mapped as object type contents are returned as strings in search. In comparison my stock ES 2.x returns object fields as a valid JSON objects without escaping.  Steps to Reproduce * Create Mapping: json PUT watcher/watch/_mapping { ""properties"": { ""uuid"": { ""type"": ""string"", ""index"": ""not_analyzed"" }, ""condition"": { ""type"":""object"", ""enabled"": false } } }  * Insert document with object fields json PUT watcher/watch/test_watch_random23 { ""uuid"": ""test"", ""trigger"": { ""schedule"": { ""later"": ""every 1 minutes"" } }, ""condition"": { ""script"": { ""script"": ""payload.hits.total > 1"" } } }  * Query results, objects are returned as strings  GET watcher/_search { ""took"": 6, ""timed_out"": false, ""_shards"": { ""total"": 1, ""successful"": 1, ""failed"": 0 }, ""hits"": { ""total"": 1, ""max_score"": 1, ""hits"": [ { ""_index"": ""watcher"", ""_type"": ""watch"", ""_id"": ""test_watch_random23"", ""_score"": 1, ""_source"": { ""condition"": ""{\""script\"":{\""script\"":\""payload.hits.total > 1\""}}"", ""trigger"": { ""schedule"": { ""later"": ""every 1 minutes"" } }, ""uuid"": ""test"" } } ] } } ",source-file | test-file,object type stringified search inserting fields mapped object type contents returned strings search comparison stock returns object fields valid json objects without escaping steps reproduce create mapping json put watcher watch mapping properties uuid type string index analyzed condition type object enabled false insert document object fields json put watcher watch watch random uuid trigger schedule later every minutes condition script script payload hits total query results objects returned strings get watcher search took timed false shards total successful failed hits total max score hits index watcher type watch watch random score condition script script payload hits total trigger schedule later every minutes uuid,bug,0.95,"ES Object Type stringified in search When inserting fields mapped as object type contents are returned as strings in search. In comparison my stock ES 2.x returns object fields as a valid JSON objects without escaping.  Steps to Reproduce * Create Mapping: json PUT watcher/watch/_mapping { ""properties"": { ""uuid"": { ""type"": ""string"", ""index"": ""not_analyzed"" }, ""condition"": { ""type"":""object"", ""enabled"": false } } }  * Insert document with object fields json PUT watcher/watch/test_watch_random23 { ""uuid"": ""test"", ""trigger"": { ""schedule"": { ""later"": ""every 1 minutes"" } }, ""condition"": { ""script"": { ""script"": ""payload.hits.total > 1"" } } }  * Query results, objects are returned as strings  GET watcher/_search { ""took"": 6, ""timed_out"": false, ""_shards"": { ""total"": 1, ""successful"": 1, ""failed"": 0 }, ""hits"": { ""total"": 1, ""max_score"": 1, ""hits"": [ { ""_index"": ""watcher"", ""_type"": ""watch"", ""_id"": ""test_watch_random23"", ""_score"": 1, ""_source"": { ""condition"": ""{\""script\"":{\""script\"":\""payload.hits.total > 1\""}}"", ""trigger"": { ""schedule"": { ""later"": ""every 1 minutes"" } }, ""uuid"": ""test"" } } ] } } "
295,elassandra,https://github.com/strapdata/elassandra/issues/295,dots in object mapping ignored,"**Describe the feature**: Dots in object-field names are silently ignored **Elassandra version**: 6.2.3.15 **Plugins installed**: [] **JVM version** (`java -version`): OpenJDK Runtime Environment (build 1.8.0_212-8u212-b01-1~deb9u1-b01) OpenJDK 64-Bit Server VM (build 25.212-b01, mixed mode) **OS version** (`uname -a` if on a Unix-like system): Linux db1-dev 4.9.0-9-amd64 #1 SMP Debian 4.9.168-1+deb9u2 (2019-05-13) x86_64 GNU/Linux **Description of the problem including expected versus actual behavior**: **Steps to reproduce**: **1. Create empty index - e.g. testindex** **2. PUT /testindex/_doc/1** Request-Body: { ""us.er"" : ""test"", ""postdate"" : ""2009-11-15T14:12:12"", ""message"" : ""Test123"" } i get the following response document: { ""_index"": ""testindex"", ""_type"": ""_doc"", ""_id"": ""1"", ""_version"": 1, ""result"": ""created"", ""_shards"": { ""total"": 1, ""successful"": 1, ""failed"": 0 } } **3. GET on http://127.0.0.1:9200/testindex/_doc/1** { ""_index"": ""testindex"", ""_type"": ""_doc"", ""_id"": ""1"", ""_version"": 1, ""found"": true, ""_source"": { ""postdate"": ""2009-11-15T14:12:12.000Z"", ""message"": ""Test123"" } } the field with the dot in the name (us.er) is silently ignored.",source-file | test-file,dots object mapping ignored describe feature dots object field names silently ignored plugins installed jvm openjdk runtime environment deb openjdk bit server mixed mode uname unix like system linux amd smp debian deb gnu linux description including expected versus actual behavior steps reproduce create empty index testindex put testindex body postdate message get following response document index testindex type result created shards total successful failed get http testindex index testindex type found true postdate message field dot name silently ignored,bug,0.95,"dots in object mapping ignored **Describe the feature**: Dots in object-field names are silently ignored **Elassandra version**: 6.2.3.15 **Plugins installed**: [] **JVM version** (`java -version`): OpenJDK Runtime Environment (build 1.8.0_212-8u212-b01-1~deb9u1-b01) OpenJDK 64-Bit Server VM (build 25.212-b01, mixed mode) **OS version** (`uname -a` if on a Unix-like system): Linux db1-dev 4.9.0-9-amd64 #1 SMP Debian 4.9.168-1+deb9u2 (2019-05-13) x86_64 GNU/Linux **Description of the problem including expected versus actual behavior**: **Steps to reproduce**: **1. Create empty index - e.g. testindex** **2. PUT /testindex/_doc/1** Request-Body: { ""us.er"" : ""test"", ""postdate"" : ""2009-11-15T14:12:12"", ""message"" : ""Test123"" } i get the following response document: { ""_index"": ""testindex"", ""_type"": ""_doc"", ""_id"": ""1"", ""_version"": 1, ""result"": ""created"", ""_shards"": { ""total"": 1, ""successful"": 1, ""failed"": 0 } } **3. GET on http://127.0.0.1:9200/testindex/_doc/1** { ""_index"": ""testindex"", ""_type"": ""_doc"", ""_id"": ""1"", ""_version"": 1, ""found"": true, ""_source"": { ""postdate"": ""2009-11-15T14:12:12.000Z"", ""message"": ""Test123"" } } the field with the dot in the name (us.er) is silently ignored."
298,elassandra,https://github.com/strapdata/elassandra/issues/298,build_hash and build_date as Unknown after Installing ELS,"Hi, Post installation of elassandra i see output of curl -X GET http://localhost:9200/ having build_hash and build_date as Unknown Could you please fix the same? Thanks Ashish",source-file,hash date unknown installing els post installation see output curl get http localhost hash date unknown could please thanks ashish,bug,0.85,"build_hash and build_date as Unknown after Installing ELS Hi, Post installation of elassandra i see output of curl -X GET http://localhost:9200/ having build_hash and build_date as Unknown Could you please fix the same? Thanks Ashish"
