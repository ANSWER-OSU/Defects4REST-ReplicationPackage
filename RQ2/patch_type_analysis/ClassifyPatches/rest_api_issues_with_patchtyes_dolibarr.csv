issue_no,repo,issue_url,title,description,patched_file_types
29797,dolibarr,https://github.com/Dolibarr/dolibarr/issues/29797,"Webhook targets are active, even if they are deactivated",Bug Everything is in the title :)  Dolibarr Version 19.0.2  Environment PHP PHP8.2  Environment Database MariaDB  Steps to reproduce the behavior and expected behavior Create a target Activate it Webhook works Deactivate the target Webhook still works  Attached files _No response_,source-file
31015,dolibarr,https://github.com/Dolibarr/dolibarr/issues/31015,Can't add payment through API since upgrade to 20.0,"Bug Hello, Since upgrade to version 20.0, I can't add a payment to an invoice through the API. I'm getting this error: `{ ""error"": { ""code"": 400, ""message"": ""Bad Request: Payment error : Incorrect datetime value: '' for column `dolibarr`.`llx_paiement`.`datep` at row 1"" }, ""debug"": { ""source"": ""api_invoices.class.php:1516 at call stage"", ""stages"": { ""success"": [ ""get"", ""route"", ""negotiate"", ""authenticate"", ""validate"" ], ""failure"": [ ""call"", ""message"" ] } } }` The request has not changed since months: `CallDOAPI(""POST"", ""/invoices/$facid/payments"", json_encode(array(""datepaye""=>time(), ""paymentid""=>6, ""closepaidinvoices""=>""yes"", ""accountid""=>5;` time() returns the expected value (tried with another value and I'm getting the ""Bad Request: Invalid value specified for `datepaye`. Expecting unix timestamp, such as 1726652385"" error). The function called is: `$paymentobj->datepaye = dol_stringtotime($datepaye);` In version 19.0.3, it was: `$paymentobj->datepaye = $datepaye;`  Dolibarr Version 20.0.0  Environment PHP 8.2.23  Environment Database MariaDB 10.11.6  Steps to reproduce the behavior and expected behavior See above  Attached files _No response_",source-file
32072,dolibarr,https://github.com/Dolibarr/dolibarr/issues/32072,PUT method doesn't change the value of the extra fields of the shipments module,"Bug When using the `PUT /shipments/{id}` method of the REST_API, the extra fields contained under array_options does not change after a successfull API call.  Dolibarr Version 20.0.2  Environment PHP 8.2.24  Environment Database MySQL or MariaDB 10.9.8-MariaDB-1:10.9.8+maria~deb11  Steps to reproduce the behavior and expected behavior Request body: ![image](https://github.com/user-attachments/assets/69469a27-7e3a-41d3-9e8e-824c4655a549) Response body: ![image](https://github.com/user-attachments/assets/2ed921df-87c9-4b7a-9f3b-ca9be14a6e84) If I try to update a normal field, it works: Request body: ![image](https://github.com/user-attachments/assets/4fc06e53-18bb-43da-bc15-cc43a4f7056b) Response body: ![image](https://github.com/user-attachments/assets/0f7dafe7-db70-48c7-aedc-36de0ce8e36a) If I use the `PUT /products/{id}` method, that also works fine: Request body: ![image](https://github.com/user-attachments/assets/6d8b0be0-af9e-4d3d-838a-59d93290b5d5) Response body: ![image](https://github.com/user-attachments/assets/080dd026-b50d-4966-9acc-b262af22a16f) It looks like the products API handle the array_options: https://github.com/Dolibarr/dolibarr/blob/develop/htdocs/product/class/api_products.class.php#L397 But the shipment API does not: https://github.com/Dolibarr/dolibarr/blob/develop/htdocs/expedition/class/api_shipments.class.php#L486  Attached files _No response_",source-file
26881,dolibarr,https://github.com/Dolibarr/dolibarr/issues/26881,REST API thirparties setlevelprice fix,Bug problem : the API thirparties setlevelprice does not work solution : in file api_thirdparties.class.php correct L562 from ` * @url PUT {id}/setpricelevel` to ` * @url PUT {id}/setpricelevel/{priceLevel}` to fix the API  Environment Version 18.0.3  Environment OS _No response_  Environment Web server _No response_  Environment PHP _No response_  Environment Database _No response_  Environment URL(s) _No response_  Expected and actual behavior _No response_  Steps to reproduce the behavior _No response_  Attached files _No response_,source-file
23790,dolibarr,https://github.com/Dolibarr/dolibarr/issues/23790,"Bug: REST API ""/mos/{id}/produceandconsume"" not possible to consume specific MoLines","Bug The implementation doest correspond the function in Dolibarr. i need feedback if i should revise the function.  Environment Version 17  Environment OS _No response_  Environment Web server _No response_  Environment PHP _No response_  Environment Database _No response_  Environment URL(s) _No response_  Expected and actual behavior **Expected behavior:** Like the same behavior with the API as in the Dolibarr UI: ![image](https://user-images.githubusercontent.com/78662388/216821734-096cc624-f9c7-432a-958b-f3a52d58aba3.png) _REST Call:_  { ""inventorylabel"": ""Production of MO2301-0005"", ""inventorycode"": ""20230205140301"", ""autoclose"": 1, ""arraytoconsume"": [{""objectId"": 253, ""qty"": 2, ""fk_warehouse"": 1}], ""arraytoproduce"": [] }  **Actual behavior:** The REST Call returns a ""Internal Server Error"". Problems: 1. Only if no value in arraytoconsume and arraytoproduce the API make a ""automatic"" consum and produce over all MoLines. Its crashing if the Stockvalue is lower then the expected qty in the MoLine. 2. The ""objectId"" is linked to fk_product. This is wrong we need a link to the MoLine. 3. If you set a value in arraytoconsume or arraytoproduce then the API function try to generate a new MoLine. The current implementation of the API function make not ""produce and consume"".  Steps to reproduce the behavior _No response_  Attached files _No response_",source-file
27173,dolibarr,https://github.com/Dolibarr/dolibarr/issues/27173,Blank page when creating event (action) with a missing required extra field,"Bug If one adds a required extra field to events, then tries to create an event forgetting this field, instead of seeing the pre-filled form they get a blank page.  Environment Version 17.0.2, 17.0.3 probably all above  Environment OS Debian 11  Environment Web server Apache/2.4.56 (Debian)  Environment PHP 7.4.33  Environment Database 11.1.2-MariaDB  Environment URL(s) comm/action/card.php  Expected and actual behavior ## Expected I should see the erroneous form so I can easily complete and resubmit it ## Actual Blank page with an error message alerting me about the missing field  Steps to reproduce the behavior 1. Add a required extra field to events 2. Create an event omitting to complete this field 3. Blank page  Attached files The following patch fixes the issue (PR will follow) patch diff --git a/htdocs/comm/action/card.php b/htdocs/comm/action/card.php index dab70304d08..7eb5b68db9a 100644  a/htdocs/comm/action/card.php  b/htdocs/comm/action/card.php @@ -419,7 +419,8 @@ if (empty($reshook) && $action == 'add') { // Fill array 'array_options' with data from add form $ret = $extrafields->setOptionalsFromPost(null, $object); if ($ret < 0) { - $error++; + $error++;$donotclearsession = 1; + $action = 'create'; }",source-file
29424,dolibarr,https://github.com/Dolibarr/dolibarr/issues/29424,BUG: in API GET member categories,"Bug If you in dolibarr version 20-alpha tries to use the API to get member categories it does not respect when you supply a non existing member id, where as in version 18.0.5 it does respect and gives an error.  Dolibarr Version 20.0.0-alpha  Environment PHP 8.2.7  Environment Database 10.11.7-MariaDB-1:10.11.7+maria~ubu2204  Steps to reproduce the behavior and expected behavior create some member categories and assign some members to them. use the API to get the member categories for a non existing member expected is an error better than the one in 18.0.5, because in 18.0.5 it says that the category does not exist, but it is the member that does not exist.  Attached files v20 ignores non existing members ![get_member_categories_v20_ignores_nonexisting_member](https://github.com/Dolibarr/dolibarr/assets/2551481/5a054bc6-4608-47c9-8ad1-6d83b1033e82)",source-file
33689,dolibarr,https://github.com/Dolibarr/dolibarr/issues/33689,API > supplierorders > post lines not working,Bug @mdeweerd : in commit 035ede5 the function post() in api_supplier_order.class.php has been modified at the beginning `// Check mandatory fields` `$request_data = $this->_validate($request_data);` where we previously we had `$result = $this->_validate($request_data);` this breaks the function to import lines order for me  Dolibarr Version develop  Environment PHP _No response_  Environment Database _No response_  Steps to reproduce the behavior and expected behavior _No response_  Attached files _No response_,source-file
30950,dolibarr,https://github.com/Dolibarr/dolibarr/issues/30950,Bad ref in supplier invoice created by Rest API from an invoice template,"Bug When a supplier invoice is created from the Rest API with an invoice template, Dolibarr always add `_1` at the end of the ref.  Dolibarr Version 19.0.1  Environment PHP _No response_  Environment Database _No response_  Steps to reproduce the behavior and expected behavior 1. Create an invoice template 2. Call the API with this body: json { ""date"": ""1725235200"", ""fac_rec"": 1, ""ref_supplier"": ""my_ref"", ""socid"": 1 }   Attached files _No response_",source-file
29594,dolibarr,https://github.com/Dolibarr/dolibarr/issues/29594,REST API PUT `/contacts/{id}`: `update` called with notrigger = 1,"Bug Currently, the API endpoint for contact update bypasses triggers (notrigger = 1). The same is true for some other PUT endpoints (~~thirdparty for instance~~), but not all (contract, BOM, proposal, anything made with ModuleBuilder, etc.). **[edit]** I was wrong about `thirdparty` because Societe::update's 3rd parameter is `$call_trigger` and not `$notrigger` as is usually the case. So the 3rd parameter is `1` but it _does_ call the trigger. If the endpoint `PUT /contacts/{id}` was copy-pasted from the third party API, it could explain this issue because this detail is easy to overlook (I'm a good example of that). I assume this is on purpose, but I can't find the reason why, and it is inconsinstent (why notrigger for updating and not for creating, why some objects and not others). We are developing a feature using triggers to change information whenever a contact is created or updated, but because of this `notrigger`, we can't make it work in APIs.  Dolibarr Version 17.0, 18.0, 19.0, develop,   Environment PHP any  Environment Database _No response_  Steps to reproduce the behavior and expected behavior 1. Implement triggers CONTACT_MODIFY and CONTACT_CREATE (let's say they both do the same: they concatenate ""elloworld"" to the lastname of the contact) 2. create a contact with lastname ""h"" using Dolibarr interface OK, its name is ""helloworld"" 3. edit the contact with lastname ""h"" using Dolibarr interface  OK, its name is ""helloworld"" 4. create a contact with lastname ""h"" using Dolibarr API POST /contacts  OK, its name is ""helloworld"" 5. update a contact with lastname ""h""using Dolibarr API PUT /contacts/{id}  KO (its is still ""h"")  Attached files _No response_",source-file
24661,dolibarr,https://github.com/Dolibarr/dolibarr/issues/24661,Start and end date of contract lines not available in API anymore,"Bug In version 17 the contract start and end dates of contract lines are not exposed in the API anymore but are [cleaned before](https://github.com/Dolibarr/dolibarr/blob/b1e62d729754b94d8a50a83f1903ef3197a061e7/htdocs/contrat/class/api_contracts.class.php#L664).  Environment Version 17.0.1  Environment OS _No response_  Environment Web server _No response_  Environment PHP _No response_  Environment Database _No response_  Environment URL(s) /api/index.php/contracts/93  Expected and actual behavior Until version 16, start and end dates of individual contract lines were included in the API response in the fields `date_start`, `date_start_real`, `date_end` and `date_end_real`. This was apparently changed in d597eb8 when the legacy field names were permanently removed. I would expect that the dates continue to be sent in the API as they are not particularly sensitive.  Steps to reproduce the behavior _No response_  Attached files _No response_",source-file | data-file
29439,dolibarr,https://github.com/Dolibarr/dolibarr/issues/29439,API GET /documents doesn't return all information,"Bug Hi, I use API to retrive share link of my invoices. After some tests it seemed OK but I don't know why, GET /documents returned content is not consistent. Exampel using API explorer : GET api/index.php/documents?modulepart=invoice&id=226  [ { ""name"": ""FA2403-0183.pdf"", ""path"": ""/var/lib/dolibarr/documents/facture/FA2403-0183"", ""level1name"": ""FA2403-0183"", ""relativename"": ""FA2403-0183.pdf"", ""fullname"": ""/var/lib/dolibarr/documents/facture/FA2403-0183/FA2403-0183.pdf"", ""date"": 1710515325, ""size"": 67051, ""type"": ""file"", ""label"": ""XXXXXXXXXX"", ""entity"": ""1"", ""filename"": ""FA2403-0183.pdf"", ""filepath"": ""facture/FA2403-0183"", ""fullpath_orig"": """", ""description"": """", ""keywords"": """", ""cover"": null, ""position"": ""1"", ""gen_or_uploaded"": ""generated"", ""extraparams"": null, ""date_c"": 1710515325, ""date_m"": 1710515325, ""fk_user_c"": ""1"", ""fk_user_m"": null, ""acl"": null, ""src_object_type"": ""facture"", ""src_object_id"": ""226"", ""id"": ""682"", ""ref"": ""682"", ""share"": ""XXXXXXXXXXXX"" } ]  GET api/index.php/documents?modulepart=invoice&id=251  [ { ""name"": ""FA2404-0204.pdf"", ""path"": ""/var/lib/dolibarr/documents/facture/FA2404-0204"", ""level1name"": ""FA2404-0204"", ""relativename"": ""FA2404-0204.pdf"", ""fullname"": ""/var/lib/dolibarr/documents/facture/FA2404-0204/FA2404-0204.pdf"", ""date"": 1713257786, ""size"": 67550, ""type"": ""file"" } ]  Both in webUI have a share link for example. I can't get what could lead to this difference of behaviour  Regards  Dolibarr Version 18.0.4  Environment PHP 7.4  Environment Database MariaDB  Steps to reproduce the behavior and expected behavior _No response_  Attached files _No response_ ## EDIT Ok I'm close from a solution :) I found the problem but don't know exactly how to solve it  And maybe there are two bugs in one So in /htdocs/api/class/api_documents.class.php there is the main function, which call for fetchAll() of htdocs/ecm/class/ecmfiles.class.php The problem here is that the SQL built use ""LIKE"" in WHERE condition. In my case, I'm looking for an invoice. But if the src_object_id exists for different objects, multiple lines are return. So maybe it's the bug n1 because ""LIKE %facture%"" also returns ""facture_fourn"" type for example. So if multiple lines are returned by fetchAll() , this code is invloved :  $result = $ecmfile->fetchAll('', '', 0, 0, array('t.src_object_type' => $objectType, 't.src_object_id' => $object->id)); if ($result < 0) { throw new RestException(503, 'Error when retrieve ecm list : '.$this->db->lasterror()); } elseif (is_array($ecmfile->lines) && count($ecmfile->lines) > 0) { $count = count($filearray); for ($i = 0 ; $i < $count ; $i++) { if ($filearray[$i]['name'] == $ecmfile->lines[$i]->filename) { $filearray[$i] = array_merge($filearray[$i], (array) $ecmfile->lines[0]); } } }  And it seems not able to healthy manage this case because I debuged it, if ($filearray[$i]['name'] == $ecmfile->lines[$i]->filename) is never triggered (I'm still searching for a solution on this part). So it's bug n2 ## EDIT 2 Solved :)  if ($filearray[$i]['name'] == $ecmfile->lines[$i]->filename) { $filearray[$i] = array_merge($filearray[$i], (array) $ecmfile->lines[0]); }  Replaced by  foreach ($ecmfile->lines as $line) { if ($filearray[$i]['name'] == $line->filename) { $filearray[$i] = array_merge($filearray[$i], (array) $line); } }  Allows to scan all files returned in $ecmfiles for each file in $filearray, and merge them if filenames match",source-file | database-file | data-file | documentation-file
31677,dolibarr,https://github.com/Dolibarr/dolibarr/issues/31677,Bug: API Missing Support BomLine DefaultWorkstationId,Bug DefaultWorkstationId is not implemented in the API.  Dolibarr Version 20  Environment PHP _No response_  Environment Database _No response_  Steps to reproduce the behavior and expected behavior _No response_  Attached files _No response_,source-file
32111,dolibarr,https://github.com/Dolibarr/dolibarr/issues/32111,Impossible to set the date of a payment using API,"Bug At `htdocs/compta/facture/class/api_invoices.class.php` you have: `$paymentobj->datepaye = dol_stringtotime($datepaye);` So the code expects a date string: 2024/11/26 (instead timestamp) but if I try to give a date string I get a response (from DOLIBARR API): Message: Bad Request: Invalid value specified for `datepaye`. Expecting unix timestamp, such as 1732638616 It is not possible to workaround this in my code, so I patched the code to be: `$paymentobj->datepaye = (int) $datepaye;` I don't know/have not checked if other part code of the code is sending date string instead of a timestamp Whatever is the write way to fix this (date string or timestamp), I will use it when this is addressed in a future release, thanks  Dolibarr Version 20.0.1  Environment PHP 8.2  Environment Database _No response_  Steps to reproduce the behavior and expected behavior Use API to created/update a payment  Attached files _No response_",source-file
24780,dolibarr,https://github.com/Dolibarr/dolibarr/issues/24780,500 Error - Serialization error during update of custom field,"Bug When I attempt to update a custom field from the facture card, I have a unhandled 500 error. I just updated : - dolibarr from 16.0.4 to 17.0.1 - ubuntu 20.04 to 22.04 - php from 7.4 to 8.1 - pgsql from 12.x to 14.7) This custom field is a simple boolean and was working before the bunch of update. Here is the apache log.  [Mon May 15 21:54:34.209985 2023] [php:error] [pid 5655] [client 12.34.56.78:50449] PHP Fatal error: Uncaught Exception: Serialization of 'PgSql\\Connection' is not allowed in /opt/dolibarr/htdocs/core/lib/functions.lib.php:1167\nStack trace:\n#0 /opt/dolibarr/htdocs/core/lib/functions.lib.php(1167): serialize()\n#1 /opt/dolibarr/htdocs/compta/facture/card.php(2875): dol_clone()\n#2 {main}\n thrown in /opt/dolibarr/htdocs/core/lib/functions.lib.php on line 1167, referer: https://myowidolibarr.ca/compta/facture/card.php?id=61&action=edit_extras&token=hiddentoken&attribute=quickbooks&ignorecollapsesetup=1   Environment Version 17.0.1  Environment OS Ubuntu 22.04 LTS  Environment Web server Apache 2.4  Environment PHP php 8.1.2  Environment Database postgresql 14.7  Environment URL(s) /compta/facture/card.php  Expected and actual behavior **Expected behaviour:** Just refresh the page with updated custom field (box checked in my case) **Actual behaviour:** After submit the update of the single custom field, I see the 500 error on my browser.  Steps to reproduce the behavior Pre-requisite: have a (boolean) custom field on invoice card. Create an invoice without filling the custom field. once created (and validated), click the pen near the custom field to enable input, update the custom field and click Update <- and showtime  Attached files Concern my ""quickbooks"" field <img width=""694"" alt=""image"" src=""https://github.com/Dolibarr/dolibarr/assets/1232923/ed62bed1-d20e-48a8-b53c-0d03f57017bd""> <img width=""1475"" alt=""image"" src=""https://github.com/Dolibarr/dolibarr/assets/1232923/bdd21b75-8db6-4dfb-a482-b6e61a4d16f9"">",source-file
30800,dolibarr,https://github.com/Dolibarr/dolibarr/issues/30800,WebHook Error in Make.com,"Bug When trying to establish a connection with Make, I encountered many issues because the JSON that Make.com was receiving was malformed. So, what I did was add the following variable to the `interface_95_modWebhook_WebhookTriggers.class.php` file: $headers = array( 'Content-Type: application/json', 'Accept: application/json' ); And the getURLContent method ended up as follows: $response = getURLContent($tmpobject->url, 'POST', $jsonstr, 1, $headers, array('http', 'https'), 0, -1);  Dolibarr Version 19.03  Environment PHP 7.4  Environment Database MariaDB  Steps to reproduce the behavior and expected behavior Create a webhook in Make.com, copy the webhook link, and configure it in the Dolibarr WebHook module. Set the parameter as CREATE_COMPANY and wait to analyze the string that Make.com receives.  Attached files _No response_",source-file
25929,dolibarr,https://github.com/Dolibarr/dolibarr/issues/25929,error on api_proposals.class.php,"Bug if call to endpoint /api/index.php/proposals/xxxxx/lines without sql filter this generate an exception The line 319 of file htdocs/comm/propal/class/api_proposals.class.php say: $this->propal->getLinesArray($sql); and $sql is not set this line would set into if at line 311 if (!empty($sqlfilters)) {  Environment Version 18.0.1  Environment OS Ubuntu 22.04  Environment Web server Nginx  Environment PHP 8.2  Environment Database mariadb 10  Environment URL(s) _No response_  Expected and actual behavior 2023/09/15 13:02:57 [error] 704889#704889: *47475930 FastCGI sent in stderr: ""PHP message: PHP Warning: Undefined variable $sql in /xxxxx/htdocs/comm/propal/class/api_proposals.class.php on line 319"" while reading response header from upstream, client: xxx.xxx.xxx.xx, server: xxxxxxxt, request: ""GET /api/index.php/proposals/nnnnn/lines HTTP/1.1"", upstream: ""fastcgi://unix:/run/php/php8.2-fpm.sock:"", host: ""xxxxxxx""  Steps to reproduce the behavior curl -X GET --header 'Accept: application/json' --header 'DOLAPIKEY: xxxxxx' 'https://xxxxxxx/api/index.php/proposals/nnnnnn/lines'  Attached files _No response_",source-file
32096,dolibarr,https://github.com/Dolibarr/dolibarr/issues/32096,linkedObjectsIds is null when doing a search,"Bug The API return null for the `linkedObjectsIds` field when doing a search, but when querying the order directly, it returns the references correctly.  Dolibarr Version 20.0.2  Environment PHP 8.2.24  Environment Database MySQL or MariaDB 10.9.8-MariaDB-1:10.9.8+maria~deb11  Steps to reproduce the behavior and expected behavior Result of: `GET http://dolibarr_ip/dolibarr/api/index.php/orders?sqlfilters=ref:like:SO2411-0003` json [ { ""module"": null, ""id"": ""5"", ""entity"": ""1"", ""import_key"": null, ""array_options"": [], ""array_languages"": null, ""contacts_ids"": [], ""linkedObjectsIds"": null, ""canvas"": null, ""fk_project"": null, ""contact_id"": null, ""user"": null, ""origin_type"": null, ""origin_id"": null, ""ref"": ""SO2411-0003"" } ]  Result of: `GET http://dolibarr_ip/dolibarr/api/index.php/orders/5` json { ""module"": null, ""id"": ""5"", ""entity"": ""1"", ""import_key"": null, ""array_options"": [], ""array_languages"": null, ""contacts_ids"": [], ""linkedObjectsIds"": { ""shipping"": { ""3"": ""3"" } }, ""canvas"": null, ""fk_project"": null, ""contact_id"": null, ""user"": null, ""origin_type"": null, ""origin_id"": null, ""ref"": ""SO2411-0003"" } ]   Attached files _No response_",source-file
26066,dolibarr,https://github.com/Dolibarr/dolibarr/issues/26066,No autorisation control on GET /multicurrencies through API,"Bug No autorisation control on GET /multicurrencies through API, where as GET /multicurrencies/bycode/{code} has autorisation control.  Environment Version 18.0.1  Environment OS upshift dolibarr docker image 18.0.1  Environment Web server upshift dolibarr docker image 18.0.1  Environment PHP PHP 8.2.10 (cli) (built: Aug 31 2023 20:34:52) (NTS)  Environment Database 1:11.0.3+maria~ubu2204  Environment URL(s) /api/index.php/multicurrencies?sortfield=t.rowid&sortorder=ASC&limit=100  Expected and actual behavior Expected rejection given that my API key is from a user that only has 3 permissions: 1. read access to products 2. read access to services 3. read access to tags and categories but no, the actual behaviour was that if I just asked for all currencies, then I got the data, where as if I only asked for the EUR currency, then I get `""message"": ""Unauthorized: Insufficient rights to read currency""`  Steps to reproduce the behavior enable modules: products, categories and multicurrency. Setup DKK and Eur currencies.  Attached files ![get_all_currencies](https://github.com/Dolibarr/dolibarr/assets/2551481/d3b6e500-f765-48fa-9cf2-ff6b0780aa46) ![get_EUR_currency](https://github.com/Dolibarr/dolibarr/assets/2551481/e9c3b409-4ed6-4c7a-9b47-b421e502cc7c)",source-file
29421,dolibarr,https://github.com/Dolibarr/dolibarr/issues/29421,BUG: API GET /members/types/{id} says it deletes member type,"Bug BUG: API GET /members/types/{id} says it deletes member type { ""success"": { ""code"": 200, ""message"": ""Member type deleted"" } } but GET should never do that, only DELETE  Dolibarr Version 20.0.0-alpha  Environment PHP 8.2.7  Environment Database 10.11.7-MariaDB-1:10.11.7+maria~ubu2204  Steps to reproduce the behavior and expected behavior enable API module, create API key for user, visit the API explorer, scroll down and find GET /members/types/{id}, fill in a number, any number, even 89327434 and it says { ""success"": { ""code"": 200, ""message"": ""Member type deleted"" } }  Attached files ![get_member_types_says_delete_membeR_types](https://github.com/Dolibarr/dolibarr/assets/2551481/0cb13c2d-7408-4a73-a7a4-4c45c77f9b64)",source-file
23248,dolibarr,https://github.com/Dolibarr/dolibarr/issues/23248,Prices not updated when external user (client) create a propal or command,"Bug I just found (and hope to have resolved) a quite tricky bug: In one of my projects, we allow some clients to connect to Dolibarr to create themselves their commands They can add lines to the command, but if they choose a predefined product or service, its price is not copied in #price_ht input A dive in the code shows that /core/tpl/objectline_create.tpl.php make an ajax call to /product/ajax/products.php In this file line ~68 (65 in dev branch) `restrictedArea($user, 'produit|service', 0, 'product&product');` doesnt allow access to external users, and the ajax call throw an error which in not logged :-\ (because of line ~320 `if (!empty($user->socid) && !empty($conf->global->MAIN_MODULES_FOR_EXTERNAL) && !in_array($featureforlistofmodule, $listofmodules)) { // If limits on modules for external users, module must be into list of modules for external users` in /core/lib/security.lib.php) I suggest after tests to change line ~68 in /product/ajax/products.php to `restrictedArea($user, 'produit|service|commande|propal', 0, 'product&product');`  Environment Version All including dev  Environment OS _No response_  Environment Web server _No response_  Environment PHP _No response_  Environment Database _No response_  Environment URL(s) _No response_  Expected and actual behavior _No response_  Steps to reproduce the behavior _No response_  Attached files _No response_",source-file
23179,dolibarr,https://github.com/Dolibarr/dolibarr/issues/23179,Bug: Products REST API don't update the Notes (Private and Public) Property,"Bug The /products/{id} REST Call is not Updateing the Notes.  Environment Version 17 beta  Environment OS _No response_  Environment Web server _No response_  Environment PHP _No response_  Environment Database _No response_  Environment URL(s) _No response_  Expected and actual behavior _No response_  Steps to reproduce the behavior ![image](https://user-images.githubusercontent.com/78662388/206912078-d69691ac-639a-4838-b782-23442458c811.png) See in the ""Response Body"": ""note_public"": ""note_private"": the old values are avalible.  Attached files _No response_",source-file
29292,dolibarr,https://github.com/Dolibarr/dolibarr/issues/29292,The colon char is breaking sqlfilters search,"Bug If you try :  http://my-dolibarr.local/api/index.php/orders?sortfield=t.rowid&sortorder=ASC&limit=100&sqlfilters=t.ref_client%3A%3D%3A'a%3Ab'  With sqlfilters which is `t.ref_client:=:'a:b'`, the `:` make everything breaks. With this filter, it find order with those client ref: ""LAvionJaune"", ""test"", ""htrh"", ""Mathis55109"". I don't understand why or how it works, but it's very strange.  Dolibarr Version 18.0.5  Environment PHP 8.1.27  Environment Database MariaDB 10.11.6  Steps to reproduce the behavior and expected behavior Call API with this : `api/index.php/orders?sortfield=t.rowid&sortorder=ASC&limit=100&sqlfilters=t.ref_client%3A%3D%3A'a%3Ab'`, in general with a `:` in the ref client  Attached files _No response_",source-file | test-file
32145,dolibarr,https://github.com/Dolibarr/dolibarr/issues/32145,Ticket module - Condition validation is wrong,"Bug In the ticket/card.php file there is a condition that is evaluated incorrectly because the ""private_message"" parameter is compared to an unexpected value. `if ($action == 'add_message' && GETPOSTISSET('btn_add_message') && $permissiontoread) {` `$ret = $object->newMessage($user, $action, (GETPOST('private_message', 'alpha') == ""on"" ? 1 : 0), 0);` GETPOST('private_message', 'alpha') is always ""1"" or ""0"", never is ""on"" This violates the scenario that if a comment is marked private, the status should not change.  Dolibarr Version 20.0.2  Environment PHP 8.0  Environment Database MySQL  Steps to reproduce the behavior and expected behavior **Behavior** Add a new message in ticket card and mark it as private. The status changes to ""IN PROGRESS"" **Expected** The status does not change. The same state is maintained.  Attached files _No response_",source-file
30161,dolibarr,https://github.com/Dolibarr/dolibarr/issues/30161,Ticket API endpoints are not working - getByRef and getByTrackID,"Bug API Endpoints for the ticket module `getByRef` and `getByTrackId` are not working at all. They always returns a specimen ticket even when provided a known ref or track_id. The problem lies in the `api_tickets.class.php` file, in the `getCommon` function and its calls: php private function getCommon($id = 0, $track_id = '', $ref = '') { if (!DolibarrApiAccess::$user->hasRight('ticket', 'read')) { throw new RestException(403); } if (($id < 0) && !$track_id && !$ref) { throw new RestException(400, 'Wrong parameters'); } if ($id == 0) { $result = $this->ticket->initAsSpecimen(); } else { $result = $this->ticket->fetch($id, $ref, $track_id); } if (!$result) { throw new RestException(404, 'Ticket not found'); }  php public function getByRef($ref) { return $this->getCommon(0, '', $ref); } public function getByTrackId($track_id) { return $this->getCommon(0, $track_id, ''); }  Since `id` is always 0, the condition `id == 0` is always true in these cases and never try to fetch the ticket with the provided property. The condition should check for the lack of ref and track_id in order to return a specimen ticket. diff -if ($id == 0) { +if ($id == 0 && empty($ref) && empty($track_id)) {   Dolibarr Version 19.0.2  Environment PHP _No response_  Environment Database _No response_  Steps to reproduce the behavior and expected behavior 1. With the ticket module and API module enabled 2. Create one or more tickets 3. Open the API Explorer 4. Try the endpoints with - An existing ref - An non existing ref  Attached files _No response_",source-file
23415,dolibarr,https://github.com/Dolibarr/dolibarr/issues/23415,REST BOM API - It's able to have a wrong value on the 'ref' Field,"Bug It's able to have a wrong value on the 'ref' Field by adding or updating a BOM.  Environment Version 18  Environment OS _No response_  Environment Web server _No response_  Environment PHP PHP 8.1.10  Environment Database _No response_  Environment URL(s) _No response_  Expected and actual behavior **Actual behavior / Problems:** - **If you update a BOM with the API you can change the the status from DRAFT to a other Status, with the same ref e.g. '(PROV54)'** - Currently the 'ref' Field is required. So you can not use the Dolibarr NextNum Generator. **Expected behavior** - If no 'ref' is set on create and the status is 0 (DRAFT) then create a ref '(PROF)'. - If no 'ref' is set on create and the status is grater then > 0, then create a 'ref' with number generator. - If 'ref' is set, use the value from the REST-Call.  Steps to reproduce the behavior _No response_  Attached files _No response_",source-file
30432,dolibarr,https://github.com/Dolibarr/dolibarr/issues/30432,Unable to modify client_code through thirdparties rest API,"Hello, I am currently trying to modify a client_code through the Thirdparties Rest API. I have adjusted Dolibarr's Thirdparties configuration to allow custom client codes (via the Leopard Module). However, it appears that modifying the client code through the API is not allowed. Could you please explain the reasoning behind this restriction? Additionally, is there any solution to bypass this issue without having to manually modify every code? After some investigation, it seems the issue originates from the following line: https://github.com/Dolibarr/dolibarr/blame/1b5eb2de22ccee5377549a219d0448f1e3026117/htdocs/societe/class/api_thirdparties.class.php#L299 **Steps to Reproduce:** - Execute the following CURL command : curl -X PUT --header 'Content-Type: application/json' --header 'Accept: application/json' --header 'DOLAPIKEY: key' -d '{ ""code_client"" : ""new code"" }' 'https://dolibarr-server.fr/api/index.php/thirdparties/id' - Attempt to modify the client code via the API, the Swagger UI, or the above CURL command - Observe that the API returns a 200 code without modifying the client. **Expected Behavior:** I expected to be able to update the client code through the API. **Actual Behavior:** The client code remains unchanged and the modification is blocked. Thank you very much for your assistance. Best regards, Lorenzo",source-file
31369,dolibarr,https://github.com/Dolibarr/dolibarr/issues/31369,Bug: date_solde not taken when creating a bank account via API,"Bug Version: 20.0.1 Hello, I'm able to create a bank account via API but although initialising a solde value works, initialising a date_solde doesn't. This results in having the solde initial with the date of today, always. ![image](https://github.com/user-attachments/assets/b3b4cece-6d25-4c35-b275-ca908f722561) I looked at the code in `/htdocs/compta/bank/class/api_bankaccounts.class.php` And at line 172 I have `$account->date_solde = time();` I checked that hardcoding setting $account->date_solde to some value have the desired effect. So the problem is that instead of retrieving date_solde from the API call, it always set $account->date_solde to the date of right now I replaced `$account->date_solde = time();` by  if (isset($request_data['date_solde'])) { $account->date_solde = $this->_checkValForAPI('date_solde', $request_data['date_solde'], $account); } else { $account->date_solde = time(); }  Then it works properly  Dolibarr Version 20.0.1  Environment PHP _No response_  Environment Database _No response_  Steps to reproduce the behavior and expected behavior _No response_  Attached files _No response_",source-file
30828,dolibarr,https://github.com/Dolibarr/dolibarr/issues/30828,"On Ticket creation, contract origin is printed twice if contract is preselected","Bug To set a contract by default on ticket creation, we use GET parameter : - origin (object type) - originid (object id) In contract form file, we can see that we print contract selector only if $subelement is not ""contract"" ![Capture decran 2024-09-02 a 12 01 23](https://github.com/user-attachments/assets/e2f9dbb2-0d0c-40b0-a5d5-c48c730f61b8) $subelement comes from GET parameter ""origin"" ![Capture decran 2024-09-02 a 12 03 50](https://github.com/user-attachments/assets/65d94389-3e9a-4dc9-bb40-a9a0b47603be) The contract class name is ""Contrat"". If we pass as parameter contract origin, the contract will be shown twice. ![Capture decran 2024-09-02 a 12 11 15](https://github.com/user-attachments/assets/3d70c785-1707-4c7b-8e25-32e2d63623a8) To avoid this error, we have to replace ""contract"" bye ""contrat"" in html.formticket.class.php line 701. The second problem is that this field does not link the ticket to the selected contract and/or no ""contract"" field exists on the ticket. ![Capture decran 2024-09-04 a 17 33 45](https://github.com/user-attachments/assets/31677662-05cd-4ae5-b50e-a1699ed0eefb) ![Capture decran 2024-09-04 a 17 34 22](https://github.com/user-attachments/assets/bc5dab1f-4fc0-4238-a0df-7101161eb7a9)  Dolibarr Version develop  Environment PHP 8.2.14  Environment Database 8.0.35-0ubuntu0.22.04.1  Steps to reproduce the behavior and expected behavior Go on ticket card with GET parameters : - action=create - origin=contrat - originid=x  Attached files _No response_",source-file
23345,dolibarr,https://github.com/Dolibarr/dolibarr/issues/23345,[API] - Get shipment return DB informations,"Bug The call {{host}}/api/index.php/shipments?sortfield=t.rowid&sortorder=ASC&limit=100 responds each line with Db information !! This is a security issue!! The respond contains   ""lines"": [ { ""origin_line_id"": ""2719"", ""fk_origin_line"": ""2719"", ""fk_expedition"": ""638"", ""qty"": ""1"", ""qty_shipped"": ""1"", ""fk_product"": ""127"", ""detail_batch"": [  ""db"": { ""db"": {  }, ""type"": ""mysqli"",   Environment Version 16.0.3  Environment OS Debian  Environment Web server Apache/2.4.38 (Debian)  Environment PHP 7.3.31-1~deb10u2  Environment Database MariaDB 5.5.5-10.3.36-MariaDB-0+deb10u2  Environment URL(s) /api/index.php/shipments  Expected and actual behavior _No response_  Steps to reproduce the behavior curl -X GET --header 'Accept: application/json' --header 'DOLAPIKEY: {passkey}' '{host}/api/index.php/shipments/{id}' where id is a shipment which include product with a serial number  Attached files _No response_",source-file
29372,dolibarr,https://github.com/Dolibarr/dolibarr/issues/29372,HRM : User have access to monthly statement without permission,"Bug Even if a user doesn't have the right to read all leave requests [1], the user can still access them by using the associated URI that goes to the monthly statement. I can handle the PR if you'd like :) [1] : ![image](https://github.com/Dolibarr/dolibarr/assets/57806687/4bec1157-1632-4a16-a3d2-62098884e22c) [2] ![image](https://github.com/Dolibarr/dolibarr/assets/57806687/87f0e8d8-fada-4d8a-a497-4d486a7f7473)  Dolibarr Version 19.0.1  Environment PHP 8.1  Environment Database MariaDB  Steps to reproduce the behavior and expected behavior Create a user that has no access except ""read leaves request"" Log with this account and access to the URI : https://yourdomain.com/holiday/month_report.php?mainmenu=hrm&leftmenu=holiday  Attached files _No response_",source-file
29115,dolibarr,https://github.com/Dolibarr/dolibarr/issues/29115,API PUT call issue (product extra fields),"Bug Unexpected behavior of PUT method upon updating product's extra fields  Dolibarr Version 19.0.1  Environment PHP 8.1.27  Environment Database MariaDB 10.6.17-MariaDB-cll-lve  Steps to reproduce the behavior and expected behavior Trying to call a product update through PUT method to update an extra field of the product: 1. Extrafield (checkbox) underlined: API must uncheck the box ![image](https://github.com/Dolibarr/dolibarr/assets/21037425/1875d81d-321c-48c3-b40d-cbd43c45230a) 2. API request body: ![image](https://github.com/Dolibarr/dolibarr/assets/21037425/ea436e65-20b3-492a-98c0-f7e5b7ac5c79) 3. After the call checkbox is unchecked which is right, however, previously set values for extra fields are now gone. NOTE: some of the extra fields didn't lose their values and it seems that those fields having _default value_ defined in extrafield settings don't lose the values, in fact, they **change** to default value from settings, regardless of what was set before or defined in API schema. ![image](https://github.com/Dolibarr/dolibarr/assets/21037425/d0341db0-3d4a-4468-9dbd-863b0b7fd67e) Obviously, standard fields are not affected, they're not changing (unless defined in schema) or loosing the values.  Attached files _No response_",source-file
26307,dolibarr,https://github.com/Dolibarr/dolibarr/issues/26307,Undefined property: Contact::$gender,"Bug When I was trying to create a user from a contact in the Rest API, I was getting a 500 error. I analyzed the error and it turns out that with PHP 8.1 you must have variables declared, so I went to contact.class.php and declared the variable and I can now create users without problem. /** * @var string gender */ public $gender = '';  Environment Version 17  Environment OS Linux  Environment Web server Apache  Environment PHP 8.1  Environment Database MySQL  Environment URL(s) _No response_  Expected and actual behavior _No response_  Steps to reproduce the behavior Create a contact from the API and then create your user  Attached files _No response_",source-file
33949,dolibarr,https://github.com/Dolibarr/dolibarr/issues/33949,BUG: default value not changed when updating an extrafield using the API,"Bug BUG: the default value is not changed when updating an extrafield Did a PUT to this API endpoint `/api/index.php/setup/extrafields/projet/call_to_action` with these request_data  { ""type"": ""varchar"", ""label"": ""Call_to_action"", ""size"": ""26"", ""default"": ""Begin Registration"", ""unique"": ""0"", ""required"": ""0"", ""pos"": ""160"", ""alwayseditable"": ""0"", ""list"": ""1"", ""printable"": ""0"", ""totalizable"": ""0"" }  But if you then do a GET to this API endpoint `http://localhost:22180/api/index.php/setup/extrafields/projet/call_to_action` and I get this reply where the default value is null  { ""projet"": { ""call_to_action"": { ""id"": ""521"", ""type"": ""varchar"", ""label"": ""Call_to_action"", ""size"": ""26"", ""elementtype"": ""projet"", ""default"": null, ""computed"": null, ""unique"": ""0"", ""required"": ""0"", ""param"": """", ""pos"": ""160"", ""alwayseditable"": ""0"", ""perms"": null, ""list"": ""1"", ""printable"": ""0"", ""totalizable"": ""0"", ""langs"": null, ""help"": null, ""css"": null, ""cssview"": null, ""csslist"": null, ""fk_user_author"": ""2"", ""fk_user_modif"": ""2"", ""datec"": ""2025-04-22 18:38:09"", ""tms"": ""2025-04-22 18:38:09"" } } }   Dolibarr Version 22.0.0-alpha  Environment PHP official docker devel image version  Environment Database mariadb latest  Steps to reproduce the behavior and expected behavior _No response_  Attached files _No response_",source-file
26283,dolibarr,https://github.com/Dolibarr/dolibarr/issues/26283,"Contract list services filter error with ""expired service""","Bug ![image](https://github.com/Dolibarr/dolibarr/assets/1215488/ca6f14f2-5b1f-40b3-858b-3142b99a5e4b) With filter EXPIRED, in list we see also ""NOT EXPIRED"". I suppose that sql query is not correct.  Environment Version Dolibarr >= 18.x  Environment OS all version  Environment Web server all version  Environment PHP all version  Environment Database all version  Environment URL(s) /contrat/services_list.php?leftmenu=contracts&search_status=4&filter=expired  Expected and actual behavior Do not show ""not expired"" services.  Steps to reproduce the behavior Click on top menu ""COMMERCIAL"" Click on left menu ""Expired Services""  Attached files _No response_",source-file
