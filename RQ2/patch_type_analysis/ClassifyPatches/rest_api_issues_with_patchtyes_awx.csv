issue_no,repo,issue_url,title,description,patched_file_types
6498,awx,https://github.com/ansible/awx/issues/6498,504 timeouts when fetching job_events for a running job,"ISSUE TYPE - Bug Report  SUMMARY Having issues with 504 timeouts on `job_events` APIs for a given host when a job is running, e.g. `api/v2/hosts/1/job_events/`. Maybe due to deadlocks? **EDIT**: We redeployed `awx_web` to see if we could make the APIs work again, still 504 timeout on every `api/v2/hosts/1/job_events/` request. Something is very wrong here.  ENVIRONMENT * AWX version: 9.3.0 * AWX install method: openshift manual deployment * Ansible version: 2.9.5 * Operating System: Official AWX images * Web Browser: Firefox, postman, Python's `request.get()` (from both a Linux and Mac client)  STEPS TO REPRODUCE 1. Start a task that takes long time to finish (Our task is a task that writes hundreds of commands on a device and takes about 8 minutes to finish) 2. Fetch job events API while task is running 3. 504 timeouts on that API even after the job is done for a loong time. (It did start responding again earlier, but now I've waited 10 minutes and still no response from the API). It's important to note that when this occurs we get sporadic 504's on other endpoints too, but I believe this may happen due to sync workers and not enough of them.  EXPECTED RESULTS Being able to fetch `job_events` when a task is running.  ACTUAL RESULTS Timeout on `job_events`.  ADDITIONAL INFORMATION We found #6108 and disabled external logging to Logstash, but don't seem like the issue was solved. The timeout is happening due to OpenShift cutting the connection (499), but the request should never take more than 30 seconds anyway: ![image](https://user-images.githubusercontent.com/5310116/78008928-926dec00-7340-11ea-82e8-877aedbe2b17.png)",source-file
8641,awx,https://github.com/ansible/awx/issues/8641,Cannot disable a schedule for a JT with a missing project (and it keeps running),"ISSUE TYPE - Bug Report  SUMMARY It's fairly easy to get into a state where a schedule is enabled with an invalid JT, and the schedule cannot be turned off, due to a validation error on the JT. Even though the schedule is invalid, it keeps running on the schedule interval, and its jobs fail obviously.  ENVIRONMENT * AWX version: 15.0.1  STEPS TO REPRODUCE Create a JT Create a 1-minute schedule for that JT Delete the project used by the JT (or its inventory) Try to disable the schedule in the UI  EXPECTED RESULTS Schedule turns off  ACTUAL RESULTS 400 response json {""resources_needed_to_start"":[""Job Template project is missing or undefined."",""Job Template inventory is missing or undefined.""]}  This is what you get hitting the disable button in the UI, which performs a PATCH to the schedule, setting the ""enabled"" field to False, and it includes the rest of the data. The issue is on the API here, because the request made by the UI seems reasonable, and should be expected to succeed. Perhaps the API should only error on this type of validation if the schedule is being _enabled_.  ADDITIONAL INFORMATION Similar to https://github.com/ansible/awx/issues/7521 by @chrismeyersfsu, seen in test runs, and creates background processing since the 1-minute schedule continues to run for the duration that the server is up.",source-file
5882,awx,https://github.com/ansible/awx/issues/5882,API Provides credential_type for WFJTs,"ISSUE TYPE Bug maybe?  SUMMARY Missing information in the WFJT end point re: webhook credentials. JobTemplates end point provides credential type and kind information, but WFJT end point does not provide that info for webhook credentials. It would be nice to have.  ENVIRONMENT * AWX version: 9.1.1 * AWX install method: docker for mac * Ansible version: 2.10 * Operating System: Mojave * Web Browser: Chrome  STEPS TO REPRODUCE Generate a workflow JT with a webhook credential. Go to api gui for that WFJT  EXPECTED RESULTS Credential type and credential kind info would be provided.  ACTUAL RESULTS Credential type and credential kind are not provided at that end point when all the other info for the template is provided.",source-file
6049,awx,https://github.com/ansible/awx/issues/6049,Inventory Group Nested Hosts View errors with a 404,"ISSUE TYPE - Bug Report  SUMMARY I searched for implemented issues and couldn't find anything. /inventories/inventory/*num*/groups/*num*/nested_hosts isn't loading in ui_next  ENVIRONMENT * AWX version: 9.next  STEPS TO REPRODUCE 1. Create an Inventory Group with nested hosts 2. View the #/inventories/inventory/*num*/groups/*num*/nested_hosts page  EXPECTED RESULTS Nested Hosts to be displayed  ACTUAL RESULTS 404 messaging page  ADDITIONAL INFORMATION <img width=""1159"" alt=""Screen Shot 2020-02-25 at 9 10 38 AM"" src=""https://user-images.githubusercontent.com/12446869/75254948-29c6a900-57af-11ea-92c0-7d35dee281c6.png"">",source-file
4541,awx,https://github.com/ansible/awx/issues/4541,Notifications - missing hosts with webhook notification,"ISSUE TYPE - Bug Report  SUMMARY We have around 400 hosts in the inventory, however, the notification webhook endpoint receives notification about only around 40-50 hosts. (Sometimes it's working fine reporting all the hosts.)  ENVIRONMENT * AWX version: 6.1.0.0 (Same problem with 6.0.0.0) * AWX install method: docker on linux (official image from docker hub) * Ansible version: 2.8.2 * Operating System: Centos7 * Web Browser: Chrome  STEPS TO REPRODUCE - Create a webhook notification - Start a job (or job-flow), enable notifications.  EXPECTED RESULTS Report from all the hosts in JSON format  ACTUAL RESULTS Most of the times only partial host list in the report, sometimes full list. Differs in a job-flow, some jobs reporting about all hosts, some only about a few) Workflow with 2 jobs: Number of hosts, on which the job ran (reported in AWX): 438 Number of hosts reported on the webhook script: 53  ADDITIONAL INFORMATION I also have the same problem with 6.0.0.0 and 6.1.0.0 I tried with different users, with standalon jobs or woth flows, also with different playbooks, the problem looks pretty consistent. Thx",source-file
12046,awx,https://github.com/ansible/awx/issues/12046,Disable isCreatable for Select component on Advanced Search,"SUMMARY Disable isCreatable for Select component on Advanced Search. This prop leads to invalid API searches. <img width=""1496"" alt=""image"" src=""https://user-images.githubusercontent.com/9053044/163234927-b4b0c433-435e-4a28-923a-26eafa17f8ef.png""> <img width=""1498"" alt=""image"" src=""https://user-images.githubusercontent.com/9053044/163234857-a07d7a9a-1da5-41f9-8ae5-e23213f877ca.png"">",source-file
13439,awx,https://github.com/ansible/awx/issues/13439,CyberArk Conjur lookup plugin does not work with open source Conjur version,"Please confirm the following - [X] I agree to follow this project's [code of conduct](https://docs.ansible.com/ansible/latest/community/code_of_conduct.html). - [X] I have checked the [current issues](https://github.com/ansible/awx/issues) for duplicates. - [X] I understand that AWX is open source software provided for free and that I might not receive a timely response.  Bug Summary The CyberArk Conjur Secrets Manager Lookup plugin no longer supports the lookup against the Conjur OSS. Most likely because the opensource conjure version API endpoint does not have the `/api/` portion recently added by this change: https://github.com/ansible/awx/pull/13121  AWX version 2.4  Select the relevant components - [ ] UI - [X] API - [ ] Docs - [ ] Collection - [ ] CLI - [ ] Other  Installation method docker development environment  Modifications no  Ansible version _No response_  Operating system _No response_  Web browser _No response_  Steps to reproduce 1. Deploy Conjur OSS. We use the latest `cyberark/conjur` image for that. The Conjur version is  Version 1.19.1-3398 API Version 5.3.0  2. Under the AWX, create the CyberArk Conjur Secrets Manager Lookup credential. Provide Conjure URL, user, and token. 3. Click Test and provide a path.  Expected results Connection to Conjur should be established. HTTP 200 response.  Actual results 401 error returned.  Traceback (most recent call last): File ""/var/lib/awx/venv/awx/lib64/python3.9/site-packages/awx/main/tasks/jobs.py"", line 504, in run args = self.build_args(self.instance, private_data_dir, passwords) File ""/var/lib/awx/venv/awx/lib64/python3.9/site-packages/awx/main/tasks/jobs.py"", line 937, in build_args ssh_username = creds.get_input('username', default='') File ""/var/lib/awx/venv/awx/lib64/python3.9/site-packages/awx/main/models/credential/__init__.py"", line 275, in get_input return self._get_dynamic_input(field_name) File ""/var/lib/awx/venv/awx/lib64/python3.9/site-packages/awx/main/models/credential/__init__.py"", line 309, in _get_dynamic_input return input_source.get_input_value() File ""/var/lib/awx/venv/awx/lib64/python3.9/site-packages/awx/main/models/credential/__init__.py"", line 1250, in get_input_value return backend(**backend_kwargs) File ""/var/lib/awx/venv/awx/lib64/python3.9/site-packages/awx/main/credential_plugins/conjur.py"", line 72, in conjur_backend raise_for_status(resp) File ""/var/lib/awx/venv/awx/lib64/python3.9/site-packages/awx/main/credential_plugins/plugin.py"", line 12, in raise_for_status resp.raise_for_status() File ""/var/lib/awx/venv/awx/lib64/python3.9/site-packages/requests/models.py"", line 1021, in raise_for_status raise HTTPError(http_error_msg, response=self) requests.exceptions.HTTPError: 401 Client Error: Unauthorized for url: https://conjureurl.com/api/authn/test/admin/authenticate   Additional information _No response_",source-file
8777,awx,https://github.com/ansible/awx/issues/8777,awx collection workflow approval with success node fail,"ISSUE TYPE - Bug Report  SUMMARY apply success node to approval_node fail because success_nodes not exists in /api/v2/workflow_approval_templates/ ""msg"": ""The requested object could not be found at /api/v2/workflow_approval_templates/280/success_nodes/.""  ENVIRONMENT * AWX version: 15.0.1 * AWX install method: docker * Ansible version: 2.8.7 * Operating System: redhat * Web Browser: chrome  STEPS TO REPRODUCE approval_node with success_node  EXPECTED RESULTS ansible tasks changed  ACTUAL RESULTS ansible fail  ADDITIONAL INFORMATION",data-file | source-file
5717,awx,https://github.com/ansible/awx/issues/5717,awx cli schedules create cannot create schedule if the user is of type Normal User with required permissions.,"ISSUE TYPE - Bug Report  SUMMARY awx cli schedules create cannot create schedule if the user is of type Normal User with required permissions on the object or even with Organization admin role. Currently the user needs to be a System Administrator type to create the schedule. From the UI the Normal User with permission can create the schedule. POST at the /api/v2/schedules/ endpoint is only available for the user with System Administrator type which is the endpoint used by awx schedules create command.  ENVIRONMENT * AWX version: Tower 3.6.2 * AWX install method: Tower 3.6.2 cluster installed with online installer * Ansible version: 2.9.1 * Operating System: RHEL 8 * Web Browser: Chrome 79  STEPS TO REPRODUCE * Create a normal user: * Assign permission to a job template or set the user role as Organization admin. * Try to create the schedule for the job template using awx cli.  awx --conf.host https://tower.ishwar.io --conf.username test --conf.password 'PASSWORD' schedules create --name=test --unified_job_template=111 --rrule=""DTSTART;TZID=America/New_York:20180208T221500 RRULE:FREQ=MONTHLY;INTERVAL=1;BYDAY=TH;BYSETPOS=3"" -vvv  * Change the user type to system administrator and rerun the command.  EXPECTED RESULTS  DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): tower.ishwar.io:443 DEBUG:urllib3.connectionpool:https://tower.ishwar.io:443 ""GET /api/ HTTP/1.1"" 200 188 DEBUG:awxkit.api.client:""GET https://tower.ishwar.io/api/"" elapsed: 0:00:00.208793 DEBUG:awxkit.api.registry:Retrieved <class 'awxkit.api.pages.api.ApiV2'> by url: /api/v2/ DEBUG:urllib3.connectionpool:https://tower.ishwar.io:443 ""GET /api/v2/ HTTP/1.1"" 200 1688 DEBUG:awxkit.api.client:""GET https://tower.ishwar.io/api/v2/"" elapsed: 0:00:00.047443 DEBUG:urllib3.connectionpool:https://tower.ishwar.io:443 ""GET /api/ HTTP/1.1"" 200 188 DEBUG:awxkit.api.client:""GET https://tower.ishwar.io/api/"" elapsed: 0:00:00.052170 DEBUG:urllib3.connectionpool:https://tower.ishwar.io:443 ""POST /api/login/ HTTP/1.1"" 302 0 DEBUG:awxkit.api.client:""POST https://tower.ishwar.io/api/login/"" elapsed: 0:00:00.247407 DEBUG:urllib3.connectionpool:https://tower.ishwar.io:443 ""GET /api/ HTTP/1.1"" 200 188 DEBUG:awxkit.api.client:""GET https://tower.ishwar.io/api/"" elapsed: 0:00:00.080558 DEBUG:urllib3.connectionpool:https://tower.ishwar.io:443 ""GET /api/ HTTP/1.1"" 200 188 DEBUG:awxkit.api.client:""GET https://tower.ishwar.io/api/"" elapsed: 0:00:00.084587 DEBUG:awxkit.api.registry:Retrieved <class 'awxkit.api.pages.schedules.Schedules'> by url: /api/v2/schedules/ DEBUG:urllib3.connectionpool:https://tower.ishwar.io:443 ""OPTIONS /api/v2/schedules/ HTTP/1.1"" 200 13449 DEBUG:awxkit.api.client:""OPTIONS https://tower.ishwar.io/api/v2/schedules/"" elapsed: 0:00:00.101736 DEBUG:awxkit.api.registry:Retrieved <class 'awxkit.api.pages.schedules.Schedules'> by url: /api/v2/schedules/ DEBUG:urllib3.connectionpool:https://tower.ishwar.io:443 ""OPTIONS /api/v2/schedules/1/ HTTP/1.1"" 200 7915 DEBUG:awxkit.api.client:""OPTIONS https://tower.ishwar.io/api/v2/schedules/1/"" elapsed: 0:00:00.120726 awx: unrecognized arguments: -vvv DEBUG:awxkit.api.registry:Retrieved <class 'awxkit.api.pages.schedules.Schedules'> by url: /api/v2/schedules/ DEBUG:urllib3.connectionpool:https://tower.ishwar.io:443 ""POST /api/v2/schedules/ HTTP/1.1"" 201 1552 DEBUG:awxkit.api.client:""POST https://tower.ishwar.io/api/v2/schedules/"" elapsed: 0:00:00.156802 DEBUG:awxkit.api.registry:Retrieved <class 'awxkit.api.pages.schedules.Schedules'> by url: /api/v2/schedules/ { ""rrule"": ""DTSTART;TZID=America/New_York:20180208T221500 RRULE:FREQ=MONTHLY;INTERVAL=1;BYDAY=TH;BYSETPOS=3"", ""id"": 14, ""type"": ""schedule"", ""url"": ""/api/v2/schedules/14/"", ""summary_fields"": { ""unified_job_template"": { ""id"": 111, ""name"": ""test-schedule"", ""description"": """", ""unified_job_type"": ""job"" }, ""created_by"": { ""id"": 121, ""username"": ""test"", ""first_name"": ""test"", ""last_name"": ""test"" }, ""modified_by"": { ""id"": 121, ""username"": ""test"", ""first_name"": ""test"", ""last_name"": ""test"" }, ""user_capabilities"": { ""edit"": true, ""delete"": true }, ""inventory"": { ""id"": 29, ""name"": ""Demo Inventory"", ""description"": """", ""has_active_failures"": false, ""total_hosts"": 1, ""hosts_with_active_failures"": 0, ""total_groups"": 0, ""groups_with_active_failures"": 0, ""has_inventory_sources"": false, ""total_inventory_sources"": 0, ""inventory_sources_with_failures"": 0, ""organization_id"": 1, ""kind"": """", ""insights_credential_id"": null } }, ""created"": ""2020-01-21T07:31:19.312383Z"", ""modified"": ""2020-01-21T07:31:19.312398Z"", ""name"": ""test"", ""description"": """", ""extra_data"": {}, ""inventory"": null, ""scm_branch"": null, ""job_type"": null, ""job_tags"": null, ""skip_tags"": null, ""limit"": null, ""diff_mode"": null, ""verbosity"": null, ""unified_job_template"": 111, ""enabled"": true, ""dtstart"": ""2018-02-16T03:15:00Z"", ""dtend"": null, ""next_run"": ""2020-02-21T03:15:00Z"", ""timezone"": ""America/New_York"", ""until"": """" }   ACTUAL RESULTS  DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): tower.ishwar.io:443 DEBUG:urllib3.connectionpool:https://tower.ishwar.io:443 ""GET /api/ HTTP/1.1"" 200 188 DEBUG:awxkit.api.client:""GET https://tower.ishwar.io/api/"" elapsed: 0:00:00.173558 DEBUG:awxkit.api.registry:Retrieved <class 'awxkit.api.pages.api.ApiV2'> by url: /api/v2/ DEBUG:urllib3.connectionpool:https://tower.ishwar.io:443 ""GET /api/v2/ HTTP/1.1"" 200 1688 DEBUG:awxkit.api.client:""GET https://tower.ishwar.io/api/v2/"" elapsed: 0:00:00.046141 DEBUG:urllib3.connectionpool:https://tower.ishwar.io:443 ""GET /api/ HTTP/1.1"" 200 188 DEBUG:awxkit.api.client:""GET https://tower.ishwar.io/api/"" elapsed: 0:00:00.050566 DEBUG:urllib3.connectionpool:https://tower.ishwar.io:443 ""POST /api/login/ HTTP/1.1"" 302 0 DEBUG:awxkit.api.client:""POST https://tower.ishwar.io/api/login/"" elapsed: 0:00:00.247518 DEBUG:urllib3.connectionpool:https://tower.ishwar.io:443 ""GET /api/ HTTP/1.1"" 200 188 DEBUG:awxkit.api.client:""GET https://tower.ishwar.io/api/"" elapsed: 0:00:00.088723 DEBUG:urllib3.connectionpool:https://tower.ishwar.io:443 ""GET /api/ HTTP/1.1"" 200 188 DEBUG:awxkit.api.client:""GET https://tower.ishwar.io/api/"" elapsed: 0:00:00.081436 DEBUG:awxkit.api.registry:Retrieved <class 'awxkit.api.pages.schedules.Schedules'> by url: /api/v2/schedules/ DEBUG:urllib3.connectionpool:https://tower.ishwar.io:443 ""OPTIONS /api/v2/schedules/ HTTP/1.1"" 200 11598 DEBUG:awxkit.api.client:""OPTIONS https://tower.ishwar.io/api/v2/schedules/"" elapsed: 0:00:00.088985 DEBUG:awxkit.api.registry:Retrieved <class 'awxkit.api.pages.schedules.Schedules'> by url: /api/v2/schedules/ DEBUG:urllib3.connectionpool:https://tower.ishwar.io:443 ""OPTIONS /api/v2/schedules/1/ HTTP/1.1"" 200 6065 DEBUG:awxkit.api.client:""OPTIONS https://tower.ishwar.io/api/v2/schedules/1/"" elapsed: 0:00:00.112443 usage: awx schedules [-h] action  positional arguments: action list get modify delete optional arguments: -h, --help show this help message and exit awx schedules: argument action: invalid choice: 'create' (choose from 'list', 'get', 'modify', 'delete')",test-file | source-file
9905,awx,https://github.com/ansible/awx/issues/9905,Unable to cancel job - method POST not allowed - awx19,"<!-- Issues are for **concrete, actionable bugs and feature requests** only - if you're just asking for debugging help or technical support, please use: - http://webchat.freenode.net/?channels=ansible-awx - https://groups.google.com/forum/#!forum/awx-project We have to limit this because of limited volunteer time to respond to issues! -->  ISSUE TYPE - Bug Report  SUMMARY I had an inventory sync job that was stuck. Upon trying to cancel it, I got an error saying `Method ""POST"" not allowed` This is a refile of #9714 as the issue is still not fixed.  ENVIRONMENT * AWX version: 19.0.0 * AWX install method: minishift * Ansible version: * Operating System: Debian 10 * Web Browser: Chrome  STEPS TO REPRODUCE 1. Get a stuck job? 2. Try to cancel job.  EXPECTED RESULTS job to cancel  ACTUAL RESULTS  POST /api/v2/inventory_updates/11/cancel/ 405 Method ""POST"" not allowed.  ![image](https://user-images.githubusercontent.com/1826947/114759279-f7b63480-9d2b-11eb-96ff-2d5669e4c4a1.png)  ADDITIONAL INFORMATION <!-- Include any links to sosreport, database dumps, screenshots or other information. -->",source-file
7264,awx,https://github.com/ansible/awx/issues/7264,Mattermost Notification fails on latest release,"ISSUE TYPE - Bug Report  SUMMARY Trying to send a (test) notification to a Mattermost Channel fails with  mattermostinfo: Notification failed. Error sending notification mattermost: {""id"":""api.webhook.incoming.error"",""message"":""Could not decode the multipart payload of incoming webhook."",""detailed_error"":"""",""request_id"":""<request ID>"",""status_code"":400}   ENVIRONMENT * AWX version: 11.2.0 * AWX install method: docker on linux * Ansible version: 2.9.7 * Operating System: CentOS 7.8 * Web Browser: Chrome,Chromium,Firefox * Mattermost Server Version: 5.22.1  STEPS TO REPRODUCE - Create an incomming webhook - Create a mattermost notification - Send a test notification  EXPECTED RESULTS Having a notification in the Channel  ACTUAL RESULTS Sending failed with above error message  ADDITIONAL INFORMATION The error message in the mattermost log shows  {""level"":""error"",""ts"":1591342011.6592789,""caller"":""mlog/log.go:175"",""msg"":""Could not decode the multipart payload of incoming webhook."",""path"":""/ hooks/<hook ID>"",""request_id"":""<request ID>"",""ip_addr"":""<IP Address>"",""user_id"":"""",""method"":""POST"",""err_where"":"" incomingWebhook"",""http_code"":400,""err_details"":""mime: no media type""}   edit: some ID removed in the log sample, mattermost server version added",source-file | config-file | data-file | test-file | other-file | documentation-file
6128,awx,https://github.com/ansible/awx/issues/6128,AWX Collection user and role modules break when creating or updating an existing object,"ISSUE TYPE - Bug Report  SUMMARY  Collection Updating an object without a `name` field breaks, which also breaks idempotency. Probably because of: https://github.com/ansible/awx/blob/devel/awx_collection/plugins/module_utils/tower_api.py#L534  ENVIRONMENT * AWX version: 9.2.0 * AWX install method: docker on linux * Ansible version: 2.9.4 * Operating System: ubuntu 18.04  STEPS TO REPRODUCE Run a playbook that creates a user or role twice, the second time it will fail  EXPECTED RESULTS it should be Idempotent and know how to update those objects  ACTUAL RESULTS  PLAY [testhost]  TASK [Gathering Facts]  ok: [testhost] TASK [tower_user : Create a User]  fatal: [testhost]: FAILED! => {""changed"": false, ""msg"": ""Unable to process update of item due to missing data 'name'""} PLAY RECAP  testhost : ok=1 changed=0 unreachable=0 failed=1 skipped=0 rescued=0 ignored=0",source-file
9772,awx,https://github.com/ansible/awx/issues/9772,"Job output paginator can make requests to page 0 of job_events endpoint, resulting in unhandled 404","It's possible for the job output paginator to produce a request to page 0, which returns an unhandled 404: ![Screenshot from 2021-03-31 11-48-29](https://user-images.githubusercontent.com/9753817/113173073-0b837600-9217-11eb-9962-eccdd4e1785f.png)",test-file | source-file
10383,awx,https://github.com/ansible/awx/issues/10383,Unexpected api config requests on logout,"ISSUE TYPE - Bug Report  STEPS TO REPRODUCE - logout using the top-nav dropdown  EXPECTED RESULTS no requests are made to the config endpoint on logout  ACTUAL RESULTS requests are made to config endpoint, 400 errors",source-file
5110,awx,https://github.com/ansible/awx/issues/5110,"JOB TAGS and SKIP TAGS not being honored via ""prompt on launch""","ISSUE TYPE - Bug Report  SUMMARY User entered values for SKIP TAGS and JOB TAGS are not honored.  ENVIRONMENT * AWX version: 8.0.0 * AWX install method: docker on linux * Ansible version: 2.8.5 * Operating System: RHEL 7.6 * Web Browser: Chrome Version 78.0.3904.70 (Official Build) (64-bit)  STEPS TO REPRODUCE Configure a template to have null or populated values in JOB TAGS and SKIP TAGS and activate ""prompt on launch"" for those 2 fields. ![tags_null](https://user-images.githubusercontent.com/56000662/67570164-bb89b100-f6fe-11e9-8cd9-bc0b31d44edf.png) On launch, enter the tags one might want to run/skip ![tags_tagged](https://user-images.githubusercontent.com/56000662/67570267-eecc4000-f6fe-11e9-9671-c37445f0c425.png) Click next to get to the job preview. The preview shows no tags have been assigned to the job though they were in fact entered. On launch of the job, the requested tags will not be honored. ![tags_nothonored](https://user-images.githubusercontent.com/56000662/67570508-934e8200-f6ff-11e9-9d57-3af0801cd660.png) NOTE: If the template is saved WITH values, and prompt on launch is selected. You may REMOVE those predefined values with no issue. Any new values entered during ""prompt to launch"" will still go unrecognized.  EXPECTED RESULTS JOB TAGS and SKIP TAGS values are assigned via ""prompt on launch"" and honored in job execution ![tags_honored](https://user-images.githubusercontent.com/56000662/67570589-cbee5b80-f6ff-11e9-9eb9-d8f34d52e7df.png)  ACTUAL RESULTS Jobs run without honoring the tags entered by the user.  ADDITIONAL INFORMATION <!-- Include any links to sosreport, database dumps, screenshots or other information. -->",source-file
6492,awx,https://github.com/ansible/awx/issues/6492,ISSUE: Call to /api/v2/job_templates/12/launch failed. POST returned status: 504.,"<! The Ansible community is highly committed to the security of our open source projects. Security concerns should be reported directly by email to security@ansible.com. For more information on the Ansible community's practices regarding responsible disclosure, see https://www.ansible.com/security -->  ISSUE TYPE <! Pick one below and delete the rest: --> - Job Template Run - POST returned status: 504  COMPONENT NAME <!-- Pick the area of AWX for this issue, you can have multiple, delete the rest: --> - API  SUMMARY <!-- Briefly describe the problem. -->  ENVIRONMENT * AWX version: How to know the version? This is a newly installed AWX as well * AWX install method: docker on Linux * Ansible version: 2.9.6 * Operating System: CentOS 7 * Web Browser: Firefox  STEPS TO REPRODUCE The issue will be reproduced when Launching the Job Template <!-- For new features, show how the feature would be used. For bugs, please show exactly how to reproduce the problem. Ideally, provide all steps and data needed to recreate the bug from a new awx install. -->  EXPECTED RESULTS <!-- For bug reports, what did you expect to happen when running the steps above? -->  ACTUAL RESULTS - Call to /api/v2/job_templates/12/launch failed. POST returned status: 504. <!-- For bug reports, what actually happened? -->  ADDITIONAL INFORMATION <!-- Include any links to sosreport, database dumps, screenshots or other information. --> GUYS, PLEASE HELP ME WITH THIS ISSUE. :( Let me know if you need more info.",test-file | source-file
7191,awx,https://github.com/ansible/awx/issues/7191,Invalid HTTP request when Conjur credential secret has a space in the name,ISSUE TYPE - Bug Report  SUMMARY Invalid HTTP request when Conjur credential secret has a space in the name  STEPS TO REPRODUCE Create a conjur credential containing a space. When retrieving the credential a 404 is returned from conjur. The reason for this is because the conjur credential plugin url encodes the secretID with a `+` however conjur is expecting a `%20`.  EXPECTED RESULTS To get back the credential content.  ACTUAL RESULTS AWX fails to retrieve the credential and a 404 is returned.  ADDITIONAL INFORMATION,documentation-file | source-file
11350,awx,https://github.com/ansible/awx/issues/11350,Instance group basic Name search missing __icontains,"Please confirm the following - [X] I agree to follow this project's [code of conduct](http://docs.ansible.com/ansible/latest/community/code_of_conduct.html). - [X] I have checked the [current issues](https://github.com/ansible/awx/issues) for duplicates. - [X] I understand that AWX is open source software provided for free and that I am not entitled to status updates or other assurances.  Summary When searching a list of instance groups the __icontains parameter is missing. This means that a user can do a basic search for a string contained within the name of an existing instance group, and the UI will return no results. ![image](https://user-images.githubusercontent.com/63685497/142051117-77ea7fad-6d6e-4d35-a830-66435ac89c29.png)  AWX version 4.1  Installation method docker on linux  Modifications no  Ansible version _No response_  Operating system _No response_  Web browser _No response_  Steps to reproduce To reproduce: 1. Create an instance group 2. Visit the list of instance groups and do a basic Name search for part of the name you gave the instance group. No results.  Expected results If an instance group exists, searching for part of the name should bring up a result.  Actual results The UI shows no results  Additional information _No response_",source-file
11130,awx,https://github.com/ansible/awx/issues/11130,Disable editing more fields of `controlplane` group,"Please confirm the following - [X] I agree to follow this project's [code of conduct](http://docs.ansible.com/ansible/latest/community/code_of_conduct.html). - [X] I have checked the [current issues](https://github.com/ansible/awx/issues) for duplicates. - [X] I understand that AWX is open source software provided for free and that I am not entitled to status updates or other assurances.  Summary Users are able to modify several fields of the `controlplane` instance group, which they probably shouldn't be allowed to edit (these edits will break things).  AWX version 19.2.2  Installation method docker on linux  Modifications no  Ansible version devel  Operating system N/A  Web browser Chrome  Steps to reproduce PATCH to `/api/v2/instance_groups/N/` where that record has the `name` of ""controlplane"" try giving all the fields (individually) a non-default value: json ""name"": ""controlplane"", ""is_container_group"": false, ""credential"": null, ""policy_instance_percentage"": 98, ""policy_instance_minimum"": 0, ""policy_instance_list"": [], ""pod_spec_override"": """"   Expected results Most of these should give a 400 error  Actual results Only modifying `name` gives a 400 Out of the others, particularly problematic seeming ones are: - I can set `is_container_group` to true that doesn't sound good - I can set `policy_instance_percentage` to a value lower than what was set by the installer, which is probably not desired (maybe arguable? but I doubt it) - I can add execution nodes to `policy_instance_list`, which is absolutely not okay  Additional information _No response_",test-file | source-file
10118,awx,https://github.com/ansible/awx/issues/10118,Jobs on systems missing EEs throw an error instead of failing,"ISSUE TYPE - Bug Report  SUMMARY If the user fails to have an execution environment available, the dispatcher will raise an error and a traceback will go to the logs, but the feedback provided to the user via the UI or API is mysterious.  ENVIRONMENT * AWX version: 19.1.0  STEPS TO REPRODUCE 1. deliberately delete all EEs, including any installed managed-by-tower EEs 2. trigger a project update  EXPECTED RESULTS If there are no EEs available, the job should fail with an explicit reason provided in the job output in the UI.  ACTUAL RESULTS job output: ![image(4)](https://user-images.githubusercontent.com/685957/117202438-d17c3580-adbb-11eb-8d5e-ab255aefeacc.png) in the logs:  tools_awx_1 | awx-dispatcher stdout | 2021-05-05 19:46:16,092 ERROR [c77b9784] awx.main.tasks project_update 17 (running) Exception occurred while running task tools_awx_1 | awx-dispatcher stdout | Traceback (most recent call last): tools_awx_1 | awx-dispatcher stdout | File ""/awx_devel/awx/main/tasks.py"", line 1316, in run tools_awx_1 | awx-dispatcher stdout | env = self.build_env(self.instance, private_data_dir, private_data_files=private_data_files) tools_awx_1 | awx-dispatcher stdout | File ""/awx_devel/awx/main/tasks.py"", line 1883, in build_env tools_awx_1 | awx-dispatcher stdout | env = super(RunProjectUpdate, self).build_env(project_update, private_data_dir, private_data_files=private_data_files) tools_awx_1 | awx-dispatcher stdout | File ""/awx_devel/awx/main/tasks.py"", line 997, in build_env tools_awx_1 | awx-dispatcher stdout | ee_cred = self.instance.execution_environment.credential tools_awx_1 | awx-dispatcher stdout | AttributeError: 'NoneType' object has no attribute 'credential' tools_awx_1 | awx-dispatcher stdout |",test-file | source-file
9669,awx,https://github.com/ansible/awx/issues/9669,Cannot save Miscellaneous System Settings on new cluster,"<!-- Issues are for **concrete, actionable bugs and feature requests** only - if you're just asking for debugging help or technical support, please use: - http://webchat.freenode.net/?channels=ansible-awx - https://groups.google.com/forum/#!forum/awx-project We have to limit this because of limited volunteer time to respond to issues! -->  ISSUE TYPE - Bug Report  SUMMARY I cannot save my changes to the Miscellaneous System settings of a newly created AWX Tower install. I receive no UI feedback but the network tab shows `{""CUSTOM_VENV_PATHS"":[""Expected list of strings but got <class 'str'> instead.""]}`. I have not attempted to set up custom venvs, nor can I find that setting in the UI.  ENVIRONMENT * AWX version: 18.0.0 * AWX install method: minikube following https://github.com/ansible/awx/blob/devel/INSTALL.md * Ansible version: unknown * Operating System: ArchLinux * Web Browser: Firefox 87  STEPS TO REPRODUCE 1. Install a new instance of AWX using the instructions given in the INSTALL.md file 2. Log in as admin 3. Edit settings under /#/settings/miscellaneous_system/details 4. Attempt to change the base url from ""https://towerhost"" to my actual base URL. 5. Hit save  EXPECTED RESULTS Settings save and UI reverts to the details page.  ACTUAL RESULTS No UI feedback at all, following error in network tab.  {""CUSTOM_VENV_PATHS"":[""Expected list of strings but got <class 'str'> instead.""]}  The PATCH request is sent to https://MYDOMAIN/api/v2/settings/all/ and has the following relevant data:  ""CUSTOM_VENV_PATHS"":""[]""   ADDITIONAL INFORMATION <!-- Include any links to sosreport, database dumps, screenshots or other information. -->",test-file | documentation-file | source-file
7063,awx,https://github.com/ansible/awx/issues/7063,POSTing to create workflow approval node (node without UJT) ignores all_parents_must_converge,"ISSUE TYPE - Bug Report  SUMMARY ![all_parents](https://user-images.githubusercontent.com/9889020/82239367-abd5f200-9906-11ea-8c60-39ef86625ff8.gif) Relates to https://github.com/ansible/awx/issues/6998  STEPS TO REPRODUCE 1. Create an empty workflow 2. Attempt to POST to `/api/v2/workflow_job_templates/:id/workflow_nodes/` with the following payload:  { ""all_parents_must_converge"": true }   EXPECTED RESULTS A node is created with `all_parents_must_converge` set to `true`  ACTUAL RESULTS A node is created with `all_parents_must_converge` set to `false`  ADDITIONAL INFORMATION The use case here is approval nodes. In order to create an approval node in the UI we make this initial POST request to create the node. After we have a node, we create the corresponding approval template. If the user were to attempt to create a new approval node in the UI where `all_parents_must_converge` was set to true it would currently save but `all_parents_must_converge` would be set to false. If this becomes problematic to fix, the UI could always issue a 3rd request to go back and PATCH the node from the first request but this would be less desirable.",source-file | config-file | data-file | test-file | other-file | documentation-file
9472,awx,https://github.com/ansible/awx/issues/9472,awx.main.utils.common.get_ansible_version breaks with ansible-core,"<!-- Issues are for **concrete, actionable bugs and feature requests** only - if you're just asking for debugging help or technical support, please use: - http://webchat.freenode.net/?channels=ansible-awx - https://groups.google.com/forum/#!forum/awx-project We have to limit this because of limited volunteer time to respond to issues! -->  ISSUE TYPE - Bug Report  SUMMARY <!-- Briefly describe the problem. --> The `awx.main.utils.common.get_ansible_version` helper breaks with new `ansible --version` when ansible-core is installed. This also changes the format the `api/v2/config` returns for the `ansible_version` field. What breaks tools that relies on this field to check the current ansible version used by AWX.  ENVIRONMENT * AWX version: devel * AWX install method: vm * Ansible version: ansible-core 2.11 * Operating System: RHEL8.3 * Web Browser:  STEPS TO REPRODUCE <!-- Please describe exactly how to reproduce the problem. --> Install AWX with ansible-core and perform a GET request to `/api/v2/config` and check the `ansible_version` field format.  EXPECTED RESULTS <!-- What did you expect to happen when running the steps above? --> The ansible version format should be something like `X.Y.Z` (format capable to be parsed by tools like `distutils.version.LooseVersion`)  ACTUAL RESULTS <!-- What actually happened? --> Returning something like `""ansible_version"": ""[core 2.11.0.dev0]""`  ADDITIONAL INFORMATION <!-- Include any links to sosreport, database dumps, screenshots or other information. --> Output of `ansible --version` for ansible-core 2.11: console $ ansible --version ansible [core 2.11.0b1] config file = /home/elyezer/code/ansible/ansible-core/ansible.cfg configured module search path = ['/home/elyezer/.ansible/plugins/modules', '/usr/share/ansible/plugins/modules'] ansible python module location = /home/elyezer/.virtualenvs/ansible-core/lib/python3.9/site-packages/ansible ansible collection location = /home/elyezer/.ansible/collections:/usr/share/ansible/collections executable location = /home/elyezer/.virtualenvs/ansible-core/bin/ansible python version = 3.9.0 (default, Oct 6 2020, 00:00:00) [GCC 10.2.1 20200826 (Red Hat 10.2.1-3)] jinja version = 2.11.3 libyaml = True  For ansible 2.9:  ansible 2.9.16 config file = /home/elyezer/code/ansible/ansible/ansible.cfg configured module search path = ['/home/elyezer/.ansible/plugins/modules', '/usr/share/ansible/plugins/modules'] ansible python module location = /home/elyezer/.virtualenvs/ansible/lib/python3.9/site-packages/ansible executable location = /home/elyezer/.virtualenvs/ansible/bin/ansible python version = 3.9.0 (default, Oct 6 2020, 00:00:00) [GCC 10.2.1 20200826 (Red Hat 10.2.1-3)]",test-file | source-file
4542,awx,https://github.com/ansible/awx/issues/4542,Google Cloud Compute Engine credential type is stripping the json file,"ISSUE TYPE - Bug Report  SUMMARY When a google compute engine credential is created with the json credential file, AWX is stripping some valuable lines. I need those, as I am using gcp_compute_disk module which also requires the service account file to be give as absolute path to the json and instead of giving the file path twice manually, I am using {{ lookup('env','GCP_SERVICE_ACCOUNT_FILE') }} to refer the absolute path to the json, but I am getting error that the lines about email and token_uri are missing. In order to resolve that I was forced to create a custom credential type for uploading the json and use it without stripping.  ENVIRONMENT * AWX version: 6.x.x * AWX install method: docker * Ansible version: 2.8.2 * Operating System: Ubuntu 18.04 * Web Browser: Firefox, Chrome  STEPS TO REPRODUCE Upload a google json credential to awx and try to use the service_account_file: ""{{ lookup('env','GCP_SERVICE_ACCOUNT_FILE') }}"" when using the gcp_compute_disk module for example. Your AWX template must be pointed to the gce credential also.  EXPECTED RESULTS get the full json and take all needed lines  ACTUAL RESULTS gets the json, but it seems the AWX module for gce credenials strips some lines and the file is usable by the gcp_compute_* ansible modules.  ADDITIONAL INFORMATION New credential type I've used to get around this is: Input configuration: `fields: - id: gcp_credential_file type: string label: GCP Credential File (JSON) secret: true multiline: true` Injector configuration: `env: GCP_SERVICE_ACCOUNT_FILE: '{{ tower.filename }}' file: template: '{{ gcp_credential_file }}'`",test-file | source-file
13120,awx,https://github.com/ansible/awx/issues/13120,Add Conjur Cloud support to CyberArk Conjur Secrets Lookup credential plugin,"Please confirm the following - [X] I agree to follow this project's [code of conduct](https://docs.ansible.com/ansible/latest/community/code_of_conduct.html). - [X] I have checked the [current issues](https://github.com/ansible/awx/issues) for duplicates. - [X] I understand that AWX is open source software provided for free and that I might not receive a timely response.  Bug Summary Conjur Cloud adds the requirement of `/api` after the base domain of the service prior to endpoints that are currently configured in the credential plugin. Providing `/api` as part of the URL on the secret lookup gets trimmed by `urllib.parse.urljoin()` that builds the URL to send API requests when executing the credential plugin.  AWX version 21.7.0  Select the relevant components - [ ] UI - [X] API - [ ] Docs - [ ] Collection - [ ] CLI - [ ] Other  Installation method docker development environment  Modifications no  Ansible version 2.13.5  Operating system Ubuntu 22.04.1 LTS  Web browser _No response_  Steps to reproduce With a Conjur Cloud tenant available to target, configure the CyberArk Conjur Secrets Lookup external management system credential plugin as documented.  Expected results Tests should pass successfully.  Actual results Tests to retrieve a secret will return `HTTP 404`.  Additional information A PR is prepared and will be submitted shortly.",test-file | documentation-file | source-file
5983,awx,https://github.com/ansible/awx/issues/5983,List Navigation 404,ISSUE TYPE - Bug Report  SUMMARY List navigation error.  ENVIRONMENT * AWX version: 2.10 * AWX install method: docker for mac * Ansible version: 9.2.1 * Operating System: Mojave * Web Browser: Chrome  STEPS TO REPRODUCE Go to a list and select either 5 or 10 items per page. Navigate to the last page. Then select a number of items per page higher that what you selected originally. If you selected 5 items per page originally then select 10 items per page.  EXPECTED RESULTS Page should reset to the first page and no 404 error  ACTUAL RESULTS 404 error  ADDITIONAL INFORMATION ![navigation bug](https://user-images.githubusercontent.com/39280967/74779455-84ba4680-526b-11ea-9fad-8fb59a1bd556.gif),test-file | data-file
6460,awx,https://github.com/ansible/awx/issues/6460,Unable to save any forms,"ISSUE TYPE - Bug Report  SUMMARY <!-- Briefly describe the problem. --> I'm unable to save any forms in AWX 9.3.0. When I try to click on the save button to create a new sample project or add LDAP authencatication I have a status code 504. And the form is never saved.  ENVIRONMENT * AWX version: 9.3.0 * AWX install method: docker on linux * Ansible version: 2.9.5 * Operating System: CentOS 7.7 * Web Browser: Chrome and Chrome in private  STEPS TO REPRODUCE <!-- Please describe exactly how to reproduce the problem. --> Create a new project sample and click save  EXPECTED RESULTS <!-- What did you expect to happen when running the steps above? --> The form should be saved  ACTUAL RESULTS <!-- What actually happened? --> Failed to create new project. POST returned status: 504  ADDITIONAL INFORMATION <!-- Include any links to sosreport, database dumps, screenshots or other information. --> In the logs I can see : `awx_web | 2020/03/27 14:23:31 [error] 122#0: *47 upstream timed out (110: Connection timed out) while reading response header from upstream, client: 10.204.35.76, server: _, request: ""GET /websocket/ HTTP/1.1"", upstream: ""http://127.0.0.1:8051/websocket/"", host: ""myserver:82"" ` And in the browser console I have :  Failed to load resource: the server responded with a status of 504 (Gateway Time-out) WebSocket connection to 'ws://myserver:82/websocket/' failed: WebSocket opening handshake timed out",source-file
6309,awx,https://github.com/ansible/awx/issues/6309,POST to api/v2/inventories/<ID>/inventory_sources/ with id and name gets 201 created (should be 400),"ISSUE TYPE - Bug Report  SUMMARY <!-- Briefly describe the problem. --> I was trying to associate an inventory script with an inventory as an inventory source. When I did a POST to api/v2/inventories/<ID>/inventory_sources/ with id and name I got a 201 created (should be 400) and an inventory source object back. I then launched an inventory update and the following traceback was produced:  Traceback (most recent call last): File ""/var/lib/awx/venv/awx/lib64/python3.6/site-packages/awx/main/tasks.py"", line 1308, in run args = self.build_args(self.instance, private_data_dir, passwords) File ""/var/lib/awx/venv/awx/lib64/python3.6/site-packages/awx/main/tasks.py"", line 2472, in build_args if getattr(settings, '%s_EXCLUDE_EMPTY_GROUPS' % src.upper()): File ""/var/lib/awx/venv/awx/lib64/python3.6/site-packages/awx/conf/settings.py"", line 511, in __getattr_without_cache__ return getattr(self._wrapped, name) File ""/var/lib/awx/venv/awx/lib64/python3.6/site-packages/awx/conf/settings.py"", line 418, in __getattr__ value = self._get_default(name) File ""/var/lib/awx/venv/awx/lib64/python3.6/site-packages/awx/conf/settings.py"", line 405, in _get_default return getattr(self.default_settings, name) AttributeError: 'Settings' object has no attribute '_EXCLUDE_EMPTY_GROUPS'  Seems like the bug is that we are not requiring the `source` perhaps among other things and ignoring `id`",source-file
7665,awx,https://github.com/ansible/awx/issues/7665,API should not accept modification of local_path for nom-manual projects,"ISSUE TYPE - Bug Report  SUMMARY The API will accept a PATCH to edit `local_path` for a git project, but the change will not take effect. Some version of a 400 error would be preferable to this. This is a valid field to edit in the case of manual projects, so there's no valid justification that it's ""not a field"".  ENVIRONMENT * AWX version: 13.0.0 * AWX install method: N/A * Ansible version: N/A  STEPS TO REPRODUCE PATCH `/api/v2/projects/6/` json { ""description"": ""asdf"", ""local_path"": ""_6__demo_project_edited"" }   EXPECTED RESULTS One of: - the local_path value changes to ""_6__demo_project_edited"" - get error  ACTUAL RESULTS No error description changes to ""asdf"" the `local_path` remains at prior value of ""_6__demo_project""",test-file | source-file
5528,awx,https://github.com/ansible/awx/issues/5528,New AWX CLI returns type error when modifying list or dict settings,"ISSUE TYPE - Bug Report  SUMMARY When trying to modify a list or dictionary valued setting from the **awx** command line tool, the API return a type error.  ENVIRONMENT * AWX version: 9.0.1 * AWX install method: Kubernetes * Ansible version: 2.7.11 * Operating System: Ubuntu 18.04 * Web Browser: Firefox 71  STEPS TO REPRODUCE 1. Install the AWX CLI tool:  pip install ""https://github.com/ansible/awx/archive/9.0.1.tar.gz#egg=awxkit&subdirectory=awxkit""  2. Try to modify the AUTH_LDAP_GROUP_SEARCH (type list) setting  awx settings modify AUTH_LDAP_USER_SEARCH '[""DC=example,DC=com"",""SCOPE_SUBTREE"",""(uid=%(user)s)""]'  3. Receive the following error  {""AUTH_LDAP_USER_SEARCH"": [""Expected a list of items but got type \""str\"".""]}   EXPECTED RESULTS Expected to modify the setting like the old tower-cli or awx-cli tools were able to.  ACTUAL RESULTS Received a type error  {""AUTH_LDAP_USER_SEARCH"": [""Expected a list of items but got type \""str\"".""]}   ADDITIONAL INFORMATION You can achieve the same modification with the awx-cli:  awx-cli setting modify AUTH_LDAP_USER_SEARCH '[""DC=example,DC=com"",""SCOPE_SUBTREE"",""(uid=%(user)s)""]' Resource changed.   id value   AUTH_LDAP_USER_SEARCH [u'DC=example,DC=com', u'SCOPE_SUBTREE', u'(uid=%(user)s)']",test-file | config-file | source-file
11622,awx,https://github.com/ansible/awx/issues/11622,Hop nodes instances can be modified,"Please confirm the following - [X] I agree to follow this project's [code of conduct](https://docs.ansible.com/ansible/latest/community/code_of_conduct.html). - [X] I have checked the [current issues](https://github.com/ansible/awx/issues) for duplicates. - [X] I understand that AWX is open source software provided for free and that I might not receive a timely response.  Summary After merging https://github.com/ansible/awx/pull/11591 the hop nodes are now exposed in `/api/v2/instances/`. Example:  { ""id"": 4, ""type"": ""instance"", ""url"": ""/api/v2/instances/4/"", ""related"": { ""jobs"": ""/api/v2/instances/4/jobs/"", ""instance_groups"": ""/api/v2/instances/4/instance_groups/"" }, ""uuid"": ""00000000-0000-0000-0000-000000000000"", ""hostname"": ""receptor-hop"", ""created"": ""2022-01-26T19:15:07.439405Z"", ""modified"": ""2022-01-26T19:27:58.447951Z"", ""last_seen"": ""2022-01-27T13:36:46.163205Z"", ""last_health_check"": null, ""errors"": """", ""capacity_adjustment"": ""1.00"", ""version"": """", ""capacity"": 0, ""consumed_capacity"": 0, ""percent_capacity_remaining"": 0.0, ""jobs_running"": 0, ""jobs_total"": 0, ""cpu"": 0, ""memory"": 0, ""cpu_capacity"": 0, ""mem_capacity"": 0, ""enabled"": false, ""managed_by_policy"": false, ""node_type"": ""hop"" }  and now is possible to `PUT` or `PATCH` the values through API  { ""capacity_adjustment"": ""1.00"", ""enabled"": false, ""managed_by_policy"": false }  although setting capacity to 0 enabld to false is not making the job to faul, @jbradberry do we want allow users to patch/put on hop node instances?  AWX version devel  Installation method docker on linux  Modifications no  Ansible version _No response_  Operating system _No response_  Web browser Chrome  Steps to reproduce 1. Go to /api/v2/instances/<id>/ 2. patch any value:  { ""capacity_adjustment"": 1.0, ""enabled"": true, ""managed_by_policy"": true }   Expected results These fields to be not modifyable for hop nodes?  Actual results 1. The user can change those values 2. This is not making the job to fail 3. The hop nodes instances are showing as `disabled` in the mesh view (may confuse users)  Additional information _No response_",source-file
7798,awx,https://github.com/ansible/awx/issues/7798,Exported Workflow Job Templates refer to inventories by id instead of natural key,"ISSUE TYPE - The API endpoint for a workflow_job_template does not provide a representation that includes the natural key of the related Inventory, which is problematic when migrating it between different instances of AWX/Tower.  SUMMARY The API endpoint for a workflow_job_template does not provide a representation that includes the natural key of the related Inventory, if set. Instead, it just uses the numerical `id`, which is problematic when attempting to export and import the workflow between different instances of AWX/Tower, since the API will attempt to use the given numerical `id` to associate an inventory to the import workflow, which will most likely be different on the target instance of AWX/Tower. This behaviour is dangerous because if the target instance of AWX/Tower has a different inventory with the same numerical `id`, no warnings will be raised, causing the workflow to be associated with the wrong template.  ENVIRONMENT * AWX version: 3.7.1 (Tower) * AWX install method: openshift * Ansible version: 2.9.9 * Operating System: OpenShift * Web Browser: Google Chrome  STEPS TO REPRODUCE 1. Export a `workflow_job_template` that is associated with an inventory 2. Observe the value of the `workflow_job_templates.[].inventory` attribut in the exported YAML.  EXPECTED RESULTS It is reasonable to expect that the following YAML document would be generated for an example workflow_job_template object. yaml workflow_job_templates: - allow_simultaneous: true ask_inventory_on_launch: false ask_limit_on_launch: false ask_scm_branch_on_launch: true ask_variables_on_launch: true description: My VM provisioning extra_vars: '' inventory: name: my-vms type: inventory organization: name: ACME type: organization limit: null name: my-workflow natural_key: name: my-workflow organization: name: ACME type: organization type: workflow_job_template organization: name: ACME type: organization related: notification_templates_approvals: [] notification_templates_error: [] notification_templates_started: [] notification_templates_success: [] schedules: [] survey_spec: {} workflow_nodes: [] scm_branch: null survey_enabled: false webhook_credential: null  The document above, when imported, will generate the association with the inventory correctly on Tower 3.7.1. This is the expected behaviour, relying on the natural key of the object instead of the `id`.  ACTUAL RESULTS YAML such as the following is generated: yaml workflow_job_templates: - allow_simultaneous: true ask_inventory_on_launch: false ask_limit_on_launch: false ask_scm_branch_on_launch: true ask_variables_on_launch: true description: My VM provisioning extra_vars: '' inventory: 29 limit: null name: my-workflow natural_key: name: my-workflow organization: name: ACME type: organization type: workflow_job_template organization: name: ACME type: organization related: notification_templates_approvals: [] notification_templates_error: [] notification_templates_started: [] notification_templates_success: [] schedules: [] survey_spec: {} workflow_nodes: [] scm_branch: null survey_enabled: false webhook_credential: null  Notice that the `inventory` key has the value corresponding to the unique id on the source AWX/Tower server. This is not guaranteed to be the same on the target server when the object will be imported.",source-file
4573,awx,https://github.com/ansible/awx/issues/4573,CLI: Need general solution for dictionary-like inputs,"ISSUE TYPE - Bug Report  SUMMARY <!-- Briefly describe the problem. --> This is a general problem but I'm going to flesh out one particular use case for now: Currently, credential type creation does not accept inputs. New credential types need to have some kind of inputs in order to be of any use. Currently the CLI and APi have conflicting constraints on the `--inputs` flag so there is no way to pass itat least not that I could figure out.  STEPS TO REPRODUCE <!-- Please describe exactly how to reproduce the problem. --> Passing any type of dictionary like thing gets an error from the CLI saying it should be an integer:  awx credential_types create --name foo_cred_type1 --kind cloud --inputs=""\{'fields': [\{'id': 'password', 'label':'password', 'secret':true, 'type':'string'\}]\}"" usage: awx credential_types create [-h] --name TEXT [--description TEXT] --kind {net,cloud} [--inputs INPUTS] [--injectors INJECTORS] required arguments: --kind {net,cloud} [REQUIRED] optional arguments: -h, --help show this help message and exit --description TEXT Optional description of this credential type. --inputs INPUTS Enter inputs using either JSON or YAML syntax. Use the radio button to toggle between the two. Refer to the Ansible Tower documentation for example syntax. --injectors INJECTORS Enter injectors using either JSON or YAML syntax. Use the radio button to toggle between the two. Refer to the Ansible Tower documentation for example syntax. required arguments: --name TEXT [REQUIRED] Name of this credential type. awx credential_types create: argument --inputs: invalid int value: ""\\{'fields': [\\{'id': 'password', 'label':'password', 'secret':true, 'type':'string'\\}]\\}""  But if you pass an integer (which makes no sense), you get error from API:  awx credential_types create --name foo_cred_type1 --kind cloud --inputs=42 {""inputs"": [""int provided, expected dict""]}   EXPECTED RESULTS <!-- What did you expect to happen when running the steps above? --> Either have reasonable way provide `inputs` to the new credential_type or do not allow creation from command line. This is something we need to consider what a reasonable UX would be for specifying the new credential type inputs.",test-file | data-file | source-file
10123,awx,https://github.com/ansible/awx/issues/10123,AWX 19.1.0 - Job settings cannot be saved (/worker-json.js returns 404),"ISSUE TYPE - Bug Report  SUMMARY Job settings cannot be saved, probably due to the `worker-json.js` returning 404.  ENVIRONMENT * AWX version: 19.1.0 * AWX install method: minikube * OS: Debian * Browser: Chromium: 90.0.4430.93 (Official Build) (64-bit)  STEPS TO REPRODUCE - Go the Settings > Jobs settings > Edit - Tweak a setting - Hit Save  EXPECTED RESULTS - The settings are saved succesfully  ACTUAL RESULTS - The settings never get updated, the save button doesn't do anything  ADDITIONAL INFORMATION I am not sure what debug information would help, but I will be happy to provide any if required",source-file | test-file | documentation-file
5046,awx,https://github.com/ansible/awx/issues/5046,Child WorkflowJob not started when Inventory on WorkflowJobTemplateNode,"ISSUE TYPE - Bug Report  SUMMARY I have nested workflow templates, when I set Prompt on launch on child workflow template and set Inventory through ""Prompt"" in Workflow visualizer, then Launch is in Running state forever and Workflow job for child Workflow template doesn't exist (is probably deleted, because there is missing ID in list of Jobs)  ENVIRONMENT * AWX version: Tower 3.5.0 * AWX install method: AMI - https://www.ansible.com/products/tower/trial - Tower in Amazon EC2 * Ansible version: 2.8.0 * Operating System: * Web Browser: Google Chrome 77.0.3865.120  STEPS TO REPRODUCE Child Workflow template contains: - No inventory, Prompt on launch - Job Template with https://github.com/mkanoor/playbook/blob/master/hello_world.yml - No inventory, Prompt on launch - Workflow Job Template Node with Inventory1 (added through ""Prompt"" button in Workflow visualizer) Parent Workflow template contains: - No inventory - Child workflow - (No inventory, Prompt on Launch) - Workflow Job Template Node with Inventory2 (added through ""Prompt"" button in Workflow visualizer)  Parent Workflow (without Inventory) (Start) ==> (Inventory2 on Workflow Node) ==> [ Child Workflow (without Inventory, Prompt on Launch) => (Start) ==> (Inventory1 on Workflow Node) ==> Job Template with Prompt on Launch ]   EXPECTED RESULTS Job Template should be successfully finished (I suppose with Inventory2?)  ACTUAL RESULTS Parent workflow job Status = Running forever Child workflow job doesn't exist (probably deleted, one ID in Jobs is missing) API: (the only node) in `api/workflow_jobs/<parent_workflow_id>/workflow_nodes` doesn't have `/summary_fields/job`, also `/related/job` doesn't exist. But there are `/summary_fields/inventory` and `/related/inventory`. Parent workflow doesn't have inventory In another case that Parent workflow has inventory and workflow node doesn't have, then `/summary_fields/job` and `/related/job` links exist and point to child workflow.  ADDITIONAL INFORMATION <!-- Include any links to sosreport, database dumps, screenshots or other information. -->",test-file | source-file
11505,awx,https://github.com/ansible/awx/issues/11505,Cannot create manual project in Japanese (possibly all non-English languages),Please confirm the following - [X] I agree to follow this project's [code of conduct](http://docs.ansible.com/ansible/latest/community/code_of_conduct.html). - [X] I have checked the [current issues](https://github.com/ansible/awx/issues) for duplicates. - [X] I understand that AWX is open source software provided for free and that I am not entitled to status updates or other assurances.  Summary _No response_  AWX version 19.5.0  Installation method docker for mac  Modifications no  Ansible version _No response_  Operating system _No response_  Web browser _No response_  Steps to reproduce 1. Compile strings 2. Start up AWX 3. Set default browser language to Japanese (UI should now render in Japanese for translated strings) 4. Attempt to create a manual project  Expected results A manual project is created  Actual results Project creation fails  Additional information I suspect that we are sending the translated string back to the API rather than `manual` which is what it is expecting.,source-file
8305,awx,https://github.com/ansible/awx/issues/8305,500 error when attempting to delete workflow approval,"ISSUE TYPE - Bug Report  SUMMARY ![delete_wf_approval](https://user-images.githubusercontent.com/9889020/94853438-67e91280-03f9-11eb-9233-63c15e611f70.gif) I haven't tried this with a pending workflow approval but I suspect it would yield the same result. We don't have an interface that interacts with this endpoint in the UI so maybe this has been around for a while? I'm exploring adding an interface for listing out _all_ workflow approvals so that a user could go back and see who approved/denied what in the past. This interface will support deletion if the API allows it.  STEPS TO REPRODUCE 1) Create a workflow with an approval step 2) Launch workflow 3) Approve step 4) Attempt to delete workflow approval via API  EXPECTED RESULTS Successful delete  ACTUAL RESULTS 500 error  Request Method: | DELETE -- | -- https://localhost:8043/api/v2/workflow_approvals/3/ 2.2.16 AttributeError 'NoneType' object has no attribute 'objects' ./awx/main/models/unified_jobs.py in get_event_queryset, line 994 /venv/awx/bin/uwsgi 3.6.8 ['/venv/awx/lib/python3.6/site-packages/git/ext/gitdb', '.', '', '/venv/awx/lib64/python36.zip', '/venv/awx/lib64/python3.6', '/venv/awx/lib64/python3.6/lib-dynload', '/usr/lib64/python3.6', '/usr/lib/python3.6', '/venv/awx/lib/python3.6/site-packages', '/venv/awx/lib/python3.6/site-packages/gitdb/ext/smmap'] Thu, 1 Oct 2020 19:17:11 +0000",source-file
4492,awx,https://github.com/ansible/awx/issues/4492,API/SDK configure CUSTOM_LOGO doesn't take affect,"ISSUE TYPE - Bug Report  SUMMARY When utilizing the UI, one can head to Settings/UI and upload an image file. This ""replaces"" the Image file on the login screen. One can also view this image in a ""data:url"" format at api/v2/settings/ui CUSTOM_LOGO: ""data:image/png;base64,Base64EncodedStringhere="" Attempting the same via the API or tower-cli (example below) produces no ""error"" and updates the CUSTOM_LOGO attribute properly when viewed in the API, but doesn't actually ""take effect"" in that the logo is not actually changed at login.  ENVIRONMENT * AWX version: 6.1.0 * AWX install method: openshift * Ansible version: Whatever comes built-in with 6.1.0's ansible virtualenv * Operating System: Openshift 3.11 running on RHEL 7.6 * Web Browser: Firefox  STEPS TO REPRODUCE Reproduce using the tower-cli:  with open(""/path/to/a/png/file.png, 'rb') as logofile: logo_64_encode = base64.b64encode(logofile.read()).decode() created_data_url = 'data:image/png;base64,{}'.format(logo_64_encode) # Placeholder: Setup AWX auth - however you do it since there's 10,000 ways # Set a bunch of other settings as examples - these all WORK FINE # Assuming you have some valid data in login_message and custom_venv_paths variables settings_resource.modify('CUSTOM_LOGIN_INFO', login_message) settings_resource.modify('CUSTOM_VENV_PATHS', json.dumps(custom_venv_paths)) # Setup AWX Custom Logo using above data:url - this shows a successful return and updates CUSTOM_LOGO - but never displays settings_resource.modify('CUSTOM_LOGO', created_data_url)   EXPECTED RESULTS if the tower-cli call succeeded (no errors) an i can see the encoded data:url in CUSTOM_LOGO - i would expect a Custom Image to be displayed at the login prompt.  ACTUAL RESULTS No image is displayed. Uploading the same image via the UI's ""browse"" option causes it to display immediately, same apparent data:url object written to CUSTOM_LOGO  ADDITIONAL INFORMATION N/A",source-file
6464,awx,https://github.com/ansible/awx/issues/6464,Survey multiple choice options need improvements and error handling,"ISSUE TYPE - Bug Report  SUMMARY From https://github.com/ansible/awx/issues/5900#issuecomment-605008285: cc @keithjgrant > Both add and edit forms for JT surveys need some way of clarifying how to format single-select and multi-select options. It is trivial to create modal-overlay 400 errors with the basic input textbox given, and these 400 errors do not provide any useful information to the end user.  STEPS TO REPRODUCE Put bad input into a job template survey with either single or multi-select. semicolons in random spots, etc, in an attempt to break it. some things work, some don't.  EXPECTED RESULTS Form validation on submission that keeps you on the form page, indicating formatting errors or something similar when met with a 400 error. I would also like information around the box about how to format the survey.  ACTUAL RESULTS 400 that takes you back to the survey list, no further information about the error.",test-file | data-file | source-file
5099,awx,https://github.com/ansible/awx/issues/5099,Default for webhook_service is not in field choices and not accepted,"ISSUE TYPE - Bug Report  SUMMARY The OPTIONS for job_templates is not self-consistent for the field `webhook_service`. This breaks the `tower-cli send` command, assuming the data comes from the receive command. A hack is in progress for this, but it would be better to change behavior from API moving forward.  ENVIRONMENT * AWX version: 8.0.0 * AWX install method: N/A * Ansible version: N/A * Operating System: * Web Browser:  STEPS TO REPRODUCE Of particular interest here is the sequence of `tower-cli receive`, saving that to a file, and using it in `tower-cli send`.  EXPECTED RESULTS Data given from the API is consistent with OPTIONS  ACTUAL RESULTS OPTIONS for job_templates gives json ""webhook_service"": { ""type"": ""choice"", ""label"": ""Webhook service"", ""help_text"": ""Service that webhook requests will be accepted from"", ""filterable"": true, ""choices"": [ [ ""github"", ""GitHub"" ], [ ""gitlab"", ""GitLab"" ] ]  The receive command always gives `webhook_credential` in the asset data because it has no default. Without a default, it cannot be determined if the field has been set. The send command gives  JOB TEMPLATE [SRtest]  Value is not a valid choice for option webhook_service for job_template SRtest. Options: ['github', 'GitHub', 'gitlab', 'GitLab']   ADDITIONAL INFORMATION https://github.com/ansible/tower-cli/pull/741 Ping @jbradberry, @john-westcott-iv In terms of CLI design in general, @ryanpetrello I find the ability to determine if a field has a non-default value is a powerful tool. This is one of the things I most like about the send/receive commands. I would even prefer that for compact representations of resources for human consumption.",source-file
6332,awx,https://github.com/ansible/awx/issues/6332,Getting a 400 error when Credential Add/Edit has an invalid SSH Private Key field,"ISSUE TYPE - Bug Report  SUMMARY When a invalid SSH Private Key is specified, getting a 400 error instead of an error under the field that the value is invalid  STEPS TO REPRODUCE 1. Add/Edit a credential 2. select any of the credential type 2. Enter an invalid value for the SSH Private Key  EXPECTED RESULTS It should say that the value is invalid under the field  ACTUAL RESULTS Getting a 400 error ![Screen Shot 2020-03-18 at 1 19 38 PM](https://user-images.githubusercontent.com/11617351/76988490-255b5f00-691b-11ea-848a-8c48233e987b.png)",source-file
9441,awx,https://github.com/ansible/awx/issues/9441,Advanced search for type returns 400,"<!-- Issues are for **concrete, actionable bugs and feature requests** only - if you're just asking for debugging help or technical support, please use: - http://webchat.freenode.net/?channels=ansible-awx - https://groups.google.com/forum/#!forum/awx-project We have to limit this because of limited volunteer time to respond to issues! -->  ISSUE TYPE - Bug Report  SUMMARY Trying to do an advanced search by `type` the results are always `ExecutionEnvironment has no field named 'type'`: ![image](https://user-images.githubusercontent.com/12464858/109544586-83d70a00-7aa6-11eb-994c-dedcbce8801a.png)",data-file
4943,awx,https://github.com/ansible/awx/issues/4943,System Auditor is unable to view Container Groups,ISSUE TYPE - Bug Report  SUMMARY System Auditor is unable to view Container Groups  ENVIRONMENT * AWX version: 7.0.0  STEPS TO REPRODUCE 1. Create Container Group 2. Log in as System Auditor 3. Attempt to view a container group  EXPECTED RESULTS Able to view container group like an instance group  ACTUAL RESULTS Unable to view container group  ADDITIONAL INFORMATION ![Screen Shot 2019-10-08 at 5 32 17 PM](https://user-images.githubusercontent.com/12446869/66435218-5c375b80-e9f2-11e9-8abb-0be7ba30ad30.png),source-file
8202,awx,https://github.com/ansible/awx/issues/8202,Launching job with vault password 400s when default machine cred is replaced,"ISSUE TYPE - Bug Report  SUMMARY Really odd behavior that I came across while building out credential prompting in the new UI. This can be reproduced via the API browser though. I created a JT with a default machine credential (that prompted for some passwords) and a default vault credential (that prompted for password). If I swap the machine credential for one that does not prompt for a password then the API responds with a 400 on launch complaining about the vault password: `{""passwords_needed_to_start"":[""vault_password.A""]}` In the example below credential with ID = 1 is the machine credential that prompts for ssh and become passwords. Credential ID = 2 is the machine credential that does not prompt for passwords. Credential ID = 4 is the vault credential that prompts for password. A normal launch without changing credentials: ![good_launch](https://user-images.githubusercontent.com/9889020/93922608-26ad8000-fce0-11ea-8b61-8604ec329d83.gif) A launch where I change the machine credential: ![bad_launch](https://user-images.githubusercontent.com/9889020/93922684-493f9900-fce0-11ea-93a5-891b46041a13.gif)",test-file | source-file
9373,awx,https://github.com/ansible/awx/issues/9373,[ui_next] Silent error when creating or editing an inventory source to 'Update on launch' and 'Update on project update',"ISSUE TYPE - Bug Report  SUMMARY When creating or editing an inventory which is sourced from a project, if the 'Update on launch' and 'Update on project update' options are selected, the form does not save and the API's error response does not get displayed in the UI.  {""update_on_launch"":[""Cannot update SCM-based inventory source on launch if set to update on project update. Instead, configure the corresponding source project to update on launch.""]}  I think the fix for this should be two parts: 1. Update the tooltips for both toggles to note that they cannot be used simultaneously 2. Surface API errors to user on save, generally.  STEPS TO REPRODUCE 1. Create an Inventory with type 'Sourced from a Project' 2. Select both 'Update on launch' or 'Update on project update' 3. Save Note: error in console",test-file | source-file
6630,awx,https://github.com/ansible/awx/issues/6630,refresh token does not expire,"ISSUE TYPE - Bug Report  SUMMARY Using password grant type, refresh token does not expire according to `REFRESH_TOKEN_EXPIRE_SECONDS`.  ENVIRONMENT * AWX version: 10.0.0 * AWX install method: docker on linux * Operating System: CentOS v8 * Web Browser: Chrome  STEPS TO REPRODUCE Set the expiry times low from AWX GUI > Settings > System Confirm the settings from api  https://x.x.x.x/api/v2/settings/all/   ""OAUTH2_PROVIDER"": { ""ACCESS_TOKEN_EXPIRE_SECONDS"": 10, ""REFRESH_TOKEN_EXPIRE_SECONDS"": 10, ""AUTHORIZATION_CODE_EXPIRE_SECONDS"": 600 },  Create an Application from the GUI of Authorization Grant Type `Resource owner password-based`. Save a copy of the `clientId` and `clientSecret`. Create the access and refresh tokens using password grant: bash curl -v -k -X POST -d \ ""grant_type=password&username=someuser&password=somepassword&scope=read"" \ -u ""clientId:clientSecret"" https://x.x.x.x/api/o/token/ -i  Which returns json {""access_token"": ""Ma5cLFKYs1Q8iknITJjAe0VXJyiUVP"", ""expires_in"": 10, ""token_type"": ""Bearer"", ""scope"": ""read"", ""refresh_token"": ""IymTfQp0JtT3HtDUitoAj7eaxXr3zM""}  Wait at least 20 seconds and try use refresh token  curl -k -X POST -d \ ""grant_type=refresh_token&refresh_token=IymTfQp0JtT3HtDUitoAj7eaxXr3zM"" \ -u ""clientId:clientSecret"" https://x.x.x.x/api/o/token/ -i  That previous refresh token continues to generate new `access_token` and new `refresh_token` after 20 seconds. Even after I waited 12 hours it still worked. I also tried manually adding the settings to `/etc/tower/settings.py` of the docker container.  OAUTH2_PROVIDER = {'ACCESS_TOKEN_EXPIRE_SECONDS': 10, 'REFRESH_TOKEN_EXPIRE_SECONDS': 10, 'AUTHORIZATION_CODE_EXPIRE_SECONDS': 600}  and restarting the container.  EXPECTED RESULTS The refresh token should have failed to generate a new access token and returned an error message after more than 10 + 10 seconds.  ACTUAL RESULTS The last refresh token still generates a new `access_token` and new `refresh_token` after 20 seconds. I waited 12 hours and the last generated refresh token still works. So it appears to ignore the refresh token expiry time.  ADDITIONAL INFO Should the refresh token stay the same each time it is used? Current behavior is that a new refresh token is generated each time it is used. The previous one no longer works. So the way it works currently, refresh tokens are one-time use only.",test-file | source-file
13429,awx,https://github.com/ansible/awx/issues/13429,admin_role disassociated despite remove_admins = false,"Please confirm the following - [X] I agree to follow this project's [code of conduct](https://docs.ansible.com/ansible/latest/community/code_of_conduct.html). - [X] I have checked the [current issues](https://github.com/ansible/awx/issues) for duplicates. - [X] I understand that AWX is open source software provided for free and that I might not receive a timely response.  Bug Summary After upgrading from AWX 21.5.1 to 21.10.2 all organization admin roles were removed from the users' accounts. We're using LDAP with an organization map looking like this:  { ""Org1"": { ""admins"": false, ""remove_admins"": false, ""remove_users"": true, ""users"": [ ""CN="" ] } }  Users were manually granted the organization admin role. That had worked before, but after the upgrade, the role was removed from the users with the following activity message:  | 13.1.2023, 14:10:40 | system | disassociated Org1 admin_role from jdoe  And AWX was logging the following:  DEBUG [4ecb27399afb4cb7b9ad2fd5e666a8ca] awx.sso.backends LDAP adapter removing user jdoe permission of admin_role from organization Org1  I tried to remove '""admins"": false' from the config or replace it with an empty list ('admins"": [],') but that didn't change anything. ""None"" was not accepted by the form. According to the Automation Platform docs that should work: https://docs.ansible.com/automation-controller/4.2.1/html/administration/social_auth.html#organization-mapping This seems to be related to the following PR: https://github.com/ansible/awx/pull/12949  AWX version 21.10.2  Select the relevant components - [ ] UI - [X] API - [ ] Docs - [ ] Collection - [ ] CLI - [ ] Other  Installation method docker development environment  Modifications no  Ansible version 2.12.2  Operating system Debian 11  Web browser Firefox  Steps to reproduce 1) Add default LDAP settings 2) Create an organization map with ""admins: false"" 3) Add a user manually as organization admin to an organization 4) Login with that user and recognize that the admin_role was removed  Expected results The system doesn't remove the admin_role from the user.  Actual results The admin_role is removed from the user  Additional information _No response_",source-file
6267,awx,https://github.com/ansible/awx/issues/6267,Email Notification - started date is displayed as null when the approval node needs review,"When an approval node needs review and an email notification is setup, the email body contains null started, when the started field is actually set in the api Steps to reproduce: 1. Create a WFJT with approval node 2. associate it with Email notification template that will send notification on WF Approvals 3. launch the WFJT 4. wait for the email notification when the approval node needs review: Expected Results: the notification should be as follows:  The approval node ""approval node MediumResident"" needs review. This approval node can be viewed at: https://ec2-18-212-167-124.compute-1.amazonaws.com/#/workflows/86 { ""id"": 87, ""name"": ""approval node MediumResident\ufffd"", ""url"": ""https://ec2-18-212-167-124.compute-1.amazonaws.com/#/workflows/86"", ""created_by"": ""apurva"", ""started"": ""2020-03-11T21:21:19.898052+00:00"", ""finished"": null, ""status"": ""pending"", ""traceback"": """" }  Actual Results: the notification has null started field  The approval node ""approval node MediumResident"" needs review. This approval node can be viewed at: https://ec2-18-212-167-124.compute-1.amazonaws.com/#/workflows/86 { ""id"": 87, ""name"": ""approval node MediumResident\ufffd"", ""url"": ""https://ec2-18-212-167-124.compute-1.amazonaws.com/#/workflows/86"", ""created_by"": ""apurva"", ""started"": null, ""finished"": null, ""status"": ""pending"", ""traceback"": """" }",source-file
5093,awx,https://github.com/ansible/awx/issues/5093,[AWXKIT] Unable to provide extra_vars when launching workflow_job_template,"ISSUE TYPE - Bug Report  SUMMARY Using the AWXKIT CLI tool `awx` it is not possible to provide extra parameters like `scm_branch` or `extra_vars` when launching a workflow_job_template.  ENVIRONMENT * AWX version: 8.0.0 * AWX install method: docker on linux * Ansible version: 2.7.10 (Client) * Operating system: macOS Mojave  STEPS TO REPRODUCE Installed AWX 8.0.0 and created a workflow `sample_workflow`, which * has survey enabled: ""Ask for `foobar`"" * prompt for SCM branch when launching workflow Installed AWXKIT: pip install ""https://github.com/ansible/awx/archive/8.0.0.tar.gz#egg=awxkit&subdirectory=awxkit"" Tried to launch workflow: awx workflow_job_templates launch sample_workflow Result: {""variables_needed_to_start"": [""'foobar' value missing""]} Tried to extend request by using same parameter as for `tower-cli`: awx workflow_job_templates launch sample_workflow -e '{""foobar"": 12345}' After enabling debug output `awx` threw a warning, that `-e` is an `unrecognized argument`. Tried various arguments like * `--extra_vars` * `--extra-vars` * `-extra_vars` *  Same result.  EXPECTED RESULTS CLI tool should ask for missing configuration items like `extra_vars`, `scm_branch`, or at least provide documentation on how to launch this special kind of workflow_job_templates.  ACTUAL RESULTS See ""Steps to reproduce""",test-file | data-file | source-file
5081,awx,https://github.com/ansible/awx/issues/5081,Setting base url fail with error 400,"ISSUE TYPE - Bug Report  SUMMARY Whe have an internal dns with a domain like ""org.les800"" when i'm trying to set the base url of the tower host with something like ""tower.org.les800"", it fail with an error 400 and url not valid  ENVIRONMENT * AWX version: 8.0.0 * AWX install method: MrMee rpm * Ansible version: 2.8.6 * Operating System: CentOS 7.7 * Web Browser: Chrome latest  STEPS TO REPRODUCE try an url like http://tower.org.les800 in settings/system  EXPECTED RESULTS url for the base host set  ACTUAL RESULTS got url with the name of the server instead  ADDITIONAL INFORMATION <!-- Include any links to sosreport, database dumps, screenshots or other information. -->",source-file
6365,awx,https://github.com/ansible/awx/issues/6365,Fresh install Jobs not starting,"ISSUE TYPE - Bug Report Just did a fresh install of AWX 9.3.0 and none of the JOBs are being triggered. Project, Jobs, Ad-hoc jobs any jobs. after a few minutes it Times out with this error: > Call to /api/v2/ad_hoc_commands/1/relaunch/ failed. returned status: 504.  SUMMARY  ENVIRONMENT * AWX version: 9.3.0 * AWX install method: docker on centos 7 * Ansible version: 2.9.6 * Operating System: Centos 7 * Web Browser: Chrome  STEPS TO REPRODUCE try to execute ANY job such as project, ad-hoc script, etc..  EXPECTED RESULTS Jobs are stuck in starting mode they never start, please see screenshots below.  ADDITIONAL INFORMATION Please review images below: ![image](https://user-images.githubusercontent.com/20629911/77183907-3e375200-6a8c-11ea-9d0e-f1a7b2310b21.png) Image from Web continaer ![image](https://user-images.githubusercontent.com/20629911/77184346-ed742900-6a8c-11ea-93da-ea0380c10360.png) Image from TASK container ![image](https://user-images.githubusercontent.com/20629911/77186997-0a126000-6a91-11ea-803f-8017d8536abc.png) Thank you, HS",test-file | config-file
7243,awx,https://github.com/ansible/awx/issues/7243,500 error on unauthenticated HTTP GET to nested workflow endpoint,"ISSUE TYPE - Bug Report  SUMMARY Not a huge deal, just something I noticed while debugging some unrelated test failures: If you make a GET request to ` api/v2/workflow_job_template_nodes/n/create_approval_template/` when unauthenticated, you'll get a 500 instead of a 401. It seems to work fine if you're logged in.  STEPS TO REPRODUCE - make a workflow with nodes - log out - open browser dev tools and network tab - visit ` api/v2/workflow_job_template_nodes/n/create_approval_template/` in api browser  EXPECTED RESULTS 401  ACTUAL RESULTS 500  ADDITIONAL INFORMATION ![Screenshot from 2020-06-03 19-11-23](https://user-images.githubusercontent.com/9753817/83697865-08efca00-a5ce-11ea-9d0c-0173751041df.png)",source-file
9176,awx,https://github.com/ansible/awx/issues/9176,Optional textarea survey fields not optional when min length > 0,"<!-- Issues are for **concrete, actionable bugs and feature requests** only - if you're just asking for debugging help or technical support, please use: - http://webchat.freenode.net/?channels=ansible-awx - https://groups.google.com/forum/#!forum/awx-project We have to limit this because of limited volunteer time to respond to issues! -->  ISSUE TYPE - Bug Report  SUMMARY Text area survey fields that are optional (required checkbox unchecked) are not optional if the minimum length is greater than zero. Upon launching, an error message displays saying the field must be X characters. In versions <= 15.0.1, an optional field with a min length of one could be left blank and the variable would not be defined or set. In 17.0.0, awx attempts to define the variable regardless if the field is optional or not.  ENVIRONMENT * AWX version: 17.0.1 * AWX install method: openshift, minishift, docker on linux, docker for mac, boot2docker * Ansible version: X.Y.Z * Operating System: * Web Browser:  STEPS TO REPRODUCE Create a survey with an optional text area field Set the min length to 1 Attempt to launch the job leaving the survey field blank  EXPECTED RESULTS When min length is greater than zero and the field is optional, the variable should be left undefined when the survey field is blank and the job should launch.  ACTUAL RESULTS Launch fails with a message saying the field must be at least one character.  ADDITIONAL INFORMATION <!-- Include any links to sosreport, database dumps, screenshots or other information. -->",source-file
6342,awx,https://github.com/ansible/awx/issues/6342,Virtualenv in Kubernetes deployment doesn't work,"ISSUE TYPE - Bug Report  SUMMARY Error when applying `curl -X PATCH 'https://admin:mypass@myurl/api/v2/organizations/my_org/' \ -d '{""custom_virtualenv"": ""/opt/custom-venvs/my_env/""}' -H 'Content-Type:application/json'` `{""custom_virtualenv"":[""/opt/custom-venvs/my_env/ is not a valid virtualenv in /var/lib/awx/venv""]}`  ENVIRONMENT * AWX version: 9.3.0 * AWX install method: Kubernetes v1.15.3 * Ansible version: 2.9.5  STEPS TO REPRODUCE 1) Install AWX to kubernetes with similar config <details> <summary>inventory config</summary>  localhost ansible_connection=local ansible_python_interpreter=""/usr/bin/env python"" [all:vars] dockerhub_base=ansible kubernetes_context=mycontext kubernetes_namespace=awx kubernetes_ingress_hostname=myingress awx_task_hostname=awx awx_web_hostname=awxweb postgres_data_dir=""~/.awx/pgdocker"" host_port=80 host_port_ssl=443 docker_compose_dir=""~/.awx/awxcompose"" pg_hostname=mypghost pg_username=awx pg_password=mypgpass pg_database=awx pg_port=5432 rabbitmq_password=awxpass rabbitmq_erlang_cookie=cookiemonster admin_user=admin admin_password=myadminpass secret_key=mysecretkey logos/blob/master/TRADEMARKS.md  </details> <details> <summary>venv_vars.yaml</summary>   custom_venvs: - name: my_env python: python3 python_ansible_version: 2.9.6 python_modules: - dnspython - zabbix-api - jmespath  </details> 2) Assigning custom venv according to [this documentation](https://github.com/ansible/awx/blob/devel/docs/custom_virtualenvs.md) `curl -X PATCH 'https://admin:mypass@myurl/api/v2/settings/system/' \ -d '{""CUSTOM_VENV_PATHS"": [[""/opt/custom-venvs/my_env/""]}' -H 'Content-Type:application/json'` <details> <summary>answer</summary>  { ""ACTIVITY_STREAM_ENABLED"":true, ""ACTIVITY_STREAM_ENABLED_FOR_INVENTORY_SYNC"":false, ""ORG_ADMINS_CAN_SEE_ALL_USERS"":true, ""MANAGE_ORGANIZATION_AUTH"":true, ""TOWER_URL_BASE"":""myurl"", ""REMOTE_HOST_HEADERS"":[ ""HTTP_X_FORWARDED_FOR"" ], ""PROXY_IP_WHITELIST"":[ ], ""LICENSE"":{ }, ""REDHAT_USERNAME"":""admin"", ""REDHAT_PASSWORD"":""$encrypted$"", ""AUTOMATION_ANALYTICS_URL"":""https://example.org"", ""INSTALL_UUID"":""c1885c2a-d736-4023-9517-49929f8d77fa"", ""CUSTOM_VENV_PATHS"":[ ""/opt/custom-venvs/my_env/"" ], ""INSIGHTS_TRACKING_STATE"":false, ""BROKER_DURABILITY"":true, ""AUTOMATION_ANALYTICS_LAST_GATHER"":null, ""AUTOMATION_ANALYTICS_GATHER_INTERVAL"":14400 }  </details> 3) Assigning custom venv to organization and get and error `curl -X PATCH 'https://admin:mypass@myurl/api/v2/organizations/my_org/' \ -d '{""custom_virtualenv"": ""/opt/custom-venvs/my_env/""}' -H 'Content-Type:application/json'` <details> <summary>error</summary>  {""custom_virtualenv"":[""/opt/custom-venvs/my_env/ is not a valid virtualenv in /var/lib/awx/venv""]}  </details>  EXPECTED RESULTS `my_org` will use custom venv  ACTUAL RESULTS `my_org` raises an error when apllying custom venv  ADDITIONAL INFORMATION I've checked both containers `awx_web` and `awx_task`, they have `/opt/custom-venvs/my_env/` dir with working venv. Even if `PATCH api/v2/settings/system/` works properly (according to it answer, and i can see added venv in web interface), `GET api/v2/config/` still returns no venv's <details> <summary>api/v2/config/ answer</summary>  { ""time_zone"": ""UTC"", ""license_info"": { ""license_key"": ""OPEN"", ""valid_key"": true, ""compliant"": true, ""features"": { ""activity_streams"": true, ""ha"": true, ""ldap"": true, ""multiple_organizations"": true, ""surveys"": true, ""system_tracking"": true, ""rebranding"": true, ""enterprise_auth"": true, ""workflows"": true }, ""license_type"": ""open"" }, ""version"": ""9.3.0"", ""ansible_version"": ""2.9.5"", ""eula"": """", ""analytics_status"": ""off"", ""become_methods"": [ [ ""sudo"", ""Sudo"" ], [ ""su"", ""Su"" ], [ ""pbrun"", ""Pbrun"" ], [ ""pfexec"", ""Pfexec"" ], [ ""dzdo"", ""DZDO"" ], [ ""pmrun"", ""Pmrun"" ], [ ""runas"", ""Runas"" ], [ ""enable"", ""Enable"" ], [ ""doas"", ""Doas"" ], [ ""ksu"", ""Ksu"" ], [ ""machinectl"", ""Machinectl"" ], [ ""sesu"", ""Sesu"" ] ], ""project_base_dir"": ""/var/lib/awx/projects"", ""project_local_paths"": [], ""custom_virtualenvs"": [ ""/var/lib/awx/venv/ansible/"" ] }  </details> After finding that venv doesn't apply even in `system`, i've tried to make fresh install of awx on another kube cluster, with same results.",source-file
11229,awx,https://github.com/ansible/awx/issues/11229,Ansible collection - job_template module unable to update survey spec,"Please confirm the following - [X] I agree to follow this project's [code of conduct](http://docs.ansible.com/ansible/latest/community/code_of_conduct.html). - [X] I have checked the [current issues](https://github.com/ansible/awx/issues) for duplicates. - [X] I understand that AWX is open source software provided for free and that I am not entitled to status updates or other assurances.  Summary Using the job_template module, I am unable to update/add/delete ""survey_spec.spec"", when I only change the ""survey_spec.spec"" and nothing else. If some other JobTemplate property changes, everthing works fine and the survey will update as well.  AWX version 19.2.2  Installation method kubernetes  Modifications no  Ansible version _No response_  Operating system _No response_  Web browser _No response_  Steps to reproduce only add a single survey question with the job_template module to an existing job template  Expected results survey should have a new survey question and the task should be marked as changed  Actual results The new question is in the task output, but it is not added to the job template and the task is not marked as changed.  Additional information _No response_",source-file
10681,awx,https://github.com/ansible/awx/issues/10681,API strings are not being compiled,"Summary In our move to ui_next, the `make languages` target was no longer called when compiling the UI. This means that the API strings (think help_text in OPTIONS requests) are no longer being compiled and thus are not displayed in the client's browser.  AWX version devel  Web browser Chrome  Steps to reproduce 1. Start the dev env - `make docker-compose` 2. Change your browser preferences to default to `ja` as your locale 3. Navigate to `api/v2/settings/authentication` and click OPTIONS to see the untranslated strings 4. Run the following to compile API strings:  $ python tools/scripts/compilemessages.py  5. Restart your containers 6. Observe the strings are now translated  Expected results ![image](https://user-images.githubusercontent.com/11698892/126224196-f76da94a-f6ca-4306-9187-b2db8326ab5c.png)  Actual results ![image](https://user-images.githubusercontent.com/11698892/126224326-2461395d-6f14-4eaf-b34b-58a2108c0354.png) Sidenote, there is also a `fr` string that is throwing a compilation error which I will fix.  Additional information We may also be able to lose our `compilemessages.py` file in favor of using the django build-in command.",config-file | data-file | source-file
6485,awx,https://github.com/ansible/awx/issues/6485,modal searches shouldn't be case-sensitive,"ISSUE TYPE - Bug Report  SUMMARY Tried to search for an Organization when creating a user. ""default"" doesn't return the ""Default"" organization. This should be case-insensitive. in addition, this ticket should involve going through similar searches and ensuring that they are case-insensitive.",source-file
13597,awx,https://github.com/ansible/awx/issues/13597,Unable to use CCP lookup plugin with empty webservice_id,"Please confirm the following - [X] I agree to follow this project's [code of conduct](https://docs.ansible.com/ansible/latest/community/code_of_conduct.html). - [X] I have checked the [current issues](https://github.com/ansible/awx/issues) for duplicates. - [X] I understand that AWX is open source software provided for free and that I might not receive a timely response.  Bug Summary When job uses the `CyberArk Central Credential Provider Lookup` credential plugin with an empty web service id, it fails with the exception:  Traceback (most recent call last): File ""/awx_devel/awx/main/tasks/jobs.py"", line 508, in run args = self.build_args(self.instance, private_data_dir, passwords) File ""/awx_devel/awx/main/tasks/jobs.py"", line 941, in build_args ssh_username = creds.get_input('username', default='') File ""/awx_devel/awx/main/models/credential/__init__.py"", line 275, in get_input return self._get_dynamic_input(field_name) File ""/awx_devel/awx/main/models/credential/__init__.py"", line 309, in _get_dynamic_input return input_source.get_input_value() File ""/awx_devel/awx/main/models/credential/__init__.py"", line 1250, in get_input_value return backend(**backend_kwargs) File ""/awx_devel/awx/main/credential_plugins/aim.py"", line 73, in aim_backend webservice_id = kwargs['webservice_id'] KeyError: 'webservice_id'  The issue is only reproducible if we create a CCP lookup credential using API and we do not provide the `webservice_id` key as the input. If you create CCP lookup with UI - everything works fine.  AWX version devel  Select the relevant components - [ ] UI - [X] API - [ ] Docs - [ ] Collection - [ ] CLI - [ ] Other  Installation method docker development environment  Modifications no  Ansible version _No response_  Operating system _No response_  Web browser _No response_  Steps to reproduce 1. Create CyberArk Central Credential Provider Lookup credential. Do not provide the WebService ID value, keep it empty. I used API to create credetnail and the webservice_id was missing in the inputs:  inputs = { 'url': url, 'app_id': app_id, 'client_key': client_key, 'client_cert': client_cert, 'verify': verify } payload = factories.credential.payload( name=fauxfactory.gen_utf8(), description=fauxfactory.gen_utf8(), credential_type=cred_type, inputs=inputs )  2. Create Machine credential that uses the CCP lookup credential. Set proper Object query. 3. Create Job Template that uses this credential. Run the job.  Expected results The lookup should use default webservice id: `AIMWebService`  Actual results Exception occured. See description.  Additional information _No response_",source-file
4910,awx,https://github.com/ansible/awx/issues/4910,jobs still dispatched to container group even if ResourceQuota will cause them to be rejected + fail immediately,"ISSUE TYPE - Bug Report  SUMMARY <!-- Briefly describe the problem. --> This is a known issue of #4189 that will be resolved in follow up PR. _IF the user sets up the namespace that they use for the Container Group with a ResourceQuota_ @one-t has confirmed that when a Container Group has exceeded capacity (e.g. has met its ResourceQuota) , jobs will still be sent to it because of lack of capacity calculation for ContainerGroups. The jobs then immediately fail becaues of a `403` response from kubernetes API instead of expected behavior of waiting to dispatch job until an instance group has capacity to run it. This means in a Tower environment that is saturated with jobs such that all other resources available to a new job are out of capacity, the Container Group will still appear to have capacity even if it itself has also exceeded resource limits. This will cause the job and any future jobs dispatched to the CG to immediately fail until resources are freed up.  STEPS TO REPRODUCE <!-- Please describe exactly how to reproduce the problem. --> Create a ResourceQuota in the namespace you use to set up a ContainerGroup Associate the ContainerGroup with a JT Launch more jobs that your ResourceQuota will allow  EXPECTED RESULTS <!-- What did you expect to happen when running the steps above? --> Later jobs will go into pending until resources are available  ACTUAL RESULTS <!-- What actually happened? --> Later jobs fail immediately with `403` from kubernetes API  ADDITIONAL INFORMATION <!-- Include any links to sosreport, database dumps, screenshots or other information. --> @one-t can provide more details about how to configure your namespace ResourceQuota",source-file
11017,awx,https://github.com/ansible/awx/issues/11017,Unable to use ansible_facts for smart inventory source,"Please confirm the following - [X] I agree to follow this project's [code of conduct](http://docs.ansible.com/ansible/latest/community/code_of_conduct.html). - [X] I have checked the [current issues](https://github.com/ansible/awx/issues) for duplicates. - [X] I understand that AWX is open source software provided for free and that I am not entitled to status updates or other assurances.  Summary One older article describes how ansible_facts can be used to create smart inventory within AWX/Ansible tower: https://www.ansible.com/blog/ansible-tower-advanced-smart-inventory-usage Unfortunately this feature seems to be broken or not properly documented, as API doesn't seem to be recognizing field ansible_facts. GET to /api/v2/hosts/?ansible_facts.ansible_distribution_version=18.04  HTTP 400 Bad Request Allow: GET, POST, HEAD, OPTIONS Content-Type: application/json Vary: Accept X-API-Node: awx-6bd564b87c-26bv6 X-API-Product-Name: AWX X-API-Product-Version: 19.3.0 X-API-Time: 0.005s { ""error"": ""Host has no field named 'ansible_facts.ansible_distribution_version'"" }   AWX version 19.3.0  Installation method kubernetes  Modifications no  Ansible version _No response_  Operating system _No response_  Web browser Firefox  Steps to reproduce 1. Go to Inventory 2. Add - Smart Inventory 3. Try to filter using ""Smart host filter"" field Alternative: 1. Go to /api/v2/hosts/ 2. try using query string with desired field (eg /api/v2/hosts/?ansible_facts.ansible_distribution_version=18.04)  Expected results API queries facts and displays hosts that only match those facts  Actual results API complains that the field is incorrect  Additional information Using any top-level field works normally: eg. /api/v2/hosts/?id=302 (if host with ID 302 in AWX exists) returns properties for that host. It would appear that since the ansible_facts is just a reference to additional page that the API is not able to query it.",test-file | data-file | source-file
10152,awx,https://github.com/ansible/awx/issues/10152,AWX 19.1: management jobs can not be scheduled,"<!-- Issues are for **concrete, actionable bugs and feature requests** only - if you're just asking for debugging help or technical support, please use: - http://webchat.freenode.net/?channels=ansible-awx - https://groups.google.com/forum/#!forum/awx-project We have to limit this because of limited volunteer time to respond to issues! -->  ISSUE TYPE - Bug Report  SUMMARY I'm trying to edit the schedules for the management jobs, but the (existing) schedules are prefilled with values that can't be saved??  ENVIRONMENT * AWX version: 19.1.0 * AWX install method: k3s on debian buster, deployed with awx-operator 0.9.0 * Ansible version: n/a at this point * Operating System: whatever is used inside the containers? * Web Browser: any  STEPS TO REPRODUCE 1. click ""management jobs"" 2. click any one job of the four 3. edit or create a schedule 4. observe ""start time"" is prefilled with ""NaN-NaN-NaNTNaN:NaN:NaN"" even if the job had been edited and/or run before already 5. observe how it is impossible to save the schedule unless you manually change the start time to some value that makes sense  EXPECTED RESULTS I'd expect the ""start time"" to be either 01-01-1970T00:00:00 or the time the AWX instance was deployed before its first run, then the time&date of the first run  ACTUAL RESULTS Schedule can not be saved.  ADDITIONAL INFORMATION",source-file | test-file | other-file
11442,awx,https://github.com/ansible/awx/issues/11442,Workflow Visualizer making endless API requests with no result,"Please confirm the following - [X] I agree to follow this project's [code of conduct](http://docs.ansible.com/ansible/latest/community/code_of_conduct.html). - [X] I have checked the [current issues](https://github.com/ansible/awx/issues) for duplicates. - [X] I understand that AWX is open source software provided for free and that I am not entitled to status updates or other assurances.  Summary When a user creates a workflow and saves and is redirected to the visualizer screen, API requests happen endlessly, with no result. Note: I am able to recreate this on an ec2 instance as well as a local build.  AWX version devel  Installation method docker on linux  Modifications no  Ansible version _No response_  Operating system Fedora 35  Web browser Chrome  Steps to reproduce 1. access the templates page. 2. create a new workflow template. 3. when the redirect to the visualizer happens, you will see the problem. https://user-images.githubusercontent.com/63685497/145466510-0b5de590-ee87-446e-9b58-058ce7bca611.mp4  Expected results user would be able to create, save, and launch a workflow.  Actual results the visualizer is not working properly and submits endless API requests.  Additional information _No response_",source-file
6366,awx,https://github.com/ansible/awx/issues/6366,[awx-pf] Can't edit job templates,"ISSUE TYPE - Bug Report  SUMMARY Tried to edit the name and description of a job template. It doesn't change when I click save. Reproduction: 1. Make a job template 2. Try to edit various things about it. pretty straightforward. I don't see any 400s or anything, though feel free to poke around and see what you find.",test-file | config-file
4781,awx,https://github.com/ansible/awx/issues/4781,workflow_job_template_nodes POST authentication issuees,"ISSUE TYPE - Bug Report  SUMMARY When trying to POST to workflow_job_template_nodes using basic auth and/or token-auth AWX replies with 401 failure. `awx_web | 2019-09-19 08:40:32,754 WARNING awx.api.generics status 401 received by user AnonymousUser attempting to access /api/v2/workflow_job_template_nodes/ from XXX.XXX.XXX.XXX awx_web | 2019-09-19 08:40:32,780 WARNING django.request Bad Request: /api/v2/workflow_job_template_nodes/ awx_web | 2019-09-19 08:40:32,780 WARNING django.request Bad Request: /api/v2/workflow_job_template_nodes/ awx_web | [pid: 153|app: 0|req: 57/208] XXX.XXX.XXX.XXX () {38 vars in 568 bytes} [Thu Sep 19 08:40:32 2019] POST /api/v2/workflow_job_template_nodes/ => generated 140 bytes in 74 msecs (HTTP/1.1 400) 8 headers in 246 bytes (1 switches on core 0) awx_web | XXX.XXX.XXX.XXX - - [19/Sep/2019:08:40:32 +0000] ""POST /api/v2/workflow_job_template_nodes/ HTTP/1.1"" 400 140 ""-"" ""curl/7.54.0"" ""-""`  ENVIRONMENT * AWX version: 7.0.0 * AWX install method: docker on linux * Ansible version: 2.6 * Operating System: CentOS * Web Browser: Curl 7.54  STEPS TO REPRODUCE 0. nodes.json `{ { ""type"": ""workflow_job_template_node"", ""workflow_job_template"": { ""id"": 1238, ""name"": ""DNS WF"", ""description"": """" }, ""unified_job_template"": { ""id"": 820, ""name"": ""template-name"", ""unified_job_type"": ""job"" } ""extra_data"": {}, ""inventory"": null, ""scm_branch"": null, ""job_type"": null, ""job_tags"": """", ""skip_tags"": null, ""limit"": """", ""diff_mode"": null, ""verbosity"": null, ""workflow_job_template"": 1238, ""unified_job_template"": 820, ""success_nodes"": [], ""failure_nodes"": [], ""always_nodes"": [] } } ` 1. `curl -vvv -f -H 'Authorization: Token XXXX' -u username:password -H 'Content-Type: application/json' -XPOST http://awxhost/api/v2/workflow_job_template_nodes/ -d @nodes.json`  EXPECTED RESULTS Creation of nodes for related workflow  ACTUAL RESULTS Authorization failure. Client:  * The requested URL returned error: 400 Bad Request * stopped the pause stream! 100 706 0 0 100 706 0 7887 --:--:-- --:--:-- --:--:-- 7932 * Closing connection 0 curl: (22) The requested URL returned error: 400 Bad Request  Server: ``awx_web | 2019-09-19 08:40:32,754 WARNING awx.api.generics status 401 received by user AnonymousUser attempting to access /api/v2/workflow_job_template_nodes/ from XXX.XXX.XXX.XXX awx_web | 2019-09-19 08:40:32,780 WARNING django.request Bad Request: /api/v2/workflow_job_template_nodes/ awx_web | 2019-09-19 08:40:32,780 WARNING django.request Bad Request: /api/v2/workflow_job_template_nodes/ awx_web | [pid: 153|app: 0|req: 57/208] XXX.XXX.XXX.XXX () {38 vars in 568 bytes} [Thu Sep 19 08:40:32 2019] POST /api/v2/workflow_job_template_nodes/ => generated 140 bytes in 74 msecs (HTTP/1.1 400) 8 headers in 246 bytes (1 switches on core 0) awx_web | XXX.XXX.XXX.XXX - - [19/Sep/2019:08:40:32 +0000] ""POST /api/v2/workflow_job_template_nodes/ HTTP/1.1"" 400 140 ""-"" ""curl/7.54.0"" ""-""``  ADDITIONAL INFORMATION",source-file
8838,awx,https://github.com/ansible/awx/issues/8838,[ui_next] Inventory update Delete hits wrong endpoint,"ISSUE TYPE - Bug Report  SUMMARY Inventory update Delete hits wrong endpoint. I try to delete the SCM inventory update from the job page. It fails with an error about the inventory, but it shouldnt be deleting the inventory, it should only be deleting the update.  ENVIRONMENT * AWX version: 12/10  MORE INFO Also, thats not the right number for the inventory, 66 is the ID of the inventory update. ![Screen Shot 2020-12-10 at 3 52 00 PM](https://user-images.githubusercontent.com/12446869/101828548-b30d5900-3aff-11eb-8a7a-d10208387cbd.png)",test-file | source-file
4531,awx,https://github.com/ansible/awx/issues/4531,Unable to remove customized messages from notification template,"ISSUE TYPE - Bug Report  SUMMARY Unable to remove customized messages from notification template  STEPS TO REPRODUCE 1. Create a Slack notification with customized notification messages. 2. Edit Slack notification from step 1 and remove customized notification messages via toggle and save Note: 500 error  EXPECTED RESULTS 1. Default messages used and customize message toggle disabled  ACTUAL RESULTS HTTP 500 from API  ADDITIONAL INFORMATION <img width=""1497"" alt=""Screen Shot 2019-08-20 at 12 43 30 PM"" src=""https://user-images.githubusercontent.com/12446869/63366604-222dcf80-c348-11e9-80b7-a53a717a4b9f.png"">",source-file
5028,awx,https://github.com/ansible/awx/issues/5028,500 Error when creating notification templates with bad message format,"shell $ awx notification_templates create --name ""Testing 123"" --organization Default --notification_type webhook --messages '{""success"": ""500 error""}' --notification_configuration '{""url"": ""http://example.org"", ""headers"": {}}'  <img width=""932"" alt=""image"" src=""https://user-images.githubusercontent.com/214912/67009102-e2ba0000-f0b8-11e9-9346-816dea7ffa02.png"">",source-file
5744,awx,https://github.com/ansible/awx/issues/5744,More Helpful Error Message on api/v2/inventories Endpoint,"ISSUE TYPE - Bug Report  SUMMARY When trying to change a regular inventory into a ""smart"" inventory, the `PUT` and `PATCH` both error out (as they should), but the error message is not very informative. Please see screenshots below for both PUT and PATCH errors: <img width=""1048"" alt=""PUTNotAllowed"" src=""https://user-images.githubusercontent.com/28930622/72933561-f3b98380-3d2f-11ea-9269-7320367cabb3.png""> <img width=""1033"" alt=""PATCHNotAllowed"" src=""https://user-images.githubusercontent.com/28930622/72933566-f6b47400-3d2f-11ea-8540-147b2da53dc8.png""> It would be nice if the error was something more along the lines of `'You cannot turn a regular inventory into a ""smart"" inventory.'`  ENVIRONMENT * AWX version: 9.1.1 * AWX install method: docker for mac * Web Browser: Chrome  STEPS TO REPRODUCE Navigate to a pre-existing _regular_ inventory endpoint via `api/v2/inventories/[id]`, then try to `PUT` or `PATCH` to try to make it into a ""smart"" inventory:  { ""name"": ""[inventory_name]"", ""description"": """", ""organization"": [inventory_id], ""kind"": ""smart"", ""host_filter"": null, ""variables"": """", ""insights_credential"": null }   EXPECTED RESULTS An error message that tells the user that a regular inventory can't be turned into a smart inventory.  ACTUAL RESULTS  { ""detail"": ""Method \""PATCH\"" not allowed."" }",source-file | test-file | data-file | documentation-file
5478,awx,https://github.com/ansible/awx/issues/5478,Deleting Oauth token with itself throws 500 error,1. create an Oauth token for a user 2. delete the Oauth token using itself as the Bearer `curl -k -H 'Authorization: Bearer r8jwGD25D9rIDQ6F1lqcRwrejR9gR7' -X DELETE https://localhost/api/v2/tokens/21/` 3. Observe HTTP 500,source-file
6653,awx,https://github.com/ansible/awx/issues/6653,Machine credentials are refused by tower_job_template,"ISSUE TYPE - Bug Report  SUMMARY Can't create job template with tower_job_template because of credentials. Machine credentials (SSH) are refused.  ENVIRONMENT * AWX version: 10.0.0 * AWX install method: docker on linux * Ansible version: 2.9.5 * Operating System: Debian Buster * Web Browser: Firefox * AWX collection: 10.0.0  STEPS TO REPRODUCE  - name: Creation templates tower_job_template: name: ""{{ item.name }}"" playbook: ""{{ item.playbook }}"" inventory: ""{{ awx_inventory }}"" project: ""{{ awx_inventory }}"" credentials: - ""ssh-root-key"" survey_enabled: yes survey_spec: name: ""survey {{ item.name }}"" description: """" spec: ""{{ item.survey_spec }}"" tower_host: ""{{ tower_host }}"" tower_username: ""{{ tower_username }}"" tower_password: ""{{ tower_password }}"" validate_certs: False with_items: ""{{ awx_job_templates }}"" loop_control: label: ""{{ item.name }}"" tags: templates   EXPECTED RESULTS Template created  ACTUAL RESULTS  { ""ansible_loop_var"":""item"", ""changed"":false, ""item"":{ ""job_type"":""run"", ""name"":""Provisionning TWIN"", ""playbook"":""play-provisioning_twin.yml"", }, ""msg"":""Failed to add credential to job template: The Tower server claims it was sent a bad request.\n\nPOST https://localhost/api/v2/job_templates/9/extra_credentials/\nParams: None\nData: {\""id\"": 3, \""associate\"": true}\n\nResponse: {\""error\"":\""Extra credentials must be network or cloud.\""}"" }   ADDITIONAL INFORMATION `credential: ""ssh-root-key""` kinda works, but according to the documentation it is deprecated. And when I go into the web interface, the credentials field is empty.",test-file | source-file
6362,awx,https://github.com/ansible/awx/issues/6362,Can't Edit JT with no Inventory,"ISSUE TYPE - Bug Report  SUMMARY Can't Edit JT with no Inventory but Inventory Prompt on Launch  ENVIRONMENT * AWX version: 2.9 * AWX install method: docker for mac * Ansible version: 9.2 * Operating System: Mojave * Web Browser: Chrome  STEPS TO REPRODUCE Create a JT with no inventory, but click the Prompt On Launch checkbox. Go back and edit that inventory, but keep the inventory field empty and prompt on launch for it checked.  EXPECTED RESULTS The JT can be saved  ACTUAL RESULTS See that the JT can't be saved and returns a 400 error",test-file | source-file
12992,awx,https://github.com/ansible/awx/issues/12992,scm_url doesn't allow [IPV6]:portnum format,"Please confirm the following - [X] I agree to follow this project's [code of conduct](https://docs.ansible.com/ansible/latest/community/code_of_conduct.html). - [X] I have checked the [current issues](https://github.com/ansible/awx/issues) for duplicates. - [X] I understand that AWX is open source software provided for free and that I might not receive a timely response.  Bug Summary IPv6 addresses like `http://user:pass@[4444:5555:6666:7777:8888:11]:3000/sbf/foster.git` throws an error when attempting to sync a project with that scm_url `update_scm_url` is where the traceback is the issue is that we strip down the address and reform it, but when reforming we don't add the brackets back in. `netloc = u'@'.join(filter(None, [netloc, parts.hostname]))` parts.hostname does not include the brackets if the original url had brackets around the hostname, then we should re-add them back in  AWX version awx: 21.5.1.dev244+g5b5aac675b.d20221003  Select the relevant components - [ ] UI - [X] API - [ ] Docs - [ ] Collection - [ ] CLI - [ ] Other  Installation method docker development environment  Modifications no  Ansible version _No response_  Operating system _No response_  Web browser _No response_  Steps to reproduce create project with scm_url `http://user:pass@[4444:5555:6666:7777:8888:11]:3000/sbf/foster.git` attempt to launch a job  Expected results job runs  Actual results Traceback (most recent call last): File ""/awx_devel/awx/main/utils/common.py"", line 249, in update_scm_url if scm_type not in ('git', 'svn', 'insights', 'archive'): File ""/usr/lib64/python3.9/urllib/parse.py"", line 178, in port raise ValueError(message) from None ValueError: Port could not be cast to integer value as '5555:6666:7777:8888:11:3000' During handling of the above exception, another exception occurred: Traceback (most recent call last): File ""/awx_devel/awx/main/tasks/jobs.py"", line 512, in run self.build_extra_vars_file(self.instance, private_data_dir) File ""/awx_devel/awx/main/tasks/jobs.py"", line 1228, in build_extra_vars_file scm_url, extra_vars_new = self._build_scm_url_extra_vars(project_update) File ""/awx_devel/awx/main/tasks/jobs.py"", line 1203, in _build_scm_url_extra_vars scm_url = update_scm_url(scm_type, scm_url, scp_format=True) File ""/awx_devel/awx/main/utils/common.py"", line 249, in update_scm_url if scm_type not in ('git', 'svn', 'insights', 'archive'): ValueError: Invalid git URL  Additional information _No response_",test-file | source-file
4907,awx,https://github.com/ansible/awx/issues/4907,inventory updates + project updates deployed to container groups don't report execution node,"ISSUE TYPE - Bug Report  SUMMARY <!-- Briefly describe the problem. --> This is a known issue of https://github.com/ansible/awx/pull/4189 that will be resolved in follow up PR. Inventory updates need to run on a Tower node, and this does happen even when ""deployed"" to a Container Group. The problem is, there is no way to figure out from API what tower node it was deployed to. This is connected to the fact that there is no designated ""controller node"" for the Container Groups, solving that may help this. Regardless, currently if an inventory update is ""deployed"" to a container group it will show the container group on the inventory update, but no execution node or controller node, so it is unclear where the update actually ran.  STEPS TO REPRODUCE <!-- Please describe exactly how to reproduce the problem. --> 1) create a working Container Group 2) Create an organization 3) Assign Container Group to organization as only instance group 4) create inventory with inventory source OR create project 5) launch inventory update or project update  EXPECTED RESULTS <!-- What did you expect to happen when running the steps above? --> One of the Tower nodes is shown as execution node  ACTUAL RESULTS <!-- What actually happened? --> No execution node, only container group shown",source-file
10879,awx,https://github.com/ansible/awx/issues/10879,Errors caused by Social Auth Organization and Team Mapping; Users unable to login,"Please confirm the following - [X] I agree to follow this project's [code of conduct](http://docs.ansible.com/ansible/latest/community/code_of_conduct.html). - [X] I have checked the [current issues](https://github.com/ansible/awx/issues) for duplicates. - [X] I understand that AWX is open source software provided for free and that I am not entitled to status updates or other assurances.  Summary Attempting to configure Social Organization/Team Mapping prevents social-auth users from logging in. `awx-web` and postgres show errors. If ORGANIZATION_MAP and TEAM_MAP are reverted to default/empty, user is able to login.  AWX version 19.2.2  Installation method kubernetes  Modifications yes  Ansible version _No response_  Operating system _No response_  Web browser Chrome  Steps to reproduce 1. Fresh AWX 19.2.2 installation via awx-operator (0.12.0) with `create_preload_data: 'false'` 2. Log in as Admin; Configure Github Organization OAuth2 Social Auth ( do not configure org/team maps ) json { ""SOCIAL_AUTH_GITHUB_ORG_CALLBACK_URL"": ""https://my-awx-install.com/sso/complete/github-org/"", ""SOCIAL_AUTH_GITHUB_ORG_KEY"": ""<redacted>"", ""SOCIAL_AUTH_GITHUB_ORG_SECRET"": ""$encrypted$"", ""SOCIAL_AUTH_GITHUB_ORG_ORGANIZATION_MAP"": null, ""SOCIAL_AUTH_GITHUB_ORG_TEAM_MAP"": null }  3. Validate Step 2 configs by logging in via Github Org Social Auth 4. Log out. 5. Login as Admin; Configure Org/Team Maps (I tried this in both the Global and GitHub Org specific configs) json { ""SOCIAL_AUTH_GITHUB_ORG_CALLBACK_URL"": ""https://my-awx-install.com/sso/complete/github-org/"", ""SOCIAL_AUTH_GITHUB_ORG_KEY"": ""<redacted>"", ""SOCIAL_AUTH_GITHUB_ORG_SECRET"": ""$encrypted$"", ""SOCIAL_AUTH_GITHUB_ORG_NAME"": ""MyOrg"", ""SOCIAL_AUTH_GITHUB_ORG_ORGANIZATION_MAP"": { ""MyOrg"": { ""users"": [ ""me@example.com"" ], ""admins"": [ ""admin@example.com"" ], ""remove_users"": true, ""remove_admins"": true } }, ""SOCIAL_AUTH_GITHUB_ORG_TEAM_MAP"": { ""operations-team"": { ""remove"": true, ""organization"": ""MyOrg"", ""users"": [ ""me@example.com"" ] } } }  6. Attempt to login as user; Get redirected to login page; Observe error awx-web and postgres error logs  Expected results Organizations specified by valid Social Auth Org map(s) are created automatically Teams specified by valid Social Auth Team map(s) are created automatically Users are able to login as specified by Social Auth Org/Team maps  Actual results User was not able to login following Org/Map configuration. Organization and Teams were not created on our behalf. `postgres` errors bash 2021-08-13 21:39:42.438 UTC [2886] STATEMENT: INSERT INTO ""main_organizationgalaxycredentialmembership"" (""organization_id"", ""credential_id"", ""position"") VALUES (1, NULL, NULL) RETURNING ""main_organizationgalaxycredentialmembership"".""id"" 2021-08-13 21:39:42.438 UTC [2886] ERROR: null value in column ""credential_id"" violates not-null constraint 2021-08-13 21:39:42.438 UTC [2886] DETAIL: Failing row contains (1, null, null, 1).  `awx-web` errors  2021-08-13 21:39:42,440 ERROR [c6496ec03db747d3a7800f653acd316b] social null value in column ""credential_id"" violates not-null constraint DETAIL: Failing row contains (1, null, null, 1). .   Additional information * Installed via awx-operator with `create_preload_data: false` * Prior to opening this issue, I've also attempted this against 19.3.0 to no success.",source-file
10008,awx,https://github.com/ansible/awx/issues/10008,awx.awx.tower_job_launch tags are not properly passed to API,"ISSUE TYPE - Bug Report  SUMMARY If you are using awx.awx.tower_job_launch to launch a job-/workflowtemplate in AWX and you pass tags to the job launch they will be ignored. Against expectations all tasks are executed not only those with the provided tags  ENVIRONMENT * AWX version: Tower 3.8.2 * Ansible version: Ansible 2.9.13 * Operating System: RHEL 8.3  STEPS TO REPRODUCE Create a playbook similar to this:  - hosts: localhost gather_facts: no environment: TOWER_USERNAME: ""<<INPUT TOWER USERNAME HERE>>"" TOWER_HOST: ""<<INPUT TOWER HOST HERE>>"" TOWER_PASSWORD: ""<<INPUT TOWER USER PASSWORD HERE>>"" vars: ansible_connection: local tasks: - name: Launch a job template with a tag on remote Tower instance awx.awx.tower_job_launch: job_template: ""test_template"" inventory: ""test_inventory"" tags: - example_tag  Create a second playbook named ""test_template"" with two random tasks. One needs to be tagged with ""example_tag""  EXPECTED RESULTS Only the task tagged with ""example_tag"" will be executed  ACTUAL RESULTS All tasks will be executed  ADDITIONAL INFORMATION The error occurs because [tower_job_launch.py](https://github.com/ansible/awx/blob/devel/awx_collection/plugins/modules/tower_job_launch.py) passes the wrong post data to the api. The tags have to be provided under key ""job_tags"". This can be found in [API documentation](https://docs.ansible.com/ansible-tower/latest/html/towerapi/api_ref.html#/Job_Templates/Job_Templates_job_templates_launch_read). Certainly the module passes the tags with the key ""tags"" which is wrong I think the follwing code needs to be adjusted: https://github.com/ansible/awx/blob/devel/awx_collection/plugins/modules/tower_job_launch.py#L184 The correct line should be: ` optional_args['job_tags'] = module.params.get('tags')` I will test the suggestion on monday and report the result.",test-file | source-file
6520,awx,https://github.com/ansible/awx/issues/6520,Logout button on the API for ui-next does not work,"ISSUE TYPE - Bug Report  SUMMARY Click on the logout button on the API for ui-next makes a get request instead of a post request, due to which an error is thrown  STEPS TO REPRODUCE 1. https://localhost:3000/api 2. click on the logout button <img width=""352"" alt=""Screen Shot 2020-04-01 at 10 28 17 AM"" src=""https://user-images.githubusercontent.com/11617351/78149937-98c59c00-7404-11ea-9a9d-f954d1e9e24f.png"">  EXPECTED RESULTS The logout should be successfull  ACTUAL RESULTS An error is thrown: <img width=""533"" alt=""Screen Shot 2020-04-01 at 10 28 34 AM"" src=""https://user-images.githubusercontent.com/11617351/78149948-9c592300-7404-11ea-8be8-cb87c67542cf.png"">",test-file
6225,awx,https://github.com/ansible/awx/issues/6225,ask_variables_on_launch issue on AWX,"ISSUE TYPE ask_variables_on_launch is set to true still getting error as undefined variable.  SUMMARY I have created a Job template via API and set the ask_variables_on_launch value to true. Though setting the value as true, playbook fails during execution, saying 'undefined variable'  ENVIRONMENT * AWX version: 9.2.0 * Tower CLI 3.3.8 * API v2 * AWX install method: Installation without Docker on CentOS7 * Ansible version: 2.9.5 * Operating System: CentOS Linux release 7.7.1908 (Core) * Web Browser: Google Chrome Version 80.0.3987.132 (Official Build) (64-bit)  STEPS TO REPRODUCE >> Created a Job Template for sample. >> Verify the values of the sample job template for 'project, inventory, playbook' attributes, and its corresponding values. >> With the values observed from the sample job template, create a new job template via APIv2 and set the value of ""ask_variables_on_launch to true"" * API URL: * http://awx-server-ip/api/v2/job_templates/  EXPECTED RESULTS Being set the value of 'ask_variables_on_launch' to true, I should be able to execute the playbook by passing extra variable during launch of the playbook and via Survey as well.  ACTUAL RESULTS ""msg"": ""The task includes an option with an undefined variable. The error was: 'ansible.utils.unsafe_proxy.AnsibleUnsafeText object' has no attribute 'it_user'\n\nThe error appears to be in '/tmp/awx_25_ahs6_izp/project/useradd_IT.yml': line 7, column 7, but may\nbe elsewhere in the file depending on the exact syntax problem.\n\nThe offending line appears to be:\n\n tasks:\n - name: Adding users\n ^ here\n"", ""_ansible_no_log"": false --The same error occurred when the value of 'ask_variables_on_launch' set as false.  ADDITIONAL INFORMATION ![image](https://user-images.githubusercontent.com/47471901/76210019-3d4f2680-6229-11ea-95f8-04dc9ac4f84d.png) ![image](https://user-images.githubusercontent.com/47471901/76210151-87380c80-6229-11ea-8e8e-2359422c1276.png)",source-file
5964,awx,https://github.com/ansible/awx/issues/5964,awx kit provides a bad error message,"ISSUE TYPE - Bug Report  SUMMARY When authentication fails awx kit gives a cryptic error message  ENVIRONMENT * AWX version: devel * AWX install method: mac * Ansible version: 2.8.2 * Operating System: mac * Web Browser: N/A  STEPS TO REPRODUCE Attempt to login to awx with bad credentials.  EXPECTED RESULTS > Unauthorized: Unauthorized (401) received - {'detail': 'Authentication credentials were not provided. To establish a login session, visit /api/login/.'}  ACTUAL RESULTS > TypeError: '>=' not supported between instances of 'Unauthorized' and 'int'  ADDITIONAL INFORMATION > akit --base-url httsp://some-awx -c ~/creds/credentials.vault -f load_resources.py -x",source-file
6433,awx,https://github.com/ansible/awx/issues/6433,Can't save the modal when adding a team role to an organization,"ISSUE TYPE - Bug Report  SUMMARY The save button in this screenshot doesn't always work: ![Screenshot from 2020-03-26 09-39-57](https://user-images.githubusercontent.com/19942822/77653157-c9f62600-6f45-11ea-87d1-8c2ad40e1d12.png)  STEPS TO REPRODUCE 1. Make a team and org, put the team inside the org. 2. Go to org -> Access tab -> add a team permission 3. Try to give the team admin permissions.  EXPECTED RESULTS Clicking the save button works, or presents an error.  ACTUAL RESULTS No visual feedback, the button appears to not respond. The network tab presents a 400: {""msg"":""You cannot assign an Organization participation role as a child role for a Team.""}",config-file
11523,awx,https://github.com/ansible/awx/issues/11523,"/api/v2/ping is returning wrong value in ""heartbeat"" field","Please confirm the following - [X] I agree to follow this project's [code of conduct](http://docs.ansible.com/ansible/latest/community/code_of_conduct.html). - [X] I have checked the [current issues](https://github.com/ansible/awx/issues) for duplicates. - [X] I understand that AWX is open source software provided for free and that I am not entitled to status updates or other assurances.  Summary Summary: I believe that this behavior where two endpoints ( `/api/v2/ping` and `/api/v2/instances/` ) return different values for the same ""heartbeat"" like field is not consistent, and I think that `/api/v2/ping` ""heartbeat"" field should be mapped to `last_health_check` field of `Instance` model. Details: In AAP1.2 (Tower 3.8.4) `/api/v2/ping` response, ""heartbeat"" field was mapped to `instance.modified` (*), and the value ""heartbeat"" field in the response was returning a new updated value every minute.  /var/lib/awx/venv/awx/lib/python3.6/site-packages/awx/api/views/root.py class ApiV2PingView(APIView):  def get(self, request, format=None):  for instance in Instance.objects.all(): response['instances'].append(dict(node=instance.hostname, uuid=instance.uuid, heartbeat=instance.modified, < capacity=instance.capacity, version=instance.version))  This is not the case anymore in AAP2.1 (Ansible Automation Platform Controller 4.1.0). I see that in AAP2.1 (Ansible Automation Platform Controller 4.1.0) `/api/v2/ping` ""heartbeat"" field is **still** mapped to modified , and not to `last_seen` nor to `last_health_check` that have been introduced for this purpose.  /var/lib/awx/venv/awx/lib/python3.8/site-packages/awx/api/views/root.py 133 class ApiV2PingView(APIView): 134 A simple view that reports very basic information about this 135 instance, which is acceptable to be public information. 136  .. 143 def get(self, request, format=None):  152 for instance in Instance.objects.all(): 153 response['instances'].append( 154 dict(  158 heartbeat=instance.modified, <   Because of that, `/api/v2/ping` will not return a new value every minute, it will return a new value only if the user fiddles manually with the instance properties (e.g. any change on Administration > Instance Group > ""any instance group"" > Instance Page, etc.). Now, being said that in AAP2.1 (Ansible Automation Platform Controller 4.1.0) `/api/v2/instances/` **does** return correctly all the fields, including last_seen and last_health_check which are updated every minute as expected. (*) back then, there was no `last_seen` nor `last_health_check` field in the Instance model  AWX version Red Hat Downstream AAP2.1  Installation method docker on linux  Modifications no  Ansible version Ansible Automation Platform Controller 4.1.0  Operating system Linux RHEL8.3  Web browser Firefox  Steps to reproduce Access `https://<awx-url>/api/v2/ping/` and compare the response with the one from `https://192.168.122.106/api/v2/instances/`. ""heartbeat"" value from `ping` endpoint will be older than the same value from `instances` endpoint.  Expected results ""heartbeat"" value from `ping` endpoint should match ""last_seen"" and ""last_health_check"" values from `instances` endpoint results. (Not sure about ""last_seen"", but in my tests, said field have always had the same value as ""last_health_check"" field so far)  Actual results ""heartbeat"" value from `ping` endpoint will be older than the same value from `instances` endpoint.  Additional information Likely related commit: https://github.com/ansible/tower/commit/6a17e5b65bf9421c2e650d23817c79ce81248c6f Likely related issue: https://github.com/ansible/awx/issues/10737",source-file
9222,awx,https://github.com/ansible/awx/issues/9222,Passing a bad lookup type modifier in api request triggers 500 error,"ISSUE TYPE - Bug Report  SUMMARY Send a request like `/api/v2/jobs/?id__iexact=1` <img width=""1680"" alt=""Screen Shot 2021-02-03 at 12 28 26 PM"" src=""https://user-images.githubusercontent.com/9889020/106785392-56b84880-661b-11eb-9288-fa50845636f7.png""> `iexact` isn't supported on the `id` field. What I'm hoping for is a nice 4xx error that says that modifier is not supported. The impetuous for this issue came from https://github.com/ansible/awx/issues/7834. The advanced search in the UI allows the user to select from a static list of modifiers in the `Advanced` section. I left that issue open as a UI enhancement to attempt to trim that list down to only modifiers that will work with a particular field.",test-file | source-file
11452,awx,https://github.com/ansible/awx/issues/11452,TypeError: Converting circular structure to JSON trying to relaunch Jobs,Please confirm the following - [X] I agree to follow this project's [code of conduct](http://docs.ansible.com/ansible/latest/community/code_of_conduct.html). - [X] I have checked the [current issues](https://github.com/ansible/awx/issues) for duplicates. - [X] I understand that AWX is open source software provided for free and that I am not entitled to status updates or other assurances.  Summary Trying to relaunch a job is causing `Failed to launch job.` `TypeError: Converting circular structure to JSON --> starting at object with constructor 'HTMLButtonElement'`  AWX version devel  Installation method docker on linux  Modifications no  Ansible version _No response_  Operating system _No response_  Web browser Chrome  Steps to reproduce 1. Create a job template 2. Launch this JT 3. Go to jobs list 4. Relaunch the job  Expected results The job to relaunch successfully and run  Actual results  TypeError: Converting circular structure to JSON --> starting at object with constructor 'HTMLButtonElement' | property '__reactFiber$ufx73v3ec7m' -> object with constructor 'Bl'  property 'stateNode' closes the circle at stringify (<anonymous>) at https://localhost:8043/static/js/2.c2ae93d7.chunk.js:2:912670 at Object.l.transformRequest (https://localhost:8043/static/js/2.c2ae93d7.chunk.js:2:912674) at https://localhost:8043/static/js/2.c2ae93d7.chunk.js:2:1450812 at Object.u [as forEach] (https://localhost:8043/static/js/2.c2ae93d7.chunk.js:2:356646) at Object.e.exports (https://localhost:8043/static/js/2.c2ae93d7.chunk.js:2:1450785) at e.exports (https://localhost:8043/static/js/2.c2ae93d7.chunk.js:2:1450199) at u.request (https://localhost:8043/static/js/2.c2ae93d7.chunk.js:2:1449016) at u.r.forEach.u.<computed> [as post] (https://localhost:8043/static/js/2.c2ae93d7.chunk.js:2:1449469) at Function.post (https://localhost:8043/static/js/2.c2ae93d7.chunk.js:2:1059419)  ![image](https://user-images.githubusercontent.com/12464858/145837634-7227b6ae-d1e4-4553-9a74-c5bc68aa3569.png)  Additional information _No response_,source-file
6324,awx,https://github.com/ansible/awx/issues/6324,tower_role not idempotent,"ISSUE TYPE - Bug Report  SUMMARY Granting a user a role with the AWX collection twice gives changed twice  ENVIRONMENT * AWX version: 9.3.0  STEPS TO REPRODUCE yaml - name: Add Joe to workflow execute role tower_role: user: joe role: execute workflow: test-role-workflow state: present register: result - assert: that: - ""result is changed"" - name: Add Joe from the workflow execute role, no-op tower_role: user: joe role: execute workflow: test-role-workflow state: present register: result - assert: that: - ""result is not changed""   EXPECTED RESULTS passes  ACTUAL RESULTS fails, both tasks report changed  ADDITIONAL INFORMATION this is being refactored anyway, test again then https://github.com/ansible/awx/pull/6304",test-file | source-file
