issue_no,repo,issue_url,title,description,patched_file_types
20634,Ghost,https://github.com/TryGhost/Ghost/issues/20634,The RSS feed endpoint returns a wrong content type,"Issue Summary When requesting an RSS feed from a ghost blog (e.g. https://activitypub.ghost.org/rss/), the returned content-type is `content-type: text/xml; charset=utf-8` (as you can see in [this file](https://github.com/TryGhost/Ghost/blob/main/ghost/core/core/frontend/services/rss/renderer.js)). This can result in the feed not being correctly displayed: |How it is displayed|How it should be displayed (with an Add-on for RSS feeds)| ||| |![grafik](https://github.com/user-attachments/assets/6bd50845-9533-4176-a428-64361f79c99d)|![grafik](https://github.com/user-attachments/assets/609aa980-bf8c-4dcd-9025-26789039980d)| As far as I can see, it should be `application/rss+xml`. (Sources: [[1]](https://datatracker.ietf.org/doc/id/draft-nottingham-rss-media-type-00), [[2]](https://stackoverflow.com/questions/595616/what-is-the-correct-mime-type-to-use-for-an-rss-feed)).  Steps to Reproduce 1. Open the RSS feed URL from any ghost blog (e.g. https://activitypub.ghost.org/rss/) 2. Open the developer tools from the browser, look into the network tab. 3. (Sometimes required:) Refresh the site 4. Click on the request of the main request. 5. See in the Response Headers: `content-type: text/xml; charset=utf-8`  Ghost Version 5.87.3  Node.js Version (I don't see that with docker?)  How did you install Ghost? Using a docker container on a debian 12 server.  Database type MySQL 8  Browser & OS version Firefox 128.0 (64-Bit) on Windows 11 Pro  Relevant log / error output _No response_  Code of Conduct - [X] I agree to be friendly and polite to people in this repository",source-file | test-file
15608,Ghost,https://github.com/TryGhost/Ghost/issues/15608,"new tag with new post, link to the new tag = 404","Issue Summary 1. create a new post with content ; 2. add a new tag alongside the new post ; 3. the new tag will appear in the site, but the link to that tag is 404 ; 4. can only be fixed by restarting ghost.  Steps to Reproduce 1. create a new post with content ; 2. add a new tag alongside the new post ;  Ghost Version 5.18.0  Node.js Version v18.10.0  How did you install Ghost? self-hosted on ubuntu 22  Database type MySQL 8  Browser & OS version ubuntu 22.04  Relevant log / error output shell tested on both node v16.15.0 and v18.10.0 can only be fixed by restarting ghost.   Code of Conduct - [X] I agree to be friendly and polite to people in this repository",other-file | config-file | test-file | source-file | ui-file | documentation-file | data-file
15505,Ghost,https://github.com/TryGhost/Ghost/issues/15505,Starting Ghost with missing active theme breaks Design Settings screen,"Issue Summary If the selected active theme does not exist in the filesystem the Design Settings screen errors and is unusable. The problem occurs because Ghost's API is returning an unexpected state - when requesting a list of themes none of them has the active: true flag. The preferred solution is to cater for this state in Admin somehow e.g. have a blank-slate state for the design settings screen indicating that no theme is active and point user to the change-theme screen  Steps to Reproduce 1. Activate a custom theme 2. Stop Ghost and delete or rename the custom theme directory 3. Start Ghost 4. Try to access the design settings screen ![image](https://user-images.githubusercontent.com/101513/193050450-fdd1b30c-f923-49a8-99a6-eedb5c5a96e6.png)  Ghost Version 5.16  Node.js Version 16  How did you install Ghost? ghost install  Database type MySQL 8  Browser & OS version _No response_  Relevant log / error output shell <img width=""630"" alt=""image"" src=""https://user-images.githubusercontent.com/101513/193117369-f2947482-993a-440e-91c8-6f5cc11a5c37.png"">   Code of Conduct - [X] I agree to be friendly and polite to people in this repository",source-file
15007,Ghost,https://github.com/TryGhost/Ghost/issues/15007,Cannot get reading time from API via ?fields param,"Issue Summary When making a request to the Content API for posts and including `reading_time` as a field, it is not returned.  Steps to Reproduce Request the demo site with `reading_time`: https://demo.ghost.io/ghost/api/canary/content/posts/?key=22444f78447824223cefc48062&fields=title,url,reading_time Note that it does work if you include the `html` field, which reading time is calculated based on. https://demo.ghost.io/ghost/api/canary/content/posts/?key=22444f78447824223cefc48062&fields=title,url,reading_time,html  Ghost Version 5.2  Node.js Version 14  How did you install Ghost? ghost cli  Database type MySQL 8  Browser & OS version N/a  Relevant log / error output shell n/a   Code of Conduct - [X] I agree to be friendly and polite to people in this repository",test-file | source-file
22023,Ghost,https://github.com/TryGhost/Ghost/issues/22023,API has different max length for feature_image_alt than editor. API 190 / Editor 125,"Issue Summary Updating feature_image_alt over admin API allows 190 characters. The Editor will only allow 125 A feature_image_alt up to 190 characters is accepted when updating a post at `/admin/posts/{{id}}` When editing the same posts and saving, the error ""Update failed: Feature image alt text cannot be longer than 125 characters."" is displayed. See screenshot. <img width=""814"" alt=""Image"" src=""https://github.com/user-attachments/assets/1e0b6091-403b-4c80-bf82-e0335b370b0e"" />  Steps to Reproduce 1. Update a post over API `/admin/posts/{{id}}` with string longer than 125 characters, ex { ""feature_image_alt"" : ""The image shows a wet, pink-lit city street with a car in the background and a person in a coat standing in the foreground."" } 2. Open the posts in Editor, attempt to save. Expecting Editor & admin API to have the same max length, 190 characters  Ghost Version 5.106.1-0-ga963b514+moya  Node.js Version N/A  How did you install Ghost? GhostPro  Database type MySQL 5.7  Browser & OS version N/A  Relevant log / error output shell Update failed: Feature image alt text cannot be longer than 125 characters.   Code of Conduct - [x] I agree to be friendly and polite to people in this repository",source-file
22764,Ghost,https://github.com/TryGhost/Ghost/issues/22764,Search should match results with accents if term does not include them,"Issue Summary If a post title of page include accents, the search results should include those in the results, whether there are accents or not  Steps to Reproduce 1. Create a post with the title Rene Zellweger (note the accented ) 2. Search for this using renee as the term 3. Observe no results  Ghost Version 1.108.1  Node.js Version 18  How did you install Ghost? Ghost(Pro)  Database type MySQL 8  Browser & OS version All  Relevant log / error output shell   Code of Conduct - [x] I agree to be friendly and polite to people in this repository",documentation-file | test-file | source-file | config-file
22328,Ghost,https://github.com/TryGhost/Ghost/issues/22328,Comments exposes a 'hide' button even for staff roles that shouldn't see it.,"Issue Summary I'm logged in as an editor on a Ghost pro site. I'm not logged in as a member When I view comments, I can see the """" with hide behind it. Clicking Hide causes the comment to grey out, but doesn't actually hide it (comment reappears on reload). Aside: I'm about to give editors permissions to hide comments anyway, so maybe I'll write a test that shows that they can (and authors can't).  Steps to Reproduce See above.  Ghost Version Ghost Pro, 5.110.2  Node.js Version na  How did you install Ghost? na  Database type MySQL 8  Browser & OS version chrome, windows 11  Relevant log / error output shell Browser shows a 500 status code because I don't have permissions to hide the comment.   Code of Conduct - [x] I agree to be friendly and polite to people in this repository",source-file | test-file
20133,Ghost,https://github.com/TryGhost/Ghost/issues/20133,Author slug with one letter causes failed filter,"Issue Summary A staff member that signs up with a single-letter first name upon invitation will not be able to use Ghost at all. They only see an error message in the Ghost admin:  Request not understood error, cannot list posts. Error parsing filter  ![CleanShot 2024-05-05 at 19 03 18@2x](https://github.com/TryGhost/Ghost/assets/25703384/52fe6ae4-32bd-487d-99d7-4ee759370d79) Looking at the network requests, the request to `/ghost/api/admin/posts/?formats=mobiledoc%2Clexical&limit=30&page=1&filter=status%3A%5Bdraft%2Cscheduled%2Cpublished%2Csent%5D%2Bauthors%3Aj` fails. As soon as the last filter is removed, the API request succeeds: `https://tireless-buzzard.pikapod.net/ghost/api/admin/posts/?formats=mobiledoc%2Clexical&limit=30&page=1&filter=status%3A%5Bdraft%2Cscheduled%2Cpublished%2Csent%5D` I have then tried to change the author slug in the database from ""j"" to ""jb""  and things started to work. This has been tested in different environments, both locally with development configurations, as well as on different managed hosts. Ghost v5.82.2 and v5.82.6 have been tested, both from the CLI as well as Docker images.  Steps to Reproduce 1. Invite a new staff member as contributor 2. Accept the invitation and register  IMPORTANT: Set the name to have a single-letter first name, e.g. ""J Doe"" instead of ""John Doe"" 3. See the error  Ghost Version v5.82.6  Node.js Version 18 LTS  How did you install Ghost? Ghost CLI  Database type MySQL 8  Browser & OS version Mac OS 14.4.1, latest Chrome and latest Safari tested  Relevant log / error output shell [2024-05-05 16:55:19] ERROR ""GET /ghost/api/admin/posts/?formats=mobiledoc%2Clexical&limit=30&page=1&filter=status%3A%5Bdraft%2Cscheduled%2Cpublished%2Csent%5D%2Bauthors%3Aj"" 400 12ms Error parsing filter Error ID: 415527a0-0b00-11ef-96dc-2bc1b8db7476  Error: Query Error: unrecognized text ""j"" in filter at char 24 at Child.applyDefaultAndCustomFilters (/var/lib/ghost/versions/5.82.2/node_modules/@tryghost/bookshelf-filter/lib/bookshelf-filter.js:66:23) ished,sent]+authors:j)+type:post ^ at lexer.parseError (/var/lib/ghost/versions/5.82.2/node_modules/@tryghost/nql-lang/dist/parser.js:760:11) at Object.next (/var/lib/ghost/versions/5.82.2/node_modules/@tryghost/nql-lang/dist/parser.js:625:25) at Object.lex (/var/lib/ghost/versions/5.82.2/node_modules/@tryghost/nql-lang/dist/parser.js:635:22) at lex (/var/lib/ghost/versions/5.82.2/node_modules/@tryghost/nql-lang/dist/parser.js:246:27) at Parser.parse (/var/lib/ghost/versions/5.82.2/node_modules/@tryghost/nql-lang/dist/parser.js:259:26) at exports.parse (/var/lib/ghost/versions/5.82.2/node_modules/@tryghost/nql-lang/lib/nql.js:18:44) at api.parse (/var/lib/ghost/versions/5.82.2/node_modules/@tryghost/nql/lib/nql.js:15:31) at api.querySQL (/var/lib/ghost/versions/5.82.2/node_modules/@tryghost/nql/lib/nql.js:49:44) at Builder.<anonymous> (/var/lib/ghost/versions/5.82.2/node_modules/@tryghost/bookshelf-filter/lib/bookshelf-filter.js:63:24) at Object.query (/var/lib/ghost/versions/5.82.2/node_modules/bookshelf/lib/helpers.js:164:14) at Child.query (/var/lib/ghost/versions/5.82.2/node_modules/bookshelf/lib/model.js:1387:22) at Child.applyDefaultAndCustomFilters (/var/lib/ghost/versions/5.82.2/node_modules/@tryghost/bookshelf-filter/lib/bookshelf-filter.js:56:22) at Function.getFilteredCollection (/var/lib/ghost/versions/5.82.2/core/server/models/base/plugins/filtered-collection.js:13:32) at Function.findPage (/var/lib/ghost/versions/5.82.2/core/server/models/base/plugins/crud.js:83:41) at PostsService.browsePosts (/var/lib/ghost/versions/5.82.2/node_modules/@tryghost/posts-service/lib/PostsService.js:81:44) at Object.query (/var/lib/ghost/versions/5.82.2/core/server/api/endpoints/posts.js:73:33)   Code of Conduct - [X] I agree to be friendly and polite to people in this repository",documentation-file | config-file
15291,Ghost,https://github.com/TryGhost/Ghost/issues/15291,Regression: Redirect to signin/re-authenticate modal not shown when logged out,"We've had a regression with how unauthenticated requests are handled by Admin. Unauthenticated requests could occur if you've logged out in another tab and didn't realise you'd gone back to editing on a tab that looked like it was still logged in. ## Steps to reproduce 1. Open Ghost admin and ensure you're logged in in two different tabs 2. In tab 1, open the editor 3. In tab 2, logout 4. In tab 1, attempt to save ## Previous behaviour - whilst editing - show a re-authentication modal to allow quick sign-in and save - whilst performing any other action - redirect to signin screen ## Current behaviour: - all actions - show a slightly cryptic alert message `Authorization failed Unable to determine the authenticated user or integration. Check that cookies are being passed through if using session authentication.` This is likely happening because we've moved from a `401` to a `403`. The cookie is being sent so the request is not ""Unauthenticated"" but it no longer matches a valid session so its ""Unauthorized"". Admin isn't currently set up to recognise a 403 and trigger the auto-logout/re-authenticate behaviour. There are potential edge cases if we treat 403 and 401 the same when it's a genuine ""not permitted"" error but Admin shouldn't be making any such requests unless your role is changed by another user whilst you're using it. Note: There is a skipped test for the re-authentication modal here: https://github.com/TryGhost/Ghost/blob/0695f74a653bff85d5a08ee7f97fc9a4a8ddbe63/ghost/admin/tests/acceptance/authentication-test.js#L97 which may have contributed to this regression slipping in. Ideally we'd get this test running again as well to prevent this regressing in future.  Ghost Version 5.10",other-file | config-file | test-file | source-file | ui-file | documentation-file | data-file
14980,Ghost,https://github.com/TryGhost/Ghost/issues/14980,"Tenor V1 API has been decomissioned, unable to load Gifs from editor.","Issue Summary Whenever trying to insert a gif from Tenor on the editor, the error ""Unable to connect to Tenor, please check your connection"" intermittently appears. The reason for this is that Tenor V1 API has been deprecated and migrated to a Google Api.  Steps to Reproduce 1. Start writing a Post or a new Page 2. on the editor enter the `/tenor` command to open the GIF Search card 3. Tenor will display the error `Uh oh! Trouble reaching the Tenor API, please check your connection`  Ghost Version 5.2  Node.js Version 16.15.0  How did you install Ghost? Docker  Database type MySQL 8  Browser & OS version Chrome, Mac OS Monterey 12.4  Relevant log / error output shell GET https://g1.tenor.com/v1/trending?media_filter=minimal&key=null&contentfilter=off 401 (Unauthorized)   Code of Conduct - [X] I agree to be friendly and polite to people in this repository",ui-file | source-file
14983,Ghost,https://github.com/TryGhost/Ghost/issues/14983,[Content API] Url set to 404 for tags when using multiple fields,"Issue Summary When using multiple [fields](https://ghost.org/docs/content-api/#fields) on the Content API, the tag URLs are set to `https://demo.ghost.io/404/` instead of their corresponding URL.  Steps to Reproduce  https://demo.ghost.io/ghost/api/content/tags/?key=22444f78447824223cefc48062&filter=visibility%3Apublic&fields=name json { ""tags"": [ { ""name"": ""Fables"" }, { ""name"": ""Fiction"" }, { ""name"": ""Getting Started"" }, { ""name"": ""Speeches"" } ], ""meta"": { ""pagination"": { ""page"": 1, ""limit"": 15, ""pages"": 1, ""total"": 8, ""next"": null, ""prev"": null } } }   https://demo.ghost.io/ghost/api/content/tags/?key=22444f78447824223cefc48062&filter=visibility%3Apublic&fields=url json { ""tags"": [ { ""url"": ""https://demo.ghost.io/tag/fables/"" }, { ""url"": ""https://demo.ghost.io/tag/fiction/"" }, { ""url"": ""https://demo.ghost.io/tag/getting-started/"" }, { ""url"": ""https://demo.ghost.io/tag/speeches/"" } ], ""meta"": { ""pagination"": { ""page"": 1, ""limit"": 15, ""pages"": 1, ""total"": 8, ""next"": null, ""prev"": null } } }   https://demo.ghost.io/ghost/api/content/tags/?key=22444f78447824223cefc48062&filter=visibility%3Apublic&fields=name,url  https://demo.ghost.io/ghost/api/content/tags/?key=22444f78447824223cefc48062&filter=visibility%3Apublic&fields=url,name  https://demo.ghost.io/ghost/api/content/tags/?key=22444f78447824223cefc48062&filter=visibility%3Apublic&fields=name%2Curl  https://demo.ghost.io/ghost/api/content/tags/?key=22444f78447824223cefc48062&filter=visibility%3Apublic&fields=url%2Cname json { ""tags"": [ { ""name"": ""Fables"", ""url"": ""https://demo.ghost.io/404/"" }, { ""name"": ""Fiction"", ""url"": ""https://demo.ghost.io/404/"" }, { ""name"": ""Getting Started"", ""url"": ""https://demo.ghost.io/404/"" }, { ""name"": ""Speeches"", ""url"": ""https://demo.ghost.io/404/"" } ], ""meta"": { ""pagination"": { ""page"": 1, ""limit"": 15, ""pages"": 1, ""total"": 8, ""next"": null, ""prev"": null } } }   Ghost Version 5.2.3  Node.js Version 16  How did you install Ghost? Docker  Database type MySQL 8  Browser & OS version _No response_  Relevant log / error output _No response_  Code of Conduct - [X] I agree to be friendly and polite to people in this repository",source-file | test-file
16748,Ghost,https://github.com/TryGhost/Ghost/issues/16748,admin/members/:id/signin_url won't take Owner's staff access token,"Issue Summary I'm trying to make a fetch request to admin/members/:id/signin_url The [commit](https://github.com/TryGhost/Ghost/commit/b0ff1e7cacf619deed1d4f07c3cb0e7731707597) (Hi @naz !) that added the functionality seems to suggest this is possible. I'm converting the owner's staff access token into a JWT successfully, based on it working elsewhere on the admin API. I've tried on Ghost Pro (but it was a site where I'd switched owners, so could be an edge case). I've also tried on a production 5.13 self-hosted site, and on a 5.47 local install (Windows). Here's what I'm getting back (fresh 5.47 install, but all cases are the same): Request to: http://localhost:2368/ghost/api/canary/admin/members/6456ef85849b402bb40c61f4/signin_urls/  errors: [ { message: 'Permission error, cannot read member_signin_url.', context: 'You do not have permission to read member_signin_urls', type: 'NoPermissionError', details: null, property: null, help: null, code: null, id: '714c58e0-ec6e-11ed-94c9-6ba7df6bb971', ghostErrorCode: null } ]  The endpoint works fine if I pass in the site owner's cookie.  Steps to Reproduce  const session = require('express-session') const express = require(""express""); const fetch = require('node-fetch') const app = express(); app.use(express.json()); app.use(express.urlencoded({ extended: false })); const jwt = require('jsonwebtoken') const GhostAdminAPI = require('@tryghost/admin-api'); const GHOST_URL = 'http://localhost:2368' let GHOST_API_KEY = '6456efec849b402bb40c61fc:07df42c75551444cb88af8601acbdcc4cc0d8ea983392ddb44dbb1cebb87a32b'; //local install, not worried about leakage. let [GHOST_ID, GHOST_SECRET] = GHOST_API_KEY.split(':') const api = new GhostAdminAPI({ url: GHOST_URL, key: GHOST_API_KEY, version: ""v5.0"", }); let GHOST_TOKEN = jwt.sign({}, Buffer.from(GHOST_SECRET, 'hex'), { // eslint-disable-line no-undef keyid: GHOST_ID, algorithm: 'HS256', expiresIn: '5m', audience: '/canary/admin' }); console.log(GHOST_TOKEN) async function getMember(email) { let result = await api.members.browse({email:email, limit: 1}) console.log('getMember result is', result[0].id) return result[0].id; } async function getAuthUrl(id) { // does not work let result = await fetch(GHOST_URL + '/ghost/api/canary/admin/members/' + id + '/signin_urls/', { method: 'GET' , headers: { 'Authorization': `Ghost ${GHOST_TOKEN}`, 'Content-type': 'application/json'} } ) let json= await result.json() console.log('result is', json) return result; } async function getMemberUrl(id) { // works fine console.log('getMemberUrl request to: ', GHOST_URL + '/ghost/api/canary/admin/members/' + id ) let result = await fetch( GHOST_URL + '/ghost/api/canary/admin/members/' + id , { method: 'GET' , headers: { 'Authorization': 'Ghost ' + GHOST_TOKEN} }) let json= await result.json() console.log('result is', json) return result; } app.get(""/"", async (req, res) => { res.send(`<center style=""font-size:160%""> <p>This is Home Page </p> ${await getMemberUrl(await getMember('catsarisky@gmail.com'))} ${await getAuthUrl(await getMember('catsarisky@gmail.com'))} `); } ); app.listen(3002);   Ghost Version 5.47  Node.js Version 16  How did you install Ghost? Ghost Pro, also local install on Windows, also 5.13 production  Database type MySQL 8  Browser & OS version _No response_  Relevant log / error output _No response_  Code of Conduct - [X] I agree to be friendly and polite to people in this repository",documentation-file | test-file | data-file
21123,Ghost,https://github.com/TryGhost/Ghost/issues/21123,Tips and Donation Feature - Request URL Issue,"Issue Summary Hello, I am new to ghost so please let me know if I can offer further clarification to my problem. Thank you. I have a self-hosted ghost install, and I updated ghost to include the tips/donation feature. When I visit: https://domain.com/blog/#/portal/support, there is an issue with these two requests: session/ | 404 | fetch | FeedbackPage.js:12 create-stripe-checkout-session/ | 404 | fetch | FeedbackPage.js:12 and I see this message in the browser: Sorry, that didnt work. Something went wrong, please try again later. The request urls look like this: Request URL: https://domain.com/members/api/session/ Request URL: https://domain.com/members/api/create-stripe-checkout-session/ however I am expecting them to be: Request URL: https://domain.com/blog/members/api/session/ Request URL: https://domain.com/blog/members/api/create-stripe-checkout-session/ as https://domain.com/blog is what is setup in my ghost config Also, if I visit https://domain.com/blog/#/portal/signup this request, for example, returns 204 Fetchmember/ 204 fetch FeedbackPage.js:12 with the following request url: Request URL: https://domain.com/blog/members/api/member/ I am trying to understand why /blog/ is not being included in the requests sent when visiting https://domain.com/blog/#/portal/support For example, if I run curl -i https://domain.com/blog/members/api/session/ I get a 204 response. Thank you for your help. - Sally  Steps to Reproduce Assumes self-hosted ghost installation where ghost is located here: https://domain.com/blog Update ghost to include tips/donations Expected request url to match and behave similarly to #/portal/signup  Ghost Version 5.92.0  Node.js Version 18.20.4  How did you install Ghost? Digital Ocean Ubuntu  Database type MySQL 8  Browser & OS version _No response_  Relevant log / error output _No response_  Code of Conduct - [X] I agree to be friendly and polite to people in this repository",source-file
15252,Ghost,https://github.com/TryGhost/Ghost/issues/15252,Unable to delete post with nested comment,"Issue Summary Whenever you try to delete a post that has a comment and a reply to that comment, an internal server error occurs: `Internal server error, cannot delete post. Cannot set properties of undefined (setting 'message')`  Steps to Reproduce 1. Create a new blog post and publish it 2. Leave a comment on that blog post 3. Reply to that comment 4. Attempt to delete the blog post  Ghost Version 5.9.4  Node.js Version 16.16  How did you install Ghost? Ubuntu 20.04.4 LTS  Database type MySQL 8  Browser & OS version _No response_  Relevant log / error output shell {""name"":""Log"",""hostname"":""example"",""pid"":696855,""level"":50,""req"":{""meta"":{""requestId"":""07055caf-c581-4d77-81a3-01f7055c77c7"",""userId"":""1""},""url"":""/posts/62fdbbfb752fb6a221f26e9d/"",""method"":""DELETE"",""originalUrl"":""/ghost/api/admin/posts/62fdbbfb752fb6a221f26e9d/"",""params"":{},""headers"":{""host"":""blog.example.org"",""cf-ipcountry"":""US"",""cdn-loop"":""cloudflare"",""accept-encoding"":""gzip"",""x-forwarded-for"":""**REDACTED**"",""cf-ray"":""**REDACTED**"",""x-forwarded-proto"":""https, https"",""cf-visitor"":""{\""scheme\"":\""https\""}"",""accept"":""application/json, text/javascript, */*; q=0.01"",""x-requested-with"":""XMLHttpRequest"",""x-ghost-version"":""5.9"",""app-pragma"":""no-cache"",""user-agent"":""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.5112.81 Safari/537.36"",""content-type"":""application/json; charset=UTF-8"",""sec-gpc"":""1"",""origin"":""https://blog.example.org"",""sec-fetch-site"":""same-origin"",""sec-fetch-mode"":""cors"",""sec-fetch-dest"":""empty"",""referer"":""https://blog.example.org/ghost/"",""accept-language"":""en-US,en;q=0.9,de;q=0.8"",""cf-connecting-ip"":""**REDACTED**"",""cookie"":""**REDACTED**"",""x-forwarded-host"":""blog.example.org""},""query"":{}},""res"":{""_headers"":{""x-powered-by"":""Express"",""cache-control"":""no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0"",""access-control-allow-origin"":""https://blog.example.org"",""vary"":""Origin, Accept-Encoding"",""content-type"":""application/json; charset=utf-8"",""content-length"":""286"",""etag"":""W/\""11e-JGRxNJsjDWlG04oL0DLfIS39Z7M\""""},""statusCode"":500,""responseTime"":""70ms""},""err"":{""id"":""eec45ac0-1eab-11ed-8676-618ce3f5ed56"",""domain"":""https://blog.example.org"",""code"":null,""name"":""InternalServerError"",""statusCode"":500,""level"":""critical"",""message"":""Cannot set properties of undefined (setting 'message')"",""stack"":""TypeError: Cannot set properties of undefined (setting 'message')\n at module.exports.prepareError (/var/www/blog.example.org/versions/5.9.4/node_modules/@tryghost/mw-error-handler/lib/mw-error-handler.js:79:19)\n at ErrorCtor (/var/www/blog.example.org/versions/5.9.4/node_modules/create-error/create-error.js:29:18)\n at runMicrotasks (<anonymous>)\n at processTicksAndRejections (node:internal/process/task_queues:96:5)"",""hideStack"":false},""msg"":""Cannot set properties of undefined (setting 'message')"",""time"":""2022-08-18T04:12:11.248Z"",""v"":0}   Code of Conduct - [X] I agree to be friendly and polite to people in this repository",test-file | data-file
16048,Ghost,https://github.com/TryGhost/Ghost/issues/16048,Improve error message for YouTube videos that disabled embedding,"Issue Summary EDIT: I've figured out that this specific YouTube doesn't allow embedding. Maybe you could improve the error message shown to the user if you get the `Unauthorized` message (see below) so this causes less confusion. I have also updated the issue title to reflect this. I'm leaving the following text here as was to leave the context.  In general, YouTube embedding works. But this specific returns an error: `https://www.youtube.com/watch?v=5f-JlzBuUUU`. ![CleanShot 2022-12-25 at 20 10 24@2x](https://user-images.githubusercontent.com/1881676/209479558-2388988d-e2db-4116-b7bb-0b56eef57e1f.jpg) The request is the following:  https://cassandradispatch.org/ghost/api/admin/oembed/?url=https://www.youtube.com/watch?v=5f-JlzBuUUU&type=embed  The error response is the following: json { ""errors"": [ { ""message"": ""Internal server error, cannot read oembed."", ""context"": ""invalid json response body at https://www.youtube.com/oembed?format=json&url=https%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3D5f-JlzBuUUU reason: Unexpected token U in JSON at position 0"", ""type"": ""InternalServerError"", ""details"": null, ""property"": null, ""help"": null, ""code"": null, ""id"": ""e01223d0-8487-11ed-94c3-8df7a8a46270"", ""ghostErrorCode"": null } ] }  This is becaue the request `https://www.youtube.com/oembed?format=json&url=https%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3D5f-JlzBuUUU` Returns `Unauthorized` as the response body.  Steps to Reproduce 1. Create a new post (or edit an existing one) 2. Click the ""plus"" sign to add a new bloc and choose ""YouTube"" 3. Paste this URL: `https://www.youtube.com/watch?v=5f-JlzBuUUU` 4. See the error  Ghost Version 5.26.3  Node.js Version 16.18.1  How did you install Ghost? Hetzner, Ubuntu 22.04.1  Database type MySQL 8  Browser & OS version _No response_  Code of Conduct - [X] I agree to be friendly and polite to people in this repository",other-file | config-file | source-file | documentation-file | ui-file | test-file
14508,Ghost,https://github.com/TryGhost/Ghost/issues/14508,Impersonation tokens do signup action if no account is found,Issue Summary When a user is deleted it is expected that all tokens associated with that account are revoked. This is currently not the case. Creating a token before deleting a user creates the account again when pasted into the browser.  Steps to Reproduce 1. Create an access token for an account. 2. Delete that account. 3. Paste that token into your browser. 4. User is created again. The user should NOT be created again and all tokens should be revoked when a user is deleted.  Ghost Version 4.44.0  Node.js Version 16.14.2  How did you install Ghost? OS - Debian 11 with MariaDB 10.5.15  Database type MySQL 8  Browser & OS version _No response_  Relevant log / error output _No response_  Code of Conduct - [X] I agree to be friendly and polite to people in this repository,source-file | data-file | test-file | documentation-file
14981,Ghost,https://github.com/TryGhost/Ghost/issues/14981,Empty sitemap if a taxonomy is removed,"Issue Summary By deleting a taxonomy from the `routes.yml` file, the deleted taxonomies pages are not generated, but their respective sitemap are. They are empty, but some tools like Google Search Console warn users that their sitemap is wrong because it's empty. Example of my [website](https://www.benjaminrancourt.ca/sitemap.xml), where I've disabled the `authors` taxonomy. html <tr> <td> <a href=""https://www.benjaminrancourt.ca/sitemap-authors.xml""> https://www.benjaminrancourt.ca/sitemap-authors.xml </a> </td> <td>1970-01-01 00:00</td> </tr>  ![image](https://user-images.githubusercontent.com/7907713/174452395-01298c43-b958-4844-9d08-e4daeb9bff8e.png) > The sitemap can be read, but it contains errors | Empty sitemap ![image](https://user-images.githubusercontent.com/7907713/174452417-ff20bcd4-ea8a-41cd-8fa3-3c7af6fcca02.png)  I tried to find a way to fix this in Ghost source code, but I couldn't run a working setup on my machine (I really should install Linux ). However, I'll paste my notes I've took while looking into this bug, in the hope that it will at least help you. **core/frontend/services/sitemap/manager.js** js // [Ben] The index sitemap is generated here getIndexXml() { return this.index.getXml(); } createIndexGenerator(options) { // [Ben] Solution 1: If some taxonomies are disabled, can we remove them from the options below? return new IndexMapGenerator({ types: { pages: this.pages, posts: this.posts, authors: this.authors, tags: this.tags }, maxPerPage: options.maxPerPage }); }  core/frontend/services/sitemap/index-generator.js js generateSiteMapUrlElements() { // [Ben] We iterate over each resource type here return _.map(this.types, (resourceType) => { // `|| 1` = even if there are no items we still have an empty sitemap file const noOfPages = Math.ceil(Object.keys(resourceType.nodeLookup).length / this.maxPerPage) || 1; const pages = []; for (let i = 0; i < noOfPages; i++) { const page = i  0 ? '' : `-${i + 1}`; const url = urlUtils.urlFor({relativeUrl: '/sitemap-' + resourceType.name + page + '.xml'}, true); const lastModified = resourceType.lastModified; // [Ben] Solution 2: For disabled taxonomies, I suspect their lastModified property is undefined. // Therefore, maybe we could not push this resource sitemap if it's the case? pages.push({ sitemap: [ {loc: url}, {lastmod: moment(lastModified).toISOString()} ] }); } return pages; }).flat(); }  Thanks to the Ghost team!  Steps to Reproduce 1. Disable a taxonomy like `tags` or `authors` (https://ghost.org/docs/themes/routing/#removing-taxonomies) 2. Go to `/sitemap.xml` 3. The disabled taxonomies will have an empty sitemap with a `Last Modified` date of `1970-01-01 00:00`  Ghost Version 5.2.3  Node.js Version v16.15.0  How did you install Ghost? Docker  Database type MySQL 8  Browser & OS version Google Chrome | Windows 10  Relevant log / error output _No response_  Code of Conduct - [X] I agree to be friendly and polite to people in this repository",source-file | test-file
20445,Ghost,https://github.com/TryGhost/Ghost/issues/20445,Bookmark for YouTube links not working,"Issue Summary Adding a bookmark card with a link to YouTube seems to have broken in v5.86.0. Previously, adding a bookmark card with a valid link to a YouTube video resulted in this: ![CleanShot 2024-06-23 at 14 59 44@2x](https://github.com/TryGhost/Ghost/assets/25703384/44000a43-9c13-4823-a50a-143cb1ef3123) Response from XXX in v5.85.2:  { ""version"": ""1.0"", ""type"": ""bookmark"", ""url"": ""https://www.youtube.com/watch?v=aqz-KE-bpKQ"", ""metadata"": { ""url"": ""https://www.youtube.com/watch?v=aqz-KE-bpKQ"", ""title"": ""Big Buck Bunny 60fps 4K - Official Blender Foundation Short Film"", ""description"": ""Enjoy this UHD High Frame rate version of one of the iconic short films produced by Blender Institute!Learn more about the project here http://bbb3d.renderfa"", ""author"": null, ""publisher"": ""YouTube"", ""thumbnail"": ""https://i.ytimg.com/vi/aqz-KE-bpKQ/maxresdefault.jpg"", ""icon"": ""https://www.youtube.com/s/desktop/9f65bf98/img/favicon_144x144.png"" } }  From v5.86.0 onwards (tested in v5.86.1 as well), the same link in a bookmark card produces an error: ![CleanShot 2024-06-23 at 15 00 22@2x](https://github.com/TryGhost/Ghost/assets/25703384/2597c59b-b7d2-4d82-be45-7230d5c19580) Response from XXX in v5.86.0 and v5.86.1:  { ""errors"": [ { ""message"": ""Validation error, cannot read oembed."", ""context"": ""URL contains insufficient metadata. https://www.youtube.com/watch?v=aqz-KE-bpKQ"", ""type"": ""ValidationError"", ""details"": null, ""property"": null, ""help"": null, ""code"": null, ""id"": ""8c6cb290-3160-11ef-bc69-01c02bf2f945"", ""ghostErrorCode"": null } ] }   Steps to Reproduce 1. Create a new post in v5.86.0 or v5.86.1 2. Add a bookmark card 3. Enter any YouTube URL (for example https://www.youtube.com/watch?v=aqz-KE-bpKQ) 4. Error is shown  Ghost Version v5.86.0  Node.js Version 18 LTS  How did you install Ghost? Ubuntu 22.04 with Ghost CLI  Database type MySQL 8  Browser & OS version _No response_  Relevant log / error output _No response_  Code of Conduct - [X] I agree to be friendly and polite to people in this repository",source-file
15470,Ghost,https://github.com/TryGhost/Ghost/issues/15470,Saving different settings screens open in different tabs can overwrite with old values,"Issue Summary If you open two settings screens in different tabs, make changes in the first and save, make changes in the second and save, then the second save will have overwritten your changes from the first save with the old values. Related forum discussion: https://forum.ghost.org/t/editing-code-injection-and-navigation-at-the-same-time-does-not-work/32984/7  Steps to Reproduce 1. Open ""Code injection"" settings screen in one tab 2. Open ""Navigation"" settings screen in another tab 3. Enter some text into the code injection fields and save 4. Make a change on the navigation screen and save 5. Refresh the code injection screen After doing this you'll find that the changes you made on the code injection screen have been ""undone"".  Ghost Version 5.16.0  Node.js Version 16.15.0  How did you install Ghost? Local  Database type MySQL 8  Browser & OS version _No response_  Relevant log / error output _No response_  Code of Conduct - [X] I agree to be friendly and polite to people in this repository",source-file | test-file
15931,Ghost,https://github.com/TryGhost/Ghost/issues/15931,`latest` tag on NPM is not updated for @tryghost/portal,"https://unpkg.com/@tryghost/portal@latest/umd/portal.min.js still points to an outdated version  2.13.2  but it should to 2.21.0. The problem is that the `latest` tag has not been updated after a few last releases  NPM also shows outdated version: <img width=""389"" alt=""Screenshot 2022-12-13 at 13 10 57"" src=""https://user-images.githubusercontent.com/1338731/207314549-62ea365e-1718-408c-a1d7-d1363ae95473.png""> <img width=""775"" alt=""Screenshot 2022-12-13 at 13 11 21"" src=""https://user-images.githubusercontent.com/1338731/207314620-f1bb1612-9837-49d2-a34d-e41c339106d2.png""> <details> <summary>Original (incorrect) issue</summary> ## `url` in Stripe `members/api/create-stripe-checkout-session/` is not handled  `publicKey` is expected  Issue Summary When a request to `members/api/create-stripe-checkout-session/` is made, the response is an object with a single field: `{url: """"}`. Yet, some functions do not handled that well. For example, it's correctly handled here: https://github.com/TryGhost/Ghost/blob/74d0fee1259476cd29962ecae2181c7e13b3932b/ghost/portal/src/utils/api.js#L385-L387 but not here: https://github.com/TryGhost/Ghost/blob/74d0fee1259476cd29962ecae2181c7e13b3932b/ghost/portal/src/utils/api.js#L432  Steps to Reproduce 1. Go to https://news.typeofweb.com 2. Scroll down a bit 3. Click on the blue floating ""Subskrybuj"" button in the bottom right corner. 4. Continue with a paid subscription PLN 5/month 5. See error in the console. 6. Inspect network tab and notice that the endpoint returned `{url}` instead of `{publicKey}`  Ghost Version 74d0fee1259476cd29962ecae2181c7e13b3932b  Node.js Version irrelevant  How did you install Ghost? irrelevant  Database type MySQL 5.7  Browser & OS version _No response_  Relevant log / error output _No response_  Code of Conduct - [X] I agree to be friendly and polite to people in this repository </details>",source-file
